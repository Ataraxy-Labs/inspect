# inspect

Entity-level code review CLI for Git. Built by Ataraxy Labs.

## What it does

inspect analyzes Git diffs at the entity level (functions, structs, classes, traits) instead of the file or line level. Each changed entity gets:

- **Change classification**: ConGra taxonomy (text, syntax, functional, or combinations)
- **Risk scoring**: 0.0-1.0 based on classification, blast radius, dependent count, public API exposure, change type
- **Blast radius**: How many entities are transitively affected by this change
- **Group assignment**: Union-Find untangling separates independent logical changes within a single commit

## Commands

- `inspect diff <ref>`: Review entity-level changes for a commit or range
- `inspect pr <number>`: Review all changes in a GitHub pull request
- `inspect file <path>`: Review uncommitted changes in a file
- `inspect bench --repo <path>`: Benchmark entity-level review across a repo's history

## Architecture

Built in Rust. Two crates:
- `inspect-core`: Analysis engine (classify, risk score, untangle)
- `inspect-cli`: CLI interface with terminal and JSON formatters

Depends on `sem-core` for entity extraction (tree-sitter parsers for 13 languages) and entity dependency graph.

## Risk Scoring

Graph-centric scoring. Dependents and blast radius are the primary discriminators. Classification and change type set a low baseline. Only entities with real graph impact reach High/Critical.

Score = classification_weight(0.0-0.28) + change_type_weight(0.0-0.12) + public_api_boost(0.12) + blast_ratio_sqrt * 0.30 + ln(1+dependents) * 0.15

Cosmetic-only changes (structural_hash unchanged) get a 0.2x discount.

Levels: Critical (>= 0.7), High (>= 0.5), Medium (>= 0.3), Low (< 0.3)

## Change Classification (ConGra)

7 categories along 3 dimensions:
1. Text: comments, whitespace, docs
2. Syntax: signatures, types, declarations
3. Functional: logic, behavior
4. Text+Syntax, Text+Functional, Syntax+Functional, Text+Syntax+Functional

## Benchmark Results

### Code Review: inspect + LLM vs Greptile vs CodeRabbit (141 bugs, 52 PRs, 5 repos)

Same dataset, same heuristic keyword-matching judge, same methodology. 141 planted bugs across Sentry, Cal.com, Grafana, Keycloak, Discourse.

inspect + GPT-5.2: 95.0% recall, 33.3% precision, 49.4% F1 (402 findings)
Greptile API: 91.5% recall, 21.9% precision, 35.3% F1 (590 findings)
CodeRabbit CLI: 56.0% recall, 48.2% precision, 51.8% F1 (164 findings)

HC recall (High+Critical, n=51):
- inspect: 100%
- Greptile: 94.1%
- CodeRabbit: 60.8%

Per-severity recall (inspect / Greptile / CodeRabbit):
- Critical (n=9): 100% / 100% / 55.6%
- High (n=42): 100% / 92.9% / 61.9%
- Medium (n=49): 91.8% / 87.8% / 61.2%
- Low (n=41): 92.7% / 92.7% / 43.9%

Per-repo recall (inspect / Greptile / CodeRabbit):
- Cal.com (n=31): 96.8% / 100% / 77.4%
- Discourse (n=28): 100% / 100% / 67.9%
- Grafana (n=22): 90.9% / 90.9% / 36.4%
- Keycloak (n=26): 100% / 96.2% / 65.4%
- Sentry (n=34): 88.2% / 73.5% / 32.4%

Dataset: https://huggingface.co/datasets/rs545837/inspect-greptile-bench

### AACR-Bench (20 PRs, 166 golden comments, 9 languages)

inspect + GPT-5.2: 30.1% recall, 22.7% precision, 25.9% F1 (220 findings)
Greptile API: 23.5% recall, 21.7% precision, 22.5% F1 (180 findings)
CodeRabbit CLI: 13.3% recall, 115.8% precision, 23.8% F1 (19 findings)

### How it works
inspect triage (no LLM) cuts 100+ changed entities to the 60 riskiest using risk scoring. Then each entity is sent to an LLM for review. This costs a fraction of reviewing the full diff, with higher recall than tools that scan everything.

## Performance

Parallel entity extraction via rayon, zero-allocation BFS, capped graph traversal. Powered by sem-core v0.3.0 with xxHash64, LTO, and cached tree resolution.

Single commit review:
- sem (25 files, 65 entities changed): 6ms
- weave (80 files, 89 entities changed): 6ms
- agenthub (130 files, 95 entities changed): 35ms
- inspect (50 files, large commit): 67ms

Full repo history (inspect bench):
- agenthub (19 commits, 1,112 entities): 0.55s
- sem (38 commits, 5,216 entities): 0.57s
- weave (45 commits, 2,854 entities): 1.33s

## Languages

Rust, TypeScript, TSX, JavaScript, Python, Go, Java, C, C++, Ruby, C#, PHP, Fortran

## Links

- GitHub: https://github.com/Ataraxy-Labs/inspect
- sem (entity extraction): https://github.com/Ataraxy-Labs/sem
- weave (entity merge): https://github.com/Ataraxy-Labs/weave
