# inspect

Entity-level code review CLI for Git. Built by Ataraxy Labs.

## What it does

inspect analyzes Git diffs at the entity level (functions, structs, classes, traits) instead of the file or line level. Each changed entity gets:

- **Change classification**: ConGra taxonomy (text, syntax, functional, or combinations)
- **Risk scoring**: 0.0-1.0 based on classification, blast radius, dependent count, public API exposure, change type
- **Blast radius**: How many entities are transitively affected by this change
- **Group assignment**: Union-Find untangling separates independent logical changes within a single commit

## Commands

- `inspect diff <ref>`: Review entity-level changes for a commit or range
- `inspect pr <number>`: Review all changes in a GitHub pull request
- `inspect file <path>`: Review uncommitted changes in a file
- `inspect bench --repo <path>`: Benchmark entity-level review across a repo's history

## Architecture

Built in Rust. Two crates:
- `inspect-core`: Analysis engine (classify, risk score, untangle)
- `inspect-cli`: CLI interface with terminal and JSON formatters

Depends on `sem-core` for entity extraction (tree-sitter parsers for 13 languages) and entity dependency graph.

## Risk Scoring

Graph-centric scoring. Dependents and blast radius are the primary discriminators. Classification and change type set a low baseline. Only entities with real graph impact reach High/Critical.

Score = classification_weight(0.0-0.28) + change_type_weight(0.0-0.12) + public_api_boost(0.12) + blast_ratio_sqrt * 0.30 + ln(1+dependents) * 0.15

Cosmetic-only changes (structural_hash unchanged) get a 0.2x discount.

Levels: Critical (>= 0.7), High (>= 0.5), Medium (>= 0.3), Low (< 0.3)

## Benchmark Results

### AACR-Bench (158 PRs, 50 repos, 10 languages)
- High/Critical recall: 48.3% (comparable to GPT-5.2's 47.1%)
- High/Critical + Medium recall: 78.2%
- Entity coverage: 81.7%
- Risk distribution: 9.5% High/Critical, 9.5% Medium, 81.1% Low
- Per-language: C# 78%, TypeScript 70%, Java 62%, Python 53%, Go 47%, PHP 40%, Rust 36%

### Greptile benchmark (20/50 PRs evaluated, 52 golden comments)
- HC recall: 73.1% (beats Augment 55%, Greptile 45%, Cursor 41%, CodeRabbit 43%, Copilot 34%)
- HCM recall: 100% (every golden comment within a flagged entity)
- Keycloak (Java, 10 PRs): 75% HC, 100% HCM
- Discourse (Ruby, 10 PRs): 71% HC, 100% HCM
- Evaluated on Augment's expanded golden comments (not Greptile's original 1-per-PR)

### Common across benchmarks
- No LLM, no API key, runs locally

## Performance

Parallel entity extraction via rayon, zero-allocation BFS, capped graph traversal. Powered by sem-core v0.3.0 with xxHash64, LTO, and cached tree resolution.

Single commit review:
- sem (25 files, 5K entities): 24ms
- weave (80 files, 3K entities): 30ms
- agenthub (130 files, 9K LOC): 49ms
- inspect (50 files): 66ms

Full repo history (inspect bench):
- sem (38 commits, 5,216 entities): 0.87s
- weave (45 commits, 2,854 entities): 1.81s
- agenthub (19 commits, 1,112 entities): 0.56s

## Change Classification (ConGra)

7 categories along 3 dimensions:
1. Text: comments, whitespace, docs
2. Syntax: signatures, types, declarations
3. Functional: logic, behavior
4. Text+Syntax, Text+Functional, Syntax+Functional, Text+Syntax+Functional

## Languages

Rust, TypeScript, TSX, JavaScript, Python, Go, Java, C, C++, Ruby, C#, PHP, Fortran

## Links

- GitHub: https://github.com/Ataraxy-Labs/inspect
- sem (entity extraction): https://github.com/Ataraxy-Labs/sem
- weave (entity merge): https://github.com/Ataraxy-Labs/weave
