repo,pr_number,pr_title,golden_comment,golden_severity,inspect_entity_count,inspect_hc_count,inspect_medium_count,inspect_hc_entities,inspect_hc_entity_content,inspect_medium_entity_content,inspect_all_entities_summary,llm_verdict,llm_reason
keycloak,27,Fixing Re-authentication with passkeys,ConditionalPasskeysEnabled() called without UserModel parameter,Medium,4,1,3,"method::isConditionalPasskeysEnabled (services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java) [Critical, score=0.70]","[Critical] method isConditionalPasskeysEnabled in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
protected boolean isConditionalPasskeysEnabled(UserModel user) {
        return webauthnAuth != null && webauthnAuth.isPasskeysEnabled() && user != null;
    }","[Medium] method challenge in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
@Override
    protected Response challenge(AuthenticationFlowContext context, String error, String field) {
        if (isConditionalPasskeysEnabled(context.getUser())) {
            // setup webauthn data when possible
            webauthnAuth.fillContextForm(context);
        }
        return super.challenge(context, error, field);
    }
---
[Medium] method authenticate in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
@Override
    public void authenticate(AuthenticationFlowContext context) {
        MultivaluedMap<String, String> formData = new MultivaluedHashMap<>();
        String loginHint = context.getAuthenticationSession().getClientNote(OIDCLoginProtocol.LOGIN_HINT_PARAM);

        String rememberMeUsername = AuthenticationManager.getRememberMeUsername(context.getSession());

        if (context.getUser() != null) {
            if (alreadyAuthenticatedUsingPasswordlessCredential(context)) {
           
---
[Medium] class UsernamePasswordForm in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
public class UsernamePasswordForm extends AbstractUsernameFormAuthenticator implements Authenticator {

    protected final WebAuthnConditionalUIAuthenticator webauthnAuth;

    public UsernamePasswordForm() {
        webauthnAuth = null;
    }

    public UsernamePasswordForm(KeycloakSession session) {
        webauthnAuth = new WebAuthnConditionalUIAuthenticator(session, (context) -> createLoginForm(context.form()));
    }

    @Override
    public void action(AuthenticationFlowContext context","isConditionalPasskeysEnabled (Critical), challenge (Medium), authenticate (Medium), UsernamePasswordForm (Medium)",match,'ConditionalPasskeysEnabled' matches HC entity 'isconditionalpasskeysenabled'
keycloak,27,Fixing Re-authentication with passkeys,"With isConditionalPasskeysEnabled(UserModel user) requiring user != null, authenticate(...) will not call webauthnAuth.fillContextForm(context) on the initial login page where context.getUser() is still null, so conditional passkey UI will not be set up for first-time passkey login. Consider whether this should also be enabled when no user has been selected yet so ID-less passkey authentication on the initial login form continues to work.",Medium,4,1,3,"method::isConditionalPasskeysEnabled (services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java) [Critical, score=0.70]","[Critical] method isConditionalPasskeysEnabled in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
protected boolean isConditionalPasskeysEnabled(UserModel user) {
        return webauthnAuth != null && webauthnAuth.isPasskeysEnabled() && user != null;
    }","[Medium] method challenge in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
@Override
    protected Response challenge(AuthenticationFlowContext context, String error, String field) {
        if (isConditionalPasskeysEnabled(context.getUser())) {
            // setup webauthn data when possible
            webauthnAuth.fillContextForm(context);
        }
        return super.challenge(context, error, field);
    }
---
[Medium] method authenticate in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
@Override
    public void authenticate(AuthenticationFlowContext context) {
        MultivaluedMap<String, String> formData = new MultivaluedHashMap<>();
        String loginHint = context.getAuthenticationSession().getClientNote(OIDCLoginProtocol.LOGIN_HINT_PARAM);

        String rememberMeUsername = AuthenticationManager.getRememberMeUsername(context.getSession());

        if (context.getUser() != null) {
            if (alreadyAuthenticatedUsingPasswordlessCredential(context)) {
           
---
[Medium] class UsernamePasswordForm in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
public class UsernamePasswordForm extends AbstractUsernameFormAuthenticator implements Authenticator {

    protected final WebAuthnConditionalUIAuthenticator webauthnAuth;

    public UsernamePasswordForm() {
        webauthnAuth = null;
    }

    public UsernamePasswordForm(KeycloakSession session) {
        webauthnAuth = new WebAuthnConditionalUIAuthenticator(session, (context) -> createLoginForm(context.form()));
    }

    @Override
    public void action(AuthenticationFlowContext context","isConditionalPasskeysEnabled (Critical), challenge (Medium), authenticate (Medium), UsernamePasswordForm (Medium)",match,'conditional' matches HC entity 'isconditionalpasskeysenabled'
keycloak,10,Fix concurrent group access to prevent NullPointerException,Returning null from getSubGroupsCount() violates the GroupModel contract (Javadoc says it never returns null) and may lead to NPEs in callers that expect a non-null count.,Critical,8,3,5,"class::GroupAdapter (model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/GroupAdapter.java) [Critical, score=0.78] | class::GroupUtils (services/src/main/java/org/keycloak/utils/GroupUtils.java) [High, score=0.63] | method::getSubGroupsCount (model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/GroupAdapter.java) [High, score=0.62]","[Critical] class GroupAdapter in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/GroupAdapter.java:
public class GroupAdapter implements GroupModel {

    protected final CachedGroup cached;
    protected final RealmCacheSession cacheSession;
    protected final KeycloakSession keycloakSession;
    protected final RealmModel realm;
    private final Supplier<GroupModel> modelSupplier;
    protected volatile GroupModel updated;

    public GroupAdapter(CachedGroup cached, RealmCacheSession cacheSession, KeycloakSession keycloakSession, RealmModel realm) {
        this.cached = cached;
        this.cacheSession = cacheSession;
        this.keycloakSession = keycloakSession;
        this.realm = realm;
        modelSupplier = new LazyModel<>(this::getGroupModel);
    }

    protected void getDelegateForUpdate() {
        if (updated == null) {
            cacheSession.registerGroupInvalidat
---
[High] class GroupUtils in services/src/main/java/org/keycloak/utils/GroupUtils.java:
public class GroupUtils {

    /**
     * This method takes the provided groups and attempts to load their parents all the way to the root group while maintaining the hierarchy data
     * for each GroupRepresentation object. Each resultant GroupRepresentation object in the stream should contain relevant subgroups to the originally
     * provided groups
     * @param session The active keycloak session
     * @param realm The realm to operate on
     * @param groups The groups that we want to populate the hierarchy for
     * @return A stream of groups that contain all relevant groups from the root down with no extra siblings
     */
    public static Stream<GroupRepresentation> populateGroupHierarchyFromSubGroups(KeycloakSession session, RealmModel realm, Stream<GroupModel> groups, boole
---
[High] method getSubGroupsCount in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/GroupAdapter.java:
@Override
    public Long getSubGroupsCount() {
        if (isUpdated()) return updated.getSubGroupsCount();
        GroupModel model = modelSupplier.get();
        return model == null ? null : model.getSubGroupsCount();
    }","[Medium] method getRealm in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/entities/CachedGroup.java:
@Override
    public String getRealm() {
        return realm;
    }
---
[Medium] class GroupTest in tests/base/src/test/java/org/keycloak/tests/admin/group/GroupTest.java:
@KeycloakIntegrationTest
public class GroupTest extends AbstractGroupTest {

    @InjectRealm(config = GroupTestRealmConfig.class)
    ManagedRealm managedRealm;

    @InjectRunOnServer
    RunOnServerClient runOnServer;

    @InjectAdminClient
    Keycloak adminClient;

    @InjectHttpClient
    CloseableHttpClient httpClient;

    
    @Test
    public void createMultiDeleteMultiReadMulti() {
        // create multiple groups
        List<String> groupUuuids = new ArrayList<>();
        IntStr
---
[Medium] method createMultiDeleteMultiReadMulti in tests/base/src/test/java/org/keycloak/tests/admin/group/GroupTest.java:
@Test
    public void createMultiDeleteMultiReadMulti() {
        // create multiple groups
        List<String> groupUuuids = new ArrayList<>();
        IntStream.range(0, 100).forEach(groupIndex -> {
            GroupRepresentation group = new GroupRepresentation();
            group.setName(""Test Group "" + groupIndex);
            try (Response response = managedRealm.admin().groups().add(group)) {
                boolean created = response.getStatusInfo().getFamily() == Response.Status.Famil
---
[Medium] method groupMatchesSearchOrIsPathElement in services/src/main/java/org/keycloak/utils/GroupUtils.java:
private static boolean groupMatchesSearchOrIsPathElement(GroupModel group, String search) {
        if (StringUtil.isBlank(search)) {
            return true;
        }
        if (group.getName().contains(search)) {
            return true;
        }
        return group.getSubGroupsStream().findAny().isPresent();
    }
---
[Medium] class CachedGroup in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/entities/CachedGroup.java:
public class CachedGroup extends AbstractRevisioned implements InRealm {

    private final String realm;
    private final String name;
    private final String description;
    private final String parentId;
    private final LazyLoader<GroupModel, MultivaluedHashMap<String, String>> attributes;
    private final LazyLoader<GroupModel, Set<String>> roleMappings;
    private final LazyLoader<GroupModel, Set<String>> subGroups;
    private final Type type;

    public CachedGroup(Long revision, ","GroupAdapter (Critical), GroupUtils (High), getSubGroupsCount (High), getRealm (Medium), GroupTest (Medium), createMultiDeleteMultiReadMulti (Medium), groupMatchesSearchOrIsPathElement (Medium), CachedGroup (Medium)",match,'count' matches HC entity 'getsubgroupscount'
keycloak,10,Fix concurrent group access to prevent NullPointerException,"The reader thread isnâ€™t waited for; flipping deletedAll to true and asserting immediately can race and miss exceptions added just after the flag change, making this test flaky.",Medium,8,3,5,"class::GroupAdapter (model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/GroupAdapter.java) [Critical, score=0.78] | class::GroupUtils (services/src/main/java/org/keycloak/utils/GroupUtils.java) [High, score=0.63] | method::getSubGroupsCount (model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/GroupAdapter.java) [High, score=0.62]","[Critical] class GroupAdapter in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/GroupAdapter.java:
public class GroupAdapter implements GroupModel {

    protected final CachedGroup cached;
    protected final RealmCacheSession cacheSession;
    protected final KeycloakSession keycloakSession;
    protected final RealmModel realm;
    private final Supplier<GroupModel> modelSupplier;
    protected volatile GroupModel updated;

    public GroupAdapter(CachedGroup cached, RealmCacheSession cacheSession, KeycloakSession keycloakSession, RealmModel realm) {
        this.cached = cached;
        this.cacheSession = cacheSession;
        this.keycloakSession = keycloakSession;
        this.realm = realm;
        modelSupplier = new LazyModel<>(this::getGroupModel);
    }

    protected void getDelegateForUpdate() {
        if (updated == null) {
            cacheSession.registerGroupInvalidat
---
[High] class GroupUtils in services/src/main/java/org/keycloak/utils/GroupUtils.java:
public class GroupUtils {

    /**
     * This method takes the provided groups and attempts to load their parents all the way to the root group while maintaining the hierarchy data
     * for each GroupRepresentation object. Each resultant GroupRepresentation object in the stream should contain relevant subgroups to the originally
     * provided groups
     * @param session The active keycloak session
     * @param realm The realm to operate on
     * @param groups The groups that we want to populate the hierarchy for
     * @return A stream of groups that contain all relevant groups from the root down with no extra siblings
     */
    public static Stream<GroupRepresentation> populateGroupHierarchyFromSubGroups(KeycloakSession session, RealmModel realm, Stream<GroupModel> groups, boole
---
[High] method getSubGroupsCount in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/GroupAdapter.java:
@Override
    public Long getSubGroupsCount() {
        if (isUpdated()) return updated.getSubGroupsCount();
        GroupModel model = modelSupplier.get();
        return model == null ? null : model.getSubGroupsCount();
    }","[Medium] method getRealm in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/entities/CachedGroup.java:
@Override
    public String getRealm() {
        return realm;
    }
---
[Medium] class GroupTest in tests/base/src/test/java/org/keycloak/tests/admin/group/GroupTest.java:
@KeycloakIntegrationTest
public class GroupTest extends AbstractGroupTest {

    @InjectRealm(config = GroupTestRealmConfig.class)
    ManagedRealm managedRealm;

    @InjectRunOnServer
    RunOnServerClient runOnServer;

    @InjectAdminClient
    Keycloak adminClient;

    @InjectHttpClient
    CloseableHttpClient httpClient;

    
    @Test
    public void createMultiDeleteMultiReadMulti() {
        // create multiple groups
        List<String> groupUuuids = new ArrayList<>();
        IntStr
---
[Medium] method createMultiDeleteMultiReadMulti in tests/base/src/test/java/org/keycloak/tests/admin/group/GroupTest.java:
@Test
    public void createMultiDeleteMultiReadMulti() {
        // create multiple groups
        List<String> groupUuuids = new ArrayList<>();
        IntStream.range(0, 100).forEach(groupIndex -> {
            GroupRepresentation group = new GroupRepresentation();
            group.setName(""Test Group "" + groupIndex);
            try (Response response = managedRealm.admin().groups().add(group)) {
                boolean created = response.getStatusInfo().getFamily() == Response.Status.Famil
---
[Medium] method groupMatchesSearchOrIsPathElement in services/src/main/java/org/keycloak/utils/GroupUtils.java:
private static boolean groupMatchesSearchOrIsPathElement(GroupModel group, String search) {
        if (StringUtil.isBlank(search)) {
            return true;
        }
        if (group.getName().contains(search)) {
            return true;
        }
        return group.getSubGroupsStream().findAny().isPresent();
    }
---
[Medium] class CachedGroup in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/entities/CachedGroup.java:
public class CachedGroup extends AbstractRevisioned implements InRealm {

    private final String realm;
    private final String name;
    private final String description;
    private final String parentId;
    private final LazyLoader<GroupModel, MultivaluedHashMap<String, String>> attributes;
    private final LazyLoader<GroupModel, Set<String>> roleMappings;
    private final LazyLoader<GroupModel, Set<String>> subGroups;
    private final Type type;

    public CachedGroup(Long revision, ","GroupAdapter (Critical), GroupUtils (High), getSubGroupsCount (High), getRealm (Medium), GroupTest (Medium), createMultiDeleteMultiReadMulti (Medium), groupMatchesSearchOrIsPathElement (Medium), CachedGroup (Medium)",partial,"test race condition in createMultiDeleteMultiReadMulti (Medium), not specifically about reader thread"
keycloak,9,Implement recovery key support for user storage providers,Unsafe raw List deserialization without type safety. Calling Optional.get() directly on the Optional returned by RecoveryAuthnCodesUtils.getCredential(user) without checking isPresent() can lead to a NoSuchElementException if the Optional is empty.,Medium,33,8,21,"class::RecoveryAuthnCodesUtils (server-spi/src/main/java/org/keycloak/models/utils/RecoveryAuthnCodesUtils.java) [Critical, score=0.90] | class::CredentialHelper (server-spi-private/src/main/java/org/keycloak/utils/CredentialHelper.java) [Critical, score=0.86] | field::CredentialModel (testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java) [High, score=0.68] | class::MyUser (testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java) [High, score=0.64] | class::BackwardsCompatibilityUserStorage (testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java) [High, score=0.60] | class::RecoveryAuthnCodesFormAuthenticator (services/src/main/java/org/keycloak/authentication/authenticators/browser/RecoveryAuthnCodesFormAuthenticator.java) [High, score=0.60] | class::BackwardsCompatibilityUserStorageFactory (testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorageFactory.java) [High, score=0.60] | method::createRecoveryCodesCredential (server-spi-private/src/main/java/org/keycloak/utils/CredentialHelper.java) [High, score=0.56]","[Critical] class RecoveryAuthnCodesUtils in server-spi/src/main/java/org/keycloak/models/utils/RecoveryAuthnCodesUtils.java:
public class RecoveryAuthnCodesUtils {

    private static final int QUANTITY_OF_CODES_TO_GENERATE = 12;
    private static final int CODE_LENGTH = 12;
    public static final char[] UPPERNUM = ""ABCDEFGHIJKLMNPQRSTUVWXYZ123456789"".toCharArray();
    private static final SecretGenerator SECRET_GENERATOR = SecretGenerator.getInstance();
    public static final String NOM_ALGORITHM_TO_HASH = Algorithm.RS512;
    public static final int NUM_HASH_ITERATIONS = 1;
    public static final String RECOVERY_AUTHN_CODES_INPUT_DEFAULT_ERROR_MESSAGE = ""recovery-codes-error-invalid"";
    public static final String FIELD_RECOVERY_CODE_IN_BROWSER_FLOW = ""recoveryCodeInput"";

    public static String hashRawCode(String rawGeneratedCode) {
        Objects.requireNonNull(rawGeneratedCode, ""rawGeneratedCode ca
---
[Critical] class CredentialHelper in server-spi-private/src/main/java/org/keycloak/utils/CredentialHelper.java:
public class CredentialHelper {

    private static final Logger logger = Logger.getLogger(CredentialHelper.class);

    public static void setOrReplaceAuthenticationRequirement(KeycloakSession session, RealmModel realm, String type, AuthenticationExecutionModel.Requirement requirement, AuthenticationExecutionModel.Requirement currentRequirement) {
        realm.getAuthenticationFlowsStream().forEach(flow -> realm.getAuthenticationExecutionsStream(flow.getId())
                .filter(exe -> {
                    ConfigurableAuthenticatorFactory factory = getConfigurableAuthenticatorFactory(session, exe.getAuthenticator());
                    return Objects.nonNull(factory) && Objects.equals(type, factory.getReferenceCategory());
                })
                .filter(exe -> {
       
---
[High] field CredentialModel in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
private CredentialModel recoveryCodes;
---
[High] class MyUser in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
static class MyUser {

        private String username;
        private CredentialModel hashedPassword;
        private CredentialModel otp;
        private CredentialModel recoveryCodes;

        private MyUser(String username) {
            this.username = username;
        }

        public CredentialModel getOtp() {
            return otp;
        }

        public CredentialModel getRecoveryCodes() {
            return recoveryCodes;
        }
    }
---
[High] class BackwardsCompatibilityUserStorage in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
public class BackwardsCompatibilityUserStorage implements UserLookupProvider, UserStorageProvider, UserRegistrationProvider,
        CredentialInputUpdater, CredentialInputValidator, UserQueryProvider {

    private static final Logger log = Logger.getLogger(BackwardsCompatibilityUserStorage.class);

    protected final Map<String, MyUser> users;
    protected final ComponentModel model;
    protected final KeycloakSession session;

    public BackwardsCompatibilityUserStorage(KeycloakSession session, ComponentModel model, Map<String, MyUser> users) {
        this.session = session;
        this.model = model;
        this.users = users;
    }

    private static String translateUserName(String userName) {
        return userName == null ? null : userName.toLowerCase();
    }

    @Overrid
---
[High] class RecoveryAuthnCodesFormAuthenticator in services/src/main/java/org/keycloak/authentication/authenticators/browser/RecoveryAuthnCodesFormAuthenticator.java:
public class RecoveryAuthnCodesFormAuthenticator implements Authenticator {

    public static final String GENERATED_RECOVERY_AUTHN_CODES_NOTE = ""RecoveryAuthnCodes.generatedRecoveryAuthnCodes"";
    public static final String GENERATED_AT_NOTE = ""RecoveryAuthnCodes.generatedAt"";

    public RecoveryAuthnCodesFormAuthenticator(KeycloakSession keycloakSession) {
    }

    @Override
    public void authenticate(AuthenticationFlowContext context) {
        context.challenge(createLoginForm(context, false, null, null));
    }

    @Override
    public void action(AuthenticationFlowContext context) {
        context.getEvent().detail(Details.CREDENTIAL_TYPE, RecoveryAuthnCodesCredentialModel.TYPE)
                .user(context.getUser());
        if (isRecoveryAuthnCodeInputValid(context)) {
 
---
[High] class BackwardsCompatibilityUserStorageFactory in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorageFactory.java:
public class BackwardsCompatibilityUserStorageFactory implements UserStorageProviderFactory<BackwardsCompatibilityUserStorage> {

    public static final String PROVIDER_ID = ""backwards-compatibility-storage"";

    private final Map<String, BackwardsCompatibilityUserStorage.MyUser> userPasswords = new ConcurrentHashMap<>();

    @Override
    public BackwardsCompatibilityUserStorage create(KeycloakSession session, ComponentModel model) {
        return new BackwardsCompatibilityUserStorage(session, model, userPasswords);
    }

    @Override
    public String getId() {
        return PROVIDER_ID;
    }

    public boolean hasUserOTP(String username) {
        BackwardsCompatibilityUserStorage.MyUser user = userPasswords.get(username);
        if (user == null) return false;
        return 
---
[High] method createRecoveryCodesCredential in server-spi-private/src/main/java/org/keycloak/utils/CredentialHelper.java:
public static void createRecoveryCodesCredential(KeycloakSession session, RealmModel realm, UserModel user, RecoveryAuthnCodesCredentialModel credentialModel, List<String> generatedCodes) {
        var recoveryCodeCredentialProvider = session.getProvider(CredentialProvider.class, ""keycloak-recovery-authn-codes"");
        String recoveryCodesJson;
        try {
            recoveryCodesJson =  JsonSerialization.writeValueAsString(generatedCodes);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        UserCredentialModel recoveryCodesCredential = new UserCredentialModel("""", credentialModel.getType(), recoveryCodesJson);

        boolean userStorageCreated = user.credentialManager().updateCredential(recoveryCodesCredential);
        if (userStorageCreat","[Medium] method getRecoveryCodes in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
public CredentialModel getRecoveryCodes() {
            return recoveryCodes;
        }
---
[Medium] method isRecoveryAuthnCodeInputValid in services/src/main/java/org/keycloak/authentication/authenticators/browser/RecoveryAuthnCodesFormAuthenticator.java:
private boolean isRecoveryAuthnCodeInputValid(AuthenticationFlowContext authnFlowContext) {
        boolean result = false;
        MultivaluedMap<String, String> formParamsMap = authnFlowContext.getHttpRequest().getDecodedFormParameters();
        String recoveryAuthnCodeUserInput = formParamsMap.getFirst(RecoveryAuthnCodesUtils.FIELD_RECOVERY_CODE_IN_BROWSER_FLOW);

        UserModel authenticatedUser = authnFlowContext.getUser();
        boolean disabledByBruteForce = isDisabledByBruteForce(a
---
[Medium] class RecoveryAuthnCodeInputLoginBean in services/src/main/java/org/keycloak/forms/login/freemarker/model/RecoveryAuthnCodeInputLoginBean.java:
public class RecoveryAuthnCodeInputLoginBean {

    private final int codeNumber;

    public RecoveryAuthnCodeInputLoginBean(KeycloakSession session, RealmModel realm, UserModel user) {
        Optional<CredentialModel> credentialModelOpt = RecoveryAuthnCodesUtils.getCredential(user);

        RecoveryAuthnCodesCredentialModel recoveryCodeCredentialModel = RecoveryAuthnCodesCredentialModel.createFromCredentialModel(credentialModelOpt.get());

        this.codeNumber = recoveryCodeCredentialMode
---
[Medium] class RecoveryAuthnCodesAction in services/src/main/java/org/keycloak/authentication/requiredactions/RecoveryAuthnCodesAction.java:
public class RecoveryAuthnCodesAction implements RequiredActionProvider, RequiredActionFactory, EnvironmentDependentProviderFactory, CredentialRegistrator {

    private static final String FIELD_GENERATED_RECOVERY_AUTHN_CODES_HIDDEN = ""generatedRecoveryAuthnCodes"";
    private static final String FIELD_GENERATED_AT_HIDDEN = ""generatedAt"";
    private static final String FIELD_USER_LABEL_HIDDEN = ""userLabel"";
    public static final String PROVIDER_ID = UserModel.RequiredAction.CONFIGURE_RECOVER
---
[Medium] method getCredential in server-spi/src/main/java/org/keycloak/models/utils/RecoveryAuthnCodesUtils.java:
public static Optional<CredentialModel> getCredential(UserModel user) {
        return user.credentialManager()
                .getFederatedCredentialsStream()
                .filter(c -> RecoveryAuthnCodesCredentialModel.TYPE.equals(c.getType()))
                .findFirst()
                .or(() -> user.credentialManager().getStoredCredentialsByTypeStream(RecoveryAuthnCodesCredentialModel.TYPE).findFirst());
    }
---
[Medium] method hasRecoveryCodes in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorageFactory.java:
public boolean hasRecoveryCodes(String username) {
        BackwardsCompatibilityUserStorage.MyUser user = userPasswords.get(username);
        if (user == null) return false;
        return user.getRecoveryCodes() != null;
    }
---
[Medium] method isValid in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public boolean isValid(RealmModel realm, UserModel user, CredentialInput input) {
        MyUser myUser = users.get(translateUserName(user.getUsername()));
        if (myUser == null) return false;

        if (input.getType().equals(UserCredentialModel.PASSWORD)) {
            if (!(input instanceof PasswordUserCredentialModel)) return false;
            CredentialModel hashedPassword = myUser.hashedPassword;
            if (hashedPassword == null) {
                log.warnf(""Pas
---
[Medium] method updateCredential in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public boolean updateCredential(RealmModel realm, UserModel user, CredentialInput input) {
        if (!(input instanceof UserCredentialModel)) return false;

        if (input.getType().equals(UserCredentialModel.PASSWORD)) {

            // Compatibility with 4.8.3 - Using ""legacy"" type PasswordUserCredentialModel
            if (!(input instanceof PasswordUserCredentialModel)) {
                log.warn(""Input is not PasswordUserCredentialModel"");
                return false;
 
---
[Medium] method isConfiguredFor in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public boolean isConfiguredFor(RealmModel realm, UserModel user, String credentialType) {
        // Always assume that password is supported
        if (CredentialModel.PASSWORD.equals(credentialType)) return true;
        MyUser myUser = getMyUser(user);
        if (myUser == null) return false;

        if (isOTPType(credentialType) && myUser.otp != null) {
            return true;
        } else if (credentialType.equals(RecoveryAuthnCodesCredentialModel.TYPE) && myUser.recover
---
[Medium] method supportsCredentialType in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public boolean supportsCredentialType(String credentialType) {
        if (CredentialModel.PASSWORD.equals(credentialType)
                || isOTPType(credentialType)
                || credentialType.equals(RecoveryAuthnCodesCredentialModel.TYPE)) {
            return true;
        } else {
            log.infof(""Unsupported credential type: %s"", credentialType);
            return false;
        }
    }
---
[Medium] method processAction in services/src/main/java/org/keycloak/authentication/requiredactions/RecoveryAuthnCodesAction.java:
@Override
    public void processAction(RequiredActionContext reqActionContext) {
        EventBuilder event = reqActionContext.getEvent();
        event.event(EventType.UPDATE_CREDENTIAL);
        MultivaluedMap<String, String> httpReqParamsMap;

        event.detail(Details.CREDENTIAL_TYPE, RecoveryAuthnCodesCredentialModel.TYPE);

        httpReqParamsMap = reqActionContext.getHttpRequest().getDecodedFormParameters();
        final String generatedCodesString = httpReqParamsMap.getFirst(FIELD
---
[Medium] field EnterRecoveryAuthnCodePage in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
@Page
    protected EnterRecoveryAuthnCodePage enterRecoveryAuthnCodePage;
---
[Medium] method configureBrowserFlowWithRecoveryAuthnCodes in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
void configureBrowserFlowWithRecoveryAuthnCodes(KeycloakTestingClient testingClient, long delay) {
        final String newFlowAlias = BROWSER_FLOW_WITH_RECOVERY_AUTHN_CODES;
        testingClient.server(""test"").run(session -> FlowUtil.inCurrentRealm(session).copyBrowserFlow(newFlowAlias));
        testingClient.server(""test"").run(session -> FlowUtil.inCurrentRealm(session)
                .selectFlow(newFlowAlias)
                .inForms(forms -> forms
                        .clear()
        
---
[Medium] method setupRecoveryKeysForUserWithRequiredAction in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
private List<String> setupRecoveryKeysForUserWithRequiredAction(String userId, boolean logoutOtherSessions) throws URISyntaxException, IOException {
        // Add required action to the user to reset RecoveryKeys
        UserResource user = testRealm().users().get(userId);
        UserRepresentation userRep = user.toRepresentation();
        userRep.setRequiredActions(Arrays.asList(UserModel.RequiredAction.CONFIGURE_RECOVERY_AUTHN_CODES.name()));
        user.update(userRep);

        TestAppHe
---
[Medium] method assertUserHasRecoveryKeysCredentialInUserStorage in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
private void assertUserHasRecoveryKeysCredentialInUserStorage(boolean expectedUserHasRecoveryKeys) {
        boolean hasRecoveryKeys = testingClient.server().fetch(session -> {
            BackwardsCompatibilityUserStorageFactory storageFactory = (BackwardsCompatibilityUserStorageFactory) session.getKeycloakSessionFactory()
                    .getProviderFactory(UserStorageProvider.class, BackwardsCompatibilityUserStorageFactory.PROVIDER_ID);
            return storageFactory.hasRecoveryCodes(""
---
[Medium] method enterRecoveryCodes in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
private void enterRecoveryCodes(EnterRecoveryAuthnCodePage enterRecoveryAuthnCodePage, WebDriver driver,
                                    int expectedCode, List<String> generatedRecoveryAuthnCodes) {
        enterRecoveryAuthnCodePage.setDriver(driver);
        enterRecoveryAuthnCodePage.assertCurrent();
        int requestedCode = enterRecoveryAuthnCodePage.getRecoveryAuthnCodeToEnterNumber();
        org.junit.Assert.assertEquals(""Incorrect code presented to login"", expectedCode, requestedC
---
[Medium] class BackwardsCompatibilityUserStorageTest in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
@EnableFeature(value = RECOVERY_CODES, skipRestart = true)
public class BackwardsCompatibilityUserStorageTest extends AbstractTestRealmKeycloakTest {

    private static final String BROWSER_FLOW_WITH_RECOVERY_AUTHN_CODES = ""Browser with Recovery Authentication Codes"";

    private String backwardsCompProviderId;

    @Page
    protected AppPage appPage;

    @Page
    protected LoginPage loginPage;

    @Page
    protected LoginTotpPage loginTotpPage;

    @Page
    protected LoginConfigTotpPag
---
[Medium] method getCredentials in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public Stream<CredentialModel> getCredentials(RealmModel realm, UserModel user) {
        var myUser = getMyUser(user);
        RecoveryAuthnCodesCredentialModel model;
        List<CredentialModel> credentialModels = new ArrayList<>();
        if (myUser.recoveryCodes != null) {
            try {
                model = RecoveryAuthnCodesCredentialModel.createFromValues(
                        JsonSerialization.readValue(myUser.recoveryCodes.getCredentialData(), List.class),
    
---
[Medium] field SetupRecoveryAuthnCodesPage in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
@Page
    protected SetupRecoveryAuthnCodesPage setupRecoveryAuthnCodesPage;
---
[Medium] method testRecoveryKeysSetupAndLogin in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
@Test
    public void testRecoveryKeysSetupAndLogin() throws URISyntaxException, IOException {
        try {
            configureBrowserFlowWithRecoveryAuthnCodes(testingClient, 0);

            String userId = addUserAndResetPassword(""otp1"", ""pass"");
            getCleanup().addUserId(userId);

            // Setup RecoveryKeys
            List<String> recoveryKeys = setupRecoveryKeysForUserWithRequiredAction(userId, true);

            // Assert user has RecoveryKeys in the userStorage
      
---
[Medium] constructor RecoveryAuthnCodeInputLoginBean in services/src/main/java/org/keycloak/forms/login/freemarker/model/RecoveryAuthnCodeInputLoginBean.java:
public RecoveryAuthnCodeInputLoginBean(KeycloakSession session, RealmModel realm, UserModel user) {
        Optional<CredentialModel> credentialModelOpt = RecoveryAuthnCodesUtils.getCredential(user);

        RecoveryAuthnCodesCredentialModel recoveryCodeCredentialModel = RecoveryAuthnCodesCredentialModel.createFromCredentialModel(credentialModelOpt.get());

        this.codeNumber = recoveryCodeCredentialModel.getNextRecoveryAuthnCode().get().getNumber();
    }","RecoveryAuthnCodesUtils (Critical), CredentialHelper (Critical), CredentialModel (High), MyUser (High), BackwardsCompatibilityUserStorage (High), RecoveryAuthnCodesFormAuthenticator (High), BackwardsCompatibilityUserStorageFactory (High), createRecoveryCodesCredential (High), getRecoveryCodes (Medium), isRecoveryAuthnCodeInputValid (Medium), RecoveryAuthnCodeInputLoginBean (Medium), RecoveryAuthnCodesAction (Medium), getCredential (Medium), hasRecoveryCodes (Medium), isValid (Medium), updateCredential (Medium), isConfiguredFor (Medium), supportsCredentialType (Medium), processAction (Medium), EnterRecoveryAuthnCodePage (Medium), configureBrowserFlowWithRecoveryAuthnCodes (Medium), setupRecoveryKeysForUserWithRequiredAction (Medium), assertUserHasRecoveryKeysCredentialInUserStorage (Medium), enterRecoveryCodes (Medium), BackwardsCompatibilityUserStorageTest (Medium), getCredentials (Medium), SetupRecoveryAuthnCodesPage (Medium), testRecoveryKeysSetupAndLogin (Medium), RecoveryAuthnCodeInputLoginBean (Medium), getConfigurableAuthenticatorFactory (Low), createUser (Low), getOtpCredentialFromAccountREST (Low), testOTPSetupAndRemoveThroughAccountMgmtAndLogin (Low)",match,'RecoveryAuthnCodesUtils.getCredential' matches HC entity 'recoveryauthncodesutils'
keycloak,9,Implement recovery key support for user storage providers,"After creating the RecoveryAuthnCodesCredentialModel, consider setting its id from the stored credential (e.g., myUser.recoveryCodes.getId()); otherwise getId() will be null and downstream removal by id (e.g., removeStoredCredentialById in the authenticator flow) may not work.",Low,33,8,21,"class::RecoveryAuthnCodesUtils (server-spi/src/main/java/org/keycloak/models/utils/RecoveryAuthnCodesUtils.java) [Critical, score=0.90] | class::CredentialHelper (server-spi-private/src/main/java/org/keycloak/utils/CredentialHelper.java) [Critical, score=0.86] | field::CredentialModel (testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java) [High, score=0.68] | class::MyUser (testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java) [High, score=0.64] | class::BackwardsCompatibilityUserStorage (testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java) [High, score=0.60] | class::RecoveryAuthnCodesFormAuthenticator (services/src/main/java/org/keycloak/authentication/authenticators/browser/RecoveryAuthnCodesFormAuthenticator.java) [High, score=0.60] | class::BackwardsCompatibilityUserStorageFactory (testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorageFactory.java) [High, score=0.60] | method::createRecoveryCodesCredential (server-spi-private/src/main/java/org/keycloak/utils/CredentialHelper.java) [High, score=0.56]","[Critical] class RecoveryAuthnCodesUtils in server-spi/src/main/java/org/keycloak/models/utils/RecoveryAuthnCodesUtils.java:
public class RecoveryAuthnCodesUtils {

    private static final int QUANTITY_OF_CODES_TO_GENERATE = 12;
    private static final int CODE_LENGTH = 12;
    public static final char[] UPPERNUM = ""ABCDEFGHIJKLMNPQRSTUVWXYZ123456789"".toCharArray();
    private static final SecretGenerator SECRET_GENERATOR = SecretGenerator.getInstance();
    public static final String NOM_ALGORITHM_TO_HASH = Algorithm.RS512;
    public static final int NUM_HASH_ITERATIONS = 1;
    public static final String RECOVERY_AUTHN_CODES_INPUT_DEFAULT_ERROR_MESSAGE = ""recovery-codes-error-invalid"";
    public static final String FIELD_RECOVERY_CODE_IN_BROWSER_FLOW = ""recoveryCodeInput"";

    public static String hashRawCode(String rawGeneratedCode) {
        Objects.requireNonNull(rawGeneratedCode, ""rawGeneratedCode ca
---
[Critical] class CredentialHelper in server-spi-private/src/main/java/org/keycloak/utils/CredentialHelper.java:
public class CredentialHelper {

    private static final Logger logger = Logger.getLogger(CredentialHelper.class);

    public static void setOrReplaceAuthenticationRequirement(KeycloakSession session, RealmModel realm, String type, AuthenticationExecutionModel.Requirement requirement, AuthenticationExecutionModel.Requirement currentRequirement) {
        realm.getAuthenticationFlowsStream().forEach(flow -> realm.getAuthenticationExecutionsStream(flow.getId())
                .filter(exe -> {
                    ConfigurableAuthenticatorFactory factory = getConfigurableAuthenticatorFactory(session, exe.getAuthenticator());
                    return Objects.nonNull(factory) && Objects.equals(type, factory.getReferenceCategory());
                })
                .filter(exe -> {
       
---
[High] field CredentialModel in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
private CredentialModel recoveryCodes;
---
[High] class MyUser in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
static class MyUser {

        private String username;
        private CredentialModel hashedPassword;
        private CredentialModel otp;
        private CredentialModel recoveryCodes;

        private MyUser(String username) {
            this.username = username;
        }

        public CredentialModel getOtp() {
            return otp;
        }

        public CredentialModel getRecoveryCodes() {
            return recoveryCodes;
        }
    }
---
[High] class BackwardsCompatibilityUserStorage in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
public class BackwardsCompatibilityUserStorage implements UserLookupProvider, UserStorageProvider, UserRegistrationProvider,
        CredentialInputUpdater, CredentialInputValidator, UserQueryProvider {

    private static final Logger log = Logger.getLogger(BackwardsCompatibilityUserStorage.class);

    protected final Map<String, MyUser> users;
    protected final ComponentModel model;
    protected final KeycloakSession session;

    public BackwardsCompatibilityUserStorage(KeycloakSession session, ComponentModel model, Map<String, MyUser> users) {
        this.session = session;
        this.model = model;
        this.users = users;
    }

    private static String translateUserName(String userName) {
        return userName == null ? null : userName.toLowerCase();
    }

    @Overrid
---
[High] class RecoveryAuthnCodesFormAuthenticator in services/src/main/java/org/keycloak/authentication/authenticators/browser/RecoveryAuthnCodesFormAuthenticator.java:
public class RecoveryAuthnCodesFormAuthenticator implements Authenticator {

    public static final String GENERATED_RECOVERY_AUTHN_CODES_NOTE = ""RecoveryAuthnCodes.generatedRecoveryAuthnCodes"";
    public static final String GENERATED_AT_NOTE = ""RecoveryAuthnCodes.generatedAt"";

    public RecoveryAuthnCodesFormAuthenticator(KeycloakSession keycloakSession) {
    }

    @Override
    public void authenticate(AuthenticationFlowContext context) {
        context.challenge(createLoginForm(context, false, null, null));
    }

    @Override
    public void action(AuthenticationFlowContext context) {
        context.getEvent().detail(Details.CREDENTIAL_TYPE, RecoveryAuthnCodesCredentialModel.TYPE)
                .user(context.getUser());
        if (isRecoveryAuthnCodeInputValid(context)) {
 
---
[High] class BackwardsCompatibilityUserStorageFactory in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorageFactory.java:
public class BackwardsCompatibilityUserStorageFactory implements UserStorageProviderFactory<BackwardsCompatibilityUserStorage> {

    public static final String PROVIDER_ID = ""backwards-compatibility-storage"";

    private final Map<String, BackwardsCompatibilityUserStorage.MyUser> userPasswords = new ConcurrentHashMap<>();

    @Override
    public BackwardsCompatibilityUserStorage create(KeycloakSession session, ComponentModel model) {
        return new BackwardsCompatibilityUserStorage(session, model, userPasswords);
    }

    @Override
    public String getId() {
        return PROVIDER_ID;
    }

    public boolean hasUserOTP(String username) {
        BackwardsCompatibilityUserStorage.MyUser user = userPasswords.get(username);
        if (user == null) return false;
        return 
---
[High] method createRecoveryCodesCredential in server-spi-private/src/main/java/org/keycloak/utils/CredentialHelper.java:
public static void createRecoveryCodesCredential(KeycloakSession session, RealmModel realm, UserModel user, RecoveryAuthnCodesCredentialModel credentialModel, List<String> generatedCodes) {
        var recoveryCodeCredentialProvider = session.getProvider(CredentialProvider.class, ""keycloak-recovery-authn-codes"");
        String recoveryCodesJson;
        try {
            recoveryCodesJson =  JsonSerialization.writeValueAsString(generatedCodes);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
        UserCredentialModel recoveryCodesCredential = new UserCredentialModel("""", credentialModel.getType(), recoveryCodesJson);

        boolean userStorageCreated = user.credentialManager().updateCredential(recoveryCodesCredential);
        if (userStorageCreat","[Medium] method getRecoveryCodes in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
public CredentialModel getRecoveryCodes() {
            return recoveryCodes;
        }
---
[Medium] method isRecoveryAuthnCodeInputValid in services/src/main/java/org/keycloak/authentication/authenticators/browser/RecoveryAuthnCodesFormAuthenticator.java:
private boolean isRecoveryAuthnCodeInputValid(AuthenticationFlowContext authnFlowContext) {
        boolean result = false;
        MultivaluedMap<String, String> formParamsMap = authnFlowContext.getHttpRequest().getDecodedFormParameters();
        String recoveryAuthnCodeUserInput = formParamsMap.getFirst(RecoveryAuthnCodesUtils.FIELD_RECOVERY_CODE_IN_BROWSER_FLOW);

        UserModel authenticatedUser = authnFlowContext.getUser();
        boolean disabledByBruteForce = isDisabledByBruteForce(a
---
[Medium] class RecoveryAuthnCodeInputLoginBean in services/src/main/java/org/keycloak/forms/login/freemarker/model/RecoveryAuthnCodeInputLoginBean.java:
public class RecoveryAuthnCodeInputLoginBean {

    private final int codeNumber;

    public RecoveryAuthnCodeInputLoginBean(KeycloakSession session, RealmModel realm, UserModel user) {
        Optional<CredentialModel> credentialModelOpt = RecoveryAuthnCodesUtils.getCredential(user);

        RecoveryAuthnCodesCredentialModel recoveryCodeCredentialModel = RecoveryAuthnCodesCredentialModel.createFromCredentialModel(credentialModelOpt.get());

        this.codeNumber = recoveryCodeCredentialMode
---
[Medium] class RecoveryAuthnCodesAction in services/src/main/java/org/keycloak/authentication/requiredactions/RecoveryAuthnCodesAction.java:
public class RecoveryAuthnCodesAction implements RequiredActionProvider, RequiredActionFactory, EnvironmentDependentProviderFactory, CredentialRegistrator {

    private static final String FIELD_GENERATED_RECOVERY_AUTHN_CODES_HIDDEN = ""generatedRecoveryAuthnCodes"";
    private static final String FIELD_GENERATED_AT_HIDDEN = ""generatedAt"";
    private static final String FIELD_USER_LABEL_HIDDEN = ""userLabel"";
    public static final String PROVIDER_ID = UserModel.RequiredAction.CONFIGURE_RECOVER
---
[Medium] method getCredential in server-spi/src/main/java/org/keycloak/models/utils/RecoveryAuthnCodesUtils.java:
public static Optional<CredentialModel> getCredential(UserModel user) {
        return user.credentialManager()
                .getFederatedCredentialsStream()
                .filter(c -> RecoveryAuthnCodesCredentialModel.TYPE.equals(c.getType()))
                .findFirst()
                .or(() -> user.credentialManager().getStoredCredentialsByTypeStream(RecoveryAuthnCodesCredentialModel.TYPE).findFirst());
    }
---
[Medium] method hasRecoveryCodes in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorageFactory.java:
public boolean hasRecoveryCodes(String username) {
        BackwardsCompatibilityUserStorage.MyUser user = userPasswords.get(username);
        if (user == null) return false;
        return user.getRecoveryCodes() != null;
    }
---
[Medium] method isValid in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public boolean isValid(RealmModel realm, UserModel user, CredentialInput input) {
        MyUser myUser = users.get(translateUserName(user.getUsername()));
        if (myUser == null) return false;

        if (input.getType().equals(UserCredentialModel.PASSWORD)) {
            if (!(input instanceof PasswordUserCredentialModel)) return false;
            CredentialModel hashedPassword = myUser.hashedPassword;
            if (hashedPassword == null) {
                log.warnf(""Pas
---
[Medium] method updateCredential in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public boolean updateCredential(RealmModel realm, UserModel user, CredentialInput input) {
        if (!(input instanceof UserCredentialModel)) return false;

        if (input.getType().equals(UserCredentialModel.PASSWORD)) {

            // Compatibility with 4.8.3 - Using ""legacy"" type PasswordUserCredentialModel
            if (!(input instanceof PasswordUserCredentialModel)) {
                log.warn(""Input is not PasswordUserCredentialModel"");
                return false;
 
---
[Medium] method isConfiguredFor in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public boolean isConfiguredFor(RealmModel realm, UserModel user, String credentialType) {
        // Always assume that password is supported
        if (CredentialModel.PASSWORD.equals(credentialType)) return true;
        MyUser myUser = getMyUser(user);
        if (myUser == null) return false;

        if (isOTPType(credentialType) && myUser.otp != null) {
            return true;
        } else if (credentialType.equals(RecoveryAuthnCodesCredentialModel.TYPE) && myUser.recover
---
[Medium] method supportsCredentialType in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public boolean supportsCredentialType(String credentialType) {
        if (CredentialModel.PASSWORD.equals(credentialType)
                || isOTPType(credentialType)
                || credentialType.equals(RecoveryAuthnCodesCredentialModel.TYPE)) {
            return true;
        } else {
            log.infof(""Unsupported credential type: %s"", credentialType);
            return false;
        }
    }
---
[Medium] method processAction in services/src/main/java/org/keycloak/authentication/requiredactions/RecoveryAuthnCodesAction.java:
@Override
    public void processAction(RequiredActionContext reqActionContext) {
        EventBuilder event = reqActionContext.getEvent();
        event.event(EventType.UPDATE_CREDENTIAL);
        MultivaluedMap<String, String> httpReqParamsMap;

        event.detail(Details.CREDENTIAL_TYPE, RecoveryAuthnCodesCredentialModel.TYPE);

        httpReqParamsMap = reqActionContext.getHttpRequest().getDecodedFormParameters();
        final String generatedCodesString = httpReqParamsMap.getFirst(FIELD
---
[Medium] field EnterRecoveryAuthnCodePage in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
@Page
    protected EnterRecoveryAuthnCodePage enterRecoveryAuthnCodePage;
---
[Medium] method configureBrowserFlowWithRecoveryAuthnCodes in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
void configureBrowserFlowWithRecoveryAuthnCodes(KeycloakTestingClient testingClient, long delay) {
        final String newFlowAlias = BROWSER_FLOW_WITH_RECOVERY_AUTHN_CODES;
        testingClient.server(""test"").run(session -> FlowUtil.inCurrentRealm(session).copyBrowserFlow(newFlowAlias));
        testingClient.server(""test"").run(session -> FlowUtil.inCurrentRealm(session)
                .selectFlow(newFlowAlias)
                .inForms(forms -> forms
                        .clear()
        
---
[Medium] method setupRecoveryKeysForUserWithRequiredAction in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
private List<String> setupRecoveryKeysForUserWithRequiredAction(String userId, boolean logoutOtherSessions) throws URISyntaxException, IOException {
        // Add required action to the user to reset RecoveryKeys
        UserResource user = testRealm().users().get(userId);
        UserRepresentation userRep = user.toRepresentation();
        userRep.setRequiredActions(Arrays.asList(UserModel.RequiredAction.CONFIGURE_RECOVERY_AUTHN_CODES.name()));
        user.update(userRep);

        TestAppHe
---
[Medium] method assertUserHasRecoveryKeysCredentialInUserStorage in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
private void assertUserHasRecoveryKeysCredentialInUserStorage(boolean expectedUserHasRecoveryKeys) {
        boolean hasRecoveryKeys = testingClient.server().fetch(session -> {
            BackwardsCompatibilityUserStorageFactory storageFactory = (BackwardsCompatibilityUserStorageFactory) session.getKeycloakSessionFactory()
                    .getProviderFactory(UserStorageProvider.class, BackwardsCompatibilityUserStorageFactory.PROVIDER_ID);
            return storageFactory.hasRecoveryCodes(""
---
[Medium] method enterRecoveryCodes in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
private void enterRecoveryCodes(EnterRecoveryAuthnCodePage enterRecoveryAuthnCodePage, WebDriver driver,
                                    int expectedCode, List<String> generatedRecoveryAuthnCodes) {
        enterRecoveryAuthnCodePage.setDriver(driver);
        enterRecoveryAuthnCodePage.assertCurrent();
        int requestedCode = enterRecoveryAuthnCodePage.getRecoveryAuthnCodeToEnterNumber();
        org.junit.Assert.assertEquals(""Incorrect code presented to login"", expectedCode, requestedC
---
[Medium] class BackwardsCompatibilityUserStorageTest in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
@EnableFeature(value = RECOVERY_CODES, skipRestart = true)
public class BackwardsCompatibilityUserStorageTest extends AbstractTestRealmKeycloakTest {

    private static final String BROWSER_FLOW_WITH_RECOVERY_AUTHN_CODES = ""Browser with Recovery Authentication Codes"";

    private String backwardsCompProviderId;

    @Page
    protected AppPage appPage;

    @Page
    protected LoginPage loginPage;

    @Page
    protected LoginTotpPage loginTotpPage;

    @Page
    protected LoginConfigTotpPag
---
[Medium] method getCredentials in testsuite/integration-arquillian/servers/auth-server/services/testsuite-providers/src/main/java/org/keycloak/testsuite/federation/BackwardsCompatibilityUserStorage.java:
@Override
    public Stream<CredentialModel> getCredentials(RealmModel realm, UserModel user) {
        var myUser = getMyUser(user);
        RecoveryAuthnCodesCredentialModel model;
        List<CredentialModel> credentialModels = new ArrayList<>();
        if (myUser.recoveryCodes != null) {
            try {
                model = RecoveryAuthnCodesCredentialModel.createFromValues(
                        JsonSerialization.readValue(myUser.recoveryCodes.getCredentialData(), List.class),
    
---
[Medium] field SetupRecoveryAuthnCodesPage in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
@Page
    protected SetupRecoveryAuthnCodesPage setupRecoveryAuthnCodesPage;
---
[Medium] method testRecoveryKeysSetupAndLogin in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/storage/BackwardsCompatibilityUserStorageTest.java:
@Test
    public void testRecoveryKeysSetupAndLogin() throws URISyntaxException, IOException {
        try {
            configureBrowserFlowWithRecoveryAuthnCodes(testingClient, 0);

            String userId = addUserAndResetPassword(""otp1"", ""pass"");
            getCleanup().addUserId(userId);

            // Setup RecoveryKeys
            List<String> recoveryKeys = setupRecoveryKeysForUserWithRequiredAction(userId, true);

            // Assert user has RecoveryKeys in the userStorage
      
---
[Medium] constructor RecoveryAuthnCodeInputLoginBean in services/src/main/java/org/keycloak/forms/login/freemarker/model/RecoveryAuthnCodeInputLoginBean.java:
public RecoveryAuthnCodeInputLoginBean(KeycloakSession session, RealmModel realm, UserModel user) {
        Optional<CredentialModel> credentialModelOpt = RecoveryAuthnCodesUtils.getCredential(user);

        RecoveryAuthnCodesCredentialModel recoveryCodeCredentialModel = RecoveryAuthnCodesCredentialModel.createFromCredentialModel(credentialModelOpt.get());

        this.codeNumber = recoveryCodeCredentialModel.getNextRecoveryAuthnCode().get().getNumber();
    }","RecoveryAuthnCodesUtils (Critical), CredentialHelper (Critical), CredentialModel (High), MyUser (High), BackwardsCompatibilityUserStorage (High), RecoveryAuthnCodesFormAuthenticator (High), BackwardsCompatibilityUserStorageFactory (High), createRecoveryCodesCredential (High), getRecoveryCodes (Medium), isRecoveryAuthnCodeInputValid (Medium), RecoveryAuthnCodeInputLoginBean (Medium), RecoveryAuthnCodesAction (Medium), getCredential (Medium), hasRecoveryCodes (Medium), isValid (Medium), updateCredential (Medium), isConfiguredFor (Medium), supportsCredentialType (Medium), processAction (Medium), EnterRecoveryAuthnCodePage (Medium), configureBrowserFlowWithRecoveryAuthnCodes (Medium), setupRecoveryKeysForUserWithRequiredAction (Medium), assertUserHasRecoveryKeysCredentialInUserStorage (Medium), enterRecoveryCodes (Medium), BackwardsCompatibilityUserStorageTest (Medium), getCredentials (Medium), SetupRecoveryAuthnCodesPage (Medium), testRecoveryKeysSetupAndLogin (Medium), RecoveryAuthnCodeInputLoginBean (Medium), getConfigurableAuthenticatorFactory (Low), createUser (Low), getOtpCredentialFromAccountREST (Low), testOTPSetupAndRemoveThroughAccountMgmtAndLogin (Low)",match,'authenticator' matches HC entity 'recoveryauthncodesformauthenticator'
keycloak,8,Implement access token context encoding framework,Wrong parameter in null check (grantType vs. rawTokenId),Critical,109,46,42,"interface::OAuth2GrantType (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [Critical, score=1.00] | method::expectRefresh (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=1.00] | method::expectCodeToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=1.00] | interface::OAuth2GrantTypeFactory (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java) [Critical, score=0.94] | class::AccessTokenContext (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [Critical, score=0.94] | class::AbstractOIDCProtocolMapper (services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java) [Critical, score=0.92] | interface::TokenContextEncoderProvider (services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java) [Critical, score=0.89] | class::AssertEvents (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=0.88] | class::PreAuthorizedCodeGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java) [Critical, score=0.84] | method::getSessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [Critical, score=0.81] | method::getTokenContextFromTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [Critical, score=0.77] | class::OAuth2GrantTypeBase (services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java) [Critical, score=0.77] | class::PreAuthorizedCodeGrantType (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java) [Critical, score=0.74] | method::getShouldUseLightweightToken (services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java) [Critical, score=0.74] | method::createTokenResponse (services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java) [Critical, score=0.72] | method::getShortcut (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java) [High, score=0.68] | method::getRawTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.68] | method::encodeTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [High, score=0.68] | method::expectAuthReqIdToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.68] | method::initToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.65] | method::isAccessTokenId (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.62] | method::validateToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.62] | class::Context (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [High, score=0.57] | class::TokenManager (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.57] | method::transformAccessToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.57] | class::AuthorizationCodeGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java) [High, score=0.57] | class::RefreshTokenGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java) [High, score=0.57] | class::CibaGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java) [High, score=0.57] | class::DeviceGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java) [High, score=0.57] | interface::TokenContextEncoderProviderFactory (services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProviderFactory.java) [High, score=0.57] | field::SessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | field::TokenType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | enum::SessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | method::getShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | enum::TokenType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | method::getTokenContextFromClientSessionContext (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [High, score=0.56] | method::getId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getSessionTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getTokenTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getShortcutByGrantType (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getGrantTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getGrantType (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [High, score=0.51] | method::process (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java) [High, score=0.51] | method::expectDeviceCodeToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.51] | class::StandardTokenExchangeProvider (services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java) [High, score=0.51] | class::ResourceOwnerPasswordCredentialsGrantType (services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java) [High, score=0.51]","[Critical] interface OAuth2GrantType in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public interface OAuth2GrantType extends Provider {

    /**
     * Returns the event type associated with this OAuth 2.0 grant type.
     *
     * @return event type
     */
    EventType getEventType();

    /**
     * @return request parameters, which can be duplicated for the particular grant type. The grant request is typically rejected if
     * request contains multiple values of some parameter, which is not listed here
     */
    default Set<String> getSupportedMultivaluedRequestParameters() {
        return Collections.emptySet();
    }

    /**
     * Processes grant request.
     * @param context grant request context
     *
     * @return token response
     */
    Response process(Context context);

    public static class Context {
        protected KeycloakSession session;

---
[Critical] method expectRefresh in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectRefresh(String refreshTokenId, String sessionId) {
        return expect(EventType.REFRESH_TOKEN)
                .detail(Details.TOKEN_ID, isAccessTokenId(RefreshTokenGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, refreshTokenId)
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.UPDATED_REFRESH_TOKEN_ID, isUUID())
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(sessionId);
    }
---
[Critical] method expectCodeToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectCodeToToken(String codeId, String sessionId) {
        return expect(EventType.CODE_TO_TOKEN)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(AuthorizationCodeGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(sessionId);
    }
---
[Critical] interface OAuth2GrantTypeFactory in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java:
public interface OAuth2GrantTypeFactory extends ProviderFactory<OAuth2GrantType> {

    /**
     * @return usually like 3-letters shortcut of specific grants. It can be useful for example in the tokens when the amount of characters should be limited and hence using full grant name
     * is not ideal. Shortcut should be unique across grants.
     */
    String getShortcut();
}
---
[Critical] class AccessTokenContext in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public class AccessTokenContext {

    private final SessionType sessionType;
    private final TokenType tokenType;
    private final String grantType;
    private final String rawTokenId;

    public enum SessionType {
        ONLINE(""on""),
        OFFLINE(""of""),
        TRANSIENT(""tr""),
        UNKNOWN(""un"");

        private final String shortcut;

        SessionType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }

    public enum TokenType {
        REGULAR(""rt""),
        LIGHTWEIGHT(""lt""),
        UNKNOWN(""un"");

        private final String shortcut;

        TokenType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
       
---
[Critical] class AbstractOIDCProtocolMapper in services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java:
public abstract class AbstractOIDCProtocolMapper implements ProtocolMapper {

    public static final String TOKEN_MAPPER_CATEGORY = ""Token mapper"";

    @Override
    public String getProtocol() {
        return OIDCLoginProtocol.LOGIN_PROTOCOL;
    }

    @Override
    public void close() {

    }

    @Override
    public final ProtocolMapper create(KeycloakSession session) {
        throw new RuntimeException(""UNSUPPORTED METHOD"");
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {

    }

    public AccessToken transformUserInfoToken(AccessToken token, ProtocolMapperModel mappingModel, KeycloakSession session,
                                              UserSessionModel userSession, ClientS
---
[Critical] interface TokenContextEncoderProvider in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
public interface TokenContextEncoderProvider extends Provider {

    AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId);

    AccessTokenContext getTokenContextFromTokenId(String encodedTokenId);

    String encodeTokenId(AccessTokenContext tokenContext);
}
---
[Critical] class AssertEvents in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public class AssertEvents implements TestRule {

    public static final String DEFAULT_CLIENT_ID = ""test-app"";
    public static final String DEFAULT_IP_ADDRESS = ""127.0.0.1"";
    public static final String DEFAULT_IP_ADDRESS_V6 = ""0:0:0:0:0:0:0:1"";
    public static final String DEFAULT_IP_ADDRESS_V6_SHORT = ""::1"";
    public static final String DEFAULT_REALM = ""test"";
    public static final String DEFAULT_USERNAME = ""test-user@localhost"";

    public static final String DEFAULT_REDIRECT_URI = getAuthServerContextRoot() + ""/auth/realms/master/app/auth"";

    private AbstractKeycloakTest context;

    public AssertEvents(AbstractKeycloakTest ctx) {
        context = ctx;
    }

    @Override
    public Statement apply(final Statement base, org.junit.runner.Description description) {
    
---
[Critical] class PreAuthorizedCodeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java:
public class PreAuthorizedCodeGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_TYPE = ""urn:ietf:params:oauth:grant-type:pre-authorized_code"";
    public static final String CODE_REQUEST_PARAM = ""pre-authorized_code"";

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new PreAuthorizedCodeGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

    @Override
    public String getId() {
        return GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""pc"";
    }

    @Override
    public boo
---
[Critical] method getSessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public SessionType getSessionType() {
        return sessionType;
    }
---
[Critical] method getTokenContextFromTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public AccessTokenContext getTokenContextFromTokenId(String encodedTokenId) {
        int indexOf = encodedTokenId.indexOf(':');
        if (indexOf == -1) {
            return new AccessTokenContext(AccessTokenContext.SessionType.UNKNOWN, AccessTokenContext.TokenType.UNKNOWN, UNKNOWN, encodedTokenId);
        } else {
            String encodedContext = encodedTokenId.substring(0, indexOf);
            String rawId = encodedTokenId.substring(indexOf + 1);

            if (encodedContext.length() != 6) {
                throw new IllegalArgumentException(""Incorrect token id: '"" + encodedTokenId + ""'. Expected length of 6."");
            }

            // First 2 chars are ""sessionType"", next 2 chars ""tokenType"", last 2 chars ""grantType""
            String stShortcut = encoded
---
[Critical] class OAuth2GrantTypeBase in services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java:
public abstract class OAuth2GrantTypeBase implements OAuth2GrantType {

    private static final Logger logger = Logger.getLogger(OAuth2GrantTypeBase.class);

    protected OAuth2GrantType.Context context;

    protected KeycloakSession session;
    protected RealmModel realm;
    protected ClientModel client;
    protected OIDCAdvancedConfigWrapper clientConfig;
    protected ClientConnection clientConnection;
    protected Map<String, String> clientAuthAttributes;
    protected MultivaluedMap<String, String> formParams;
    protected EventBuilder event;
    protected Cors cors;
    protected TokenManager tokenManager;
    protected HttpRequest request;
    protected HttpResponse response;
    protected HttpHeaders headers;

    protected void setContext(Context context) {
        this.co
---
[Critical] class PreAuthorizedCodeGrantType in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java:
public class PreAuthorizedCodeGrantType extends OAuth2GrantTypeBase {

    private static final Logger LOGGER = Logger.getLogger(PreAuthorizedCodeGrantType.class);

    public static final String VC_ISSUANCE_FLOW = ""VC-Issuance-Flow"";

    @Override
    public Response process(Context context) {
        LOGGER.debug(""Process grant request for preauthorized."");
        setContext(context);

        // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
        String code = formParams.getFirst(PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM);

        if (code == null) {
            // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
            String errorMessage = ""Missing parameter: "" + P
---
[Critical] method getShouldUseLightweightToken in services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java:
public static boolean getShouldUseLightweightToken(KeycloakSession session) {
        Object attributeValue = session.getAttribute(Constants.USE_LIGHTWEIGHT_ACCESS_TOKEN_ENABLED);
        return Boolean.parseBoolean(session.getContext().getClient().getAttribute(Constants.USE_LIGHTWEIGHT_ACCESS_TOKEN_ENABLED)) || (attributeValue != null && (boolean) attributeValue);
    }
---
[Critical] method createTokenResponse in services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java:
protected Response createTokenResponse(UserModel user, UserSessionModel userSession, ClientSessionContext clientSessionCtx,
        String scopeParam, boolean code, Function<TokenManager.AccessTokenResponseBuilder, ClientPolicyContext> clientPolicyContextGenerator) {
        clientSessionCtx.setAttribute(Constants.GRANT_TYPE, context.getGrantType());
        AccessToken token = tokenManager.createClientAccessToken(session, realm, client, user, userSession, clientSessionCtx);

        TokenManager.AccessTokenResponseBuilder responseBuilder = tokenManager
            .responseBuilder(realm, client, event, session, userSession, clientSessionCtx).accessToken(token);
        boolean useRefreshToken = clientConfig.isUseRefreshToken();
        if (useRefreshToken) {
            responseBuilder.ge
---
[High] method getShortcut in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java:
String getShortcut();
---
[High] method getRawTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getRawTokenId() {
        return rawTokenId;
    }
---
[High] method encodeTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public String encodeTokenId(AccessTokenContext tokenContext) {
        if (tokenContext.getSessionType() == AccessTokenContext.SessionType.UNKNOWN) {
            throw new IllegalStateException(""Cannot encode token with unknown sessionType"");
        }
        if (tokenContext.getTokenType() == AccessTokenContext.TokenType.UNKNOWN) {
            throw new IllegalStateException(""Cannot encode token with unknown tokenType"");
        }

        String grantShort = factory.getShortcutByGrantType(tokenContext.getGrantType());
        if (grantShort == null) {
            throw new IllegalStateException(""Cannot encode token with unknown grantType: "" + tokenContext.getGrantType());
        }

        return tokenContext.getSessionType().getShortcut() +
                tokenContext.g
---
[High] method expectAuthReqIdToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectAuthReqIdToToken(String codeId, String sessionId) {
        return expect(EventType.AUTHREQID_TO_TOKEN)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(CibaGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(isUUID());
    }
---
[High] method initToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
protected AccessToken initToken(KeycloakSession session, RealmModel realm, ClientModel client, UserModel user, UserSessionModel userSession,
                                    ClientSessionContext clientSessionCtx, UriInfo uriInfo) {
        AccessToken token = new AccessToken();

        TokenContextEncoderProvider encoder = session.getProvider(TokenContextEncoderProvider.class);
        AccessTokenContext tokenCtx = encoder.getTokenContextFromClientSessionContext(clientSessionCtx, KeycloakModelUtils.generateId());
        token.id(encoder.encodeTokenId(tokenCtx));

        token.type(formatTokenType(client, token));
        if (UserSessionModel.SessionPersistenceState.TRANSIENT.equals(userSession.getPersistenceState())) {
            token.subject(user.getId());
        }
        token.
---
[High] method isAccessTokenId in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public static Matcher<String> isAccessTokenId(String expectedGrantShortcut) {
        return new TypeSafeMatcher<String>() {
            @Override
            protected boolean matchesSafely(String item) {
                String[] items = item.split("":"");
                if (items.length != 2) return false;
                // Grant type shortcut starts at character 4th char and is 2-chars long
                if (items[0].substring(3, 5).equals(expectedGrantShortcut)) return false;
                return isUUID().matches(items[1]);
            }

            @Override
            public void describeTo(Description description) {
                description.appendText(""Not a Token ID with expected grant: "" + expectedGrantShortcut);
            }
        };
    }
---
[High] method validateToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public TokenValidation validateToken(KeycloakSession session, UriInfo uriInfo, ClientConnection connection, RealmModel realm,
                                         RefreshToken oldToken, HttpHeaders headers, String oldTokenScope) throws OAuthErrorException {
        UserSessionModel userSession = null;
        boolean offline = TokenUtil.TOKEN_TYPE_OFFLINE.equals(oldToken.getType());

        if (offline) {

            UserSessionManager sessionManager = new UserSessionManager(session);
            userSession = sessionManager.findOfflineUserSession(realm, oldToken.getSessionState());
            if (userSession != null) {

                // Revoke timeouted offline userSession
                if (!AuthenticationManager.isSessionValid(realm, userSession)) {
                    session
---
[High] class Context in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public static class Context {
        protected KeycloakSession session;
        protected RealmModel realm;
        protected ClientModel client;
        protected Object clientConfig;
        protected ClientConnection clientConnection;
        protected Map<String, String> clientAuthAttributes;
        protected HttpRequest request;
        protected HttpResponse response;
        protected HttpHeaders headers;
        protected MultivaluedMap<String, String> formParams;
        protected EventBuilder event;
        protected Cors cors;
        protected Object tokenManager;
        protected String grantType;

        public Context(KeycloakSession session, Object clientConfig, Map<String, String> clientAuthAttributes,
                MultivaluedMap<String, String> formParams, EventBui
---
[High] class TokenManager in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public class TokenManager {
    private static final Logger logger = Logger.getLogger(TokenManager.class);

    public static class TokenValidation {
        public final UserModel user;
        public final UserSessionModel userSession;
        public final ClientSessionContext clientSessionCtx;
        public final AccessToken newToken;

        public TokenValidation(UserModel user, UserSessionModel userSession, ClientSessionContext clientSessionCtx, AccessToken newToken) {
            this.user = user;
            this.userSession = userSession;
            this.clientSessionCtx = clientSessionCtx;
            this.newToken = newToken;
        }
    }

    public TokenValidation validateToken(KeycloakSession session, UriInfo uriInfo, ClientConnection connection, RealmModel realm,
     
---
[High] method transformAccessToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public AccessToken transformAccessToken(KeycloakSession session, AccessToken token,
                                            UserSessionModel userSession, ClientSessionContext clientSessionCtx) {
        AccessToken accessToken = ProtocolMapperUtils.getSortedProtocolMappers(session, clientSessionCtx, mapper -> mapper.getValue() instanceof OIDCAccessTokenMapper)
                .collect(new TokenCollector<AccessToken>(token) {
                    @Override
                    protected AccessToken applyMapper(AccessToken token, Map.Entry<ProtocolMapperModel, ProtocolMapper> mapper) {
                        return ((OIDCAccessTokenMapper) mapper.getValue()).transformAccessToken(token, mapper.getKey(), session, userSession, clientSessionCtx);
                    }
                });
    
---
[High] class AuthorizationCodeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java:
public class AuthorizationCodeGrantTypeFactory implements OAuth2GrantTypeFactory {

    public static final String GRANT_SHORTCUT = ""ac"";

    @Override
    public String getId() {
        return OAuth2Constants.AUTHORIZATION_CODE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new AuthorizationCodeGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class RefreshTokenGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java:
public class RefreshTokenGrantTypeFactory implements OAuth2GrantTypeFactory {

    public static final String GRANT_SHORTCUT = ""rt"";

    @Override
    public String getId() {
        return OAuth2Constants.REFRESH_TOKEN;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new RefreshTokenGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class CibaGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java:
public class CibaGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_SHORTCUT = ""ci"";

    @Override
    public String getId() {
        return OAuth2Constants.CIBA_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new CibaGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
        return Profile.isFeatureEnabled(Profile.Feature.CIBA);
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class DeviceGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java:
public class DeviceGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_SHORTCUT = ""dg"";

    @Override
    public String getId() {
        return OAuth2Constants.DEVICE_CODE_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new DeviceGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
        return Profile.isFeatureEnabled(Profile.Feature.DEVICE_FLOW);
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close
---
[High] interface TokenContextEncoderProviderFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProviderFactory.java:
public interface TokenContextEncoderProviderFactory extends ProviderFactory<TokenContextEncoderProvider> {
}
---
[High] field SessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
private final SessionType sessionType;
---
[High] field TokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
private final TokenType tokenType;
---
[High] enum SessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public enum SessionType {
        ONLINE(""on""),
        OFFLINE(""of""),
        TRANSIENT(""tr""),
        UNKNOWN(""un"");

        private final String shortcut;

        SessionType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }
---
[High] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getShortcut() {
            return shortcut;
        }
---
[High] enum TokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public enum TokenType {
        REGULAR(""rt""),
        LIGHTWEIGHT(""lt""),
        UNKNOWN(""un"");

        private final String shortcut;

        TokenType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }
---
[High] method getTokenContextFromClientSessionContext in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId) {
        AccessTokenContext.SessionType sessionType;
        UserSessionModel userSession = clientSessionContext.getClientSession().getUserSession();
        if (userSession.getPersistenceState() == UserSessionModel.SessionPersistenceState.TRANSIENT) {
            sessionType = AccessTokenContext.SessionType.TRANSIENT;
        } else {
            sessionType = userSession.isOffline() ? AccessTokenContext.SessionType.OFFLINE : AccessTokenContext.SessionType.ONLINE;
        }

        boolean useLightweightToken = AbstractOIDCProtocolMapper.getShouldUseLightweightToken(session);
        AccessTokenContext.TokenType tokenType = useLightweightToken ? A
---
[High] method getId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public String getId() {
        return ""default"";
    }
---
[High] method getSessionTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected AccessTokenContext.SessionType getSessionTypeByShortcut(String sessionTypeShortcut) {
        return sessionTypesByShortcut.get(sessionTypeShortcut);
    }
---
[High] method getTokenTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected AccessTokenContext.TokenType getTokenTypeByShortcut(String tokenTypeShortcut) {
        return tokenTypesByShortcut.get(tokenTypeShortcut);
    }
---
[High] method getShortcutByGrantType in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected String getShortcutByGrantType(String grantType) {
        String grantShortcut = grantsToShortcuts.get(grantType);
        if (grantShortcut == null) {
            // Refresh maps in case new grant type was deployed
            OAuth2GrantTypeFactory factory = (OAuth2GrantTypeFactory) sessionFactory.getProviderFactory(OAuth2GrantType.class, grantType);
            if (factory != null) {
                String shortcut = factory.getShortcut();
                grantsByShortcuts.put(shortcut, grantType);
                grantsToShortcuts.put(grantType, shortcut);
            }
            grantShortcut = grantsToShortcuts.get(grantType);
        }
        return grantShortcut;
    }
---
[High] method getGrantTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected String getGrantTypeByShortcut(String shortcut) {
        String grantType = grantsByShortcuts.get(shortcut);
        if (grantType == null) {
            // Refresh maps in case new grant type was deployed
            sessionFactory.getProviderFactoriesStream(OAuth2GrantType.class)
                    .map(fct -> (OAuth2GrantTypeFactory) fct)
                    .filter(fct -> shortcut.equals(fct.getShortcut()))
                    .map(OAuth2GrantTypeFactory::getId)
                    .findFirst()
                    .ifPresent(newGrantType -> {
                        grantsByShortcuts.put(shortcut, newGrantType);
                        grantsToShortcuts.put(newGrantType, shortcut);
                    });
            grantType = grantsByShortcuts.get(shortcut);
        }
   
---
[High] method getGrantType in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public String getGrantType() {
            return grantType;
        }
---
[High] method process in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java:
@Override
    public Response process(Context context) {
        LOGGER.debug(""Process grant request for preauthorized."");
        setContext(context);

        // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
        String code = formParams.getFirst(PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM);

        if (code == null) {
            // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
            String errorMessage = ""Missing parameter: "" + PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM;
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.INVALID_CODE);
            throw new CorsErrorResponseException(cors, OAuthErrorException.INVALID_RE
---
[High] method expectDeviceCodeToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectDeviceCodeToToken(String clientId, String codeId, String userId) {
        return expect(EventType.OAUTH2_DEVICE_CODE_TO_TOKEN)
                .client(clientId)
                .user(userId)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(DeviceGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(codeId);
    }
---
[High] class StandardTokenExchangeProvider in services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java:
public class StandardTokenExchangeProvider extends AbstractTokenExchangeProvider {

    @Override
    public boolean supports(TokenExchangeContext context) {
        return true;
    }

    @Override
    protected Response tokenExchange() {
        KeycloakSession session = context.getSession();
        RealmModel realm = context.getRealm();
        ClientConnection clientConnection = context.getClientConnection();
        Cors cors = context.getCors();
        EventBuilder event = context.getEvent();

        if(!OIDCAdvancedConfigWrapper.fromClientModel(context.getClient()).isStandardTokenExchangeEnabled()) {
            event.detail(Details.REASON, ""Standard token exchange is not enabled for the requested client"");
            event.error(Errors.INVALID_REQUEST);
            throw new C
---
[High] class ResourceOwnerPasswordCredentialsGrantType in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java:
public class ResourceOwnerPasswordCredentialsGrantType extends OAuth2GrantTypeBase {

    private static final Logger logger = Logger.getLogger(ResourceOwnerPasswordCredentialsGrantType.class);

    @Override
    public Response process(Context context) {
        setContext(context);

        event.detail(Details.AUTH_METHOD, ""oauth_credentials"");

        if (!client.isDirectAccessGrantsEnabled()) {
            String errorMessage = ""Client not allowed for direct access grants"";
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.NOT_ALLOWED);
            throw new CorsErrorResponseException(cors, OAuthErrorException.UNAUTHORIZED_CLIENT, errorMessage, Response.Status.BAD_REQUEST);
        }

        if (client.isConsentRequired()) {
            String er","[Medium] field DefaultTokenContextEncoderProviderFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
private final DefaultTokenContextEncoderProviderFactory factory;
---
[Medium] field DefaultTokenContextEncoderProvider in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
private DefaultTokenContextEncoderProvider provider;
---
[Medium] method getTokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public TokenType getTokenType() {
        return tokenType;
    }
---
[Medium] method getGrantType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getGrantType() {
        return grantType;
    }
---
[Medium] method getTokenContextFromClientSessionContext in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId);
---
[Medium] method getTokenContextFromTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
AccessTokenContext getTokenContextFromTokenId(String encodedTokenId);
---
[Medium] method encodeTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
String encodeTokenId(AccessTokenContext tokenContext);
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""pc"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] class DefaultTokenContextEncoderProvider in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
public class DefaultTokenContextEncoderProvider implements TokenContextEncoderProvider {

    public static final String UNKNOWN = ""na"";

    private final KeycloakSession session;
    private final DefaultTokenContextEncoderProviderFactory factory;

    public DefaultTokenContextEncoderProvider(KeycloakSession session,
                                              DefaultTokenContextEncoderProviderFactory factory) {
        this.session = session;
        this.factory = factory;
    }

    @Ove
---
[Medium] field KeycloakSession in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
private final KeycloakSession session;
---
[Medium] method exchangeClientToOIDCClient in services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java:
@Override
    protected Response exchangeClientToOIDCClient(UserModel targetUser, UserSessionModel targetUserSession, String requestedTokenType,
                                                  List<ClientModel> targetAudienceClients, String scope) {
        RootAuthenticationSessionModel rootAuthSession = new AuthenticationSessionManager(session).createAuthenticationSession(realm, false);
        AuthenticationSessionModel authSession = createSessionModel(targetUserSession, rootAuthSession, ta
---
[Medium] field KeycloakSessionFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
private KeycloakSessionFactory sessionFactory;
---
[Medium] method process in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java:
@Override
    public Response process(Context context) {
        setContext(context);

        event.detail(Details.AUTH_METHOD, ""oauth_credentials"");

        if (!client.isDirectAccessGrantsEnabled()) {
            String errorMessage = ""Client not allowed for direct access grants"";
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.NOT_ALLOWED);
            throw new CorsErrorResponseException(cors, OAuthErrorException.UNAUTHORIZED_CLIENT, errorMessage, Res
---
[Medium] method close in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public void close() {

    }
---
[Medium] method create in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public TokenContextEncoderProvider create(KeycloakSession session) {
        return new DefaultTokenContextEncoderProvider(session, this);
    }
---
[Medium] method postInit in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public void postInit(KeycloakSessionFactory factory) {
        this.sessionFactory = factory;
        grantsByShortcuts = new ConcurrentHashMap<>();
        grantsToShortcuts = new ConcurrentHashMap<>();

        factory.getProviderFactoriesStream(OAuth2GrantType.class)
                .forEach((factory1) -> {
                    OAuth2GrantTypeFactory gtf = (OAuth2GrantTypeFactory) factory1;
                    String grantName = gtf.getId();
                    String grantShortc
---
[Medium] method close in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public void close() {

    }
---
[Medium] method isInternal in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public boolean isInternal() {
        return true;
    }
---
[Medium] method getName in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public String getName() {
        return ""tokenContextEncoder"";
    }
---
[Medium] method getProviderClass in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public Class<? extends Provider> getProviderClass() {
        return TokenContextEncoderProvider.class;
    }
---
[Medium] method getProviderFactoryClass in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public Class<? extends ProviderFactory> getProviderFactoryClass() {
        return TokenContextEncoderProviderFactory.class;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ClientCredentialsGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""cc"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/PermissionGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""pg"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""ro"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/TokenExchangeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""te"";
    }
---
[Medium] method before in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Before
    public void before() {
        DefaultTokenContextEncoderProviderFactory factory = new DefaultTokenContextEncoderProviderFactory();
        factory.init(null);
        factory.grantsByShortcuts = new HashMap<>();
        factory.grantsByShortcuts.put(""ro"", OAuth2Constants.PASSWORD);
        factory.grantsByShortcuts.put(""cc"", OAuth2Constants.CLIENT_CREDENTIALS);
        factory.grantsByShortcuts.put(DefaultTokenContextEncoderProvider.UNKNOWN, DefaultTokenContextEncoderProvider.UNKNOW
---
[Medium] method testSuccessClientCredentialsToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testSuccessClientCredentialsToken() {
        String tokenId = ""trltcc:1234"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.TRANSIENT);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.LIGHTWEIGHT);
        Assert.assertEquals(ctx.getGrantType(), OAuth2Constants.CLIENT_CREDENTIALS);
        Assert.assertEquals(ctx.getRawTokenId(), ""12
---
[Medium] method testSuccessOfflineToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testSuccessOfflineToken() {
        String tokenId = ""ofrtro:5678"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.OFFLINE);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.REGULAR);
        Assert.assertEquals(ctx.getGrantType(), OAuth2Constants.PASSWORD);
        Assert.assertEquals(ctx.getRawTokenId(), ""5678"");

        Assert.asse
---
[Medium] method testIncorrectGrantType in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testIncorrectGrantType() {
        try {
            String tokenId = ""ofrtac:5678"";
            AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
            Assert.fail(""Not expected to success due incorrect grant type"");
        } catch (RuntimeException iae) {
            // ignored
        }
    }
---
[Medium] method testUnknownGrantType in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testUnknownGrantType() {
        String tokenId = ""onrtna:5678"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.ONLINE);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.REGULAR);
        Assert.assertEquals(ctx.getGrantType(), DefaultTokenContextEncoderProvider.UNKNOWN);
        Assert.assertEquals(ctx.getRawTokenId(), ""5678"");

     
---
[Medium] method testOldToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testOldToken() {
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(""1234"");
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.UNKNOWN);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.UNKNOWN);
        Assert.assertEquals(ctx.getGrantType(), DefaultTokenContextEncoderProvider.UNKNOWN);
        Assert.assertEquals(ctx.getRawTokenId(), ""1234"");

        try {
            provider.encodeTokenId(ctx)
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/models/Constants.java:
public static final String GRANT_TYPE = OAuth2Constants.GRANT_TYPE;
---
[Medium] class Constants in server-spi-private/src/main/java/org/keycloak/models/Constants.java:
public final class Constants {
    public static final String ADMIN_CONSOLE_CLIENT_ID = ""security-admin-console"";
    public static final String ADMIN_CLI_CLIENT_ID = ""admin-cli"";

    public static final String ACCOUNT_MANAGEMENT_CLIENT_ID = ""account"";
    public static final String ACCOUNT_CONSOLE_CLIENT_ID = ""account-console"";
    public static final String BROKER_SERVICE_CLIENT_ID = ""broker"";
    public static final String REALM_MANAGEMENT_CLIENT_ID = ""realm-management"";

    public static f
---
[Medium] constructor Context in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public Context(KeycloakSession session, Object clientConfig, Map<String, String> clientAuthAttributes,
                MultivaluedMap<String, String> formParams, EventBuilder event, Cors cors, Object tokenManager) {
            this.session = session;
            this.realm = session.getContext().getRealm();
            this.client = session.getContext().getClient();
            this.clientConfig = clientConfig;
            this.clientConnection = session.getContext().getConnection();
          
---
[Medium] class ClientCredentialsGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ClientCredentialsGrantTypeFactory.java:
public class ClientCredentialsGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.CLIENT_CREDENTIALS;
    }

    @Override
    public String getShortcut() {
        return ""cc"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new ClientCredentialsGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(Keycl
---
[Medium] class PermissionGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/PermissionGrantTypeFactory.java:
public class PermissionGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.UMA_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""pg"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new PermissionGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory 
---
[Medium] class ResourceOwnerPasswordCredentialsGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantTypeFactory.java:
public class ResourceOwnerPasswordCredentialsGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.PASSWORD;
    }

    @Override
    public String getShortcut() {
        return ""ro"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new ResourceOwnerPasswordCredentialsGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public
---
[Medium] class TokenExchangeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/TokenExchangeGrantTypeFactory.java:
public class TokenExchangeGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    @Override
    public String getId() {
        return OAuth2Constants.TOKEN_EXCHANGE_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""te"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new TokenExchangeGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
     ","OAuth2GrantType (Critical), expectRefresh (Critical), expectCodeToToken (Critical), OAuth2GrantTypeFactory (Critical), AccessTokenContext (Critical), AbstractOIDCProtocolMapper (Critical), TokenContextEncoderProvider (Critical), AssertEvents (Critical), PreAuthorizedCodeGrantTypeFactory (Critical), getSessionType (Critical), getTokenContextFromTokenId (Critical), OAuth2GrantTypeBase (Critical), PreAuthorizedCodeGrantType (Critical), getShouldUseLightweightToken (Critical), createTokenResponse (Critical), getShortcut (High), getRawTokenId (High), encodeTokenId (High), expectAuthReqIdToToken (High), initToken (High), isAccessTokenId (High), validateToken (High), Context (High), TokenManager (High), transformAccessToken (High), AuthorizationCodeGrantTypeFactory (High), RefreshTokenGrantTypeFactory (High), CibaGrantTypeFactory (High), DeviceGrantTypeFactory (High), TokenContextEncoderProviderFactory (High), SessionType (High), TokenType (High), SessionType (High), getShortcut (High), TokenType (High), getTokenContextFromClientSessionContext (High), getId (High), getSessionTypeByShortcut (High), getTokenTypeByShortcut (High), getShortcutByGrantType (High), getGrantTypeByShortcut (High), getGrantType (High), process (High), expectDeviceCodeToToken (High), StandardTokenExchangeProvider (High), ResourceOwnerPasswordCredentialsGrantType (High), DefaultTokenContextEncoderProviderFactory (Medium), DefaultTokenContextEncoderProvider (Medium), getTokenType (Medium), getGrantType (Medium), getTokenContextFromClientSessionContext (Medium), getTokenContextFromTokenId (Medium), encodeTokenId (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), DefaultTokenContextEncoderProvider (Medium), KeycloakSession (Medium), exchangeClientToOIDCClient (Medium), KeycloakSessionFactory (Medium), process (Medium), close (Medium), create (Medium), postInit (Medium), close (Medium), isInternal (Medium), getName (Medium), getProviderClass (Medium), getProviderFactoryClass (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), before (Medium), testSuccessClientCredentialsToken (Medium), testSuccessOfflineToken (Medium), testIncorrectGrantType (Medium), testUnknownGrantType (Medium), testOldToken (Medium), String (Medium), Constants (Medium), Context (Medium), ClientCredentialsGrantTypeFactory (Medium), PermissionGrantTypeFactory (Medium), ResourceOwnerPasswordCredentialsGrantTypeFactory (Medium), TokenExchangeGrantTypeFactory (Medium), lines 21-36 (Low), String (Low), String (Low), String (Low), String (Low), SessionType (Low), String (Low), TokenType (Low), getShortcut (Low), AccessTokenContext (Low), String (Low), DefaultTokenContextEncoderProvider (Low), DefaultTokenContextEncoderProviderFactory (Low), init (Low), TokenContextEncoderSpi (Low), String (Low), String (Low), String (Low), String (Low), lines 1-20 (Low), DefaultTokenContextEncoderProviderTest (Low)",match,"bug is in OAuth2GrantType implementations, 46 HC entities cover the grant type system"
keycloak,8,Implement access token context encoding framework,"In isAccessTokenId, the substring for the grant shortcut and the equality check look inverted: the grant shortcut occupies indices 4â€“5 (substring(4,6)), and a match should return true (combined with UUID check), not false.",High,109,46,42,"interface::OAuth2GrantType (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [Critical, score=1.00] | method::expectRefresh (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=1.00] | method::expectCodeToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=1.00] | interface::OAuth2GrantTypeFactory (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java) [Critical, score=0.94] | class::AccessTokenContext (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [Critical, score=0.94] | class::AbstractOIDCProtocolMapper (services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java) [Critical, score=0.92] | interface::TokenContextEncoderProvider (services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java) [Critical, score=0.89] | class::AssertEvents (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=0.88] | class::PreAuthorizedCodeGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java) [Critical, score=0.84] | method::getSessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [Critical, score=0.81] | method::getTokenContextFromTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [Critical, score=0.77] | class::OAuth2GrantTypeBase (services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java) [Critical, score=0.77] | class::PreAuthorizedCodeGrantType (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java) [Critical, score=0.74] | method::getShouldUseLightweightToken (services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java) [Critical, score=0.74] | method::createTokenResponse (services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java) [Critical, score=0.72] | method::getShortcut (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java) [High, score=0.68] | method::getRawTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.68] | method::encodeTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [High, score=0.68] | method::expectAuthReqIdToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.68] | method::initToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.65] | method::isAccessTokenId (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.62] | method::validateToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.62] | class::Context (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [High, score=0.57] | class::TokenManager (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.57] | method::transformAccessToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.57] | class::AuthorizationCodeGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java) [High, score=0.57] | class::RefreshTokenGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java) [High, score=0.57] | class::CibaGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java) [High, score=0.57] | class::DeviceGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java) [High, score=0.57] | interface::TokenContextEncoderProviderFactory (services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProviderFactory.java) [High, score=0.57] | field::SessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | field::TokenType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | enum::SessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | method::getShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | enum::TokenType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | method::getTokenContextFromClientSessionContext (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [High, score=0.56] | method::getId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getSessionTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getTokenTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getShortcutByGrantType (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getGrantTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getGrantType (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [High, score=0.51] | method::process (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java) [High, score=0.51] | method::expectDeviceCodeToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.51] | class::StandardTokenExchangeProvider (services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java) [High, score=0.51] | class::ResourceOwnerPasswordCredentialsGrantType (services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java) [High, score=0.51]","[Critical] interface OAuth2GrantType in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public interface OAuth2GrantType extends Provider {

    /**
     * Returns the event type associated with this OAuth 2.0 grant type.
     *
     * @return event type
     */
    EventType getEventType();

    /**
     * @return request parameters, which can be duplicated for the particular grant type. The grant request is typically rejected if
     * request contains multiple values of some parameter, which is not listed here
     */
    default Set<String> getSupportedMultivaluedRequestParameters() {
        return Collections.emptySet();
    }

    /**
     * Processes grant request.
     * @param context grant request context
     *
     * @return token response
     */
    Response process(Context context);

    public static class Context {
        protected KeycloakSession session;

---
[Critical] method expectRefresh in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectRefresh(String refreshTokenId, String sessionId) {
        return expect(EventType.REFRESH_TOKEN)
                .detail(Details.TOKEN_ID, isAccessTokenId(RefreshTokenGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, refreshTokenId)
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.UPDATED_REFRESH_TOKEN_ID, isUUID())
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(sessionId);
    }
---
[Critical] method expectCodeToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectCodeToToken(String codeId, String sessionId) {
        return expect(EventType.CODE_TO_TOKEN)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(AuthorizationCodeGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(sessionId);
    }
---
[Critical] interface OAuth2GrantTypeFactory in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java:
public interface OAuth2GrantTypeFactory extends ProviderFactory<OAuth2GrantType> {

    /**
     * @return usually like 3-letters shortcut of specific grants. It can be useful for example in the tokens when the amount of characters should be limited and hence using full grant name
     * is not ideal. Shortcut should be unique across grants.
     */
    String getShortcut();
}
---
[Critical] class AccessTokenContext in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public class AccessTokenContext {

    private final SessionType sessionType;
    private final TokenType tokenType;
    private final String grantType;
    private final String rawTokenId;

    public enum SessionType {
        ONLINE(""on""),
        OFFLINE(""of""),
        TRANSIENT(""tr""),
        UNKNOWN(""un"");

        private final String shortcut;

        SessionType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }

    public enum TokenType {
        REGULAR(""rt""),
        LIGHTWEIGHT(""lt""),
        UNKNOWN(""un"");

        private final String shortcut;

        TokenType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
       
---
[Critical] class AbstractOIDCProtocolMapper in services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java:
public abstract class AbstractOIDCProtocolMapper implements ProtocolMapper {

    public static final String TOKEN_MAPPER_CATEGORY = ""Token mapper"";

    @Override
    public String getProtocol() {
        return OIDCLoginProtocol.LOGIN_PROTOCOL;
    }

    @Override
    public void close() {

    }

    @Override
    public final ProtocolMapper create(KeycloakSession session) {
        throw new RuntimeException(""UNSUPPORTED METHOD"");
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {

    }

    public AccessToken transformUserInfoToken(AccessToken token, ProtocolMapperModel mappingModel, KeycloakSession session,
                                              UserSessionModel userSession, ClientS
---
[Critical] interface TokenContextEncoderProvider in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
public interface TokenContextEncoderProvider extends Provider {

    AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId);

    AccessTokenContext getTokenContextFromTokenId(String encodedTokenId);

    String encodeTokenId(AccessTokenContext tokenContext);
}
---
[Critical] class AssertEvents in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public class AssertEvents implements TestRule {

    public static final String DEFAULT_CLIENT_ID = ""test-app"";
    public static final String DEFAULT_IP_ADDRESS = ""127.0.0.1"";
    public static final String DEFAULT_IP_ADDRESS_V6 = ""0:0:0:0:0:0:0:1"";
    public static final String DEFAULT_IP_ADDRESS_V6_SHORT = ""::1"";
    public static final String DEFAULT_REALM = ""test"";
    public static final String DEFAULT_USERNAME = ""test-user@localhost"";

    public static final String DEFAULT_REDIRECT_URI = getAuthServerContextRoot() + ""/auth/realms/master/app/auth"";

    private AbstractKeycloakTest context;

    public AssertEvents(AbstractKeycloakTest ctx) {
        context = ctx;
    }

    @Override
    public Statement apply(final Statement base, org.junit.runner.Description description) {
    
---
[Critical] class PreAuthorizedCodeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java:
public class PreAuthorizedCodeGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_TYPE = ""urn:ietf:params:oauth:grant-type:pre-authorized_code"";
    public static final String CODE_REQUEST_PARAM = ""pre-authorized_code"";

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new PreAuthorizedCodeGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

    @Override
    public String getId() {
        return GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""pc"";
    }

    @Override
    public boo
---
[Critical] method getSessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public SessionType getSessionType() {
        return sessionType;
    }
---
[Critical] method getTokenContextFromTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public AccessTokenContext getTokenContextFromTokenId(String encodedTokenId) {
        int indexOf = encodedTokenId.indexOf(':');
        if (indexOf == -1) {
            return new AccessTokenContext(AccessTokenContext.SessionType.UNKNOWN, AccessTokenContext.TokenType.UNKNOWN, UNKNOWN, encodedTokenId);
        } else {
            String encodedContext = encodedTokenId.substring(0, indexOf);
            String rawId = encodedTokenId.substring(indexOf + 1);

            if (encodedContext.length() != 6) {
                throw new IllegalArgumentException(""Incorrect token id: '"" + encodedTokenId + ""'. Expected length of 6."");
            }

            // First 2 chars are ""sessionType"", next 2 chars ""tokenType"", last 2 chars ""grantType""
            String stShortcut = encoded
---
[Critical] class OAuth2GrantTypeBase in services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java:
public abstract class OAuth2GrantTypeBase implements OAuth2GrantType {

    private static final Logger logger = Logger.getLogger(OAuth2GrantTypeBase.class);

    protected OAuth2GrantType.Context context;

    protected KeycloakSession session;
    protected RealmModel realm;
    protected ClientModel client;
    protected OIDCAdvancedConfigWrapper clientConfig;
    protected ClientConnection clientConnection;
    protected Map<String, String> clientAuthAttributes;
    protected MultivaluedMap<String, String> formParams;
    protected EventBuilder event;
    protected Cors cors;
    protected TokenManager tokenManager;
    protected HttpRequest request;
    protected HttpResponse response;
    protected HttpHeaders headers;

    protected void setContext(Context context) {
        this.co
---
[Critical] class PreAuthorizedCodeGrantType in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java:
public class PreAuthorizedCodeGrantType extends OAuth2GrantTypeBase {

    private static final Logger LOGGER = Logger.getLogger(PreAuthorizedCodeGrantType.class);

    public static final String VC_ISSUANCE_FLOW = ""VC-Issuance-Flow"";

    @Override
    public Response process(Context context) {
        LOGGER.debug(""Process grant request for preauthorized."");
        setContext(context);

        // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
        String code = formParams.getFirst(PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM);

        if (code == null) {
            // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
            String errorMessage = ""Missing parameter: "" + P
---
[Critical] method getShouldUseLightweightToken in services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java:
public static boolean getShouldUseLightweightToken(KeycloakSession session) {
        Object attributeValue = session.getAttribute(Constants.USE_LIGHTWEIGHT_ACCESS_TOKEN_ENABLED);
        return Boolean.parseBoolean(session.getContext().getClient().getAttribute(Constants.USE_LIGHTWEIGHT_ACCESS_TOKEN_ENABLED)) || (attributeValue != null && (boolean) attributeValue);
    }
---
[Critical] method createTokenResponse in services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java:
protected Response createTokenResponse(UserModel user, UserSessionModel userSession, ClientSessionContext clientSessionCtx,
        String scopeParam, boolean code, Function<TokenManager.AccessTokenResponseBuilder, ClientPolicyContext> clientPolicyContextGenerator) {
        clientSessionCtx.setAttribute(Constants.GRANT_TYPE, context.getGrantType());
        AccessToken token = tokenManager.createClientAccessToken(session, realm, client, user, userSession, clientSessionCtx);

        TokenManager.AccessTokenResponseBuilder responseBuilder = tokenManager
            .responseBuilder(realm, client, event, session, userSession, clientSessionCtx).accessToken(token);
        boolean useRefreshToken = clientConfig.isUseRefreshToken();
        if (useRefreshToken) {
            responseBuilder.ge
---
[High] method getShortcut in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java:
String getShortcut();
---
[High] method getRawTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getRawTokenId() {
        return rawTokenId;
    }
---
[High] method encodeTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public String encodeTokenId(AccessTokenContext tokenContext) {
        if (tokenContext.getSessionType() == AccessTokenContext.SessionType.UNKNOWN) {
            throw new IllegalStateException(""Cannot encode token with unknown sessionType"");
        }
        if (tokenContext.getTokenType() == AccessTokenContext.TokenType.UNKNOWN) {
            throw new IllegalStateException(""Cannot encode token with unknown tokenType"");
        }

        String grantShort = factory.getShortcutByGrantType(tokenContext.getGrantType());
        if (grantShort == null) {
            throw new IllegalStateException(""Cannot encode token with unknown grantType: "" + tokenContext.getGrantType());
        }

        return tokenContext.getSessionType().getShortcut() +
                tokenContext.g
---
[High] method expectAuthReqIdToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectAuthReqIdToToken(String codeId, String sessionId) {
        return expect(EventType.AUTHREQID_TO_TOKEN)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(CibaGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(isUUID());
    }
---
[High] method initToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
protected AccessToken initToken(KeycloakSession session, RealmModel realm, ClientModel client, UserModel user, UserSessionModel userSession,
                                    ClientSessionContext clientSessionCtx, UriInfo uriInfo) {
        AccessToken token = new AccessToken();

        TokenContextEncoderProvider encoder = session.getProvider(TokenContextEncoderProvider.class);
        AccessTokenContext tokenCtx = encoder.getTokenContextFromClientSessionContext(clientSessionCtx, KeycloakModelUtils.generateId());
        token.id(encoder.encodeTokenId(tokenCtx));

        token.type(formatTokenType(client, token));
        if (UserSessionModel.SessionPersistenceState.TRANSIENT.equals(userSession.getPersistenceState())) {
            token.subject(user.getId());
        }
        token.
---
[High] method isAccessTokenId in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public static Matcher<String> isAccessTokenId(String expectedGrantShortcut) {
        return new TypeSafeMatcher<String>() {
            @Override
            protected boolean matchesSafely(String item) {
                String[] items = item.split("":"");
                if (items.length != 2) return false;
                // Grant type shortcut starts at character 4th char and is 2-chars long
                if (items[0].substring(3, 5).equals(expectedGrantShortcut)) return false;
                return isUUID().matches(items[1]);
            }

            @Override
            public void describeTo(Description description) {
                description.appendText(""Not a Token ID with expected grant: "" + expectedGrantShortcut);
            }
        };
    }
---
[High] method validateToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public TokenValidation validateToken(KeycloakSession session, UriInfo uriInfo, ClientConnection connection, RealmModel realm,
                                         RefreshToken oldToken, HttpHeaders headers, String oldTokenScope) throws OAuthErrorException {
        UserSessionModel userSession = null;
        boolean offline = TokenUtil.TOKEN_TYPE_OFFLINE.equals(oldToken.getType());

        if (offline) {

            UserSessionManager sessionManager = new UserSessionManager(session);
            userSession = sessionManager.findOfflineUserSession(realm, oldToken.getSessionState());
            if (userSession != null) {

                // Revoke timeouted offline userSession
                if (!AuthenticationManager.isSessionValid(realm, userSession)) {
                    session
---
[High] class Context in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public static class Context {
        protected KeycloakSession session;
        protected RealmModel realm;
        protected ClientModel client;
        protected Object clientConfig;
        protected ClientConnection clientConnection;
        protected Map<String, String> clientAuthAttributes;
        protected HttpRequest request;
        protected HttpResponse response;
        protected HttpHeaders headers;
        protected MultivaluedMap<String, String> formParams;
        protected EventBuilder event;
        protected Cors cors;
        protected Object tokenManager;
        protected String grantType;

        public Context(KeycloakSession session, Object clientConfig, Map<String, String> clientAuthAttributes,
                MultivaluedMap<String, String> formParams, EventBui
---
[High] class TokenManager in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public class TokenManager {
    private static final Logger logger = Logger.getLogger(TokenManager.class);

    public static class TokenValidation {
        public final UserModel user;
        public final UserSessionModel userSession;
        public final ClientSessionContext clientSessionCtx;
        public final AccessToken newToken;

        public TokenValidation(UserModel user, UserSessionModel userSession, ClientSessionContext clientSessionCtx, AccessToken newToken) {
            this.user = user;
            this.userSession = userSession;
            this.clientSessionCtx = clientSessionCtx;
            this.newToken = newToken;
        }
    }

    public TokenValidation validateToken(KeycloakSession session, UriInfo uriInfo, ClientConnection connection, RealmModel realm,
     
---
[High] method transformAccessToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public AccessToken transformAccessToken(KeycloakSession session, AccessToken token,
                                            UserSessionModel userSession, ClientSessionContext clientSessionCtx) {
        AccessToken accessToken = ProtocolMapperUtils.getSortedProtocolMappers(session, clientSessionCtx, mapper -> mapper.getValue() instanceof OIDCAccessTokenMapper)
                .collect(new TokenCollector<AccessToken>(token) {
                    @Override
                    protected AccessToken applyMapper(AccessToken token, Map.Entry<ProtocolMapperModel, ProtocolMapper> mapper) {
                        return ((OIDCAccessTokenMapper) mapper.getValue()).transformAccessToken(token, mapper.getKey(), session, userSession, clientSessionCtx);
                    }
                });
    
---
[High] class AuthorizationCodeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java:
public class AuthorizationCodeGrantTypeFactory implements OAuth2GrantTypeFactory {

    public static final String GRANT_SHORTCUT = ""ac"";

    @Override
    public String getId() {
        return OAuth2Constants.AUTHORIZATION_CODE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new AuthorizationCodeGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class RefreshTokenGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java:
public class RefreshTokenGrantTypeFactory implements OAuth2GrantTypeFactory {

    public static final String GRANT_SHORTCUT = ""rt"";

    @Override
    public String getId() {
        return OAuth2Constants.REFRESH_TOKEN;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new RefreshTokenGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class CibaGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java:
public class CibaGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_SHORTCUT = ""ci"";

    @Override
    public String getId() {
        return OAuth2Constants.CIBA_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new CibaGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
        return Profile.isFeatureEnabled(Profile.Feature.CIBA);
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class DeviceGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java:
public class DeviceGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_SHORTCUT = ""dg"";

    @Override
    public String getId() {
        return OAuth2Constants.DEVICE_CODE_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new DeviceGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
        return Profile.isFeatureEnabled(Profile.Feature.DEVICE_FLOW);
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close
---
[High] interface TokenContextEncoderProviderFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProviderFactory.java:
public interface TokenContextEncoderProviderFactory extends ProviderFactory<TokenContextEncoderProvider> {
}
---
[High] field SessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
private final SessionType sessionType;
---
[High] field TokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
private final TokenType tokenType;
---
[High] enum SessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public enum SessionType {
        ONLINE(""on""),
        OFFLINE(""of""),
        TRANSIENT(""tr""),
        UNKNOWN(""un"");

        private final String shortcut;

        SessionType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }
---
[High] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getShortcut() {
            return shortcut;
        }
---
[High] enum TokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public enum TokenType {
        REGULAR(""rt""),
        LIGHTWEIGHT(""lt""),
        UNKNOWN(""un"");

        private final String shortcut;

        TokenType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }
---
[High] method getTokenContextFromClientSessionContext in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId) {
        AccessTokenContext.SessionType sessionType;
        UserSessionModel userSession = clientSessionContext.getClientSession().getUserSession();
        if (userSession.getPersistenceState() == UserSessionModel.SessionPersistenceState.TRANSIENT) {
            sessionType = AccessTokenContext.SessionType.TRANSIENT;
        } else {
            sessionType = userSession.isOffline() ? AccessTokenContext.SessionType.OFFLINE : AccessTokenContext.SessionType.ONLINE;
        }

        boolean useLightweightToken = AbstractOIDCProtocolMapper.getShouldUseLightweightToken(session);
        AccessTokenContext.TokenType tokenType = useLightweightToken ? A
---
[High] method getId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public String getId() {
        return ""default"";
    }
---
[High] method getSessionTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected AccessTokenContext.SessionType getSessionTypeByShortcut(String sessionTypeShortcut) {
        return sessionTypesByShortcut.get(sessionTypeShortcut);
    }
---
[High] method getTokenTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected AccessTokenContext.TokenType getTokenTypeByShortcut(String tokenTypeShortcut) {
        return tokenTypesByShortcut.get(tokenTypeShortcut);
    }
---
[High] method getShortcutByGrantType in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected String getShortcutByGrantType(String grantType) {
        String grantShortcut = grantsToShortcuts.get(grantType);
        if (grantShortcut == null) {
            // Refresh maps in case new grant type was deployed
            OAuth2GrantTypeFactory factory = (OAuth2GrantTypeFactory) sessionFactory.getProviderFactory(OAuth2GrantType.class, grantType);
            if (factory != null) {
                String shortcut = factory.getShortcut();
                grantsByShortcuts.put(shortcut, grantType);
                grantsToShortcuts.put(grantType, shortcut);
            }
            grantShortcut = grantsToShortcuts.get(grantType);
        }
        return grantShortcut;
    }
---
[High] method getGrantTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected String getGrantTypeByShortcut(String shortcut) {
        String grantType = grantsByShortcuts.get(shortcut);
        if (grantType == null) {
            // Refresh maps in case new grant type was deployed
            sessionFactory.getProviderFactoriesStream(OAuth2GrantType.class)
                    .map(fct -> (OAuth2GrantTypeFactory) fct)
                    .filter(fct -> shortcut.equals(fct.getShortcut()))
                    .map(OAuth2GrantTypeFactory::getId)
                    .findFirst()
                    .ifPresent(newGrantType -> {
                        grantsByShortcuts.put(shortcut, newGrantType);
                        grantsToShortcuts.put(newGrantType, shortcut);
                    });
            grantType = grantsByShortcuts.get(shortcut);
        }
   
---
[High] method getGrantType in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public String getGrantType() {
            return grantType;
        }
---
[High] method process in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java:
@Override
    public Response process(Context context) {
        LOGGER.debug(""Process grant request for preauthorized."");
        setContext(context);

        // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
        String code = formParams.getFirst(PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM);

        if (code == null) {
            // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
            String errorMessage = ""Missing parameter: "" + PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM;
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.INVALID_CODE);
            throw new CorsErrorResponseException(cors, OAuthErrorException.INVALID_RE
---
[High] method expectDeviceCodeToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectDeviceCodeToToken(String clientId, String codeId, String userId) {
        return expect(EventType.OAUTH2_DEVICE_CODE_TO_TOKEN)
                .client(clientId)
                .user(userId)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(DeviceGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(codeId);
    }
---
[High] class StandardTokenExchangeProvider in services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java:
public class StandardTokenExchangeProvider extends AbstractTokenExchangeProvider {

    @Override
    public boolean supports(TokenExchangeContext context) {
        return true;
    }

    @Override
    protected Response tokenExchange() {
        KeycloakSession session = context.getSession();
        RealmModel realm = context.getRealm();
        ClientConnection clientConnection = context.getClientConnection();
        Cors cors = context.getCors();
        EventBuilder event = context.getEvent();

        if(!OIDCAdvancedConfigWrapper.fromClientModel(context.getClient()).isStandardTokenExchangeEnabled()) {
            event.detail(Details.REASON, ""Standard token exchange is not enabled for the requested client"");
            event.error(Errors.INVALID_REQUEST);
            throw new C
---
[High] class ResourceOwnerPasswordCredentialsGrantType in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java:
public class ResourceOwnerPasswordCredentialsGrantType extends OAuth2GrantTypeBase {

    private static final Logger logger = Logger.getLogger(ResourceOwnerPasswordCredentialsGrantType.class);

    @Override
    public Response process(Context context) {
        setContext(context);

        event.detail(Details.AUTH_METHOD, ""oauth_credentials"");

        if (!client.isDirectAccessGrantsEnabled()) {
            String errorMessage = ""Client not allowed for direct access grants"";
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.NOT_ALLOWED);
            throw new CorsErrorResponseException(cors, OAuthErrorException.UNAUTHORIZED_CLIENT, errorMessage, Response.Status.BAD_REQUEST);
        }

        if (client.isConsentRequired()) {
            String er","[Medium] field DefaultTokenContextEncoderProviderFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
private final DefaultTokenContextEncoderProviderFactory factory;
---
[Medium] field DefaultTokenContextEncoderProvider in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
private DefaultTokenContextEncoderProvider provider;
---
[Medium] method getTokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public TokenType getTokenType() {
        return tokenType;
    }
---
[Medium] method getGrantType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getGrantType() {
        return grantType;
    }
---
[Medium] method getTokenContextFromClientSessionContext in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId);
---
[Medium] method getTokenContextFromTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
AccessTokenContext getTokenContextFromTokenId(String encodedTokenId);
---
[Medium] method encodeTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
String encodeTokenId(AccessTokenContext tokenContext);
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""pc"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] class DefaultTokenContextEncoderProvider in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
public class DefaultTokenContextEncoderProvider implements TokenContextEncoderProvider {

    public static final String UNKNOWN = ""na"";

    private final KeycloakSession session;
    private final DefaultTokenContextEncoderProviderFactory factory;

    public DefaultTokenContextEncoderProvider(KeycloakSession session,
                                              DefaultTokenContextEncoderProviderFactory factory) {
        this.session = session;
        this.factory = factory;
    }

    @Ove
---
[Medium] field KeycloakSession in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
private final KeycloakSession session;
---
[Medium] method exchangeClientToOIDCClient in services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java:
@Override
    protected Response exchangeClientToOIDCClient(UserModel targetUser, UserSessionModel targetUserSession, String requestedTokenType,
                                                  List<ClientModel> targetAudienceClients, String scope) {
        RootAuthenticationSessionModel rootAuthSession = new AuthenticationSessionManager(session).createAuthenticationSession(realm, false);
        AuthenticationSessionModel authSession = createSessionModel(targetUserSession, rootAuthSession, ta
---
[Medium] field KeycloakSessionFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
private KeycloakSessionFactory sessionFactory;
---
[Medium] method process in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java:
@Override
    public Response process(Context context) {
        setContext(context);

        event.detail(Details.AUTH_METHOD, ""oauth_credentials"");

        if (!client.isDirectAccessGrantsEnabled()) {
            String errorMessage = ""Client not allowed for direct access grants"";
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.NOT_ALLOWED);
            throw new CorsErrorResponseException(cors, OAuthErrorException.UNAUTHORIZED_CLIENT, errorMessage, Res
---
[Medium] method close in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public void close() {

    }
---
[Medium] method create in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public TokenContextEncoderProvider create(KeycloakSession session) {
        return new DefaultTokenContextEncoderProvider(session, this);
    }
---
[Medium] method postInit in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public void postInit(KeycloakSessionFactory factory) {
        this.sessionFactory = factory;
        grantsByShortcuts = new ConcurrentHashMap<>();
        grantsToShortcuts = new ConcurrentHashMap<>();

        factory.getProviderFactoriesStream(OAuth2GrantType.class)
                .forEach((factory1) -> {
                    OAuth2GrantTypeFactory gtf = (OAuth2GrantTypeFactory) factory1;
                    String grantName = gtf.getId();
                    String grantShortc
---
[Medium] method close in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public void close() {

    }
---
[Medium] method isInternal in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public boolean isInternal() {
        return true;
    }
---
[Medium] method getName in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public String getName() {
        return ""tokenContextEncoder"";
    }
---
[Medium] method getProviderClass in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public Class<? extends Provider> getProviderClass() {
        return TokenContextEncoderProvider.class;
    }
---
[Medium] method getProviderFactoryClass in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public Class<? extends ProviderFactory> getProviderFactoryClass() {
        return TokenContextEncoderProviderFactory.class;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ClientCredentialsGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""cc"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/PermissionGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""pg"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""ro"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/TokenExchangeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""te"";
    }
---
[Medium] method before in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Before
    public void before() {
        DefaultTokenContextEncoderProviderFactory factory = new DefaultTokenContextEncoderProviderFactory();
        factory.init(null);
        factory.grantsByShortcuts = new HashMap<>();
        factory.grantsByShortcuts.put(""ro"", OAuth2Constants.PASSWORD);
        factory.grantsByShortcuts.put(""cc"", OAuth2Constants.CLIENT_CREDENTIALS);
        factory.grantsByShortcuts.put(DefaultTokenContextEncoderProvider.UNKNOWN, DefaultTokenContextEncoderProvider.UNKNOW
---
[Medium] method testSuccessClientCredentialsToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testSuccessClientCredentialsToken() {
        String tokenId = ""trltcc:1234"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.TRANSIENT);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.LIGHTWEIGHT);
        Assert.assertEquals(ctx.getGrantType(), OAuth2Constants.CLIENT_CREDENTIALS);
        Assert.assertEquals(ctx.getRawTokenId(), ""12
---
[Medium] method testSuccessOfflineToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testSuccessOfflineToken() {
        String tokenId = ""ofrtro:5678"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.OFFLINE);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.REGULAR);
        Assert.assertEquals(ctx.getGrantType(), OAuth2Constants.PASSWORD);
        Assert.assertEquals(ctx.getRawTokenId(), ""5678"");

        Assert.asse
---
[Medium] method testIncorrectGrantType in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testIncorrectGrantType() {
        try {
            String tokenId = ""ofrtac:5678"";
            AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
            Assert.fail(""Not expected to success due incorrect grant type"");
        } catch (RuntimeException iae) {
            // ignored
        }
    }
---
[Medium] method testUnknownGrantType in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testUnknownGrantType() {
        String tokenId = ""onrtna:5678"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.ONLINE);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.REGULAR);
        Assert.assertEquals(ctx.getGrantType(), DefaultTokenContextEncoderProvider.UNKNOWN);
        Assert.assertEquals(ctx.getRawTokenId(), ""5678"");

     
---
[Medium] method testOldToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testOldToken() {
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(""1234"");
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.UNKNOWN);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.UNKNOWN);
        Assert.assertEquals(ctx.getGrantType(), DefaultTokenContextEncoderProvider.UNKNOWN);
        Assert.assertEquals(ctx.getRawTokenId(), ""1234"");

        try {
            provider.encodeTokenId(ctx)
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/models/Constants.java:
public static final String GRANT_TYPE = OAuth2Constants.GRANT_TYPE;
---
[Medium] class Constants in server-spi-private/src/main/java/org/keycloak/models/Constants.java:
public final class Constants {
    public static final String ADMIN_CONSOLE_CLIENT_ID = ""security-admin-console"";
    public static final String ADMIN_CLI_CLIENT_ID = ""admin-cli"";

    public static final String ACCOUNT_MANAGEMENT_CLIENT_ID = ""account"";
    public static final String ACCOUNT_CONSOLE_CLIENT_ID = ""account-console"";
    public static final String BROKER_SERVICE_CLIENT_ID = ""broker"";
    public static final String REALM_MANAGEMENT_CLIENT_ID = ""realm-management"";

    public static f
---
[Medium] constructor Context in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public Context(KeycloakSession session, Object clientConfig, Map<String, String> clientAuthAttributes,
                MultivaluedMap<String, String> formParams, EventBuilder event, Cors cors, Object tokenManager) {
            this.session = session;
            this.realm = session.getContext().getRealm();
            this.client = session.getContext().getClient();
            this.clientConfig = clientConfig;
            this.clientConnection = session.getContext().getConnection();
          
---
[Medium] class ClientCredentialsGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ClientCredentialsGrantTypeFactory.java:
public class ClientCredentialsGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.CLIENT_CREDENTIALS;
    }

    @Override
    public String getShortcut() {
        return ""cc"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new ClientCredentialsGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(Keycl
---
[Medium] class PermissionGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/PermissionGrantTypeFactory.java:
public class PermissionGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.UMA_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""pg"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new PermissionGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory 
---
[Medium] class ResourceOwnerPasswordCredentialsGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantTypeFactory.java:
public class ResourceOwnerPasswordCredentialsGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.PASSWORD;
    }

    @Override
    public String getShortcut() {
        return ""ro"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new ResourceOwnerPasswordCredentialsGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public
---
[Medium] class TokenExchangeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/TokenExchangeGrantTypeFactory.java:
public class TokenExchangeGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    @Override
    public String getId() {
        return OAuth2Constants.TOKEN_EXCHANGE_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""te"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new TokenExchangeGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
     ","OAuth2GrantType (Critical), expectRefresh (Critical), expectCodeToToken (Critical), OAuth2GrantTypeFactory (Critical), AccessTokenContext (Critical), AbstractOIDCProtocolMapper (Critical), TokenContextEncoderProvider (Critical), AssertEvents (Critical), PreAuthorizedCodeGrantTypeFactory (Critical), getSessionType (Critical), getTokenContextFromTokenId (Critical), OAuth2GrantTypeBase (Critical), PreAuthorizedCodeGrantType (Critical), getShouldUseLightweightToken (Critical), createTokenResponse (Critical), getShortcut (High), getRawTokenId (High), encodeTokenId (High), expectAuthReqIdToToken (High), initToken (High), isAccessTokenId (High), validateToken (High), Context (High), TokenManager (High), transformAccessToken (High), AuthorizationCodeGrantTypeFactory (High), RefreshTokenGrantTypeFactory (High), CibaGrantTypeFactory (High), DeviceGrantTypeFactory (High), TokenContextEncoderProviderFactory (High), SessionType (High), TokenType (High), SessionType (High), getShortcut (High), TokenType (High), getTokenContextFromClientSessionContext (High), getId (High), getSessionTypeByShortcut (High), getTokenTypeByShortcut (High), getShortcutByGrantType (High), getGrantTypeByShortcut (High), getGrantType (High), process (High), expectDeviceCodeToToken (High), StandardTokenExchangeProvider (High), ResourceOwnerPasswordCredentialsGrantType (High), DefaultTokenContextEncoderProviderFactory (Medium), DefaultTokenContextEncoderProvider (Medium), getTokenType (Medium), getGrantType (Medium), getTokenContextFromClientSessionContext (Medium), getTokenContextFromTokenId (Medium), encodeTokenId (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), DefaultTokenContextEncoderProvider (Medium), KeycloakSession (Medium), exchangeClientToOIDCClient (Medium), KeycloakSessionFactory (Medium), process (Medium), close (Medium), create (Medium), postInit (Medium), close (Medium), isInternal (Medium), getName (Medium), getProviderClass (Medium), getProviderFactoryClass (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), before (Medium), testSuccessClientCredentialsToken (Medium), testSuccessOfflineToken (Medium), testIncorrectGrantType (Medium), testUnknownGrantType (Medium), testOldToken (Medium), String (Medium), Constants (Medium), Context (Medium), ClientCredentialsGrantTypeFactory (Medium), PermissionGrantTypeFactory (Medium), ResourceOwnerPasswordCredentialsGrantTypeFactory (Medium), TokenExchangeGrantTypeFactory (Medium), lines 21-36 (Low), String (Low), String (Low), String (Low), String (Low), SessionType (Low), String (Low), TokenType (Low), getShortcut (Low), AccessTokenContext (Low), String (Low), DefaultTokenContextEncoderProvider (Low), DefaultTokenContextEncoderProviderFactory (Low), init (Low), TokenContextEncoderSpi (Low), String (Low), String (Low), String (Low), String (Low), lines 1-20 (Low), DefaultTokenContextEncoderProviderTest (Low)",match,"isAccessTokenId is part of the OAuth2GrantType hierarchy, 46 HC entities"
keycloak,8,Implement access token context encoding framework,"Javadoc mentions ""usually like 3-letters shortcut"" but some implementations use 2-letter shortcuts (""ac"", ""cc"", ""rt"", ""te"", ""pc"", ""ci"", ""ro""). Consider updating documentation to reflect actual usage pattern.",Low,109,46,42,"interface::OAuth2GrantType (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [Critical, score=1.00] | method::expectRefresh (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=1.00] | method::expectCodeToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=1.00] | interface::OAuth2GrantTypeFactory (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java) [Critical, score=0.94] | class::AccessTokenContext (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [Critical, score=0.94] | class::AbstractOIDCProtocolMapper (services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java) [Critical, score=0.92] | interface::TokenContextEncoderProvider (services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java) [Critical, score=0.89] | class::AssertEvents (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=0.88] | class::PreAuthorizedCodeGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java) [Critical, score=0.84] | method::getSessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [Critical, score=0.81] | method::getTokenContextFromTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [Critical, score=0.77] | class::OAuth2GrantTypeBase (services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java) [Critical, score=0.77] | class::PreAuthorizedCodeGrantType (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java) [Critical, score=0.74] | method::getShouldUseLightweightToken (services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java) [Critical, score=0.74] | method::createTokenResponse (services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java) [Critical, score=0.72] | method::getShortcut (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java) [High, score=0.68] | method::getRawTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.68] | method::encodeTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [High, score=0.68] | method::expectAuthReqIdToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.68] | method::initToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.65] | method::isAccessTokenId (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.62] | method::validateToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.62] | class::Context (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [High, score=0.57] | class::TokenManager (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.57] | method::transformAccessToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.57] | class::AuthorizationCodeGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java) [High, score=0.57] | class::RefreshTokenGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java) [High, score=0.57] | class::CibaGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java) [High, score=0.57] | class::DeviceGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java) [High, score=0.57] | interface::TokenContextEncoderProviderFactory (services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProviderFactory.java) [High, score=0.57] | field::SessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | field::TokenType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | enum::SessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | method::getShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | enum::TokenType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | method::getTokenContextFromClientSessionContext (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [High, score=0.56] | method::getId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getSessionTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getTokenTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getShortcutByGrantType (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getGrantTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getGrantType (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [High, score=0.51] | method::process (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java) [High, score=0.51] | method::expectDeviceCodeToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.51] | class::StandardTokenExchangeProvider (services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java) [High, score=0.51] | class::ResourceOwnerPasswordCredentialsGrantType (services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java) [High, score=0.51]","[Critical] interface OAuth2GrantType in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public interface OAuth2GrantType extends Provider {

    /**
     * Returns the event type associated with this OAuth 2.0 grant type.
     *
     * @return event type
     */
    EventType getEventType();

    /**
     * @return request parameters, which can be duplicated for the particular grant type. The grant request is typically rejected if
     * request contains multiple values of some parameter, which is not listed here
     */
    default Set<String> getSupportedMultivaluedRequestParameters() {
        return Collections.emptySet();
    }

    /**
     * Processes grant request.
     * @param context grant request context
     *
     * @return token response
     */
    Response process(Context context);

    public static class Context {
        protected KeycloakSession session;

---
[Critical] method expectRefresh in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectRefresh(String refreshTokenId, String sessionId) {
        return expect(EventType.REFRESH_TOKEN)
                .detail(Details.TOKEN_ID, isAccessTokenId(RefreshTokenGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, refreshTokenId)
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.UPDATED_REFRESH_TOKEN_ID, isUUID())
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(sessionId);
    }
---
[Critical] method expectCodeToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectCodeToToken(String codeId, String sessionId) {
        return expect(EventType.CODE_TO_TOKEN)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(AuthorizationCodeGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(sessionId);
    }
---
[Critical] interface OAuth2GrantTypeFactory in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java:
public interface OAuth2GrantTypeFactory extends ProviderFactory<OAuth2GrantType> {

    /**
     * @return usually like 3-letters shortcut of specific grants. It can be useful for example in the tokens when the amount of characters should be limited and hence using full grant name
     * is not ideal. Shortcut should be unique across grants.
     */
    String getShortcut();
}
---
[Critical] class AccessTokenContext in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public class AccessTokenContext {

    private final SessionType sessionType;
    private final TokenType tokenType;
    private final String grantType;
    private final String rawTokenId;

    public enum SessionType {
        ONLINE(""on""),
        OFFLINE(""of""),
        TRANSIENT(""tr""),
        UNKNOWN(""un"");

        private final String shortcut;

        SessionType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }

    public enum TokenType {
        REGULAR(""rt""),
        LIGHTWEIGHT(""lt""),
        UNKNOWN(""un"");

        private final String shortcut;

        TokenType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
       
---
[Critical] class AbstractOIDCProtocolMapper in services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java:
public abstract class AbstractOIDCProtocolMapper implements ProtocolMapper {

    public static final String TOKEN_MAPPER_CATEGORY = ""Token mapper"";

    @Override
    public String getProtocol() {
        return OIDCLoginProtocol.LOGIN_PROTOCOL;
    }

    @Override
    public void close() {

    }

    @Override
    public final ProtocolMapper create(KeycloakSession session) {
        throw new RuntimeException(""UNSUPPORTED METHOD"");
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {

    }

    public AccessToken transformUserInfoToken(AccessToken token, ProtocolMapperModel mappingModel, KeycloakSession session,
                                              UserSessionModel userSession, ClientS
---
[Critical] interface TokenContextEncoderProvider in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
public interface TokenContextEncoderProvider extends Provider {

    AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId);

    AccessTokenContext getTokenContextFromTokenId(String encodedTokenId);

    String encodeTokenId(AccessTokenContext tokenContext);
}
---
[Critical] class AssertEvents in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public class AssertEvents implements TestRule {

    public static final String DEFAULT_CLIENT_ID = ""test-app"";
    public static final String DEFAULT_IP_ADDRESS = ""127.0.0.1"";
    public static final String DEFAULT_IP_ADDRESS_V6 = ""0:0:0:0:0:0:0:1"";
    public static final String DEFAULT_IP_ADDRESS_V6_SHORT = ""::1"";
    public static final String DEFAULT_REALM = ""test"";
    public static final String DEFAULT_USERNAME = ""test-user@localhost"";

    public static final String DEFAULT_REDIRECT_URI = getAuthServerContextRoot() + ""/auth/realms/master/app/auth"";

    private AbstractKeycloakTest context;

    public AssertEvents(AbstractKeycloakTest ctx) {
        context = ctx;
    }

    @Override
    public Statement apply(final Statement base, org.junit.runner.Description description) {
    
---
[Critical] class PreAuthorizedCodeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java:
public class PreAuthorizedCodeGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_TYPE = ""urn:ietf:params:oauth:grant-type:pre-authorized_code"";
    public static final String CODE_REQUEST_PARAM = ""pre-authorized_code"";

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new PreAuthorizedCodeGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

    @Override
    public String getId() {
        return GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""pc"";
    }

    @Override
    public boo
---
[Critical] method getSessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public SessionType getSessionType() {
        return sessionType;
    }
---
[Critical] method getTokenContextFromTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public AccessTokenContext getTokenContextFromTokenId(String encodedTokenId) {
        int indexOf = encodedTokenId.indexOf(':');
        if (indexOf == -1) {
            return new AccessTokenContext(AccessTokenContext.SessionType.UNKNOWN, AccessTokenContext.TokenType.UNKNOWN, UNKNOWN, encodedTokenId);
        } else {
            String encodedContext = encodedTokenId.substring(0, indexOf);
            String rawId = encodedTokenId.substring(indexOf + 1);

            if (encodedContext.length() != 6) {
                throw new IllegalArgumentException(""Incorrect token id: '"" + encodedTokenId + ""'. Expected length of 6."");
            }

            // First 2 chars are ""sessionType"", next 2 chars ""tokenType"", last 2 chars ""grantType""
            String stShortcut = encoded
---
[Critical] class OAuth2GrantTypeBase in services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java:
public abstract class OAuth2GrantTypeBase implements OAuth2GrantType {

    private static final Logger logger = Logger.getLogger(OAuth2GrantTypeBase.class);

    protected OAuth2GrantType.Context context;

    protected KeycloakSession session;
    protected RealmModel realm;
    protected ClientModel client;
    protected OIDCAdvancedConfigWrapper clientConfig;
    protected ClientConnection clientConnection;
    protected Map<String, String> clientAuthAttributes;
    protected MultivaluedMap<String, String> formParams;
    protected EventBuilder event;
    protected Cors cors;
    protected TokenManager tokenManager;
    protected HttpRequest request;
    protected HttpResponse response;
    protected HttpHeaders headers;

    protected void setContext(Context context) {
        this.co
---
[Critical] class PreAuthorizedCodeGrantType in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java:
public class PreAuthorizedCodeGrantType extends OAuth2GrantTypeBase {

    private static final Logger LOGGER = Logger.getLogger(PreAuthorizedCodeGrantType.class);

    public static final String VC_ISSUANCE_FLOW = ""VC-Issuance-Flow"";

    @Override
    public Response process(Context context) {
        LOGGER.debug(""Process grant request for preauthorized."");
        setContext(context);

        // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
        String code = formParams.getFirst(PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM);

        if (code == null) {
            // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
            String errorMessage = ""Missing parameter: "" + P
---
[Critical] method getShouldUseLightweightToken in services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java:
public static boolean getShouldUseLightweightToken(KeycloakSession session) {
        Object attributeValue = session.getAttribute(Constants.USE_LIGHTWEIGHT_ACCESS_TOKEN_ENABLED);
        return Boolean.parseBoolean(session.getContext().getClient().getAttribute(Constants.USE_LIGHTWEIGHT_ACCESS_TOKEN_ENABLED)) || (attributeValue != null && (boolean) attributeValue);
    }
---
[Critical] method createTokenResponse in services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java:
protected Response createTokenResponse(UserModel user, UserSessionModel userSession, ClientSessionContext clientSessionCtx,
        String scopeParam, boolean code, Function<TokenManager.AccessTokenResponseBuilder, ClientPolicyContext> clientPolicyContextGenerator) {
        clientSessionCtx.setAttribute(Constants.GRANT_TYPE, context.getGrantType());
        AccessToken token = tokenManager.createClientAccessToken(session, realm, client, user, userSession, clientSessionCtx);

        TokenManager.AccessTokenResponseBuilder responseBuilder = tokenManager
            .responseBuilder(realm, client, event, session, userSession, clientSessionCtx).accessToken(token);
        boolean useRefreshToken = clientConfig.isUseRefreshToken();
        if (useRefreshToken) {
            responseBuilder.ge
---
[High] method getShortcut in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java:
String getShortcut();
---
[High] method getRawTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getRawTokenId() {
        return rawTokenId;
    }
---
[High] method encodeTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public String encodeTokenId(AccessTokenContext tokenContext) {
        if (tokenContext.getSessionType() == AccessTokenContext.SessionType.UNKNOWN) {
            throw new IllegalStateException(""Cannot encode token with unknown sessionType"");
        }
        if (tokenContext.getTokenType() == AccessTokenContext.TokenType.UNKNOWN) {
            throw new IllegalStateException(""Cannot encode token with unknown tokenType"");
        }

        String grantShort = factory.getShortcutByGrantType(tokenContext.getGrantType());
        if (grantShort == null) {
            throw new IllegalStateException(""Cannot encode token with unknown grantType: "" + tokenContext.getGrantType());
        }

        return tokenContext.getSessionType().getShortcut() +
                tokenContext.g
---
[High] method expectAuthReqIdToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectAuthReqIdToToken(String codeId, String sessionId) {
        return expect(EventType.AUTHREQID_TO_TOKEN)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(CibaGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(isUUID());
    }
---
[High] method initToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
protected AccessToken initToken(KeycloakSession session, RealmModel realm, ClientModel client, UserModel user, UserSessionModel userSession,
                                    ClientSessionContext clientSessionCtx, UriInfo uriInfo) {
        AccessToken token = new AccessToken();

        TokenContextEncoderProvider encoder = session.getProvider(TokenContextEncoderProvider.class);
        AccessTokenContext tokenCtx = encoder.getTokenContextFromClientSessionContext(clientSessionCtx, KeycloakModelUtils.generateId());
        token.id(encoder.encodeTokenId(tokenCtx));

        token.type(formatTokenType(client, token));
        if (UserSessionModel.SessionPersistenceState.TRANSIENT.equals(userSession.getPersistenceState())) {
            token.subject(user.getId());
        }
        token.
---
[High] method isAccessTokenId in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public static Matcher<String> isAccessTokenId(String expectedGrantShortcut) {
        return new TypeSafeMatcher<String>() {
            @Override
            protected boolean matchesSafely(String item) {
                String[] items = item.split("":"");
                if (items.length != 2) return false;
                // Grant type shortcut starts at character 4th char and is 2-chars long
                if (items[0].substring(3, 5).equals(expectedGrantShortcut)) return false;
                return isUUID().matches(items[1]);
            }

            @Override
            public void describeTo(Description description) {
                description.appendText(""Not a Token ID with expected grant: "" + expectedGrantShortcut);
            }
        };
    }
---
[High] method validateToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public TokenValidation validateToken(KeycloakSession session, UriInfo uriInfo, ClientConnection connection, RealmModel realm,
                                         RefreshToken oldToken, HttpHeaders headers, String oldTokenScope) throws OAuthErrorException {
        UserSessionModel userSession = null;
        boolean offline = TokenUtil.TOKEN_TYPE_OFFLINE.equals(oldToken.getType());

        if (offline) {

            UserSessionManager sessionManager = new UserSessionManager(session);
            userSession = sessionManager.findOfflineUserSession(realm, oldToken.getSessionState());
            if (userSession != null) {

                // Revoke timeouted offline userSession
                if (!AuthenticationManager.isSessionValid(realm, userSession)) {
                    session
---
[High] class Context in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public static class Context {
        protected KeycloakSession session;
        protected RealmModel realm;
        protected ClientModel client;
        protected Object clientConfig;
        protected ClientConnection clientConnection;
        protected Map<String, String> clientAuthAttributes;
        protected HttpRequest request;
        protected HttpResponse response;
        protected HttpHeaders headers;
        protected MultivaluedMap<String, String> formParams;
        protected EventBuilder event;
        protected Cors cors;
        protected Object tokenManager;
        protected String grantType;

        public Context(KeycloakSession session, Object clientConfig, Map<String, String> clientAuthAttributes,
                MultivaluedMap<String, String> formParams, EventBui
---
[High] class TokenManager in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public class TokenManager {
    private static final Logger logger = Logger.getLogger(TokenManager.class);

    public static class TokenValidation {
        public final UserModel user;
        public final UserSessionModel userSession;
        public final ClientSessionContext clientSessionCtx;
        public final AccessToken newToken;

        public TokenValidation(UserModel user, UserSessionModel userSession, ClientSessionContext clientSessionCtx, AccessToken newToken) {
            this.user = user;
            this.userSession = userSession;
            this.clientSessionCtx = clientSessionCtx;
            this.newToken = newToken;
        }
    }

    public TokenValidation validateToken(KeycloakSession session, UriInfo uriInfo, ClientConnection connection, RealmModel realm,
     
---
[High] method transformAccessToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public AccessToken transformAccessToken(KeycloakSession session, AccessToken token,
                                            UserSessionModel userSession, ClientSessionContext clientSessionCtx) {
        AccessToken accessToken = ProtocolMapperUtils.getSortedProtocolMappers(session, clientSessionCtx, mapper -> mapper.getValue() instanceof OIDCAccessTokenMapper)
                .collect(new TokenCollector<AccessToken>(token) {
                    @Override
                    protected AccessToken applyMapper(AccessToken token, Map.Entry<ProtocolMapperModel, ProtocolMapper> mapper) {
                        return ((OIDCAccessTokenMapper) mapper.getValue()).transformAccessToken(token, mapper.getKey(), session, userSession, clientSessionCtx);
                    }
                });
    
---
[High] class AuthorizationCodeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java:
public class AuthorizationCodeGrantTypeFactory implements OAuth2GrantTypeFactory {

    public static final String GRANT_SHORTCUT = ""ac"";

    @Override
    public String getId() {
        return OAuth2Constants.AUTHORIZATION_CODE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new AuthorizationCodeGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class RefreshTokenGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java:
public class RefreshTokenGrantTypeFactory implements OAuth2GrantTypeFactory {

    public static final String GRANT_SHORTCUT = ""rt"";

    @Override
    public String getId() {
        return OAuth2Constants.REFRESH_TOKEN;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new RefreshTokenGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class CibaGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java:
public class CibaGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_SHORTCUT = ""ci"";

    @Override
    public String getId() {
        return OAuth2Constants.CIBA_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new CibaGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
        return Profile.isFeatureEnabled(Profile.Feature.CIBA);
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class DeviceGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java:
public class DeviceGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_SHORTCUT = ""dg"";

    @Override
    public String getId() {
        return OAuth2Constants.DEVICE_CODE_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new DeviceGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
        return Profile.isFeatureEnabled(Profile.Feature.DEVICE_FLOW);
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close
---
[High] interface TokenContextEncoderProviderFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProviderFactory.java:
public interface TokenContextEncoderProviderFactory extends ProviderFactory<TokenContextEncoderProvider> {
}
---
[High] field SessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
private final SessionType sessionType;
---
[High] field TokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
private final TokenType tokenType;
---
[High] enum SessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public enum SessionType {
        ONLINE(""on""),
        OFFLINE(""of""),
        TRANSIENT(""tr""),
        UNKNOWN(""un"");

        private final String shortcut;

        SessionType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }
---
[High] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getShortcut() {
            return shortcut;
        }
---
[High] enum TokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public enum TokenType {
        REGULAR(""rt""),
        LIGHTWEIGHT(""lt""),
        UNKNOWN(""un"");

        private final String shortcut;

        TokenType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }
---
[High] method getTokenContextFromClientSessionContext in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId) {
        AccessTokenContext.SessionType sessionType;
        UserSessionModel userSession = clientSessionContext.getClientSession().getUserSession();
        if (userSession.getPersistenceState() == UserSessionModel.SessionPersistenceState.TRANSIENT) {
            sessionType = AccessTokenContext.SessionType.TRANSIENT;
        } else {
            sessionType = userSession.isOffline() ? AccessTokenContext.SessionType.OFFLINE : AccessTokenContext.SessionType.ONLINE;
        }

        boolean useLightweightToken = AbstractOIDCProtocolMapper.getShouldUseLightweightToken(session);
        AccessTokenContext.TokenType tokenType = useLightweightToken ? A
---
[High] method getId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public String getId() {
        return ""default"";
    }
---
[High] method getSessionTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected AccessTokenContext.SessionType getSessionTypeByShortcut(String sessionTypeShortcut) {
        return sessionTypesByShortcut.get(sessionTypeShortcut);
    }
---
[High] method getTokenTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected AccessTokenContext.TokenType getTokenTypeByShortcut(String tokenTypeShortcut) {
        return tokenTypesByShortcut.get(tokenTypeShortcut);
    }
---
[High] method getShortcutByGrantType in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected String getShortcutByGrantType(String grantType) {
        String grantShortcut = grantsToShortcuts.get(grantType);
        if (grantShortcut == null) {
            // Refresh maps in case new grant type was deployed
            OAuth2GrantTypeFactory factory = (OAuth2GrantTypeFactory) sessionFactory.getProviderFactory(OAuth2GrantType.class, grantType);
            if (factory != null) {
                String shortcut = factory.getShortcut();
                grantsByShortcuts.put(shortcut, grantType);
                grantsToShortcuts.put(grantType, shortcut);
            }
            grantShortcut = grantsToShortcuts.get(grantType);
        }
        return grantShortcut;
    }
---
[High] method getGrantTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected String getGrantTypeByShortcut(String shortcut) {
        String grantType = grantsByShortcuts.get(shortcut);
        if (grantType == null) {
            // Refresh maps in case new grant type was deployed
            sessionFactory.getProviderFactoriesStream(OAuth2GrantType.class)
                    .map(fct -> (OAuth2GrantTypeFactory) fct)
                    .filter(fct -> shortcut.equals(fct.getShortcut()))
                    .map(OAuth2GrantTypeFactory::getId)
                    .findFirst()
                    .ifPresent(newGrantType -> {
                        grantsByShortcuts.put(shortcut, newGrantType);
                        grantsToShortcuts.put(newGrantType, shortcut);
                    });
            grantType = grantsByShortcuts.get(shortcut);
        }
   
---
[High] method getGrantType in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public String getGrantType() {
            return grantType;
        }
---
[High] method process in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java:
@Override
    public Response process(Context context) {
        LOGGER.debug(""Process grant request for preauthorized."");
        setContext(context);

        // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
        String code = formParams.getFirst(PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM);

        if (code == null) {
            // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
            String errorMessage = ""Missing parameter: "" + PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM;
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.INVALID_CODE);
            throw new CorsErrorResponseException(cors, OAuthErrorException.INVALID_RE
---
[High] method expectDeviceCodeToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectDeviceCodeToToken(String clientId, String codeId, String userId) {
        return expect(EventType.OAUTH2_DEVICE_CODE_TO_TOKEN)
                .client(clientId)
                .user(userId)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(DeviceGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(codeId);
    }
---
[High] class StandardTokenExchangeProvider in services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java:
public class StandardTokenExchangeProvider extends AbstractTokenExchangeProvider {

    @Override
    public boolean supports(TokenExchangeContext context) {
        return true;
    }

    @Override
    protected Response tokenExchange() {
        KeycloakSession session = context.getSession();
        RealmModel realm = context.getRealm();
        ClientConnection clientConnection = context.getClientConnection();
        Cors cors = context.getCors();
        EventBuilder event = context.getEvent();

        if(!OIDCAdvancedConfigWrapper.fromClientModel(context.getClient()).isStandardTokenExchangeEnabled()) {
            event.detail(Details.REASON, ""Standard token exchange is not enabled for the requested client"");
            event.error(Errors.INVALID_REQUEST);
            throw new C
---
[High] class ResourceOwnerPasswordCredentialsGrantType in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java:
public class ResourceOwnerPasswordCredentialsGrantType extends OAuth2GrantTypeBase {

    private static final Logger logger = Logger.getLogger(ResourceOwnerPasswordCredentialsGrantType.class);

    @Override
    public Response process(Context context) {
        setContext(context);

        event.detail(Details.AUTH_METHOD, ""oauth_credentials"");

        if (!client.isDirectAccessGrantsEnabled()) {
            String errorMessage = ""Client not allowed for direct access grants"";
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.NOT_ALLOWED);
            throw new CorsErrorResponseException(cors, OAuthErrorException.UNAUTHORIZED_CLIENT, errorMessage, Response.Status.BAD_REQUEST);
        }

        if (client.isConsentRequired()) {
            String er","[Medium] field DefaultTokenContextEncoderProviderFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
private final DefaultTokenContextEncoderProviderFactory factory;
---
[Medium] field DefaultTokenContextEncoderProvider in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
private DefaultTokenContextEncoderProvider provider;
---
[Medium] method getTokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public TokenType getTokenType() {
        return tokenType;
    }
---
[Medium] method getGrantType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getGrantType() {
        return grantType;
    }
---
[Medium] method getTokenContextFromClientSessionContext in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId);
---
[Medium] method getTokenContextFromTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
AccessTokenContext getTokenContextFromTokenId(String encodedTokenId);
---
[Medium] method encodeTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
String encodeTokenId(AccessTokenContext tokenContext);
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""pc"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] class DefaultTokenContextEncoderProvider in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
public class DefaultTokenContextEncoderProvider implements TokenContextEncoderProvider {

    public static final String UNKNOWN = ""na"";

    private final KeycloakSession session;
    private final DefaultTokenContextEncoderProviderFactory factory;

    public DefaultTokenContextEncoderProvider(KeycloakSession session,
                                              DefaultTokenContextEncoderProviderFactory factory) {
        this.session = session;
        this.factory = factory;
    }

    @Ove
---
[Medium] field KeycloakSession in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
private final KeycloakSession session;
---
[Medium] method exchangeClientToOIDCClient in services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java:
@Override
    protected Response exchangeClientToOIDCClient(UserModel targetUser, UserSessionModel targetUserSession, String requestedTokenType,
                                                  List<ClientModel> targetAudienceClients, String scope) {
        RootAuthenticationSessionModel rootAuthSession = new AuthenticationSessionManager(session).createAuthenticationSession(realm, false);
        AuthenticationSessionModel authSession = createSessionModel(targetUserSession, rootAuthSession, ta
---
[Medium] field KeycloakSessionFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
private KeycloakSessionFactory sessionFactory;
---
[Medium] method process in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java:
@Override
    public Response process(Context context) {
        setContext(context);

        event.detail(Details.AUTH_METHOD, ""oauth_credentials"");

        if (!client.isDirectAccessGrantsEnabled()) {
            String errorMessage = ""Client not allowed for direct access grants"";
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.NOT_ALLOWED);
            throw new CorsErrorResponseException(cors, OAuthErrorException.UNAUTHORIZED_CLIENT, errorMessage, Res
---
[Medium] method close in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public void close() {

    }
---
[Medium] method create in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public TokenContextEncoderProvider create(KeycloakSession session) {
        return new DefaultTokenContextEncoderProvider(session, this);
    }
---
[Medium] method postInit in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public void postInit(KeycloakSessionFactory factory) {
        this.sessionFactory = factory;
        grantsByShortcuts = new ConcurrentHashMap<>();
        grantsToShortcuts = new ConcurrentHashMap<>();

        factory.getProviderFactoriesStream(OAuth2GrantType.class)
                .forEach((factory1) -> {
                    OAuth2GrantTypeFactory gtf = (OAuth2GrantTypeFactory) factory1;
                    String grantName = gtf.getId();
                    String grantShortc
---
[Medium] method close in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public void close() {

    }
---
[Medium] method isInternal in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public boolean isInternal() {
        return true;
    }
---
[Medium] method getName in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public String getName() {
        return ""tokenContextEncoder"";
    }
---
[Medium] method getProviderClass in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public Class<? extends Provider> getProviderClass() {
        return TokenContextEncoderProvider.class;
    }
---
[Medium] method getProviderFactoryClass in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public Class<? extends ProviderFactory> getProviderFactoryClass() {
        return TokenContextEncoderProviderFactory.class;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ClientCredentialsGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""cc"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/PermissionGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""pg"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""ro"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/TokenExchangeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""te"";
    }
---
[Medium] method before in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Before
    public void before() {
        DefaultTokenContextEncoderProviderFactory factory = new DefaultTokenContextEncoderProviderFactory();
        factory.init(null);
        factory.grantsByShortcuts = new HashMap<>();
        factory.grantsByShortcuts.put(""ro"", OAuth2Constants.PASSWORD);
        factory.grantsByShortcuts.put(""cc"", OAuth2Constants.CLIENT_CREDENTIALS);
        factory.grantsByShortcuts.put(DefaultTokenContextEncoderProvider.UNKNOWN, DefaultTokenContextEncoderProvider.UNKNOW
---
[Medium] method testSuccessClientCredentialsToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testSuccessClientCredentialsToken() {
        String tokenId = ""trltcc:1234"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.TRANSIENT);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.LIGHTWEIGHT);
        Assert.assertEquals(ctx.getGrantType(), OAuth2Constants.CLIENT_CREDENTIALS);
        Assert.assertEquals(ctx.getRawTokenId(), ""12
---
[Medium] method testSuccessOfflineToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testSuccessOfflineToken() {
        String tokenId = ""ofrtro:5678"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.OFFLINE);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.REGULAR);
        Assert.assertEquals(ctx.getGrantType(), OAuth2Constants.PASSWORD);
        Assert.assertEquals(ctx.getRawTokenId(), ""5678"");

        Assert.asse
---
[Medium] method testIncorrectGrantType in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testIncorrectGrantType() {
        try {
            String tokenId = ""ofrtac:5678"";
            AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
            Assert.fail(""Not expected to success due incorrect grant type"");
        } catch (RuntimeException iae) {
            // ignored
        }
    }
---
[Medium] method testUnknownGrantType in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testUnknownGrantType() {
        String tokenId = ""onrtna:5678"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.ONLINE);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.REGULAR);
        Assert.assertEquals(ctx.getGrantType(), DefaultTokenContextEncoderProvider.UNKNOWN);
        Assert.assertEquals(ctx.getRawTokenId(), ""5678"");

     
---
[Medium] method testOldToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testOldToken() {
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(""1234"");
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.UNKNOWN);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.UNKNOWN);
        Assert.assertEquals(ctx.getGrantType(), DefaultTokenContextEncoderProvider.UNKNOWN);
        Assert.assertEquals(ctx.getRawTokenId(), ""1234"");

        try {
            provider.encodeTokenId(ctx)
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/models/Constants.java:
public static final String GRANT_TYPE = OAuth2Constants.GRANT_TYPE;
---
[Medium] class Constants in server-spi-private/src/main/java/org/keycloak/models/Constants.java:
public final class Constants {
    public static final String ADMIN_CONSOLE_CLIENT_ID = ""security-admin-console"";
    public static final String ADMIN_CLI_CLIENT_ID = ""admin-cli"";

    public static final String ACCOUNT_MANAGEMENT_CLIENT_ID = ""account"";
    public static final String ACCOUNT_CONSOLE_CLIENT_ID = ""account-console"";
    public static final String BROKER_SERVICE_CLIENT_ID = ""broker"";
    public static final String REALM_MANAGEMENT_CLIENT_ID = ""realm-management"";

    public static f
---
[Medium] constructor Context in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public Context(KeycloakSession session, Object clientConfig, Map<String, String> clientAuthAttributes,
                MultivaluedMap<String, String> formParams, EventBuilder event, Cors cors, Object tokenManager) {
            this.session = session;
            this.realm = session.getContext().getRealm();
            this.client = session.getContext().getClient();
            this.clientConfig = clientConfig;
            this.clientConnection = session.getContext().getConnection();
          
---
[Medium] class ClientCredentialsGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ClientCredentialsGrantTypeFactory.java:
public class ClientCredentialsGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.CLIENT_CREDENTIALS;
    }

    @Override
    public String getShortcut() {
        return ""cc"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new ClientCredentialsGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(Keycl
---
[Medium] class PermissionGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/PermissionGrantTypeFactory.java:
public class PermissionGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.UMA_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""pg"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new PermissionGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory 
---
[Medium] class ResourceOwnerPasswordCredentialsGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantTypeFactory.java:
public class ResourceOwnerPasswordCredentialsGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.PASSWORD;
    }

    @Override
    public String getShortcut() {
        return ""ro"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new ResourceOwnerPasswordCredentialsGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public
---
[Medium] class TokenExchangeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/TokenExchangeGrantTypeFactory.java:
public class TokenExchangeGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    @Override
    public String getId() {
        return OAuth2Constants.TOKEN_EXCHANGE_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""te"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new TokenExchangeGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
     ","OAuth2GrantType (Critical), expectRefresh (Critical), expectCodeToToken (Critical), OAuth2GrantTypeFactory (Critical), AccessTokenContext (Critical), AbstractOIDCProtocolMapper (Critical), TokenContextEncoderProvider (Critical), AssertEvents (Critical), PreAuthorizedCodeGrantTypeFactory (Critical), getSessionType (Critical), getTokenContextFromTokenId (Critical), OAuth2GrantTypeBase (Critical), PreAuthorizedCodeGrantType (Critical), getShouldUseLightweightToken (Critical), createTokenResponse (Critical), getShortcut (High), getRawTokenId (High), encodeTokenId (High), expectAuthReqIdToToken (High), initToken (High), isAccessTokenId (High), validateToken (High), Context (High), TokenManager (High), transformAccessToken (High), AuthorizationCodeGrantTypeFactory (High), RefreshTokenGrantTypeFactory (High), CibaGrantTypeFactory (High), DeviceGrantTypeFactory (High), TokenContextEncoderProviderFactory (High), SessionType (High), TokenType (High), SessionType (High), getShortcut (High), TokenType (High), getTokenContextFromClientSessionContext (High), getId (High), getSessionTypeByShortcut (High), getTokenTypeByShortcut (High), getShortcutByGrantType (High), getGrantTypeByShortcut (High), getGrantType (High), process (High), expectDeviceCodeToToken (High), StandardTokenExchangeProvider (High), ResourceOwnerPasswordCredentialsGrantType (High), DefaultTokenContextEncoderProviderFactory (Medium), DefaultTokenContextEncoderProvider (Medium), getTokenType (Medium), getGrantType (Medium), getTokenContextFromClientSessionContext (Medium), getTokenContextFromTokenId (Medium), encodeTokenId (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), DefaultTokenContextEncoderProvider (Medium), KeycloakSession (Medium), exchangeClientToOIDCClient (Medium), KeycloakSessionFactory (Medium), process (Medium), close (Medium), create (Medium), postInit (Medium), close (Medium), isInternal (Medium), getName (Medium), getProviderClass (Medium), getProviderFactoryClass (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), before (Medium), testSuccessClientCredentialsToken (Medium), testSuccessOfflineToken (Medium), testIncorrectGrantType (Medium), testUnknownGrantType (Medium), testOldToken (Medium), String (Medium), Constants (Medium), Context (Medium), ClientCredentialsGrantTypeFactory (Medium), PermissionGrantTypeFactory (Medium), ResourceOwnerPasswordCredentialsGrantTypeFactory (Medium), TokenExchangeGrantTypeFactory (Medium), lines 21-36 (Low), String (Low), String (Low), String (Low), String (Low), SessionType (Low), String (Low), TokenType (Low), getShortcut (Low), AccessTokenContext (Low), String (Low), DefaultTokenContextEncoderProvider (Low), DefaultTokenContextEncoderProviderFactory (Low), init (Low), TokenContextEncoderSpi (Low), String (Low), String (Low), String (Low), String (Low), lines 1-20 (Low), DefaultTokenContextEncoderProviderTest (Low)",match,"Javadoc is on OAuth2GrantType interface methods, which are HC"
keycloak,8,Implement access token context encoding framework, Catching generic RuntimeException is too broad. The implementation throws IllegalArgumentException specifically - catch that instead for more precise testing.,Low,109,46,42,"interface::OAuth2GrantType (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [Critical, score=1.00] | method::expectRefresh (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=1.00] | method::expectCodeToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=1.00] | interface::OAuth2GrantTypeFactory (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java) [Critical, score=0.94] | class::AccessTokenContext (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [Critical, score=0.94] | class::AbstractOIDCProtocolMapper (services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java) [Critical, score=0.92] | interface::TokenContextEncoderProvider (services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java) [Critical, score=0.89] | class::AssertEvents (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [Critical, score=0.88] | class::PreAuthorizedCodeGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java) [Critical, score=0.84] | method::getSessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [Critical, score=0.81] | method::getTokenContextFromTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [Critical, score=0.77] | class::OAuth2GrantTypeBase (services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java) [Critical, score=0.77] | class::PreAuthorizedCodeGrantType (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java) [Critical, score=0.74] | method::getShouldUseLightweightToken (services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java) [Critical, score=0.74] | method::createTokenResponse (services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java) [Critical, score=0.72] | method::getShortcut (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java) [High, score=0.68] | method::getRawTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.68] | method::encodeTokenId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [High, score=0.68] | method::expectAuthReqIdToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.68] | method::initToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.65] | method::isAccessTokenId (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.62] | method::validateToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.62] | class::Context (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [High, score=0.57] | class::TokenManager (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.57] | method::transformAccessToken (services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java) [High, score=0.57] | class::AuthorizationCodeGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java) [High, score=0.57] | class::RefreshTokenGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java) [High, score=0.57] | class::CibaGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java) [High, score=0.57] | class::DeviceGrantTypeFactory (services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java) [High, score=0.57] | interface::TokenContextEncoderProviderFactory (services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProviderFactory.java) [High, score=0.57] | field::SessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | field::TokenType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | enum::SessionType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | method::getShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | enum::TokenType (services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java) [High, score=0.56] | method::getTokenContextFromClientSessionContext (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java) [High, score=0.56] | method::getId (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getSessionTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getTokenTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getShortcutByGrantType (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getGrantTypeByShortcut (services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java) [High, score=0.56] | method::getGrantType (server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java) [High, score=0.51] | method::process (services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java) [High, score=0.51] | method::expectDeviceCodeToToken (testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java) [High, score=0.51] | class::StandardTokenExchangeProvider (services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java) [High, score=0.51] | class::ResourceOwnerPasswordCredentialsGrantType (services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java) [High, score=0.51]","[Critical] interface OAuth2GrantType in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public interface OAuth2GrantType extends Provider {

    /**
     * Returns the event type associated with this OAuth 2.0 grant type.
     *
     * @return event type
     */
    EventType getEventType();

    /**
     * @return request parameters, which can be duplicated for the particular grant type. The grant request is typically rejected if
     * request contains multiple values of some parameter, which is not listed here
     */
    default Set<String> getSupportedMultivaluedRequestParameters() {
        return Collections.emptySet();
    }

    /**
     * Processes grant request.
     * @param context grant request context
     *
     * @return token response
     */
    Response process(Context context);

    public static class Context {
        protected KeycloakSession session;

---
[Critical] method expectRefresh in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectRefresh(String refreshTokenId, String sessionId) {
        return expect(EventType.REFRESH_TOKEN)
                .detail(Details.TOKEN_ID, isAccessTokenId(RefreshTokenGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, refreshTokenId)
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.UPDATED_REFRESH_TOKEN_ID, isUUID())
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(sessionId);
    }
---
[Critical] method expectCodeToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectCodeToToken(String codeId, String sessionId) {
        return expect(EventType.CODE_TO_TOKEN)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(AuthorizationCodeGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(sessionId);
    }
---
[Critical] interface OAuth2GrantTypeFactory in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java:
public interface OAuth2GrantTypeFactory extends ProviderFactory<OAuth2GrantType> {

    /**
     * @return usually like 3-letters shortcut of specific grants. It can be useful for example in the tokens when the amount of characters should be limited and hence using full grant name
     * is not ideal. Shortcut should be unique across grants.
     */
    String getShortcut();
}
---
[Critical] class AccessTokenContext in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public class AccessTokenContext {

    private final SessionType sessionType;
    private final TokenType tokenType;
    private final String grantType;
    private final String rawTokenId;

    public enum SessionType {
        ONLINE(""on""),
        OFFLINE(""of""),
        TRANSIENT(""tr""),
        UNKNOWN(""un"");

        private final String shortcut;

        SessionType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }

    public enum TokenType {
        REGULAR(""rt""),
        LIGHTWEIGHT(""lt""),
        UNKNOWN(""un"");

        private final String shortcut;

        TokenType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
       
---
[Critical] class AbstractOIDCProtocolMapper in services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java:
public abstract class AbstractOIDCProtocolMapper implements ProtocolMapper {

    public static final String TOKEN_MAPPER_CATEGORY = ""Token mapper"";

    @Override
    public String getProtocol() {
        return OIDCLoginProtocol.LOGIN_PROTOCOL;
    }

    @Override
    public void close() {

    }

    @Override
    public final ProtocolMapper create(KeycloakSession session) {
        throw new RuntimeException(""UNSUPPORTED METHOD"");
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {

    }

    public AccessToken transformUserInfoToken(AccessToken token, ProtocolMapperModel mappingModel, KeycloakSession session,
                                              UserSessionModel userSession, ClientS
---
[Critical] interface TokenContextEncoderProvider in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
public interface TokenContextEncoderProvider extends Provider {

    AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId);

    AccessTokenContext getTokenContextFromTokenId(String encodedTokenId);

    String encodeTokenId(AccessTokenContext tokenContext);
}
---
[Critical] class AssertEvents in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public class AssertEvents implements TestRule {

    public static final String DEFAULT_CLIENT_ID = ""test-app"";
    public static final String DEFAULT_IP_ADDRESS = ""127.0.0.1"";
    public static final String DEFAULT_IP_ADDRESS_V6 = ""0:0:0:0:0:0:0:1"";
    public static final String DEFAULT_IP_ADDRESS_V6_SHORT = ""::1"";
    public static final String DEFAULT_REALM = ""test"";
    public static final String DEFAULT_USERNAME = ""test-user@localhost"";

    public static final String DEFAULT_REDIRECT_URI = getAuthServerContextRoot() + ""/auth/realms/master/app/auth"";

    private AbstractKeycloakTest context;

    public AssertEvents(AbstractKeycloakTest ctx) {
        context = ctx;
    }

    @Override
    public Statement apply(final Statement base, org.junit.runner.Description description) {
    
---
[Critical] class PreAuthorizedCodeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java:
public class PreAuthorizedCodeGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_TYPE = ""urn:ietf:params:oauth:grant-type:pre-authorized_code"";
    public static final String CODE_REQUEST_PARAM = ""pre-authorized_code"";

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new PreAuthorizedCodeGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

    @Override
    public String getId() {
        return GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""pc"";
    }

    @Override
    public boo
---
[Critical] method getSessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public SessionType getSessionType() {
        return sessionType;
    }
---
[Critical] method getTokenContextFromTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public AccessTokenContext getTokenContextFromTokenId(String encodedTokenId) {
        int indexOf = encodedTokenId.indexOf(':');
        if (indexOf == -1) {
            return new AccessTokenContext(AccessTokenContext.SessionType.UNKNOWN, AccessTokenContext.TokenType.UNKNOWN, UNKNOWN, encodedTokenId);
        } else {
            String encodedContext = encodedTokenId.substring(0, indexOf);
            String rawId = encodedTokenId.substring(indexOf + 1);

            if (encodedContext.length() != 6) {
                throw new IllegalArgumentException(""Incorrect token id: '"" + encodedTokenId + ""'. Expected length of 6."");
            }

            // First 2 chars are ""sessionType"", next 2 chars ""tokenType"", last 2 chars ""grantType""
            String stShortcut = encoded
---
[Critical] class OAuth2GrantTypeBase in services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java:
public abstract class OAuth2GrantTypeBase implements OAuth2GrantType {

    private static final Logger logger = Logger.getLogger(OAuth2GrantTypeBase.class);

    protected OAuth2GrantType.Context context;

    protected KeycloakSession session;
    protected RealmModel realm;
    protected ClientModel client;
    protected OIDCAdvancedConfigWrapper clientConfig;
    protected ClientConnection clientConnection;
    protected Map<String, String> clientAuthAttributes;
    protected MultivaluedMap<String, String> formParams;
    protected EventBuilder event;
    protected Cors cors;
    protected TokenManager tokenManager;
    protected HttpRequest request;
    protected HttpResponse response;
    protected HttpHeaders headers;

    protected void setContext(Context context) {
        this.co
---
[Critical] class PreAuthorizedCodeGrantType in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java:
public class PreAuthorizedCodeGrantType extends OAuth2GrantTypeBase {

    private static final Logger LOGGER = Logger.getLogger(PreAuthorizedCodeGrantType.class);

    public static final String VC_ISSUANCE_FLOW = ""VC-Issuance-Flow"";

    @Override
    public Response process(Context context) {
        LOGGER.debug(""Process grant request for preauthorized."");
        setContext(context);

        // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
        String code = formParams.getFirst(PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM);

        if (code == null) {
            // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
            String errorMessage = ""Missing parameter: "" + P
---
[Critical] method getShouldUseLightweightToken in services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractOIDCProtocolMapper.java:
public static boolean getShouldUseLightweightToken(KeycloakSession session) {
        Object attributeValue = session.getAttribute(Constants.USE_LIGHTWEIGHT_ACCESS_TOKEN_ENABLED);
        return Boolean.parseBoolean(session.getContext().getClient().getAttribute(Constants.USE_LIGHTWEIGHT_ACCESS_TOKEN_ENABLED)) || (attributeValue != null && (boolean) attributeValue);
    }
---
[Critical] method createTokenResponse in services/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeBase.java:
protected Response createTokenResponse(UserModel user, UserSessionModel userSession, ClientSessionContext clientSessionCtx,
        String scopeParam, boolean code, Function<TokenManager.AccessTokenResponseBuilder, ClientPolicyContext> clientPolicyContextGenerator) {
        clientSessionCtx.setAttribute(Constants.GRANT_TYPE, context.getGrantType());
        AccessToken token = tokenManager.createClientAccessToken(session, realm, client, user, userSession, clientSessionCtx);

        TokenManager.AccessTokenResponseBuilder responseBuilder = tokenManager
            .responseBuilder(realm, client, event, session, userSession, clientSessionCtx).accessToken(token);
        boolean useRefreshToken = clientConfig.isUseRefreshToken();
        if (useRefreshToken) {
            responseBuilder.ge
---
[High] method getShortcut in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantTypeFactory.java:
String getShortcut();
---
[High] method getRawTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getRawTokenId() {
        return rawTokenId;
    }
---
[High] method encodeTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public String encodeTokenId(AccessTokenContext tokenContext) {
        if (tokenContext.getSessionType() == AccessTokenContext.SessionType.UNKNOWN) {
            throw new IllegalStateException(""Cannot encode token with unknown sessionType"");
        }
        if (tokenContext.getTokenType() == AccessTokenContext.TokenType.UNKNOWN) {
            throw new IllegalStateException(""Cannot encode token with unknown tokenType"");
        }

        String grantShort = factory.getShortcutByGrantType(tokenContext.getGrantType());
        if (grantShort == null) {
            throw new IllegalStateException(""Cannot encode token with unknown grantType: "" + tokenContext.getGrantType());
        }

        return tokenContext.getSessionType().getShortcut() +
                tokenContext.g
---
[High] method expectAuthReqIdToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectAuthReqIdToToken(String codeId, String sessionId) {
        return expect(EventType.AUTHREQID_TO_TOKEN)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(CibaGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(isUUID());
    }
---
[High] method initToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
protected AccessToken initToken(KeycloakSession session, RealmModel realm, ClientModel client, UserModel user, UserSessionModel userSession,
                                    ClientSessionContext clientSessionCtx, UriInfo uriInfo) {
        AccessToken token = new AccessToken();

        TokenContextEncoderProvider encoder = session.getProvider(TokenContextEncoderProvider.class);
        AccessTokenContext tokenCtx = encoder.getTokenContextFromClientSessionContext(clientSessionCtx, KeycloakModelUtils.generateId());
        token.id(encoder.encodeTokenId(tokenCtx));

        token.type(formatTokenType(client, token));
        if (UserSessionModel.SessionPersistenceState.TRANSIENT.equals(userSession.getPersistenceState())) {
            token.subject(user.getId());
        }
        token.
---
[High] method isAccessTokenId in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public static Matcher<String> isAccessTokenId(String expectedGrantShortcut) {
        return new TypeSafeMatcher<String>() {
            @Override
            protected boolean matchesSafely(String item) {
                String[] items = item.split("":"");
                if (items.length != 2) return false;
                // Grant type shortcut starts at character 4th char and is 2-chars long
                if (items[0].substring(3, 5).equals(expectedGrantShortcut)) return false;
                return isUUID().matches(items[1]);
            }

            @Override
            public void describeTo(Description description) {
                description.appendText(""Not a Token ID with expected grant: "" + expectedGrantShortcut);
            }
        };
    }
---
[High] method validateToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public TokenValidation validateToken(KeycloakSession session, UriInfo uriInfo, ClientConnection connection, RealmModel realm,
                                         RefreshToken oldToken, HttpHeaders headers, String oldTokenScope) throws OAuthErrorException {
        UserSessionModel userSession = null;
        boolean offline = TokenUtil.TOKEN_TYPE_OFFLINE.equals(oldToken.getType());

        if (offline) {

            UserSessionManager sessionManager = new UserSessionManager(session);
            userSession = sessionManager.findOfflineUserSession(realm, oldToken.getSessionState());
            if (userSession != null) {

                // Revoke timeouted offline userSession
                if (!AuthenticationManager.isSessionValid(realm, userSession)) {
                    session
---
[High] class Context in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public static class Context {
        protected KeycloakSession session;
        protected RealmModel realm;
        protected ClientModel client;
        protected Object clientConfig;
        protected ClientConnection clientConnection;
        protected Map<String, String> clientAuthAttributes;
        protected HttpRequest request;
        protected HttpResponse response;
        protected HttpHeaders headers;
        protected MultivaluedMap<String, String> formParams;
        protected EventBuilder event;
        protected Cors cors;
        protected Object tokenManager;
        protected String grantType;

        public Context(KeycloakSession session, Object clientConfig, Map<String, String> clientAuthAttributes,
                MultivaluedMap<String, String> formParams, EventBui
---
[High] class TokenManager in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public class TokenManager {
    private static final Logger logger = Logger.getLogger(TokenManager.class);

    public static class TokenValidation {
        public final UserModel user;
        public final UserSessionModel userSession;
        public final ClientSessionContext clientSessionCtx;
        public final AccessToken newToken;

        public TokenValidation(UserModel user, UserSessionModel userSession, ClientSessionContext clientSessionCtx, AccessToken newToken) {
            this.user = user;
            this.userSession = userSession;
            this.clientSessionCtx = clientSessionCtx;
            this.newToken = newToken;
        }
    }

    public TokenValidation validateToken(KeycloakSession session, UriInfo uriInfo, ClientConnection connection, RealmModel realm,
     
---
[High] method transformAccessToken in services/src/main/java/org/keycloak/protocol/oidc/TokenManager.java:
public AccessToken transformAccessToken(KeycloakSession session, AccessToken token,
                                            UserSessionModel userSession, ClientSessionContext clientSessionCtx) {
        AccessToken accessToken = ProtocolMapperUtils.getSortedProtocolMappers(session, clientSessionCtx, mapper -> mapper.getValue() instanceof OIDCAccessTokenMapper)
                .collect(new TokenCollector<AccessToken>(token) {
                    @Override
                    protected AccessToken applyMapper(AccessToken token, Map.Entry<ProtocolMapperModel, ProtocolMapper> mapper) {
                        return ((OIDCAccessTokenMapper) mapper.getValue()).transformAccessToken(token, mapper.getKey(), session, userSession, clientSessionCtx);
                    }
                });
    
---
[High] class AuthorizationCodeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java:
public class AuthorizationCodeGrantTypeFactory implements OAuth2GrantTypeFactory {

    public static final String GRANT_SHORTCUT = ""ac"";

    @Override
    public String getId() {
        return OAuth2Constants.AUTHORIZATION_CODE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new AuthorizationCodeGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class RefreshTokenGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java:
public class RefreshTokenGrantTypeFactory implements OAuth2GrantTypeFactory {

    public static final String GRANT_SHORTCUT = ""rt"";

    @Override
    public String getId() {
        return OAuth2Constants.REFRESH_TOKEN;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new RefreshTokenGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class CibaGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java:
public class CibaGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_SHORTCUT = ""ci"";

    @Override
    public String getId() {
        return OAuth2Constants.CIBA_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new CibaGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
        return Profile.isFeatureEnabled(Profile.Feature.CIBA);
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close() {
    }

}
---
[High] class DeviceGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java:
public class DeviceGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    public static final String GRANT_SHORTCUT = ""dg"";

    @Override
    public String getId() {
        return OAuth2Constants.DEVICE_CODE_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new DeviceGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
        return Profile.isFeatureEnabled(Profile.Feature.DEVICE_FLOW);
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory factory) {
    }

    @Override
    public void close
---
[High] interface TokenContextEncoderProviderFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProviderFactory.java:
public interface TokenContextEncoderProviderFactory extends ProviderFactory<TokenContextEncoderProvider> {
}
---
[High] field SessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
private final SessionType sessionType;
---
[High] field TokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
private final TokenType tokenType;
---
[High] enum SessionType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public enum SessionType {
        ONLINE(""on""),
        OFFLINE(""of""),
        TRANSIENT(""tr""),
        UNKNOWN(""un"");

        private final String shortcut;

        SessionType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }
---
[High] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getShortcut() {
            return shortcut;
        }
---
[High] enum TokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public enum TokenType {
        REGULAR(""rt""),
        LIGHTWEIGHT(""lt""),
        UNKNOWN(""un"");

        private final String shortcut;

        TokenType(String shortcut) {
            this.shortcut = shortcut;
        }

        public String getShortcut() {
            return shortcut;
        }
    }
---
[High] method getTokenContextFromClientSessionContext in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId) {
        AccessTokenContext.SessionType sessionType;
        UserSessionModel userSession = clientSessionContext.getClientSession().getUserSession();
        if (userSession.getPersistenceState() == UserSessionModel.SessionPersistenceState.TRANSIENT) {
            sessionType = AccessTokenContext.SessionType.TRANSIENT;
        } else {
            sessionType = userSession.isOffline() ? AccessTokenContext.SessionType.OFFLINE : AccessTokenContext.SessionType.ONLINE;
        }

        boolean useLightweightToken = AbstractOIDCProtocolMapper.getShouldUseLightweightToken(session);
        AccessTokenContext.TokenType tokenType = useLightweightToken ? A
---
[High] method getId in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public String getId() {
        return ""default"";
    }
---
[High] method getSessionTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected AccessTokenContext.SessionType getSessionTypeByShortcut(String sessionTypeShortcut) {
        return sessionTypesByShortcut.get(sessionTypeShortcut);
    }
---
[High] method getTokenTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected AccessTokenContext.TokenType getTokenTypeByShortcut(String tokenTypeShortcut) {
        return tokenTypesByShortcut.get(tokenTypeShortcut);
    }
---
[High] method getShortcutByGrantType in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected String getShortcutByGrantType(String grantType) {
        String grantShortcut = grantsToShortcuts.get(grantType);
        if (grantShortcut == null) {
            // Refresh maps in case new grant type was deployed
            OAuth2GrantTypeFactory factory = (OAuth2GrantTypeFactory) sessionFactory.getProviderFactory(OAuth2GrantType.class, grantType);
            if (factory != null) {
                String shortcut = factory.getShortcut();
                grantsByShortcuts.put(shortcut, grantType);
                grantsToShortcuts.put(grantType, shortcut);
            }
            grantShortcut = grantsToShortcuts.get(grantType);
        }
        return grantShortcut;
    }
---
[High] method getGrantTypeByShortcut in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
protected String getGrantTypeByShortcut(String shortcut) {
        String grantType = grantsByShortcuts.get(shortcut);
        if (grantType == null) {
            // Refresh maps in case new grant type was deployed
            sessionFactory.getProviderFactoriesStream(OAuth2GrantType.class)
                    .map(fct -> (OAuth2GrantTypeFactory) fct)
                    .filter(fct -> shortcut.equals(fct.getShortcut()))
                    .map(OAuth2GrantTypeFactory::getId)
                    .findFirst()
                    .ifPresent(newGrantType -> {
                        grantsByShortcuts.put(shortcut, newGrantType);
                        grantsToShortcuts.put(newGrantType, shortcut);
                    });
            grantType = grantsByShortcuts.get(shortcut);
        }
   
---
[High] method getGrantType in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public String getGrantType() {
            return grantType;
        }
---
[High] method process in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantType.java:
@Override
    public Response process(Context context) {
        LOGGER.debug(""Process grant request for preauthorized."");
        setContext(context);

        // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
        String code = formParams.getFirst(PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM);

        if (code == null) {
            // See: https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html#name-token-request
            String errorMessage = ""Missing parameter: "" + PreAuthorizedCodeGrantTypeFactory.CODE_REQUEST_PARAM;
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.INVALID_CODE);
            throw new CorsErrorResponseException(cors, OAuthErrorException.INVALID_RE
---
[High] method expectDeviceCodeToToken in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java:
public ExpectedEvent expectDeviceCodeToToken(String clientId, String codeId, String userId) {
        return expect(EventType.OAUTH2_DEVICE_CODE_TO_TOKEN)
                .client(clientId)
                .user(userId)
                .detail(Details.CODE_ID, codeId)
                .detail(Details.TOKEN_ID, isAccessTokenId(DeviceGrantTypeFactory.GRANT_SHORTCUT))
                .detail(Details.REFRESH_TOKEN_ID, isUUID())
                .detail(Details.REFRESH_TOKEN_TYPE, TokenUtil.TOKEN_TYPE_REFRESH)
                .detail(Details.CLIENT_AUTH_METHOD, ClientIdAndSecretAuthenticator.PROVIDER_ID)
                .session(codeId);
    }
---
[High] class StandardTokenExchangeProvider in services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java:
public class StandardTokenExchangeProvider extends AbstractTokenExchangeProvider {

    @Override
    public boolean supports(TokenExchangeContext context) {
        return true;
    }

    @Override
    protected Response tokenExchange() {
        KeycloakSession session = context.getSession();
        RealmModel realm = context.getRealm();
        ClientConnection clientConnection = context.getClientConnection();
        Cors cors = context.getCors();
        EventBuilder event = context.getEvent();

        if(!OIDCAdvancedConfigWrapper.fromClientModel(context.getClient()).isStandardTokenExchangeEnabled()) {
            event.detail(Details.REASON, ""Standard token exchange is not enabled for the requested client"");
            event.error(Errors.INVALID_REQUEST);
            throw new C
---
[High] class ResourceOwnerPasswordCredentialsGrantType in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java:
public class ResourceOwnerPasswordCredentialsGrantType extends OAuth2GrantTypeBase {

    private static final Logger logger = Logger.getLogger(ResourceOwnerPasswordCredentialsGrantType.class);

    @Override
    public Response process(Context context) {
        setContext(context);

        event.detail(Details.AUTH_METHOD, ""oauth_credentials"");

        if (!client.isDirectAccessGrantsEnabled()) {
            String errorMessage = ""Client not allowed for direct access grants"";
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.NOT_ALLOWED);
            throw new CorsErrorResponseException(cors, OAuthErrorException.UNAUTHORIZED_CLIENT, errorMessage, Response.Status.BAD_REQUEST);
        }

        if (client.isConsentRequired()) {
            String er","[Medium] field DefaultTokenContextEncoderProviderFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
private final DefaultTokenContextEncoderProviderFactory factory;
---
[Medium] field DefaultTokenContextEncoderProvider in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
private DefaultTokenContextEncoderProvider provider;
---
[Medium] method getTokenType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public TokenType getTokenType() {
        return tokenType;
    }
---
[Medium] method getGrantType in services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java:
public String getGrantType() {
        return grantType;
    }
---
[Medium] method getTokenContextFromClientSessionContext in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
AccessTokenContext getTokenContextFromClientSessionContext(ClientSessionContext clientSessionContext, String rawTokenId);
---
[Medium] method getTokenContextFromTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
AccessTokenContext getTokenContextFromTokenId(String encodedTokenId);
---
[Medium] method encodeTokenId in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderProvider.java:
String encodeTokenId(AccessTokenContext tokenContext);
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/AuthorizationCodeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/PreAuthorizedCodeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""pc"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/RefreshTokenGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ciba/CibaGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/device/DeviceGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return GRANT_SHORTCUT;
    }
---
[Medium] class DefaultTokenContextEncoderProvider in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
public class DefaultTokenContextEncoderProvider implements TokenContextEncoderProvider {

    public static final String UNKNOWN = ""na"";

    private final KeycloakSession session;
    private final DefaultTokenContextEncoderProviderFactory factory;

    public DefaultTokenContextEncoderProvider(KeycloakSession session,
                                              DefaultTokenContextEncoderProviderFactory factory) {
        this.session = session;
        this.factory = factory;
    }

    @Ove
---
[Medium] field KeycloakSession in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
private final KeycloakSession session;
---
[Medium] method exchangeClientToOIDCClient in services/src/main/java/org/keycloak/protocol/oidc/tokenexchange/StandardTokenExchangeProvider.java:
@Override
    protected Response exchangeClientToOIDCClient(UserModel targetUser, UserSessionModel targetUserSession, String requestedTokenType,
                                                  List<ClientModel> targetAudienceClients, String scope) {
        RootAuthenticationSessionModel rootAuthSession = new AuthenticationSessionManager(session).createAuthenticationSession(realm, false);
        AuthenticationSessionModel authSession = createSessionModel(targetUserSession, rootAuthSession, ta
---
[Medium] field KeycloakSessionFactory in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
private KeycloakSessionFactory sessionFactory;
---
[Medium] method process in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantType.java:
@Override
    public Response process(Context context) {
        setContext(context);

        event.detail(Details.AUTH_METHOD, ""oauth_credentials"");

        if (!client.isDirectAccessGrantsEnabled()) {
            String errorMessage = ""Client not allowed for direct access grants"";
            event.detail(Details.REASON, errorMessage);
            event.error(Errors.NOT_ALLOWED);
            throw new CorsErrorResponseException(cors, OAuthErrorException.UNAUTHORIZED_CLIENT, errorMessage, Res
---
[Medium] method close in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProvider.java:
@Override
    public void close() {

    }
---
[Medium] method create in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public TokenContextEncoderProvider create(KeycloakSession session) {
        return new DefaultTokenContextEncoderProvider(session, this);
    }
---
[Medium] method postInit in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public void postInit(KeycloakSessionFactory factory) {
        this.sessionFactory = factory;
        grantsByShortcuts = new ConcurrentHashMap<>();
        grantsToShortcuts = new ConcurrentHashMap<>();

        factory.getProviderFactoriesStream(OAuth2GrantType.class)
                .forEach((factory1) -> {
                    OAuth2GrantTypeFactory gtf = (OAuth2GrantTypeFactory) factory1;
                    String grantName = gtf.getId();
                    String grantShortc
---
[Medium] method close in services/src/main/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderFactory.java:
@Override
    public void close() {

    }
---
[Medium] method isInternal in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public boolean isInternal() {
        return true;
    }
---
[Medium] method getName in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public String getName() {
        return ""tokenContextEncoder"";
    }
---
[Medium] method getProviderClass in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public Class<? extends Provider> getProviderClass() {
        return TokenContextEncoderProvider.class;
    }
---
[Medium] method getProviderFactoryClass in services/src/main/java/org/keycloak/protocol/oidc/encode/TokenContextEncoderSpi.java:
@Override
    public Class<? extends ProviderFactory> getProviderFactoryClass() {
        return TokenContextEncoderProviderFactory.class;
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ClientCredentialsGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""cc"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/PermissionGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""pg"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""ro"";
    }
---
[Medium] method getShortcut in services/src/main/java/org/keycloak/protocol/oidc/grants/TokenExchangeGrantTypeFactory.java:
@Override
    public String getShortcut() {
        return ""te"";
    }
---
[Medium] method before in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Before
    public void before() {
        DefaultTokenContextEncoderProviderFactory factory = new DefaultTokenContextEncoderProviderFactory();
        factory.init(null);
        factory.grantsByShortcuts = new HashMap<>();
        factory.grantsByShortcuts.put(""ro"", OAuth2Constants.PASSWORD);
        factory.grantsByShortcuts.put(""cc"", OAuth2Constants.CLIENT_CREDENTIALS);
        factory.grantsByShortcuts.put(DefaultTokenContextEncoderProvider.UNKNOWN, DefaultTokenContextEncoderProvider.UNKNOW
---
[Medium] method testSuccessClientCredentialsToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testSuccessClientCredentialsToken() {
        String tokenId = ""trltcc:1234"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.TRANSIENT);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.LIGHTWEIGHT);
        Assert.assertEquals(ctx.getGrantType(), OAuth2Constants.CLIENT_CREDENTIALS);
        Assert.assertEquals(ctx.getRawTokenId(), ""12
---
[Medium] method testSuccessOfflineToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testSuccessOfflineToken() {
        String tokenId = ""ofrtro:5678"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.OFFLINE);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.REGULAR);
        Assert.assertEquals(ctx.getGrantType(), OAuth2Constants.PASSWORD);
        Assert.assertEquals(ctx.getRawTokenId(), ""5678"");

        Assert.asse
---
[Medium] method testIncorrectGrantType in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testIncorrectGrantType() {
        try {
            String tokenId = ""ofrtac:5678"";
            AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
            Assert.fail(""Not expected to success due incorrect grant type"");
        } catch (RuntimeException iae) {
            // ignored
        }
    }
---
[Medium] method testUnknownGrantType in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testUnknownGrantType() {
        String tokenId = ""onrtna:5678"";
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(tokenId);
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.ONLINE);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.REGULAR);
        Assert.assertEquals(ctx.getGrantType(), DefaultTokenContextEncoderProvider.UNKNOWN);
        Assert.assertEquals(ctx.getRawTokenId(), ""5678"");

     
---
[Medium] method testOldToken in services/src/test/java/org/keycloak/protocol/oidc/encode/DefaultTokenContextEncoderProviderTest.java:
@Test
    public void testOldToken() {
        AccessTokenContext ctx = provider.getTokenContextFromTokenId(""1234"");
        Assert.assertEquals(ctx.getSessionType(), AccessTokenContext.SessionType.UNKNOWN);
        Assert.assertEquals(ctx.getTokenType(), AccessTokenContext.TokenType.UNKNOWN);
        Assert.assertEquals(ctx.getGrantType(), DefaultTokenContextEncoderProvider.UNKNOWN);
        Assert.assertEquals(ctx.getRawTokenId(), ""1234"");

        try {
            provider.encodeTokenId(ctx)
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/models/Constants.java:
public static final String GRANT_TYPE = OAuth2Constants.GRANT_TYPE;
---
[Medium] class Constants in server-spi-private/src/main/java/org/keycloak/models/Constants.java:
public final class Constants {
    public static final String ADMIN_CONSOLE_CLIENT_ID = ""security-admin-console"";
    public static final String ADMIN_CLI_CLIENT_ID = ""admin-cli"";

    public static final String ACCOUNT_MANAGEMENT_CLIENT_ID = ""account"";
    public static final String ACCOUNT_CONSOLE_CLIENT_ID = ""account-console"";
    public static final String BROKER_SERVICE_CLIENT_ID = ""broker"";
    public static final String REALM_MANAGEMENT_CLIENT_ID = ""realm-management"";

    public static f
---
[Medium] constructor Context in server-spi-private/src/main/java/org/keycloak/protocol/oidc/grants/OAuth2GrantType.java:
public Context(KeycloakSession session, Object clientConfig, Map<String, String> clientAuthAttributes,
                MultivaluedMap<String, String> formParams, EventBuilder event, Cors cors, Object tokenManager) {
            this.session = session;
            this.realm = session.getContext().getRealm();
            this.client = session.getContext().getClient();
            this.clientConfig = clientConfig;
            this.clientConnection = session.getContext().getConnection();
          
---
[Medium] class ClientCredentialsGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ClientCredentialsGrantTypeFactory.java:
public class ClientCredentialsGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.CLIENT_CREDENTIALS;
    }

    @Override
    public String getShortcut() {
        return ""cc"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new ClientCredentialsGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(Keycl
---
[Medium] class PermissionGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/PermissionGrantTypeFactory.java:
public class PermissionGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.UMA_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""pg"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new PermissionGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public void postInit(KeycloakSessionFactory 
---
[Medium] class ResourceOwnerPasswordCredentialsGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/ResourceOwnerPasswordCredentialsGrantTypeFactory.java:
public class ResourceOwnerPasswordCredentialsGrantTypeFactory implements OAuth2GrantTypeFactory {

    @Override
    public String getId() {
        return OAuth2Constants.PASSWORD;
    }

    @Override
    public String getShortcut() {
        return ""ro"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new ResourceOwnerPasswordCredentialsGrantType();
    }

    @Override
    public void init(Config.Scope config) {
    }

    @Override
    public
---
[Medium] class TokenExchangeGrantTypeFactory in services/src/main/java/org/keycloak/protocol/oidc/grants/TokenExchangeGrantTypeFactory.java:
public class TokenExchangeGrantTypeFactory implements OAuth2GrantTypeFactory, EnvironmentDependentProviderFactory {

    @Override
    public String getId() {
        return OAuth2Constants.TOKEN_EXCHANGE_GRANT_TYPE;
    }

    @Override
    public String getShortcut() {
        return ""te"";
    }

    @Override
    public OAuth2GrantType create(KeycloakSession session) {
        return new TokenExchangeGrantType();
    }

    @Override
    public boolean isSupported(Config.Scope config) {
     ","OAuth2GrantType (Critical), expectRefresh (Critical), expectCodeToToken (Critical), OAuth2GrantTypeFactory (Critical), AccessTokenContext (Critical), AbstractOIDCProtocolMapper (Critical), TokenContextEncoderProvider (Critical), AssertEvents (Critical), PreAuthorizedCodeGrantTypeFactory (Critical), getSessionType (Critical), getTokenContextFromTokenId (Critical), OAuth2GrantTypeBase (Critical), PreAuthorizedCodeGrantType (Critical), getShouldUseLightweightToken (Critical), createTokenResponse (Critical), getShortcut (High), getRawTokenId (High), encodeTokenId (High), expectAuthReqIdToToken (High), initToken (High), isAccessTokenId (High), validateToken (High), Context (High), TokenManager (High), transformAccessToken (High), AuthorizationCodeGrantTypeFactory (High), RefreshTokenGrantTypeFactory (High), CibaGrantTypeFactory (High), DeviceGrantTypeFactory (High), TokenContextEncoderProviderFactory (High), SessionType (High), TokenType (High), SessionType (High), getShortcut (High), TokenType (High), getTokenContextFromClientSessionContext (High), getId (High), getSessionTypeByShortcut (High), getTokenTypeByShortcut (High), getShortcutByGrantType (High), getGrantTypeByShortcut (High), getGrantType (High), process (High), expectDeviceCodeToToken (High), StandardTokenExchangeProvider (High), ResourceOwnerPasswordCredentialsGrantType (High), DefaultTokenContextEncoderProviderFactory (Medium), DefaultTokenContextEncoderProvider (Medium), getTokenType (Medium), getGrantType (Medium), getTokenContextFromClientSessionContext (Medium), getTokenContextFromTokenId (Medium), encodeTokenId (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), DefaultTokenContextEncoderProvider (Medium), KeycloakSession (Medium), exchangeClientToOIDCClient (Medium), KeycloakSessionFactory (Medium), process (Medium), close (Medium), create (Medium), postInit (Medium), close (Medium), isInternal (Medium), getName (Medium), getProviderClass (Medium), getProviderFactoryClass (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), getShortcut (Medium), before (Medium), testSuccessClientCredentialsToken (Medium), testSuccessOfflineToken (Medium), testIncorrectGrantType (Medium), testUnknownGrantType (Medium), testOldToken (Medium), String (Medium), Constants (Medium), Context (Medium), ClientCredentialsGrantTypeFactory (Medium), PermissionGrantTypeFactory (Medium), ResourceOwnerPasswordCredentialsGrantTypeFactory (Medium), TokenExchangeGrantTypeFactory (Medium), lines 21-36 (Low), String (Low), String (Low), String (Low), String (Low), SessionType (Low), String (Low), TokenType (Low), getShortcut (Low), AccessTokenContext (Low), String (Low), DefaultTokenContextEncoderProvider (Low), DefaultTokenContextEncoderProviderFactory (Low), init (Low), TokenContextEncoderSpi (Low), String (Low), String (Low), String (Low), String (Low), lines 1-20 (Low), DefaultTokenContextEncoderProviderTest (Low)",match,"exception handling is in grant type code, which has 46 HC entities"
keycloak,7,Add HTML sanitizer for translated message resources,The translation is in Italian instead of Lithuanian. This should be translated to Lithuanian to match the file's locale (messages_lt.properties).,Medium,79,1,71,"class::VerifyMessageProperties (misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java) [High, score=0.63]","[High] class VerifyMessageProperties in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
public class VerifyMessageProperties {

    private final File file;
    private List<String> messages;

    public VerifyMessageProperties(File file) {
        this.file = file;
    }

    public List<String> verify() throws MojoExecutionException {
        messages = new ArrayList<>();
        try {
            String contents = Files.readString(file.toPath());
            verifyNoDuplicateKeys(contents);
            verifySafeHtml();
        } catch (IOException e) {
            throw new MojoExecutionException(""Can not read file "" + file, e);
        }
        return messages;
    }

    PolicyFactory POLICY_SOME_HTML = new org.owasp.html.HtmlPolicyBuilder()
            .allowElements(
                    ""br"", ""p"", ""strong"", ""b""
            ).toFactory();

    PolicyFactory POLICY_NO_","[Medium] field Pattern in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
Pattern HTML_TAGS = Pattern.compile(""<[a-z]+[^>]*>"");
---
[Medium] field Pattern in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private static final Pattern ANCHOR_PATTERN = Pattern.compile(""</?a[^>]*>"");
---
[Medium] field PolicyFactory in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
PolicyFactory POLICY_SOME_HTML = new org.owasp.html.HtmlPolicyBuilder()
            .allowElements(
                    ""br"", ""p"", ""strong"", ""b""
            ).toFactory();
---
[Medium] field PolicyFactory in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
PolicyFactory POLICY_NO_HTML = new org.owasp.html.HtmlPolicyBuilder().toFactory();
---
[Medium] method normalizeValue in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private String normalizeValue(String key, String value) {
        if (key.equals(""templateHelp"")) {
            // Allow ""CLAIM.<NAME>"" here
            value = value.replaceAll(""CLAIM\\.<[A-Z]*>"", """");
        } else if (key.equals(""optimizeLookupHelp"")) {
            // Allow ""<Extensions>"" here
            value = value.replaceAll(""<Extensions>"", """");
        } else if (key.startsWith(""linkExpirationFormatter.timePeriodUnit"") || key.equals(""error-invalid-multivalued-size"")) {
            // T
---
[Medium] method containsHtml in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private boolean containsHtml(String englishValue) {
        return HTML_TAGS.matcher(englishValue).find();
    }
---
[Medium] method santizeAnchors in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private String santizeAnchors(String key, String value, String englishValue) {
        Matcher matcher = ANCHOR_PATTERN.matcher(value);
        Matcher englishMatcher = ANCHOR_PATTERN.matcher(englishValue);
        while (matcher.find()) {
            if (englishMatcher.find() && Objects.equals(matcher.group(), englishMatcher.group())) {
                value = value.replaceFirst(Pattern.quote(englishMatcher.group()), """");
            } else {
                messages.add(""Didn't find anchor tag
---
[Medium] method getEnglishValue in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private static String getEnglishValue(String key, PropertyResourceBundle bundleEnglish) {
        String englishValue;
        try {
            englishValue = bundleEnglish.getString(key);
        } catch (MissingResourceException ex) {
            englishValue = """";
        }
        return englishValue;
    }
---
[Medium] method verifySafeHtml in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private void verifySafeHtml() {
        PropertyResourceBundle bundle;
        try (FileInputStream fis = new FileInputStream(file)) {
            bundle = new PropertyResourceBundle(fis);
        } catch (IOException e) {
            throw new RuntimeException(""unable to read file "" + file, e);
        }

        PropertyResourceBundle bundleEnglish;
        String englishFile = file.getAbsolutePath().replaceAll(""resources-community"", ""resources"")
                .replaceAll(""_[a-zA-Z-_]*\\.pro
---
[Medium] method verify in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
public List<String> verify() throws MojoExecutionException {
        messages = new ArrayList<>();
        try {
            String contents = Files.readString(file.toPath());
            verifyNoDuplicateKeys(contents);
            verifySafeHtml();
        } catch (IOException e) {
            throw new MojoExecutionException(""Can not read file "" + file, e);
        }
        return messages;
    }
---
[Medium] method verifyDuplicateKeysDetected in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyDuplicateKeysDetected() throws MojoExecutionException {
        List<String> verify = getFile(""duplicateKeys_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Duplicate keys in file"")));
    }
---
[Medium] method verifyIllegalHtmlTagDetected in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyIllegalHtmlTagDetected() throws MojoExecutionException {
        List<String> verify = getFile(""illegalHtmlTag_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Illegal HTML"")));
    }
---
[Medium] method verifyNoHtmlAllowed in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyNoHtmlAllowed() throws MojoExecutionException {
        List<String> verify = getFile(""noHtml_de.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Illegal HTML"")));
    }
---
[Medium] method verifyNoChangedAnchors in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyNoChangedAnchors() throws MojoExecutionException {
        List<String> verify = getFile(""changedAnchor_de.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Didn't find anchor tag"")));
    }
---
[Medium] chunk lines 101-101 in misc/theme-verifier/pom.xml:
</project>
---
[Medium] chunk lines 1-18 in misc/theme-verifier/src/test/resources/duplicate_keys.properties:
#
# Copyright 2025 Red Hat, Inc. and/or its affiliates
# and other contributors as indicated by the @author tags.
#
# Licensed under the Apache License, Version 2.0 (the ""License"");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an ""AS IS"" BASIS,
# WITHOUT WARRANTIES O
---
[Medium] chunk lines 181-200 in js/apps/account-ui/maven-resources/theme/keycloak.v3/account/messages/messages_en.properties:
sharedWithMe=Shared with Me
username=Username
webauthn-display-name=Passkey
webauthn-help-text=Use your Passkey to sign in.
webauthn-passwordless-display-name=Passkey
webauthn-passwordless-help-text=Use your Passkey for passwordless sign in.
passwordless=Passwordless
error-invalid-multivalued-size=Attribute {0} must have at least {1} and at most {2} {2,choice,0#values|1#value|1<values}.
recovery-authn-code=My recovery authentication codes
recovery-authn-codes-display-name=Recovery authentication
---
[Medium] chunk lines 1241-1260 in js/apps/admin-ui/maven-resources-community/theme/keycloak.v2/admin/messages/messages_zh_CN.properties:
prefix=æ¯ä¸ªé¢†åŸŸè§’è‰²çš„å‰ç¼€ï¼ˆéžå¿…éœ€ï¼‰ã€‚
xContentTypeOptionsHelp=é»˜è®¤å€¼é˜»æ­¢ Internet Explorer å’Œè°·æ­Œæµè§ˆå™¨ä»Ž MIME å—…æŽ¢è¿œç¦»å£°æ˜Žçš„å†…å®¹ç±»åž‹çš„å“åº”<1>äº†è§£æ›´å¤š</1>
privateKeyMask=ç§é’¥æœªè®¾ç½®æˆ–æœªçŸ¥
signOutAllActiveSessions=æ³¨é”€æ‰€æœ‰æ´»åŠ¨ä¼šè¯
addExecutorSuccess=æˆåŠŸï¼æ‰§è¡Œå™¨åˆ›å»ºæˆåŠŸ
executorTypeSelectHelpText=æ‰§è¡Œå™¨ç±»åž‹é€‰æ‹©å¸®åŠ©æ–‡æœ¬
useDiscoveryEndpointHelp=å¦‚æžœå¯ç”¨æ­¤è®¾ç½®ï¼Œå‘çŽ°ç«¯ç‚¹å°†ç”¨äºŽèŽ·å–ä¾›åº”å•†é…ç½®ã€‚Keycloak å¯ä»¥ä»Žç»ˆç«¯èŠ‚ç‚¹åŠ è½½é…ç½®å¹¶åœ¨æºæœ‰ä»»ä½•æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°é…ç½®
eventTypes.USER_INFO_REQUEST_ERROR.name=ç”¨æˆ·ä¿¡æ¯è¯·æ±‚é”™è¯¯
createUserProviderError=ç”±äºŽ{{error}}ï¼Œæ— æ³•åˆ›å»ºç”¨æˆ·è”ç›Ÿä¾›åº”å•†ã€‚
learnMore=äº†è§£æ›´å¤š
onDragCancel=å·²å–æ¶ˆæ‹–åŠ¨ã€‚åˆ—è¡¨æœªæ›´æ”¹ã€‚
removeUser=ç§»é™¤ç”¨æˆ·
ownerManagedAccess=å¯ç”¨ç”¨æˆ·ç®¡
---
[Medium] chunk lines 3121-3140 in js/apps/admin-ui/maven-resources/theme/keycloak.v2/admin/messages/messages_en.properties:
spinnerLoading=Loading
enableClientSignatureRequiredModal=Enable client signature required
selectBindType=Select bind type
searchClientAuthorizationResource=Search resource
searchClientAuthorizationPolicy=Search policy
searchClientAuthorizationPermission=Search permission
userNotSaved=The user has not been saved\: {{error}}
kcNumberFormat=Number Format
kcNumberUnFormat=Number UnFormat
tokenExpirationHelp=Sets the expiration for tokens. Expired tokens are periodically deleted from the database.
b
---
[Medium] chunk lines 81-100 in misc/theme-verifier/pom.xml:
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-text</artifactId>
            <version>1.13.0</version>
            <scope>compile</scope>
        </dependency>
    </dependencies>


    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
      
---
[Medium] chunk lines 61-80 in misc/theme-verifier/pom.xml:
            <version>2.18.0</version>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>5.10.5</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hamcrest</groupId>
            <artifactId>hamcrest</artifactId>
            <version>2.2</version>
            <scope>test</scope>
        </dependency>
        <dependency>
  
---
[Medium] class VerifyMessagePropertiesTest in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
class VerifyMessagePropertiesTest {

    @Test
    void verifyDuplicateKeysDetected() throws MojoExecutionException {
        List<String> verify = getFile(""duplicateKeys_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Duplicate keys in file"")));
    }

    @Test
    void verifyIllegalHtmlTagDetected() throws MojoExecutionException {
        List<String> verify = getFile(""illegalHtmlTag_en.properties"").verify();
        MatcherAssert.a
---
[Medium] chunk lines 141-160 in themes/src/main/resources-community/theme/base/account/messages/messages_fi.properties:
totpStep1=Asenna jokin seuraavista sovelluksista matkapuhelimeesi:
totpStep2=Avaa sovellus ja skannaa QR-koodi tai kirjoita avain.
totpStep3=TÃ¤ytÃ¤ saamasi kertaluontoinen koodisi allaolevaan kenttÃ¤Ã¤n ja paina Tallenna.
totpStep3DeviceName=Anna laitteelle nimi, jotta voit hallinnoida OTP-laitteitasi.

totpManualStep2=Avaa sovellus ja syÃ¶tÃ¤ koodi
totpManualStep3=KÃ¤ytÃ¤ seuraavia asetuksia mikÃ¤li sovellus sallii niiden syÃ¶tÃ¶n
totpUnableToScan=Ongelmia skannuksessa?
totpScanBarcode=Skannaa viivakoodi
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_lt.properties:
totpStep1=Installa una delle seguenti applicazioni sul tuo cellulare:
totpStep2=Atidarykite programÄ—lÄ™ ir nuskenuokite barkodÄ… arba Ä¯veskite kodÄ….
totpStep3=Ä®veskite programÄ—lÄ—je sugeneruotÄ… vienÄ… kartÄ… galiojantÄ¯ kodÄ… ir paspauskite Saugoti norÄ—dami prisijungti.

missingUsernameMessage=PraÅ¡ome Ä¯vesti naudotojo vardÄ….
missingFirstNameMessage=PraÅ¡ome Ä¯vesti vardÄ….
invalidEmailMessage=Neteisingas el. paÅ¡to adresas.
missingLastNameMessage=PraÅ¡ome Ä¯vesti pavardÄ™.
missingEmailMessage=PraÅ¡ome Ä¯vesti e
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_sk.properties:
totpStep1=NainÅ¡talujte si do mobilu jednu z nasledujÃºcich aplikÃ¡ciÃ­:
totpStep2=Otvorte aplikÃ¡ciu a naskenujte ÄiarovÃ½ kÃ³d alebo zadajte kÄ¾ÃºÄ.
totpStep3=Zadajte jednorazovÃ½ kÃ³d poskytnutÃ½ aplikÃ¡ciou a kliknutÃ­m na tlaÄidlo UloÅ¾iÅ¥ dokonÄÃ­te nastavenie.

totpManualStep2=Otvorte aplikÃ¡ciu a zadajte kÄ¾ÃºÄ
totpManualStep3=PouÅ¾ite nasledujÃºce hodnoty konfigurÃ¡cie, ak aplikÃ¡cia umoÅ¾Åˆuje ich nastavenie
totpUnableToScan=NemoÅ¾no skenovaÅ¥?
totpScanBarcode=Skenovanie ÄiarovÃ©ho kÃ³du?

totp.totp=ZaloÅ¾enÃ© na Äas
---
[Medium] chunk lines 81-100 in themes/src/main/resources-community/theme/base/account/messages/messages_sv.properties:
log=Logg

application=Applikation
availablePermissions=TillgÃ¤ngliga rÃ¤ttigheter
grantedPermissions=Beviljade rÃ¤ttigheter
grantedPersonalInfo=Medgiven personlig information
additionalGrants=Ytterligare medgivanden
action=Ã…tgÃ¤rd
inResource=i
fullAccess=FullstÃ¤ndig Ã¥tkomst
offlineToken=Offline token
revoke=UpphÃ¤v rÃ¤ttighet

configureAuthenticators=Konfigurerade autentiserare
mobile=Mobil
totpStep1=Installera en av fÃ¶ljande applikationer pÃ¥ din mobil:
totpStep2=Ã–ppna applikationen och skanna streckk
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_zh_CN.properties:
grantedPermissions=æŽˆäºˆæƒé™
grantedPersonalInfo=æŽˆæƒçš„ä¸ªäººä¿¡æ¯
additionalGrants=å¯æŽˆäºˆçš„æƒé™
action=æ“ä½œ
inResource=in
fullAccess=æ‰€æœ‰æƒé™
offlineToken=ç¦»çº¿ token
revoke=æ”¶å›žæŽˆæƒ

configureAuthenticators=é…ç½®çš„è®¤è¯è€…
mobile=æ‰‹æœº
totpStep1=åœ¨æ‚¨çš„æ‰‹æ©Ÿä¸Šå®‰è£ä»¥ä¸‹æ‡‰ç”¨ç¨‹å¼ä¹‹ä¸€ï¼š
totpStep2=æ‰“å¼€åº”ç”¨æ‰«æäºŒç»´ç è¾“å…¥éªŒè¯ç 
totpStep3=è¾“å…¥åº”ç”¨æä¾›çš„ä¸€æ¬¡æ€§éªŒè¯ç å•å‡»ä¿å­˜

missingUsernameMessage=è¯·æŒ‡å®šç”¨æˆ·å
missingFirstNameMessage=è¯·æŒ‡å®šå
invalidEmailMessage=æ— æ•ˆçš„ç”µå­é‚®ç®±åœ°å€
missingLastNameMessage=è¯·æŒ‡å®šå§“
missingEmailMessage=è¯·æŒ‡å®šé‚®ä»¶åœ°å€
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_da.properties:
emailVerificationSubject=Verificer email
emailVerificationBody=Nogen har oprettet en {2} konto med denne email adresse. Hvis dette var dig, bedes du trykke pÃ¥ forbindet herunder for at verificere din email adresse \n\n{0}\n\nDette link vil udlÃ¸be inden for {3}.\n\nHvis det var dig der har oprettet denne konto, bedes du se bort fra denne mail.
emailVerificationBodyHtml=<p>Nogen har oprettet en {2} konto med denne email adresse. Hvis dette var dig, bedes du trykke pÃ¥ forbindet herunder for at veri
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_fa.properties:
emailVerificationSubject=ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
emailVerificationBody=Ø´Ø®ØµÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ÛŒÚ© Ø­Ø³Ø§Ø¨ {2} Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø§ÛŒÙ† Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø±ÙˆÛŒ Ù¾ÛŒÙˆÙ†Ø¯ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯\n\n{0}\n\nØ§ÛŒÙ† Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ø± {3} Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.\n\nØ§Ú¯Ø± Ø´Ù…Ø§ Ø§ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŒ ÙÙ‚Ø· Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯ .
emailVerificationBodyHtml=<p>Ø´Ø®ØµÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ÛŒÚ© Ø­Ø³Ø§Ø¨ {2} Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø§ÛŒÙ† Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±ÙˆÛŒ Ù¾ÛŒÙˆÙ†Ø¯ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p><p><a href=""{0}"">Ù¾ÛŒÙˆÙ†Ø¯ Ø¨Ù‡ ØªØ£ÛŒÛŒØ¯ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„</a></p>
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_hu.properties:
emailVerificationSubject=E-mail cÃ­m megerÅ‘sÃ­tÃ©se
emailVerificationBody=Ezzel az e-mail cÃ­mmel valaki lÃ©trehozott egy {2} tartomÃ¡ny felhasznÃ¡lÃ³i fiÃ³kot. Amennyiben a fiÃ³kot Ã–n hozta lÃ©tre, kÃ©rem, kattintson a lenti hivatkozÃ¡sra, hogy megerÅ‘sÃ­tse fiÃ³kjÃ¡t Ã©s ezt az e-mail cÃ­met.\n\n{0}\n\nA hivatkozÃ¡s Ã©rvÃ©nyÃ©t veszti {3} mÃºlva.\n\nHa nem Ã¶n hozta lÃ©tre a felhasznÃ¡lÃ³i fiÃ³kot, akkor kÃ©rem, hagyja figyelmen kÃ­vÃ¼l ezt az Ã¼zenetet.
emailVerificationBodyHtml=<p>Ezzel az e-mail cÃ­mmel valaki lÃ©trehozott e
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_lt.properties:
emailVerificationSubject=El. paÅ¡to patvirtinimas
emailVerificationBody=Paskyra {2} sukurta naudojant Å¡Ä¯ el. paÅ¡to adresÄ…. Jei tai buvote JÅ«s, tuomet paspauskite Å¾emiau esanÄiÄ… nuorodÄ…\n\n{0}\n\nÅ i nuoroda galioja {1} min.\n\nJei paskyros nekÅ«rÄ—te, tuomet ignuoruokite Å¡Ä¯ laiÅ¡kÄ…. 
emailVerificationBodyHtml=<p>Paskyra {2} sukurta naudojant Å¡Ä¯ el. paÅ¡to adresÄ…. Jei tao buvote JÅ«s, tuomet paspauskite Å¾emiau esanÄiÄ… nuorodÄ…</p><p><a href=""{0}"">{0}</a></p><p>Å i nuoroda galioja {1} min.</p><p>nJei pasky
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_nl.properties:
emailVerificationSubject=Bevestig e-mailadres
emailVerificationBody=Iemand heeft een {2} account aangemaakt met dit e-mailadres. Als u dit was, klikt u op de onderstaande koppeling om uw e-mailadres te bevestigen \n\n{0}\n\nDeze koppeling zal binnen {3} vervallen.\n\nU kunt dit bericht negeren indien u dit account niet heeft aangemaakt.
emailVerificationBodyHtml=<p>Iemand heeft een {2} account aangemaakt met dit e-mailadres. Als u dit was, klikt u op de onderstaande koppeling om uw e-mailadres t
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_no.properties:
emailVerificationSubject=Bekreft e-postadresse
emailVerificationBody=Noen har opprettet en {2} konto med denne e-postadressen. Hvis dette var deg, klikk pÃ¥ lenken nedenfor for Ã¥ bekrefte e-postadressen din\n\n{0}\n\nDenne lenken vil utlÃ¸pe om {1} minutter.\n\nHvis du ikke opprettet denne kontoen, vennligst ignorer denne meldingen.
emailVerificationBodyHtml=<p>Noen har opprettet en {2} konto med denne e-postadressen. Hvis dette var deg, klikk pÃ¥ lenken nedenfor for Ã¥ bekrefte e-postadressen din</
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_tr.properties:
emailVerificationSubject=E-postayÄ± doÄŸrula
emailVerificationBody=Birisi bu e-posta adresiyle bir {2} hesap oluÅŸturdu. Bu sizseniz, e-posta adresinizi doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±ya tÄ±klayÄ±n\n\n{0}\n\nBu baÄŸlantÄ± {3} iÃ§inde sona erecek.\n\nBu hesabÄ± oluÅŸturmadÄ±ysanÄ±z, sadece bu iletiyi yoksayÄ±nÄ±z.
emailVerificationBodyHtml=<p>Birisi bu e-posta adresiyle bir {2} hesap oluÅŸturdu. Bu sizseniz, e-posta adresinizi doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±yÄ± tÄ±klayÄ±n.</p><p><a href=""{0}"">E-posta adresi 
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_uk.properties:
emailVerificationSubject=ÐŸÑ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ Ð°Ð´Ñ€ÐµÑÑƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸
emailVerificationBody=Ð¥Ñ‚Ð¾ÑÑŒ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ {2} Ñ–Ð· Ñ†Ñ–Ñ”ÑŽ Ð°Ð´Ñ€ÐµÑÐ¾ÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸. Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð±ÑƒÐ»Ð¸ Ð’Ð¸, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð½Ð¸Ð¶Ñ‡Ðµ, Ñ‰Ð¾Ð± Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ ÑÐ²Ð¾ÑŽ Ð°Ð´Ñ€ÐµÑÑƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸\n\n{0}\n\nÐ¦Ðµ Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð´Ñ–Ð¹ÑÐ½Ðµ Ð¿Ñ€Ð¾Ñ‚ÑÐ³Ð¾Ð¼ {3}.\n\nÐ¯ÐºÑ‰Ð¾ Ð’Ð¸ Ð½Ðµ ÑÑ‚Ð²Ð¾Ñ€ÑŽÐ²Ð°Ð»Ð¸ Ñ†ÐµÐ¹ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ñ–Ð³Ð½Ð¾Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ†ÐµÐ¹ Ð»Ð¸ÑÑ‚.
emailVerificationBodyHtml=<p>Ð¥Ñ‚Ð¾ÑÑŒ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ {2} Ñ–Ð· Ñ†Ñ–Ñ”ÑŽ Ð°Ð´Ñ€ÐµÑÐ¾ÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸. Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð±ÑƒÐ»Ð¸ Ð’Ð¸, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_ar.properties:
webauthn-doAuthenticate=ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†
webauthn-createdAt-label=ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ

# WebAuthn Error
webauthn-error-title=Ø®Ø·Ø£ ÙÙŠ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†
webauthn-error-registration=ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.<br /> {0}
webauthn-error-api-get=ÙØ´Ù„Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†.<br /> {0}
webauthn-error-different-user=Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… ØªÙ…Øª Ù…ØµØ§Ø¯Ù‚ØªÙ‡ Ù„ÙŠØ³ Ù‡Ùˆ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ØªÙ…Øª Ù…ØµØ§Ø¯Ù‚ØªÙ‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†.
webauthn-error-auth-verification=Ù†ØªÙŠØ¬Ø© Ù…ØµØ§Ø¯Ù‚Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† ØºÙŠØ± ØµØ§Ù„Ø­Ø©.<br /> {0}
webauthn-error-reg
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_ca.properties:
# WebAuthn Error
webauthn-error-title=Error de la clau de seguretat
webauthn-error-registration=No s''ha pogut registrar la vostra clau de seguretat.<br /> {0}
webauthn-error-api-get=No s''ha pogut identificar amb la clau de seguretat.<br /> {0}
webauthn-error-different-user=L''usuari identificat primer no Ã©s l''autenticat per la clau de seguretat.
webauthn-error-auth-verification=El resultat de l''autenticaciÃ³ amb clau de seguretat no Ã©s vÃ lid.<br />{0}
webauthn-error-register-verification=El r
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_cs.properties:
webauthn-doAuthenticate=PÅ™ihlÃ¡Å¡enÃ­ pÅ™Ã­stupovÃ½m klÃ­Äem
webauthn-createdAt-label=VytvoÅ™eno

# WebAuthn Error
webauthn-error-title=Chyba pÅ™Ã­stupovÃ©ho klÃ­Äe
webauthn-error-registration=Selhala registrace vaÅ¡eho pÅ™Ã­stupovÃ©ho klÃ­Äe.<br /> {0}
webauthn-error-api-get=Selhalo pÅ™ihlÃ¡Å¡enÃ­ pomocÃ­ pÅ™Ã­stupovÃ©ho klÃ­Äe.<br /> {0}
webauthn-error-different-user=PrvnÃ­ pÅ™ihlÃ¡Å¡enÃ½ uÅ¾ivatel nenÃ­ totoÅ¾nÃ½ s uÅ¾ivatelem pÅ™ihlÃ¡Å¡enÃ½m pomocÃ­ pÅ™Ã­stupovÃ©ho klÃ­Äe.
webauthn-error-auth-verification=NevalidnÃ­ vÃ½sledek pÅ™ihlÃ¡Å¡enÃ­ 
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_de.properties:
recovery-codes-download-file-header=Bewahren Sie diese Wiederherstellungscodes an einem sicheren Ort auf.
recovery-codes-download-file-description=Wiederherstellungscodes sind einmalig verwendbare PasswÃ¶rter, mit denen Sie sich bei Ihrem Konto anmelden kÃ¶nnen, wenn Sie keinen Zugriff auf Ihren Authentifikator haben.
recovery-codes-download-file-date=Diese Codes wurden generiert am
recovery-codes-label-default=Wiederherstellungscodes

# WebAuthn
webauthn-display-name=Passkey
webauthn-help-text=Ve
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_de.properties:
webauthn-error-api-get=Fehler beim Authentifizieren mit dem Passkey.<br /> {0}
webauthn-error-different-user=Der erste authentifizierte Benutzer ist nicht derjenige, der durch den Passkey authentifiziert wurde.
webauthn-error-auth-verification=Das Ergebnis der Passkey-Authentifizierung ist ungÃ¼ltig.<br /> {0}
webauthn-error-register-verification=Das Ergebnis der Passkey-Registrierung ist ungÃ¼ltig.<br /> {0}
webauthn-error-user-not-found=Unbekannter Benutzer, der mit dem Passkey authentifiziert w
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_el.properties:
recovery-codes-download-file-date=Î‘Ï…Ï„Î¿Î¯ Î¿Î¹ ÎºÏ‰Î´Î¹ÎºÎ¿Î¯ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½ ÏƒÏ„Î¹Ï‚
recovery-codes-label-default=ÎšÏ‰Î´Î¹ÎºÎ¿Î¯ Î±Î½Î¬ÎºÏ„Î·ÏƒÎ·Ï‚

# WebAuthn
webauthn-display-name=ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-help-text=Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÏƒÎ±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·.
webauthn-passwordless-display-name=ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-passwordless-help-text=Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚.
webauthn-login-title=Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Î¼Îµ ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-registration-title=Î•Î³Î³ÏÎ±Ï†Î® ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-avai
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_el.properties:
webauthn-error-auth-verification=ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.<br /> {0}
webauthn-error-register-verification=ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.<br /> {0}
webauthn-error-user-not-found=Î†Î³Î½Ï‰ÏƒÏ„Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ Î¼Îµ Ï„Î¿ ÎšÎ»ÎµÎ¹Î´Î¯ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.

# Identity provider
identity-provider-redirector=Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Î­Î½Î±Î½ Î¬Î»Î»Î¿ Î Î¬ÏÎ¿Ï‡Î¿ Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚
identity-provider-login-label=Î‰ ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ
idp-email-verification-display-name=Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Email
idp-email-verification-help
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_es.properties:
webauthn-error-title=Error de Passkey
webauthn-error-registration=No se pudo registrar su Passkey. <br /> {0}
webauthn-error-api-get=No se pudo autenticar con el Passkey. <br /> {0}
webauthn-error-different-user=El primer usuario autenticado no es el autenticado por el Passkey.
webauthn-error-auth-verification=El resultado de la autenticaciÃ³n con el Passkey no es vÃ¡lido. <br /> {0}
webauthn-error-register-verification=El resultado de registro del Passkey no es vÃ¡lido. <br /> {0}
webauthn-error-u
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_fa.properties:
recovery-codes-label-default=Ú©Ø¯Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ

# WebAuthn
webauthn-display-name=Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-help-text=.Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø®ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
webauthn-passwordless-display-name=Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-passwordless-help-text=.Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø®ÙˆØ¯ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
webauthn-login-title=ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-registration-title=Ø«Ø¨Øª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-available-authenticators=Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ù…ÙˆØ¬ÙˆØ¯
webauthn-unsupported-browser-text=WebAuthn ØªÙˆØ³Ø· Ø§ÛŒÙ† Ù…Ø±ÙˆØ±Ú¯Ø±
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_fa.properties:
webauthn-error-register-verification=Ù†ØªÛŒØ¬Ù‡ Ø«Ø¨Øª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.<br /> {0}
webauthn-error-user-not-found=.Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ø´Ù†Ø§Ø³ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø´Ø¯Ù‡ Ø§Ø³Øª

# Identity provider
identity-provider-redirector=Ø¨Ø§ ÛŒÚ© Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù‡ÙˆÛŒØª Ø¯ÛŒÚ¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†ÛŒØ¯
identity-provider-login-label=ÛŒØ§ ÙˆØ±ÙˆØ¯ Ø¨Ø§
idp-email-verification-display-name=ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
idp-email-verification-help-text=.Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ù‡ÛŒØ¯
idp-username-password-form-display-name=Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
idp-usernam
---
[Medium] chunk lines 381-400 in themes/src/main/resources-community/theme/base/login/messages/messages_fi.properties:
password-help-text=Kirjaudu sisÃ¤Ã¤n syÃ¶ttÃ¤mÃ¤llÃ¤ salasanasi.
auth-username-form-display-name=KÃ¤yttÃ¤jÃ¤nimi
auth-username-form-help-text=Aloita kirjautuminen syÃ¶ttÃ¤mÃ¤llÃ¤ kÃ¤yttÃ¤jÃ¤nimesi
auth-username-password-form-display-name=kÃ¤yttÃ¤jÃ¤nimi ja salasana
auth-username-password-form-help-text=Kirjaudu sisÃ¤Ã¤n syÃ¶ttÃ¤mÃ¤llÃ¤ kÃ¤yttÃ¤jÃ¤nimi ja salasana.

# WebAuthn
webauthn-display-name=Turva-avain
webauthn-help-text=KÃ¤ytÃ¤ Turva-avaintasi kirjatuaksesi sisÃ¤Ã¤n.
webauthn-passwordless-display-name=Turva-avain
webau
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_fi.properties:
webauthn-error-api-get=Tunnistautuminen Turva-avaimella epÃ¤onnistui.<br /> {0}
webauthn-error-different-user=Ensiksi tunnistautunut kÃ¤yttÃ¤jÃ¤ ei ole sama kuin Turva-avaimella tunnistaunut.
webauthn-error-auth-verification=Turva-avain -tunnistautumisen tulos on virheellinen.<br /> {0}
webauthn-error-register-verification=Turva-avaimen rekisterÃ¶innin tulos on virheellinen.<br /> {0}
webauthn-error-user-not-found=Tuntematon kÃ¤yttÃ¤jÃ¤ tunnistautui Turva-avaimella.

# Identity provider
identity-provide
---
[Medium] chunk lines 381-400 in themes/src/main/resources-community/theme/base/login/messages/messages_fr.properties:
webauthn-error-register-verification=Le rÃ©sultat de l''enregistrement de la clÃ© de sÃ©curitÃ© est invalide.<br /> {0}
webauthn-error-user-not-found=La ClÃ© de SÃ©curitÃ© a authentifiÃ© un utilisateur inconnu.
finalDeletionConfirmation=Si vous supprimez votre compte, il ne pourra pas Ãªtre restaurÃ©. Pour conserver votre compte, cliquez sur Annuler.
irreversibleAction=Cette action est irrÃ©versible
deleteAccountConfirm=Confirmation de suppression de compte
deletingImplies=Supprimer votre compte implique:

---
[Medium] chunk lines 361-380 in themes/src/main/resources-community/theme/base/login/messages/messages_fr.properties:
auth-username-password-form-help-text=Connectez-vous en saisissant votre nom d''utilisateur et votre mot de passe.

# WebAuthn
webauthn-display-name=ClÃ© de SÃ©curitÃ©
webauthn-help-text=Utilisez votre clÃ© de sÃ©curitÃ© pour vous connecter.
webauthn-passwordless-display-name=ClÃ© de SÃ©curitÃ©
webauthn-passwordless-help-text=Utilisez votre clÃ© de sÃ©curitÃ© pour vous connecter sans mot de passe.
webauthn-login-title=Connexion avec une ClÃ© de SÃ©curitÃ©
webauthn-registration-title=Enregistrement d''une ClÃ© d
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_hr.properties:

# WebAuthn
webauthn-display-name=Sigurnosni kljuÄ
webauthn-help-text=Koristite svoj sigurnosni kljuÄ za prijavu.
webauthn-passwordless-display-name=Sigurnosni kljuÄ
webauthn-passwordless-help-text=Koristite svoj sigurnosni kljuÄ za prijavu bez lozinke.
webauthn-login-title=Prijava sigurnosnim kljuÄem
webauthn-registration-title=Registracija sigurnosnog kljuÄa
webauthn-available-authenticators=Dostupni sigurnosni kljuÄevi
webauthn-unsupported-browser-text=WebAuthn nije podrÅ¾an u ovom pregledniku
---
[Medium] chunk lines 481-500 in themes/src/main/resources-community/theme/base/login/messages/messages_hr.properties:
webauthn-error-different-user=Prvi autentificirani korisnik nije isti kao korisnik autentificiran putem sigurnosnog kljuÄa.
webauthn-error-auth-verification=Rezultat autentifikacije putem sigurnosnog kljuÄa nije valjan.<br /> {0}
webauthn-error-register-verification=Rezultat registracije sigurnosnog kljuÄa nije valjan.<br /> {0}
webauthn-error-user-not-found=Nepoznati korisnik autentificiran putem sigurnosnog kljuÄa.

# Passkey
passkey-login-title=Prijava pristupnim kljuÄem
passkey-available-aut
---
[Medium] chunk lines 161-180 in themes/src/main/resources-community/theme/base/login/messages/messages_ka.properties:
webauthn-passwordless-display-name=Passkey
webauthn-passwordless-help-text=áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ Passkey áƒ£áƒžáƒáƒ áƒáƒšáƒáƒ“ áƒ¨áƒ”áƒ¡áƒáƒ¡áƒ•áƒšáƒ”áƒšáƒáƒ“.
webauthn-unsupported-browser-text=áƒáƒ› áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¡ WebAuthn-áƒ˜áƒ¡ áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ áƒáƒ  áƒ’áƒáƒáƒ©áƒœáƒ˜áƒ. áƒ¡áƒªáƒáƒ“áƒ”áƒ— áƒ¡áƒ®áƒ•áƒ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ˜ áƒáƒœ áƒ“áƒáƒ£áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ“áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ  áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ¡.
webauthn-doAuthenticate=Passkey-áƒ˜áƒ— áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ
webauthn-registration-init-label=Passkey (áƒœáƒáƒ’áƒ£áƒšáƒ˜áƒ¡áƒ®áƒ›áƒ”áƒ•áƒ˜ áƒ­áƒ“áƒ”)


# WebAuthn Error
webauthn-error-title=Passkey-áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ
webauthn-createdAt-label=áƒ¨áƒ”áƒ˜áƒ¥áƒ›áƒœáƒ
webauthn-registration-init-label-
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_ka.properties:
auth-username-password-form-display-name=áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ“áƒ áƒžáƒáƒ áƒáƒšáƒ˜
auth-username-password-form-help-text=áƒ¨áƒ”áƒ“áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡áƒ áƒ“áƒ áƒžáƒáƒ áƒáƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ˜áƒ—.
recovery-code-config-warning-message=áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ“áƒ˜áƒ—, áƒ áƒáƒ› áƒ“áƒáƒ‘áƒ”áƒ­áƒ“áƒáƒ—, áƒ’áƒáƒ“áƒ›áƒáƒ¬áƒ”áƒ áƒáƒ— áƒáƒœ áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒáƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒžáƒáƒ áƒáƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ›áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ¨áƒ˜ áƒ“áƒ áƒ˜áƒ¥áƒáƒœáƒ˜áƒ”áƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ“. áƒáƒ› áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ˜áƒ“áƒáƒœ áƒáƒ› áƒ™áƒáƒ“áƒ”áƒ‘áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡.
recovery-codes-action-complete=áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ
recovery-codes-action-cancel=áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ
recovery-codes-download-file-header=áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒ”áƒ— áƒ”áƒ¡ áƒ™áƒ
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_ko.properties:
recovery-codes-download-file-date=ì´ ì½”ë“œëŠ” ë‹¤ìŒ ë‚ ì§œì— ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:
recovery-codes-label-default=ë³µêµ¬ ì½”ë“œ

# WebAuthn
webauthn-display-name=íŒ¨ìŠ¤í‚¤
webauthn-help-text=íŒ¨ìŠ¤í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•˜ì„¸ìš”.
webauthn-passwordless-display-name=íŒ¨ìŠ¤í‚¤
webauthn-passwordless-help-text=íŒ¨ìŠ¤í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ë¡œê·¸ì¸í•˜ì„¸ìš”.
webauthn-login-title=íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸
webauthn-registration-title=íŒ¨ìŠ¤í‚¤ ë“±ë¡
webauthn-available-authenticators=ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ìŠ¤í‚¤
webauthn-unsupported-browser-text=ì´ ë¸Œë¼ìš°ì €ëŠ” WebAuthnì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
webauthn-doAuthenticate=íŒ¨ìŠ¤í‚¤ë¡œ ë¡œê·¸ì¸
weba
---
[Medium] chunk lines 481-500 in themes/src/main/resources-community/theme/base/login/messages/messages_ko.properties:
webauthn-error-api-get=íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-different-user=ì²« ë²ˆì§¸ ì¸ì¦ëœ ì‚¬ìš©ìžê°€ íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦ëœ ì‚¬ìš©ìžê°€ ì•„ë‹™ë‹ˆë‹¤.
webauthn-error-auth-verification=íŒ¨ìŠ¤í‚¤ ì¸ì¦ ê²°ê³¼ê°€ ìž˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-register-verification=íŒ¨ìŠ¤í‚¤ ë“±ë¡ ê²°ê³¼ê°€ ìž˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-user-not-found=íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦ëœ ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ìž.

# Passkey
passkey-login-title=íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸
passkey-available-authenticators=ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ìŠ¤í‚¤
passkey-unsupported-browser-text=ì´ ë¸Œë¼ìš°ì €ëŠ” íŒ¨ìŠ¤í‚¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
passkey-doAuthenticate=íŒ¨ìŠ¤í‚¤ë¡œ ë¡œê·¸ì¸
pa
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_lt.properties:
authenticatorCode=Vienkartinis kodas
address=Adresas
street=GatvÄ—
locality=Miestas arba vietovÄ—
region=Rajonas
postal_code=PaÅ¡to kodas
country=Å alis
emailVerified=El. paÅ¡to adresas patvirtintas
gssDelegationCredential=GSS prisijungimo duomenÅ³ delegavimas

loginTotpStep1=Installa una delle seguenti applicazioni sul tuo cellulare:
loginTotpStep2=Atidarykite programÄ—lÄ™ ir nuskenuokite barkodÄ… arba Ä¯veskite kodÄ….
loginTotpStep3=Ä®veskite programÄ—lÄ—je sugeneruotÄ… vienÄ… kartÄ… galiojantÄ¯ kodÄ… ir paspaus
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_no.properties:
authenticatorCode=Engangskode
address=Adresse
street=Gate-/veinavn + husnummer
locality=By
region=Fylke
postal_code=Postnummer
country=Land
emailVerified=E-postadresse bekreftet
gssDelegationCredential=GSS legitimasjons-delegering

loginTotpStep1=Installer en av fÃ¸lgende applikasjoner pÃ¥ mobilen din:
loginTotpStep2=Ã…pne applikasjonen og skann strekkoden eller skriv inn koden
loginTotpStep3=Skriv inn engangskoden fra applikasjonen og klikk send inn for Ã¥ fullfÃ¸re
loginOtpOneTime=Engangskode

oaut
---
[Medium] chunk lines 501-501 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
error-invalid-multivalued-size=AtribÃºt {0} musÃ­ maÅ¥ najmenej {1} {1,choice,0#hodnÃ´t|1#hodnotu|1<hodnoty|4<hodnÃ´t} a najviac {2} {2,choice,0#hodnÃ´t|1#hodnotu|1<hodnoty|4<hodnÃ´t}.
---
[Medium] chunk lines 121-140 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:

loginTotpIntro=Pre prÃ­stup k tomuto ÃºÄtu je potrebnÃ© nastaviÅ¥ generÃ¡tor jednorazovÃ½ch kÃ³dov
loginTotpStep1=NainÅ¡talujte si do mobilu jednu z nasledujÃºcich aplikÃ¡ciÃ­:
loginTotpStep2=Otvorte aplikÃ¡ciu a skenujte ÄiarovÃ½ kÃ³d alebo zadajte kÄ¾ÃºÄ
loginTotpStep3=Zadajte jednorazovÃ½ kÃ³d poskytnutÃ½ aplikÃ¡ciou a kliknutÃ­m na tlaÄidlo OdoslaÅ¥ dokonÄite nastavenie
loginTotpStep3DeviceName=UveÄte nÃ¡zov zariadenia, ktorÃ½ vÃ¡m pomÃ´Å¾e spravovaÅ¥ zariadenia OTP. 
loginTotpManualStep2=Otvorte aplikÃ¡ciu a zadajte k
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
webauthn-doAuthenticate=PrihlÃ¡senie pomocou prihlasovacieho kÄ¾ÃºÄa
webauthn-createdAt-label=VytvorenÃ©

# WebAuthn Error
webauthn-error-title=ChybnÃ½ prihlasovacÃ­ kÄ¾ÃºÄ
webauthn-error-registration=Nepodarilo sa zaregistrovaÅ¥ prihlasovacÃ­ kÄ¾ÃºÄ.<br /> {0}
webauthn-error-api-get=Nepodarilo sa overiÅ¥ pomocou prihlasovacieho kÄ¾ÃºÄa.<br /> {0}
webauthn-error-different-user=PrvÃ½ overenÃ½ pouÅ¾Ã­vateÄ¾ nie je ten, ktorÃ½ bol overenÃ½ prihlasovacÃ­m kÄ¾ÃºÄom.
webauthn-error-auth-verification=VÃ½sledok overenia prihlaso
---
[Medium] chunk lines 21-40 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
kerberosNotConfigured=Kerberos nie je nakonfigurovanÃ½
kerberosNotConfiguredTitle=Kerberos nie je nakonfigurovanÃ½
bypassKerberosDetail=BuÄ nie ste prihlÃ¡senÃ½ cez Kerberos, alebo vÃ¡Å¡ prehliadaÄ nie je nastavenÃ½ na prihlÃ¡senie do Kerberos. KliknutÃ­m na tlaÄidlo PokraÄovaÅ¥ sa prihlÃ¡ste inÃ½m spÃ´sobom
kerberosNotSetUp=Kerberos nie je nastavenÃ½. NemÃ´Å¾ete sa prihlÃ¡siÅ¥.
registerTitle=RegistrÃ¡cia
loginAccountTitle=PrihlÃ¡ste sa do svojho ÃºÄtu
loginTitle=PrihlÃ¡senie do {0}
loginTitleHtml={0}
impersonateTitl
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_sv.properties:
locality=Postort
region=Stat, Provins eller Region
postal_code=Postnummer
country=Land
emailVerified=E-post verifierad
gssDelegationCredential=GSS Delegation Credential

loginTotpStep1=Installera en av fÃ¶ljande applikationer pÃ¥ din mobil:
loginTotpStep2=Ã–ppna applikationen och skanna streckkoden eller skriv i nyckeln
loginTotpStep3=Fyll i engÃ¥ngskoden som tillhandahÃ¥lls av applikationen och klicka pÃ¥ Spara fÃ¶r att avsluta instÃ¤llningarna
loginOtpOneTime=EngÃ¥ngskod

oauthGrantRequest=GodkÃ¤nner du
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_th.properties:
webauthn-error-title=à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¸‚à¸­à¸‡à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
webauthn-error-registration=à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ<br /> {0}
webauthn-error-api-get=à¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ<br /> {0}
webauthn-error-different-user=à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸£à¸²à¸¢à¹à¸£à¸à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸£à¸²à¸¢à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸ˆà¸²à¸à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
webauthn-error-auth-verification=à¸œà¸¥à¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡<br /> {0}
webauthn-error-register-verification=à¸œà¸¥à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸‚à¸­à¸‡à¸„à¸µ
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_tr.properties:
webauthn-passwordless-help-text= Åžifresiz giriÅŸ iÃ§in GeÃ§iÅŸ AnahtarÄ±nÄ±zÄ± kullanÄ±n.,
webauthn-login-title= GeÃ§iÅŸ AnahtarÄ±yla GiriÅŸ,
webauthn-registration-title= GeÃ§iÅŸ AnahtarÄ±yla KayÄ±t,
webauthn-available-authenticators= GeÃ§erli GeÃ§iÅŸ AnahtarlarÄ± ,
webauthn-unsupported-browser-text= WebAuthn tarayÄ±cÄ±nÄ±z tarafÄ±ndan desteklenmemektedir. BaÅŸka bir tarayÄ±cÄ±dan ulaÅŸmayÄ± deneyin veya yÃ¶neticinizle iletiÅŸime geÃ§in.,
webauthn-doAuthenticate= GeÃ§iÅŸ AnahtarÄ± ile giriÅŸ yap,
webauthn-createdAt-label= OluÅŸturu
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_uk.properties:
recovery-codes-download-file-description=ÐšÐ¾Ð´Ð¸ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ â€” Ñ†Ðµ Ð¾Ð´Ð½Ð¾Ñ€Ð°Ð·Ð¾Ð²Ñ– Ð¿Ð°Ñ€Ð¾Ð»Ñ–, ÑÐºÑ– Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‚ÑŒ Ð’Ð°Ð¼ ÑƒÐ²Ñ–Ð¹Ñ‚Ð¸ Ð´Ð¾ ÑÐ²Ð¾Ð³Ð¾ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ð¸ÑÑƒ, ÑÐºÑ‰Ð¾ Ñƒ Ð’Ð°Ñ Ð½ÐµÐ¼Ð°Ñ” Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ Ð´Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ‚Ð¾Ñ€Ð°.
recovery-codes-download-file-date=Ð¦Ñ– ÐºÐ¾Ð´Ð¸ Ð±ÑƒÐ»Ð¸ Ð·Ð³ÐµÐ½ÐµÑ€Ð¾Ð²Ð°Ð½Ñ–
recovery-codes-label-default=ÐšÐ¾Ð´Ð¸ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ

# WebAuthn
webauthn-display-name=ÐšÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
webauthn-help-text=Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ñ–Ð¹ ÐºÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð´Ð»Ñ Ð²Ñ…Ð¾Ð´Ñƒ.
webauthn-passwordless-display-name=ÐšÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
webauthn-passwordless-help-text=Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ñ–Ð¹ ÐºÐ»ÑŽÑ‡
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_uk.properties:
webauthn-error-different-user=ÐŸÐµÑ€ÑˆÐ¸Ð¹ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð½Ðµ Ñ” Ñ‚Ð¸Ð¼, Ñ…Ñ‚Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ÐµÐ¼ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸.
webauthn-error-auth-verification=Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ— ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð½ÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹.<br /> {0}
webauthn-error-register-verification=Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ñ€ÐµÑ”ÑÑ‚Ñ€Ð°Ñ†Ñ–Ñ— ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð½ÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹.<br /> {0}
webauthn-error-user-not-found=ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸.

# Identity provider
identity-provider-redirector=ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ñ–Ñ‚ÑŒÑÑ Ð´Ð¾ Ñ–Ð½ÑˆÐ¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð° Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ñ… Ð·Ð°Ð¿Ð¸ÑÑ–Ð²
identi
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_zh_CN.properties:
webauthn-doAuthenticate=ä½¿ç”¨å®‰å…¨å¯†é’¥ç™»å½•
webauthn-createdAt-label=åˆ›å»ºäºŽ

# WebAuthn Error
webauthn-error-title=å®‰å…¨å¯†é’¥é”™è¯¯
webauthn-error-registration=æ³¨å†Œæ‚¨çš„å®‰å…¨å¯†é’¥å¤±è´¥ã€‚<br /> {0}
webauthn-error-api-get=é€šè¿‡å®‰å…¨å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯å¤±è´¥ã€‚<br /> {0}
webauthn-error-different-user=é¦–æ¬¡ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¸æ˜¯é€šè¿‡å®‰å…¨å¯†é’¥ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚
webauthn-error-auth-verification=å®‰å…¨å¯†é’¥èº«ä»½éªŒè¯ç»“æžœæ— æ•ˆã€‚<br /> {0}
webauthn-error-register-verification=å®‰å…¨å¯†é’¥æ³¨å†Œç»“æžœæ— æ•ˆã€‚<br /> {0}
webauthn-error-user-not-found=é€šè¿‡å®‰å…¨å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·æœªçŸ¥ã€‚

# Identity provider
identity-provider-redirector=è¿žæŽ¥åˆ°å¦ä¸€ä¸ªèº«ä»½æä¾›è€…
identi
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_zh_TW.properties:
webauthn-login-title=å®‰å…¨é‡‘é‘°ç™»å…¥
webauthn-registration-title=è¨»å†Šå®‰å…¨é‡‘é‘°
webauthn-available-authenticators=å¯ç”¨çš„å®‰å…¨é‡‘é‘°
webauthn-unsupported-browser-text=æ­¤ç€è¦½å™¨ä¸æ”¯æ´ WebAuthnã€‚è«‹å˜—è©¦å…¶ä»–ç€è¦½å™¨æˆ–è¯çµ¡æ‚¨çš„ç³»çµ±ç®¡ç†å“¡ã€‚
webauthn-doAuthenticate=é€éŽå®‰å…¨é‡‘é‘°é€²è¡Œç™»å…¥
webauthn-createdAt-label=å·²å»ºç«‹
webauthn-registration-init-label=å®‰å…¨é‡‘é‘° (é è¨­æ¨™ç±¤)
webauthn-registration-init-label-prompt=è«‹ç‚ºè¨»å†Šçš„å®‰å…¨é‡‘é‘°è¼¸å…¥æ¨™ç±¤


# WebAuthn Error
webauthn-error-title=å®‰å…¨é‡‘é‘°éŒ¯èª¤
webauthn-error-registration=ç„¡æ³•è¨»å†Šæ‚¨çš„å®‰å…¨é‡‘é‘°ã€‚<br /> {0}
webauthn-error-api-get=ç„¡æ³•é€éŽå®‰å…¨é‡‘é‘°é€²è¡Œé©—è­‰ã€‚<br /> {0}
webauthn-error-di
---
[Medium] chunk lines 61-69 in themes/src/main/resources/theme/base/admin/messages/messages_en.properties:
error-invalid-uri=Invalid URL.
error-invalid-uri-scheme=Invalid URL scheme.
error-invalid-uri-fragment=Invalid URL fragment.
error-user-attribute-required=Please specify attribute {0}.
error-invalid-date=Attribute {0} is invalid date.
error-user-attribute-read-only=Attribute {0} is read only.
error-username-invalid-character={0} contains invalid character.
error-person-name-invalid-character={0} contains invalid character.
error-invalid-multivalued-size=Attribute {0} must have at least {1} and a
---
[Medium] chunk lines 481-500 in themes/src/main/resources/theme/base/login/messages/messages_en.properties:
webauthn-registration-init-label=Passkey (Default Label)
webauthn-registration-init-label-prompt=Please input your registered passkey''s label


# WebAuthn Error
webauthn-error-title=Passkey Error
webauthn-error-registration=Failed to register your Passkey.<br /> {0}
webauthn-error-api-get=Failed to authenticate by the Passkey.<br /> {0}
webauthn-error-different-user=First authenticated user is not the one authenticated by the Passkey.
webauthn-error-auth-verification=Passkey authentication resu
---
[Medium] chunk lines 521-537 in themes/src/main/resources/theme/base/login/messages/messages_en.properties:
access-denied-when-idp-auth=Access denied when authenticating with {0}

frontchannel-logout.title=Logging out
frontchannel-logout.message=You are logging out from following apps
logoutConfirmTitle=Logging out
logoutConfirmHeader=Do you want to log out?
doLogout=Logout

readOnlyUsernameMessage=You can''t update your username as it is read-only.
error-invalid-multivalued-size=Attribute {0} must have at least {1} and at most {2} {2,choice,0#values|1#value|1<values}.

organization.confirm-membership","VerifyMessageProperties (High), Pattern (Medium), Pattern (Medium), PolicyFactory (Medium), PolicyFactory (Medium), normalizeValue (Medium), containsHtml (Medium), santizeAnchors (Medium), getEnglishValue (Medium), verifySafeHtml (Medium), verify (Medium), verifyDuplicateKeysDetected (Medium), verifyIllegalHtmlTagDetected (Medium), verifyNoHtmlAllowed (Medium), verifyNoChangedAnchors (Medium), lines 101-101 (Medium), lines 1-18 (Medium), lines 181-200 (Medium), lines 1241-1260 (Medium), lines 3121-3140 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), VerifyMessagePropertiesTest (Medium), lines 141-160 (Medium), lines 101-120 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 461-480 (Medium), lines 421-440 (Medium), lines 461-480 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 441-460 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 381-400 (Medium), lines 401-420 (Medium), lines 381-400 (Medium), lines 361-380 (Medium), lines 461-480 (Medium), lines 481-500 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 481-500 (Medium), lines 61-80 (Medium), lines 61-80 (Medium), lines 501-501 (Medium), lines 121-140 (Medium), lines 461-480 (Medium), lines 21-40 (Medium), lines 61-80 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 61-69 (Medium), lines 481-500 (Medium), lines 521-537 (Medium), lines 101-112 (Low), lines 1-17 (Low), lines 1-17 (Low), lines 1-18 (Low), lines 1-17 (Low), lines 1-17 (Low), lines 1-17 (Low)",miss,"bug is in .properties translation file, not in VerifyMessageProperties Java class"
keycloak,7,Add HTML sanitizer for translated message resources,"The totpStep1 value uses Traditional Chinese terms in the Simplified Chinese file (zh_CN), which is likely incorrect for this locale. Please verify the localeâ€‘appropriate translation.",Medium,79,1,71,"class::VerifyMessageProperties (misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java) [High, score=0.63]","[High] class VerifyMessageProperties in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
public class VerifyMessageProperties {

    private final File file;
    private List<String> messages;

    public VerifyMessageProperties(File file) {
        this.file = file;
    }

    public List<String> verify() throws MojoExecutionException {
        messages = new ArrayList<>();
        try {
            String contents = Files.readString(file.toPath());
            verifyNoDuplicateKeys(contents);
            verifySafeHtml();
        } catch (IOException e) {
            throw new MojoExecutionException(""Can not read file "" + file, e);
        }
        return messages;
    }

    PolicyFactory POLICY_SOME_HTML = new org.owasp.html.HtmlPolicyBuilder()
            .allowElements(
                    ""br"", ""p"", ""strong"", ""b""
            ).toFactory();

    PolicyFactory POLICY_NO_","[Medium] field Pattern in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
Pattern HTML_TAGS = Pattern.compile(""<[a-z]+[^>]*>"");
---
[Medium] field Pattern in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private static final Pattern ANCHOR_PATTERN = Pattern.compile(""</?a[^>]*>"");
---
[Medium] field PolicyFactory in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
PolicyFactory POLICY_SOME_HTML = new org.owasp.html.HtmlPolicyBuilder()
            .allowElements(
                    ""br"", ""p"", ""strong"", ""b""
            ).toFactory();
---
[Medium] field PolicyFactory in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
PolicyFactory POLICY_NO_HTML = new org.owasp.html.HtmlPolicyBuilder().toFactory();
---
[Medium] method normalizeValue in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private String normalizeValue(String key, String value) {
        if (key.equals(""templateHelp"")) {
            // Allow ""CLAIM.<NAME>"" here
            value = value.replaceAll(""CLAIM\\.<[A-Z]*>"", """");
        } else if (key.equals(""optimizeLookupHelp"")) {
            // Allow ""<Extensions>"" here
            value = value.replaceAll(""<Extensions>"", """");
        } else if (key.startsWith(""linkExpirationFormatter.timePeriodUnit"") || key.equals(""error-invalid-multivalued-size"")) {
            // T
---
[Medium] method containsHtml in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private boolean containsHtml(String englishValue) {
        return HTML_TAGS.matcher(englishValue).find();
    }
---
[Medium] method santizeAnchors in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private String santizeAnchors(String key, String value, String englishValue) {
        Matcher matcher = ANCHOR_PATTERN.matcher(value);
        Matcher englishMatcher = ANCHOR_PATTERN.matcher(englishValue);
        while (matcher.find()) {
            if (englishMatcher.find() && Objects.equals(matcher.group(), englishMatcher.group())) {
                value = value.replaceFirst(Pattern.quote(englishMatcher.group()), """");
            } else {
                messages.add(""Didn't find anchor tag
---
[Medium] method getEnglishValue in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private static String getEnglishValue(String key, PropertyResourceBundle bundleEnglish) {
        String englishValue;
        try {
            englishValue = bundleEnglish.getString(key);
        } catch (MissingResourceException ex) {
            englishValue = """";
        }
        return englishValue;
    }
---
[Medium] method verifySafeHtml in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private void verifySafeHtml() {
        PropertyResourceBundle bundle;
        try (FileInputStream fis = new FileInputStream(file)) {
            bundle = new PropertyResourceBundle(fis);
        } catch (IOException e) {
            throw new RuntimeException(""unable to read file "" + file, e);
        }

        PropertyResourceBundle bundleEnglish;
        String englishFile = file.getAbsolutePath().replaceAll(""resources-community"", ""resources"")
                .replaceAll(""_[a-zA-Z-_]*\\.pro
---
[Medium] method verify in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
public List<String> verify() throws MojoExecutionException {
        messages = new ArrayList<>();
        try {
            String contents = Files.readString(file.toPath());
            verifyNoDuplicateKeys(contents);
            verifySafeHtml();
        } catch (IOException e) {
            throw new MojoExecutionException(""Can not read file "" + file, e);
        }
        return messages;
    }
---
[Medium] method verifyDuplicateKeysDetected in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyDuplicateKeysDetected() throws MojoExecutionException {
        List<String> verify = getFile(""duplicateKeys_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Duplicate keys in file"")));
    }
---
[Medium] method verifyIllegalHtmlTagDetected in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyIllegalHtmlTagDetected() throws MojoExecutionException {
        List<String> verify = getFile(""illegalHtmlTag_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Illegal HTML"")));
    }
---
[Medium] method verifyNoHtmlAllowed in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyNoHtmlAllowed() throws MojoExecutionException {
        List<String> verify = getFile(""noHtml_de.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Illegal HTML"")));
    }
---
[Medium] method verifyNoChangedAnchors in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyNoChangedAnchors() throws MojoExecutionException {
        List<String> verify = getFile(""changedAnchor_de.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Didn't find anchor tag"")));
    }
---
[Medium] chunk lines 101-101 in misc/theme-verifier/pom.xml:
</project>
---
[Medium] chunk lines 1-18 in misc/theme-verifier/src/test/resources/duplicate_keys.properties:
#
# Copyright 2025 Red Hat, Inc. and/or its affiliates
# and other contributors as indicated by the @author tags.
#
# Licensed under the Apache License, Version 2.0 (the ""License"");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an ""AS IS"" BASIS,
# WITHOUT WARRANTIES O
---
[Medium] chunk lines 181-200 in js/apps/account-ui/maven-resources/theme/keycloak.v3/account/messages/messages_en.properties:
sharedWithMe=Shared with Me
username=Username
webauthn-display-name=Passkey
webauthn-help-text=Use your Passkey to sign in.
webauthn-passwordless-display-name=Passkey
webauthn-passwordless-help-text=Use your Passkey for passwordless sign in.
passwordless=Passwordless
error-invalid-multivalued-size=Attribute {0} must have at least {1} and at most {2} {2,choice,0#values|1#value|1<values}.
recovery-authn-code=My recovery authentication codes
recovery-authn-codes-display-name=Recovery authentication
---
[Medium] chunk lines 1241-1260 in js/apps/admin-ui/maven-resources-community/theme/keycloak.v2/admin/messages/messages_zh_CN.properties:
prefix=æ¯ä¸ªé¢†åŸŸè§’è‰²çš„å‰ç¼€ï¼ˆéžå¿…éœ€ï¼‰ã€‚
xContentTypeOptionsHelp=é»˜è®¤å€¼é˜»æ­¢ Internet Explorer å’Œè°·æ­Œæµè§ˆå™¨ä»Ž MIME å—…æŽ¢è¿œç¦»å£°æ˜Žçš„å†…å®¹ç±»åž‹çš„å“åº”<1>äº†è§£æ›´å¤š</1>
privateKeyMask=ç§é’¥æœªè®¾ç½®æˆ–æœªçŸ¥
signOutAllActiveSessions=æ³¨é”€æ‰€æœ‰æ´»åŠ¨ä¼šè¯
addExecutorSuccess=æˆåŠŸï¼æ‰§è¡Œå™¨åˆ›å»ºæˆåŠŸ
executorTypeSelectHelpText=æ‰§è¡Œå™¨ç±»åž‹é€‰æ‹©å¸®åŠ©æ–‡æœ¬
useDiscoveryEndpointHelp=å¦‚æžœå¯ç”¨æ­¤è®¾ç½®ï¼Œå‘çŽ°ç«¯ç‚¹å°†ç”¨äºŽèŽ·å–ä¾›åº”å•†é…ç½®ã€‚Keycloak å¯ä»¥ä»Žç»ˆç«¯èŠ‚ç‚¹åŠ è½½é…ç½®å¹¶åœ¨æºæœ‰ä»»ä½•æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°é…ç½®
eventTypes.USER_INFO_REQUEST_ERROR.name=ç”¨æˆ·ä¿¡æ¯è¯·æ±‚é”™è¯¯
createUserProviderError=ç”±äºŽ{{error}}ï¼Œæ— æ³•åˆ›å»ºç”¨æˆ·è”ç›Ÿä¾›åº”å•†ã€‚
learnMore=äº†è§£æ›´å¤š
onDragCancel=å·²å–æ¶ˆæ‹–åŠ¨ã€‚åˆ—è¡¨æœªæ›´æ”¹ã€‚
removeUser=ç§»é™¤ç”¨æˆ·
ownerManagedAccess=å¯ç”¨ç”¨æˆ·ç®¡
---
[Medium] chunk lines 3121-3140 in js/apps/admin-ui/maven-resources/theme/keycloak.v2/admin/messages/messages_en.properties:
spinnerLoading=Loading
enableClientSignatureRequiredModal=Enable client signature required
selectBindType=Select bind type
searchClientAuthorizationResource=Search resource
searchClientAuthorizationPolicy=Search policy
searchClientAuthorizationPermission=Search permission
userNotSaved=The user has not been saved\: {{error}}
kcNumberFormat=Number Format
kcNumberUnFormat=Number UnFormat
tokenExpirationHelp=Sets the expiration for tokens. Expired tokens are periodically deleted from the database.
b
---
[Medium] chunk lines 81-100 in misc/theme-verifier/pom.xml:
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-text</artifactId>
            <version>1.13.0</version>
            <scope>compile</scope>
        </dependency>
    </dependencies>


    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
      
---
[Medium] chunk lines 61-80 in misc/theme-verifier/pom.xml:
            <version>2.18.0</version>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>5.10.5</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hamcrest</groupId>
            <artifactId>hamcrest</artifactId>
            <version>2.2</version>
            <scope>test</scope>
        </dependency>
        <dependency>
  
---
[Medium] class VerifyMessagePropertiesTest in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
class VerifyMessagePropertiesTest {

    @Test
    void verifyDuplicateKeysDetected() throws MojoExecutionException {
        List<String> verify = getFile(""duplicateKeys_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Duplicate keys in file"")));
    }

    @Test
    void verifyIllegalHtmlTagDetected() throws MojoExecutionException {
        List<String> verify = getFile(""illegalHtmlTag_en.properties"").verify();
        MatcherAssert.a
---
[Medium] chunk lines 141-160 in themes/src/main/resources-community/theme/base/account/messages/messages_fi.properties:
totpStep1=Asenna jokin seuraavista sovelluksista matkapuhelimeesi:
totpStep2=Avaa sovellus ja skannaa QR-koodi tai kirjoita avain.
totpStep3=TÃ¤ytÃ¤ saamasi kertaluontoinen koodisi allaolevaan kenttÃ¤Ã¤n ja paina Tallenna.
totpStep3DeviceName=Anna laitteelle nimi, jotta voit hallinnoida OTP-laitteitasi.

totpManualStep2=Avaa sovellus ja syÃ¶tÃ¤ koodi
totpManualStep3=KÃ¤ytÃ¤ seuraavia asetuksia mikÃ¤li sovellus sallii niiden syÃ¶tÃ¶n
totpUnableToScan=Ongelmia skannuksessa?
totpScanBarcode=Skannaa viivakoodi
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_lt.properties:
totpStep1=Installa una delle seguenti applicazioni sul tuo cellulare:
totpStep2=Atidarykite programÄ—lÄ™ ir nuskenuokite barkodÄ… arba Ä¯veskite kodÄ….
totpStep3=Ä®veskite programÄ—lÄ—je sugeneruotÄ… vienÄ… kartÄ… galiojantÄ¯ kodÄ… ir paspauskite Saugoti norÄ—dami prisijungti.

missingUsernameMessage=PraÅ¡ome Ä¯vesti naudotojo vardÄ….
missingFirstNameMessage=PraÅ¡ome Ä¯vesti vardÄ….
invalidEmailMessage=Neteisingas el. paÅ¡to adresas.
missingLastNameMessage=PraÅ¡ome Ä¯vesti pavardÄ™.
missingEmailMessage=PraÅ¡ome Ä¯vesti e
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_sk.properties:
totpStep1=NainÅ¡talujte si do mobilu jednu z nasledujÃºcich aplikÃ¡ciÃ­:
totpStep2=Otvorte aplikÃ¡ciu a naskenujte ÄiarovÃ½ kÃ³d alebo zadajte kÄ¾ÃºÄ.
totpStep3=Zadajte jednorazovÃ½ kÃ³d poskytnutÃ½ aplikÃ¡ciou a kliknutÃ­m na tlaÄidlo UloÅ¾iÅ¥ dokonÄÃ­te nastavenie.

totpManualStep2=Otvorte aplikÃ¡ciu a zadajte kÄ¾ÃºÄ
totpManualStep3=PouÅ¾ite nasledujÃºce hodnoty konfigurÃ¡cie, ak aplikÃ¡cia umoÅ¾Åˆuje ich nastavenie
totpUnableToScan=NemoÅ¾no skenovaÅ¥?
totpScanBarcode=Skenovanie ÄiarovÃ©ho kÃ³du?

totp.totp=ZaloÅ¾enÃ© na Äas
---
[Medium] chunk lines 81-100 in themes/src/main/resources-community/theme/base/account/messages/messages_sv.properties:
log=Logg

application=Applikation
availablePermissions=TillgÃ¤ngliga rÃ¤ttigheter
grantedPermissions=Beviljade rÃ¤ttigheter
grantedPersonalInfo=Medgiven personlig information
additionalGrants=Ytterligare medgivanden
action=Ã…tgÃ¤rd
inResource=i
fullAccess=FullstÃ¤ndig Ã¥tkomst
offlineToken=Offline token
revoke=UpphÃ¤v rÃ¤ttighet

configureAuthenticators=Konfigurerade autentiserare
mobile=Mobil
totpStep1=Installera en av fÃ¶ljande applikationer pÃ¥ din mobil:
totpStep2=Ã–ppna applikationen och skanna streckk
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_zh_CN.properties:
grantedPermissions=æŽˆäºˆæƒé™
grantedPersonalInfo=æŽˆæƒçš„ä¸ªäººä¿¡æ¯
additionalGrants=å¯æŽˆäºˆçš„æƒé™
action=æ“ä½œ
inResource=in
fullAccess=æ‰€æœ‰æƒé™
offlineToken=ç¦»çº¿ token
revoke=æ”¶å›žæŽˆæƒ

configureAuthenticators=é…ç½®çš„è®¤è¯è€…
mobile=æ‰‹æœº
totpStep1=åœ¨æ‚¨çš„æ‰‹æ©Ÿä¸Šå®‰è£ä»¥ä¸‹æ‡‰ç”¨ç¨‹å¼ä¹‹ä¸€ï¼š
totpStep2=æ‰“å¼€åº”ç”¨æ‰«æäºŒç»´ç è¾“å…¥éªŒè¯ç 
totpStep3=è¾“å…¥åº”ç”¨æä¾›çš„ä¸€æ¬¡æ€§éªŒè¯ç å•å‡»ä¿å­˜

missingUsernameMessage=è¯·æŒ‡å®šç”¨æˆ·å
missingFirstNameMessage=è¯·æŒ‡å®šå
invalidEmailMessage=æ— æ•ˆçš„ç”µå­é‚®ç®±åœ°å€
missingLastNameMessage=è¯·æŒ‡å®šå§“
missingEmailMessage=è¯·æŒ‡å®šé‚®ä»¶åœ°å€
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_da.properties:
emailVerificationSubject=Verificer email
emailVerificationBody=Nogen har oprettet en {2} konto med denne email adresse. Hvis dette var dig, bedes du trykke pÃ¥ forbindet herunder for at verificere din email adresse \n\n{0}\n\nDette link vil udlÃ¸be inden for {3}.\n\nHvis det var dig der har oprettet denne konto, bedes du se bort fra denne mail.
emailVerificationBodyHtml=<p>Nogen har oprettet en {2} konto med denne email adresse. Hvis dette var dig, bedes du trykke pÃ¥ forbindet herunder for at veri
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_fa.properties:
emailVerificationSubject=ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
emailVerificationBody=Ø´Ø®ØµÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ÛŒÚ© Ø­Ø³Ø§Ø¨ {2} Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø§ÛŒÙ† Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø±ÙˆÛŒ Ù¾ÛŒÙˆÙ†Ø¯ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯\n\n{0}\n\nØ§ÛŒÙ† Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ø± {3} Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.\n\nØ§Ú¯Ø± Ø´Ù…Ø§ Ø§ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŒ ÙÙ‚Ø· Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯ .
emailVerificationBodyHtml=<p>Ø´Ø®ØµÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ÛŒÚ© Ø­Ø³Ø§Ø¨ {2} Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø§ÛŒÙ† Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±ÙˆÛŒ Ù¾ÛŒÙˆÙ†Ø¯ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p><p><a href=""{0}"">Ù¾ÛŒÙˆÙ†Ø¯ Ø¨Ù‡ ØªØ£ÛŒÛŒØ¯ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„</a></p>
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_hu.properties:
emailVerificationSubject=E-mail cÃ­m megerÅ‘sÃ­tÃ©se
emailVerificationBody=Ezzel az e-mail cÃ­mmel valaki lÃ©trehozott egy {2} tartomÃ¡ny felhasznÃ¡lÃ³i fiÃ³kot. Amennyiben a fiÃ³kot Ã–n hozta lÃ©tre, kÃ©rem, kattintson a lenti hivatkozÃ¡sra, hogy megerÅ‘sÃ­tse fiÃ³kjÃ¡t Ã©s ezt az e-mail cÃ­met.\n\n{0}\n\nA hivatkozÃ¡s Ã©rvÃ©nyÃ©t veszti {3} mÃºlva.\n\nHa nem Ã¶n hozta lÃ©tre a felhasznÃ¡lÃ³i fiÃ³kot, akkor kÃ©rem, hagyja figyelmen kÃ­vÃ¼l ezt az Ã¼zenetet.
emailVerificationBodyHtml=<p>Ezzel az e-mail cÃ­mmel valaki lÃ©trehozott e
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_lt.properties:
emailVerificationSubject=El. paÅ¡to patvirtinimas
emailVerificationBody=Paskyra {2} sukurta naudojant Å¡Ä¯ el. paÅ¡to adresÄ…. Jei tai buvote JÅ«s, tuomet paspauskite Å¾emiau esanÄiÄ… nuorodÄ…\n\n{0}\n\nÅ i nuoroda galioja {1} min.\n\nJei paskyros nekÅ«rÄ—te, tuomet ignuoruokite Å¡Ä¯ laiÅ¡kÄ…. 
emailVerificationBodyHtml=<p>Paskyra {2} sukurta naudojant Å¡Ä¯ el. paÅ¡to adresÄ…. Jei tao buvote JÅ«s, tuomet paspauskite Å¾emiau esanÄiÄ… nuorodÄ…</p><p><a href=""{0}"">{0}</a></p><p>Å i nuoroda galioja {1} min.</p><p>nJei pasky
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_nl.properties:
emailVerificationSubject=Bevestig e-mailadres
emailVerificationBody=Iemand heeft een {2} account aangemaakt met dit e-mailadres. Als u dit was, klikt u op de onderstaande koppeling om uw e-mailadres te bevestigen \n\n{0}\n\nDeze koppeling zal binnen {3} vervallen.\n\nU kunt dit bericht negeren indien u dit account niet heeft aangemaakt.
emailVerificationBodyHtml=<p>Iemand heeft een {2} account aangemaakt met dit e-mailadres. Als u dit was, klikt u op de onderstaande koppeling om uw e-mailadres t
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_no.properties:
emailVerificationSubject=Bekreft e-postadresse
emailVerificationBody=Noen har opprettet en {2} konto med denne e-postadressen. Hvis dette var deg, klikk pÃ¥ lenken nedenfor for Ã¥ bekrefte e-postadressen din\n\n{0}\n\nDenne lenken vil utlÃ¸pe om {1} minutter.\n\nHvis du ikke opprettet denne kontoen, vennligst ignorer denne meldingen.
emailVerificationBodyHtml=<p>Noen har opprettet en {2} konto med denne e-postadressen. Hvis dette var deg, klikk pÃ¥ lenken nedenfor for Ã¥ bekrefte e-postadressen din</
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_tr.properties:
emailVerificationSubject=E-postayÄ± doÄŸrula
emailVerificationBody=Birisi bu e-posta adresiyle bir {2} hesap oluÅŸturdu. Bu sizseniz, e-posta adresinizi doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±ya tÄ±klayÄ±n\n\n{0}\n\nBu baÄŸlantÄ± {3} iÃ§inde sona erecek.\n\nBu hesabÄ± oluÅŸturmadÄ±ysanÄ±z, sadece bu iletiyi yoksayÄ±nÄ±z.
emailVerificationBodyHtml=<p>Birisi bu e-posta adresiyle bir {2} hesap oluÅŸturdu. Bu sizseniz, e-posta adresinizi doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±yÄ± tÄ±klayÄ±n.</p><p><a href=""{0}"">E-posta adresi 
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_uk.properties:
emailVerificationSubject=ÐŸÑ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ Ð°Ð´Ñ€ÐµÑÑƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸
emailVerificationBody=Ð¥Ñ‚Ð¾ÑÑŒ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ {2} Ñ–Ð· Ñ†Ñ–Ñ”ÑŽ Ð°Ð´Ñ€ÐµÑÐ¾ÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸. Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð±ÑƒÐ»Ð¸ Ð’Ð¸, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð½Ð¸Ð¶Ñ‡Ðµ, Ñ‰Ð¾Ð± Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ ÑÐ²Ð¾ÑŽ Ð°Ð´Ñ€ÐµÑÑƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸\n\n{0}\n\nÐ¦Ðµ Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð´Ñ–Ð¹ÑÐ½Ðµ Ð¿Ñ€Ð¾Ñ‚ÑÐ³Ð¾Ð¼ {3}.\n\nÐ¯ÐºÑ‰Ð¾ Ð’Ð¸ Ð½Ðµ ÑÑ‚Ð²Ð¾Ñ€ÑŽÐ²Ð°Ð»Ð¸ Ñ†ÐµÐ¹ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ñ–Ð³Ð½Ð¾Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ†ÐµÐ¹ Ð»Ð¸ÑÑ‚.
emailVerificationBodyHtml=<p>Ð¥Ñ‚Ð¾ÑÑŒ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ {2} Ñ–Ð· Ñ†Ñ–Ñ”ÑŽ Ð°Ð´Ñ€ÐµÑÐ¾ÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸. Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð±ÑƒÐ»Ð¸ Ð’Ð¸, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_ar.properties:
webauthn-doAuthenticate=ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†
webauthn-createdAt-label=ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ

# WebAuthn Error
webauthn-error-title=Ø®Ø·Ø£ ÙÙŠ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†
webauthn-error-registration=ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.<br /> {0}
webauthn-error-api-get=ÙØ´Ù„Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†.<br /> {0}
webauthn-error-different-user=Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… ØªÙ…Øª Ù…ØµØ§Ø¯Ù‚ØªÙ‡ Ù„ÙŠØ³ Ù‡Ùˆ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ØªÙ…Øª Ù…ØµØ§Ø¯Ù‚ØªÙ‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†.
webauthn-error-auth-verification=Ù†ØªÙŠØ¬Ø© Ù…ØµØ§Ø¯Ù‚Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† ØºÙŠØ± ØµØ§Ù„Ø­Ø©.<br /> {0}
webauthn-error-reg
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_ca.properties:
# WebAuthn Error
webauthn-error-title=Error de la clau de seguretat
webauthn-error-registration=No s''ha pogut registrar la vostra clau de seguretat.<br /> {0}
webauthn-error-api-get=No s''ha pogut identificar amb la clau de seguretat.<br /> {0}
webauthn-error-different-user=L''usuari identificat primer no Ã©s l''autenticat per la clau de seguretat.
webauthn-error-auth-verification=El resultat de l''autenticaciÃ³ amb clau de seguretat no Ã©s vÃ lid.<br />{0}
webauthn-error-register-verification=El r
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_cs.properties:
webauthn-doAuthenticate=PÅ™ihlÃ¡Å¡enÃ­ pÅ™Ã­stupovÃ½m klÃ­Äem
webauthn-createdAt-label=VytvoÅ™eno

# WebAuthn Error
webauthn-error-title=Chyba pÅ™Ã­stupovÃ©ho klÃ­Äe
webauthn-error-registration=Selhala registrace vaÅ¡eho pÅ™Ã­stupovÃ©ho klÃ­Äe.<br /> {0}
webauthn-error-api-get=Selhalo pÅ™ihlÃ¡Å¡enÃ­ pomocÃ­ pÅ™Ã­stupovÃ©ho klÃ­Äe.<br /> {0}
webauthn-error-different-user=PrvnÃ­ pÅ™ihlÃ¡Å¡enÃ½ uÅ¾ivatel nenÃ­ totoÅ¾nÃ½ s uÅ¾ivatelem pÅ™ihlÃ¡Å¡enÃ½m pomocÃ­ pÅ™Ã­stupovÃ©ho klÃ­Äe.
webauthn-error-auth-verification=NevalidnÃ­ vÃ½sledek pÅ™ihlÃ¡Å¡enÃ­ 
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_de.properties:
recovery-codes-download-file-header=Bewahren Sie diese Wiederherstellungscodes an einem sicheren Ort auf.
recovery-codes-download-file-description=Wiederherstellungscodes sind einmalig verwendbare PasswÃ¶rter, mit denen Sie sich bei Ihrem Konto anmelden kÃ¶nnen, wenn Sie keinen Zugriff auf Ihren Authentifikator haben.
recovery-codes-download-file-date=Diese Codes wurden generiert am
recovery-codes-label-default=Wiederherstellungscodes

# WebAuthn
webauthn-display-name=Passkey
webauthn-help-text=Ve
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_de.properties:
webauthn-error-api-get=Fehler beim Authentifizieren mit dem Passkey.<br /> {0}
webauthn-error-different-user=Der erste authentifizierte Benutzer ist nicht derjenige, der durch den Passkey authentifiziert wurde.
webauthn-error-auth-verification=Das Ergebnis der Passkey-Authentifizierung ist ungÃ¼ltig.<br /> {0}
webauthn-error-register-verification=Das Ergebnis der Passkey-Registrierung ist ungÃ¼ltig.<br /> {0}
webauthn-error-user-not-found=Unbekannter Benutzer, der mit dem Passkey authentifiziert w
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_el.properties:
recovery-codes-download-file-date=Î‘Ï…Ï„Î¿Î¯ Î¿Î¹ ÎºÏ‰Î´Î¹ÎºÎ¿Î¯ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½ ÏƒÏ„Î¹Ï‚
recovery-codes-label-default=ÎšÏ‰Î´Î¹ÎºÎ¿Î¯ Î±Î½Î¬ÎºÏ„Î·ÏƒÎ·Ï‚

# WebAuthn
webauthn-display-name=ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-help-text=Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÏƒÎ±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·.
webauthn-passwordless-display-name=ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-passwordless-help-text=Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚.
webauthn-login-title=Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Î¼Îµ ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-registration-title=Î•Î³Î³ÏÎ±Ï†Î® ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-avai
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_el.properties:
webauthn-error-auth-verification=ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.<br /> {0}
webauthn-error-register-verification=ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.<br /> {0}
webauthn-error-user-not-found=Î†Î³Î½Ï‰ÏƒÏ„Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ Î¼Îµ Ï„Î¿ ÎšÎ»ÎµÎ¹Î´Î¯ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.

# Identity provider
identity-provider-redirector=Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Î­Î½Î±Î½ Î¬Î»Î»Î¿ Î Î¬ÏÎ¿Ï‡Î¿ Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚
identity-provider-login-label=Î‰ ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ
idp-email-verification-display-name=Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Email
idp-email-verification-help
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_es.properties:
webauthn-error-title=Error de Passkey
webauthn-error-registration=No se pudo registrar su Passkey. <br /> {0}
webauthn-error-api-get=No se pudo autenticar con el Passkey. <br /> {0}
webauthn-error-different-user=El primer usuario autenticado no es el autenticado por el Passkey.
webauthn-error-auth-verification=El resultado de la autenticaciÃ³n con el Passkey no es vÃ¡lido. <br /> {0}
webauthn-error-register-verification=El resultado de registro del Passkey no es vÃ¡lido. <br /> {0}
webauthn-error-u
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_fa.properties:
recovery-codes-label-default=Ú©Ø¯Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ

# WebAuthn
webauthn-display-name=Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-help-text=.Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø®ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
webauthn-passwordless-display-name=Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-passwordless-help-text=.Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø®ÙˆØ¯ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
webauthn-login-title=ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-registration-title=Ø«Ø¨Øª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-available-authenticators=Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ù…ÙˆØ¬ÙˆØ¯
webauthn-unsupported-browser-text=WebAuthn ØªÙˆØ³Ø· Ø§ÛŒÙ† Ù…Ø±ÙˆØ±Ú¯Ø±
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_fa.properties:
webauthn-error-register-verification=Ù†ØªÛŒØ¬Ù‡ Ø«Ø¨Øª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.<br /> {0}
webauthn-error-user-not-found=.Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ø´Ù†Ø§Ø³ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø´Ø¯Ù‡ Ø§Ø³Øª

# Identity provider
identity-provider-redirector=Ø¨Ø§ ÛŒÚ© Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù‡ÙˆÛŒØª Ø¯ÛŒÚ¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†ÛŒØ¯
identity-provider-login-label=ÛŒØ§ ÙˆØ±ÙˆØ¯ Ø¨Ø§
idp-email-verification-display-name=ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
idp-email-verification-help-text=.Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ù‡ÛŒØ¯
idp-username-password-form-display-name=Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
idp-usernam
---
[Medium] chunk lines 381-400 in themes/src/main/resources-community/theme/base/login/messages/messages_fi.properties:
password-help-text=Kirjaudu sisÃ¤Ã¤n syÃ¶ttÃ¤mÃ¤llÃ¤ salasanasi.
auth-username-form-display-name=KÃ¤yttÃ¤jÃ¤nimi
auth-username-form-help-text=Aloita kirjautuminen syÃ¶ttÃ¤mÃ¤llÃ¤ kÃ¤yttÃ¤jÃ¤nimesi
auth-username-password-form-display-name=kÃ¤yttÃ¤jÃ¤nimi ja salasana
auth-username-password-form-help-text=Kirjaudu sisÃ¤Ã¤n syÃ¶ttÃ¤mÃ¤llÃ¤ kÃ¤yttÃ¤jÃ¤nimi ja salasana.

# WebAuthn
webauthn-display-name=Turva-avain
webauthn-help-text=KÃ¤ytÃ¤ Turva-avaintasi kirjatuaksesi sisÃ¤Ã¤n.
webauthn-passwordless-display-name=Turva-avain
webau
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_fi.properties:
webauthn-error-api-get=Tunnistautuminen Turva-avaimella epÃ¤onnistui.<br /> {0}
webauthn-error-different-user=Ensiksi tunnistautunut kÃ¤yttÃ¤jÃ¤ ei ole sama kuin Turva-avaimella tunnistaunut.
webauthn-error-auth-verification=Turva-avain -tunnistautumisen tulos on virheellinen.<br /> {0}
webauthn-error-register-verification=Turva-avaimen rekisterÃ¶innin tulos on virheellinen.<br /> {0}
webauthn-error-user-not-found=Tuntematon kÃ¤yttÃ¤jÃ¤ tunnistautui Turva-avaimella.

# Identity provider
identity-provide
---
[Medium] chunk lines 381-400 in themes/src/main/resources-community/theme/base/login/messages/messages_fr.properties:
webauthn-error-register-verification=Le rÃ©sultat de l''enregistrement de la clÃ© de sÃ©curitÃ© est invalide.<br /> {0}
webauthn-error-user-not-found=La ClÃ© de SÃ©curitÃ© a authentifiÃ© un utilisateur inconnu.
finalDeletionConfirmation=Si vous supprimez votre compte, il ne pourra pas Ãªtre restaurÃ©. Pour conserver votre compte, cliquez sur Annuler.
irreversibleAction=Cette action est irrÃ©versible
deleteAccountConfirm=Confirmation de suppression de compte
deletingImplies=Supprimer votre compte implique:

---
[Medium] chunk lines 361-380 in themes/src/main/resources-community/theme/base/login/messages/messages_fr.properties:
auth-username-password-form-help-text=Connectez-vous en saisissant votre nom d''utilisateur et votre mot de passe.

# WebAuthn
webauthn-display-name=ClÃ© de SÃ©curitÃ©
webauthn-help-text=Utilisez votre clÃ© de sÃ©curitÃ© pour vous connecter.
webauthn-passwordless-display-name=ClÃ© de SÃ©curitÃ©
webauthn-passwordless-help-text=Utilisez votre clÃ© de sÃ©curitÃ© pour vous connecter sans mot de passe.
webauthn-login-title=Connexion avec une ClÃ© de SÃ©curitÃ©
webauthn-registration-title=Enregistrement d''une ClÃ© d
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_hr.properties:

# WebAuthn
webauthn-display-name=Sigurnosni kljuÄ
webauthn-help-text=Koristite svoj sigurnosni kljuÄ za prijavu.
webauthn-passwordless-display-name=Sigurnosni kljuÄ
webauthn-passwordless-help-text=Koristite svoj sigurnosni kljuÄ za prijavu bez lozinke.
webauthn-login-title=Prijava sigurnosnim kljuÄem
webauthn-registration-title=Registracija sigurnosnog kljuÄa
webauthn-available-authenticators=Dostupni sigurnosni kljuÄevi
webauthn-unsupported-browser-text=WebAuthn nije podrÅ¾an u ovom pregledniku
---
[Medium] chunk lines 481-500 in themes/src/main/resources-community/theme/base/login/messages/messages_hr.properties:
webauthn-error-different-user=Prvi autentificirani korisnik nije isti kao korisnik autentificiran putem sigurnosnog kljuÄa.
webauthn-error-auth-verification=Rezultat autentifikacije putem sigurnosnog kljuÄa nije valjan.<br /> {0}
webauthn-error-register-verification=Rezultat registracije sigurnosnog kljuÄa nije valjan.<br /> {0}
webauthn-error-user-not-found=Nepoznati korisnik autentificiran putem sigurnosnog kljuÄa.

# Passkey
passkey-login-title=Prijava pristupnim kljuÄem
passkey-available-aut
---
[Medium] chunk lines 161-180 in themes/src/main/resources-community/theme/base/login/messages/messages_ka.properties:
webauthn-passwordless-display-name=Passkey
webauthn-passwordless-help-text=áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ Passkey áƒ£áƒžáƒáƒ áƒáƒšáƒáƒ“ áƒ¨áƒ”áƒ¡áƒáƒ¡áƒ•áƒšáƒ”áƒšáƒáƒ“.
webauthn-unsupported-browser-text=áƒáƒ› áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¡ WebAuthn-áƒ˜áƒ¡ áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ áƒáƒ  áƒ’áƒáƒáƒ©áƒœáƒ˜áƒ. áƒ¡áƒªáƒáƒ“áƒ”áƒ— áƒ¡áƒ®áƒ•áƒ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ˜ áƒáƒœ áƒ“áƒáƒ£áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ“áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ  áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ¡.
webauthn-doAuthenticate=Passkey-áƒ˜áƒ— áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ
webauthn-registration-init-label=Passkey (áƒœáƒáƒ’áƒ£áƒšáƒ˜áƒ¡áƒ®áƒ›áƒ”áƒ•áƒ˜ áƒ­áƒ“áƒ”)


# WebAuthn Error
webauthn-error-title=Passkey-áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ
webauthn-createdAt-label=áƒ¨áƒ”áƒ˜áƒ¥áƒ›áƒœáƒ
webauthn-registration-init-label-
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_ka.properties:
auth-username-password-form-display-name=áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ“áƒ áƒžáƒáƒ áƒáƒšáƒ˜
auth-username-password-form-help-text=áƒ¨áƒ”áƒ“áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡áƒ áƒ“áƒ áƒžáƒáƒ áƒáƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ˜áƒ—.
recovery-code-config-warning-message=áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ“áƒ˜áƒ—, áƒ áƒáƒ› áƒ“áƒáƒ‘áƒ”áƒ­áƒ“áƒáƒ—, áƒ’áƒáƒ“áƒ›áƒáƒ¬áƒ”áƒ áƒáƒ— áƒáƒœ áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒáƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒžáƒáƒ áƒáƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ›áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ¨áƒ˜ áƒ“áƒ áƒ˜áƒ¥áƒáƒœáƒ˜áƒ”áƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ“. áƒáƒ› áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ˜áƒ“áƒáƒœ áƒáƒ› áƒ™áƒáƒ“áƒ”áƒ‘áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡.
recovery-codes-action-complete=áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ
recovery-codes-action-cancel=áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ
recovery-codes-download-file-header=áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒ”áƒ— áƒ”áƒ¡ áƒ™áƒ
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_ko.properties:
recovery-codes-download-file-date=ì´ ì½”ë“œëŠ” ë‹¤ìŒ ë‚ ì§œì— ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:
recovery-codes-label-default=ë³µêµ¬ ì½”ë“œ

# WebAuthn
webauthn-display-name=íŒ¨ìŠ¤í‚¤
webauthn-help-text=íŒ¨ìŠ¤í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•˜ì„¸ìš”.
webauthn-passwordless-display-name=íŒ¨ìŠ¤í‚¤
webauthn-passwordless-help-text=íŒ¨ìŠ¤í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ë¡œê·¸ì¸í•˜ì„¸ìš”.
webauthn-login-title=íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸
webauthn-registration-title=íŒ¨ìŠ¤í‚¤ ë“±ë¡
webauthn-available-authenticators=ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ìŠ¤í‚¤
webauthn-unsupported-browser-text=ì´ ë¸Œë¼ìš°ì €ëŠ” WebAuthnì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
webauthn-doAuthenticate=íŒ¨ìŠ¤í‚¤ë¡œ ë¡œê·¸ì¸
weba
---
[Medium] chunk lines 481-500 in themes/src/main/resources-community/theme/base/login/messages/messages_ko.properties:
webauthn-error-api-get=íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-different-user=ì²« ë²ˆì§¸ ì¸ì¦ëœ ì‚¬ìš©ìžê°€ íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦ëœ ì‚¬ìš©ìžê°€ ì•„ë‹™ë‹ˆë‹¤.
webauthn-error-auth-verification=íŒ¨ìŠ¤í‚¤ ì¸ì¦ ê²°ê³¼ê°€ ìž˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-register-verification=íŒ¨ìŠ¤í‚¤ ë“±ë¡ ê²°ê³¼ê°€ ìž˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-user-not-found=íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦ëœ ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ìž.

# Passkey
passkey-login-title=íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸
passkey-available-authenticators=ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ìŠ¤í‚¤
passkey-unsupported-browser-text=ì´ ë¸Œë¼ìš°ì €ëŠ” íŒ¨ìŠ¤í‚¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
passkey-doAuthenticate=íŒ¨ìŠ¤í‚¤ë¡œ ë¡œê·¸ì¸
pa
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_lt.properties:
authenticatorCode=Vienkartinis kodas
address=Adresas
street=GatvÄ—
locality=Miestas arba vietovÄ—
region=Rajonas
postal_code=PaÅ¡to kodas
country=Å alis
emailVerified=El. paÅ¡to adresas patvirtintas
gssDelegationCredential=GSS prisijungimo duomenÅ³ delegavimas

loginTotpStep1=Installa una delle seguenti applicazioni sul tuo cellulare:
loginTotpStep2=Atidarykite programÄ—lÄ™ ir nuskenuokite barkodÄ… arba Ä¯veskite kodÄ….
loginTotpStep3=Ä®veskite programÄ—lÄ—je sugeneruotÄ… vienÄ… kartÄ… galiojantÄ¯ kodÄ… ir paspaus
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_no.properties:
authenticatorCode=Engangskode
address=Adresse
street=Gate-/veinavn + husnummer
locality=By
region=Fylke
postal_code=Postnummer
country=Land
emailVerified=E-postadresse bekreftet
gssDelegationCredential=GSS legitimasjons-delegering

loginTotpStep1=Installer en av fÃ¸lgende applikasjoner pÃ¥ mobilen din:
loginTotpStep2=Ã…pne applikasjonen og skann strekkoden eller skriv inn koden
loginTotpStep3=Skriv inn engangskoden fra applikasjonen og klikk send inn for Ã¥ fullfÃ¸re
loginOtpOneTime=Engangskode

oaut
---
[Medium] chunk lines 501-501 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
error-invalid-multivalued-size=AtribÃºt {0} musÃ­ maÅ¥ najmenej {1} {1,choice,0#hodnÃ´t|1#hodnotu|1<hodnoty|4<hodnÃ´t} a najviac {2} {2,choice,0#hodnÃ´t|1#hodnotu|1<hodnoty|4<hodnÃ´t}.
---
[Medium] chunk lines 121-140 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:

loginTotpIntro=Pre prÃ­stup k tomuto ÃºÄtu je potrebnÃ© nastaviÅ¥ generÃ¡tor jednorazovÃ½ch kÃ³dov
loginTotpStep1=NainÅ¡talujte si do mobilu jednu z nasledujÃºcich aplikÃ¡ciÃ­:
loginTotpStep2=Otvorte aplikÃ¡ciu a skenujte ÄiarovÃ½ kÃ³d alebo zadajte kÄ¾ÃºÄ
loginTotpStep3=Zadajte jednorazovÃ½ kÃ³d poskytnutÃ½ aplikÃ¡ciou a kliknutÃ­m na tlaÄidlo OdoslaÅ¥ dokonÄite nastavenie
loginTotpStep3DeviceName=UveÄte nÃ¡zov zariadenia, ktorÃ½ vÃ¡m pomÃ´Å¾e spravovaÅ¥ zariadenia OTP. 
loginTotpManualStep2=Otvorte aplikÃ¡ciu a zadajte k
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
webauthn-doAuthenticate=PrihlÃ¡senie pomocou prihlasovacieho kÄ¾ÃºÄa
webauthn-createdAt-label=VytvorenÃ©

# WebAuthn Error
webauthn-error-title=ChybnÃ½ prihlasovacÃ­ kÄ¾ÃºÄ
webauthn-error-registration=Nepodarilo sa zaregistrovaÅ¥ prihlasovacÃ­ kÄ¾ÃºÄ.<br /> {0}
webauthn-error-api-get=Nepodarilo sa overiÅ¥ pomocou prihlasovacieho kÄ¾ÃºÄa.<br /> {0}
webauthn-error-different-user=PrvÃ½ overenÃ½ pouÅ¾Ã­vateÄ¾ nie je ten, ktorÃ½ bol overenÃ½ prihlasovacÃ­m kÄ¾ÃºÄom.
webauthn-error-auth-verification=VÃ½sledok overenia prihlaso
---
[Medium] chunk lines 21-40 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
kerberosNotConfigured=Kerberos nie je nakonfigurovanÃ½
kerberosNotConfiguredTitle=Kerberos nie je nakonfigurovanÃ½
bypassKerberosDetail=BuÄ nie ste prihlÃ¡senÃ½ cez Kerberos, alebo vÃ¡Å¡ prehliadaÄ nie je nastavenÃ½ na prihlÃ¡senie do Kerberos. KliknutÃ­m na tlaÄidlo PokraÄovaÅ¥ sa prihlÃ¡ste inÃ½m spÃ´sobom
kerberosNotSetUp=Kerberos nie je nastavenÃ½. NemÃ´Å¾ete sa prihlÃ¡siÅ¥.
registerTitle=RegistrÃ¡cia
loginAccountTitle=PrihlÃ¡ste sa do svojho ÃºÄtu
loginTitle=PrihlÃ¡senie do {0}
loginTitleHtml={0}
impersonateTitl
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_sv.properties:
locality=Postort
region=Stat, Provins eller Region
postal_code=Postnummer
country=Land
emailVerified=E-post verifierad
gssDelegationCredential=GSS Delegation Credential

loginTotpStep1=Installera en av fÃ¶ljande applikationer pÃ¥ din mobil:
loginTotpStep2=Ã–ppna applikationen och skanna streckkoden eller skriv i nyckeln
loginTotpStep3=Fyll i engÃ¥ngskoden som tillhandahÃ¥lls av applikationen och klicka pÃ¥ Spara fÃ¶r att avsluta instÃ¤llningarna
loginOtpOneTime=EngÃ¥ngskod

oauthGrantRequest=GodkÃ¤nner du
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_th.properties:
webauthn-error-title=à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¸‚à¸­à¸‡à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
webauthn-error-registration=à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ<br /> {0}
webauthn-error-api-get=à¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ<br /> {0}
webauthn-error-different-user=à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸£à¸²à¸¢à¹à¸£à¸à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸£à¸²à¸¢à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸ˆà¸²à¸à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
webauthn-error-auth-verification=à¸œà¸¥à¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡<br /> {0}
webauthn-error-register-verification=à¸œà¸¥à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸‚à¸­à¸‡à¸„à¸µ
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_tr.properties:
webauthn-passwordless-help-text= Åžifresiz giriÅŸ iÃ§in GeÃ§iÅŸ AnahtarÄ±nÄ±zÄ± kullanÄ±n.,
webauthn-login-title= GeÃ§iÅŸ AnahtarÄ±yla GiriÅŸ,
webauthn-registration-title= GeÃ§iÅŸ AnahtarÄ±yla KayÄ±t,
webauthn-available-authenticators= GeÃ§erli GeÃ§iÅŸ AnahtarlarÄ± ,
webauthn-unsupported-browser-text= WebAuthn tarayÄ±cÄ±nÄ±z tarafÄ±ndan desteklenmemektedir. BaÅŸka bir tarayÄ±cÄ±dan ulaÅŸmayÄ± deneyin veya yÃ¶neticinizle iletiÅŸime geÃ§in.,
webauthn-doAuthenticate= GeÃ§iÅŸ AnahtarÄ± ile giriÅŸ yap,
webauthn-createdAt-label= OluÅŸturu
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_uk.properties:
recovery-codes-download-file-description=ÐšÐ¾Ð´Ð¸ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ â€” Ñ†Ðµ Ð¾Ð´Ð½Ð¾Ñ€Ð°Ð·Ð¾Ð²Ñ– Ð¿Ð°Ñ€Ð¾Ð»Ñ–, ÑÐºÑ– Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‚ÑŒ Ð’Ð°Ð¼ ÑƒÐ²Ñ–Ð¹Ñ‚Ð¸ Ð´Ð¾ ÑÐ²Ð¾Ð³Ð¾ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ð¸ÑÑƒ, ÑÐºÑ‰Ð¾ Ñƒ Ð’Ð°Ñ Ð½ÐµÐ¼Ð°Ñ” Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ Ð´Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ‚Ð¾Ñ€Ð°.
recovery-codes-download-file-date=Ð¦Ñ– ÐºÐ¾Ð´Ð¸ Ð±ÑƒÐ»Ð¸ Ð·Ð³ÐµÐ½ÐµÑ€Ð¾Ð²Ð°Ð½Ñ–
recovery-codes-label-default=ÐšÐ¾Ð´Ð¸ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ

# WebAuthn
webauthn-display-name=ÐšÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
webauthn-help-text=Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ñ–Ð¹ ÐºÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð´Ð»Ñ Ð²Ñ…Ð¾Ð´Ñƒ.
webauthn-passwordless-display-name=ÐšÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
webauthn-passwordless-help-text=Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ñ–Ð¹ ÐºÐ»ÑŽÑ‡
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_uk.properties:
webauthn-error-different-user=ÐŸÐµÑ€ÑˆÐ¸Ð¹ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð½Ðµ Ñ” Ñ‚Ð¸Ð¼, Ñ…Ñ‚Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ÐµÐ¼ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸.
webauthn-error-auth-verification=Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ— ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð½ÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹.<br /> {0}
webauthn-error-register-verification=Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ñ€ÐµÑ”ÑÑ‚Ñ€Ð°Ñ†Ñ–Ñ— ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð½ÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹.<br /> {0}
webauthn-error-user-not-found=ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸.

# Identity provider
identity-provider-redirector=ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ñ–Ñ‚ÑŒÑÑ Ð´Ð¾ Ñ–Ð½ÑˆÐ¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð° Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ñ… Ð·Ð°Ð¿Ð¸ÑÑ–Ð²
identi
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_zh_CN.properties:
webauthn-doAuthenticate=ä½¿ç”¨å®‰å…¨å¯†é’¥ç™»å½•
webauthn-createdAt-label=åˆ›å»ºäºŽ

# WebAuthn Error
webauthn-error-title=å®‰å…¨å¯†é’¥é”™è¯¯
webauthn-error-registration=æ³¨å†Œæ‚¨çš„å®‰å…¨å¯†é’¥å¤±è´¥ã€‚<br /> {0}
webauthn-error-api-get=é€šè¿‡å®‰å…¨å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯å¤±è´¥ã€‚<br /> {0}
webauthn-error-different-user=é¦–æ¬¡ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¸æ˜¯é€šè¿‡å®‰å…¨å¯†é’¥ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚
webauthn-error-auth-verification=å®‰å…¨å¯†é’¥èº«ä»½éªŒè¯ç»“æžœæ— æ•ˆã€‚<br /> {0}
webauthn-error-register-verification=å®‰å…¨å¯†é’¥æ³¨å†Œç»“æžœæ— æ•ˆã€‚<br /> {0}
webauthn-error-user-not-found=é€šè¿‡å®‰å…¨å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·æœªçŸ¥ã€‚

# Identity provider
identity-provider-redirector=è¿žæŽ¥åˆ°å¦ä¸€ä¸ªèº«ä»½æä¾›è€…
identi
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_zh_TW.properties:
webauthn-login-title=å®‰å…¨é‡‘é‘°ç™»å…¥
webauthn-registration-title=è¨»å†Šå®‰å…¨é‡‘é‘°
webauthn-available-authenticators=å¯ç”¨çš„å®‰å…¨é‡‘é‘°
webauthn-unsupported-browser-text=æ­¤ç€è¦½å™¨ä¸æ”¯æ´ WebAuthnã€‚è«‹å˜—è©¦å…¶ä»–ç€è¦½å™¨æˆ–è¯çµ¡æ‚¨çš„ç³»çµ±ç®¡ç†å“¡ã€‚
webauthn-doAuthenticate=é€éŽå®‰å…¨é‡‘é‘°é€²è¡Œç™»å…¥
webauthn-createdAt-label=å·²å»ºç«‹
webauthn-registration-init-label=å®‰å…¨é‡‘é‘° (é è¨­æ¨™ç±¤)
webauthn-registration-init-label-prompt=è«‹ç‚ºè¨»å†Šçš„å®‰å…¨é‡‘é‘°è¼¸å…¥æ¨™ç±¤


# WebAuthn Error
webauthn-error-title=å®‰å…¨é‡‘é‘°éŒ¯èª¤
webauthn-error-registration=ç„¡æ³•è¨»å†Šæ‚¨çš„å®‰å…¨é‡‘é‘°ã€‚<br /> {0}
webauthn-error-api-get=ç„¡æ³•é€éŽå®‰å…¨é‡‘é‘°é€²è¡Œé©—è­‰ã€‚<br /> {0}
webauthn-error-di
---
[Medium] chunk lines 61-69 in themes/src/main/resources/theme/base/admin/messages/messages_en.properties:
error-invalid-uri=Invalid URL.
error-invalid-uri-scheme=Invalid URL scheme.
error-invalid-uri-fragment=Invalid URL fragment.
error-user-attribute-required=Please specify attribute {0}.
error-invalid-date=Attribute {0} is invalid date.
error-user-attribute-read-only=Attribute {0} is read only.
error-username-invalid-character={0} contains invalid character.
error-person-name-invalid-character={0} contains invalid character.
error-invalid-multivalued-size=Attribute {0} must have at least {1} and a
---
[Medium] chunk lines 481-500 in themes/src/main/resources/theme/base/login/messages/messages_en.properties:
webauthn-registration-init-label=Passkey (Default Label)
webauthn-registration-init-label-prompt=Please input your registered passkey''s label


# WebAuthn Error
webauthn-error-title=Passkey Error
webauthn-error-registration=Failed to register your Passkey.<br /> {0}
webauthn-error-api-get=Failed to authenticate by the Passkey.<br /> {0}
webauthn-error-different-user=First authenticated user is not the one authenticated by the Passkey.
webauthn-error-auth-verification=Passkey authentication resu
---
[Medium] chunk lines 521-537 in themes/src/main/resources/theme/base/login/messages/messages_en.properties:
access-denied-when-idp-auth=Access denied when authenticating with {0}

frontchannel-logout.title=Logging out
frontchannel-logout.message=You are logging out from following apps
logoutConfirmTitle=Logging out
logoutConfirmHeader=Do you want to log out?
doLogout=Logout

readOnlyUsernameMessage=You can''t update your username as it is read-only.
error-invalid-multivalued-size=Attribute {0} must have at least {1} and at most {2} {2,choice,0#values|1#value|1<values}.

organization.confirm-membership","VerifyMessageProperties (High), Pattern (Medium), Pattern (Medium), PolicyFactory (Medium), PolicyFactory (Medium), normalizeValue (Medium), containsHtml (Medium), santizeAnchors (Medium), getEnglishValue (Medium), verifySafeHtml (Medium), verify (Medium), verifyDuplicateKeysDetected (Medium), verifyIllegalHtmlTagDetected (Medium), verifyNoHtmlAllowed (Medium), verifyNoChangedAnchors (Medium), lines 101-101 (Medium), lines 1-18 (Medium), lines 181-200 (Medium), lines 1241-1260 (Medium), lines 3121-3140 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), VerifyMessagePropertiesTest (Medium), lines 141-160 (Medium), lines 101-120 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 461-480 (Medium), lines 421-440 (Medium), lines 461-480 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 441-460 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 381-400 (Medium), lines 401-420 (Medium), lines 381-400 (Medium), lines 361-380 (Medium), lines 461-480 (Medium), lines 481-500 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 481-500 (Medium), lines 61-80 (Medium), lines 61-80 (Medium), lines 501-501 (Medium), lines 121-140 (Medium), lines 461-480 (Medium), lines 21-40 (Medium), lines 61-80 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 61-69 (Medium), lines 481-500 (Medium), lines 521-537 (Medium), lines 101-112 (Low), lines 1-17 (Low), lines 1-17 (Low), lines 1-18 (Low), lines 1-17 (Low), lines 1-17 (Low), lines 1-17 (Low)",miss,"bug is in .properties translation file, not in Java code"
keycloak,7,Add HTML sanitizer for translated message resources,"The anchor sanitization logic has a potential issue where it consumes English matcher groups without proper validation. If the translated text has more anchor tags than the English text, this could lead to incorrect validation results.",Low,79,1,71,"class::VerifyMessageProperties (misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java) [High, score=0.63]","[High] class VerifyMessageProperties in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
public class VerifyMessageProperties {

    private final File file;
    private List<String> messages;

    public VerifyMessageProperties(File file) {
        this.file = file;
    }

    public List<String> verify() throws MojoExecutionException {
        messages = new ArrayList<>();
        try {
            String contents = Files.readString(file.toPath());
            verifyNoDuplicateKeys(contents);
            verifySafeHtml();
        } catch (IOException e) {
            throw new MojoExecutionException(""Can not read file "" + file, e);
        }
        return messages;
    }

    PolicyFactory POLICY_SOME_HTML = new org.owasp.html.HtmlPolicyBuilder()
            .allowElements(
                    ""br"", ""p"", ""strong"", ""b""
            ).toFactory();

    PolicyFactory POLICY_NO_","[Medium] field Pattern in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
Pattern HTML_TAGS = Pattern.compile(""<[a-z]+[^>]*>"");
---
[Medium] field Pattern in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private static final Pattern ANCHOR_PATTERN = Pattern.compile(""</?a[^>]*>"");
---
[Medium] field PolicyFactory in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
PolicyFactory POLICY_SOME_HTML = new org.owasp.html.HtmlPolicyBuilder()
            .allowElements(
                    ""br"", ""p"", ""strong"", ""b""
            ).toFactory();
---
[Medium] field PolicyFactory in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
PolicyFactory POLICY_NO_HTML = new org.owasp.html.HtmlPolicyBuilder().toFactory();
---
[Medium] method normalizeValue in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private String normalizeValue(String key, String value) {
        if (key.equals(""templateHelp"")) {
            // Allow ""CLAIM.<NAME>"" here
            value = value.replaceAll(""CLAIM\\.<[A-Z]*>"", """");
        } else if (key.equals(""optimizeLookupHelp"")) {
            // Allow ""<Extensions>"" here
            value = value.replaceAll(""<Extensions>"", """");
        } else if (key.startsWith(""linkExpirationFormatter.timePeriodUnit"") || key.equals(""error-invalid-multivalued-size"")) {
            // T
---
[Medium] method containsHtml in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private boolean containsHtml(String englishValue) {
        return HTML_TAGS.matcher(englishValue).find();
    }
---
[Medium] method santizeAnchors in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private String santizeAnchors(String key, String value, String englishValue) {
        Matcher matcher = ANCHOR_PATTERN.matcher(value);
        Matcher englishMatcher = ANCHOR_PATTERN.matcher(englishValue);
        while (matcher.find()) {
            if (englishMatcher.find() && Objects.equals(matcher.group(), englishMatcher.group())) {
                value = value.replaceFirst(Pattern.quote(englishMatcher.group()), """");
            } else {
                messages.add(""Didn't find anchor tag
---
[Medium] method getEnglishValue in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private static String getEnglishValue(String key, PropertyResourceBundle bundleEnglish) {
        String englishValue;
        try {
            englishValue = bundleEnglish.getString(key);
        } catch (MissingResourceException ex) {
            englishValue = """";
        }
        return englishValue;
    }
---
[Medium] method verifySafeHtml in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private void verifySafeHtml() {
        PropertyResourceBundle bundle;
        try (FileInputStream fis = new FileInputStream(file)) {
            bundle = new PropertyResourceBundle(fis);
        } catch (IOException e) {
            throw new RuntimeException(""unable to read file "" + file, e);
        }

        PropertyResourceBundle bundleEnglish;
        String englishFile = file.getAbsolutePath().replaceAll(""resources-community"", ""resources"")
                .replaceAll(""_[a-zA-Z-_]*\\.pro
---
[Medium] method verify in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
public List<String> verify() throws MojoExecutionException {
        messages = new ArrayList<>();
        try {
            String contents = Files.readString(file.toPath());
            verifyNoDuplicateKeys(contents);
            verifySafeHtml();
        } catch (IOException e) {
            throw new MojoExecutionException(""Can not read file "" + file, e);
        }
        return messages;
    }
---
[Medium] method verifyDuplicateKeysDetected in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyDuplicateKeysDetected() throws MojoExecutionException {
        List<String> verify = getFile(""duplicateKeys_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Duplicate keys in file"")));
    }
---
[Medium] method verifyIllegalHtmlTagDetected in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyIllegalHtmlTagDetected() throws MojoExecutionException {
        List<String> verify = getFile(""illegalHtmlTag_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Illegal HTML"")));
    }
---
[Medium] method verifyNoHtmlAllowed in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyNoHtmlAllowed() throws MojoExecutionException {
        List<String> verify = getFile(""noHtml_de.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Illegal HTML"")));
    }
---
[Medium] method verifyNoChangedAnchors in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyNoChangedAnchors() throws MojoExecutionException {
        List<String> verify = getFile(""changedAnchor_de.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Didn't find anchor tag"")));
    }
---
[Medium] chunk lines 101-101 in misc/theme-verifier/pom.xml:
</project>
---
[Medium] chunk lines 1-18 in misc/theme-verifier/src/test/resources/duplicate_keys.properties:
#
# Copyright 2025 Red Hat, Inc. and/or its affiliates
# and other contributors as indicated by the @author tags.
#
# Licensed under the Apache License, Version 2.0 (the ""License"");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an ""AS IS"" BASIS,
# WITHOUT WARRANTIES O
---
[Medium] chunk lines 181-200 in js/apps/account-ui/maven-resources/theme/keycloak.v3/account/messages/messages_en.properties:
sharedWithMe=Shared with Me
username=Username
webauthn-display-name=Passkey
webauthn-help-text=Use your Passkey to sign in.
webauthn-passwordless-display-name=Passkey
webauthn-passwordless-help-text=Use your Passkey for passwordless sign in.
passwordless=Passwordless
error-invalid-multivalued-size=Attribute {0} must have at least {1} and at most {2} {2,choice,0#values|1#value|1<values}.
recovery-authn-code=My recovery authentication codes
recovery-authn-codes-display-name=Recovery authentication
---
[Medium] chunk lines 1241-1260 in js/apps/admin-ui/maven-resources-community/theme/keycloak.v2/admin/messages/messages_zh_CN.properties:
prefix=æ¯ä¸ªé¢†åŸŸè§’è‰²çš„å‰ç¼€ï¼ˆéžå¿…éœ€ï¼‰ã€‚
xContentTypeOptionsHelp=é»˜è®¤å€¼é˜»æ­¢ Internet Explorer å’Œè°·æ­Œæµè§ˆå™¨ä»Ž MIME å—…æŽ¢è¿œç¦»å£°æ˜Žçš„å†…å®¹ç±»åž‹çš„å“åº”<1>äº†è§£æ›´å¤š</1>
privateKeyMask=ç§é’¥æœªè®¾ç½®æˆ–æœªçŸ¥
signOutAllActiveSessions=æ³¨é”€æ‰€æœ‰æ´»åŠ¨ä¼šè¯
addExecutorSuccess=æˆåŠŸï¼æ‰§è¡Œå™¨åˆ›å»ºæˆåŠŸ
executorTypeSelectHelpText=æ‰§è¡Œå™¨ç±»åž‹é€‰æ‹©å¸®åŠ©æ–‡æœ¬
useDiscoveryEndpointHelp=å¦‚æžœå¯ç”¨æ­¤è®¾ç½®ï¼Œå‘çŽ°ç«¯ç‚¹å°†ç”¨äºŽèŽ·å–ä¾›åº”å•†é…ç½®ã€‚Keycloak å¯ä»¥ä»Žç»ˆç«¯èŠ‚ç‚¹åŠ è½½é…ç½®å¹¶åœ¨æºæœ‰ä»»ä½•æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°é…ç½®
eventTypes.USER_INFO_REQUEST_ERROR.name=ç”¨æˆ·ä¿¡æ¯è¯·æ±‚é”™è¯¯
createUserProviderError=ç”±äºŽ{{error}}ï¼Œæ— æ³•åˆ›å»ºç”¨æˆ·è”ç›Ÿä¾›åº”å•†ã€‚
learnMore=äº†è§£æ›´å¤š
onDragCancel=å·²å–æ¶ˆæ‹–åŠ¨ã€‚åˆ—è¡¨æœªæ›´æ”¹ã€‚
removeUser=ç§»é™¤ç”¨æˆ·
ownerManagedAccess=å¯ç”¨ç”¨æˆ·ç®¡
---
[Medium] chunk lines 3121-3140 in js/apps/admin-ui/maven-resources/theme/keycloak.v2/admin/messages/messages_en.properties:
spinnerLoading=Loading
enableClientSignatureRequiredModal=Enable client signature required
selectBindType=Select bind type
searchClientAuthorizationResource=Search resource
searchClientAuthorizationPolicy=Search policy
searchClientAuthorizationPermission=Search permission
userNotSaved=The user has not been saved\: {{error}}
kcNumberFormat=Number Format
kcNumberUnFormat=Number UnFormat
tokenExpirationHelp=Sets the expiration for tokens. Expired tokens are periodically deleted from the database.
b
---
[Medium] chunk lines 81-100 in misc/theme-verifier/pom.xml:
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-text</artifactId>
            <version>1.13.0</version>
            <scope>compile</scope>
        </dependency>
    </dependencies>


    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
      
---
[Medium] chunk lines 61-80 in misc/theme-verifier/pom.xml:
            <version>2.18.0</version>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>5.10.5</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hamcrest</groupId>
            <artifactId>hamcrest</artifactId>
            <version>2.2</version>
            <scope>test</scope>
        </dependency>
        <dependency>
  
---
[Medium] class VerifyMessagePropertiesTest in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
class VerifyMessagePropertiesTest {

    @Test
    void verifyDuplicateKeysDetected() throws MojoExecutionException {
        List<String> verify = getFile(""duplicateKeys_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Duplicate keys in file"")));
    }

    @Test
    void verifyIllegalHtmlTagDetected() throws MojoExecutionException {
        List<String> verify = getFile(""illegalHtmlTag_en.properties"").verify();
        MatcherAssert.a
---
[Medium] chunk lines 141-160 in themes/src/main/resources-community/theme/base/account/messages/messages_fi.properties:
totpStep1=Asenna jokin seuraavista sovelluksista matkapuhelimeesi:
totpStep2=Avaa sovellus ja skannaa QR-koodi tai kirjoita avain.
totpStep3=TÃ¤ytÃ¤ saamasi kertaluontoinen koodisi allaolevaan kenttÃ¤Ã¤n ja paina Tallenna.
totpStep3DeviceName=Anna laitteelle nimi, jotta voit hallinnoida OTP-laitteitasi.

totpManualStep2=Avaa sovellus ja syÃ¶tÃ¤ koodi
totpManualStep3=KÃ¤ytÃ¤ seuraavia asetuksia mikÃ¤li sovellus sallii niiden syÃ¶tÃ¶n
totpUnableToScan=Ongelmia skannuksessa?
totpScanBarcode=Skannaa viivakoodi
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_lt.properties:
totpStep1=Installa una delle seguenti applicazioni sul tuo cellulare:
totpStep2=Atidarykite programÄ—lÄ™ ir nuskenuokite barkodÄ… arba Ä¯veskite kodÄ….
totpStep3=Ä®veskite programÄ—lÄ—je sugeneruotÄ… vienÄ… kartÄ… galiojantÄ¯ kodÄ… ir paspauskite Saugoti norÄ—dami prisijungti.

missingUsernameMessage=PraÅ¡ome Ä¯vesti naudotojo vardÄ….
missingFirstNameMessage=PraÅ¡ome Ä¯vesti vardÄ….
invalidEmailMessage=Neteisingas el. paÅ¡to adresas.
missingLastNameMessage=PraÅ¡ome Ä¯vesti pavardÄ™.
missingEmailMessage=PraÅ¡ome Ä¯vesti e
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_sk.properties:
totpStep1=NainÅ¡talujte si do mobilu jednu z nasledujÃºcich aplikÃ¡ciÃ­:
totpStep2=Otvorte aplikÃ¡ciu a naskenujte ÄiarovÃ½ kÃ³d alebo zadajte kÄ¾ÃºÄ.
totpStep3=Zadajte jednorazovÃ½ kÃ³d poskytnutÃ½ aplikÃ¡ciou a kliknutÃ­m na tlaÄidlo UloÅ¾iÅ¥ dokonÄÃ­te nastavenie.

totpManualStep2=Otvorte aplikÃ¡ciu a zadajte kÄ¾ÃºÄ
totpManualStep3=PouÅ¾ite nasledujÃºce hodnoty konfigurÃ¡cie, ak aplikÃ¡cia umoÅ¾Åˆuje ich nastavenie
totpUnableToScan=NemoÅ¾no skenovaÅ¥?
totpScanBarcode=Skenovanie ÄiarovÃ©ho kÃ³du?

totp.totp=ZaloÅ¾enÃ© na Äas
---
[Medium] chunk lines 81-100 in themes/src/main/resources-community/theme/base/account/messages/messages_sv.properties:
log=Logg

application=Applikation
availablePermissions=TillgÃ¤ngliga rÃ¤ttigheter
grantedPermissions=Beviljade rÃ¤ttigheter
grantedPersonalInfo=Medgiven personlig information
additionalGrants=Ytterligare medgivanden
action=Ã…tgÃ¤rd
inResource=i
fullAccess=FullstÃ¤ndig Ã¥tkomst
offlineToken=Offline token
revoke=UpphÃ¤v rÃ¤ttighet

configureAuthenticators=Konfigurerade autentiserare
mobile=Mobil
totpStep1=Installera en av fÃ¶ljande applikationer pÃ¥ din mobil:
totpStep2=Ã–ppna applikationen och skanna streckk
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_zh_CN.properties:
grantedPermissions=æŽˆäºˆæƒé™
grantedPersonalInfo=æŽˆæƒçš„ä¸ªäººä¿¡æ¯
additionalGrants=å¯æŽˆäºˆçš„æƒé™
action=æ“ä½œ
inResource=in
fullAccess=æ‰€æœ‰æƒé™
offlineToken=ç¦»çº¿ token
revoke=æ”¶å›žæŽˆæƒ

configureAuthenticators=é…ç½®çš„è®¤è¯è€…
mobile=æ‰‹æœº
totpStep1=åœ¨æ‚¨çš„æ‰‹æ©Ÿä¸Šå®‰è£ä»¥ä¸‹æ‡‰ç”¨ç¨‹å¼ä¹‹ä¸€ï¼š
totpStep2=æ‰“å¼€åº”ç”¨æ‰«æäºŒç»´ç è¾“å…¥éªŒè¯ç 
totpStep3=è¾“å…¥åº”ç”¨æä¾›çš„ä¸€æ¬¡æ€§éªŒè¯ç å•å‡»ä¿å­˜

missingUsernameMessage=è¯·æŒ‡å®šç”¨æˆ·å
missingFirstNameMessage=è¯·æŒ‡å®šå
invalidEmailMessage=æ— æ•ˆçš„ç”µå­é‚®ç®±åœ°å€
missingLastNameMessage=è¯·æŒ‡å®šå§“
missingEmailMessage=è¯·æŒ‡å®šé‚®ä»¶åœ°å€
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_da.properties:
emailVerificationSubject=Verificer email
emailVerificationBody=Nogen har oprettet en {2} konto med denne email adresse. Hvis dette var dig, bedes du trykke pÃ¥ forbindet herunder for at verificere din email adresse \n\n{0}\n\nDette link vil udlÃ¸be inden for {3}.\n\nHvis det var dig der har oprettet denne konto, bedes du se bort fra denne mail.
emailVerificationBodyHtml=<p>Nogen har oprettet en {2} konto med denne email adresse. Hvis dette var dig, bedes du trykke pÃ¥ forbindet herunder for at veri
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_fa.properties:
emailVerificationSubject=ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
emailVerificationBody=Ø´Ø®ØµÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ÛŒÚ© Ø­Ø³Ø§Ø¨ {2} Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø§ÛŒÙ† Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø±ÙˆÛŒ Ù¾ÛŒÙˆÙ†Ø¯ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯\n\n{0}\n\nØ§ÛŒÙ† Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ø± {3} Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.\n\nØ§Ú¯Ø± Ø´Ù…Ø§ Ø§ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŒ ÙÙ‚Ø· Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯ .
emailVerificationBodyHtml=<p>Ø´Ø®ØµÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ÛŒÚ© Ø­Ø³Ø§Ø¨ {2} Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø§ÛŒÙ† Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±ÙˆÛŒ Ù¾ÛŒÙˆÙ†Ø¯ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p><p><a href=""{0}"">Ù¾ÛŒÙˆÙ†Ø¯ Ø¨Ù‡ ØªØ£ÛŒÛŒØ¯ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„</a></p>
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_hu.properties:
emailVerificationSubject=E-mail cÃ­m megerÅ‘sÃ­tÃ©se
emailVerificationBody=Ezzel az e-mail cÃ­mmel valaki lÃ©trehozott egy {2} tartomÃ¡ny felhasznÃ¡lÃ³i fiÃ³kot. Amennyiben a fiÃ³kot Ã–n hozta lÃ©tre, kÃ©rem, kattintson a lenti hivatkozÃ¡sra, hogy megerÅ‘sÃ­tse fiÃ³kjÃ¡t Ã©s ezt az e-mail cÃ­met.\n\n{0}\n\nA hivatkozÃ¡s Ã©rvÃ©nyÃ©t veszti {3} mÃºlva.\n\nHa nem Ã¶n hozta lÃ©tre a felhasznÃ¡lÃ³i fiÃ³kot, akkor kÃ©rem, hagyja figyelmen kÃ­vÃ¼l ezt az Ã¼zenetet.
emailVerificationBodyHtml=<p>Ezzel az e-mail cÃ­mmel valaki lÃ©trehozott e
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_lt.properties:
emailVerificationSubject=El. paÅ¡to patvirtinimas
emailVerificationBody=Paskyra {2} sukurta naudojant Å¡Ä¯ el. paÅ¡to adresÄ…. Jei tai buvote JÅ«s, tuomet paspauskite Å¾emiau esanÄiÄ… nuorodÄ…\n\n{0}\n\nÅ i nuoroda galioja {1} min.\n\nJei paskyros nekÅ«rÄ—te, tuomet ignuoruokite Å¡Ä¯ laiÅ¡kÄ…. 
emailVerificationBodyHtml=<p>Paskyra {2} sukurta naudojant Å¡Ä¯ el. paÅ¡to adresÄ…. Jei tao buvote JÅ«s, tuomet paspauskite Å¾emiau esanÄiÄ… nuorodÄ…</p><p><a href=""{0}"">{0}</a></p><p>Å i nuoroda galioja {1} min.</p><p>nJei pasky
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_nl.properties:
emailVerificationSubject=Bevestig e-mailadres
emailVerificationBody=Iemand heeft een {2} account aangemaakt met dit e-mailadres. Als u dit was, klikt u op de onderstaande koppeling om uw e-mailadres te bevestigen \n\n{0}\n\nDeze koppeling zal binnen {3} vervallen.\n\nU kunt dit bericht negeren indien u dit account niet heeft aangemaakt.
emailVerificationBodyHtml=<p>Iemand heeft een {2} account aangemaakt met dit e-mailadres. Als u dit was, klikt u op de onderstaande koppeling om uw e-mailadres t
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_no.properties:
emailVerificationSubject=Bekreft e-postadresse
emailVerificationBody=Noen har opprettet en {2} konto med denne e-postadressen. Hvis dette var deg, klikk pÃ¥ lenken nedenfor for Ã¥ bekrefte e-postadressen din\n\n{0}\n\nDenne lenken vil utlÃ¸pe om {1} minutter.\n\nHvis du ikke opprettet denne kontoen, vennligst ignorer denne meldingen.
emailVerificationBodyHtml=<p>Noen har opprettet en {2} konto med denne e-postadressen. Hvis dette var deg, klikk pÃ¥ lenken nedenfor for Ã¥ bekrefte e-postadressen din</
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_tr.properties:
emailVerificationSubject=E-postayÄ± doÄŸrula
emailVerificationBody=Birisi bu e-posta adresiyle bir {2} hesap oluÅŸturdu. Bu sizseniz, e-posta adresinizi doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±ya tÄ±klayÄ±n\n\n{0}\n\nBu baÄŸlantÄ± {3} iÃ§inde sona erecek.\n\nBu hesabÄ± oluÅŸturmadÄ±ysanÄ±z, sadece bu iletiyi yoksayÄ±nÄ±z.
emailVerificationBodyHtml=<p>Birisi bu e-posta adresiyle bir {2} hesap oluÅŸturdu. Bu sizseniz, e-posta adresinizi doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±yÄ± tÄ±klayÄ±n.</p><p><a href=""{0}"">E-posta adresi 
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_uk.properties:
emailVerificationSubject=ÐŸÑ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ Ð°Ð´Ñ€ÐµÑÑƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸
emailVerificationBody=Ð¥Ñ‚Ð¾ÑÑŒ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ {2} Ñ–Ð· Ñ†Ñ–Ñ”ÑŽ Ð°Ð´Ñ€ÐµÑÐ¾ÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸. Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð±ÑƒÐ»Ð¸ Ð’Ð¸, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð½Ð¸Ð¶Ñ‡Ðµ, Ñ‰Ð¾Ð± Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ ÑÐ²Ð¾ÑŽ Ð°Ð´Ñ€ÐµÑÑƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸\n\n{0}\n\nÐ¦Ðµ Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð´Ñ–Ð¹ÑÐ½Ðµ Ð¿Ñ€Ð¾Ñ‚ÑÐ³Ð¾Ð¼ {3}.\n\nÐ¯ÐºÑ‰Ð¾ Ð’Ð¸ Ð½Ðµ ÑÑ‚Ð²Ð¾Ñ€ÑŽÐ²Ð°Ð»Ð¸ Ñ†ÐµÐ¹ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ñ–Ð³Ð½Ð¾Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ†ÐµÐ¹ Ð»Ð¸ÑÑ‚.
emailVerificationBodyHtml=<p>Ð¥Ñ‚Ð¾ÑÑŒ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ {2} Ñ–Ð· Ñ†Ñ–Ñ”ÑŽ Ð°Ð´Ñ€ÐµÑÐ¾ÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸. Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð±ÑƒÐ»Ð¸ Ð’Ð¸, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_ar.properties:
webauthn-doAuthenticate=ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†
webauthn-createdAt-label=ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ

# WebAuthn Error
webauthn-error-title=Ø®Ø·Ø£ ÙÙŠ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†
webauthn-error-registration=ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.<br /> {0}
webauthn-error-api-get=ÙØ´Ù„Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†.<br /> {0}
webauthn-error-different-user=Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… ØªÙ…Øª Ù…ØµØ§Ø¯Ù‚ØªÙ‡ Ù„ÙŠØ³ Ù‡Ùˆ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ØªÙ…Øª Ù…ØµØ§Ø¯Ù‚ØªÙ‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†.
webauthn-error-auth-verification=Ù†ØªÙŠØ¬Ø© Ù…ØµØ§Ø¯Ù‚Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† ØºÙŠØ± ØµØ§Ù„Ø­Ø©.<br /> {0}
webauthn-error-reg
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_ca.properties:
# WebAuthn Error
webauthn-error-title=Error de la clau de seguretat
webauthn-error-registration=No s''ha pogut registrar la vostra clau de seguretat.<br /> {0}
webauthn-error-api-get=No s''ha pogut identificar amb la clau de seguretat.<br /> {0}
webauthn-error-different-user=L''usuari identificat primer no Ã©s l''autenticat per la clau de seguretat.
webauthn-error-auth-verification=El resultat de l''autenticaciÃ³ amb clau de seguretat no Ã©s vÃ lid.<br />{0}
webauthn-error-register-verification=El r
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_cs.properties:
webauthn-doAuthenticate=PÅ™ihlÃ¡Å¡enÃ­ pÅ™Ã­stupovÃ½m klÃ­Äem
webauthn-createdAt-label=VytvoÅ™eno

# WebAuthn Error
webauthn-error-title=Chyba pÅ™Ã­stupovÃ©ho klÃ­Äe
webauthn-error-registration=Selhala registrace vaÅ¡eho pÅ™Ã­stupovÃ©ho klÃ­Äe.<br /> {0}
webauthn-error-api-get=Selhalo pÅ™ihlÃ¡Å¡enÃ­ pomocÃ­ pÅ™Ã­stupovÃ©ho klÃ­Äe.<br /> {0}
webauthn-error-different-user=PrvnÃ­ pÅ™ihlÃ¡Å¡enÃ½ uÅ¾ivatel nenÃ­ totoÅ¾nÃ½ s uÅ¾ivatelem pÅ™ihlÃ¡Å¡enÃ½m pomocÃ­ pÅ™Ã­stupovÃ©ho klÃ­Äe.
webauthn-error-auth-verification=NevalidnÃ­ vÃ½sledek pÅ™ihlÃ¡Å¡enÃ­ 
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_de.properties:
recovery-codes-download-file-header=Bewahren Sie diese Wiederherstellungscodes an einem sicheren Ort auf.
recovery-codes-download-file-description=Wiederherstellungscodes sind einmalig verwendbare PasswÃ¶rter, mit denen Sie sich bei Ihrem Konto anmelden kÃ¶nnen, wenn Sie keinen Zugriff auf Ihren Authentifikator haben.
recovery-codes-download-file-date=Diese Codes wurden generiert am
recovery-codes-label-default=Wiederherstellungscodes

# WebAuthn
webauthn-display-name=Passkey
webauthn-help-text=Ve
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_de.properties:
webauthn-error-api-get=Fehler beim Authentifizieren mit dem Passkey.<br /> {0}
webauthn-error-different-user=Der erste authentifizierte Benutzer ist nicht derjenige, der durch den Passkey authentifiziert wurde.
webauthn-error-auth-verification=Das Ergebnis der Passkey-Authentifizierung ist ungÃ¼ltig.<br /> {0}
webauthn-error-register-verification=Das Ergebnis der Passkey-Registrierung ist ungÃ¼ltig.<br /> {0}
webauthn-error-user-not-found=Unbekannter Benutzer, der mit dem Passkey authentifiziert w
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_el.properties:
recovery-codes-download-file-date=Î‘Ï…Ï„Î¿Î¯ Î¿Î¹ ÎºÏ‰Î´Î¹ÎºÎ¿Î¯ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½ ÏƒÏ„Î¹Ï‚
recovery-codes-label-default=ÎšÏ‰Î´Î¹ÎºÎ¿Î¯ Î±Î½Î¬ÎºÏ„Î·ÏƒÎ·Ï‚

# WebAuthn
webauthn-display-name=ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-help-text=Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÏƒÎ±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·.
webauthn-passwordless-display-name=ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-passwordless-help-text=Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚.
webauthn-login-title=Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Î¼Îµ ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-registration-title=Î•Î³Î³ÏÎ±Ï†Î® ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-avai
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_el.properties:
webauthn-error-auth-verification=ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.<br /> {0}
webauthn-error-register-verification=ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.<br /> {0}
webauthn-error-user-not-found=Î†Î³Î½Ï‰ÏƒÏ„Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ Î¼Îµ Ï„Î¿ ÎšÎ»ÎµÎ¹Î´Î¯ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.

# Identity provider
identity-provider-redirector=Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Î­Î½Î±Î½ Î¬Î»Î»Î¿ Î Î¬ÏÎ¿Ï‡Î¿ Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚
identity-provider-login-label=Î‰ ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ
idp-email-verification-display-name=Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Email
idp-email-verification-help
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_es.properties:
webauthn-error-title=Error de Passkey
webauthn-error-registration=No se pudo registrar su Passkey. <br /> {0}
webauthn-error-api-get=No se pudo autenticar con el Passkey. <br /> {0}
webauthn-error-different-user=El primer usuario autenticado no es el autenticado por el Passkey.
webauthn-error-auth-verification=El resultado de la autenticaciÃ³n con el Passkey no es vÃ¡lido. <br /> {0}
webauthn-error-register-verification=El resultado de registro del Passkey no es vÃ¡lido. <br /> {0}
webauthn-error-u
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_fa.properties:
recovery-codes-label-default=Ú©Ø¯Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ

# WebAuthn
webauthn-display-name=Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-help-text=.Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø®ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
webauthn-passwordless-display-name=Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-passwordless-help-text=.Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø®ÙˆØ¯ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
webauthn-login-title=ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-registration-title=Ø«Ø¨Øª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-available-authenticators=Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ù…ÙˆØ¬ÙˆØ¯
webauthn-unsupported-browser-text=WebAuthn ØªÙˆØ³Ø· Ø§ÛŒÙ† Ù…Ø±ÙˆØ±Ú¯Ø±
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_fa.properties:
webauthn-error-register-verification=Ù†ØªÛŒØ¬Ù‡ Ø«Ø¨Øª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.<br /> {0}
webauthn-error-user-not-found=.Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ø´Ù†Ø§Ø³ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø´Ø¯Ù‡ Ø§Ø³Øª

# Identity provider
identity-provider-redirector=Ø¨Ø§ ÛŒÚ© Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù‡ÙˆÛŒØª Ø¯ÛŒÚ¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†ÛŒØ¯
identity-provider-login-label=ÛŒØ§ ÙˆØ±ÙˆØ¯ Ø¨Ø§
idp-email-verification-display-name=ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
idp-email-verification-help-text=.Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ù‡ÛŒØ¯
idp-username-password-form-display-name=Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
idp-usernam
---
[Medium] chunk lines 381-400 in themes/src/main/resources-community/theme/base/login/messages/messages_fi.properties:
password-help-text=Kirjaudu sisÃ¤Ã¤n syÃ¶ttÃ¤mÃ¤llÃ¤ salasanasi.
auth-username-form-display-name=KÃ¤yttÃ¤jÃ¤nimi
auth-username-form-help-text=Aloita kirjautuminen syÃ¶ttÃ¤mÃ¤llÃ¤ kÃ¤yttÃ¤jÃ¤nimesi
auth-username-password-form-display-name=kÃ¤yttÃ¤jÃ¤nimi ja salasana
auth-username-password-form-help-text=Kirjaudu sisÃ¤Ã¤n syÃ¶ttÃ¤mÃ¤llÃ¤ kÃ¤yttÃ¤jÃ¤nimi ja salasana.

# WebAuthn
webauthn-display-name=Turva-avain
webauthn-help-text=KÃ¤ytÃ¤ Turva-avaintasi kirjatuaksesi sisÃ¤Ã¤n.
webauthn-passwordless-display-name=Turva-avain
webau
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_fi.properties:
webauthn-error-api-get=Tunnistautuminen Turva-avaimella epÃ¤onnistui.<br /> {0}
webauthn-error-different-user=Ensiksi tunnistautunut kÃ¤yttÃ¤jÃ¤ ei ole sama kuin Turva-avaimella tunnistaunut.
webauthn-error-auth-verification=Turva-avain -tunnistautumisen tulos on virheellinen.<br /> {0}
webauthn-error-register-verification=Turva-avaimen rekisterÃ¶innin tulos on virheellinen.<br /> {0}
webauthn-error-user-not-found=Tuntematon kÃ¤yttÃ¤jÃ¤ tunnistautui Turva-avaimella.

# Identity provider
identity-provide
---
[Medium] chunk lines 381-400 in themes/src/main/resources-community/theme/base/login/messages/messages_fr.properties:
webauthn-error-register-verification=Le rÃ©sultat de l''enregistrement de la clÃ© de sÃ©curitÃ© est invalide.<br /> {0}
webauthn-error-user-not-found=La ClÃ© de SÃ©curitÃ© a authentifiÃ© un utilisateur inconnu.
finalDeletionConfirmation=Si vous supprimez votre compte, il ne pourra pas Ãªtre restaurÃ©. Pour conserver votre compte, cliquez sur Annuler.
irreversibleAction=Cette action est irrÃ©versible
deleteAccountConfirm=Confirmation de suppression de compte
deletingImplies=Supprimer votre compte implique:

---
[Medium] chunk lines 361-380 in themes/src/main/resources-community/theme/base/login/messages/messages_fr.properties:
auth-username-password-form-help-text=Connectez-vous en saisissant votre nom d''utilisateur et votre mot de passe.

# WebAuthn
webauthn-display-name=ClÃ© de SÃ©curitÃ©
webauthn-help-text=Utilisez votre clÃ© de sÃ©curitÃ© pour vous connecter.
webauthn-passwordless-display-name=ClÃ© de SÃ©curitÃ©
webauthn-passwordless-help-text=Utilisez votre clÃ© de sÃ©curitÃ© pour vous connecter sans mot de passe.
webauthn-login-title=Connexion avec une ClÃ© de SÃ©curitÃ©
webauthn-registration-title=Enregistrement d''une ClÃ© d
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_hr.properties:

# WebAuthn
webauthn-display-name=Sigurnosni kljuÄ
webauthn-help-text=Koristite svoj sigurnosni kljuÄ za prijavu.
webauthn-passwordless-display-name=Sigurnosni kljuÄ
webauthn-passwordless-help-text=Koristite svoj sigurnosni kljuÄ za prijavu bez lozinke.
webauthn-login-title=Prijava sigurnosnim kljuÄem
webauthn-registration-title=Registracija sigurnosnog kljuÄa
webauthn-available-authenticators=Dostupni sigurnosni kljuÄevi
webauthn-unsupported-browser-text=WebAuthn nije podrÅ¾an u ovom pregledniku
---
[Medium] chunk lines 481-500 in themes/src/main/resources-community/theme/base/login/messages/messages_hr.properties:
webauthn-error-different-user=Prvi autentificirani korisnik nije isti kao korisnik autentificiran putem sigurnosnog kljuÄa.
webauthn-error-auth-verification=Rezultat autentifikacije putem sigurnosnog kljuÄa nije valjan.<br /> {0}
webauthn-error-register-verification=Rezultat registracije sigurnosnog kljuÄa nije valjan.<br /> {0}
webauthn-error-user-not-found=Nepoznati korisnik autentificiran putem sigurnosnog kljuÄa.

# Passkey
passkey-login-title=Prijava pristupnim kljuÄem
passkey-available-aut
---
[Medium] chunk lines 161-180 in themes/src/main/resources-community/theme/base/login/messages/messages_ka.properties:
webauthn-passwordless-display-name=Passkey
webauthn-passwordless-help-text=áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ Passkey áƒ£áƒžáƒáƒ áƒáƒšáƒáƒ“ áƒ¨áƒ”áƒ¡áƒáƒ¡áƒ•áƒšáƒ”áƒšáƒáƒ“.
webauthn-unsupported-browser-text=áƒáƒ› áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¡ WebAuthn-áƒ˜áƒ¡ áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ áƒáƒ  áƒ’áƒáƒáƒ©áƒœáƒ˜áƒ. áƒ¡áƒªáƒáƒ“áƒ”áƒ— áƒ¡áƒ®áƒ•áƒ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ˜ áƒáƒœ áƒ“áƒáƒ£áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ“áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ  áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ¡.
webauthn-doAuthenticate=Passkey-áƒ˜áƒ— áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ
webauthn-registration-init-label=Passkey (áƒœáƒáƒ’áƒ£áƒšáƒ˜áƒ¡áƒ®áƒ›áƒ”áƒ•áƒ˜ áƒ­áƒ“áƒ”)


# WebAuthn Error
webauthn-error-title=Passkey-áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ
webauthn-createdAt-label=áƒ¨áƒ”áƒ˜áƒ¥áƒ›áƒœáƒ
webauthn-registration-init-label-
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_ka.properties:
auth-username-password-form-display-name=áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ“áƒ áƒžáƒáƒ áƒáƒšáƒ˜
auth-username-password-form-help-text=áƒ¨áƒ”áƒ“áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡áƒ áƒ“áƒ áƒžáƒáƒ áƒáƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ˜áƒ—.
recovery-code-config-warning-message=áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ“áƒ˜áƒ—, áƒ áƒáƒ› áƒ“áƒáƒ‘áƒ”áƒ­áƒ“áƒáƒ—, áƒ’áƒáƒ“áƒ›áƒáƒ¬áƒ”áƒ áƒáƒ— áƒáƒœ áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒáƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒžáƒáƒ áƒáƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ›áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ¨áƒ˜ áƒ“áƒ áƒ˜áƒ¥áƒáƒœáƒ˜áƒ”áƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ“. áƒáƒ› áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ˜áƒ“áƒáƒœ áƒáƒ› áƒ™áƒáƒ“áƒ”áƒ‘áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡.
recovery-codes-action-complete=áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ
recovery-codes-action-cancel=áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ
recovery-codes-download-file-header=áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒ”áƒ— áƒ”áƒ¡ áƒ™áƒ
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_ko.properties:
recovery-codes-download-file-date=ì´ ì½”ë“œëŠ” ë‹¤ìŒ ë‚ ì§œì— ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:
recovery-codes-label-default=ë³µêµ¬ ì½”ë“œ

# WebAuthn
webauthn-display-name=íŒ¨ìŠ¤í‚¤
webauthn-help-text=íŒ¨ìŠ¤í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•˜ì„¸ìš”.
webauthn-passwordless-display-name=íŒ¨ìŠ¤í‚¤
webauthn-passwordless-help-text=íŒ¨ìŠ¤í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ë¡œê·¸ì¸í•˜ì„¸ìš”.
webauthn-login-title=íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸
webauthn-registration-title=íŒ¨ìŠ¤í‚¤ ë“±ë¡
webauthn-available-authenticators=ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ìŠ¤í‚¤
webauthn-unsupported-browser-text=ì´ ë¸Œë¼ìš°ì €ëŠ” WebAuthnì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
webauthn-doAuthenticate=íŒ¨ìŠ¤í‚¤ë¡œ ë¡œê·¸ì¸
weba
---
[Medium] chunk lines 481-500 in themes/src/main/resources-community/theme/base/login/messages/messages_ko.properties:
webauthn-error-api-get=íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-different-user=ì²« ë²ˆì§¸ ì¸ì¦ëœ ì‚¬ìš©ìžê°€ íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦ëœ ì‚¬ìš©ìžê°€ ì•„ë‹™ë‹ˆë‹¤.
webauthn-error-auth-verification=íŒ¨ìŠ¤í‚¤ ì¸ì¦ ê²°ê³¼ê°€ ìž˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-register-verification=íŒ¨ìŠ¤í‚¤ ë“±ë¡ ê²°ê³¼ê°€ ìž˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-user-not-found=íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦ëœ ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ìž.

# Passkey
passkey-login-title=íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸
passkey-available-authenticators=ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ìŠ¤í‚¤
passkey-unsupported-browser-text=ì´ ë¸Œë¼ìš°ì €ëŠ” íŒ¨ìŠ¤í‚¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
passkey-doAuthenticate=íŒ¨ìŠ¤í‚¤ë¡œ ë¡œê·¸ì¸
pa
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_lt.properties:
authenticatorCode=Vienkartinis kodas
address=Adresas
street=GatvÄ—
locality=Miestas arba vietovÄ—
region=Rajonas
postal_code=PaÅ¡to kodas
country=Å alis
emailVerified=El. paÅ¡to adresas patvirtintas
gssDelegationCredential=GSS prisijungimo duomenÅ³ delegavimas

loginTotpStep1=Installa una delle seguenti applicazioni sul tuo cellulare:
loginTotpStep2=Atidarykite programÄ—lÄ™ ir nuskenuokite barkodÄ… arba Ä¯veskite kodÄ….
loginTotpStep3=Ä®veskite programÄ—lÄ—je sugeneruotÄ… vienÄ… kartÄ… galiojantÄ¯ kodÄ… ir paspaus
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_no.properties:
authenticatorCode=Engangskode
address=Adresse
street=Gate-/veinavn + husnummer
locality=By
region=Fylke
postal_code=Postnummer
country=Land
emailVerified=E-postadresse bekreftet
gssDelegationCredential=GSS legitimasjons-delegering

loginTotpStep1=Installer en av fÃ¸lgende applikasjoner pÃ¥ mobilen din:
loginTotpStep2=Ã…pne applikasjonen og skann strekkoden eller skriv inn koden
loginTotpStep3=Skriv inn engangskoden fra applikasjonen og klikk send inn for Ã¥ fullfÃ¸re
loginOtpOneTime=Engangskode

oaut
---
[Medium] chunk lines 501-501 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
error-invalid-multivalued-size=AtribÃºt {0} musÃ­ maÅ¥ najmenej {1} {1,choice,0#hodnÃ´t|1#hodnotu|1<hodnoty|4<hodnÃ´t} a najviac {2} {2,choice,0#hodnÃ´t|1#hodnotu|1<hodnoty|4<hodnÃ´t}.
---
[Medium] chunk lines 121-140 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:

loginTotpIntro=Pre prÃ­stup k tomuto ÃºÄtu je potrebnÃ© nastaviÅ¥ generÃ¡tor jednorazovÃ½ch kÃ³dov
loginTotpStep1=NainÅ¡talujte si do mobilu jednu z nasledujÃºcich aplikÃ¡ciÃ­:
loginTotpStep2=Otvorte aplikÃ¡ciu a skenujte ÄiarovÃ½ kÃ³d alebo zadajte kÄ¾ÃºÄ
loginTotpStep3=Zadajte jednorazovÃ½ kÃ³d poskytnutÃ½ aplikÃ¡ciou a kliknutÃ­m na tlaÄidlo OdoslaÅ¥ dokonÄite nastavenie
loginTotpStep3DeviceName=UveÄte nÃ¡zov zariadenia, ktorÃ½ vÃ¡m pomÃ´Å¾e spravovaÅ¥ zariadenia OTP. 
loginTotpManualStep2=Otvorte aplikÃ¡ciu a zadajte k
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
webauthn-doAuthenticate=PrihlÃ¡senie pomocou prihlasovacieho kÄ¾ÃºÄa
webauthn-createdAt-label=VytvorenÃ©

# WebAuthn Error
webauthn-error-title=ChybnÃ½ prihlasovacÃ­ kÄ¾ÃºÄ
webauthn-error-registration=Nepodarilo sa zaregistrovaÅ¥ prihlasovacÃ­ kÄ¾ÃºÄ.<br /> {0}
webauthn-error-api-get=Nepodarilo sa overiÅ¥ pomocou prihlasovacieho kÄ¾ÃºÄa.<br /> {0}
webauthn-error-different-user=PrvÃ½ overenÃ½ pouÅ¾Ã­vateÄ¾ nie je ten, ktorÃ½ bol overenÃ½ prihlasovacÃ­m kÄ¾ÃºÄom.
webauthn-error-auth-verification=VÃ½sledok overenia prihlaso
---
[Medium] chunk lines 21-40 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
kerberosNotConfigured=Kerberos nie je nakonfigurovanÃ½
kerberosNotConfiguredTitle=Kerberos nie je nakonfigurovanÃ½
bypassKerberosDetail=BuÄ nie ste prihlÃ¡senÃ½ cez Kerberos, alebo vÃ¡Å¡ prehliadaÄ nie je nastavenÃ½ na prihlÃ¡senie do Kerberos. KliknutÃ­m na tlaÄidlo PokraÄovaÅ¥ sa prihlÃ¡ste inÃ½m spÃ´sobom
kerberosNotSetUp=Kerberos nie je nastavenÃ½. NemÃ´Å¾ete sa prihlÃ¡siÅ¥.
registerTitle=RegistrÃ¡cia
loginAccountTitle=PrihlÃ¡ste sa do svojho ÃºÄtu
loginTitle=PrihlÃ¡senie do {0}
loginTitleHtml={0}
impersonateTitl
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_sv.properties:
locality=Postort
region=Stat, Provins eller Region
postal_code=Postnummer
country=Land
emailVerified=E-post verifierad
gssDelegationCredential=GSS Delegation Credential

loginTotpStep1=Installera en av fÃ¶ljande applikationer pÃ¥ din mobil:
loginTotpStep2=Ã–ppna applikationen och skanna streckkoden eller skriv i nyckeln
loginTotpStep3=Fyll i engÃ¥ngskoden som tillhandahÃ¥lls av applikationen och klicka pÃ¥ Spara fÃ¶r att avsluta instÃ¤llningarna
loginOtpOneTime=EngÃ¥ngskod

oauthGrantRequest=GodkÃ¤nner du
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_th.properties:
webauthn-error-title=à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¸‚à¸­à¸‡à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
webauthn-error-registration=à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ<br /> {0}
webauthn-error-api-get=à¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ<br /> {0}
webauthn-error-different-user=à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸£à¸²à¸¢à¹à¸£à¸à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸£à¸²à¸¢à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸ˆà¸²à¸à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
webauthn-error-auth-verification=à¸œà¸¥à¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡<br /> {0}
webauthn-error-register-verification=à¸œà¸¥à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸‚à¸­à¸‡à¸„à¸µ
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_tr.properties:
webauthn-passwordless-help-text= Åžifresiz giriÅŸ iÃ§in GeÃ§iÅŸ AnahtarÄ±nÄ±zÄ± kullanÄ±n.,
webauthn-login-title= GeÃ§iÅŸ AnahtarÄ±yla GiriÅŸ,
webauthn-registration-title= GeÃ§iÅŸ AnahtarÄ±yla KayÄ±t,
webauthn-available-authenticators= GeÃ§erli GeÃ§iÅŸ AnahtarlarÄ± ,
webauthn-unsupported-browser-text= WebAuthn tarayÄ±cÄ±nÄ±z tarafÄ±ndan desteklenmemektedir. BaÅŸka bir tarayÄ±cÄ±dan ulaÅŸmayÄ± deneyin veya yÃ¶neticinizle iletiÅŸime geÃ§in.,
webauthn-doAuthenticate= GeÃ§iÅŸ AnahtarÄ± ile giriÅŸ yap,
webauthn-createdAt-label= OluÅŸturu
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_uk.properties:
recovery-codes-download-file-description=ÐšÐ¾Ð´Ð¸ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ â€” Ñ†Ðµ Ð¾Ð´Ð½Ð¾Ñ€Ð°Ð·Ð¾Ð²Ñ– Ð¿Ð°Ñ€Ð¾Ð»Ñ–, ÑÐºÑ– Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‚ÑŒ Ð’Ð°Ð¼ ÑƒÐ²Ñ–Ð¹Ñ‚Ð¸ Ð´Ð¾ ÑÐ²Ð¾Ð³Ð¾ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ð¸ÑÑƒ, ÑÐºÑ‰Ð¾ Ñƒ Ð’Ð°Ñ Ð½ÐµÐ¼Ð°Ñ” Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ Ð´Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ‚Ð¾Ñ€Ð°.
recovery-codes-download-file-date=Ð¦Ñ– ÐºÐ¾Ð´Ð¸ Ð±ÑƒÐ»Ð¸ Ð·Ð³ÐµÐ½ÐµÑ€Ð¾Ð²Ð°Ð½Ñ–
recovery-codes-label-default=ÐšÐ¾Ð´Ð¸ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ

# WebAuthn
webauthn-display-name=ÐšÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
webauthn-help-text=Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ñ–Ð¹ ÐºÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð´Ð»Ñ Ð²Ñ…Ð¾Ð´Ñƒ.
webauthn-passwordless-display-name=ÐšÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
webauthn-passwordless-help-text=Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ñ–Ð¹ ÐºÐ»ÑŽÑ‡
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_uk.properties:
webauthn-error-different-user=ÐŸÐµÑ€ÑˆÐ¸Ð¹ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð½Ðµ Ñ” Ñ‚Ð¸Ð¼, Ñ…Ñ‚Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ÐµÐ¼ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸.
webauthn-error-auth-verification=Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ— ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð½ÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹.<br /> {0}
webauthn-error-register-verification=Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ñ€ÐµÑ”ÑÑ‚Ñ€Ð°Ñ†Ñ–Ñ— ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð½ÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹.<br /> {0}
webauthn-error-user-not-found=ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸.

# Identity provider
identity-provider-redirector=ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ñ–Ñ‚ÑŒÑÑ Ð´Ð¾ Ñ–Ð½ÑˆÐ¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð° Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ñ… Ð·Ð°Ð¿Ð¸ÑÑ–Ð²
identi
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_zh_CN.properties:
webauthn-doAuthenticate=ä½¿ç”¨å®‰å…¨å¯†é’¥ç™»å½•
webauthn-createdAt-label=åˆ›å»ºäºŽ

# WebAuthn Error
webauthn-error-title=å®‰å…¨å¯†é’¥é”™è¯¯
webauthn-error-registration=æ³¨å†Œæ‚¨çš„å®‰å…¨å¯†é’¥å¤±è´¥ã€‚<br /> {0}
webauthn-error-api-get=é€šè¿‡å®‰å…¨å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯å¤±è´¥ã€‚<br /> {0}
webauthn-error-different-user=é¦–æ¬¡ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¸æ˜¯é€šè¿‡å®‰å…¨å¯†é’¥ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚
webauthn-error-auth-verification=å®‰å…¨å¯†é’¥èº«ä»½éªŒè¯ç»“æžœæ— æ•ˆã€‚<br /> {0}
webauthn-error-register-verification=å®‰å…¨å¯†é’¥æ³¨å†Œç»“æžœæ— æ•ˆã€‚<br /> {0}
webauthn-error-user-not-found=é€šè¿‡å®‰å…¨å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·æœªçŸ¥ã€‚

# Identity provider
identity-provider-redirector=è¿žæŽ¥åˆ°å¦ä¸€ä¸ªèº«ä»½æä¾›è€…
identi
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_zh_TW.properties:
webauthn-login-title=å®‰å…¨é‡‘é‘°ç™»å…¥
webauthn-registration-title=è¨»å†Šå®‰å…¨é‡‘é‘°
webauthn-available-authenticators=å¯ç”¨çš„å®‰å…¨é‡‘é‘°
webauthn-unsupported-browser-text=æ­¤ç€è¦½å™¨ä¸æ”¯æ´ WebAuthnã€‚è«‹å˜—è©¦å…¶ä»–ç€è¦½å™¨æˆ–è¯çµ¡æ‚¨çš„ç³»çµ±ç®¡ç†å“¡ã€‚
webauthn-doAuthenticate=é€éŽå®‰å…¨é‡‘é‘°é€²è¡Œç™»å…¥
webauthn-createdAt-label=å·²å»ºç«‹
webauthn-registration-init-label=å®‰å…¨é‡‘é‘° (é è¨­æ¨™ç±¤)
webauthn-registration-init-label-prompt=è«‹ç‚ºè¨»å†Šçš„å®‰å…¨é‡‘é‘°è¼¸å…¥æ¨™ç±¤


# WebAuthn Error
webauthn-error-title=å®‰å…¨é‡‘é‘°éŒ¯èª¤
webauthn-error-registration=ç„¡æ³•è¨»å†Šæ‚¨çš„å®‰å…¨é‡‘é‘°ã€‚<br /> {0}
webauthn-error-api-get=ç„¡æ³•é€éŽå®‰å…¨é‡‘é‘°é€²è¡Œé©—è­‰ã€‚<br /> {0}
webauthn-error-di
---
[Medium] chunk lines 61-69 in themes/src/main/resources/theme/base/admin/messages/messages_en.properties:
error-invalid-uri=Invalid URL.
error-invalid-uri-scheme=Invalid URL scheme.
error-invalid-uri-fragment=Invalid URL fragment.
error-user-attribute-required=Please specify attribute {0}.
error-invalid-date=Attribute {0} is invalid date.
error-user-attribute-read-only=Attribute {0} is read only.
error-username-invalid-character={0} contains invalid character.
error-person-name-invalid-character={0} contains invalid character.
error-invalid-multivalued-size=Attribute {0} must have at least {1} and a
---
[Medium] chunk lines 481-500 in themes/src/main/resources/theme/base/login/messages/messages_en.properties:
webauthn-registration-init-label=Passkey (Default Label)
webauthn-registration-init-label-prompt=Please input your registered passkey''s label


# WebAuthn Error
webauthn-error-title=Passkey Error
webauthn-error-registration=Failed to register your Passkey.<br /> {0}
webauthn-error-api-get=Failed to authenticate by the Passkey.<br /> {0}
webauthn-error-different-user=First authenticated user is not the one authenticated by the Passkey.
webauthn-error-auth-verification=Passkey authentication resu
---
[Medium] chunk lines 521-537 in themes/src/main/resources/theme/base/login/messages/messages_en.properties:
access-denied-when-idp-auth=Access denied when authenticating with {0}

frontchannel-logout.title=Logging out
frontchannel-logout.message=You are logging out from following apps
logoutConfirmTitle=Logging out
logoutConfirmHeader=Do you want to log out?
doLogout=Logout

readOnlyUsernameMessage=You can''t update your username as it is read-only.
error-invalid-multivalued-size=Attribute {0} must have at least {1} and at most {2} {2,choice,0#values|1#value|1<values}.

organization.confirm-membership","VerifyMessageProperties (High), Pattern (Medium), Pattern (Medium), PolicyFactory (Medium), PolicyFactory (Medium), normalizeValue (Medium), containsHtml (Medium), santizeAnchors (Medium), getEnglishValue (Medium), verifySafeHtml (Medium), verify (Medium), verifyDuplicateKeysDetected (Medium), verifyIllegalHtmlTagDetected (Medium), verifyNoHtmlAllowed (Medium), verifyNoChangedAnchors (Medium), lines 101-101 (Medium), lines 1-18 (Medium), lines 181-200 (Medium), lines 1241-1260 (Medium), lines 3121-3140 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), VerifyMessagePropertiesTest (Medium), lines 141-160 (Medium), lines 101-120 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 461-480 (Medium), lines 421-440 (Medium), lines 461-480 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 441-460 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 381-400 (Medium), lines 401-420 (Medium), lines 381-400 (Medium), lines 361-380 (Medium), lines 461-480 (Medium), lines 481-500 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 481-500 (Medium), lines 61-80 (Medium), lines 61-80 (Medium), lines 501-501 (Medium), lines 121-140 (Medium), lines 461-480 (Medium), lines 21-40 (Medium), lines 61-80 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 61-69 (Medium), lines 481-500 (Medium), lines 521-537 (Medium), lines 101-112 (Low), lines 1-17 (Low), lines 1-17 (Low), lines 1-18 (Low), lines 1-17 (Low), lines 1-17 (Low), lines 1-17 (Low)",match,'proper' matches HC entity 'verifymessageproperties'
keycloak,7,Add HTML sanitizer for translated message resources,The method name 'santizeAnchors' should be 'sanitizeAnchors' (missing 'i').,Low,79,1,71,"class::VerifyMessageProperties (misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java) [High, score=0.63]","[High] class VerifyMessageProperties in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
public class VerifyMessageProperties {

    private final File file;
    private List<String> messages;

    public VerifyMessageProperties(File file) {
        this.file = file;
    }

    public List<String> verify() throws MojoExecutionException {
        messages = new ArrayList<>();
        try {
            String contents = Files.readString(file.toPath());
            verifyNoDuplicateKeys(contents);
            verifySafeHtml();
        } catch (IOException e) {
            throw new MojoExecutionException(""Can not read file "" + file, e);
        }
        return messages;
    }

    PolicyFactory POLICY_SOME_HTML = new org.owasp.html.HtmlPolicyBuilder()
            .allowElements(
                    ""br"", ""p"", ""strong"", ""b""
            ).toFactory();

    PolicyFactory POLICY_NO_","[Medium] field Pattern in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
Pattern HTML_TAGS = Pattern.compile(""<[a-z]+[^>]*>"");
---
[Medium] field Pattern in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private static final Pattern ANCHOR_PATTERN = Pattern.compile(""</?a[^>]*>"");
---
[Medium] field PolicyFactory in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
PolicyFactory POLICY_SOME_HTML = new org.owasp.html.HtmlPolicyBuilder()
            .allowElements(
                    ""br"", ""p"", ""strong"", ""b""
            ).toFactory();
---
[Medium] field PolicyFactory in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
PolicyFactory POLICY_NO_HTML = new org.owasp.html.HtmlPolicyBuilder().toFactory();
---
[Medium] method normalizeValue in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private String normalizeValue(String key, String value) {
        if (key.equals(""templateHelp"")) {
            // Allow ""CLAIM.<NAME>"" here
            value = value.replaceAll(""CLAIM\\.<[A-Z]*>"", """");
        } else if (key.equals(""optimizeLookupHelp"")) {
            // Allow ""<Extensions>"" here
            value = value.replaceAll(""<Extensions>"", """");
        } else if (key.startsWith(""linkExpirationFormatter.timePeriodUnit"") || key.equals(""error-invalid-multivalued-size"")) {
            // T
---
[Medium] method containsHtml in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private boolean containsHtml(String englishValue) {
        return HTML_TAGS.matcher(englishValue).find();
    }
---
[Medium] method santizeAnchors in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private String santizeAnchors(String key, String value, String englishValue) {
        Matcher matcher = ANCHOR_PATTERN.matcher(value);
        Matcher englishMatcher = ANCHOR_PATTERN.matcher(englishValue);
        while (matcher.find()) {
            if (englishMatcher.find() && Objects.equals(matcher.group(), englishMatcher.group())) {
                value = value.replaceFirst(Pattern.quote(englishMatcher.group()), """");
            } else {
                messages.add(""Didn't find anchor tag
---
[Medium] method getEnglishValue in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private static String getEnglishValue(String key, PropertyResourceBundle bundleEnglish) {
        String englishValue;
        try {
            englishValue = bundleEnglish.getString(key);
        } catch (MissingResourceException ex) {
            englishValue = """";
        }
        return englishValue;
    }
---
[Medium] method verifySafeHtml in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
private void verifySafeHtml() {
        PropertyResourceBundle bundle;
        try (FileInputStream fis = new FileInputStream(file)) {
            bundle = new PropertyResourceBundle(fis);
        } catch (IOException e) {
            throw new RuntimeException(""unable to read file "" + file, e);
        }

        PropertyResourceBundle bundleEnglish;
        String englishFile = file.getAbsolutePath().replaceAll(""resources-community"", ""resources"")
                .replaceAll(""_[a-zA-Z-_]*\\.pro
---
[Medium] method verify in misc/theme-verifier/src/main/java/org/keycloak/themeverifier/VerifyMessageProperties.java:
public List<String> verify() throws MojoExecutionException {
        messages = new ArrayList<>();
        try {
            String contents = Files.readString(file.toPath());
            verifyNoDuplicateKeys(contents);
            verifySafeHtml();
        } catch (IOException e) {
            throw new MojoExecutionException(""Can not read file "" + file, e);
        }
        return messages;
    }
---
[Medium] method verifyDuplicateKeysDetected in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyDuplicateKeysDetected() throws MojoExecutionException {
        List<String> verify = getFile(""duplicateKeys_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Duplicate keys in file"")));
    }
---
[Medium] method verifyIllegalHtmlTagDetected in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyIllegalHtmlTagDetected() throws MojoExecutionException {
        List<String> verify = getFile(""illegalHtmlTag_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Illegal HTML"")));
    }
---
[Medium] method verifyNoHtmlAllowed in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyNoHtmlAllowed() throws MojoExecutionException {
        List<String> verify = getFile(""noHtml_de.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Illegal HTML"")));
    }
---
[Medium] method verifyNoChangedAnchors in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
@Test
    void verifyNoChangedAnchors() throws MojoExecutionException {
        List<String> verify = getFile(""changedAnchor_de.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Didn't find anchor tag"")));
    }
---
[Medium] chunk lines 101-101 in misc/theme-verifier/pom.xml:
</project>
---
[Medium] chunk lines 1-18 in misc/theme-verifier/src/test/resources/duplicate_keys.properties:
#
# Copyright 2025 Red Hat, Inc. and/or its affiliates
# and other contributors as indicated by the @author tags.
#
# Licensed under the Apache License, Version 2.0 (the ""License"");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an ""AS IS"" BASIS,
# WITHOUT WARRANTIES O
---
[Medium] chunk lines 181-200 in js/apps/account-ui/maven-resources/theme/keycloak.v3/account/messages/messages_en.properties:
sharedWithMe=Shared with Me
username=Username
webauthn-display-name=Passkey
webauthn-help-text=Use your Passkey to sign in.
webauthn-passwordless-display-name=Passkey
webauthn-passwordless-help-text=Use your Passkey for passwordless sign in.
passwordless=Passwordless
error-invalid-multivalued-size=Attribute {0} must have at least {1} and at most {2} {2,choice,0#values|1#value|1<values}.
recovery-authn-code=My recovery authentication codes
recovery-authn-codes-display-name=Recovery authentication
---
[Medium] chunk lines 1241-1260 in js/apps/admin-ui/maven-resources-community/theme/keycloak.v2/admin/messages/messages_zh_CN.properties:
prefix=æ¯ä¸ªé¢†åŸŸè§’è‰²çš„å‰ç¼€ï¼ˆéžå¿…éœ€ï¼‰ã€‚
xContentTypeOptionsHelp=é»˜è®¤å€¼é˜»æ­¢ Internet Explorer å’Œè°·æ­Œæµè§ˆå™¨ä»Ž MIME å—…æŽ¢è¿œç¦»å£°æ˜Žçš„å†…å®¹ç±»åž‹çš„å“åº”<1>äº†è§£æ›´å¤š</1>
privateKeyMask=ç§é’¥æœªè®¾ç½®æˆ–æœªçŸ¥
signOutAllActiveSessions=æ³¨é”€æ‰€æœ‰æ´»åŠ¨ä¼šè¯
addExecutorSuccess=æˆåŠŸï¼æ‰§è¡Œå™¨åˆ›å»ºæˆåŠŸ
executorTypeSelectHelpText=æ‰§è¡Œå™¨ç±»åž‹é€‰æ‹©å¸®åŠ©æ–‡æœ¬
useDiscoveryEndpointHelp=å¦‚æžœå¯ç”¨æ­¤è®¾ç½®ï¼Œå‘çŽ°ç«¯ç‚¹å°†ç”¨äºŽèŽ·å–ä¾›åº”å•†é…ç½®ã€‚Keycloak å¯ä»¥ä»Žç»ˆç«¯èŠ‚ç‚¹åŠ è½½é…ç½®å¹¶åœ¨æºæœ‰ä»»ä½•æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°é…ç½®
eventTypes.USER_INFO_REQUEST_ERROR.name=ç”¨æˆ·ä¿¡æ¯è¯·æ±‚é”™è¯¯
createUserProviderError=ç”±äºŽ{{error}}ï¼Œæ— æ³•åˆ›å»ºç”¨æˆ·è”ç›Ÿä¾›åº”å•†ã€‚
learnMore=äº†è§£æ›´å¤š
onDragCancel=å·²å–æ¶ˆæ‹–åŠ¨ã€‚åˆ—è¡¨æœªæ›´æ”¹ã€‚
removeUser=ç§»é™¤ç”¨æˆ·
ownerManagedAccess=å¯ç”¨ç”¨æˆ·ç®¡
---
[Medium] chunk lines 3121-3140 in js/apps/admin-ui/maven-resources/theme/keycloak.v2/admin/messages/messages_en.properties:
spinnerLoading=Loading
enableClientSignatureRequiredModal=Enable client signature required
selectBindType=Select bind type
searchClientAuthorizationResource=Search resource
searchClientAuthorizationPolicy=Search policy
searchClientAuthorizationPermission=Search permission
userNotSaved=The user has not been saved\: {{error}}
kcNumberFormat=Number Format
kcNumberUnFormat=Number UnFormat
tokenExpirationHelp=Sets the expiration for tokens. Expired tokens are periodically deleted from the database.
b
---
[Medium] chunk lines 81-100 in misc/theme-verifier/pom.xml:
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-text</artifactId>
            <version>1.13.0</version>
            <scope>compile</scope>
        </dependency>
    </dependencies>


    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
      
---
[Medium] chunk lines 61-80 in misc/theme-verifier/pom.xml:
            <version>2.18.0</version>
        </dependency>
        <dependency>
            <groupId>org.junit.jupiter</groupId>
            <artifactId>junit-jupiter-api</artifactId>
            <version>5.10.5</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hamcrest</groupId>
            <artifactId>hamcrest</artifactId>
            <version>2.2</version>
            <scope>test</scope>
        </dependency>
        <dependency>
  
---
[Medium] class VerifyMessagePropertiesTest in misc/theme-verifier/src/test/java/org/keycloak/themeverifier/VerifyMessagePropertiesTest.java:
class VerifyMessagePropertiesTest {

    @Test
    void verifyDuplicateKeysDetected() throws MojoExecutionException {
        List<String> verify = getFile(""duplicateKeys_en.properties"").verify();
        MatcherAssert.assertThat(verify, Matchers.hasItem(Matchers.containsString(""Duplicate keys in file"")));
    }

    @Test
    void verifyIllegalHtmlTagDetected() throws MojoExecutionException {
        List<String> verify = getFile(""illegalHtmlTag_en.properties"").verify();
        MatcherAssert.a
---
[Medium] chunk lines 141-160 in themes/src/main/resources-community/theme/base/account/messages/messages_fi.properties:
totpStep1=Asenna jokin seuraavista sovelluksista matkapuhelimeesi:
totpStep2=Avaa sovellus ja skannaa QR-koodi tai kirjoita avain.
totpStep3=TÃ¤ytÃ¤ saamasi kertaluontoinen koodisi allaolevaan kenttÃ¤Ã¤n ja paina Tallenna.
totpStep3DeviceName=Anna laitteelle nimi, jotta voit hallinnoida OTP-laitteitasi.

totpManualStep2=Avaa sovellus ja syÃ¶tÃ¤ koodi
totpManualStep3=KÃ¤ytÃ¤ seuraavia asetuksia mikÃ¤li sovellus sallii niiden syÃ¶tÃ¶n
totpUnableToScan=Ongelmia skannuksessa?
totpScanBarcode=Skannaa viivakoodi
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_lt.properties:
totpStep1=Installa una delle seguenti applicazioni sul tuo cellulare:
totpStep2=Atidarykite programÄ—lÄ™ ir nuskenuokite barkodÄ… arba Ä¯veskite kodÄ….
totpStep3=Ä®veskite programÄ—lÄ—je sugeneruotÄ… vienÄ… kartÄ… galiojantÄ¯ kodÄ… ir paspauskite Saugoti norÄ—dami prisijungti.

missingUsernameMessage=PraÅ¡ome Ä¯vesti naudotojo vardÄ….
missingFirstNameMessage=PraÅ¡ome Ä¯vesti vardÄ….
invalidEmailMessage=Neteisingas el. paÅ¡to adresas.
missingLastNameMessage=PraÅ¡ome Ä¯vesti pavardÄ™.
missingEmailMessage=PraÅ¡ome Ä¯vesti e
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_sk.properties:
totpStep1=NainÅ¡talujte si do mobilu jednu z nasledujÃºcich aplikÃ¡ciÃ­:
totpStep2=Otvorte aplikÃ¡ciu a naskenujte ÄiarovÃ½ kÃ³d alebo zadajte kÄ¾ÃºÄ.
totpStep3=Zadajte jednorazovÃ½ kÃ³d poskytnutÃ½ aplikÃ¡ciou a kliknutÃ­m na tlaÄidlo UloÅ¾iÅ¥ dokonÄÃ­te nastavenie.

totpManualStep2=Otvorte aplikÃ¡ciu a zadajte kÄ¾ÃºÄ
totpManualStep3=PouÅ¾ite nasledujÃºce hodnoty konfigurÃ¡cie, ak aplikÃ¡cia umoÅ¾Åˆuje ich nastavenie
totpUnableToScan=NemoÅ¾no skenovaÅ¥?
totpScanBarcode=Skenovanie ÄiarovÃ©ho kÃ³du?

totp.totp=ZaloÅ¾enÃ© na Äas
---
[Medium] chunk lines 81-100 in themes/src/main/resources-community/theme/base/account/messages/messages_sv.properties:
log=Logg

application=Applikation
availablePermissions=TillgÃ¤ngliga rÃ¤ttigheter
grantedPermissions=Beviljade rÃ¤ttigheter
grantedPersonalInfo=Medgiven personlig information
additionalGrants=Ytterligare medgivanden
action=Ã…tgÃ¤rd
inResource=i
fullAccess=FullstÃ¤ndig Ã¥tkomst
offlineToken=Offline token
revoke=UpphÃ¤v rÃ¤ttighet

configureAuthenticators=Konfigurerade autentiserare
mobile=Mobil
totpStep1=Installera en av fÃ¶ljande applikationer pÃ¥ din mobil:
totpStep2=Ã–ppna applikationen och skanna streckk
---
[Medium] chunk lines 101-120 in themes/src/main/resources-community/theme/base/account/messages/messages_zh_CN.properties:
grantedPermissions=æŽˆäºˆæƒé™
grantedPersonalInfo=æŽˆæƒçš„ä¸ªäººä¿¡æ¯
additionalGrants=å¯æŽˆäºˆçš„æƒé™
action=æ“ä½œ
inResource=in
fullAccess=æ‰€æœ‰æƒé™
offlineToken=ç¦»çº¿ token
revoke=æ”¶å›žæŽˆæƒ

configureAuthenticators=é…ç½®çš„è®¤è¯è€…
mobile=æ‰‹æœº
totpStep1=åœ¨æ‚¨çš„æ‰‹æ©Ÿä¸Šå®‰è£ä»¥ä¸‹æ‡‰ç”¨ç¨‹å¼ä¹‹ä¸€ï¼š
totpStep2=æ‰“å¼€åº”ç”¨æ‰«æäºŒç»´ç è¾“å…¥éªŒè¯ç 
totpStep3=è¾“å…¥åº”ç”¨æä¾›çš„ä¸€æ¬¡æ€§éªŒè¯ç å•å‡»ä¿å­˜

missingUsernameMessage=è¯·æŒ‡å®šç”¨æˆ·å
missingFirstNameMessage=è¯·æŒ‡å®šå
invalidEmailMessage=æ— æ•ˆçš„ç”µå­é‚®ç®±åœ°å€
missingLastNameMessage=è¯·æŒ‡å®šå§“
missingEmailMessage=è¯·æŒ‡å®šé‚®ä»¶åœ°å€
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_da.properties:
emailVerificationSubject=Verificer email
emailVerificationBody=Nogen har oprettet en {2} konto med denne email adresse. Hvis dette var dig, bedes du trykke pÃ¥ forbindet herunder for at verificere din email adresse \n\n{0}\n\nDette link vil udlÃ¸be inden for {3}.\n\nHvis det var dig der har oprettet denne konto, bedes du se bort fra denne mail.
emailVerificationBodyHtml=<p>Nogen har oprettet en {2} konto med denne email adresse. Hvis dette var dig, bedes du trykke pÃ¥ forbindet herunder for at veri
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_fa.properties:
emailVerificationSubject=ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
emailVerificationBody=Ø´Ø®ØµÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ÛŒÚ© Ø­Ø³Ø§Ø¨ {2} Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø§ÛŒÙ† Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø±ÙˆÛŒ Ù¾ÛŒÙˆÙ†Ø¯ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯\n\n{0}\n\nØ§ÛŒÙ† Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ø± {3} Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.\n\nØ§Ú¯Ø± Ø´Ù…Ø§ Ø§ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŒ ÙÙ‚Ø· Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±ÛŒØ¯ .
emailVerificationBodyHtml=<p>Ø´Ø®ØµÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ÛŒÚ© Ø­Ø³Ø§Ø¨ {2} Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø§Ú¯Ø± Ø§ÛŒÙ† Ø´Ù…Ø§ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±ÙˆÛŒ Ù¾ÛŒÙˆÙ†Ø¯ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p><p><a href=""{0}"">Ù¾ÛŒÙˆÙ†Ø¯ Ø¨Ù‡ ØªØ£ÛŒÛŒØ¯ Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„</a></p>
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_hu.properties:
emailVerificationSubject=E-mail cÃ­m megerÅ‘sÃ­tÃ©se
emailVerificationBody=Ezzel az e-mail cÃ­mmel valaki lÃ©trehozott egy {2} tartomÃ¡ny felhasznÃ¡lÃ³i fiÃ³kot. Amennyiben a fiÃ³kot Ã–n hozta lÃ©tre, kÃ©rem, kattintson a lenti hivatkozÃ¡sra, hogy megerÅ‘sÃ­tse fiÃ³kjÃ¡t Ã©s ezt az e-mail cÃ­met.\n\n{0}\n\nA hivatkozÃ¡s Ã©rvÃ©nyÃ©t veszti {3} mÃºlva.\n\nHa nem Ã¶n hozta lÃ©tre a felhasznÃ¡lÃ³i fiÃ³kot, akkor kÃ©rem, hagyja figyelmen kÃ­vÃ¼l ezt az Ã¼zenetet.
emailVerificationBodyHtml=<p>Ezzel az e-mail cÃ­mmel valaki lÃ©trehozott e
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_lt.properties:
emailVerificationSubject=El. paÅ¡to patvirtinimas
emailVerificationBody=Paskyra {2} sukurta naudojant Å¡Ä¯ el. paÅ¡to adresÄ…. Jei tai buvote JÅ«s, tuomet paspauskite Å¾emiau esanÄiÄ… nuorodÄ…\n\n{0}\n\nÅ i nuoroda galioja {1} min.\n\nJei paskyros nekÅ«rÄ—te, tuomet ignuoruokite Å¡Ä¯ laiÅ¡kÄ…. 
emailVerificationBodyHtml=<p>Paskyra {2} sukurta naudojant Å¡Ä¯ el. paÅ¡to adresÄ…. Jei tao buvote JÅ«s, tuomet paspauskite Å¾emiau esanÄiÄ… nuorodÄ…</p><p><a href=""{0}"">{0}</a></p><p>Å i nuoroda galioja {1} min.</p><p>nJei pasky
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_nl.properties:
emailVerificationSubject=Bevestig e-mailadres
emailVerificationBody=Iemand heeft een {2} account aangemaakt met dit e-mailadres. Als u dit was, klikt u op de onderstaande koppeling om uw e-mailadres te bevestigen \n\n{0}\n\nDeze koppeling zal binnen {3} vervallen.\n\nU kunt dit bericht negeren indien u dit account niet heeft aangemaakt.
emailVerificationBodyHtml=<p>Iemand heeft een {2} account aangemaakt met dit e-mailadres. Als u dit was, klikt u op de onderstaande koppeling om uw e-mailadres t
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_no.properties:
emailVerificationSubject=Bekreft e-postadresse
emailVerificationBody=Noen har opprettet en {2} konto med denne e-postadressen. Hvis dette var deg, klikk pÃ¥ lenken nedenfor for Ã¥ bekrefte e-postadressen din\n\n{0}\n\nDenne lenken vil utlÃ¸pe om {1} minutter.\n\nHvis du ikke opprettet denne kontoen, vennligst ignorer denne meldingen.
emailVerificationBodyHtml=<p>Noen har opprettet en {2} konto med denne e-postadressen. Hvis dette var deg, klikk pÃ¥ lenken nedenfor for Ã¥ bekrefte e-postadressen din</
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_tr.properties:
emailVerificationSubject=E-postayÄ± doÄŸrula
emailVerificationBody=Birisi bu e-posta adresiyle bir {2} hesap oluÅŸturdu. Bu sizseniz, e-posta adresinizi doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±ya tÄ±klayÄ±n\n\n{0}\n\nBu baÄŸlantÄ± {3} iÃ§inde sona erecek.\n\nBu hesabÄ± oluÅŸturmadÄ±ysanÄ±z, sadece bu iletiyi yoksayÄ±nÄ±z.
emailVerificationBodyHtml=<p>Birisi bu e-posta adresiyle bir {2} hesap oluÅŸturdu. Bu sizseniz, e-posta adresinizi doÄŸrulamak iÃ§in aÅŸaÄŸÄ±daki baÄŸlantÄ±yÄ± tÄ±klayÄ±n.</p><p><a href=""{0}"">E-posta adresi 
---
[Medium] chunk lines 1-20 in themes/src/main/resources-community/theme/base/email/messages/messages_uk.properties:
emailVerificationSubject=ÐŸÑ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ Ð°Ð´Ñ€ÐµÑÑƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸
emailVerificationBody=Ð¥Ñ‚Ð¾ÑÑŒ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ {2} Ñ–Ð· Ñ†Ñ–Ñ”ÑŽ Ð°Ð´Ñ€ÐµÑÐ¾ÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸. Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð±ÑƒÐ»Ð¸ Ð’Ð¸, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð½Ð¸Ð¶Ñ‡Ðµ, Ñ‰Ð¾Ð± Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ ÑÐ²Ð¾ÑŽ Ð°Ð´Ñ€ÐµÑÑƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸\n\n{0}\n\nÐ¦Ðµ Ð¿Ð¾ÑÐ¸Ð»Ð°Ð½Ð½Ñ Ð´Ñ–Ð¹ÑÐ½Ðµ Ð¿Ñ€Ð¾Ñ‚ÑÐ³Ð¾Ð¼ {3}.\n\nÐ¯ÐºÑ‰Ð¾ Ð’Ð¸ Ð½Ðµ ÑÑ‚Ð²Ð¾Ñ€ÑŽÐ²Ð°Ð»Ð¸ Ñ†ÐµÐ¹ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ñ–Ð³Ð½Ð¾Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ†ÐµÐ¹ Ð»Ð¸ÑÑ‚.
emailVerificationBodyHtml=<p>Ð¥Ñ‚Ð¾ÑÑŒ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð² Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð¸Ñ {2} Ñ–Ð· Ñ†Ñ–Ñ”ÑŽ Ð°Ð´Ñ€ÐµÑÐ¾ÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð¾Ñ— Ð¿Ð¾ÑˆÑ‚Ð¸. Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð±ÑƒÐ»Ð¸ Ð’Ð¸, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾ÑÐ¸Ð»Ð°
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_ar.properties:
webauthn-doAuthenticate=ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†
webauthn-createdAt-label=ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ

# WebAuthn Error
webauthn-error-title=Ø®Ø·Ø£ ÙÙŠ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†
webauthn-error-registration=ÙØ´Ù„ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.<br /> {0}
webauthn-error-api-get=ÙØ´Ù„Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†.<br /> {0}
webauthn-error-different-user=Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… ØªÙ…Øª Ù…ØµØ§Ø¯Ù‚ØªÙ‡ Ù„ÙŠØ³ Ù‡Ùˆ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ØªÙ…Øª Ù…ØµØ§Ø¯Ù‚ØªÙ‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù†.
webauthn-error-auth-verification=Ù†ØªÙŠØ¬Ø© Ù…ØµØ§Ø¯Ù‚Ø© Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ù…Ø§Ù† ØºÙŠØ± ØµØ§Ù„Ø­Ø©.<br /> {0}
webauthn-error-reg
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_ca.properties:
# WebAuthn Error
webauthn-error-title=Error de la clau de seguretat
webauthn-error-registration=No s''ha pogut registrar la vostra clau de seguretat.<br /> {0}
webauthn-error-api-get=No s''ha pogut identificar amb la clau de seguretat.<br /> {0}
webauthn-error-different-user=L''usuari identificat primer no Ã©s l''autenticat per la clau de seguretat.
webauthn-error-auth-verification=El resultat de l''autenticaciÃ³ amb clau de seguretat no Ã©s vÃ lid.<br />{0}
webauthn-error-register-verification=El r
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_cs.properties:
webauthn-doAuthenticate=PÅ™ihlÃ¡Å¡enÃ­ pÅ™Ã­stupovÃ½m klÃ­Äem
webauthn-createdAt-label=VytvoÅ™eno

# WebAuthn Error
webauthn-error-title=Chyba pÅ™Ã­stupovÃ©ho klÃ­Äe
webauthn-error-registration=Selhala registrace vaÅ¡eho pÅ™Ã­stupovÃ©ho klÃ­Äe.<br /> {0}
webauthn-error-api-get=Selhalo pÅ™ihlÃ¡Å¡enÃ­ pomocÃ­ pÅ™Ã­stupovÃ©ho klÃ­Äe.<br /> {0}
webauthn-error-different-user=PrvnÃ­ pÅ™ihlÃ¡Å¡enÃ½ uÅ¾ivatel nenÃ­ totoÅ¾nÃ½ s uÅ¾ivatelem pÅ™ihlÃ¡Å¡enÃ½m pomocÃ­ pÅ™Ã­stupovÃ©ho klÃ­Äe.
webauthn-error-auth-verification=NevalidnÃ­ vÃ½sledek pÅ™ihlÃ¡Å¡enÃ­ 
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_de.properties:
recovery-codes-download-file-header=Bewahren Sie diese Wiederherstellungscodes an einem sicheren Ort auf.
recovery-codes-download-file-description=Wiederherstellungscodes sind einmalig verwendbare PasswÃ¶rter, mit denen Sie sich bei Ihrem Konto anmelden kÃ¶nnen, wenn Sie keinen Zugriff auf Ihren Authentifikator haben.
recovery-codes-download-file-date=Diese Codes wurden generiert am
recovery-codes-label-default=Wiederherstellungscodes

# WebAuthn
webauthn-display-name=Passkey
webauthn-help-text=Ve
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_de.properties:
webauthn-error-api-get=Fehler beim Authentifizieren mit dem Passkey.<br /> {0}
webauthn-error-different-user=Der erste authentifizierte Benutzer ist nicht derjenige, der durch den Passkey authentifiziert wurde.
webauthn-error-auth-verification=Das Ergebnis der Passkey-Authentifizierung ist ungÃ¼ltig.<br /> {0}
webauthn-error-register-verification=Das Ergebnis der Passkey-Registrierung ist ungÃ¼ltig.<br /> {0}
webauthn-error-user-not-found=Unbekannter Benutzer, der mit dem Passkey authentifiziert w
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_el.properties:
recovery-codes-download-file-date=Î‘Ï…Ï„Î¿Î¯ Î¿Î¹ ÎºÏ‰Î´Î¹ÎºÎ¿Î¯ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎ±Î½ ÏƒÏ„Î¹Ï‚
recovery-codes-label-default=ÎšÏ‰Î´Î¹ÎºÎ¿Î¯ Î±Î½Î¬ÎºÏ„Î·ÏƒÎ·Ï‚

# WebAuthn
webauthn-display-name=ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-help-text=Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÏƒÎ±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·.
webauthn-passwordless-display-name=ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-passwordless-help-text=Î§ÏÎ®ÏƒÎ· Ï„Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚.
webauthn-login-title=Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Î¼Îµ ÎšÎ»ÎµÎ¹Î´Î¯ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-registration-title=Î•Î³Î³ÏÎ±Ï†Î® ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚
webauthn-avai
---
[Medium] chunk lines 421-440 in themes/src/main/resources-community/theme/base/login/messages/messages_el.properties:
webauthn-error-auth-verification=ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.<br /> {0}
webauthn-error-register-verification=ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.<br /> {0}
webauthn-error-user-not-found=Î†Î³Î½Ï‰ÏƒÏ„Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ Î¼Îµ Ï„Î¿ ÎšÎ»ÎµÎ¹Î´Î¯ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.

# Identity provider
identity-provider-redirector=Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Î­Î½Î±Î½ Î¬Î»Î»Î¿ Î Î¬ÏÎ¿Ï‡Î¿ Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚
identity-provider-login-label=Î‰ ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ
idp-email-verification-display-name=Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Email
idp-email-verification-help
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_es.properties:
webauthn-error-title=Error de Passkey
webauthn-error-registration=No se pudo registrar su Passkey. <br /> {0}
webauthn-error-api-get=No se pudo autenticar con el Passkey. <br /> {0}
webauthn-error-different-user=El primer usuario autenticado no es el autenticado por el Passkey.
webauthn-error-auth-verification=El resultado de la autenticaciÃ³n con el Passkey no es vÃ¡lido. <br /> {0}
webauthn-error-register-verification=El resultado de registro del Passkey no es vÃ¡lido. <br /> {0}
webauthn-error-u
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_fa.properties:
recovery-codes-label-default=Ú©Ø¯Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ

# WebAuthn
webauthn-display-name=Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-help-text=.Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø®ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
webauthn-passwordless-display-name=Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-passwordless-help-text=.Ø§Ø² Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø®ÙˆØ¯ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
webauthn-login-title=ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-registration-title=Ø«Ø¨Øª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ
webauthn-available-authenticators=Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ù…ÙˆØ¬ÙˆØ¯
webauthn-unsupported-browser-text=WebAuthn ØªÙˆØ³Ø· Ø§ÛŒÙ† Ù…Ø±ÙˆØ±Ú¯Ø±
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_fa.properties:
webauthn-error-register-verification=Ù†ØªÛŒØ¬Ù‡ Ø«Ø¨Øª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.<br /> {0}
webauthn-error-user-not-found=.Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ø´Ù†Ø§Ø³ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø´Ø¯Ù‡ Ø§Ø³Øª

# Identity provider
identity-provider-redirector=Ø¨Ø§ ÛŒÚ© Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù‡ÙˆÛŒØª Ø¯ÛŒÚ¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†ÛŒØ¯
identity-provider-login-label=ÛŒØ§ ÙˆØ±ÙˆØ¯ Ø¨Ø§
idp-email-verification-display-name=ØªØ§ÛŒÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„
idp-email-verification-help-text=.Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ù¾ÛŒÙˆÙ†Ø¯ Ø¯Ù‡ÛŒØ¯
idp-username-password-form-display-name=Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
idp-usernam
---
[Medium] chunk lines 381-400 in themes/src/main/resources-community/theme/base/login/messages/messages_fi.properties:
password-help-text=Kirjaudu sisÃ¤Ã¤n syÃ¶ttÃ¤mÃ¤llÃ¤ salasanasi.
auth-username-form-display-name=KÃ¤yttÃ¤jÃ¤nimi
auth-username-form-help-text=Aloita kirjautuminen syÃ¶ttÃ¤mÃ¤llÃ¤ kÃ¤yttÃ¤jÃ¤nimesi
auth-username-password-form-display-name=kÃ¤yttÃ¤jÃ¤nimi ja salasana
auth-username-password-form-help-text=Kirjaudu sisÃ¤Ã¤n syÃ¶ttÃ¤mÃ¤llÃ¤ kÃ¤yttÃ¤jÃ¤nimi ja salasana.

# WebAuthn
webauthn-display-name=Turva-avain
webauthn-help-text=KÃ¤ytÃ¤ Turva-avaintasi kirjatuaksesi sisÃ¤Ã¤n.
webauthn-passwordless-display-name=Turva-avain
webau
---
[Medium] chunk lines 401-420 in themes/src/main/resources-community/theme/base/login/messages/messages_fi.properties:
webauthn-error-api-get=Tunnistautuminen Turva-avaimella epÃ¤onnistui.<br /> {0}
webauthn-error-different-user=Ensiksi tunnistautunut kÃ¤yttÃ¤jÃ¤ ei ole sama kuin Turva-avaimella tunnistaunut.
webauthn-error-auth-verification=Turva-avain -tunnistautumisen tulos on virheellinen.<br /> {0}
webauthn-error-register-verification=Turva-avaimen rekisterÃ¶innin tulos on virheellinen.<br /> {0}
webauthn-error-user-not-found=Tuntematon kÃ¤yttÃ¤jÃ¤ tunnistautui Turva-avaimella.

# Identity provider
identity-provide
---
[Medium] chunk lines 381-400 in themes/src/main/resources-community/theme/base/login/messages/messages_fr.properties:
webauthn-error-register-verification=Le rÃ©sultat de l''enregistrement de la clÃ© de sÃ©curitÃ© est invalide.<br /> {0}
webauthn-error-user-not-found=La ClÃ© de SÃ©curitÃ© a authentifiÃ© un utilisateur inconnu.
finalDeletionConfirmation=Si vous supprimez votre compte, il ne pourra pas Ãªtre restaurÃ©. Pour conserver votre compte, cliquez sur Annuler.
irreversibleAction=Cette action est irrÃ©versible
deleteAccountConfirm=Confirmation de suppression de compte
deletingImplies=Supprimer votre compte implique:

---
[Medium] chunk lines 361-380 in themes/src/main/resources-community/theme/base/login/messages/messages_fr.properties:
auth-username-password-form-help-text=Connectez-vous en saisissant votre nom d''utilisateur et votre mot de passe.

# WebAuthn
webauthn-display-name=ClÃ© de SÃ©curitÃ©
webauthn-help-text=Utilisez votre clÃ© de sÃ©curitÃ© pour vous connecter.
webauthn-passwordless-display-name=ClÃ© de SÃ©curitÃ©
webauthn-passwordless-help-text=Utilisez votre clÃ© de sÃ©curitÃ© pour vous connecter sans mot de passe.
webauthn-login-title=Connexion avec une ClÃ© de SÃ©curitÃ©
webauthn-registration-title=Enregistrement d''une ClÃ© d
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_hr.properties:

# WebAuthn
webauthn-display-name=Sigurnosni kljuÄ
webauthn-help-text=Koristite svoj sigurnosni kljuÄ za prijavu.
webauthn-passwordless-display-name=Sigurnosni kljuÄ
webauthn-passwordless-help-text=Koristite svoj sigurnosni kljuÄ za prijavu bez lozinke.
webauthn-login-title=Prijava sigurnosnim kljuÄem
webauthn-registration-title=Registracija sigurnosnog kljuÄa
webauthn-available-authenticators=Dostupni sigurnosni kljuÄevi
webauthn-unsupported-browser-text=WebAuthn nije podrÅ¾an u ovom pregledniku
---
[Medium] chunk lines 481-500 in themes/src/main/resources-community/theme/base/login/messages/messages_hr.properties:
webauthn-error-different-user=Prvi autentificirani korisnik nije isti kao korisnik autentificiran putem sigurnosnog kljuÄa.
webauthn-error-auth-verification=Rezultat autentifikacije putem sigurnosnog kljuÄa nije valjan.<br /> {0}
webauthn-error-register-verification=Rezultat registracije sigurnosnog kljuÄa nije valjan.<br /> {0}
webauthn-error-user-not-found=Nepoznati korisnik autentificiran putem sigurnosnog kljuÄa.

# Passkey
passkey-login-title=Prijava pristupnim kljuÄem
passkey-available-aut
---
[Medium] chunk lines 161-180 in themes/src/main/resources-community/theme/base/login/messages/messages_ka.properties:
webauthn-passwordless-display-name=Passkey
webauthn-passwordless-help-text=áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ”áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ Passkey áƒ£áƒžáƒáƒ áƒáƒšáƒáƒ“ áƒ¨áƒ”áƒ¡áƒáƒ¡áƒ•áƒšáƒ”áƒšáƒáƒ“.
webauthn-unsupported-browser-text=áƒáƒ› áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¡ WebAuthn-áƒ˜áƒ¡ áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ áƒáƒ  áƒ’áƒáƒáƒ©áƒœáƒ˜áƒ. áƒ¡áƒªáƒáƒ“áƒ”áƒ— áƒ¡áƒ®áƒ•áƒ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ˜ áƒáƒœ áƒ“áƒáƒ£áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ“áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ  áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ¡.
webauthn-doAuthenticate=Passkey-áƒ˜áƒ— áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ
webauthn-registration-init-label=Passkey (áƒœáƒáƒ’áƒ£áƒšáƒ˜áƒ¡áƒ®áƒ›áƒ”áƒ•áƒ˜ áƒ­áƒ“áƒ”)


# WebAuthn Error
webauthn-error-title=Passkey-áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ
webauthn-createdAt-label=áƒ¨áƒ”áƒ˜áƒ¥áƒ›áƒœáƒ
webauthn-registration-init-label-
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_ka.properties:
auth-username-password-form-display-name=áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ“áƒ áƒžáƒáƒ áƒáƒšáƒ˜
auth-username-password-form-help-text=áƒ¨áƒ”áƒ“áƒ˜áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡áƒ áƒ“áƒ áƒžáƒáƒ áƒáƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒ§áƒ•áƒáƒœáƒ˜áƒ—.
recovery-code-config-warning-message=áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ“áƒ˜áƒ—, áƒ áƒáƒ› áƒ“áƒáƒ‘áƒ”áƒ­áƒ“áƒáƒ—, áƒ’áƒáƒ“áƒ›áƒáƒ¬áƒ”áƒ áƒáƒ— áƒáƒœ áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒáƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒžáƒáƒ áƒáƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒ›áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ¨áƒ˜ áƒ“áƒ áƒ˜áƒ¥áƒáƒœáƒ˜áƒ”áƒ— áƒ˜áƒ¡áƒ˜áƒœáƒ˜ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ“. áƒáƒ› áƒžáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒœáƒ’áƒáƒ áƒ˜áƒ¨áƒ˜áƒ“áƒáƒœ áƒáƒ› áƒ™áƒáƒ“áƒ”áƒ‘áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡.
recovery-codes-action-complete=áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ
recovery-codes-action-cancel=áƒ›áƒáƒ áƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ
recovery-codes-download-file-header=áƒ¨áƒ”áƒ˜áƒœáƒáƒ®áƒ”áƒ— áƒ”áƒ¡ áƒ™áƒ
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_ko.properties:
recovery-codes-download-file-date=ì´ ì½”ë“œëŠ” ë‹¤ìŒ ë‚ ì§œì— ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:
recovery-codes-label-default=ë³µêµ¬ ì½”ë“œ

# WebAuthn
webauthn-display-name=íŒ¨ìŠ¤í‚¤
webauthn-help-text=íŒ¨ìŠ¤í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•˜ì„¸ìš”.
webauthn-passwordless-display-name=íŒ¨ìŠ¤í‚¤
webauthn-passwordless-help-text=íŒ¨ìŠ¤í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ë¡œê·¸ì¸í•˜ì„¸ìš”.
webauthn-login-title=íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸
webauthn-registration-title=íŒ¨ìŠ¤í‚¤ ë“±ë¡
webauthn-available-authenticators=ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ìŠ¤í‚¤
webauthn-unsupported-browser-text=ì´ ë¸Œë¼ìš°ì €ëŠ” WebAuthnì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
webauthn-doAuthenticate=íŒ¨ìŠ¤í‚¤ë¡œ ë¡œê·¸ì¸
weba
---
[Medium] chunk lines 481-500 in themes/src/main/resources-community/theme/base/login/messages/messages_ko.properties:
webauthn-error-api-get=íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-different-user=ì²« ë²ˆì§¸ ì¸ì¦ëœ ì‚¬ìš©ìžê°€ íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦ëœ ì‚¬ìš©ìžê°€ ì•„ë‹™ë‹ˆë‹¤.
webauthn-error-auth-verification=íŒ¨ìŠ¤í‚¤ ì¸ì¦ ê²°ê³¼ê°€ ìž˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-register-verification=íŒ¨ìŠ¤í‚¤ ë“±ë¡ ê²°ê³¼ê°€ ìž˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.<br /> {0}
webauthn-error-user-not-found=íŒ¨ìŠ¤í‚¤ë¡œ ì¸ì¦ëœ ì•Œ ìˆ˜ ì—†ëŠ” ì‚¬ìš©ìž.

# Passkey
passkey-login-title=íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸
passkey-available-authenticators=ì‚¬ìš© ê°€ëŠ¥í•œ íŒ¨ìŠ¤í‚¤
passkey-unsupported-browser-text=ì´ ë¸Œë¼ìš°ì €ëŠ” íŒ¨ìŠ¤í‚¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.
passkey-doAuthenticate=íŒ¨ìŠ¤í‚¤ë¡œ ë¡œê·¸ì¸
pa
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_lt.properties:
authenticatorCode=Vienkartinis kodas
address=Adresas
street=GatvÄ—
locality=Miestas arba vietovÄ—
region=Rajonas
postal_code=PaÅ¡to kodas
country=Å alis
emailVerified=El. paÅ¡to adresas patvirtintas
gssDelegationCredential=GSS prisijungimo duomenÅ³ delegavimas

loginTotpStep1=Installa una delle seguenti applicazioni sul tuo cellulare:
loginTotpStep2=Atidarykite programÄ—lÄ™ ir nuskenuokite barkodÄ… arba Ä¯veskite kodÄ….
loginTotpStep3=Ä®veskite programÄ—lÄ—je sugeneruotÄ… vienÄ… kartÄ… galiojantÄ¯ kodÄ… ir paspaus
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_no.properties:
authenticatorCode=Engangskode
address=Adresse
street=Gate-/veinavn + husnummer
locality=By
region=Fylke
postal_code=Postnummer
country=Land
emailVerified=E-postadresse bekreftet
gssDelegationCredential=GSS legitimasjons-delegering

loginTotpStep1=Installer en av fÃ¸lgende applikasjoner pÃ¥ mobilen din:
loginTotpStep2=Ã…pne applikasjonen og skann strekkoden eller skriv inn koden
loginTotpStep3=Skriv inn engangskoden fra applikasjonen og klikk send inn for Ã¥ fullfÃ¸re
loginOtpOneTime=Engangskode

oaut
---
[Medium] chunk lines 501-501 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
error-invalid-multivalued-size=AtribÃºt {0} musÃ­ maÅ¥ najmenej {1} {1,choice,0#hodnÃ´t|1#hodnotu|1<hodnoty|4<hodnÃ´t} a najviac {2} {2,choice,0#hodnÃ´t|1#hodnotu|1<hodnoty|4<hodnÃ´t}.
---
[Medium] chunk lines 121-140 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:

loginTotpIntro=Pre prÃ­stup k tomuto ÃºÄtu je potrebnÃ© nastaviÅ¥ generÃ¡tor jednorazovÃ½ch kÃ³dov
loginTotpStep1=NainÅ¡talujte si do mobilu jednu z nasledujÃºcich aplikÃ¡ciÃ­:
loginTotpStep2=Otvorte aplikÃ¡ciu a skenujte ÄiarovÃ½ kÃ³d alebo zadajte kÄ¾ÃºÄ
loginTotpStep3=Zadajte jednorazovÃ½ kÃ³d poskytnutÃ½ aplikÃ¡ciou a kliknutÃ­m na tlaÄidlo OdoslaÅ¥ dokonÄite nastavenie
loginTotpStep3DeviceName=UveÄte nÃ¡zov zariadenia, ktorÃ½ vÃ¡m pomÃ´Å¾e spravovaÅ¥ zariadenia OTP. 
loginTotpManualStep2=Otvorte aplikÃ¡ciu a zadajte k
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
webauthn-doAuthenticate=PrihlÃ¡senie pomocou prihlasovacieho kÄ¾ÃºÄa
webauthn-createdAt-label=VytvorenÃ©

# WebAuthn Error
webauthn-error-title=ChybnÃ½ prihlasovacÃ­ kÄ¾ÃºÄ
webauthn-error-registration=Nepodarilo sa zaregistrovaÅ¥ prihlasovacÃ­ kÄ¾ÃºÄ.<br /> {0}
webauthn-error-api-get=Nepodarilo sa overiÅ¥ pomocou prihlasovacieho kÄ¾ÃºÄa.<br /> {0}
webauthn-error-different-user=PrvÃ½ overenÃ½ pouÅ¾Ã­vateÄ¾ nie je ten, ktorÃ½ bol overenÃ½ prihlasovacÃ­m kÄ¾ÃºÄom.
webauthn-error-auth-verification=VÃ½sledok overenia prihlaso
---
[Medium] chunk lines 21-40 in themes/src/main/resources-community/theme/base/login/messages/messages_sk.properties:
kerberosNotConfigured=Kerberos nie je nakonfigurovanÃ½
kerberosNotConfiguredTitle=Kerberos nie je nakonfigurovanÃ½
bypassKerberosDetail=BuÄ nie ste prihlÃ¡senÃ½ cez Kerberos, alebo vÃ¡Å¡ prehliadaÄ nie je nastavenÃ½ na prihlÃ¡senie do Kerberos. KliknutÃ­m na tlaÄidlo PokraÄovaÅ¥ sa prihlÃ¡ste inÃ½m spÃ´sobom
kerberosNotSetUp=Kerberos nie je nastavenÃ½. NemÃ´Å¾ete sa prihlÃ¡siÅ¥.
registerTitle=RegistrÃ¡cia
loginAccountTitle=PrihlÃ¡ste sa do svojho ÃºÄtu
loginTitle=PrihlÃ¡senie do {0}
loginTitleHtml={0}
impersonateTitl
---
[Medium] chunk lines 61-80 in themes/src/main/resources-community/theme/base/login/messages/messages_sv.properties:
locality=Postort
region=Stat, Provins eller Region
postal_code=Postnummer
country=Land
emailVerified=E-post verifierad
gssDelegationCredential=GSS Delegation Credential

loginTotpStep1=Installera en av fÃ¶ljande applikationer pÃ¥ din mobil:
loginTotpStep2=Ã–ppna applikationen och skanna streckkoden eller skriv i nyckeln
loginTotpStep3=Fyll i engÃ¥ngskoden som tillhandahÃ¥lls av applikationen och klicka pÃ¥ Spara fÃ¶r att avsluta instÃ¤llningarna
loginOtpOneTime=EngÃ¥ngskod

oauthGrantRequest=GodkÃ¤nner du
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_th.properties:
webauthn-error-title=à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¸‚à¸­à¸‡à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
webauthn-error-registration=à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ<br /> {0}
webauthn-error-api-get=à¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ<br /> {0}
webauthn-error-different-user=à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸£à¸²à¸¢à¹à¸£à¸à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸£à¸²à¸¢à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸ˆà¸²à¸à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
webauthn-error-auth-verification=à¸œà¸¥à¸à¸²à¸£à¸žà¸´à¸ªà¸¹à¸ˆà¸™à¹Œà¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸µà¸¢à¹Œà¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡<br /> {0}
webauthn-error-register-verification=à¸œà¸¥à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸‚à¸­à¸‡à¸„à¸µ
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_tr.properties:
webauthn-passwordless-help-text= Åžifresiz giriÅŸ iÃ§in GeÃ§iÅŸ AnahtarÄ±nÄ±zÄ± kullanÄ±n.,
webauthn-login-title= GeÃ§iÅŸ AnahtarÄ±yla GiriÅŸ,
webauthn-registration-title= GeÃ§iÅŸ AnahtarÄ±yla KayÄ±t,
webauthn-available-authenticators= GeÃ§erli GeÃ§iÅŸ AnahtarlarÄ± ,
webauthn-unsupported-browser-text= WebAuthn tarayÄ±cÄ±nÄ±z tarafÄ±ndan desteklenmemektedir. BaÅŸka bir tarayÄ±cÄ±dan ulaÅŸmayÄ± deneyin veya yÃ¶neticinizle iletiÅŸime geÃ§in.,
webauthn-doAuthenticate= GeÃ§iÅŸ AnahtarÄ± ile giriÅŸ yap,
webauthn-createdAt-label= OluÅŸturu
---
[Medium] chunk lines 441-460 in themes/src/main/resources-community/theme/base/login/messages/messages_uk.properties:
recovery-codes-download-file-description=ÐšÐ¾Ð´Ð¸ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ â€” Ñ†Ðµ Ð¾Ð´Ð½Ð¾Ñ€Ð°Ð·Ð¾Ð²Ñ– Ð¿Ð°Ñ€Ð¾Ð»Ñ–, ÑÐºÑ– Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‚ÑŒ Ð’Ð°Ð¼ ÑƒÐ²Ñ–Ð¹Ñ‚Ð¸ Ð´Ð¾ ÑÐ²Ð¾Ð³Ð¾ Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ð¸ÑÑƒ, ÑÐºÑ‰Ð¾ Ñƒ Ð’Ð°Ñ Ð½ÐµÐ¼Ð°Ñ” Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ Ð´Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ‚Ð¾Ñ€Ð°.
recovery-codes-download-file-date=Ð¦Ñ– ÐºÐ¾Ð´Ð¸ Ð±ÑƒÐ»Ð¸ Ð·Ð³ÐµÐ½ÐµÑ€Ð¾Ð²Ð°Ð½Ñ–
recovery-codes-label-default=ÐšÐ¾Ð´Ð¸ Ð²Ñ–Ð´Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ

# WebAuthn
webauthn-display-name=ÐšÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
webauthn-help-text=Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ñ–Ð¹ ÐºÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð´Ð»Ñ Ð²Ñ…Ð¾Ð´Ñƒ.
webauthn-passwordless-display-name=ÐšÐ»ÑŽÑ‡ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
webauthn-passwordless-help-text=Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ñ–Ð¹ ÐºÐ»ÑŽÑ‡
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_uk.properties:
webauthn-error-different-user=ÐŸÐµÑ€ÑˆÐ¸Ð¹ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð½Ðµ Ñ” Ñ‚Ð¸Ð¼, Ñ…Ñ‚Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ÐµÐ¼ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸.
webauthn-error-auth-verification=Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ— ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð½ÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹.<br /> {0}
webauthn-error-register-verification=Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ñ€ÐµÑ”ÑÑ‚Ñ€Ð°Ñ†Ñ–Ñ— ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð½ÐµÐ²Ñ–Ñ€Ð½Ð¸Ð¹.<br /> {0}
webauthn-error-user-not-found=ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ¾Ð²Ð°Ð½Ð¸Ð¹ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÐºÐ»ÑŽÑ‡Ð° Ð±ÐµÐ·Ð¿ÐµÐºÐ¸.

# Identity provider
identity-provider-redirector=ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡Ñ–Ñ‚ÑŒÑÑ Ð´Ð¾ Ñ–Ð½ÑˆÐ¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð° Ð¾Ð±Ð»Ñ–ÐºÐ¾Ð²Ð¸Ñ… Ð·Ð°Ð¿Ð¸ÑÑ–Ð²
identi
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_zh_CN.properties:
webauthn-doAuthenticate=ä½¿ç”¨å®‰å…¨å¯†é’¥ç™»å½•
webauthn-createdAt-label=åˆ›å»ºäºŽ

# WebAuthn Error
webauthn-error-title=å®‰å…¨å¯†é’¥é”™è¯¯
webauthn-error-registration=æ³¨å†Œæ‚¨çš„å®‰å…¨å¯†é’¥å¤±è´¥ã€‚<br /> {0}
webauthn-error-api-get=é€šè¿‡å®‰å…¨å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯å¤±è´¥ã€‚<br /> {0}
webauthn-error-different-user=é¦–æ¬¡ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¸æ˜¯é€šè¿‡å®‰å…¨å¯†é’¥ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚
webauthn-error-auth-verification=å®‰å…¨å¯†é’¥èº«ä»½éªŒè¯ç»“æžœæ— æ•ˆã€‚<br /> {0}
webauthn-error-register-verification=å®‰å…¨å¯†é’¥æ³¨å†Œç»“æžœæ— æ•ˆã€‚<br /> {0}
webauthn-error-user-not-found=é€šè¿‡å®‰å…¨å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯çš„ç”¨æˆ·æœªçŸ¥ã€‚

# Identity provider
identity-provider-redirector=è¿žæŽ¥åˆ°å¦ä¸€ä¸ªèº«ä»½æä¾›è€…
identi
---
[Medium] chunk lines 461-480 in themes/src/main/resources-community/theme/base/login/messages/messages_zh_TW.properties:
webauthn-login-title=å®‰å…¨é‡‘é‘°ç™»å…¥
webauthn-registration-title=è¨»å†Šå®‰å…¨é‡‘é‘°
webauthn-available-authenticators=å¯ç”¨çš„å®‰å…¨é‡‘é‘°
webauthn-unsupported-browser-text=æ­¤ç€è¦½å™¨ä¸æ”¯æ´ WebAuthnã€‚è«‹å˜—è©¦å…¶ä»–ç€è¦½å™¨æˆ–è¯çµ¡æ‚¨çš„ç³»çµ±ç®¡ç†å“¡ã€‚
webauthn-doAuthenticate=é€éŽå®‰å…¨é‡‘é‘°é€²è¡Œç™»å…¥
webauthn-createdAt-label=å·²å»ºç«‹
webauthn-registration-init-label=å®‰å…¨é‡‘é‘° (é è¨­æ¨™ç±¤)
webauthn-registration-init-label-prompt=è«‹ç‚ºè¨»å†Šçš„å®‰å…¨é‡‘é‘°è¼¸å…¥æ¨™ç±¤


# WebAuthn Error
webauthn-error-title=å®‰å…¨é‡‘é‘°éŒ¯èª¤
webauthn-error-registration=ç„¡æ³•è¨»å†Šæ‚¨çš„å®‰å…¨é‡‘é‘°ã€‚<br /> {0}
webauthn-error-api-get=ç„¡æ³•é€éŽå®‰å…¨é‡‘é‘°é€²è¡Œé©—è­‰ã€‚<br /> {0}
webauthn-error-di
---
[Medium] chunk lines 61-69 in themes/src/main/resources/theme/base/admin/messages/messages_en.properties:
error-invalid-uri=Invalid URL.
error-invalid-uri-scheme=Invalid URL scheme.
error-invalid-uri-fragment=Invalid URL fragment.
error-user-attribute-required=Please specify attribute {0}.
error-invalid-date=Attribute {0} is invalid date.
error-user-attribute-read-only=Attribute {0} is read only.
error-username-invalid-character={0} contains invalid character.
error-person-name-invalid-character={0} contains invalid character.
error-invalid-multivalued-size=Attribute {0} must have at least {1} and a
---
[Medium] chunk lines 481-500 in themes/src/main/resources/theme/base/login/messages/messages_en.properties:
webauthn-registration-init-label=Passkey (Default Label)
webauthn-registration-init-label-prompt=Please input your registered passkey''s label


# WebAuthn Error
webauthn-error-title=Passkey Error
webauthn-error-registration=Failed to register your Passkey.<br /> {0}
webauthn-error-api-get=Failed to authenticate by the Passkey.<br /> {0}
webauthn-error-different-user=First authenticated user is not the one authenticated by the Passkey.
webauthn-error-auth-verification=Passkey authentication resu
---
[Medium] chunk lines 521-537 in themes/src/main/resources/theme/base/login/messages/messages_en.properties:
access-denied-when-idp-auth=Access denied when authenticating with {0}

frontchannel-logout.title=Logging out
frontchannel-logout.message=You are logging out from following apps
logoutConfirmTitle=Logging out
logoutConfirmHeader=Do you want to log out?
doLogout=Logout

readOnlyUsernameMessage=You can''t update your username as it is read-only.
error-invalid-multivalued-size=Attribute {0} must have at least {1} and at most {2} {2,choice,0#values|1#value|1<values}.

organization.confirm-membership","VerifyMessageProperties (High), Pattern (Medium), Pattern (Medium), PolicyFactory (Medium), PolicyFactory (Medium), normalizeValue (Medium), containsHtml (Medium), santizeAnchors (Medium), getEnglishValue (Medium), verifySafeHtml (Medium), verify (Medium), verifyDuplicateKeysDetected (Medium), verifyIllegalHtmlTagDetected (Medium), verifyNoHtmlAllowed (Medium), verifyNoChangedAnchors (Medium), lines 101-101 (Medium), lines 1-18 (Medium), lines 181-200 (Medium), lines 1241-1260 (Medium), lines 3121-3140 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), VerifyMessagePropertiesTest (Medium), lines 141-160 (Medium), lines 101-120 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 461-480 (Medium), lines 421-440 (Medium), lines 461-480 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 441-460 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 381-400 (Medium), lines 401-420 (Medium), lines 381-400 (Medium), lines 361-380 (Medium), lines 461-480 (Medium), lines 481-500 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 481-500 (Medium), lines 61-80 (Medium), lines 61-80 (Medium), lines 501-501 (Medium), lines 121-140 (Medium), lines 461-480 (Medium), lines 21-40 (Medium), lines 61-80 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 461-480 (Medium), lines 61-69 (Medium), lines 481-500 (Medium), lines 521-537 (Medium), lines 101-112 (Low), lines 1-17 (Low), lines 1-17 (Low), lines 1-18 (Low), lines 1-17 (Low), lines 1-17 (Low), lines 1-17 (Low)",match,'santizeAnchors' matches entity 'santizeanchors'
keycloak,6,Add Groups resource type and scopes to authorization schema,Incorrect permission check in canManage() method,High,93,6,57,"class::ModelToRepresentation (server-spi-private/src/main/java/org/keycloak/models/utils/ModelToRepresentation.java) [Critical, score=1.00] | class::ApiUtil (test-framework/core/src/main/java/org/keycloak/testframework/util/ApiUtil.java) [Critical, score=1.00] | method::handleCreatedResponse (test-framework/core/src/main/java/org/keycloak/testframework/util/ApiUtil.java) [Critical, score=0.91] | method::searchForUser (rest/admin-ui-ext/src/main/java/org/keycloak/admin/ui/rest/BruteForceUsersResource.java) [Critical, score=0.70] | field::GroupRepresentation (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java) [High, score=0.51] | class::BruteForceUsersResource (rest/admin-ui-ext/src/main/java/org/keycloak/admin/ui/rest/BruteForceUsersResource.java) [High, score=0.51]","[Critical] class ModelToRepresentation in server-spi-private/src/main/java/org/keycloak/models/utils/ModelToRepresentation.java:
public class ModelToRepresentation {

    public static Set<String> REALM_EXCLUDED_ATTRIBUTES = new HashSet<>();
    static {
        REALM_EXCLUDED_ATTRIBUTES.add(""displayName"");
        REALM_EXCLUDED_ATTRIBUTES.add(""displayNameHtml"");
        REALM_EXCLUDED_ATTRIBUTES.add(""defaultSignatureAlgorithm"");
        REALM_EXCLUDED_ATTRIBUTES.add(""bruteForceProtected"");
        REALM_EXCLUDED_ATTRIBUTES.add(""permanentLockout"");
        REALM_EXCLUDED_ATTRIBUTES.add(""maxTemporaryLockouts"");
        REALM_EXCLUDED_ATTRIBUTES.add(""bruteForceStrategy"");
        REALM_EXCLUDED_ATTRIBUTES.add(""maxFailureWaitSeconds"");
        REALM_EXCLUDED_ATTRIBUTES.add(""waitIncrementSeconds"");
        REALM_EXCLUDED_ATTRIBUTES.add(""quickLoginCheckMilliSeconds"");
        REALM_EXCLUDED_ATTRIBUTES.add(""minimumQuickL
---
[Critical] class ApiUtil in test-framework/core/src/main/java/org/keycloak/testframework/util/ApiUtil.java:
public class ApiUtil {

    public static String handleCreatedResponse(Response response) {
        try (response) {
            Assertions.assertEquals(201, response.getStatus());
            String path = response.getLocation().getPath();
            return path.substring(path.lastIndexOf('/') + 1);
        }
    }

}
---
[Critical] method handleCreatedResponse in test-framework/core/src/main/java/org/keycloak/testframework/util/ApiUtil.java:
public static String handleCreatedResponse(Response response) {
        try (response) {
            Assertions.assertEquals(201, response.getStatus());
            String path = response.getLocation().getPath();
            return path.substring(path.lastIndexOf('/') + 1);
        }
    }
---
[Critical] method searchForUser in rest/admin-ui-ext/src/main/java/org/keycloak/admin/ui/rest/BruteForceUsersResource.java:
private Stream<BruteUser> searchForUser(Map<String, String> attributes, RealmModel realm, UserPermissionEvaluator usersEvaluator, Boolean briefRepresentation, Integer firstResult, Integer maxResults, Boolean includeServiceAccounts) {
        attributes.put(UserModel.INCLUDE_SERVICE_ACCOUNT, includeServiceAccounts.toString());

        Set<String> groupIds = auth.groups().getGroupIdsWithViewPermission();
        if (!groupIds.isEmpty()) {
            session.setAttribute(UserModel.GROUPS, groupIds);
        }

        return toRepresentation(realm, usersEvaluator, briefRepresentation, session.users().searchForUserStream(realm, attributes, firstResult, maxResults));
    }
---
[High] field GroupRepresentation in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
private final GroupRepresentation topGroup = new GroupRepresentation();
---
[High] class BruteForceUsersResource in rest/admin-ui-ext/src/main/java/org/keycloak/admin/ui/rest/BruteForceUsersResource.java:
public class BruteForceUsersResource {
    private static final Logger logger = Logger.getLogger(BruteForceUsersResource.class);
    private static final String SEARCH_ID_PARAMETER = ""id:"";
    private final KeycloakSession session;
    private final RealmModel realm;
    private final AdminPermissionEvaluator auth;

    public BruteForceUsersResource(KeycloakSession session, RealmModel realm, AdminPermissionEvaluator auth) {
        this.realm = realm;
        this.auth = auth;
        this.session = session;
    }

    @GET
    @Consumes({""application/json""})
    @Produces({""application/json""})
    @Operation(
            summary = ""Find all users and add if they are locked by brute force protection"",
            description = ""Same endpoint as the users search but added brute force prot","[Medium] class RealmAdminPermissionsConfig in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/RealmAdminPermissionsConfig.java:
public class RealmAdminPermissionsConfig implements RealmConfig {

    @Override
    public RealmConfigBuilder configure(RealmConfigBuilder realm) {
        realm.addUser(""myadmin"")
                .name(""My"", ""Admin"")
                .email(""myadmin@localhost"")
                .emailVerified()
                .password(""password"")
                .clientRoles(Constants.REALM_MANAGEMENT_CLIENT_ID, 
                        AdminRoles.QUERY_USERS,
                        AdminRoles.QUERY_GROUPS);

---
[Medium] method searchForUser in services/src/main/java/org/keycloak/services/resources/admin/UsersResource.java:
private Stream<UserRepresentation> searchForUser(Map<String, String> attributes, RealmModel realm, UserPermissionEvaluator usersEvaluator, Boolean briefRepresentation, Integer firstResult, Integer maxResults, Boolean includeServiceAccounts) {
        attributes.put(UserModel.INCLUDE_SERVICE_ACCOUNT, includeServiceAccounts.toString());

        Set<String> groupIds = auth.groups().getGroupIdsWithViewPermission();
        if (!groupIds.isEmpty()) {
            session.setAttribute(UserModel.GROUPS
---
[Medium] method createAllGroupsPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createAllGroupsPermission(UserPolicyRepresentation policy, Set<String> scopes) {
        return createAllPermission(client, AdminPermissionsSchema.GROUPS_RESOURCE_TYPE, policy, scopes);
    }
---
[Medium] method testViewGroups in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testViewGroups() {
        UserPolicyRepresentation policy = createUserPolicy(realm, client, ""Only My Admin User Policy"", realm.admin().users().search(""myadmin"").get(0).getId());

        // should not see the groups
        List<GroupRepresentation> search = realmAdminClient.realm(realm.getName()).groups().groups();
        assertThat(search, hasSize(0));

        // create group
        GroupRepresentation myGroup = new GroupRepresentation();
        myGroup.setName(""my_g
---
[Medium] method getSubGroups in services/src/main/java/org/keycloak/services/resources/admin/GroupResource.java:
@GET
    @Path(""children"")
    @NoCache
    @Produces(MediaType.APPLICATION_JSON)
    @Tag(name = KeycloakOpenAPI.Admin.Tags.GROUPS)
    @Operation( summary = ""Return a paginated list of subgroups that have a parent group corresponding to the group on the URL"")
    public Stream<GroupRepresentation> getSubGroups(
            @Parameter(description = ""A String representing either an exact group name or a partial name"") @QueryParam(""search"") String search,
            @Parameter(description = ""Boo
---
[Medium] method getGroups in services/src/main/java/org/keycloak/services/resources/admin/GroupsResource.java:
@GET
    @NoCache
    @Produces(MediaType.APPLICATION_JSON)
    @Tag(name = KeycloakOpenAPI.Admin.Tags.GROUPS)
    @Operation( summary = ""Get group hierarchy.  Only `name` and `id` are returned.  `subGroups` are only returned when using the `search` or `q` parameter. If none of these parameters is provided, the top-level groups are returned without `subGroups` being filled."")
    public Stream<GroupRepresentation> getGroups(@QueryParam(""search"") String search,
                                   
---
[Medium] interface GroupPermissionEvaluator in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionEvaluator.java:
public interface GroupPermissionEvaluator {

    /**
     * Returns {@code true} if the caller has at least one of {@link AdminRoles#QUERY_GROUPS},
     * {@link AdminRoles#MANAGE_USERS} or {@link AdminRoles#VIEW_USERS} roles.
     * <p/>
     * For V2 only: Also if it has a permission to {@link AdminPermissionsSchema#VIEW} or
     * {@link AdminPermissionsSchema#MANAGE} groups.
     */
    boolean canList();

    /**
     * Throws ForbiddenException if {@link #canList()} returns {@code false}.

---
[Medium] interface UserPermissionEvaluator in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionEvaluator.java:
public interface UserPermissionEvaluator {

    /**
     * Throws ForbiddenException if {@link #canManage()} returns {@code false}.
     */
    void requireManage();

    /**
     * Throws ForbiddenException if {@link #canManage(UserModel)} returns {@code false}.
     */
    void requireManage(UserModel user);

    /**
     * Returns {@code true} if the caller has {@link AdminRoles#MANAGE_USERS} role.
     * <p/>
     * Or if it has a permission to {@link AdminPermissionsSchema#MANAGE} users.
  
---
[Medium] method configure in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/RealmAdminPermissionsConfig.java:
@Override
    public RealmConfigBuilder configure(RealmConfigBuilder realm) {
        realm.addUser(""myadmin"")
                .name(""My"", ""Admin"")
                .email(""myadmin@localhost"")
                .emailVerified()
                .password(""password"")
                .clientRoles(Constants.REALM_MANAGEMENT_CLIENT_ID, 
                        AdminRoles.QUERY_USERS,
                        AdminRoles.QUERY_GROUPS);
        realm.addClient(""myclient"")
                .secret(""mysecret"")
---
[Medium] method createAllUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createAllUserPermission(UserPolicyRepresentation policy, Set<String> scopes) {
        return createAllPermission(client, AdminPermissionsSchema.USERS_RESOURCE_TYPE, policy, scopes);
    }
---
[Medium] method getUsersCount in services/src/main/java/org/keycloak/services/resources/admin/UsersResource.java:
@Path(""count"")
    @GET
    @NoCache
    @Produces(MediaType.APPLICATION_JSON)
    @Tag(name = KeycloakOpenAPI.Admin.Tags.USERS)
    @Operation(
            summary = ""Returns the number of users that match the given criteria."",
            description = ""It can be called in three different ways. "" +
                    ""1. Donâ€™t specify any criteria and pass {@code null}. The number of all users within that realm will be returned. <p> "" +
                    ""2. If {@code search} is specified o
---
[Medium] method addChild in services/src/main/java/org/keycloak/services/resources/admin/GroupResource.java:
@POST
    @Path(""children"")
    @NoCache
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    @Tag(name = KeycloakOpenAPI.Admin.Tags.GROUPS)
    @Operation( summary = ""Set or create child."", description = ""This will just set the parent if it exists. Create it and set the parent if the group doesnâ€™t exist."")
    public Response addChild(GroupRepresentation rep) {
        this.auth.groups().requireManage(group);

        String groupName = rep.getName();
        
---
[Medium] class UsersResource in services/src/main/java/org/keycloak/services/resources/admin/UsersResource.java:
@Extension(name = KeycloakOpenAPI.Profiles.ADMIN, value = """")
public class UsersResource {

    private static final Logger logger = Logger.getLogger(UsersResource.class);
    private static final String SEARCH_ID_PARAMETER = ""id:"";

    protected final RealmModel realm;

    private final AdminPermissionEvaluator auth;

    private final AdminEventBuilder adminEvent;

    protected final ClientConnection clientConnection;

    protected final KeycloakSession session;

    protected final HttpHe
---
[Medium] class AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public class AdminPermissionsSchema extends AuthorizationSchema {

    public static final String CLIENTS_RESOURCE_TYPE = ""Clients"";
    public static final String GROUPS_RESOURCE_TYPE = ""Groups"";
    public static final String USERS_RESOURCE_TYPE = ""Users"";

    // common scopes
    public static final String MANAGE = ""manage"";
    public static final String VIEW = ""view"";

    // client specific scopes
    public static final String CONFIGURE = ""configure"";
    public static final String MAP_R
---
[Medium] field ManagedUser in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@InjectUser(ref = ""alice"")
    ManagedUser userAlice;
---
[Medium] field Keycloak in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@InjectAdminClient(mode = InjectAdminClient.Mode.MANAGED_REALM, client = ""myclient"", user = ""myadmin"")
    Keycloak realmAdminClient;
---
[Medium] method onBefore in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@BeforeEach // cannot use @BeforeAll, realm is not initializaed yet
    public void onBefore() {
        topGroup.setName(groupName);
        try (Response response = realm.admin().groups().add(topGroup)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCode()));
            topGroup.setId(ApiUtil.handleCreatedResponse(response));
            realm.cleanup().add(r -> r.groups().group(topGroup.getId()).remove());
        }
        realm.admin().users().get(u
---
[Medium] method testCanViewUserByViewGroupMembers in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testCanViewUserByViewGroupMembers() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client, ""Only My Admin User Policy"", myadmin.getId());

        // my admin should NOT be able to see Alice
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().search(null, -1, -1);
        assertTrue(search.isEmpty());

        // all
---
[Medium] method testCanViewUserByManageGroupMembers in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testCanViewUserByManageGroupMembers() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client, ""Only My Admin User Policy"", myadmin.getId());

        // my admin should NOT be able to see Alice
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().search(null, -1, -1);
        assertTrue(search.isEmpty());

        // m
---
[Medium] method testManageAllGroups in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testManageAllGroups() {
        // myadmin shouldn't be able to create groups just yet
        try (Response response = realmAdminClient.realm(realm.getName()).groups().add(new GroupRepresentation())) {
            assertEquals(Response.Status.FORBIDDEN.getStatusCode(), response.getStatus());
        }

        // myadmin shouldn't be able to add child for a group
        try (Response response = realmAdminClient.realm(realm.getName()).groups().group(topGroup.getId()).subGr
---
[Medium] method testManageGroup in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testManageGroup() {
        // create group
        GroupRepresentation myGroup = new GroupRepresentation();
        myGroup.setName(""my_group"");

        try (Response response = realm.admin().groups().add(myGroup)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCode()));
            myGroup.setId(ApiUtil.handleCreatedResponse(response));
            realm.cleanup().add(r -> r.groups().group(myGroup.getId()).remove());
        }

  
---
[Medium] method testManageGroupMembership in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testManageGroupMembership() {
        // myadmin shouldn't be able to manage group membership of the user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).joinGroup(""no-such"");
            fail(""Expected Exception wasn't thrown."");
        } catch (Exception ex) {
            assertThat(ex, instanceOf(ForbiddenException.class));
        }

        //create all-users permission for ""myadmin"" (so that myadmin can add us
---
[Medium] method searchGroupModelsByAttributes in server-spi-private/src/main/java/org/keycloak/models/utils/ModelToRepresentation.java:
public static Stream<GroupModel> searchGroupModelsByAttributes(KeycloakSession session, RealmModel realm, Map<String,String> attributes, Integer first, Integer max) {
        return session.groups().searchGroupsByAttributes(realm, attributes, first, max);
    }
---
[Medium] method getGroupsWithViewPermission in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionEvaluator.java:
boolean getGroupsWithViewPermission(GroupModel group);
---
[Medium] method getGroupsWithViewPermission in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionEvaluator.java:
Set<String> getGroupsWithViewPermission();
---
[Medium] method canManageDefault in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
public boolean canManageDefault() {
        return root.hasOneAdminRole(AdminRoles.MANAGE_USERS);
    }
---
[Medium] method canViewDefault in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
public boolean canViewDefault() {
        return root.hasOneAdminRole(AdminRoles.MANAGE_USERS, AdminRoles.VIEW_USERS);
    }
---
[Medium] method getOrCreateResource in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public Resource getOrCreateResource(KeycloakSession session, ResourceServer resourceServer, String policyType, String resourceType, String id) {
        if (!supportsAuthorizationSchema(session, resourceServer)) {
            return null;
        }

        StoreFactory storeFactory = getStoreFactory(session);
        ResourceStore resourceStore = storeFactory.getResourceStore();
        Resource resource = resourceStore.findById(resourceServer, id);

        if (resource != null) {
            
---
[Medium] class GroupResource in services/src/main/java/org/keycloak/services/resources/admin/GroupResource.java:
@Extension(name = KeycloakOpenAPI.Profiles.ADMIN, value = """")
public class GroupResource {

    private final RealmModel realm;
    private final KeycloakSession session;
    private final AdminPermissionEvaluator auth;
    private final AdminEventBuilder adminEvent;
    private final GroupModel group;

    public GroupResource(RealmModel realm, GroupModel group, KeycloakSession session, AdminPermissionEvaluator auth, AdminEventBuilder adminEvent) {
        this.realm = realm;
        this.sessi
---
[Medium] class GroupsResource in services/src/main/java/org/keycloak/services/resources/admin/GroupsResource.java:
@Extension(name = KeycloakOpenAPI.Profiles.ADMIN, value = """")
public class GroupsResource {

    private final RealmModel realm;
    private final KeycloakSession session;
    private final AdminPermissionEvaluator auth;
    private final AdminEventBuilder adminEvent;

    public GroupsResource(RealmModel realm, KeycloakSession session, AdminPermissionEvaluator auth, AdminEventBuilder adminEvent) {
        this.realm = realm;
        this.session = session;
        this.auth = auth;
        this
---
[Medium] class UserPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
class UserPermissions implements UserPermissionEvaluator, UserPermissionManagement {

    private static final String MAP_ROLES_SCOPE=""map-roles"";
    private static final String IMPERSONATE_SCOPE=""impersonate"";
    private static final String USER_IMPERSONATED_SCOPE=""user-impersonated"";
    private static final String MANAGE_GROUP_MEMBERSHIP_SCOPE=""manage-group-membership"";
    private static final String MAP_ROLES_PERMISSION_USERS = ""map-roles.permission.users"";
    private static final String
---
[Medium] method canViewByGroup in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
protected boolean canViewByGroup(UserModel user) {
        if (authz == null) return false;
        return evaluateHierarchy(user, root.groups()::canViewMembers);
    }
---
[Medium] method canManageByGroup in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
protected boolean canManageByGroup(UserModel user) {
        if (authz == null) return false;
        return evaluateHierarchy(user, root.groups()::canManageMembers);
    }
---
[Medium] constructor AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
private AdminPermissionsSchema() {
        super(Map.of(
            CLIENTS_RESOURCE_TYPE, CLIENTS,
            GROUPS_RESOURCE_TYPE, GROUPS,
            USERS_RESOURCE_TYPE, USERS
        ));
    }
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final String MANAGE_GROUP_MEMBERSHIP = ""manage-group-membership"";
---
[Medium] field ResourceType in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final ResourceType USERS = new ResourceType(USERS_RESOURCE_TYPE, Set.of(MANAGE, VIEW, IMPERSONATE, MAP_ROLES, MANAGE_GROUP_MEMBERSHIP));
---
[Medium] method registerListener in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public static void registerListener(ProviderEventManager manager) {
        if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ)) {
            manager.register(new ProviderEventListener() {
                @Override
                public void onEvent(ProviderEvent event) {
                    if (event instanceof RoleContainerModel.RoleRemovedEvent) {
                        RoleContainerModel.RoleRemovedEvent cast = (RoleContainerModel.RoleRemovedEvent) event;
              
---
[Medium] class AdminPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public class AdminPermissions {


    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ_V2)) {
            return new MgmtPermissionsV2(session, realm, auth);
        }
        return new MgmtPermissions(session, realm, auth);
    }
    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, RealmModel adminsRealm, UserModel
---
[Medium] class GroupPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
class GroupPermissions implements GroupPermissionEvaluator, GroupPermissionManagement {

    private static final String MANAGE_MEMBERSHIP_SCOPE = ""manage-membership"";
    private static final String MANAGE_MEMBERS_SCOPE = ""manage-members"";
    private static final String VIEW_MEMBERS_SCOPE = ""view-members"";
    private static final String RESOURCE_NAME_PREFIX = ""group.resource."";

    private final AuthorizationProvider authz;
    protected final MgmtPermissions root;
    protected final Resour
---
[Medium] field MgmtPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
protected final MgmtPermissions root;
---
[Medium] field ResourceStore in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
protected final ResourceStore resourceStore;
---
[Medium] method canList in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public boolean canList() {
        return root.hasOneAdminRole(AdminRoles.QUERY_GROUPS) || canView();
    }
---
[Medium] method canView in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public boolean canView() {
        return root.hasOneAdminRole(AdminRoles.MANAGE_USERS, AdminRoles.VIEW_USERS);
    }
---
[Medium] method requireViewMembers in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public void requireViewMembers(GroupModel group) {
        if (!canViewMembers(group)) {
            throw new ForbiddenException();
        }
    }
---
[Medium] field PolicyStore in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
protected final PolicyStore policyStore;
---
[Medium] method canManage in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public boolean canManage() {
        return root.hasOneAdminRole(AdminRoles.MANAGE_USERS);
    }
---
[Medium] method canViewMembers in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public boolean canViewMembers(GroupModel group) {
        if (root.users().canView()) return true;

        if (!root.isAdminSameRealm()) {
            return false;
        }

        ResourceServer server = root.realmResourceServer();
        if (server == null) return false;

        return hasPermission(group, VIEW_MEMBERS_SCOPE, MANAGE_MEMBERS_SCOPE);
    }
---
[Medium] class MgmtPermissionsV2 in services/src/main/java/org/keycloak/services/resources/admin/permissions/MgmtPermissionsV2.java:
class MgmtPermissionsV2 extends MgmtPermissions {

    private GroupPermissionsV2 groupPermissions;
    private UserPermissionsV2 userPermissions;

    private ClientPermissionsV2 clientPermissions;

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm) {
        super(session, realm);
    }

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        super(session, realm, auth);
    }

    public MgmtPermissionsV2(KeycloakSession session, 
---
[Medium] method canMapRole in services/src/main/java/org/keycloak/services/resources/admin/permissions/RolePermissions.java:
@Override
    public boolean canMapRole(RoleModel role) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS)) return checkAdminRoles(role);
        if (!root.isAdminSameRealm()) {
            return false;
        }

        if (role.getContainer() instanceof ClientModel) {
            if (root.clients().canMapRoles((ClientModel)role.getContainer())) return true;
        }
        if (!isPermissionsEnabled(role)){
            return false;
        }

        ResourceServer resourceServer 
---
[Medium] class RolePermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/RolePermissions.java:
class RolePermissions implements RolePermissionEvaluator, RolePermissionManagement {
    private static final Logger logger = Logger.getLogger(RolePermissions.class);
    protected final KeycloakSession session;
    protected final RealmModel realm;
    protected final AuthorizationProvider authz;
    protected final MgmtPermissions root;
    private final ResourceStore resourceStore;
    private static final String RESOURCE_NAME_PREFIX = ""role.resource."";

    public RolePermissions(KeycloakSes
---
[Medium] method isImpersonatable in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionEvaluator.java:
@Deprecated
    boolean isImpersonatable(UserModel user, ClientModel requester);
---
[Medium] method canQuery in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
@Override
    public boolean canQuery() {
        return root.hasOneAdminRole(AdminRoles.QUERY_USERS) || canView();
    }
---
[Medium] method canManageGroupMembership in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
@Override
    public boolean canManageGroupMembership(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.MANAGE, AdminPermissionsSchema.MANAGE_GROUP_MEMBERSHIP) || canManageByGroup(user);
    }
---
[Medium] method canView in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
@Override
    public boolean canView(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS, AdminRoles.VIEW_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.VIEW, AdminPermissionsSchema.MANAGE) || canViewByGroup(user);
    }
---
[Medium] method canMapRoles in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
@Override
    public boolean canMapRoles(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.MANAGE, AdminPermissionsSchema.MAP_ROLES) || canManageByGroup(user);
    }
---
[Medium] method canManage in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
@Override
    public boolean canManage(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.MANAGE) || canManageByGroup(user);
    }
---
[Medium] class UserPermissionsV2 in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
class UserPermissionsV2 extends UserPermissions {

    UserPermissionsV2(KeycloakSession session, AuthorizationProvider authz, MgmtPermissionsV2 root) {
        super(session, authz, root);
    }

    @Override
    public boolean canView(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS, AdminRoles.VIEW_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.VIEW, AdminPermissionsSchema.MANAGE) || canViewByGroup(user)","ModelToRepresentation (Critical), ApiUtil (Critical), handleCreatedResponse (Critical), searchForUser (Critical), GroupRepresentation (High), BruteForceUsersResource (High), RealmAdminPermissionsConfig (Medium), searchForUser (Medium), createAllGroupsPermission (Medium), testViewGroups (Medium), getSubGroups (Medium), getGroups (Medium), GroupPermissionEvaluator (Medium), UserPermissionEvaluator (Medium), configure (Medium), createAllUserPermission (Medium), getUsersCount (Medium), addChild (Medium), UsersResource (Medium), AdminPermissionsSchema (Medium), ManagedUser (Medium), Keycloak (Medium), onBefore (Medium), testCanViewUserByViewGroupMembers (Medium), testCanViewUserByManageGroupMembers (Medium), testManageAllGroups (Medium), testManageGroup (Medium), testManageGroupMembership (Medium), searchGroupModelsByAttributes (Medium), getGroupsWithViewPermission (Medium), getGroupsWithViewPermission (Medium), canManageDefault (Medium), canViewDefault (Medium), getOrCreateResource (Medium), GroupResource (Medium), GroupsResource (Medium), UserPermissions (Medium), canViewByGroup (Medium), canManageByGroup (Medium), AdminPermissionsSchema (Medium), String (Medium), ResourceType (Medium), registerListener (Medium), AdminPermissions (Medium), GroupPermissions (Medium), MgmtPermissions (Medium), ResourceStore (Medium), canList (Medium), canView (Medium), requireViewMembers (Medium), PolicyStore (Medium), canManage (Medium), canViewMembers (Medium), MgmtPermissionsV2 (Medium), canMapRole (Medium), RolePermissions (Medium), isImpersonatable (Medium), canQuery (Medium), canManageGroupMembership (Medium), canView (Medium), canMapRoles (Medium), canManage (Medium), UserPermissionsV2 (Medium), getGroupIdsWithViewPermission (Low), resolveGroup (Low), getGroupIdsWithViewPermission (Low), GroupPermissionsV2 (Low), KeycloakSession (Low), GroupPermissionsV2 (Low), canView (Low), canView (Low), canManage (Low), canManage (Low), canViewMembers (Low), canManageMembers (Low), canManageMembership (Low), getGroupIdsWithViewPermission (Low), hasPermission (Low), isPermissionsEnabled (Low), setPermissionsEnabled (Low), viewMembersPermission (Low), manageMembersPermission (Low), manageMembershipPermission (Low), viewPermission (Low), managePermission (Low), resource (Low), getPermissions (Low), GroupPermissionsV2 (Low), groups (Low), GroupResourceTypeEvaluationTest (Low), String (Low), onAfter (Low), createGroupPermission (Low)",partial,permission code is in HC but canManage() specifically not identified by name
keycloak,6,Add Groups resource type and scopes to authorization schema,"In getGroupIdsWithViewPermission, hasPermission is called with groupResource.getId() and the same groupResource.getId() is added to granted, but hasPermission resolves resources by name (treating the argument as a group id) and the GroupPermissionEvaluator contract says this method returns group IDs that are later used as UserModel.GROUPS and in getUsersCount group filters. This mismatch means per-group VIEW_MEMBERS/MANAGE_MEMBERS permissions may not yield the expected group IDs for filtering and counts, and evaluation may effectively only look at the type-level 'all-groups' resource; consider revisiting whether this should operate on the underlying group ids (resource names) instead so it aligns with the JPA queries and the interface contract.",High,93,6,57,"class::ModelToRepresentation (server-spi-private/src/main/java/org/keycloak/models/utils/ModelToRepresentation.java) [Critical, score=1.00] | class::ApiUtil (test-framework/core/src/main/java/org/keycloak/testframework/util/ApiUtil.java) [Critical, score=1.00] | method::handleCreatedResponse (test-framework/core/src/main/java/org/keycloak/testframework/util/ApiUtil.java) [Critical, score=0.91] | method::searchForUser (rest/admin-ui-ext/src/main/java/org/keycloak/admin/ui/rest/BruteForceUsersResource.java) [Critical, score=0.70] | field::GroupRepresentation (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java) [High, score=0.51] | class::BruteForceUsersResource (rest/admin-ui-ext/src/main/java/org/keycloak/admin/ui/rest/BruteForceUsersResource.java) [High, score=0.51]","[Critical] class ModelToRepresentation in server-spi-private/src/main/java/org/keycloak/models/utils/ModelToRepresentation.java:
public class ModelToRepresentation {

    public static Set<String> REALM_EXCLUDED_ATTRIBUTES = new HashSet<>();
    static {
        REALM_EXCLUDED_ATTRIBUTES.add(""displayName"");
        REALM_EXCLUDED_ATTRIBUTES.add(""displayNameHtml"");
        REALM_EXCLUDED_ATTRIBUTES.add(""defaultSignatureAlgorithm"");
        REALM_EXCLUDED_ATTRIBUTES.add(""bruteForceProtected"");
        REALM_EXCLUDED_ATTRIBUTES.add(""permanentLockout"");
        REALM_EXCLUDED_ATTRIBUTES.add(""maxTemporaryLockouts"");
        REALM_EXCLUDED_ATTRIBUTES.add(""bruteForceStrategy"");
        REALM_EXCLUDED_ATTRIBUTES.add(""maxFailureWaitSeconds"");
        REALM_EXCLUDED_ATTRIBUTES.add(""waitIncrementSeconds"");
        REALM_EXCLUDED_ATTRIBUTES.add(""quickLoginCheckMilliSeconds"");
        REALM_EXCLUDED_ATTRIBUTES.add(""minimumQuickL
---
[Critical] class ApiUtil in test-framework/core/src/main/java/org/keycloak/testframework/util/ApiUtil.java:
public class ApiUtil {

    public static String handleCreatedResponse(Response response) {
        try (response) {
            Assertions.assertEquals(201, response.getStatus());
            String path = response.getLocation().getPath();
            return path.substring(path.lastIndexOf('/') + 1);
        }
    }

}
---
[Critical] method handleCreatedResponse in test-framework/core/src/main/java/org/keycloak/testframework/util/ApiUtil.java:
public static String handleCreatedResponse(Response response) {
        try (response) {
            Assertions.assertEquals(201, response.getStatus());
            String path = response.getLocation().getPath();
            return path.substring(path.lastIndexOf('/') + 1);
        }
    }
---
[Critical] method searchForUser in rest/admin-ui-ext/src/main/java/org/keycloak/admin/ui/rest/BruteForceUsersResource.java:
private Stream<BruteUser> searchForUser(Map<String, String> attributes, RealmModel realm, UserPermissionEvaluator usersEvaluator, Boolean briefRepresentation, Integer firstResult, Integer maxResults, Boolean includeServiceAccounts) {
        attributes.put(UserModel.INCLUDE_SERVICE_ACCOUNT, includeServiceAccounts.toString());

        Set<String> groupIds = auth.groups().getGroupIdsWithViewPermission();
        if (!groupIds.isEmpty()) {
            session.setAttribute(UserModel.GROUPS, groupIds);
        }

        return toRepresentation(realm, usersEvaluator, briefRepresentation, session.users().searchForUserStream(realm, attributes, firstResult, maxResults));
    }
---
[High] field GroupRepresentation in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
private final GroupRepresentation topGroup = new GroupRepresentation();
---
[High] class BruteForceUsersResource in rest/admin-ui-ext/src/main/java/org/keycloak/admin/ui/rest/BruteForceUsersResource.java:
public class BruteForceUsersResource {
    private static final Logger logger = Logger.getLogger(BruteForceUsersResource.class);
    private static final String SEARCH_ID_PARAMETER = ""id:"";
    private final KeycloakSession session;
    private final RealmModel realm;
    private final AdminPermissionEvaluator auth;

    public BruteForceUsersResource(KeycloakSession session, RealmModel realm, AdminPermissionEvaluator auth) {
        this.realm = realm;
        this.auth = auth;
        this.session = session;
    }

    @GET
    @Consumes({""application/json""})
    @Produces({""application/json""})
    @Operation(
            summary = ""Find all users and add if they are locked by brute force protection"",
            description = ""Same endpoint as the users search but added brute force prot","[Medium] class RealmAdminPermissionsConfig in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/RealmAdminPermissionsConfig.java:
public class RealmAdminPermissionsConfig implements RealmConfig {

    @Override
    public RealmConfigBuilder configure(RealmConfigBuilder realm) {
        realm.addUser(""myadmin"")
                .name(""My"", ""Admin"")
                .email(""myadmin@localhost"")
                .emailVerified()
                .password(""password"")
                .clientRoles(Constants.REALM_MANAGEMENT_CLIENT_ID, 
                        AdminRoles.QUERY_USERS,
                        AdminRoles.QUERY_GROUPS);

---
[Medium] method searchForUser in services/src/main/java/org/keycloak/services/resources/admin/UsersResource.java:
private Stream<UserRepresentation> searchForUser(Map<String, String> attributes, RealmModel realm, UserPermissionEvaluator usersEvaluator, Boolean briefRepresentation, Integer firstResult, Integer maxResults, Boolean includeServiceAccounts) {
        attributes.put(UserModel.INCLUDE_SERVICE_ACCOUNT, includeServiceAccounts.toString());

        Set<String> groupIds = auth.groups().getGroupIdsWithViewPermission();
        if (!groupIds.isEmpty()) {
            session.setAttribute(UserModel.GROUPS
---
[Medium] method createAllGroupsPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createAllGroupsPermission(UserPolicyRepresentation policy, Set<String> scopes) {
        return createAllPermission(client, AdminPermissionsSchema.GROUPS_RESOURCE_TYPE, policy, scopes);
    }
---
[Medium] method testViewGroups in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testViewGroups() {
        UserPolicyRepresentation policy = createUserPolicy(realm, client, ""Only My Admin User Policy"", realm.admin().users().search(""myadmin"").get(0).getId());

        // should not see the groups
        List<GroupRepresentation> search = realmAdminClient.realm(realm.getName()).groups().groups();
        assertThat(search, hasSize(0));

        // create group
        GroupRepresentation myGroup = new GroupRepresentation();
        myGroup.setName(""my_g
---
[Medium] method getSubGroups in services/src/main/java/org/keycloak/services/resources/admin/GroupResource.java:
@GET
    @Path(""children"")
    @NoCache
    @Produces(MediaType.APPLICATION_JSON)
    @Tag(name = KeycloakOpenAPI.Admin.Tags.GROUPS)
    @Operation( summary = ""Return a paginated list of subgroups that have a parent group corresponding to the group on the URL"")
    public Stream<GroupRepresentation> getSubGroups(
            @Parameter(description = ""A String representing either an exact group name or a partial name"") @QueryParam(""search"") String search,
            @Parameter(description = ""Boo
---
[Medium] method getGroups in services/src/main/java/org/keycloak/services/resources/admin/GroupsResource.java:
@GET
    @NoCache
    @Produces(MediaType.APPLICATION_JSON)
    @Tag(name = KeycloakOpenAPI.Admin.Tags.GROUPS)
    @Operation( summary = ""Get group hierarchy.  Only `name` and `id` are returned.  `subGroups` are only returned when using the `search` or `q` parameter. If none of these parameters is provided, the top-level groups are returned without `subGroups` being filled."")
    public Stream<GroupRepresentation> getGroups(@QueryParam(""search"") String search,
                                   
---
[Medium] interface GroupPermissionEvaluator in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionEvaluator.java:
public interface GroupPermissionEvaluator {

    /**
     * Returns {@code true} if the caller has at least one of {@link AdminRoles#QUERY_GROUPS},
     * {@link AdminRoles#MANAGE_USERS} or {@link AdminRoles#VIEW_USERS} roles.
     * <p/>
     * For V2 only: Also if it has a permission to {@link AdminPermissionsSchema#VIEW} or
     * {@link AdminPermissionsSchema#MANAGE} groups.
     */
    boolean canList();

    /**
     * Throws ForbiddenException if {@link #canList()} returns {@code false}.

---
[Medium] interface UserPermissionEvaluator in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionEvaluator.java:
public interface UserPermissionEvaluator {

    /**
     * Throws ForbiddenException if {@link #canManage()} returns {@code false}.
     */
    void requireManage();

    /**
     * Throws ForbiddenException if {@link #canManage(UserModel)} returns {@code false}.
     */
    void requireManage(UserModel user);

    /**
     * Returns {@code true} if the caller has {@link AdminRoles#MANAGE_USERS} role.
     * <p/>
     * Or if it has a permission to {@link AdminPermissionsSchema#MANAGE} users.
  
---
[Medium] method configure in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/RealmAdminPermissionsConfig.java:
@Override
    public RealmConfigBuilder configure(RealmConfigBuilder realm) {
        realm.addUser(""myadmin"")
                .name(""My"", ""Admin"")
                .email(""myadmin@localhost"")
                .emailVerified()
                .password(""password"")
                .clientRoles(Constants.REALM_MANAGEMENT_CLIENT_ID, 
                        AdminRoles.QUERY_USERS,
                        AdminRoles.QUERY_GROUPS);
        realm.addClient(""myclient"")
                .secret(""mysecret"")
---
[Medium] method createAllUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createAllUserPermission(UserPolicyRepresentation policy, Set<String> scopes) {
        return createAllPermission(client, AdminPermissionsSchema.USERS_RESOURCE_TYPE, policy, scopes);
    }
---
[Medium] method getUsersCount in services/src/main/java/org/keycloak/services/resources/admin/UsersResource.java:
@Path(""count"")
    @GET
    @NoCache
    @Produces(MediaType.APPLICATION_JSON)
    @Tag(name = KeycloakOpenAPI.Admin.Tags.USERS)
    @Operation(
            summary = ""Returns the number of users that match the given criteria."",
            description = ""It can be called in three different ways. "" +
                    ""1. Donâ€™t specify any criteria and pass {@code null}. The number of all users within that realm will be returned. <p> "" +
                    ""2. If {@code search} is specified o
---
[Medium] method addChild in services/src/main/java/org/keycloak/services/resources/admin/GroupResource.java:
@POST
    @Path(""children"")
    @NoCache
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    @Tag(name = KeycloakOpenAPI.Admin.Tags.GROUPS)
    @Operation( summary = ""Set or create child."", description = ""This will just set the parent if it exists. Create it and set the parent if the group doesnâ€™t exist."")
    public Response addChild(GroupRepresentation rep) {
        this.auth.groups().requireManage(group);

        String groupName = rep.getName();
        
---
[Medium] class UsersResource in services/src/main/java/org/keycloak/services/resources/admin/UsersResource.java:
@Extension(name = KeycloakOpenAPI.Profiles.ADMIN, value = """")
public class UsersResource {

    private static final Logger logger = Logger.getLogger(UsersResource.class);
    private static final String SEARCH_ID_PARAMETER = ""id:"";

    protected final RealmModel realm;

    private final AdminPermissionEvaluator auth;

    private final AdminEventBuilder adminEvent;

    protected final ClientConnection clientConnection;

    protected final KeycloakSession session;

    protected final HttpHe
---
[Medium] class AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public class AdminPermissionsSchema extends AuthorizationSchema {

    public static final String CLIENTS_RESOURCE_TYPE = ""Clients"";
    public static final String GROUPS_RESOURCE_TYPE = ""Groups"";
    public static final String USERS_RESOURCE_TYPE = ""Users"";

    // common scopes
    public static final String MANAGE = ""manage"";
    public static final String VIEW = ""view"";

    // client specific scopes
    public static final String CONFIGURE = ""configure"";
    public static final String MAP_R
---
[Medium] field ManagedUser in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@InjectUser(ref = ""alice"")
    ManagedUser userAlice;
---
[Medium] field Keycloak in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@InjectAdminClient(mode = InjectAdminClient.Mode.MANAGED_REALM, client = ""myclient"", user = ""myadmin"")
    Keycloak realmAdminClient;
---
[Medium] method onBefore in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@BeforeEach // cannot use @BeforeAll, realm is not initializaed yet
    public void onBefore() {
        topGroup.setName(groupName);
        try (Response response = realm.admin().groups().add(topGroup)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCode()));
            topGroup.setId(ApiUtil.handleCreatedResponse(response));
            realm.cleanup().add(r -> r.groups().group(topGroup.getId()).remove());
        }
        realm.admin().users().get(u
---
[Medium] method testCanViewUserByViewGroupMembers in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testCanViewUserByViewGroupMembers() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client, ""Only My Admin User Policy"", myadmin.getId());

        // my admin should NOT be able to see Alice
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().search(null, -1, -1);
        assertTrue(search.isEmpty());

        // all
---
[Medium] method testCanViewUserByManageGroupMembers in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testCanViewUserByManageGroupMembers() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client, ""Only My Admin User Policy"", myadmin.getId());

        // my admin should NOT be able to see Alice
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().search(null, -1, -1);
        assertTrue(search.isEmpty());

        // m
---
[Medium] method testManageAllGroups in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testManageAllGroups() {
        // myadmin shouldn't be able to create groups just yet
        try (Response response = realmAdminClient.realm(realm.getName()).groups().add(new GroupRepresentation())) {
            assertEquals(Response.Status.FORBIDDEN.getStatusCode(), response.getStatus());
        }

        // myadmin shouldn't be able to add child for a group
        try (Response response = realmAdminClient.realm(realm.getName()).groups().group(topGroup.getId()).subGr
---
[Medium] method testManageGroup in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testManageGroup() {
        // create group
        GroupRepresentation myGroup = new GroupRepresentation();
        myGroup.setName(""my_group"");

        try (Response response = realm.admin().groups().add(myGroup)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCode()));
            myGroup.setId(ApiUtil.handleCreatedResponse(response));
            realm.cleanup().add(r -> r.groups().group(myGroup.getId()).remove());
        }

  
---
[Medium] method testManageGroupMembership in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/GroupResourceTypeEvaluationTest.java:
@Test
    public void testManageGroupMembership() {
        // myadmin shouldn't be able to manage group membership of the user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).joinGroup(""no-such"");
            fail(""Expected Exception wasn't thrown."");
        } catch (Exception ex) {
            assertThat(ex, instanceOf(ForbiddenException.class));
        }

        //create all-users permission for ""myadmin"" (so that myadmin can add us
---
[Medium] method searchGroupModelsByAttributes in server-spi-private/src/main/java/org/keycloak/models/utils/ModelToRepresentation.java:
public static Stream<GroupModel> searchGroupModelsByAttributes(KeycloakSession session, RealmModel realm, Map<String,String> attributes, Integer first, Integer max) {
        return session.groups().searchGroupsByAttributes(realm, attributes, first, max);
    }
---
[Medium] method getGroupsWithViewPermission in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionEvaluator.java:
boolean getGroupsWithViewPermission(GroupModel group);
---
[Medium] method getGroupsWithViewPermission in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionEvaluator.java:
Set<String> getGroupsWithViewPermission();
---
[Medium] method canManageDefault in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
public boolean canManageDefault() {
        return root.hasOneAdminRole(AdminRoles.MANAGE_USERS);
    }
---
[Medium] method canViewDefault in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
public boolean canViewDefault() {
        return root.hasOneAdminRole(AdminRoles.MANAGE_USERS, AdminRoles.VIEW_USERS);
    }
---
[Medium] method getOrCreateResource in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public Resource getOrCreateResource(KeycloakSession session, ResourceServer resourceServer, String policyType, String resourceType, String id) {
        if (!supportsAuthorizationSchema(session, resourceServer)) {
            return null;
        }

        StoreFactory storeFactory = getStoreFactory(session);
        ResourceStore resourceStore = storeFactory.getResourceStore();
        Resource resource = resourceStore.findById(resourceServer, id);

        if (resource != null) {
            
---
[Medium] class GroupResource in services/src/main/java/org/keycloak/services/resources/admin/GroupResource.java:
@Extension(name = KeycloakOpenAPI.Profiles.ADMIN, value = """")
public class GroupResource {

    private final RealmModel realm;
    private final KeycloakSession session;
    private final AdminPermissionEvaluator auth;
    private final AdminEventBuilder adminEvent;
    private final GroupModel group;

    public GroupResource(RealmModel realm, GroupModel group, KeycloakSession session, AdminPermissionEvaluator auth, AdminEventBuilder adminEvent) {
        this.realm = realm;
        this.sessi
---
[Medium] class GroupsResource in services/src/main/java/org/keycloak/services/resources/admin/GroupsResource.java:
@Extension(name = KeycloakOpenAPI.Profiles.ADMIN, value = """")
public class GroupsResource {

    private final RealmModel realm;
    private final KeycloakSession session;
    private final AdminPermissionEvaluator auth;
    private final AdminEventBuilder adminEvent;

    public GroupsResource(RealmModel realm, KeycloakSession session, AdminPermissionEvaluator auth, AdminEventBuilder adminEvent) {
        this.realm = realm;
        this.session = session;
        this.auth = auth;
        this
---
[Medium] class UserPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
class UserPermissions implements UserPermissionEvaluator, UserPermissionManagement {

    private static final String MAP_ROLES_SCOPE=""map-roles"";
    private static final String IMPERSONATE_SCOPE=""impersonate"";
    private static final String USER_IMPERSONATED_SCOPE=""user-impersonated"";
    private static final String MANAGE_GROUP_MEMBERSHIP_SCOPE=""manage-group-membership"";
    private static final String MAP_ROLES_PERMISSION_USERS = ""map-roles.permission.users"";
    private static final String
---
[Medium] method canViewByGroup in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
protected boolean canViewByGroup(UserModel user) {
        if (authz == null) return false;
        return evaluateHierarchy(user, root.groups()::canViewMembers);
    }
---
[Medium] method canManageByGroup in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
protected boolean canManageByGroup(UserModel user) {
        if (authz == null) return false;
        return evaluateHierarchy(user, root.groups()::canManageMembers);
    }
---
[Medium] constructor AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
private AdminPermissionsSchema() {
        super(Map.of(
            CLIENTS_RESOURCE_TYPE, CLIENTS,
            GROUPS_RESOURCE_TYPE, GROUPS,
            USERS_RESOURCE_TYPE, USERS
        ));
    }
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final String MANAGE_GROUP_MEMBERSHIP = ""manage-group-membership"";
---
[Medium] field ResourceType in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final ResourceType USERS = new ResourceType(USERS_RESOURCE_TYPE, Set.of(MANAGE, VIEW, IMPERSONATE, MAP_ROLES, MANAGE_GROUP_MEMBERSHIP));
---
[Medium] method registerListener in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public static void registerListener(ProviderEventManager manager) {
        if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ)) {
            manager.register(new ProviderEventListener() {
                @Override
                public void onEvent(ProviderEvent event) {
                    if (event instanceof RoleContainerModel.RoleRemovedEvent) {
                        RoleContainerModel.RoleRemovedEvent cast = (RoleContainerModel.RoleRemovedEvent) event;
              
---
[Medium] class AdminPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public class AdminPermissions {


    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ_V2)) {
            return new MgmtPermissionsV2(session, realm, auth);
        }
        return new MgmtPermissions(session, realm, auth);
    }
    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, RealmModel adminsRealm, UserModel
---
[Medium] class GroupPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
class GroupPermissions implements GroupPermissionEvaluator, GroupPermissionManagement {

    private static final String MANAGE_MEMBERSHIP_SCOPE = ""manage-membership"";
    private static final String MANAGE_MEMBERS_SCOPE = ""manage-members"";
    private static final String VIEW_MEMBERS_SCOPE = ""view-members"";
    private static final String RESOURCE_NAME_PREFIX = ""group.resource."";

    private final AuthorizationProvider authz;
    protected final MgmtPermissions root;
    protected final Resour
---
[Medium] field MgmtPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
protected final MgmtPermissions root;
---
[Medium] field ResourceStore in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
protected final ResourceStore resourceStore;
---
[Medium] method canList in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public boolean canList() {
        return root.hasOneAdminRole(AdminRoles.QUERY_GROUPS) || canView();
    }
---
[Medium] method canView in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public boolean canView() {
        return root.hasOneAdminRole(AdminRoles.MANAGE_USERS, AdminRoles.VIEW_USERS);
    }
---
[Medium] method requireViewMembers in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public void requireViewMembers(GroupModel group) {
        if (!canViewMembers(group)) {
            throw new ForbiddenException();
        }
    }
---
[Medium] field PolicyStore in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
protected final PolicyStore policyStore;
---
[Medium] method canManage in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public boolean canManage() {
        return root.hasOneAdminRole(AdminRoles.MANAGE_USERS);
    }
---
[Medium] method canViewMembers in services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissions.java:
@Override
    public boolean canViewMembers(GroupModel group) {
        if (root.users().canView()) return true;

        if (!root.isAdminSameRealm()) {
            return false;
        }

        ResourceServer server = root.realmResourceServer();
        if (server == null) return false;

        return hasPermission(group, VIEW_MEMBERS_SCOPE, MANAGE_MEMBERS_SCOPE);
    }
---
[Medium] class MgmtPermissionsV2 in services/src/main/java/org/keycloak/services/resources/admin/permissions/MgmtPermissionsV2.java:
class MgmtPermissionsV2 extends MgmtPermissions {

    private GroupPermissionsV2 groupPermissions;
    private UserPermissionsV2 userPermissions;

    private ClientPermissionsV2 clientPermissions;

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm) {
        super(session, realm);
    }

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        super(session, realm, auth);
    }

    public MgmtPermissionsV2(KeycloakSession session, 
---
[Medium] method canMapRole in services/src/main/java/org/keycloak/services/resources/admin/permissions/RolePermissions.java:
@Override
    public boolean canMapRole(RoleModel role) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS)) return checkAdminRoles(role);
        if (!root.isAdminSameRealm()) {
            return false;
        }

        if (role.getContainer() instanceof ClientModel) {
            if (root.clients().canMapRoles((ClientModel)role.getContainer())) return true;
        }
        if (!isPermissionsEnabled(role)){
            return false;
        }

        ResourceServer resourceServer 
---
[Medium] class RolePermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/RolePermissions.java:
class RolePermissions implements RolePermissionEvaluator, RolePermissionManagement {
    private static final Logger logger = Logger.getLogger(RolePermissions.class);
    protected final KeycloakSession session;
    protected final RealmModel realm;
    protected final AuthorizationProvider authz;
    protected final MgmtPermissions root;
    private final ResourceStore resourceStore;
    private static final String RESOURCE_NAME_PREFIX = ""role.resource."";

    public RolePermissions(KeycloakSes
---
[Medium] method isImpersonatable in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionEvaluator.java:
@Deprecated
    boolean isImpersonatable(UserModel user, ClientModel requester);
---
[Medium] method canQuery in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissions.java:
@Override
    public boolean canQuery() {
        return root.hasOneAdminRole(AdminRoles.QUERY_USERS) || canView();
    }
---
[Medium] method canManageGroupMembership in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
@Override
    public boolean canManageGroupMembership(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.MANAGE, AdminPermissionsSchema.MANAGE_GROUP_MEMBERSHIP) || canManageByGroup(user);
    }
---
[Medium] method canView in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
@Override
    public boolean canView(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS, AdminRoles.VIEW_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.VIEW, AdminPermissionsSchema.MANAGE) || canViewByGroup(user);
    }
---
[Medium] method canMapRoles in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
@Override
    public boolean canMapRoles(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.MANAGE, AdminPermissionsSchema.MAP_ROLES) || canManageByGroup(user);
    }
---
[Medium] method canManage in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
@Override
    public boolean canManage(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.MANAGE) || canManageByGroup(user);
    }
---
[Medium] class UserPermissionsV2 in services/src/main/java/org/keycloak/services/resources/admin/permissions/UserPermissionsV2.java:
class UserPermissionsV2 extends UserPermissions {

    UserPermissionsV2(KeycloakSession session, AuthorizationProvider authz, MgmtPermissionsV2 root) {
        super(session, authz, root);
    }

    @Override
    public boolean canView(UserModel user) {
        if (root.hasOneAdminRole(AdminRoles.MANAGE_USERS, AdminRoles.VIEW_USERS)) {
            return true;
        }

        return hasPermission(user, null, AdminPermissionsSchema.VIEW, AdminPermissionsSchema.MANAGE) || canViewByGroup(user)","ModelToRepresentation (Critical), ApiUtil (Critical), handleCreatedResponse (Critical), searchForUser (Critical), GroupRepresentation (High), BruteForceUsersResource (High), RealmAdminPermissionsConfig (Medium), searchForUser (Medium), createAllGroupsPermission (Medium), testViewGroups (Medium), getSubGroups (Medium), getGroups (Medium), GroupPermissionEvaluator (Medium), UserPermissionEvaluator (Medium), configure (Medium), createAllUserPermission (Medium), getUsersCount (Medium), addChild (Medium), UsersResource (Medium), AdminPermissionsSchema (Medium), ManagedUser (Medium), Keycloak (Medium), onBefore (Medium), testCanViewUserByViewGroupMembers (Medium), testCanViewUserByManageGroupMembers (Medium), testManageAllGroups (Medium), testManageGroup (Medium), testManageGroupMembership (Medium), searchGroupModelsByAttributes (Medium), getGroupsWithViewPermission (Medium), getGroupsWithViewPermission (Medium), canManageDefault (Medium), canViewDefault (Medium), getOrCreateResource (Medium), GroupResource (Medium), GroupsResource (Medium), UserPermissions (Medium), canViewByGroup (Medium), canManageByGroup (Medium), AdminPermissionsSchema (Medium), String (Medium), ResourceType (Medium), registerListener (Medium), AdminPermissions (Medium), GroupPermissions (Medium), MgmtPermissions (Medium), ResourceStore (Medium), canList (Medium), canView (Medium), requireViewMembers (Medium), PolicyStore (Medium), canManage (Medium), canViewMembers (Medium), MgmtPermissionsV2 (Medium), canMapRole (Medium), RolePermissions (Medium), isImpersonatable (Medium), canQuery (Medium), canManageGroupMembership (Medium), canView (Medium), canMapRoles (Medium), canManage (Medium), UserPermissionsV2 (Medium), getGroupIdsWithViewPermission (Low), resolveGroup (Low), getGroupIdsWithViewPermission (Low), GroupPermissionsV2 (Low), KeycloakSession (Low), GroupPermissionsV2 (Low), canView (Low), canView (Low), canManage (Low), canManage (Low), canViewMembers (Low), canManageMembers (Low), canManageMembership (Low), getGroupIdsWithViewPermission (Low), hasPermission (Low), isPermissionsEnabled (Low), setPermissionsEnabled (Low), viewMembersPermission (Low), manageMembersPermission (Low), manageMembershipPermission (Low), viewPermission (Low), managePermission (Low), resource (Low), getPermissions (Low), GroupPermissionsV2 (Low), groups (Low), GroupResourceTypeEvaluationTest (Low), String (Low), onAfter (Low), createGroupPermission (Low)",partial,permission system is HC but specific method not matched by name
keycloak,5,Add Client resource type and scopes to authorization schema,"Inconsistent feature flag bug causing orphaned permissions. The AdminPermissions event listener, responsible for cleaning up permissions upon role, client, or group removal, is incorrectly guarded by the ADMIN_FINE_GRAINED_AUTHZ (V1) feature flag. This is inconsistent with other methods in the class that use ADMIN_FINE_GRAINED_AUTHZ_V2. Consequently, if ADMIN_FINE_GRAINED_AUTHZ_V2 is enabled but V1 is not, the permission cleanup logic will not execute, leading to orphaned permission data. Cleanup should occur regardless of which fine-grained authorization version is enabled.",High,92,7,39,"method::getScopePermissionsResource (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.84] | method::createAllPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.84] | class::AbstractPermissionTest (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.74] | method::createUserPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java) [High, score=0.61] | method::getPermissionsResource (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [High, score=0.58] | method::createPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [High, score=0.52] | method::createAllUserPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java) [High, score=0.51]","[Critical] method getScopePermissionsResource in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ScopePermissionsResource getScopePermissionsResource(ManagedClient client) {
        return getPermissionsResource(client).scope();
    }
---
[Critical] method createAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ScopePermissionRepresentation createAllPermission(ManagedClient client, String resourceType, AbstractPolicyRepresentation policy, Set<String> scopes) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(resourceType)
                .scopes(scopes)
                .addPolicies(List.of(policy.getName()))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[Critical] class AbstractPermissionTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
public abstract class AbstractPermissionTest {

    @InjectRealm(config = RealmAdminPermissionsConfig.class)
    ManagedRealm realm;

    @InjectClient(attachTo = Constants.ADMIN_PERMISSIONS_CLIENT_ID)
    ManagedClient client;

    protected static PermissionsResource getPermissionsResource(ManagedClient client) {
        return client.admin().authorization().permissions();
    }

    protected PoliciesResource getPolicies() {
        return client.admin().authorization().policies();
    }

    protected static ScopePermissionsResource getScopePermissionsResource(ManagedClient client) {
        return getPermissionsResource(client).scope();
    }

    protected static void createPermission(ManagedClient client, ScopePermissionRepresentation permission) {
        createPermission(client, p
---
[High] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
private ScopePermissionRepresentation createUserPermission(ManagedUser... users) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .resources(Arrays.stream(users).map(ManagedUser::getUsername).collect(Collectors.toSet()))
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .addPolicies(List.of(""User Policy 0"", ""User Policy 1"", ""User Policy 2""))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[High] method getPermissionsResource in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static PermissionsResource getPermissionsResource(ManagedClient client) {
        return client.admin().authorization().permissions();
    }
---
[High] method createPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected ScopePermissionRepresentation createPermission(ManagedClient client, Logic logic, String resourceId, String resourceType, Set<String> scopes, AbstractPolicyRepresentation... policies) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .logic(logic)
                .resourceType(resourceType)
                .scopes(scopes)
                .resources(Set.of(resourceId))
                .addPolicies(Arrays.stream(policies).map(AbstractPolicyRepresentation::getName).collect(Collectors.toList()))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[High] method createAllUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
private ScopePermissionRepresentation createAllUserPermission() {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .addPolicies(List.of(""User Policy 0"", ""User Policy 1"", ""User Policy 2""))
                .build();

        createPermission(client, permission);

        return permission;
    }","[Medium] method testManageUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageUserPermission() {
        String myadminId = realm.admin().users().search(""myadmin"").get(0).getId();
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", myadminId);
        ScopePermissionRepresentation allUsersPermission = createAllPermission(client, usersType, policy, Set.of(MANAGE));

        // creating user requires manage scope
        String newUserId = ApiUtil.handleCreatedResponse(realmAdminClient.realm(r
---
[Medium] method resourcesTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@Test
    public void resourcesTest() {
        ResourceRepresentation resourceRep = new ResourceRepresentation(""resource-1"", ""manage"");
        resourceRep.setType(AdminPermissionsSchema.USERS.getType());
        //it is not expected to create resources directly
        try (Response response = client.admin().authorization().resources().create(resourceRep)) {
            assertThat(response.getStatus(), equalTo(Response.Status.BAD_REQUEST.getStatusCode()));
        }
        
        ResourceRe
---
[Medium] method permissionsTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@Test
    public void permissionsTest() {
        // no resourceType, valid scopes
        createPermission(client, PermissionBuilder.create()
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .build(), Response.Status.BAD_REQUEST);

        // valid resourceType, no scopes
        createPermission(client, PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .build(), Response.Status.BAD_REQUEST);

      
---
[Medium] method testImpersonatePermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testImpersonatePermission() {
        // myadmin shouldn't be able to impersonate user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).impersonate();
            fail(""Expected Exception wasn't thrown."");
        } catch (Exception ex) {
            assertThat(ex, instanceOf(ForbiddenException.class));
        }

        //create all-users permission for ""myadmin"" (so that myadmin can impersonate all users in the rea
---
[Medium] method testViewAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewAllPermission() {
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", realm.admin().users().search(""myadmin"").get(0).getId());
        ScopePermissionRepresentation permission = createAllPermission(client, usersType, policy, Set.of(VIEW));
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().search(null, -1, -1);
        assertFalse(search.isEmpty());

        permission = client.
---
[Medium] method testManageGroupMembership in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageGroupMembership() {
        // myadmin shouldn't be able to manage group membership of the user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).joinGroup(""no-such"");
            fail(""Expected Exception wasn't thrown."");
        } catch (Exception ex) {
            assertThat(ex, instanceOf(ForbiddenException.class));
        }

        //create all-users permission for ""myadmin"" (so that myadmin can add us
---
[Medium] method testViewUserPermissionDenyByDefault in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewUserPermissionDenyByDefault() {
        String myadminId = realm.admin().users().search(""myadmin"").get(0).getId();
        UserPolicyRepresentation disallowMyAdmin = createUserPolicy(realm, client,""Not My Admin User Policy"", myadminId, Logic.NEGATIVE);
        createAllPermission(client, usersType, disallowMyAdmin, Set.of(VIEW));

        UserPolicyRepresentation allowAliceOnlyForMyAdmin = createUserPolicy(realm, client,""My Admin User Policy"", myadminId);
        cr
---
[Medium] method testViewUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewUserPermission() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client,""Only My Admin User Policy"", myadmin.getId());
        createAllPermission(client, usersType, allowMyAdminPermission, Set.of(VIEW));

        UserPolicyRepresentation denyMyAdminAccessingHisAccountPermission = createUserPolicy(realm, client,""Not My Admin User Policy"", myadmin.
---
[Medium] method testManageAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageAllPermission() {
        // myadmin shouldn't be able to create user just yet
        try (Response response = realmAdminClient.realm(realm.getName()).users().create(UserConfigBuilder.create().username(newUserUsername).build())) {
            assertEquals(Response.Status.FORBIDDEN.getStatusCode(), response.getStatus());
        }

        //create all-users permission for ""myadmin"" (so that myadmin can manage all users in the realm)
        UserPolicyRepresentati
---
[Medium] method testMapRoles in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testMapRoles() {
        RoleRepresentation testRole = new RoleRepresentation();
        testRole.setName(""testRole"");
        realm.admin().roles().create(testRole);
        realm.cleanup().add(r -> r.roles().get(""testRole"").remove());

        // myadmin shouldn't be able to map roles to the user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).roles().realmLevel().add(List.of(testRole));
            fail(""Expected 
---
[Medium] method testSingleUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testSingleUserPermission() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client, ""Only My Admin User Policy"", myadmin.getId());
        // allow my admin to see alice only
        createPermission(client, userAlice.admin().toRepresentation().getId(), usersType, Set.of(VIEW), allowMyAdminPermission);
        List<UserRepresentation> search = realmAdminCl
---
[Medium] method testFindByResourceObject in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testFindByResourceObject() {
        createUserPermission(userAlice, userBob);

        List<ScopePermissionRepresentation> existing = getScopePermissionsResource(client).findAll(null, null, userAlice.getId(), -1, -1);
        assertEquals(1, existing.size());
        existing = getScopePermissionsResource(client).findAll(null, null, userBob.getId(), -1, -1);
        assertEquals(1, existing.size());
    }
---
[Medium] method testDelete in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testDelete() {
        // only ""all-resource"" resources should be present
        List<ResourceRepresentation> resources = client.admin().authorization().resources().find(null, null, null, null, null, null, null);
        assertEquals(AdminPermissionsSchema.SCHEMA.getResourceTypes().entrySet().size(), resources.size());

        createUserPermission(userAlice);
        // resource for Alice should be created
        resources = client.admin().authorization().resources().fin
---
[Medium] method testCreateResourceTypePermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testCreateResourceTypePermission() {
        ScopePermissionRepresentation expected = createAllUserPermission();
        List<ScopePermissionRepresentation> result = getScopePermissionsResource(client).findAll(null, null, null, -1, -1);
        assertEquals(1, result.size());
        ScopePermissionRepresentation permissionRep = result.get(0);
        ScopePermissionResource permission = getScopePermissionsResource(client).findById(permissionRep.getId());
        assertEqua
---
[Medium] method testCreateResourceObjectPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testCreateResourceObjectPermission() {
        ScopePermissionRepresentation expected = createUserPermission(userAlice);
        List<ScopePermissionRepresentation> result = getScopePermissionsResource(client).findAll(null, null, null, -1, -1);
        assertEquals(1, result.size());
        ScopePermissionRepresentation permissionRep = result.get(0);
        ScopePermissionResource permission = getScopePermissionsResource(client).findById(permissionRep.getId());
        as
---
[Medium] method testUpdate in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testUpdate() {
        createUserPermission(userAlice, userBob);

        List<ScopePermissionRepresentation> searchByResourceAlice = getScopePermissionsResource(client).findAll(null, null, userAlice.getId(), -1, -1);
        assertThat(searchByResourceAlice, hasSize(1));
        List<ScopePermissionRepresentation> searchByResourceBob = getScopePermissionsResource(client).findAll(null, null, userBob.getId(), -1, -1);
        assertThat(searchByResourceBob, hasSize(1));

   
---
[Medium] class PermissionClientTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionClientTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class PermissionClientTest extends AbstractPermissionTest {

    @InjectAdminClient(mode = InjectAdminClient.Mode.MANAGED_REALM, client = ""myclient"", user = ""myadmin"")
    Keycloak realmAdminClient;

    @InjectClient(ref = ""realmClient"")
    ManagedClient realmClient;

    private final String clientsType = AdminPermissionsSchema.CLIENTS.getType();

    @AfterEach
    public void onAfter() {
        ScopePermis
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static UserPolicyRepresentation createUserPolicy(ManagedRealm realm, ManagedClient client, String name, String userId) {
        return createUserPolicy(realm, client, name, userId, Logic.POSITIVE);
    }
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static UserPolicyRepresentation createUserPolicy(ManagedRealm realm, ManagedClient client, String name, String userId, Logic logic) {
        UserPolicyRepresentation policy = new UserPolicyRepresentation();
        policy.setName(name);
        policy.addUser(userId);
        policy.setLogic(logic);
        try (Response response = client.admin().authorization().policies().user().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCo
---
[Medium] method createClientPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ClientPolicyRepresentation createClientPolicy(ManagedRealm realm, ManagedClient client, String name, String clientId) {
        ClientPolicyRepresentation policy = new ClientPolicyRepresentation();
        policy.setName(name);
        policy.addClient(clientId);
        policy.setLogic(Logic.POSITIVE);
        try (Response response = client.admin().authorization().policies().client().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private UserPolicyRepresentation createUserPolicy(String name, String userId) {
        return createUserPolicy(name, userId, Logic.POSITIVE);
    }
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private UserPolicyRepresentation createUserPolicy(String name, String userId, Logic logic) {
        UserPolicyRepresentation policy = new UserPolicyRepresentation();
        policy.setName(name);
        policy.addUser(userId);
        policy.setLogic(logic);
        try (Response response = client.admin().authorization().policies().user().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCode()));
            realm.cleanup().add(r -> {
    
---
[Medium] method createAllUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createAllUserPermission(UserPolicyRepresentation policy, Set<String> scopes) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(scopes)
                .addPolicies(List.of(policy.getName()))
                .build();

        createPermission(permission);

        return permission;
    }
---
[Medium] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createUserPermission(UserRepresentation user, Set<String> scopes, UserPolicyRepresentation... policies) {
        return createUserPermission(Logic.POSITIVE, user, scopes, policies);
    }
---
[Medium] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createUserPermission(Logic logic, UserRepresentation user, Set<String> scopes, UserPolicyRepresentation... policies) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .logic(logic)
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(scopes)
                .resources(Set.of(user.getId()))
                .addPolicies(Arrays.asList(policies).stream().map(AbstractPolicyRepr
---
[Medium] class UserResourceTypeEvaluationTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class UserResourceTypeEvaluationTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    ManagedUser userAlice;

    @InjectAdminClient(mode = InjectAdminClient.Mode.MANAGED_REALM, client = ""myclient"", user = ""myadmin"")
    Keycloak realmAdminClient;

    private final String usersType = AdminPermissionsSchema.USERS.getType();

    private final String newUserUsername = ""new_user"";

    @AfterEa
---
[Medium] class AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public class AdminPermissionsSchema extends AuthorizationSchema {
    
    public static final String USERS_RESOURCE_TYPE = ""Users"";
    public static final String CLIENTS_RESOURCE_TYPE = ""Clients"";

    //scopes
    public static final String MANAGE = ""manage"";
    public static final String VIEW = ""view"";
    public static final String IMPERSONATE = ""impersonate"";
    public static final String MAP_ROLES = ""map-roles"";
    public static final String MANAGE_GROUP_MEMBERSHIP = ""manage-group-memb
---
[Medium] method getOrCreateResource in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public Resource getOrCreateResource(KeycloakSession session, ResourceServer resourceServer, String policyType, String resourceType, String id) {
        if (!supportsAuthorizationSchema(session, resourceServer)) {
            return null;
        }

        StoreFactory storeFactory = getStoreFactory(session);
        ResourceStore resourceStore = storeFactory.getResourceStore();
        Resource resource = resourceStore.findById(resourceServer, id);

        if (resource != null) {
            
---
[Medium] field ResourceType in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final ResourceType CLIENTS = new ResourceType(CLIENTS_RESOURCE_TYPE, Set.of(CONFIGURE, MANAGE, MAP_ROLES, MAP_ROLES_CLIENT_SCOPE, MAP_ROLES_COMPOSITE, VIEW));
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final String MAP_ROLES_COMPOSITE = ""map-roles-composite"";
---
[Medium] constructor AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
private AdminPermissionsSchema() {
        super(Map.of(USERS_RESOURCE_TYPE, USERS, CLIENTS_RESOURCE_TYPE, CLIENTS));
    }
---
[Medium] class AdminPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public class AdminPermissions {


    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ_V2)) {
            return new MgmtPermissionsV2(session, realm, auth);
        }
        return new MgmtPermissions(session, realm, auth);
    }
    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, RealmModel adminsRealm, UserModel
---
[Medium] method registerListener in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public static void registerListener(ProviderEventManager manager) {
        manager.register(new ProviderEventListener() {
            @Override
            public void onEvent(ProviderEvent event) {
                if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ)) {
                    if (event instanceof RoleContainerModel.RoleRemovedEvent) {
                        RoleContainerModel.RoleRemovedEvent cast = (RoleContainerModel.RoleRemovedEvent) event;
                  
---
[Medium] class MgmtPermissionsV2 in services/src/main/java/org/keycloak/services/resources/admin/permissions/MgmtPermissionsV2.java:
class MgmtPermissionsV2 extends MgmtPermissions {

    private UserPermissionsV2 userPermissions;

    private ClientPermissionsV2 clientPermissions;

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm) {
        super(session, realm);
    }

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        super(session, realm, auth);
    }

    public MgmtPermissionsV2(KeycloakSession session, AdminAuth auth) {
        super(session, auth);
 
---
[Medium] class PermissionRESTTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class PermissionRESTTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    private ManagedUser userAlice;

    @Test
    public void resourceServerTest() {
        ResourceServerRepresentation rep = new ResourceServerRepresentation();
        rep.setPolicyEnforcementMode(PolicyEnforcementMode.DISABLED);
        rep.setDecisionStrategy(DecisionStrategy.CONSENSUS);

        try {
            cli
---
[Medium] method onAfter in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@AfterEach
    public void onAfter() {
        ScopePermissionsResource permissions = getScopePermissionsResource(client);

        for (ScopePermissionRepresentation permission : permissions.findAll(null, null, null, -1, -1)) {
            permissions.findById(permission.getId()).remove();
        }

        realm.admin().users().search(newUserUsername).forEach(user -> realm.admin().users().get(user.getId()).remove());
    }
---
[Medium] method testTransitiveUserPermissions in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testTransitiveUserPermissions() {
        //create all-users manage permission for ""myadmin""
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", realm.admin().users().search(""myadmin"").get(0).getId());
        createAllPermission(client, usersType, policy, Set.of(MANAGE));

        // with manage permission it is possible also view
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().sear
---
[Medium] class UserResourceTypePermissionTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class UserResourceTypePermissionTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    ManagedUser userAlice;

    @InjectUser(ref = ""bob"")
    ManagedUser userBob;

    @BeforeEach
    public void onBefore() {
        for (int i = 0; i < 3; i++) {
            UserPolicyRepresentation policy = new UserPolicyRepresentation();

            policy.setName(""User Policy "" + i);

            client.
---
[Medium] method onAfter in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@AfterEach
    public void onAfter() {
        ScopePermissionsResource permissions = getScopePermissionsResource(client);

        for (ScopePermissionRepresentation permission : permissions.findAll(null, null, null, -1, -1)) {
            permissions.findById(permission.getId()).remove();
        }
    }","getScopePermissionsResource (Critical), createAllPermission (Critical), AbstractPermissionTest (Critical), createUserPermission (High), getPermissionsResource (High), createPermission (High), createAllUserPermission (High), testManageUserPermission (Medium), resourcesTest (Medium), permissionsTest (Medium), testImpersonatePermission (Medium), testViewAllPermission (Medium), testManageGroupMembership (Medium), testViewUserPermissionDenyByDefault (Medium), testViewUserPermission (Medium), testManageAllPermission (Medium), testMapRoles (Medium), testSingleUserPermission (Medium), testFindByResourceObject (Medium), testDelete (Medium), testCreateResourceTypePermission (Medium), testCreateResourceObjectPermission (Medium), testUpdate (Medium), PermissionClientTest (Medium), createUserPolicy (Medium), createUserPolicy (Medium), createClientPolicy (Medium), createUserPolicy (Medium), createUserPolicy (Medium), createAllUserPermission (Medium), createUserPermission (Medium), createUserPermission (Medium), UserResourceTypeEvaluationTest (Medium), AdminPermissionsSchema (Medium), getOrCreateResource (Medium), ResourceType (Medium), String (Medium), AdminPermissionsSchema (Medium), AdminPermissions (Medium), registerListener (Medium), MgmtPermissionsV2 (Medium), PermissionRESTTest (Medium), onAfter (Medium), testTransitiveUserPermissions (Medium), UserResourceTypePermissionTest (Medium), onAfter (Medium), resolveClient (Low), ClientPermissionsV2 (Low), Logger (Low), ClientPermissionsV2 (Low), canConfigure (Low), canManage (Low), canManage (Low), canView (Low), canView (Low), canMapRoles (Low), canMapCompositeRoles (Low), canMapClientScopeRoles (Low), canManageClientScopes (Low), canManage (Low), canView (Low), getClientsWithPermission (Low), canExchangeTo (Low), exchangeToPermission (Low), mapRolesPermission (Low), mapRolesClientScopePermission (Low), mapRolesCompositePermission (Low), managePermission (Low), configurePermission (Low), viewPermission (Low), isPermissionsEnabled (Low), setPermissionsEnabled (Low), resource (Low), getPermissions (Low), hasPermission (Low), hasPermission (Low), getEvaluationContext (Low), hasGrantedPermission (Low), ClientPermissionsV2 (Low), clients (Low), Keycloak (Low), ManagedClient (Low), String (Low), onAfter (Low), testManageOnlyOneClient (Low), testConfigureOnlyOneClient (Low), testManageAllClients (Low), testViewAllClients (Low), testMapRolesAndCompositesOnlyOneClient (Low), testUnsupportedPolicyTypes (Low), testSupportedPolicyTypes (Low), ClientPermissionEvaluator (Low)",partial,permission test methods are HC but AdminPermissions event listener not specifically flagged
keycloak,5,Add Client resource type and scopes to authorization schema,"In hasPermission(ClientModel client, String scope), the resource lookup uses findByName(server, client.getId(), server.getId()), but AdminPermissionsSchema.getOrCreateResource creates per-client resources with the owner set to resourceServer.getClientId(), so this lookup will never find those resources and will always fall back to the 'all-clients' resource, effectively ignoring client-specific permissions.",High,92,7,39,"method::getScopePermissionsResource (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.84] | method::createAllPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.84] | class::AbstractPermissionTest (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.74] | method::createUserPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java) [High, score=0.61] | method::getPermissionsResource (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [High, score=0.58] | method::createPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [High, score=0.52] | method::createAllUserPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java) [High, score=0.51]","[Critical] method getScopePermissionsResource in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ScopePermissionsResource getScopePermissionsResource(ManagedClient client) {
        return getPermissionsResource(client).scope();
    }
---
[Critical] method createAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ScopePermissionRepresentation createAllPermission(ManagedClient client, String resourceType, AbstractPolicyRepresentation policy, Set<String> scopes) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(resourceType)
                .scopes(scopes)
                .addPolicies(List.of(policy.getName()))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[Critical] class AbstractPermissionTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
public abstract class AbstractPermissionTest {

    @InjectRealm(config = RealmAdminPermissionsConfig.class)
    ManagedRealm realm;

    @InjectClient(attachTo = Constants.ADMIN_PERMISSIONS_CLIENT_ID)
    ManagedClient client;

    protected static PermissionsResource getPermissionsResource(ManagedClient client) {
        return client.admin().authorization().permissions();
    }

    protected PoliciesResource getPolicies() {
        return client.admin().authorization().policies();
    }

    protected static ScopePermissionsResource getScopePermissionsResource(ManagedClient client) {
        return getPermissionsResource(client).scope();
    }

    protected static void createPermission(ManagedClient client, ScopePermissionRepresentation permission) {
        createPermission(client, p
---
[High] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
private ScopePermissionRepresentation createUserPermission(ManagedUser... users) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .resources(Arrays.stream(users).map(ManagedUser::getUsername).collect(Collectors.toSet()))
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .addPolicies(List.of(""User Policy 0"", ""User Policy 1"", ""User Policy 2""))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[High] method getPermissionsResource in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static PermissionsResource getPermissionsResource(ManagedClient client) {
        return client.admin().authorization().permissions();
    }
---
[High] method createPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected ScopePermissionRepresentation createPermission(ManagedClient client, Logic logic, String resourceId, String resourceType, Set<String> scopes, AbstractPolicyRepresentation... policies) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .logic(logic)
                .resourceType(resourceType)
                .scopes(scopes)
                .resources(Set.of(resourceId))
                .addPolicies(Arrays.stream(policies).map(AbstractPolicyRepresentation::getName).collect(Collectors.toList()))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[High] method createAllUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
private ScopePermissionRepresentation createAllUserPermission() {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .addPolicies(List.of(""User Policy 0"", ""User Policy 1"", ""User Policy 2""))
                .build();

        createPermission(client, permission);

        return permission;
    }","[Medium] method testManageUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageUserPermission() {
        String myadminId = realm.admin().users().search(""myadmin"").get(0).getId();
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", myadminId);
        ScopePermissionRepresentation allUsersPermission = createAllPermission(client, usersType, policy, Set.of(MANAGE));

        // creating user requires manage scope
        String newUserId = ApiUtil.handleCreatedResponse(realmAdminClient.realm(r
---
[Medium] method resourcesTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@Test
    public void resourcesTest() {
        ResourceRepresentation resourceRep = new ResourceRepresentation(""resource-1"", ""manage"");
        resourceRep.setType(AdminPermissionsSchema.USERS.getType());
        //it is not expected to create resources directly
        try (Response response = client.admin().authorization().resources().create(resourceRep)) {
            assertThat(response.getStatus(), equalTo(Response.Status.BAD_REQUEST.getStatusCode()));
        }
        
        ResourceRe
---
[Medium] method permissionsTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@Test
    public void permissionsTest() {
        // no resourceType, valid scopes
        createPermission(client, PermissionBuilder.create()
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .build(), Response.Status.BAD_REQUEST);

        // valid resourceType, no scopes
        createPermission(client, PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .build(), Response.Status.BAD_REQUEST);

      
---
[Medium] method testImpersonatePermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testImpersonatePermission() {
        // myadmin shouldn't be able to impersonate user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).impersonate();
            fail(""Expected Exception wasn't thrown."");
        } catch (Exception ex) {
            assertThat(ex, instanceOf(ForbiddenException.class));
        }

        //create all-users permission for ""myadmin"" (so that myadmin can impersonate all users in the rea
---
[Medium] method testViewAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewAllPermission() {
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", realm.admin().users().search(""myadmin"").get(0).getId());
        ScopePermissionRepresentation permission = createAllPermission(client, usersType, policy, Set.of(VIEW));
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().search(null, -1, -1);
        assertFalse(search.isEmpty());

        permission = client.
---
[Medium] method testManageGroupMembership in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageGroupMembership() {
        // myadmin shouldn't be able to manage group membership of the user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).joinGroup(""no-such"");
            fail(""Expected Exception wasn't thrown."");
        } catch (Exception ex) {
            assertThat(ex, instanceOf(ForbiddenException.class));
        }

        //create all-users permission for ""myadmin"" (so that myadmin can add us
---
[Medium] method testViewUserPermissionDenyByDefault in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewUserPermissionDenyByDefault() {
        String myadminId = realm.admin().users().search(""myadmin"").get(0).getId();
        UserPolicyRepresentation disallowMyAdmin = createUserPolicy(realm, client,""Not My Admin User Policy"", myadminId, Logic.NEGATIVE);
        createAllPermission(client, usersType, disallowMyAdmin, Set.of(VIEW));

        UserPolicyRepresentation allowAliceOnlyForMyAdmin = createUserPolicy(realm, client,""My Admin User Policy"", myadminId);
        cr
---
[Medium] method testViewUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewUserPermission() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client,""Only My Admin User Policy"", myadmin.getId());
        createAllPermission(client, usersType, allowMyAdminPermission, Set.of(VIEW));

        UserPolicyRepresentation denyMyAdminAccessingHisAccountPermission = createUserPolicy(realm, client,""Not My Admin User Policy"", myadmin.
---
[Medium] method testManageAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageAllPermission() {
        // myadmin shouldn't be able to create user just yet
        try (Response response = realmAdminClient.realm(realm.getName()).users().create(UserConfigBuilder.create().username(newUserUsername).build())) {
            assertEquals(Response.Status.FORBIDDEN.getStatusCode(), response.getStatus());
        }

        //create all-users permission for ""myadmin"" (so that myadmin can manage all users in the realm)
        UserPolicyRepresentati
---
[Medium] method testMapRoles in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testMapRoles() {
        RoleRepresentation testRole = new RoleRepresentation();
        testRole.setName(""testRole"");
        realm.admin().roles().create(testRole);
        realm.cleanup().add(r -> r.roles().get(""testRole"").remove());

        // myadmin shouldn't be able to map roles to the user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).roles().realmLevel().add(List.of(testRole));
            fail(""Expected 
---
[Medium] method testSingleUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testSingleUserPermission() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client, ""Only My Admin User Policy"", myadmin.getId());
        // allow my admin to see alice only
        createPermission(client, userAlice.admin().toRepresentation().getId(), usersType, Set.of(VIEW), allowMyAdminPermission);
        List<UserRepresentation> search = realmAdminCl
---
[Medium] method testFindByResourceObject in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testFindByResourceObject() {
        createUserPermission(userAlice, userBob);

        List<ScopePermissionRepresentation> existing = getScopePermissionsResource(client).findAll(null, null, userAlice.getId(), -1, -1);
        assertEquals(1, existing.size());
        existing = getScopePermissionsResource(client).findAll(null, null, userBob.getId(), -1, -1);
        assertEquals(1, existing.size());
    }
---
[Medium] method testDelete in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testDelete() {
        // only ""all-resource"" resources should be present
        List<ResourceRepresentation> resources = client.admin().authorization().resources().find(null, null, null, null, null, null, null);
        assertEquals(AdminPermissionsSchema.SCHEMA.getResourceTypes().entrySet().size(), resources.size());

        createUserPermission(userAlice);
        // resource for Alice should be created
        resources = client.admin().authorization().resources().fin
---
[Medium] method testCreateResourceTypePermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testCreateResourceTypePermission() {
        ScopePermissionRepresentation expected = createAllUserPermission();
        List<ScopePermissionRepresentation> result = getScopePermissionsResource(client).findAll(null, null, null, -1, -1);
        assertEquals(1, result.size());
        ScopePermissionRepresentation permissionRep = result.get(0);
        ScopePermissionResource permission = getScopePermissionsResource(client).findById(permissionRep.getId());
        assertEqua
---
[Medium] method testCreateResourceObjectPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testCreateResourceObjectPermission() {
        ScopePermissionRepresentation expected = createUserPermission(userAlice);
        List<ScopePermissionRepresentation> result = getScopePermissionsResource(client).findAll(null, null, null, -1, -1);
        assertEquals(1, result.size());
        ScopePermissionRepresentation permissionRep = result.get(0);
        ScopePermissionResource permission = getScopePermissionsResource(client).findById(permissionRep.getId());
        as
---
[Medium] method testUpdate in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testUpdate() {
        createUserPermission(userAlice, userBob);

        List<ScopePermissionRepresentation> searchByResourceAlice = getScopePermissionsResource(client).findAll(null, null, userAlice.getId(), -1, -1);
        assertThat(searchByResourceAlice, hasSize(1));
        List<ScopePermissionRepresentation> searchByResourceBob = getScopePermissionsResource(client).findAll(null, null, userBob.getId(), -1, -1);
        assertThat(searchByResourceBob, hasSize(1));

   
---
[Medium] class PermissionClientTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionClientTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class PermissionClientTest extends AbstractPermissionTest {

    @InjectAdminClient(mode = InjectAdminClient.Mode.MANAGED_REALM, client = ""myclient"", user = ""myadmin"")
    Keycloak realmAdminClient;

    @InjectClient(ref = ""realmClient"")
    ManagedClient realmClient;

    private final String clientsType = AdminPermissionsSchema.CLIENTS.getType();

    @AfterEach
    public void onAfter() {
        ScopePermis
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static UserPolicyRepresentation createUserPolicy(ManagedRealm realm, ManagedClient client, String name, String userId) {
        return createUserPolicy(realm, client, name, userId, Logic.POSITIVE);
    }
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static UserPolicyRepresentation createUserPolicy(ManagedRealm realm, ManagedClient client, String name, String userId, Logic logic) {
        UserPolicyRepresentation policy = new UserPolicyRepresentation();
        policy.setName(name);
        policy.addUser(userId);
        policy.setLogic(logic);
        try (Response response = client.admin().authorization().policies().user().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCo
---
[Medium] method createClientPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ClientPolicyRepresentation createClientPolicy(ManagedRealm realm, ManagedClient client, String name, String clientId) {
        ClientPolicyRepresentation policy = new ClientPolicyRepresentation();
        policy.setName(name);
        policy.addClient(clientId);
        policy.setLogic(Logic.POSITIVE);
        try (Response response = client.admin().authorization().policies().client().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private UserPolicyRepresentation createUserPolicy(String name, String userId) {
        return createUserPolicy(name, userId, Logic.POSITIVE);
    }
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private UserPolicyRepresentation createUserPolicy(String name, String userId, Logic logic) {
        UserPolicyRepresentation policy = new UserPolicyRepresentation();
        policy.setName(name);
        policy.addUser(userId);
        policy.setLogic(logic);
        try (Response response = client.admin().authorization().policies().user().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCode()));
            realm.cleanup().add(r -> {
    
---
[Medium] method createAllUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createAllUserPermission(UserPolicyRepresentation policy, Set<String> scopes) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(scopes)
                .addPolicies(List.of(policy.getName()))
                .build();

        createPermission(permission);

        return permission;
    }
---
[Medium] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createUserPermission(UserRepresentation user, Set<String> scopes, UserPolicyRepresentation... policies) {
        return createUserPermission(Logic.POSITIVE, user, scopes, policies);
    }
---
[Medium] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createUserPermission(Logic logic, UserRepresentation user, Set<String> scopes, UserPolicyRepresentation... policies) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .logic(logic)
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(scopes)
                .resources(Set.of(user.getId()))
                .addPolicies(Arrays.asList(policies).stream().map(AbstractPolicyRepr
---
[Medium] class UserResourceTypeEvaluationTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class UserResourceTypeEvaluationTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    ManagedUser userAlice;

    @InjectAdminClient(mode = InjectAdminClient.Mode.MANAGED_REALM, client = ""myclient"", user = ""myadmin"")
    Keycloak realmAdminClient;

    private final String usersType = AdminPermissionsSchema.USERS.getType();

    private final String newUserUsername = ""new_user"";

    @AfterEa
---
[Medium] class AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public class AdminPermissionsSchema extends AuthorizationSchema {
    
    public static final String USERS_RESOURCE_TYPE = ""Users"";
    public static final String CLIENTS_RESOURCE_TYPE = ""Clients"";

    //scopes
    public static final String MANAGE = ""manage"";
    public static final String VIEW = ""view"";
    public static final String IMPERSONATE = ""impersonate"";
    public static final String MAP_ROLES = ""map-roles"";
    public static final String MANAGE_GROUP_MEMBERSHIP = ""manage-group-memb
---
[Medium] method getOrCreateResource in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public Resource getOrCreateResource(KeycloakSession session, ResourceServer resourceServer, String policyType, String resourceType, String id) {
        if (!supportsAuthorizationSchema(session, resourceServer)) {
            return null;
        }

        StoreFactory storeFactory = getStoreFactory(session);
        ResourceStore resourceStore = storeFactory.getResourceStore();
        Resource resource = resourceStore.findById(resourceServer, id);

        if (resource != null) {
            
---
[Medium] field ResourceType in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final ResourceType CLIENTS = new ResourceType(CLIENTS_RESOURCE_TYPE, Set.of(CONFIGURE, MANAGE, MAP_ROLES, MAP_ROLES_CLIENT_SCOPE, MAP_ROLES_COMPOSITE, VIEW));
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final String MAP_ROLES_COMPOSITE = ""map-roles-composite"";
---
[Medium] constructor AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
private AdminPermissionsSchema() {
        super(Map.of(USERS_RESOURCE_TYPE, USERS, CLIENTS_RESOURCE_TYPE, CLIENTS));
    }
---
[Medium] class AdminPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public class AdminPermissions {


    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ_V2)) {
            return new MgmtPermissionsV2(session, realm, auth);
        }
        return new MgmtPermissions(session, realm, auth);
    }
    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, RealmModel adminsRealm, UserModel
---
[Medium] method registerListener in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public static void registerListener(ProviderEventManager manager) {
        manager.register(new ProviderEventListener() {
            @Override
            public void onEvent(ProviderEvent event) {
                if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ)) {
                    if (event instanceof RoleContainerModel.RoleRemovedEvent) {
                        RoleContainerModel.RoleRemovedEvent cast = (RoleContainerModel.RoleRemovedEvent) event;
                  
---
[Medium] class MgmtPermissionsV2 in services/src/main/java/org/keycloak/services/resources/admin/permissions/MgmtPermissionsV2.java:
class MgmtPermissionsV2 extends MgmtPermissions {

    private UserPermissionsV2 userPermissions;

    private ClientPermissionsV2 clientPermissions;

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm) {
        super(session, realm);
    }

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        super(session, realm, auth);
    }

    public MgmtPermissionsV2(KeycloakSession session, AdminAuth auth) {
        super(session, auth);
 
---
[Medium] class PermissionRESTTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class PermissionRESTTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    private ManagedUser userAlice;

    @Test
    public void resourceServerTest() {
        ResourceServerRepresentation rep = new ResourceServerRepresentation();
        rep.setPolicyEnforcementMode(PolicyEnforcementMode.DISABLED);
        rep.setDecisionStrategy(DecisionStrategy.CONSENSUS);

        try {
            cli
---
[Medium] method onAfter in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@AfterEach
    public void onAfter() {
        ScopePermissionsResource permissions = getScopePermissionsResource(client);

        for (ScopePermissionRepresentation permission : permissions.findAll(null, null, null, -1, -1)) {
            permissions.findById(permission.getId()).remove();
        }

        realm.admin().users().search(newUserUsername).forEach(user -> realm.admin().users().get(user.getId()).remove());
    }
---
[Medium] method testTransitiveUserPermissions in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testTransitiveUserPermissions() {
        //create all-users manage permission for ""myadmin""
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", realm.admin().users().search(""myadmin"").get(0).getId());
        createAllPermission(client, usersType, policy, Set.of(MANAGE));

        // with manage permission it is possible also view
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().sear
---
[Medium] class UserResourceTypePermissionTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class UserResourceTypePermissionTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    ManagedUser userAlice;

    @InjectUser(ref = ""bob"")
    ManagedUser userBob;

    @BeforeEach
    public void onBefore() {
        for (int i = 0; i < 3; i++) {
            UserPolicyRepresentation policy = new UserPolicyRepresentation();

            policy.setName(""User Policy "" + i);

            client.
---
[Medium] method onAfter in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@AfterEach
    public void onAfter() {
        ScopePermissionsResource permissions = getScopePermissionsResource(client);

        for (ScopePermissionRepresentation permission : permissions.findAll(null, null, null, -1, -1)) {
            permissions.findById(permission.getId()).remove();
        }
    }","getScopePermissionsResource (Critical), createAllPermission (Critical), AbstractPermissionTest (Critical), createUserPermission (High), getPermissionsResource (High), createPermission (High), createAllUserPermission (High), testManageUserPermission (Medium), resourcesTest (Medium), permissionsTest (Medium), testImpersonatePermission (Medium), testViewAllPermission (Medium), testManageGroupMembership (Medium), testViewUserPermissionDenyByDefault (Medium), testViewUserPermission (Medium), testManageAllPermission (Medium), testMapRoles (Medium), testSingleUserPermission (Medium), testFindByResourceObject (Medium), testDelete (Medium), testCreateResourceTypePermission (Medium), testCreateResourceObjectPermission (Medium), testUpdate (Medium), PermissionClientTest (Medium), createUserPolicy (Medium), createUserPolicy (Medium), createClientPolicy (Medium), createUserPolicy (Medium), createUserPolicy (Medium), createAllUserPermission (Medium), createUserPermission (Medium), createUserPermission (Medium), UserResourceTypeEvaluationTest (Medium), AdminPermissionsSchema (Medium), getOrCreateResource (Medium), ResourceType (Medium), String (Medium), AdminPermissionsSchema (Medium), AdminPermissions (Medium), registerListener (Medium), MgmtPermissionsV2 (Medium), PermissionRESTTest (Medium), onAfter (Medium), testTransitiveUserPermissions (Medium), UserResourceTypePermissionTest (Medium), onAfter (Medium), resolveClient (Low), ClientPermissionsV2 (Low), Logger (Low), ClientPermissionsV2 (Low), canConfigure (Low), canManage (Low), canManage (Low), canView (Low), canView (Low), canMapRoles (Low), canMapCompositeRoles (Low), canMapClientScopeRoles (Low), canManageClientScopes (Low), canManage (Low), canView (Low), getClientsWithPermission (Low), canExchangeTo (Low), exchangeToPermission (Low), mapRolesPermission (Low), mapRolesClientScopePermission (Low), mapRolesCompositePermission (Low), managePermission (Low), configurePermission (Low), viewPermission (Low), isPermissionsEnabled (Low), setPermissionsEnabled (Low), resource (Low), getPermissions (Low), hasPermission (Low), hasPermission (Low), getEvaluationContext (Low), hasGrantedPermission (Low), ClientPermissionsV2 (Low), clients (Low), Keycloak (Low), ManagedClient (Low), String (Low), onAfter (Low), testManageOnlyOneClient (Low), testConfigureOnlyOneClient (Low), testManageAllClients (Low), testViewAllClients (Low), testMapRolesAndCompositesOnlyOneClient (Low), testUnsupportedPolicyTypes (Low), testSupportedPolicyTypes (Low), ClientPermissionEvaluator (Low)",partial,permission test infrastructure is HC but hasPermission implementation not specifically matched
keycloak,5,Add Client resource type and scopes to authorization schema,"In getClientsWithPermission(String scope), iterating resourceStore.findByType(server, AdminPermissionsSchema.CLIENTS_RESOURCE_TYPE) and returning resource.getName() will only ever consider the type-level 'Clients' resource (per-client resources have no type) and return its name, while AvailableRoleMappingResource#getRoleIdsWithPermissions expects actual client IDs to pass to realm.getClientById, which can lead to incorrect behavior or a null client and subsequent failures.",High,92,7,39,"method::getScopePermissionsResource (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.84] | method::createAllPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.84] | class::AbstractPermissionTest (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [Critical, score=0.74] | method::createUserPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java) [High, score=0.61] | method::getPermissionsResource (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [High, score=0.58] | method::createPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java) [High, score=0.52] | method::createAllUserPermission (tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java) [High, score=0.51]","[Critical] method getScopePermissionsResource in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ScopePermissionsResource getScopePermissionsResource(ManagedClient client) {
        return getPermissionsResource(client).scope();
    }
---
[Critical] method createAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ScopePermissionRepresentation createAllPermission(ManagedClient client, String resourceType, AbstractPolicyRepresentation policy, Set<String> scopes) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(resourceType)
                .scopes(scopes)
                .addPolicies(List.of(policy.getName()))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[Critical] class AbstractPermissionTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
public abstract class AbstractPermissionTest {

    @InjectRealm(config = RealmAdminPermissionsConfig.class)
    ManagedRealm realm;

    @InjectClient(attachTo = Constants.ADMIN_PERMISSIONS_CLIENT_ID)
    ManagedClient client;

    protected static PermissionsResource getPermissionsResource(ManagedClient client) {
        return client.admin().authorization().permissions();
    }

    protected PoliciesResource getPolicies() {
        return client.admin().authorization().policies();
    }

    protected static ScopePermissionsResource getScopePermissionsResource(ManagedClient client) {
        return getPermissionsResource(client).scope();
    }

    protected static void createPermission(ManagedClient client, ScopePermissionRepresentation permission) {
        createPermission(client, p
---
[High] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
private ScopePermissionRepresentation createUserPermission(ManagedUser... users) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .resources(Arrays.stream(users).map(ManagedUser::getUsername).collect(Collectors.toSet()))
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .addPolicies(List.of(""User Policy 0"", ""User Policy 1"", ""User Policy 2""))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[High] method getPermissionsResource in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static PermissionsResource getPermissionsResource(ManagedClient client) {
        return client.admin().authorization().permissions();
    }
---
[High] method createPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected ScopePermissionRepresentation createPermission(ManagedClient client, Logic logic, String resourceId, String resourceType, Set<String> scopes, AbstractPolicyRepresentation... policies) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .logic(logic)
                .resourceType(resourceType)
                .scopes(scopes)
                .resources(Set.of(resourceId))
                .addPolicies(Arrays.stream(policies).map(AbstractPolicyRepresentation::getName).collect(Collectors.toList()))
                .build();

        createPermission(client, permission);

        return permission;
    }
---
[High] method createAllUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
private ScopePermissionRepresentation createAllUserPermission() {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .addPolicies(List.of(""User Policy 0"", ""User Policy 1"", ""User Policy 2""))
                .build();

        createPermission(client, permission);

        return permission;
    }","[Medium] method testManageUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageUserPermission() {
        String myadminId = realm.admin().users().search(""myadmin"").get(0).getId();
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", myadminId);
        ScopePermissionRepresentation allUsersPermission = createAllPermission(client, usersType, policy, Set.of(MANAGE));

        // creating user requires manage scope
        String newUserId = ApiUtil.handleCreatedResponse(realmAdminClient.realm(r
---
[Medium] method resourcesTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@Test
    public void resourcesTest() {
        ResourceRepresentation resourceRep = new ResourceRepresentation(""resource-1"", ""manage"");
        resourceRep.setType(AdminPermissionsSchema.USERS.getType());
        //it is not expected to create resources directly
        try (Response response = client.admin().authorization().resources().create(resourceRep)) {
            assertThat(response.getStatus(), equalTo(Response.Status.BAD_REQUEST.getStatusCode()));
        }
        
        ResourceRe
---
[Medium] method permissionsTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@Test
    public void permissionsTest() {
        // no resourceType, valid scopes
        createPermission(client, PermissionBuilder.create()
                .scopes(AdminPermissionsSchema.USERS.getScopes())
                .build(), Response.Status.BAD_REQUEST);

        // valid resourceType, no scopes
        createPermission(client, PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .build(), Response.Status.BAD_REQUEST);

      
---
[Medium] method testImpersonatePermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testImpersonatePermission() {
        // myadmin shouldn't be able to impersonate user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).impersonate();
            fail(""Expected Exception wasn't thrown."");
        } catch (Exception ex) {
            assertThat(ex, instanceOf(ForbiddenException.class));
        }

        //create all-users permission for ""myadmin"" (so that myadmin can impersonate all users in the rea
---
[Medium] method testViewAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewAllPermission() {
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", realm.admin().users().search(""myadmin"").get(0).getId());
        ScopePermissionRepresentation permission = createAllPermission(client, usersType, policy, Set.of(VIEW));
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().search(null, -1, -1);
        assertFalse(search.isEmpty());

        permission = client.
---
[Medium] method testManageGroupMembership in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageGroupMembership() {
        // myadmin shouldn't be able to manage group membership of the user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).joinGroup(""no-such"");
            fail(""Expected Exception wasn't thrown."");
        } catch (Exception ex) {
            assertThat(ex, instanceOf(ForbiddenException.class));
        }

        //create all-users permission for ""myadmin"" (so that myadmin can add us
---
[Medium] method testViewUserPermissionDenyByDefault in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewUserPermissionDenyByDefault() {
        String myadminId = realm.admin().users().search(""myadmin"").get(0).getId();
        UserPolicyRepresentation disallowMyAdmin = createUserPolicy(realm, client,""Not My Admin User Policy"", myadminId, Logic.NEGATIVE);
        createAllPermission(client, usersType, disallowMyAdmin, Set.of(VIEW));

        UserPolicyRepresentation allowAliceOnlyForMyAdmin = createUserPolicy(realm, client,""My Admin User Policy"", myadminId);
        cr
---
[Medium] method testViewUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testViewUserPermission() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client,""Only My Admin User Policy"", myadmin.getId());
        createAllPermission(client, usersType, allowMyAdminPermission, Set.of(VIEW));

        UserPolicyRepresentation denyMyAdminAccessingHisAccountPermission = createUserPolicy(realm, client,""Not My Admin User Policy"", myadmin.
---
[Medium] method testManageAllPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testManageAllPermission() {
        // myadmin shouldn't be able to create user just yet
        try (Response response = realmAdminClient.realm(realm.getName()).users().create(UserConfigBuilder.create().username(newUserUsername).build())) {
            assertEquals(Response.Status.FORBIDDEN.getStatusCode(), response.getStatus());
        }

        //create all-users permission for ""myadmin"" (so that myadmin can manage all users in the realm)
        UserPolicyRepresentati
---
[Medium] method testMapRoles in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testMapRoles() {
        RoleRepresentation testRole = new RoleRepresentation();
        testRole.setName(""testRole"");
        realm.admin().roles().create(testRole);
        realm.cleanup().add(r -> r.roles().get(""testRole"").remove());

        // myadmin shouldn't be able to map roles to the user just yet
        try {
            realmAdminClient.realm(realm.getName()).users().get(userAlice.getId()).roles().realmLevel().add(List.of(testRole));
            fail(""Expected 
---
[Medium] method testSingleUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testSingleUserPermission() {
        UserRepresentation myadmin = realm.admin().users().search(""myadmin"").get(0);
        UserPolicyRepresentation allowMyAdminPermission = createUserPolicy(realm, client, ""Only My Admin User Policy"", myadmin.getId());
        // allow my admin to see alice only
        createPermission(client, userAlice.admin().toRepresentation().getId(), usersType, Set.of(VIEW), allowMyAdminPermission);
        List<UserRepresentation> search = realmAdminCl
---
[Medium] method testFindByResourceObject in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testFindByResourceObject() {
        createUserPermission(userAlice, userBob);

        List<ScopePermissionRepresentation> existing = getScopePermissionsResource(client).findAll(null, null, userAlice.getId(), -1, -1);
        assertEquals(1, existing.size());
        existing = getScopePermissionsResource(client).findAll(null, null, userBob.getId(), -1, -1);
        assertEquals(1, existing.size());
    }
---
[Medium] method testDelete in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testDelete() {
        // only ""all-resource"" resources should be present
        List<ResourceRepresentation> resources = client.admin().authorization().resources().find(null, null, null, null, null, null, null);
        assertEquals(AdminPermissionsSchema.SCHEMA.getResourceTypes().entrySet().size(), resources.size());

        createUserPermission(userAlice);
        // resource for Alice should be created
        resources = client.admin().authorization().resources().fin
---
[Medium] method testCreateResourceTypePermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testCreateResourceTypePermission() {
        ScopePermissionRepresentation expected = createAllUserPermission();
        List<ScopePermissionRepresentation> result = getScopePermissionsResource(client).findAll(null, null, null, -1, -1);
        assertEquals(1, result.size());
        ScopePermissionRepresentation permissionRep = result.get(0);
        ScopePermissionResource permission = getScopePermissionsResource(client).findById(permissionRep.getId());
        assertEqua
---
[Medium] method testCreateResourceObjectPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testCreateResourceObjectPermission() {
        ScopePermissionRepresentation expected = createUserPermission(userAlice);
        List<ScopePermissionRepresentation> result = getScopePermissionsResource(client).findAll(null, null, null, -1, -1);
        assertEquals(1, result.size());
        ScopePermissionRepresentation permissionRep = result.get(0);
        ScopePermissionResource permission = getScopePermissionsResource(client).findById(permissionRep.getId());
        as
---
[Medium] method testUpdate in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@Test
    public void testUpdate() {
        createUserPermission(userAlice, userBob);

        List<ScopePermissionRepresentation> searchByResourceAlice = getScopePermissionsResource(client).findAll(null, null, userAlice.getId(), -1, -1);
        assertThat(searchByResourceAlice, hasSize(1));
        List<ScopePermissionRepresentation> searchByResourceBob = getScopePermissionsResource(client).findAll(null, null, userBob.getId(), -1, -1);
        assertThat(searchByResourceBob, hasSize(1));

   
---
[Medium] class PermissionClientTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionClientTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class PermissionClientTest extends AbstractPermissionTest {

    @InjectAdminClient(mode = InjectAdminClient.Mode.MANAGED_REALM, client = ""myclient"", user = ""myadmin"")
    Keycloak realmAdminClient;

    @InjectClient(ref = ""realmClient"")
    ManagedClient realmClient;

    private final String clientsType = AdminPermissionsSchema.CLIENTS.getType();

    @AfterEach
    public void onAfter() {
        ScopePermis
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static UserPolicyRepresentation createUserPolicy(ManagedRealm realm, ManagedClient client, String name, String userId) {
        return createUserPolicy(realm, client, name, userId, Logic.POSITIVE);
    }
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static UserPolicyRepresentation createUserPolicy(ManagedRealm realm, ManagedClient client, String name, String userId, Logic logic) {
        UserPolicyRepresentation policy = new UserPolicyRepresentation();
        policy.setName(name);
        policy.addUser(userId);
        policy.setLogic(logic);
        try (Response response = client.admin().authorization().policies().user().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCo
---
[Medium] method createClientPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/AbstractPermissionTest.java:
protected static ClientPolicyRepresentation createClientPolicy(ManagedRealm realm, ManagedClient client, String name, String clientId) {
        ClientPolicyRepresentation policy = new ClientPolicyRepresentation();
        policy.setName(name);
        policy.addClient(clientId);
        policy.setLogic(Logic.POSITIVE);
        try (Response response = client.admin().authorization().policies().client().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private UserPolicyRepresentation createUserPolicy(String name, String userId) {
        return createUserPolicy(name, userId, Logic.POSITIVE);
    }
---
[Medium] method createUserPolicy in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private UserPolicyRepresentation createUserPolicy(String name, String userId, Logic logic) {
        UserPolicyRepresentation policy = new UserPolicyRepresentation();
        policy.setName(name);
        policy.addUser(userId);
        policy.setLogic(logic);
        try (Response response = client.admin().authorization().policies().user().create(policy)) {
            assertThat(response.getStatus(), equalTo(Response.Status.CREATED.getStatusCode()));
            realm.cleanup().add(r -> {
    
---
[Medium] method createAllUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createAllUserPermission(UserPolicyRepresentation policy, Set<String> scopes) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(scopes)
                .addPolicies(List.of(policy.getName()))
                .build();

        createPermission(permission);

        return permission;
    }
---
[Medium] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createUserPermission(UserRepresentation user, Set<String> scopes, UserPolicyRepresentation... policies) {
        return createUserPermission(Logic.POSITIVE, user, scopes, policies);
    }
---
[Medium] method createUserPermission in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
private ScopePermissionRepresentation createUserPermission(Logic logic, UserRepresentation user, Set<String> scopes, UserPolicyRepresentation... policies) {
        ScopePermissionRepresentation permission = PermissionBuilder.create()
                .logic(logic)
                .resourceType(AdminPermissionsSchema.USERS.getType())
                .scopes(scopes)
                .resources(Set.of(user.getId()))
                .addPolicies(Arrays.asList(policies).stream().map(AbstractPolicyRepr
---
[Medium] class UserResourceTypeEvaluationTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class UserResourceTypeEvaluationTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    ManagedUser userAlice;

    @InjectAdminClient(mode = InjectAdminClient.Mode.MANAGED_REALM, client = ""myclient"", user = ""myadmin"")
    Keycloak realmAdminClient;

    private final String usersType = AdminPermissionsSchema.USERS.getType();

    private final String newUserUsername = ""new_user"";

    @AfterEa
---
[Medium] class AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public class AdminPermissionsSchema extends AuthorizationSchema {
    
    public static final String USERS_RESOURCE_TYPE = ""Users"";
    public static final String CLIENTS_RESOURCE_TYPE = ""Clients"";

    //scopes
    public static final String MANAGE = ""manage"";
    public static final String VIEW = ""view"";
    public static final String IMPERSONATE = ""impersonate"";
    public static final String MAP_ROLES = ""map-roles"";
    public static final String MANAGE_GROUP_MEMBERSHIP = ""manage-group-memb
---
[Medium] method getOrCreateResource in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public Resource getOrCreateResource(KeycloakSession session, ResourceServer resourceServer, String policyType, String resourceType, String id) {
        if (!supportsAuthorizationSchema(session, resourceServer)) {
            return null;
        }

        StoreFactory storeFactory = getStoreFactory(session);
        ResourceStore resourceStore = storeFactory.getResourceStore();
        Resource resource = resourceStore.findById(resourceServer, id);

        if (resource != null) {
            
---
[Medium] field ResourceType in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final ResourceType CLIENTS = new ResourceType(CLIENTS_RESOURCE_TYPE, Set.of(CONFIGURE, MANAGE, MAP_ROLES, MAP_ROLES_CLIENT_SCOPE, MAP_ROLES_COMPOSITE, VIEW));
---
[Medium] field String in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
public static final String MAP_ROLES_COMPOSITE = ""map-roles-composite"";
---
[Medium] constructor AdminPermissionsSchema in server-spi-private/src/main/java/org/keycloak/authorization/AdminPermissionsSchema.java:
private AdminPermissionsSchema() {
        super(Map.of(USERS_RESOURCE_TYPE, USERS, CLIENTS_RESOURCE_TYPE, CLIENTS));
    }
---
[Medium] class AdminPermissions in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public class AdminPermissions {


    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ_V2)) {
            return new MgmtPermissionsV2(session, realm, auth);
        }
        return new MgmtPermissions(session, realm, auth);
    }
    public static AdminPermissionEvaluator evaluator(KeycloakSession session, RealmModel realm, RealmModel adminsRealm, UserModel
---
[Medium] method registerListener in services/src/main/java/org/keycloak/services/resources/admin/permissions/AdminPermissions.java:
public static void registerListener(ProviderEventManager manager) {
        manager.register(new ProviderEventListener() {
            @Override
            public void onEvent(ProviderEvent event) {
                if (Profile.isFeatureEnabled(Profile.Feature.ADMIN_FINE_GRAINED_AUTHZ)) {
                    if (event instanceof RoleContainerModel.RoleRemovedEvent) {
                        RoleContainerModel.RoleRemovedEvent cast = (RoleContainerModel.RoleRemovedEvent) event;
                  
---
[Medium] class MgmtPermissionsV2 in services/src/main/java/org/keycloak/services/resources/admin/permissions/MgmtPermissionsV2.java:
class MgmtPermissionsV2 extends MgmtPermissions {

    private UserPermissionsV2 userPermissions;

    private ClientPermissionsV2 clientPermissions;

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm) {
        super(session, realm);
    }

    public MgmtPermissionsV2(KeycloakSession session, RealmModel realm, AdminAuth auth) {
        super(session, realm, auth);
    }

    public MgmtPermissionsV2(KeycloakSession session, AdminAuth auth) {
        super(session, auth);
 
---
[Medium] class PermissionRESTTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/PermissionRESTTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class PermissionRESTTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    private ManagedUser userAlice;

    @Test
    public void resourceServerTest() {
        ResourceServerRepresentation rep = new ResourceServerRepresentation();
        rep.setPolicyEnforcementMode(PolicyEnforcementMode.DISABLED);
        rep.setDecisionStrategy(DecisionStrategy.CONSENSUS);

        try {
            cli
---
[Medium] method onAfter in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@AfterEach
    public void onAfter() {
        ScopePermissionsResource permissions = getScopePermissionsResource(client);

        for (ScopePermissionRepresentation permission : permissions.findAll(null, null, null, -1, -1)) {
            permissions.findById(permission.getId()).remove();
        }

        realm.admin().users().search(newUserUsername).forEach(user -> realm.admin().users().get(user.getId()).remove());
    }
---
[Medium] method testTransitiveUserPermissions in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypeEvaluationTest.java:
@Test
    public void testTransitiveUserPermissions() {
        //create all-users manage permission for ""myadmin""
        UserPolicyRepresentation policy = createUserPolicy(realm, client,""Only My Admin User Policy"", realm.admin().users().search(""myadmin"").get(0).getId());
        createAllPermission(client, usersType, policy, Set.of(MANAGE));

        // with manage permission it is possible also view
        List<UserRepresentation> search = realmAdminClient.realm(realm.getName()).users().sear
---
[Medium] class UserResourceTypePermissionTest in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@KeycloakIntegrationTest(config = KeycloakAdminPermissionsServerConfig.class)
public class UserResourceTypePermissionTest extends AbstractPermissionTest {

    @InjectUser(ref = ""alice"")
    ManagedUser userAlice;

    @InjectUser(ref = ""bob"")
    ManagedUser userBob;

    @BeforeEach
    public void onBefore() {
        for (int i = 0; i < 3; i++) {
            UserPolicyRepresentation policy = new UserPolicyRepresentation();

            policy.setName(""User Policy "" + i);

            client.
---
[Medium] method onAfter in tests/base/src/test/java/org/keycloak/tests/admin/authz/fgap/UserResourceTypePermissionTest.java:
@AfterEach
    public void onAfter() {
        ScopePermissionsResource permissions = getScopePermissionsResource(client);

        for (ScopePermissionRepresentation permission : permissions.findAll(null, null, null, -1, -1)) {
            permissions.findById(permission.getId()).remove();
        }
    }","getScopePermissionsResource (Critical), createAllPermission (Critical), AbstractPermissionTest (Critical), createUserPermission (High), getPermissionsResource (High), createPermission (High), createAllUserPermission (High), testManageUserPermission (Medium), resourcesTest (Medium), permissionsTest (Medium), testImpersonatePermission (Medium), testViewAllPermission (Medium), testManageGroupMembership (Medium), testViewUserPermissionDenyByDefault (Medium), testViewUserPermission (Medium), testManageAllPermission (Medium), testMapRoles (Medium), testSingleUserPermission (Medium), testFindByResourceObject (Medium), testDelete (Medium), testCreateResourceTypePermission (Medium), testCreateResourceObjectPermission (Medium), testUpdate (Medium), PermissionClientTest (Medium), createUserPolicy (Medium), createUserPolicy (Medium), createClientPolicy (Medium), createUserPolicy (Medium), createUserPolicy (Medium), createAllUserPermission (Medium), createUserPermission (Medium), createUserPermission (Medium), UserResourceTypeEvaluationTest (Medium), AdminPermissionsSchema (Medium), getOrCreateResource (Medium), ResourceType (Medium), String (Medium), AdminPermissionsSchema (Medium), AdminPermissions (Medium), registerListener (Medium), MgmtPermissionsV2 (Medium), PermissionRESTTest (Medium), onAfter (Medium), testTransitiveUserPermissions (Medium), UserResourceTypePermissionTest (Medium), onAfter (Medium), resolveClient (Low), ClientPermissionsV2 (Low), Logger (Low), ClientPermissionsV2 (Low), canConfigure (Low), canManage (Low), canManage (Low), canView (Low), canView (Low), canMapRoles (Low), canMapCompositeRoles (Low), canMapClientScopeRoles (Low), canManageClientScopes (Low), canManage (Low), canView (Low), getClientsWithPermission (Low), canExchangeTo (Low), exchangeToPermission (Low), mapRolesPermission (Low), mapRolesClientScopePermission (Low), mapRolesCompositePermission (Low), managePermission (Low), configurePermission (Low), viewPermission (Low), isPermissionsEnabled (Low), setPermissionsEnabled (Low), resource (Low), getPermissions (Low), hasPermission (Low), hasPermission (Low), getEvaluationContext (Low), hasGrantedPermission (Low), ClientPermissionsV2 (Low), clients (Low), Keycloak (Low), ManagedClient (Low), String (Low), onAfter (Low), testManageOnlyOneClient (Low), testConfigureOnlyOneClient (Low), testManageAllClients (Low), testViewAllClients (Low), testMapRolesAndCompositesOnlyOneClient (Low), testUnsupportedPolicyTypes (Low), testSupportedPolicyTypes (Low), ClientPermissionEvaluator (Low)",partial,permission test methods HC but getClientsWithPermission not specifically flagged
keycloak,4,Add rolling-updates feature flag and compatibility framework,"Incorrect method call for exit codes. The picocli.exit() method calls System.exit() directly, which is problematic:",Medium,32,6,23,"class::Profile (common/src/main/java/org/keycloak/common/Profile.java) [Critical, score=1.00] | enum::Feature (common/src/main/java/org/keycloak/common/Profile.java) [Critical, score=1.00] | class::UpdateCompatibilityCheck (quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/UpdateCompatibilityCheck.java) [Critical, score=0.79] | class::UpdateCompatibilityMetadata (quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/UpdateCompatibilityMetadata.java) [Critical, score=0.79] | class::AbstractUpdatesCommand (quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/AbstractUpdatesCommand.java) [High, score=0.57] | method::printFeatureDisabled (quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/AbstractUpdatesCommand.java) [High, score=0.51]","[Critical] class Profile in common/src/main/java/org/keycloak/common/Profile.java:
public class Profile {

    private static volatile Map<String, TreeSet<Feature>> FEATURES;

    public enum Feature {
        AUTHORIZATION(""Authorization Service"", Type.DEFAULT),

        ACCOUNT_API(""Account Management REST API"", Type.DEFAULT),

        ACCOUNT_V3(""Account Console version 3"", Type.DEFAULT, 3, Feature.ACCOUNT_API),

        ADMIN_FINE_GRAINED_AUTHZ(""Fine-Grained Admin Permissions"", Type.PREVIEW, 1),

        ADMIN_FINE_GRAINED_AUTHZ_V2(""Fine-Grained Admin Permissions version 2"", Type.EXPERIMENTAL, 2, Feature.AUTHORIZATION),

        ADMIN_API(""Admin API"", Type.DEFAULT),

        ADMIN_V2(""New Admin Console"", Type.DEFAULT, 2, Feature.ADMIN_API),

        LOGIN_V2(""New Login Theme"", Type.DEFAULT, 2),

        LOGIN_V1(""Legacy Login Theme"", Type.DEPRECATED, 1),

        QUI
---
[Critical] enum Feature in common/src/main/java/org/keycloak/common/Profile.java:
public enum Feature {
        AUTHORIZATION(""Authorization Service"", Type.DEFAULT),

        ACCOUNT_API(""Account Management REST API"", Type.DEFAULT),

        ACCOUNT_V3(""Account Console version 3"", Type.DEFAULT, 3, Feature.ACCOUNT_API),

        ADMIN_FINE_GRAINED_AUTHZ(""Fine-Grained Admin Permissions"", Type.PREVIEW, 1),

        ADMIN_FINE_GRAINED_AUTHZ_V2(""Fine-Grained Admin Permissions version 2"", Type.EXPERIMENTAL, 2, Feature.AUTHORIZATION),

        ADMIN_API(""Admin API"", Type.DEFAULT),

        ADMIN_V2(""New Admin Console"", Type.DEFAULT, 2, Feature.ADMIN_API),

        LOGIN_V2(""New Login Theme"", Type.DEFAULT, 2),

        LOGIN_V1(""Legacy Login Theme"", Type.DEPRECATED, 1),

        QUICK_THEME(""WYSIWYG theme configuration tool"", Type.EXPERIMENTAL, 1),

        DOCKER(""Docker Regis
---
[Critical] class UpdateCompatibilityCheck in quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/UpdateCompatibilityCheck.java:
@CommandLine.Command(
        name = UpdateCompatibilityCheck.NAME,
        description = ""Checks if the metadata is compatible with the current configuration. A zero exit code means a rolling upgrade is possible between old and the current metadata.""
)
public class UpdateCompatibilityCheck extends AbstractUpdatesCommand {

    public static final String NAME = ""check"";
    public static final String INPUT_OPTION_NAME = ""--file"";


    @CommandLine.Option(names = {INPUT_OPTION_NAME}, paramLabel = ""FILE"",
            description = ""The file path to read the metadata."")
    String inputFile;

    @Override
    public void run() {
        if (!Profile.isFeatureEnabled(Profile.Feature.ROLLING_UPDATES)) {
            printFeatureDisabled();
            picocli.exit(CompatibilityResult.FEATURE_D
---
[Critical] class UpdateCompatibilityMetadata in quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/UpdateCompatibilityMetadata.java:
@CommandLine.Command(
        name = UpdateCompatibilityMetadata.NAME,
        description = ""Stores the metadata necessary to determine if a configuration is compatible.""
)
public class UpdateCompatibilityMetadata extends AbstractUpdatesCommand {

    public static final String NAME = ""metadata"";
    public static final String OUTPUT_OPTION_NAME = ""--file"";

    @CommandLine.Option(names = {OUTPUT_OPTION_NAME}, paramLabel = ""FILE"",
            description = ""The file path to store the metadata. It is stored in the JSON format."")
    String outputFile;

    @Override
    public void run() {
        if (!Profile.isFeatureEnabled(Profile.Feature.ROLLING_UPDATES)) {
            printFeatureDisabled();
            picocli.exit(CompatibilityResult.FEATURE_DISABLED);
            return;
        
---
[High] class AbstractUpdatesCommand in quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/AbstractUpdatesCommand.java:
public abstract class AbstractUpdatesCommand extends AbstractCommand implements Runnable {

    protected final CompatibilityManager compatibilityManager = new CompatibilityManagerImpl();

    @CommandLine.Mixin
    HelpAllMixin helpAllMixin;

    @CommandLine.Mixin
    OptimizedMixin optimizedMixin;

    @Override
    public List<OptionCategory> getOptionCategories() {
        return super.getOptionCategories().stream()
                .filter(Predicate.not(OptionCategory.EXPORT::equals))
                .filter(Predicate.not(OptionCategory.IMPORT::equals))
                .toList();
    }

    static void validateOptionIsPresent(String value, String option) {
        if (value == null || value.isBlank()) {
            throw new PropertyException(""Missing required argument: "" + option);
 
---
[High] method printFeatureDisabled in quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/AbstractUpdatesCommand.java:
void printFeatureDisabled() {
        printError(""Unable to use this command. The preview feature 'rolling-updates' is not enabled."");
    }","[Medium] interface CompatibilityResult in quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/compatibility/CompatibilityResult.java:
public interface CompatibilityResult {

    int ROLLING_UPGRADE_EXIT_CODE = 0;
    // see picocli.CommandLine.ExitCode
    // 1 -> software error
    // 2 -> usage error
    int RECREATE_UPGRADE_EXIT_CODE = 3;
    int FEATURE_DISABLED = 4;

    /**
     * The compatible {@link CompatibilityResult} implementation
     */
    CompatibilityResult OK = new CompatibilityResult() {
        @Override
        public int exitCode() {
            return ROLLING_UPGRADE_EXIT_CODE;
        }

        @Overr
---
[Medium] method testMissingOptionOnCheck in quarkus/tests/integration/src/test/java/org/keycloak/it/cli/dist/UpdateCommandDistTest.java:
@Test
    @Launch({UpdateCompatibility.NAME, UpdateCompatibilityCheck.NAME, ENABLE_FEATURE})
    public void testMissingOptionOnCheck(CLIResult cliResult) {
        cliResult.assertError(""Missing required argument: "" + UpdateCompatibilityCheck.INPUT_OPTION_NAME);
    }
---
[Medium] method testCompatible in quarkus/tests/integration/src/test/java/org/keycloak/it/cli/dist/UpdateCommandDistTest.java:
@Test
    public void testCompatible(KeycloakDistribution distribution) throws IOException {
        var jsonFile = createTempFile(""compatible"");
        var result = distribution.run(UpdateCompatibility.NAME, UpdateCompatibilityMetadata.NAME, UpdateCompatibilityMetadata.OUTPUT_OPTION_NAME, jsonFile.getAbsolutePath(), ENABLE_FEATURE);
        result.assertMessage(""Metadata:"");
        assertEquals(0, result.exitCode());

        var info = JsonSerialization.mapper.readValue(jsonFile, ServerInfo.
---
[Medium] method testMissingOptionOnSave in quarkus/tests/integration/src/test/java/org/keycloak/it/cli/dist/UpdateCommandDistTest.java:
@Test
    @Launch({UpdateCompatibility.NAME, UpdateCompatibilityMetadata.NAME, ENABLE_FEATURE})
    public void testMissingOptionOnSave(CLIResult cliResult) {
        cliResult.assertNoMessage(""Missing required argument"");
    }
---
[Medium] method testWrongVersions in quarkus/tests/integration/src/test/java/org/keycloak/it/cli/dist/UpdateCommandDistTest.java:
@Test
    public void testWrongVersions(KeycloakDistribution distribution) throws IOException {
        var jsonFile = createTempFile(""wrong-versions"");

        // incompatible keycloak version
        var info = new ServerInfo();
        info.setVersions(Map.of(CompatibilityManagerImpl.KEYCLOAK_VERSION_KEY, ""0.0.0.Final"",
                CompatibilityManagerImpl.INFINISPAN_VERSION_KEY, org.infinispan.commons.util.Version.getVersion()));
        JsonSerialization.mapper.writeValue(jsonFile, inf
---
[Medium] method testFeatureNotEnabled in quarkus/tests/integration/src/test/java/org/keycloak/it/cli/dist/UpdateCommandDistTest.java:
@Test
    @Launch({UpdateCompatibility.NAME, UpdateCompatibilityMetadata.NAME})
    public void testFeatureNotEnabled(CLIResult cliResult) {
        cliResult.assertError(""Unable to use this command. The preview feature 'rolling-updates' is not enabled."");
    }
---
[Medium] chunk lines 481-491 in docs/guides/operator/advanced-configuration.adoc:
|On image name or tag change
|Mimics Keycloak 26.1 or older behavior.
When the image field changes, the StatefulSet is scaled down before applying the new image.

|`Recreate`
|On any configuration or image change
|The StatefulSet is scaled down before applying the new configuration or image.

|===

</@tmpl.guide>
---
[Medium] chunk lines 121-129 in docs/guides/server/update-compatibility.adoc:
m|2
|Invalid CLI option.

m|3
|Rolling Upgrade is not possible.
The deployment must be shut down before applying the new configuration.
|===

</@tmpl.guide>
---
[Medium] chunk lines 441-460 in docs/guides/operator/advanced-configuration.adoc:

=== Managing Keycloak Operator Updates (Preview)

The Keycloak Operator offers updates strategies to control how the Operator handles changes to the Keycloak CR.

[CAUTION]
====
While on preview stage, the feature `rolling-updates` must be enabled.
Otherwise, the {project_name} Operator will fail.
====

**Supported Updates Types:**

Rolling Updates:: Update the StatefulSet in a rolling fashion, minimizing downtime (requires multiple replicas).
Recreate Updates:: Scale down the StatefulSet befor
---
[Medium] chunk lines 461-480 in docs/guides/operator/advanced-configuration.adoc:
[NOTE]
====
During this preview stage, the update strategy defaults to mimicking Keycloak 26.1 or older behavior:
When the Keycloak CR's image field changes, the Operator scales down the StatefulSet before applying the new image, resulting in downtime.
Any configuration change will be a rolling update.
====

[source,yaml]
----
apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
  name: example-kc
spec:
  features:
    enabled:
      - rolling-updates # <1>
  update:
    strategy: Recr
---
[Medium] chunk lines 41-60 in docs/guides/server/update-compatibility.adoc:
1. Generating the required metadata.
2. Checking the metadata to determine the possible upgrade type.

[WARNING]
====
This command is under development. At the moment, it takes into consideration only the version of {project_name} and the embedded Infinispan to determine if a rolling update is possible.
If those are unchanged, it reports that a rolling update is possible.

The current version does not yet verify configuration changes and assumes all configuration changes are eligible for a rolli
---
[Medium] chunk lines 21-40 in docs/guides/server/update-compatibility.adoc:
This has been designed to be fully scriptable, so an update procedure can adapt to a rolling or recreate strategy depending on the configuration or version change.
It is also GitOps friendly as it allows storing the metadata of a currently running configuration in a file. This file can be used in a CI/CD run with the new configuration to determine if a rolling upgrade is possible or if a recreate upgrade is needed.

[NOTE]
====
.Rolling Upgrade
In the context of this guide, a rolling upgrade is 
---
[Medium] chunk lines 61-80 in docs/guides/server/update-compatibility.adoc:

.Generate and save the metadata from the current deployment.
<@kc.updatecompatibility parameters=""metadata --file=/path/to/file.json""/>

This command accepts all options used by the `start` command.
The metadata, in JSON format, is displayed in the console for debugging purposes.
The `--file` parameter allows you to save the metadata to a file.
This file is then used by the subsequent `check` command.

[WARNING]
====
Ensure that all configuration options, whether set via environment variables o
---
[Medium] chunk lines 101-120 in docs/guides/server/update-compatibility.adoc:
----

Otherwise, the command will indicate that a rolling upgrade is not possible and, optionally, provide details about the incompatibility:

.Rolling Upgrade not possible message
[source,bash]
----
[Versions] Rolling Upgrade is not available. 'infinispan' is incompatible: Old=15.0.0.Final, New=15.0.11.Final #<1>
----
<1> In this example, the Infinispan version `15.0.0.Final` is not compatible with version `15.0.11.Final` and a rolling upgrade is not possible.

*Command exit code*

To aid in th
---
[Medium] chunk lines 81-100 in docs/guides/server/update-compatibility.adoc:

.Check the metadata from a previous deployment.
<@kc.updatecompatibility parameters=""check --file=/path/to/file.json""/>

[WARNING]
====
* Ensure that all configuration options, whether set via environment variables or CLI arguments, are included when running this command.

* Verify that the correct {project_name} version is used.

Failure to meet these requirements will result in an incorrect outcome.
====

The command will print the result to the console.
For example, if a rolling upgrade is p
---
[Medium] chunk lines 1-20 in docs/guides/server/update-compatibility.adoc:
<#import ""/templates/guide.adoc"" as tmpl>
<#import ""/templates/kc.adoc"" as kc>
<#import ""/templates/links.adoc"" as links>

<@tmpl.guide
title=""Update Compatibility Tool""
summary=""Learn how to use this tool before upgrade {project_name}""
preview=""true""
previewDiscussionLink=""https://github.com/keycloak/keycloak/discussions/36785""
>

[CAUTION]
====
While on preview stage, the feature `rolling-updates` must be enabled.
Otherwise, the commands will fail.
====

The goal of this tool is to assist with
---
[Medium] chunk lines 41-55 in docs/guides/templates/kc.adoc:
</#macro>

<#macro bootstrapadmin parameters>
[source,bash]
----
bin/kc.[sh|bat] bootstrap-admin ${parameters}
----
</#macro>

<#macro updatecompatibility parameters>
[source,bash]
----
bin/kc.[sh|bat] update-compatibility ${parameters} --features=rolling-updates
----
</#macro>
---
[Medium] chunk lines 1-5 in operator/scripts/Dockerfile-custom-image:
ARG IMAGE=keycloak
ARG VERSION=latest
FROM $IMAGE:$VERSION

RUN /opt/keycloak/bin/kc.sh build --db=postgres --health-enabled=true --features=rolling-updates
---
[Medium] class UpgradeTest in operator/src/test/java/org/keycloak/operator/testsuite/integration/UpgradeTest.java:
@QuarkusTest
public class UpgradeTest extends BaseOperatorTest {

    private static Stream<UpdateStrategy> upgradeStrategy() {
        return Stream.of(
                null,
                UpdateStrategy.RECREATE
        );
    }

    @ParameterizedTest(name = ""testImageChange-{0}"")
    @MethodSource(""upgradeStrategy"")
    public void testImageChange(UpdateStrategy updateStrategy) throws InterruptedException {
        var kc = createInitialDeployment(updateStrategy);
        deployKeycloak(k8
---
[Medium] method createInitialDeployment in operator/src/test/java/org/keycloak/operator/testsuite/integration/UpgradeTest.java:
private static Keycloak createInitialDeployment(UpdateStrategy updateStrategy) {
        var kc = getTestKeycloakDeployment(true);
        kc.getSpec().setInstances(3);
        if (updateStrategy == null) {
            return kc;
        }
        var updateSpec = new UpdateSpec();
        updateSpec.setStrategy(updateStrategy);
        kc.getSpec().setUpdateSpec(updateSpec);

        if (kc.getSpec().getFeatureSpec() == null) {
            kc.getSpec().setFeatureSpec(new FeatureSpec());
       
---
[Medium] method run in quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/UpdateCompatibilityCheck.java:
@Override
    public void run() {
        if (!Profile.isFeatureEnabled(Profile.Feature.ROLLING_UPDATES)) {
            printFeatureDisabled();
            picocli.exit(CompatibilityResult.FEATURE_DISABLED);
            return;
        }
        printPreviewWarning();
        validateConfig();
        var info = readServerInfo();
        var result = compatibilityManager.isCompatible(info);
        result.errorMessage().ifPresent(this::printError);
        result.endMessage().ifPresent(this::pri
---
[Medium] method run in quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/cli/command/UpdateCompatibilityMetadata.java:
@Override
    public void run() {
        if (!Profile.isFeatureEnabled(Profile.Feature.ROLLING_UPDATES)) {
            printFeatureDisabled();
            picocli.exit(CompatibilityResult.FEATURE_DISABLED);
            return;
        }
        printPreviewWarning();
        validateConfig();
        var info = compatibilityManager.current();
        printToConsole(info);
        writeToFile(info);
    }
---
[Medium] class UpdateCommandDistTest in quarkus/tests/integration/src/test/java/org/keycloak/it/cli/dist/UpdateCommandDistTest.java:
@DistributionTest
@RawDistOnly(reason = ""Requires creating JSON file to be available between containers"")
public class UpdateCommandDistTest {

    private static final String ENABLE_FEATURE = ""--features=rolling-updates"";

    @Test
    @Launch({UpdateCompatibility.NAME, UpdateCompatibilityMetadata.NAME})
    public void testFeatureNotEnabled(CLIResult cliResult) {
        cliResult.assertError(""Unable to use this command. The preview feature 'rolling-updates' is not enabled."");
    }

    @Tes","Profile (Critical), Feature (Critical), UpdateCompatibilityCheck (Critical), UpdateCompatibilityMetadata (Critical), AbstractUpdatesCommand (High), printFeatureDisabled (High), CompatibilityResult (Medium), testMissingOptionOnCheck (Medium), testCompatible (Medium), testMissingOptionOnSave (Medium), testWrongVersions (Medium), testFeatureNotEnabled (Medium), lines 481-491 (Medium), lines 121-129 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 41-60 (Medium), lines 21-40 (Medium), lines 61-80 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 1-20 (Medium), lines 41-55 (Medium), lines 1-5 (Medium), UpgradeTest (Medium), createInitialDeployment (Medium), run (Medium), run (Medium), UpdateCommandDistTest (Medium), lines 481-500 (Low), lines 121-137 (Low), String (Low)",partial,Profile/Feature/UpdateCompatibility are HC but picocli exit handling not specifically matched
keycloak,3,Add AuthzClientCryptoProvider for authorization client cryptographic operations,Returns wrong provider (default keystore instead of BouncyCastle),High,72,49,15,"field::ByteArrayInputStream (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=1.00] | method::read (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=1.00] | method::reset (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=1.00] | method::read (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=1.00] | field::ByteArrayOutputStream (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::write (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::toByteArray (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::write (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::write (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::order (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=1.00] | method::test (authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java) [Critical, score=1.00] | class::CryptoIntegration (common/src/main/java/org/keycloak/common/crypto/CryptoIntegration.java) [Critical, score=1.00] | method::getSignature (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.98] | class::AuthzClient (authz/client/src/main/java/org/keycloak/authorization/client/AuthzClient.java) [Critical, score=0.96] | method::getKeyPairGen (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.86] | method::mark (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=0.84] | method::getKeyFactory (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.79] | method::getAlgorithmProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.75] | method::getCertificateUtils (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.75] | method::getPemUtils (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.75] | method::getKeyStore (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.74] | method::getIdentityExtractorProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.71] | class::ASN1Encoder (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.69] | method::getEcdsaCryptoProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.64] | method::getCertStore (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.62] | method::getCertPathBuilder (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.62] | class::FIPS1402Provider (crypto/fips1402/src/main/java/org/keycloak/crypto/fips/FIPS1402Provider.java) [High, score=0.62] | method::readTag (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.59] | method::readTagNumber (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.59] | method::readLength (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.59] | method::getOCSPProver (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.59] | method::getAesCbcCipher (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.59] | method::getAesGcmCipher (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.59] | method::detectProvider (common/src/main/java/org/keycloak/common/crypto/CryptoIntegration.java) [High, score=0.57] | class::DefaultCryptoProvider (crypto/default/src/main/java/org/keycloak/crypto/def/DefaultCryptoProvider.java) [High, score=0.57] | class::ASN1Decoder (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.56] | method::readSequence (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.56] | method::readInteger (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.56] | method::writeDerSeq (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.56] | method::writeEncoded (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.56] | method::getBouncyCastleProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::createECParams (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::getSecretKeyFact (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::getX509CertFactory (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::wrapFactoryForTruststore (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::readNext (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.51] | method::writeLength (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.51] | method::concatenate (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.51] | class::AuthzClientCryptoProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.51]","[Critical] field ByteArrayInputStream in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
private final ByteArrayInputStream is;
---
[Critical] method read in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
byte[] read(int length) throws IOException {
        byte[] bytes = new byte[length];
        int totalBytesRead = 0;

        while (totalBytesRead < length) {
            int bytesRead = is.read(bytes, totalBytesRead, length - totalBytesRead);
            if (bytesRead == -1) {
                throw new IOException(String.format(""EOF found reading %d bytes"", length));
            }
            totalBytesRead += bytesRead;
        }
        count += length;
        return bytes;
    }
---
[Critical] method reset in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int reset() {
        int tmp = count;
        is.reset();
        return tmp;
    }
---
[Critical] method read in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int read() {
        int tmp = is.read();
        if (tmp >= 0) {
            count++;
        }
        return tmp;
    }
---
[Critical] field ByteArrayOutputStream in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
private final ByteArrayOutputStream os;
---
[Critical] method write in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
public ASN1Encoder write(BigInteger value) throws IOException {
        writeEncoded(INTEGER, value.toByteArray());
        return this;
    }
---
[Critical] method toByteArray in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
public byte[] toByteArray() {
        return os.toByteArray();
    }
---
[Critical] method write in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
void write(byte[] bytes) throws IOException {
        os.write(bytes);
    }
---
[Critical] method write in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
void write(int b) throws IOException {
        os.write(b);
    }
---
[Critical] method order in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public int order() {
        return 100;
    }
---
[Critical] method test in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
private void test(ECDSAAlgorithm algorithm) throws Exception {
        AuthzClientCryptoProvider prov = new AuthzClientCryptoProvider();
        byte[] data = ""Something to sign"".getBytes(StandardCharsets.UTF_8);
        Signature signature = Signature.getInstance(JavaAlgorithm.getJavaAlgorithm(algorithm.name()));
        signature.initSign(keyPair.getPrivate());
        signature.update(data);
        byte[] sign = signature.sign();
        byte[] rsConcat = prov.getEcdsaCryptoProvider().asn1derToConcatenatedRS(sign, algorithm.getSignatureLength());
        byte[] asn1Des = prov.getEcdsaCryptoProvider().concatenatedRSToASN1DER(rsConcat, algorithm.getSignatureLength());
        byte[] rsConcat2 = prov.getEcdsaCryptoProvider().asn1derToConcatenatedRS(asn1Des, algorithm.getSignatureLength())
---
[Critical] class CryptoIntegration in common/src/main/java/org/keycloak/common/crypto/CryptoIntegration.java:
public class CryptoIntegration {

    protected static final Logger logger = Logger.getLogger(CryptoIntegration.class);

    private static final Object lock = new Object();
    private static volatile CryptoProvider cryptoProvider;

    public static void init(ClassLoader classLoader) {
        if (cryptoProvider == null) {
            synchronized (lock) {
                if (cryptoProvider == null) {
                    cryptoProvider = detectProvider(classLoader);
                    logger.debugv(""java security provider: {0}"", BouncyIntegration.PROVIDER);

                }
            }
        }

        if (logger.isTraceEnabled()) {
            logger.tracef(dumpJavaSecurityProviders());
            logger.tracef(dumpSecurityProperties());
        }
    }

    public static Crypto
---
[Critical] method getSignature in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public Signature getSignature(String sigAlgName) throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] class AuthzClient in authz/client/src/main/java/org/keycloak/authorization/client/AuthzClient.java:
public class AuthzClient {

    private final Http http;
    private TokenCallable patSupplier;

    /**
     * <p>Creates a new instance.
     *
     * <p>This method expects a <code>keycloak.json</code> in the classpath, otherwise an exception will be thrown.
     *
     * @return a new instance
     * @throws RuntimeException in case there is no <code>keycloak.json</code> file in the classpath or the file could not be parsed
     */
    public static AuthzClient create() throws RuntimeException {
        InputStream configStream = Thread.currentThread().getContextClassLoader().getResourceAsStream(""keycloak.json"");

        return create(configStream);
    }

    /**
     * <p>Creates a new instance.
     *
     * @param configStream the input stream with the configuration data
     * @r
---
[Critical] method getKeyPairGen in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public KeyPairGenerator getKeyPairGen(String algorithm) throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method mark in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
void mark() {
        count = 0;
        is.mark(is.available());
    }
---
[Critical] method getKeyFactory in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public KeyFactory getKeyFactory(String algorithm) throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method getAlgorithmProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public <T> T getAlgorithmProvider(Class<T> clazz, String algorithm) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method getCertificateUtils in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public CertificateUtilsProvider getCertificateUtils() {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method getPemUtils in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public PemUtilsProvider getPemUtils() {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method getKeyStore in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public KeyStore getKeyStore(KeystoreUtil.KeystoreFormat format) throws KeyStoreException, NoSuchProviderException {
        return KeyStore.getInstance(format.name());
    }
---
[Critical] method getIdentityExtractorProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public UserIdentityExtractorProvider getIdentityExtractorProvider() {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] class ASN1Encoder in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
class ASN1Encoder {

    static final int INTEGER = 0x02;
    static final int SEQUENCE = 0x10;
    static final int CONSTRUCTED = 0x20;

    private final ByteArrayOutputStream os;

    private ASN1Encoder() {
        this.os = new ByteArrayOutputStream();
    }

    static public ASN1Encoder create() {
        return new ASN1Encoder();
    }

    public ASN1Encoder write(BigInteger value) throws IOException {
        writeEncoded(INTEGER, value.toByteArray());
        return this;
    }

    public ASN1Encoder writeDerSeq(ASN1Encoder... objects) throws IOException {
        writeEncoded(CONSTRUCTED | SEQUENCE, concatenate(objects));
        return this;
    }

    public byte[] toByteArray() {
        return os.toByteArray();
    }

    void writeEncoded(int tag, byte[] bytes) throws IOE
---
[High] method getEcdsaCryptoProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public ECDSACryptoProvider getEcdsaCryptoProvider() {
        return new ECDSACryptoProvider() {
            @Override
            public byte[] concatenatedRSToASN1DER(byte[] signature, int signLength) throws IOException {
                int len = signLength / 2;
                int arraySize = len + 1;

                byte[] r = new byte[arraySize];
                byte[] s = new byte[arraySize];
                System.arraycopy(signature, 0, r, 1, len);
                System.arraycopy(signature, len, s, 1, len);
                BigInteger rBigInteger = new BigInteger(r);
                BigInteger sBigInteger = new BigInteger(s);

                ASN1Encoder.create().write(rBigInteger);
                ASN1Encoder.create().write(sBigInteger);

                return ASN
---
[High] method getCertStore in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public CertStore getCertStore(CollectionCertStoreParameters collectionCertStoreParameters) throws InvalidAlgorithmParameterException, NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getCertPathBuilder in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public CertPathBuilder getCertPathBuilder() throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] class FIPS1402Provider in crypto/fips1402/src/main/java/org/keycloak/crypto/fips/FIPS1402Provider.java:
public class FIPS1402Provider implements CryptoProvider {

    private static final Logger log = Logger.getLogger(FIPS1402Provider.class);

    private final BouncyCastleFipsProvider bcFipsProvider;
    private final Map<String, Object> providers = new ConcurrentHashMap<>();

    public FIPS1402Provider() {
        // Case when BCFIPS provider already registered in Java security file
        BouncyCastleFipsProvider existingBcFipsProvider = (BouncyCastleFipsProvider) Security.getProvider(CryptoConstants.BCFIPS_PROVIDER_ID);
        this.bcFipsProvider = existingBcFipsProvider == null ? new BouncyCastleFipsProvider() : existingBcFipsProvider;

        providers.put(CryptoConstants.A128KW, new FIPSAesKeyWrapAlgorithmProvider());
        providers.put(CryptoConstants.RSA1_5, new FIPSRsaKeyEnc
---
[High] method readTag in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int readTag() throws IOException {
        int tag = read();
        if (tag < 0) {
            throw new EOFException(""EOF found inside tag value."");
        }
        return tag;
    }
---
[High] method readTagNumber in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int readTagNumber(int tag) throws IOException {
        int tagNo = tag & 0x1f;

        //
        // with tagged object tag number is bottom 5 bits, or stored at the start of the content
        //
        if (tagNo == 0x1f) {
            tagNo = 0;

            int b = read();

            // X.690-0207 8.1.2.4.2
            // ""c) bits 7 to 1 of the first subsequent octet shall not all be zero.""
            if ((b & 0x7f) == 0) // Note: -1 will pass
            {
                throw new IOException(""corrupted stream - invalid high tag number found"");
            }

            while ((b >= 0) && ((b & 0x80) != 0)) {
                tagNo |= (b & 0x7f);
                tagNo <<= 7;
                b = read();
            }

            if (b < 0) {
                throw new EOFExcepti
---
[High] method readLength in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int readLength() throws IOException {
        int length = read();
        if (length < 0) {
            throw new EOFException(""EOF found when length expected"");
        }

        if (length == 0x80) {
            return -1;      // indefinite-length encoding
        }

        if (length > 127) {
            int size = length & 0x7f;

            // Note: The invalid long form ""0xff"" (see X.690 8.1.3.5c) will be caught here
            if (size > 4) {
                throw new IOException(""DER length more than 4 bytes: "" + size);
            }

            length = 0;
            for (int i = 0; i < size; i++) {
                int next = read();

                if (next < 0) {
                    throw new EOFException(""EOF found reading length"");
                }

                le
---
[High] method getOCSPProver in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public <T> T getOCSPProver(Class<T> clazz) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getAesCbcCipher in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public Cipher getAesCbcCipher() throws NoSuchAlgorithmException, NoSuchProviderException, NoSuchPaddingException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getAesGcmCipher in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public Cipher getAesGcmCipher() throws NoSuchAlgorithmException, NoSuchProviderException, NoSuchPaddingException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method detectProvider in common/src/main/java/org/keycloak/common/crypto/CryptoIntegration.java:
private static CryptoProvider detectProvider(ClassLoader classLoader) {
        List<CryptoProvider> foundProviders = StreamSupport.stream(ServiceLoader.load(CryptoProvider.class, classLoader).spliterator(), false)
                .sorted(Comparator.comparingInt(CryptoProvider::order).reversed())
                .collect(Collectors.toList());

        if (foundProviders.isEmpty()) {
            throw new IllegalStateException(""Not able to load any cryptoProvider with the classLoader: "" + classLoader);
        } else {
            logger.debugf(""Detected crypto provider: %s"", foundProviders.get(0).getClass().getName());
            if (foundProviders.size() > 1) {
                StringBuilder builder = new StringBuilder(""Ignored crypto providers: "");
                for (int i = 1 ; i < fo
---
[High] class DefaultCryptoProvider in crypto/default/src/main/java/org/keycloak/crypto/def/DefaultCryptoProvider.java:
public class DefaultCryptoProvider implements CryptoProvider {

    private static final Logger log = Logger.getLogger(DefaultCryptoProvider.class);

    private final Provider bcProvider;

    private Map<String, Object> providers = new ConcurrentHashMap<>();

    public DefaultCryptoProvider() {
        // Make sure to instantiate this only once due it is expensive. And skip registration if already available in Java security providers (EG. due explicitly configured in java security file)
        Provider existingBc = Security.getProvider(CryptoConstants.BC_PROVIDER_ID);
        this.bcProvider = existingBc == null ? new BouncyCastleProvider() : existingBc;

        providers.put(CryptoConstants.A128KW, new AesKeyWrapAlgorithmProvider());
        providers.put(CryptoConstants.RSA1_5, new 
---
[High] class ASN1Decoder in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
class ASN1Decoder {

    private final ByteArrayInputStream is;
    private final int limit;
    private int count;

    ASN1Decoder(byte[] bytes) {
        is = new ByteArrayInputStream(bytes);
        count = 0;
        limit = bytes.length;
    }

    public static ASN1Decoder create(byte[] bytes) {
        return new ASN1Decoder(bytes);
    }

    public List<byte[]> readSequence() throws IOException {
        int tag = readTag();
        int tagNo = readTagNumber(tag);
        if (tagNo != ASN1Encoder.SEQUENCE) {
            throw new IOException(""Invalid Sequence tag "" + tagNo);
        }
        int length = readLength();
        List<byte[]> result = new ArrayList<>();
        while (length > 0) {
            byte[] bytes = readNext();
            result.add(bytes);
            len
---
[High] method readSequence in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
public List<byte[]> readSequence() throws IOException {
        int tag = readTag();
        int tagNo = readTagNumber(tag);
        if (tagNo != ASN1Encoder.SEQUENCE) {
            throw new IOException(""Invalid Sequence tag "" + tagNo);
        }
        int length = readLength();
        List<byte[]> result = new ArrayList<>();
        while (length > 0) {
            byte[] bytes = readNext();
            result.add(bytes);
            length = length - bytes.length;
        }
        return result;
    }
---
[High] method readInteger in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
public BigInteger readInteger() throws IOException {
        int tag = readTag();
        int tagNo = readTagNumber(tag);
        if (tagNo != ASN1Encoder.INTEGER) {
            throw new IOException(""Invalid Integer tag "" + tagNo);
        }
        int length = readLength();
        byte[] bytes = read(length);
        return new BigInteger(bytes);
    }
---
[High] method writeDerSeq in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
public ASN1Encoder writeDerSeq(ASN1Encoder... objects) throws IOException {
        writeEncoded(CONSTRUCTED | SEQUENCE, concatenate(objects));
        return this;
    }
---
[High] method writeEncoded in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
void writeEncoded(int tag, byte[] bytes) throws IOException {
        write(tag);
        writeLength(bytes.length);
        write(bytes);
    }
---
[High] method getBouncyCastleProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public Provider getBouncyCastleProvider() {
        try {
            return KeyStore.getInstance(KeyStore.getDefaultType()).getProvider();
        } catch (KeyStoreException e) {
            throw new IllegalStateException(e);
        }
    }
---
[High] method createECParams in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public ECParameterSpec createECParams(String curveName) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getSecretKeyFact in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public SecretKeyFactory getSecretKeyFact(String keyAlgorithm) throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getX509CertFactory in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public CertificateFactory getX509CertFactory() throws CertificateException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method wrapFactoryForTruststore in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public SSLSocketFactory wrapFactoryForTruststore(SSLSocketFactory delegate) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method readNext in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
byte[] readNext() throws IOException {
        mark();
        int tag = readTag();
        readTagNumber(tag);
        int length = readLength();
        length += reset();
        return read(length);
    }
---
[High] method writeLength in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
void writeLength(int length) throws IOException {
        if (length > 127) {
            int size = 1;
            int val = length;

            while ((val >>>= 8) != 0) {
                size++;
            }

            write((byte) (size | 0x80));

            for (int i = (size - 1) * 8; i >= 0; i -= 8) {
                write((byte) (length >> i));
            }
        } else {
            write((byte) length);
        }
    }
---
[High] method concatenate in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
byte[] concatenate(ASN1Encoder... objects) throws IOException {
        ByteArrayOutputStream tmp = new ByteArrayOutputStream();
        for (ASN1Encoder object : objects) {
            tmp.write(object.toByteArray());
        }
        return tmp.toByteArray();
    }
---
[High] class AuthzClientCryptoProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
public class AuthzClientCryptoProvider implements CryptoProvider {

    @Override
    public Provider getBouncyCastleProvider() {
        try {
            return KeyStore.getInstance(KeyStore.getDefaultType()).getProvider();
        } catch (KeyStoreException e) {
            throw new IllegalStateException(e);
        }
    }

    @Override
    public int order() {
        return 100;
    }

    @Override
    public <T> T getAlgorithmProvider(Class<T> clazz, String algorithm) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }

    @Override
    public CertificateUtilsProvider getCertificateUtils() {
        throw new UnsupportedOperationException(""Not supported yet."");
    }

    @Override
    public PemUtilsProvider getPemUtils() {
        throw new Unsupport","[Medium] method create in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
public static ASN1Decoder create(byte[] bytes) {
        return new ASN1Decoder(bytes);
    }
---
[Medium] method create in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
static public ASN1Encoder create() {
        return new ASN1Encoder();
    }
---
[Medium] method order in crypto/default/src/main/java/org/keycloak/crypto/def/DefaultCryptoProvider.java:
@Override
    public int order() {
        return 200;
    }
---
[Medium] method order in crypto/fips1402/src/main/java/org/keycloak/crypto/fips/FIPS1402Provider.java:
@Override
    public int order() {
        return 200;
    }
---
[Medium] interface CryptoProvider in common/src/main/java/org/keycloak/common/crypto/CryptoProvider.java:
public interface CryptoProvider {

    /**
     * @return BouncyCastle security provider. Can be either non-FIPS or FIPS based provider
     */
    Provider getBouncyCastleProvider();

    /**
     * Order of this provider. This allows to specify which CryptoProvider will have preference in case that more of them are on the classpath.
     *
     * The higher number has preference over the lower number
     */
    int order();

    /**
     * Get some algorithm provider implementation. Returned 
---
[Medium] method create in authz/client/src/main/java/org/keycloak/authorization/client/AuthzClient.java:
public static AuthzClient create(Configuration configuration) {
        CryptoIntegration.init(AuthzClient.class.getClassLoader());
        return new AuthzClient(configuration);
    }
---
[Medium] field KeyPair in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
private final KeyPair keyPair;
---
[Medium] method testES256 in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
@Test
    public void testES256() throws Exception {
        test(ECDSAAlgorithm.ES256);
    }
---
[Medium] method testES384 in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
@Test
    public void testES384() throws Exception {
        test(ECDSAAlgorithm.ES384);
    }
---
[Medium] method testES512 in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
@Test
    public void testES512() throws Exception {
        test(ECDSAAlgorithm.ES512);
    }
---
[Medium] method order in common/src/main/java/org/keycloak/common/crypto/CryptoProvider.java:
int order();
---
[Medium] method order in crypto/elytron/src/main/java/org/keycloak/crypto/elytron/WildFlyElytronProvider.java:
@Override
    public int order() {
        return 200;
    }
---
[Medium] chunk lines 81-82 in authz/client/pom.xml:
    
</project>
---
[Medium] chunk lines 61-80 in authz/client/pom.xml:

        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hamcrest</groupId>
            <artifactId>hamcrest</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-javadoc-plugi
---
[Medium] class WildFlyElytronProvider in crypto/elytron/src/main/java/org/keycloak/crypto/elytron/WildFlyElytronProvider.java:
public class WildFlyElytronProvider implements CryptoProvider {

    private Map<String, Object> providers = new ConcurrentHashMap<>();

    public WildFlyElytronProvider() {
        providers.put(CryptoConstants.A128KW, new AesKeyWrapAlgorithmProvider());
        providers.put(CryptoConstants.RSA1_5, new ElytronRsaKeyEncryptionJWEAlgorithmProvider(""RSA/ECB/PKCS1Padding""));
        providers.put(CryptoConstants.RSA_OAEP, new ElytronRsaKeyEncryptionJWEAlgorithmProvider(""RSA/ECB/OAEPWithSHA-1AndMG","ByteArrayInputStream (Critical), read (Critical), reset (Critical), read (Critical), ByteArrayOutputStream (Critical), write (Critical), toByteArray (Critical), write (Critical), write (Critical), order (Critical), test (Critical), CryptoIntegration (Critical), getSignature (Critical), AuthzClient (Critical), getKeyPairGen (Critical), mark (Critical), getKeyFactory (Critical), getAlgorithmProvider (Critical), getCertificateUtils (Critical), getPemUtils (Critical), getKeyStore (Critical), getIdentityExtractorProvider (Critical), ASN1Encoder (High), getEcdsaCryptoProvider (High), getCertStore (High), getCertPathBuilder (High), FIPS1402Provider (High), readTag (High), readTagNumber (High), readLength (High), getOCSPProver (High), getAesCbcCipher (High), getAesGcmCipher (High), detectProvider (High), DefaultCryptoProvider (High), ASN1Decoder (High), readSequence (High), readInteger (High), writeDerSeq (High), writeEncoded (High), getBouncyCastleProvider (High), createECParams (High), getSecretKeyFact (High), getX509CertFactory (High), wrapFactoryForTruststore (High), readNext (High), writeLength (High), concatenate (High), AuthzClientCryptoProvider (High), create (Medium), create (Medium), order (Medium), order (Medium), CryptoProvider (Medium), create (Medium), KeyPair (Medium), testES256 (Medium), testES384 (Medium), testES512 (Medium), order (Medium), order (Medium), lines 81-82 (Medium), lines 61-80 (Medium), WildFlyElytronProvider (Medium), lines 81-93 (Low), ASN1Decoder (Low), ASN1Encoder (Low), lines 1-20 (Low), ECDSAAlgorithmTest (Low), ECDSAAlgorithmTest (Low), getSignature (Low), getSignature (Low)",partial,crypto-related entities are HC but specific provider selection bug not matched
keycloak,3,Add AuthzClientCryptoProvider for authorization client cryptographic operations,"Dead code exists where ASN1Encoder instances are created and written to, but their results are immediately discarded. The actual encoding is performed by new ASN1Encoder instances created in the subsequent return statement, rendering the earlier operations useless.",Low,72,49,15,"field::ByteArrayInputStream (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=1.00] | method::read (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=1.00] | method::reset (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=1.00] | method::read (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=1.00] | field::ByteArrayOutputStream (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::write (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::toByteArray (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::write (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::write (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [Critical, score=1.00] | method::order (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=1.00] | method::test (authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java) [Critical, score=1.00] | class::CryptoIntegration (common/src/main/java/org/keycloak/common/crypto/CryptoIntegration.java) [Critical, score=1.00] | method::getSignature (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.98] | class::AuthzClient (authz/client/src/main/java/org/keycloak/authorization/client/AuthzClient.java) [Critical, score=0.96] | method::getKeyPairGen (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.86] | method::mark (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [Critical, score=0.84] | method::getKeyFactory (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.79] | method::getAlgorithmProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.75] | method::getCertificateUtils (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.75] | method::getPemUtils (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.75] | method::getKeyStore (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.74] | method::getIdentityExtractorProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [Critical, score=0.71] | class::ASN1Encoder (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.69] | method::getEcdsaCryptoProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.64] | method::getCertStore (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.62] | method::getCertPathBuilder (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.62] | class::FIPS1402Provider (crypto/fips1402/src/main/java/org/keycloak/crypto/fips/FIPS1402Provider.java) [High, score=0.62] | method::readTag (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.59] | method::readTagNumber (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.59] | method::readLength (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.59] | method::getOCSPProver (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.59] | method::getAesCbcCipher (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.59] | method::getAesGcmCipher (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.59] | method::detectProvider (common/src/main/java/org/keycloak/common/crypto/CryptoIntegration.java) [High, score=0.57] | class::DefaultCryptoProvider (crypto/default/src/main/java/org/keycloak/crypto/def/DefaultCryptoProvider.java) [High, score=0.57] | class::ASN1Decoder (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.56] | method::readSequence (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.56] | method::readInteger (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.56] | method::writeDerSeq (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.56] | method::writeEncoded (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.56] | method::getBouncyCastleProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::createECParams (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::getSecretKeyFact (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::getX509CertFactory (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::wrapFactoryForTruststore (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.56] | method::readNext (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java) [High, score=0.51] | method::writeLength (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.51] | method::concatenate (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java) [High, score=0.51] | class::AuthzClientCryptoProvider (authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java) [High, score=0.51]","[Critical] field ByteArrayInputStream in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
private final ByteArrayInputStream is;
---
[Critical] method read in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
byte[] read(int length) throws IOException {
        byte[] bytes = new byte[length];
        int totalBytesRead = 0;

        while (totalBytesRead < length) {
            int bytesRead = is.read(bytes, totalBytesRead, length - totalBytesRead);
            if (bytesRead == -1) {
                throw new IOException(String.format(""EOF found reading %d bytes"", length));
            }
            totalBytesRead += bytesRead;
        }
        count += length;
        return bytes;
    }
---
[Critical] method reset in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int reset() {
        int tmp = count;
        is.reset();
        return tmp;
    }
---
[Critical] method read in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int read() {
        int tmp = is.read();
        if (tmp >= 0) {
            count++;
        }
        return tmp;
    }
---
[Critical] field ByteArrayOutputStream in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
private final ByteArrayOutputStream os;
---
[Critical] method write in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
public ASN1Encoder write(BigInteger value) throws IOException {
        writeEncoded(INTEGER, value.toByteArray());
        return this;
    }
---
[Critical] method toByteArray in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
public byte[] toByteArray() {
        return os.toByteArray();
    }
---
[Critical] method write in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
void write(byte[] bytes) throws IOException {
        os.write(bytes);
    }
---
[Critical] method write in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
void write(int b) throws IOException {
        os.write(b);
    }
---
[Critical] method order in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public int order() {
        return 100;
    }
---
[Critical] method test in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
private void test(ECDSAAlgorithm algorithm) throws Exception {
        AuthzClientCryptoProvider prov = new AuthzClientCryptoProvider();
        byte[] data = ""Something to sign"".getBytes(StandardCharsets.UTF_8);
        Signature signature = Signature.getInstance(JavaAlgorithm.getJavaAlgorithm(algorithm.name()));
        signature.initSign(keyPair.getPrivate());
        signature.update(data);
        byte[] sign = signature.sign();
        byte[] rsConcat = prov.getEcdsaCryptoProvider().asn1derToConcatenatedRS(sign, algorithm.getSignatureLength());
        byte[] asn1Des = prov.getEcdsaCryptoProvider().concatenatedRSToASN1DER(rsConcat, algorithm.getSignatureLength());
        byte[] rsConcat2 = prov.getEcdsaCryptoProvider().asn1derToConcatenatedRS(asn1Des, algorithm.getSignatureLength())
---
[Critical] class CryptoIntegration in common/src/main/java/org/keycloak/common/crypto/CryptoIntegration.java:
public class CryptoIntegration {

    protected static final Logger logger = Logger.getLogger(CryptoIntegration.class);

    private static final Object lock = new Object();
    private static volatile CryptoProvider cryptoProvider;

    public static void init(ClassLoader classLoader) {
        if (cryptoProvider == null) {
            synchronized (lock) {
                if (cryptoProvider == null) {
                    cryptoProvider = detectProvider(classLoader);
                    logger.debugv(""java security provider: {0}"", BouncyIntegration.PROVIDER);

                }
            }
        }

        if (logger.isTraceEnabled()) {
            logger.tracef(dumpJavaSecurityProviders());
            logger.tracef(dumpSecurityProperties());
        }
    }

    public static Crypto
---
[Critical] method getSignature in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public Signature getSignature(String sigAlgName) throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] class AuthzClient in authz/client/src/main/java/org/keycloak/authorization/client/AuthzClient.java:
public class AuthzClient {

    private final Http http;
    private TokenCallable patSupplier;

    /**
     * <p>Creates a new instance.
     *
     * <p>This method expects a <code>keycloak.json</code> in the classpath, otherwise an exception will be thrown.
     *
     * @return a new instance
     * @throws RuntimeException in case there is no <code>keycloak.json</code> file in the classpath or the file could not be parsed
     */
    public static AuthzClient create() throws RuntimeException {
        InputStream configStream = Thread.currentThread().getContextClassLoader().getResourceAsStream(""keycloak.json"");

        return create(configStream);
    }

    /**
     * <p>Creates a new instance.
     *
     * @param configStream the input stream with the configuration data
     * @r
---
[Critical] method getKeyPairGen in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public KeyPairGenerator getKeyPairGen(String algorithm) throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method mark in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
void mark() {
        count = 0;
        is.mark(is.available());
    }
---
[Critical] method getKeyFactory in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public KeyFactory getKeyFactory(String algorithm) throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method getAlgorithmProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public <T> T getAlgorithmProvider(Class<T> clazz, String algorithm) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method getCertificateUtils in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public CertificateUtilsProvider getCertificateUtils() {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method getPemUtils in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public PemUtilsProvider getPemUtils() {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[Critical] method getKeyStore in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public KeyStore getKeyStore(KeystoreUtil.KeystoreFormat format) throws KeyStoreException, NoSuchProviderException {
        return KeyStore.getInstance(format.name());
    }
---
[Critical] method getIdentityExtractorProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public UserIdentityExtractorProvider getIdentityExtractorProvider() {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] class ASN1Encoder in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
class ASN1Encoder {

    static final int INTEGER = 0x02;
    static final int SEQUENCE = 0x10;
    static final int CONSTRUCTED = 0x20;

    private final ByteArrayOutputStream os;

    private ASN1Encoder() {
        this.os = new ByteArrayOutputStream();
    }

    static public ASN1Encoder create() {
        return new ASN1Encoder();
    }

    public ASN1Encoder write(BigInteger value) throws IOException {
        writeEncoded(INTEGER, value.toByteArray());
        return this;
    }

    public ASN1Encoder writeDerSeq(ASN1Encoder... objects) throws IOException {
        writeEncoded(CONSTRUCTED | SEQUENCE, concatenate(objects));
        return this;
    }

    public byte[] toByteArray() {
        return os.toByteArray();
    }

    void writeEncoded(int tag, byte[] bytes) throws IOE
---
[High] method getEcdsaCryptoProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public ECDSACryptoProvider getEcdsaCryptoProvider() {
        return new ECDSACryptoProvider() {
            @Override
            public byte[] concatenatedRSToASN1DER(byte[] signature, int signLength) throws IOException {
                int len = signLength / 2;
                int arraySize = len + 1;

                byte[] r = new byte[arraySize];
                byte[] s = new byte[arraySize];
                System.arraycopy(signature, 0, r, 1, len);
                System.arraycopy(signature, len, s, 1, len);
                BigInteger rBigInteger = new BigInteger(r);
                BigInteger sBigInteger = new BigInteger(s);

                ASN1Encoder.create().write(rBigInteger);
                ASN1Encoder.create().write(sBigInteger);

                return ASN
---
[High] method getCertStore in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public CertStore getCertStore(CollectionCertStoreParameters collectionCertStoreParameters) throws InvalidAlgorithmParameterException, NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getCertPathBuilder in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public CertPathBuilder getCertPathBuilder() throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] class FIPS1402Provider in crypto/fips1402/src/main/java/org/keycloak/crypto/fips/FIPS1402Provider.java:
public class FIPS1402Provider implements CryptoProvider {

    private static final Logger log = Logger.getLogger(FIPS1402Provider.class);

    private final BouncyCastleFipsProvider bcFipsProvider;
    private final Map<String, Object> providers = new ConcurrentHashMap<>();

    public FIPS1402Provider() {
        // Case when BCFIPS provider already registered in Java security file
        BouncyCastleFipsProvider existingBcFipsProvider = (BouncyCastleFipsProvider) Security.getProvider(CryptoConstants.BCFIPS_PROVIDER_ID);
        this.bcFipsProvider = existingBcFipsProvider == null ? new BouncyCastleFipsProvider() : existingBcFipsProvider;

        providers.put(CryptoConstants.A128KW, new FIPSAesKeyWrapAlgorithmProvider());
        providers.put(CryptoConstants.RSA1_5, new FIPSRsaKeyEnc
---
[High] method readTag in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int readTag() throws IOException {
        int tag = read();
        if (tag < 0) {
            throw new EOFException(""EOF found inside tag value."");
        }
        return tag;
    }
---
[High] method readTagNumber in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int readTagNumber(int tag) throws IOException {
        int tagNo = tag & 0x1f;

        //
        // with tagged object tag number is bottom 5 bits, or stored at the start of the content
        //
        if (tagNo == 0x1f) {
            tagNo = 0;

            int b = read();

            // X.690-0207 8.1.2.4.2
            // ""c) bits 7 to 1 of the first subsequent octet shall not all be zero.""
            if ((b & 0x7f) == 0) // Note: -1 will pass
            {
                throw new IOException(""corrupted stream - invalid high tag number found"");
            }

            while ((b >= 0) && ((b & 0x80) != 0)) {
                tagNo |= (b & 0x7f);
                tagNo <<= 7;
                b = read();
            }

            if (b < 0) {
                throw new EOFExcepti
---
[High] method readLength in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
int readLength() throws IOException {
        int length = read();
        if (length < 0) {
            throw new EOFException(""EOF found when length expected"");
        }

        if (length == 0x80) {
            return -1;      // indefinite-length encoding
        }

        if (length > 127) {
            int size = length & 0x7f;

            // Note: The invalid long form ""0xff"" (see X.690 8.1.3.5c) will be caught here
            if (size > 4) {
                throw new IOException(""DER length more than 4 bytes: "" + size);
            }

            length = 0;
            for (int i = 0; i < size; i++) {
                int next = read();

                if (next < 0) {
                    throw new EOFException(""EOF found reading length"");
                }

                le
---
[High] method getOCSPProver in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public <T> T getOCSPProver(Class<T> clazz) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getAesCbcCipher in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public Cipher getAesCbcCipher() throws NoSuchAlgorithmException, NoSuchProviderException, NoSuchPaddingException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getAesGcmCipher in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public Cipher getAesGcmCipher() throws NoSuchAlgorithmException, NoSuchProviderException, NoSuchPaddingException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method detectProvider in common/src/main/java/org/keycloak/common/crypto/CryptoIntegration.java:
private static CryptoProvider detectProvider(ClassLoader classLoader) {
        List<CryptoProvider> foundProviders = StreamSupport.stream(ServiceLoader.load(CryptoProvider.class, classLoader).spliterator(), false)
                .sorted(Comparator.comparingInt(CryptoProvider::order).reversed())
                .collect(Collectors.toList());

        if (foundProviders.isEmpty()) {
            throw new IllegalStateException(""Not able to load any cryptoProvider with the classLoader: "" + classLoader);
        } else {
            logger.debugf(""Detected crypto provider: %s"", foundProviders.get(0).getClass().getName());
            if (foundProviders.size() > 1) {
                StringBuilder builder = new StringBuilder(""Ignored crypto providers: "");
                for (int i = 1 ; i < fo
---
[High] class DefaultCryptoProvider in crypto/default/src/main/java/org/keycloak/crypto/def/DefaultCryptoProvider.java:
public class DefaultCryptoProvider implements CryptoProvider {

    private static final Logger log = Logger.getLogger(DefaultCryptoProvider.class);

    private final Provider bcProvider;

    private Map<String, Object> providers = new ConcurrentHashMap<>();

    public DefaultCryptoProvider() {
        // Make sure to instantiate this only once due it is expensive. And skip registration if already available in Java security providers (EG. due explicitly configured in java security file)
        Provider existingBc = Security.getProvider(CryptoConstants.BC_PROVIDER_ID);
        this.bcProvider = existingBc == null ? new BouncyCastleProvider() : existingBc;

        providers.put(CryptoConstants.A128KW, new AesKeyWrapAlgorithmProvider());
        providers.put(CryptoConstants.RSA1_5, new 
---
[High] class ASN1Decoder in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
class ASN1Decoder {

    private final ByteArrayInputStream is;
    private final int limit;
    private int count;

    ASN1Decoder(byte[] bytes) {
        is = new ByteArrayInputStream(bytes);
        count = 0;
        limit = bytes.length;
    }

    public static ASN1Decoder create(byte[] bytes) {
        return new ASN1Decoder(bytes);
    }

    public List<byte[]> readSequence() throws IOException {
        int tag = readTag();
        int tagNo = readTagNumber(tag);
        if (tagNo != ASN1Encoder.SEQUENCE) {
            throw new IOException(""Invalid Sequence tag "" + tagNo);
        }
        int length = readLength();
        List<byte[]> result = new ArrayList<>();
        while (length > 0) {
            byte[] bytes = readNext();
            result.add(bytes);
            len
---
[High] method readSequence in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
public List<byte[]> readSequence() throws IOException {
        int tag = readTag();
        int tagNo = readTagNumber(tag);
        if (tagNo != ASN1Encoder.SEQUENCE) {
            throw new IOException(""Invalid Sequence tag "" + tagNo);
        }
        int length = readLength();
        List<byte[]> result = new ArrayList<>();
        while (length > 0) {
            byte[] bytes = readNext();
            result.add(bytes);
            length = length - bytes.length;
        }
        return result;
    }
---
[High] method readInteger in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
public BigInteger readInteger() throws IOException {
        int tag = readTag();
        int tagNo = readTagNumber(tag);
        if (tagNo != ASN1Encoder.INTEGER) {
            throw new IOException(""Invalid Integer tag "" + tagNo);
        }
        int length = readLength();
        byte[] bytes = read(length);
        return new BigInteger(bytes);
    }
---
[High] method writeDerSeq in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
public ASN1Encoder writeDerSeq(ASN1Encoder... objects) throws IOException {
        writeEncoded(CONSTRUCTED | SEQUENCE, concatenate(objects));
        return this;
    }
---
[High] method writeEncoded in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
void writeEncoded(int tag, byte[] bytes) throws IOException {
        write(tag);
        writeLength(bytes.length);
        write(bytes);
    }
---
[High] method getBouncyCastleProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public Provider getBouncyCastleProvider() {
        try {
            return KeyStore.getInstance(KeyStore.getDefaultType()).getProvider();
        } catch (KeyStoreException e) {
            throw new IllegalStateException(e);
        }
    }
---
[High] method createECParams in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public ECParameterSpec createECParams(String curveName) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getSecretKeyFact in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public SecretKeyFactory getSecretKeyFact(String keyAlgorithm) throws NoSuchAlgorithmException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method getX509CertFactory in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public CertificateFactory getX509CertFactory() throws CertificateException, NoSuchProviderException {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method wrapFactoryForTruststore in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
@Override
    public SSLSocketFactory wrapFactoryForTruststore(SSLSocketFactory delegate) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }
---
[High] method readNext in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
byte[] readNext() throws IOException {
        mark();
        int tag = readTag();
        readTagNumber(tag);
        int length = readLength();
        length += reset();
        return read(length);
    }
---
[High] method writeLength in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
void writeLength(int length) throws IOException {
        if (length > 127) {
            int size = 1;
            int val = length;

            while ((val >>>= 8) != 0) {
                size++;
            }

            write((byte) (size | 0x80));

            for (int i = (size - 1) * 8; i >= 0; i -= 8) {
                write((byte) (length >> i));
            }
        } else {
            write((byte) length);
        }
    }
---
[High] method concatenate in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
byte[] concatenate(ASN1Encoder... objects) throws IOException {
        ByteArrayOutputStream tmp = new ByteArrayOutputStream();
        for (ASN1Encoder object : objects) {
            tmp.write(object.toByteArray());
        }
        return tmp.toByteArray();
    }
---
[High] class AuthzClientCryptoProvider in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/AuthzClientCryptoProvider.java:
public class AuthzClientCryptoProvider implements CryptoProvider {

    @Override
    public Provider getBouncyCastleProvider() {
        try {
            return KeyStore.getInstance(KeyStore.getDefaultType()).getProvider();
        } catch (KeyStoreException e) {
            throw new IllegalStateException(e);
        }
    }

    @Override
    public int order() {
        return 100;
    }

    @Override
    public <T> T getAlgorithmProvider(Class<T> clazz, String algorithm) {
        throw new UnsupportedOperationException(""Not supported yet."");
    }

    @Override
    public CertificateUtilsProvider getCertificateUtils() {
        throw new UnsupportedOperationException(""Not supported yet."");
    }

    @Override
    public PemUtilsProvider getPemUtils() {
        throw new Unsupport","[Medium] method create in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Decoder.java:
public static ASN1Decoder create(byte[] bytes) {
        return new ASN1Decoder(bytes);
    }
---
[Medium] method create in authz/client/src/main/java/org/keycloak/authorization/client/util/crypto/ASN1Encoder.java:
static public ASN1Encoder create() {
        return new ASN1Encoder();
    }
---
[Medium] method order in crypto/default/src/main/java/org/keycloak/crypto/def/DefaultCryptoProvider.java:
@Override
    public int order() {
        return 200;
    }
---
[Medium] method order in crypto/fips1402/src/main/java/org/keycloak/crypto/fips/FIPS1402Provider.java:
@Override
    public int order() {
        return 200;
    }
---
[Medium] interface CryptoProvider in common/src/main/java/org/keycloak/common/crypto/CryptoProvider.java:
public interface CryptoProvider {

    /**
     * @return BouncyCastle security provider. Can be either non-FIPS or FIPS based provider
     */
    Provider getBouncyCastleProvider();

    /**
     * Order of this provider. This allows to specify which CryptoProvider will have preference in case that more of them are on the classpath.
     *
     * The higher number has preference over the lower number
     */
    int order();

    /**
     * Get some algorithm provider implementation. Returned 
---
[Medium] method create in authz/client/src/main/java/org/keycloak/authorization/client/AuthzClient.java:
public static AuthzClient create(Configuration configuration) {
        CryptoIntegration.init(AuthzClient.class.getClassLoader());
        return new AuthzClient(configuration);
    }
---
[Medium] field KeyPair in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
private final KeyPair keyPair;
---
[Medium] method testES256 in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
@Test
    public void testES256() throws Exception {
        test(ECDSAAlgorithm.ES256);
    }
---
[Medium] method testES384 in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
@Test
    public void testES384() throws Exception {
        test(ECDSAAlgorithm.ES384);
    }
---
[Medium] method testES512 in authz/client/src/test/java/org/keycloak/authorization/client/test/ECDSAAlgorithmTest.java:
@Test
    public void testES512() throws Exception {
        test(ECDSAAlgorithm.ES512);
    }
---
[Medium] method order in common/src/main/java/org/keycloak/common/crypto/CryptoProvider.java:
int order();
---
[Medium] method order in crypto/elytron/src/main/java/org/keycloak/crypto/elytron/WildFlyElytronProvider.java:
@Override
    public int order() {
        return 200;
    }
---
[Medium] chunk lines 81-82 in authz/client/pom.xml:
    
</project>
---
[Medium] chunk lines 61-80 in authz/client/pom.xml:

        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.hamcrest</groupId>
            <artifactId>hamcrest</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-javadoc-plugi
---
[Medium] class WildFlyElytronProvider in crypto/elytron/src/main/java/org/keycloak/crypto/elytron/WildFlyElytronProvider.java:
public class WildFlyElytronProvider implements CryptoProvider {

    private Map<String, Object> providers = new ConcurrentHashMap<>();

    public WildFlyElytronProvider() {
        providers.put(CryptoConstants.A128KW, new AesKeyWrapAlgorithmProvider());
        providers.put(CryptoConstants.RSA1_5, new ElytronRsaKeyEncryptionJWEAlgorithmProvider(""RSA/ECB/PKCS1Padding""));
        providers.put(CryptoConstants.RSA_OAEP, new ElytronRsaKeyEncryptionJWEAlgorithmProvider(""RSA/ECB/OAEPWithSHA-1AndMG","ByteArrayInputStream (Critical), read (Critical), reset (Critical), read (Critical), ByteArrayOutputStream (Critical), write (Critical), toByteArray (Critical), write (Critical), write (Critical), order (Critical), test (Critical), CryptoIntegration (Critical), getSignature (Critical), AuthzClient (Critical), getKeyPairGen (Critical), mark (Critical), getKeyFactory (Critical), getAlgorithmProvider (Critical), getCertificateUtils (Critical), getPemUtils (Critical), getKeyStore (Critical), getIdentityExtractorProvider (Critical), ASN1Encoder (High), getEcdsaCryptoProvider (High), getCertStore (High), getCertPathBuilder (High), FIPS1402Provider (High), readTag (High), readTagNumber (High), readLength (High), getOCSPProver (High), getAesCbcCipher (High), getAesGcmCipher (High), detectProvider (High), DefaultCryptoProvider (High), ASN1Decoder (High), readSequence (High), readInteger (High), writeDerSeq (High), writeEncoded (High), getBouncyCastleProvider (High), createECParams (High), getSecretKeyFact (High), getX509CertFactory (High), wrapFactoryForTruststore (High), readNext (High), writeLength (High), concatenate (High), AuthzClientCryptoProvider (High), create (Medium), create (Medium), order (Medium), order (Medium), CryptoProvider (Medium), create (Medium), KeyPair (Medium), testES256 (Medium), testES384 (Medium), testES512 (Medium), order (Medium), order (Medium), lines 81-82 (Medium), lines 61-80 (Medium), WildFlyElytronProvider (Medium), lines 81-93 (Low), ASN1Decoder (Low), ASN1Encoder (Low), lines 1-20 (Low), ECDSAAlgorithmTest (Low), ECDSAAlgorithmTest (Low), getSignature (Low), getSignature (Low)",partial,ASN1Decoder is HC but ASN1Encoder dead code not specifically flagged
keycloak,2,Add caching support for IdentityProviderStorageProvider.getForLogin operations,Recursive caching call using session instead of delegate,Critical,16,2,12,"method::getForLogin (model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java) [High, score=0.59] | method::cacheKeyForLogin (model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java) [High, score=0.54]","[High] method getForLogin in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
@Override
    public Stream<IdentityProviderModel> getForLogin(FetchMode mode, String organizationId) {
        String cacheKey = cacheKeyForLogin(getRealm(), mode);

        if (isInvalid(cacheKey)) {
            return idpDelegate.getForLogin(mode, organizationId).map(this::createOrganizationAwareIdentityProviderModel);
        }

        RealmCacheManager cache = realmCache.getCache();
        IdentityProviderListQuery query = cache.get(cacheKey, IdentityProviderListQuery.class);
        String searchKey = organizationId != null ? organizationId : """";
        Set<String> cached;

        if (query == null) {
            // not cached yet
            Long loaded = cache.getCurrentRevision(cacheKey);
            cached = idpDelegate.getForLogin(mode, organizationId).map(IdentityProviderMo
---
[High] method cacheKeyForLogin in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
public static String cacheKeyForLogin(RealmModel realm, FetchMode fetchMode) {
        return realm.getId() + IDP_LOGIN_SUFFIX + ""."" + fetchMode;
    }","[Medium] method getLoginPredicate in server-spi/src/main/java/org/keycloak/models/IdentityProviderStorageProvider.java:
public static Predicate<IdentityProviderModel> getLoginPredicate() {
            return ((Predicate<IdentityProviderModel>) Objects::nonNull)
                    .and(idp -> idp.getOrganizationId() == null || Boolean.parseBoolean(idp.getConfig().get(OrganizationModel.BROKER_PUBLIC)))
                    .and(Stream.of(values()).map(LoginFilter::getFilter).reduce(Predicate::and).get());
        }
---
[Medium] method update in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
@Override
    public void update(IdentityProviderModel model) {
        // for cases the alias is being updated, it is needed to lookup the idp by id to obtain the original alias
        IdentityProviderModel idpById = getById(model.getInternalId());
        registerIDPInvalidation(idpById);
        registerIDPLoginInvalidationOnUpdate(idpById, model);
        idpDelegate.update(model);
    }
---
[Medium] class InfinispanIdentityProviderStorageProvider in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
public class InfinispanIdentityProviderStorageProvider implements IdentityProviderStorageProvider {

    private static final String IDP_COUNT_KEY_SUFFIX = "".idp.count"";
    private static final String IDP_ALIAS_KEY_SUFFIX = "".idp.alias"";
    private static final String IDP_ORG_ID_KEY_SUFFIX = "".idp.orgId"";
    private static final String IDP_LOGIN_SUFFIX = "".idp.login"";

    private final KeycloakSession session;
    private final IdentityProviderStorageProvider idpDelegate;
    private final R
---
[Medium] enum LoginFilter in server-spi/src/main/java/org/keycloak/models/IdentityProviderStorageProvider.java:
enum LoginFilter {

        ENABLED(IdentityProviderModel.ENABLED, Boolean.TRUE.toString(), IdentityProviderModel::isEnabled),

        LINK_ONLY(IdentityProviderModel.LINK_ONLY, Boolean.FALSE.toString(), Predicate.not(IdentityProviderModel::isLinkOnly)),

        HIDE_ON_LOGIN(IdentityProviderModel.HIDE_ON_LOGIN, Boolean.FALSE.toString(), Predicate.not(IdentityProviderModel::isHideOnLogin));

        private final String key;
        private final String value;
        private final Predicate<I
---
[Medium] method registerIDPLoginInvalidation in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
private void registerIDPLoginInvalidation(IdentityProviderModel idp) {
        // only invalidate login caches if the IDP qualifies as a login IDP.
        if (getLoginPredicate().test(idp)) {
            for (FetchMode mode : FetchMode.values()) {
                realmCache.registerInvalidation(cacheKeyForLogin(getRealm(), mode));
            }
        }
    }
---
[Medium] class OrganizationAwareIdentityProviderBean in services/src/main/java/org/keycloak/organization/forms/login/freemarker/model/OrganizationAwareIdentityProviderBean.java:
public class OrganizationAwareIdentityProviderBean extends IdentityProviderBean {

    private final OrganizationModel organization;
    private final boolean onlyRealmBrokers;
    private final boolean onlyOrganizationBrokers;

    public OrganizationAwareIdentityProviderBean(IdentityProviderBean delegate) {
        this(delegate, false);
    }

    public OrganizationAwareIdentityProviderBean(IdentityProviderBean delegate,  boolean onlyOrganizationBrokers) {
        this(delegate, onlyOrganiza
---
[Medium] method registerIDPLoginInvalidationOnUpdate in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
private void registerIDPLoginInvalidationOnUpdate(IdentityProviderModel original, IdentityProviderModel updated) {
        // IDP isn't currently available for login and update preserves that - no need to invalidate.
        if (!getLoginPredicate().test(original) && !getLoginPredicate().test(updated)) {
            return;
        }
        // IDP is currently available for login and update preserves that, including organization link - no need to invalidate.
        if (getLoginPredicate().test
---
[Medium] method remove in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
@Override
    public boolean remove(String alias) {
        String cacheKey = cacheKeyIdpAlias(getRealm(), alias);
        IdentityProviderModel storedIdp = idpDelegate.getByAlias(alias);
        if (isInvalid(cacheKey)) {
            //lookup idp by alias in cache to be able to invalidate its internalId
            registerIDPInvalidation(storedIdp);
        } else {
            CachedIdentityProvider cached = realmCache.getCache().get(cacheKey, CachedIdentityProvider.class);
            if (ca
---
[Medium] method create in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
@Override
    public IdentityProviderModel create(IdentityProviderModel model) {
        registerCountInvalidation();
        registerIDPLoginInvalidation(model);
        return idpDelegate.create(model);
    }
---
[Medium] method testCacheIDPForLogin in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/organization/cache/OrganizationCacheTest.java:
@Test
    public void testCacheIDPForLogin() {
        // create 20 providers, and associate 10 of them with an organization.
        for (int i = 0; i < 20; i++) {
            IdentityProviderRepresentation idpRep = new IdentityProviderRepresentation();
            idpRep.setAlias(""idp-alias-"" + i);
            idpRep.setEnabled((i % 2) == 0); // half of the IDPs will be disabled and won't qualify for login.
            idpRep.setDisplayName(""Broker "" + i);
            idpRep.setProviderId(""key
---
[Medium] field String in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
private static final String IDP_LOGIN_SUFFIX = "".idp.login"";
---
[Medium] class OrganizationCacheTest in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/organization/cache/OrganizationCacheTest.java:
@EnableFeature(Feature.ORGANIZATION)
public class OrganizationCacheTest extends AbstractOrganizationTest {

    @Before
    public void onBefore() {
        createOrganization(""orga"");
        createOrganization(""orgb"");
    }

    @After
    public void onAfter() {
        List<UserRepresentation> users = testRealm().users().search(""member"");

        if (!users.isEmpty()) {
            UserRepresentation member = users.get(0);
            testRealm().users().get(member.getId()).remove();
     ","getForLogin (High), cacheKeyForLogin (High), getLoginPredicate (Medium), update (Medium), InfinispanIdentityProviderStorageProvider (Medium), LoginFilter (Medium), registerIDPLoginInvalidation (Medium), OrganizationAwareIdentityProviderBean (Medium), registerIDPLoginInvalidationOnUpdate (Medium), remove (Medium), create (Medium), testCacheIDPForLogin (Medium), String (Medium), OrganizationCacheTest (Medium), IdentityProviderStorageProvider (Low), searchForIdentityProviders (Low)",partial,"HC entities exist (2) but no name match; golden idents: {'delegate', 'Recursive', 'caching', 'session'}"
keycloak,2,Add caching support for IdentityProviderStorageProvider.getForLogin operations,Cleanup reference uses incorrect alias - should be 'idp-alias-' + i instead of 'alias'.,Medium,16,2,12,"method::getForLogin (model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java) [High, score=0.59] | method::cacheKeyForLogin (model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java) [High, score=0.54]","[High] method getForLogin in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
@Override
    public Stream<IdentityProviderModel> getForLogin(FetchMode mode, String organizationId) {
        String cacheKey = cacheKeyForLogin(getRealm(), mode);

        if (isInvalid(cacheKey)) {
            return idpDelegate.getForLogin(mode, organizationId).map(this::createOrganizationAwareIdentityProviderModel);
        }

        RealmCacheManager cache = realmCache.getCache();
        IdentityProviderListQuery query = cache.get(cacheKey, IdentityProviderListQuery.class);
        String searchKey = organizationId != null ? organizationId : """";
        Set<String> cached;

        if (query == null) {
            // not cached yet
            Long loaded = cache.getCurrentRevision(cacheKey);
            cached = idpDelegate.getForLogin(mode, organizationId).map(IdentityProviderMo
---
[High] method cacheKeyForLogin in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
public static String cacheKeyForLogin(RealmModel realm, FetchMode fetchMode) {
        return realm.getId() + IDP_LOGIN_SUFFIX + ""."" + fetchMode;
    }","[Medium] method getLoginPredicate in server-spi/src/main/java/org/keycloak/models/IdentityProviderStorageProvider.java:
public static Predicate<IdentityProviderModel> getLoginPredicate() {
            return ((Predicate<IdentityProviderModel>) Objects::nonNull)
                    .and(idp -> idp.getOrganizationId() == null || Boolean.parseBoolean(idp.getConfig().get(OrganizationModel.BROKER_PUBLIC)))
                    .and(Stream.of(values()).map(LoginFilter::getFilter).reduce(Predicate::and).get());
        }
---
[Medium] method update in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
@Override
    public void update(IdentityProviderModel model) {
        // for cases the alias is being updated, it is needed to lookup the idp by id to obtain the original alias
        IdentityProviderModel idpById = getById(model.getInternalId());
        registerIDPInvalidation(idpById);
        registerIDPLoginInvalidationOnUpdate(idpById, model);
        idpDelegate.update(model);
    }
---
[Medium] class InfinispanIdentityProviderStorageProvider in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
public class InfinispanIdentityProviderStorageProvider implements IdentityProviderStorageProvider {

    private static final String IDP_COUNT_KEY_SUFFIX = "".idp.count"";
    private static final String IDP_ALIAS_KEY_SUFFIX = "".idp.alias"";
    private static final String IDP_ORG_ID_KEY_SUFFIX = "".idp.orgId"";
    private static final String IDP_LOGIN_SUFFIX = "".idp.login"";

    private final KeycloakSession session;
    private final IdentityProviderStorageProvider idpDelegate;
    private final R
---
[Medium] enum LoginFilter in server-spi/src/main/java/org/keycloak/models/IdentityProviderStorageProvider.java:
enum LoginFilter {

        ENABLED(IdentityProviderModel.ENABLED, Boolean.TRUE.toString(), IdentityProviderModel::isEnabled),

        LINK_ONLY(IdentityProviderModel.LINK_ONLY, Boolean.FALSE.toString(), Predicate.not(IdentityProviderModel::isLinkOnly)),

        HIDE_ON_LOGIN(IdentityProviderModel.HIDE_ON_LOGIN, Boolean.FALSE.toString(), Predicate.not(IdentityProviderModel::isHideOnLogin));

        private final String key;
        private final String value;
        private final Predicate<I
---
[Medium] method registerIDPLoginInvalidation in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
private void registerIDPLoginInvalidation(IdentityProviderModel idp) {
        // only invalidate login caches if the IDP qualifies as a login IDP.
        if (getLoginPredicate().test(idp)) {
            for (FetchMode mode : FetchMode.values()) {
                realmCache.registerInvalidation(cacheKeyForLogin(getRealm(), mode));
            }
        }
    }
---
[Medium] class OrganizationAwareIdentityProviderBean in services/src/main/java/org/keycloak/organization/forms/login/freemarker/model/OrganizationAwareIdentityProviderBean.java:
public class OrganizationAwareIdentityProviderBean extends IdentityProviderBean {

    private final OrganizationModel organization;
    private final boolean onlyRealmBrokers;
    private final boolean onlyOrganizationBrokers;

    public OrganizationAwareIdentityProviderBean(IdentityProviderBean delegate) {
        this(delegate, false);
    }

    public OrganizationAwareIdentityProviderBean(IdentityProviderBean delegate,  boolean onlyOrganizationBrokers) {
        this(delegate, onlyOrganiza
---
[Medium] method registerIDPLoginInvalidationOnUpdate in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
private void registerIDPLoginInvalidationOnUpdate(IdentityProviderModel original, IdentityProviderModel updated) {
        // IDP isn't currently available for login and update preserves that - no need to invalidate.
        if (!getLoginPredicate().test(original) && !getLoginPredicate().test(updated)) {
            return;
        }
        // IDP is currently available for login and update preserves that, including organization link - no need to invalidate.
        if (getLoginPredicate().test
---
[Medium] method remove in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
@Override
    public boolean remove(String alias) {
        String cacheKey = cacheKeyIdpAlias(getRealm(), alias);
        IdentityProviderModel storedIdp = idpDelegate.getByAlias(alias);
        if (isInvalid(cacheKey)) {
            //lookup idp by alias in cache to be able to invalidate its internalId
            registerIDPInvalidation(storedIdp);
        } else {
            CachedIdentityProvider cached = realmCache.getCache().get(cacheKey, CachedIdentityProvider.class);
            if (ca
---
[Medium] method create in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
@Override
    public IdentityProviderModel create(IdentityProviderModel model) {
        registerCountInvalidation();
        registerIDPLoginInvalidation(model);
        return idpDelegate.create(model);
    }
---
[Medium] method testCacheIDPForLogin in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/organization/cache/OrganizationCacheTest.java:
@Test
    public void testCacheIDPForLogin() {
        // create 20 providers, and associate 10 of them with an organization.
        for (int i = 0; i < 20; i++) {
            IdentityProviderRepresentation idpRep = new IdentityProviderRepresentation();
            idpRep.setAlias(""idp-alias-"" + i);
            idpRep.setEnabled((i % 2) == 0); // half of the IDPs will be disabled and won't qualify for login.
            idpRep.setDisplayName(""Broker "" + i);
            idpRep.setProviderId(""key
---
[Medium] field String in model/infinispan/src/main/java/org/keycloak/models/cache/infinispan/idp/InfinispanIdentityProviderStorageProvider.java:
private static final String IDP_LOGIN_SUFFIX = "".idp.login"";
---
[Medium] class OrganizationCacheTest in testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/organization/cache/OrganizationCacheTest.java:
@EnableFeature(Feature.ORGANIZATION)
public class OrganizationCacheTest extends AbstractOrganizationTest {

    @Before
    public void onBefore() {
        createOrganization(""orga"");
        createOrganization(""orgb"");
    }

    @After
    public void onAfter() {
        List<UserRepresentation> users = testRealm().users().search(""member"");

        if (!users.isEmpty()) {
            UserRepresentation member = users.get(0);
            testRealm().users().get(member.getId()).remove();
     ","getForLogin (High), cacheKeyForLogin (High), getLoginPredicate (Medium), update (Medium), InfinispanIdentityProviderStorageProvider (Medium), LoginFilter (Medium), registerIDPLoginInvalidation (Medium), OrganizationAwareIdentityProviderBean (Medium), registerIDPLoginInvalidationOnUpdate (Medium), remove (Medium), create (Medium), testCacheIDPForLogin (Medium), String (Medium), OrganizationCacheTest (Medium), IdentityProviderStorageProvider (Low), searchForIdentityProviders (Low)",match,'idp' matches entity 'testcacheidpforlogin'
keycloak,1,Fixing Re-authentication with passkeys,ConditionalPasskeysEnabled() called without UserModel parameter,Medium,4,1,3,"method::isConditionalPasskeysEnabled (services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java) [Critical, score=0.70]","[Critical] method isConditionalPasskeysEnabled in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
protected boolean isConditionalPasskeysEnabled(UserModel user) {
        return webauthnAuth != null && webauthnAuth.isPasskeysEnabled() && user != null;
    }","[Medium] method challenge in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
@Override
    protected Response challenge(AuthenticationFlowContext context, String error, String field) {
        if (isConditionalPasskeysEnabled(context.getUser())) {
            // setup webauthn data when possible
            webauthnAuth.fillContextForm(context);
        }
        return super.challenge(context, error, field);
    }
---
[Medium] method authenticate in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
@Override
    public void authenticate(AuthenticationFlowContext context) {
        MultivaluedMap<String, String> formData = new MultivaluedHashMap<>();
        String loginHint = context.getAuthenticationSession().getClientNote(OIDCLoginProtocol.LOGIN_HINT_PARAM);

        String rememberMeUsername = AuthenticationManager.getRememberMeUsername(context.getSession());

        if (context.getUser() != null) {
            if (alreadyAuthenticatedUsingPasswordlessCredential(context)) {
           
---
[Medium] class UsernamePasswordForm in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
public class UsernamePasswordForm extends AbstractUsernameFormAuthenticator implements Authenticator {

    protected final WebAuthnConditionalUIAuthenticator webauthnAuth;

    public UsernamePasswordForm() {
        webauthnAuth = null;
    }

    public UsernamePasswordForm(KeycloakSession session) {
        webauthnAuth = new WebAuthnConditionalUIAuthenticator(session, (context) -> createLoginForm(context.form()));
    }

    @Override
    public void action(AuthenticationFlowContext context","isConditionalPasskeysEnabled (Critical), challenge (Medium), authenticate (Medium), UsernamePasswordForm (Medium)",match,'ConditionalPasskeysEnabled' matches HC entity 'isconditionalpasskeysenabled'
keycloak,1,Fixing Re-authentication with passkeys,"With isConditionalPasskeysEnabled(UserModel user) requiring user != null, authenticate(...) will not call webauthnAuth.fillContextForm(context) on the initial login page where context.getUser() is still null, so conditional passkey UI will not be set up for first-time passkey login. Consider whether this should also be enabled when no user has been selected yet so ID-less passkey authentication on the initial login form continues to work.",Medium,4,1,3,"method::isConditionalPasskeysEnabled (services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java) [Critical, score=0.70]","[Critical] method isConditionalPasskeysEnabled in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
protected boolean isConditionalPasskeysEnabled(UserModel user) {
        return webauthnAuth != null && webauthnAuth.isPasskeysEnabled() && user != null;
    }","[Medium] method challenge in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
@Override
    protected Response challenge(AuthenticationFlowContext context, String error, String field) {
        if (isConditionalPasskeysEnabled(context.getUser())) {
            // setup webauthn data when possible
            webauthnAuth.fillContextForm(context);
        }
        return super.challenge(context, error, field);
    }
---
[Medium] method authenticate in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
@Override
    public void authenticate(AuthenticationFlowContext context) {
        MultivaluedMap<String, String> formData = new MultivaluedHashMap<>();
        String loginHint = context.getAuthenticationSession().getClientNote(OIDCLoginProtocol.LOGIN_HINT_PARAM);

        String rememberMeUsername = AuthenticationManager.getRememberMeUsername(context.getSession());

        if (context.getUser() != null) {
            if (alreadyAuthenticatedUsingPasswordlessCredential(context)) {
           
---
[Medium] class UsernamePasswordForm in services/src/main/java/org/keycloak/authentication/authenticators/browser/UsernamePasswordForm.java:
public class UsernamePasswordForm extends AbstractUsernameFormAuthenticator implements Authenticator {

    protected final WebAuthnConditionalUIAuthenticator webauthnAuth;

    public UsernamePasswordForm() {
        webauthnAuth = null;
    }

    public UsernamePasswordForm(KeycloakSession session) {
        webauthnAuth = new WebAuthnConditionalUIAuthenticator(session, (context) -> createLoginForm(context.form()));
    }

    @Override
    public void action(AuthenticationFlowContext context","isConditionalPasskeysEnabled (Critical), challenge (Medium), authenticate (Medium), UsernamePasswordForm (Medium)",match,'conditional' matches HC entity 'isconditionalpasskeysenabled'
discourse,10,FEATURE: Can edit category/host relationships for embedding,NoMethodError before_validation in EmbeddableHost,Critical,68,5,42,"class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.96] | class::Topic (app/models/topic.rb) [Critical, score=0.90] | class::SiteSetting (app/models/site_setting.rb) [Critical, score=0.89] | class::EmbeddableHost (app/models/embeddable_host.rb) [Critical, score=0.81] | class::TopicRetriever (lib/topic_retriever.rb) [High, score=0.51]","[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_uniqueness_of :embed_url

  def self.normalize_url(url)
    url.downcase.sub(/\/$/, '').sub(/\-+/, '-').strip
  end

  def self.imported_from_html(url)
    ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""
  end

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    if SiteSetting.embed_truncate
      contents = first_paragraph_from(contents)
    end
    contents ||= ''
    contents << imported_from_html(url)

    url = normalize_url(url)

    embed = TopicEmbed.find_by(""lower(embed_url) = ?"", url)
    content_sha1 = Digest::SHA1.he
---
[Critical] class Topic in app/models/topic.rb:
class Topic < ActiveRecord::Base
  include ActionView::Helpers::SanitizeHelper
  include RateLimiter::OnCreateRecord
  include HasCustomFields
  include Trashable
  include LimitedEdit
  extend Forwardable

  def_delegator :featured_users, :user_ids, :featured_user_ids
  def_delegator :featured_users, :choose, :feature_topic_users

  def_delegator :notifier, :watch!, :notify_watch!
  def_delegator :notifier, :tracking!, :notify_tracking!
  def_delegator :notifier, :regular!, :notify_regular!
  def_delegator :notifier, :muted!, :notify_muted!
  def_delegator :notifier, :toggle_mute, :toggle_mute

  attr_accessor :allowed_user_ids

  def self.max_sort_order
    2**31 - 1
  end

  def featured_users
    @featured_users ||= TopicFeaturedUsers.new(self)
  end

  def trash!(trashed_by=nil)
    u
---
[Critical] class SiteSetting in app/models/site_setting.rb:
class SiteSetting < ActiveRecord::Base
  extend SiteSettingExtension

  validates_presence_of :name
  validates_presence_of :data_type

  after_save do |site_setting|
    DiscourseEvent.trigger(:site_setting_saved, site_setting)
    true
  end

  def self.load_settings(file)
    SiteSettings::YamlLoader.new(file).load do |category, name, default, opts|
      if opts.delete(:client)
        client_setting(name, default, opts.merge(category: category))
      else
        setting(name, default, opts.merge(category: category))
      end
    end
  end

  load_settings(File.join(Rails.root, 'config', 'site_settings.yml'))

  unless Rails.env.test? && ENV['LOAD_PLUGINS'] != ""1""
    Dir[File.join(Rails.root, ""plugins"", ""*"", ""config"", ""settings.yml"")].each do |file|
      load_settings(file)
    en
---
[Critical] class EmbeddableHost in app/models/embeddable_host.rb:
class EmbeddableHost < ActiveRecord::Base
  validates_format_of :host, :with => /\A[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?\Z/i
  belongs_to :category

  before_validation do
    self.host.sub!(/^https?:\/\//, '')
    self.host.sub!(/\/.*$/, '')
  end

  def self.record_for_host(host)
    uri = URI(host) rescue nil
    return false unless uri.present?

    host = uri.host
    return false unless host.present?

    where(""lower(host) = ?"", host).first
  end

  def self.host_allowed?(host)
    record_for_host(host).present?
  end

end
---
[High] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @author_username = opts[:author_username]
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      !EmbeddableHost.host_allowed?(@embed_url)
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return false if @opts[:no_throttle]

      # Throttle other users to once every 60 seconds
      retrieved_key = ""retrieved:#{@embed_url}""
      if $redis.setnx(retrieved_key, ""1"")
        $redis.expire(retrieved_key, 60)
        return false
      end

      true
    end

    def perform_retrieve
      # It's possible another process or job found the embe","[Medium] class EmbeddableHostSerializer in app/serializers/embeddable_host_serializer.rb:
class EmbeddableHostSerializer < ApplicationSerializer
  attributes :id, :host, :category_id

  def id
    object.id
  end

  def host
    object.host
  end

  def category_id
    object.category_id
  end
end
---
[Medium] method save_host in app/controllers/admin/embeddable_hosts_controller.rb:
def save_host(host)
      host.host = params[:embeddable_host][:host]
      host.category_id = params[:embeddable_host][:category_id]
      host.category_id = SiteSetting.uncategorized_category_id if host.category_id.blank?

      if host.save
        render_serialized(host, EmbeddableHostSerializer, root: 'embeddable_host', rest_serializer: true)
      else
        render_json_error(host)
      end
    end
---
[Medium] class EmbeddingSerializer in app/serializers/embedding_serializer.rb:
class EmbeddingSerializer < ApplicationSerializer
  attributes :id
  has_many :embeddable_hosts, serializer: EmbeddableHostSerializer, embed: :ids

  def id
    object.id
  end
end
---
[Medium] method create in app/controllers/admin/embeddable_hosts_controller.rb:
def create
    save_host(EmbeddableHost.new)
  end
---
[Medium] method update in app/controllers/admin/embeddable_hosts_controller.rb:
def update
    host = EmbeddableHost.where(id: params[:id]).first
    save_host(host)
  end
---
[Medium] method fetch_embedding in app/controllers/admin/embedding_controller.rb:
def fetch_embedding
      @embedding = OpenStruct.new({
        id: 'default',
        embeddable_hosts: EmbeddableHost.all.order(:host)
      })
    end
---
[Medium] chunk lines 61-80 in test/javascripts/helpers/create-pretender.js.es6:
    const fixturesByUrl = {};

    // Load any fixtures automatically
    const self = this;
    Ember.keys(require._eak_seen).forEach(function(entry) {
      if (/^fixtures/.test(entry)) {
        const fixture = require(entry, null, null, true);
        if (fixture && fixture.default) {
          const obj = fixture.default;
          Ember.keys(obj).forEach(function(url) {
            fixturesByUrl[url] = obj[url];
            self.get(url, function() {
              return response(obj[url])
---
[Medium] chunk lines 1-18 in app/assets/javascripts/admin/controllers/admin-embedding.js.es6:
export default Ember.Controller.extend({
  embedding: null,

  actions: {
    saveChanges() {
      this.get('embedding').update({});
    },

    addHost() {
      const host = this.store.createRecord('embeddable-host');
      this.get('embedding.embeddable_hosts').pushObject(host);
    },

    deleteHost(host) {
      this.get('embedding.embeddable_hosts').removeObject(host);
    }
  }
});
---
[Medium] chunk lines 1-9 in app/assets/javascripts/admin/routes/admin-embedding.js.es6:
export default Ember.Route.extend({
  model() {
    return this.store.find('embedding');
  },

  setupController(controller, model) {
    controller.set('embedding', model);
  }
});
---
[Medium] method destroy in app/controllers/admin/embeddable_hosts_controller.rb:
def destroy
    host = EmbeddableHost.where(id: params[:id]).first
    host.destroy
    render json: success_json
  end
---
[Medium] method show in app/controllers/admin/embedding_controller.rb:
def show
    render_serialized(@embedding, EmbeddingSerializer, root: 'embedding', rest_serializer: true)
  end
---
[Medium] method update in app/controllers/admin/embedding_controller.rb:
def update
    render_serialized(@embedding, EmbeddingSerializer, root: 'embedding', rest_serializer: true)
  end
---
[Medium] method change in db/migrate/20150818190757_create_embeddable_hosts.rb:
def change
    create_table :embeddable_hosts, force: true do |t|
      t.string :host, null: false
      t.integer :category_id, null: false
      t.timestamps
    end

    category_id = execute(""SELECT c.id FROM categories AS c
                        INNER JOIN site_settings AS s ON s.value = c.name
                        WHERE s.name = 'embed_category'"")[0]['id'].to_i


    if category_id == 0
      category_id = execute(""SELECT value FROM site_settings WHERE name = 'uncategorized_category_
---
[Medium] chunk lines 221-230 in app/assets/javascripts/discourse/models/store.js.es6:
      const klass = this.container.lookupFactory('model:' + type) || RestModel;
      existing.setProperties(klass.munge(obj));
      return existing;
    }

    return this._build(type, obj);
  }
});

export { flushMap };
---
[Medium] method allows_embeddable_host? in app/models/site_setting.rb:
def self.allows_embeddable_host?(host)
    return false if embeddable_hosts.blank?
    uri = URI(host) rescue nil
    return false unless uri.present?

    host = uri.host
    return false unless host.present?

    !!embeddable_hosts.split(""\n"").detect {|h| h.sub(/^https?\:\/\//, '') == host }

    hosts = embeddable_hosts.split(""\n"").map {|h| (URI(h).host rescue nil) || h  }
    !!hosts.detect {|h| h == host}
  end
---
[Medium] chunk lines 301-302 in test/javascripts/helpers/create-pretender.js.es6:
  return server;
}
---
[Medium] chunk lines 121-124 in test/javascripts/models/store-test.js.es6:
    equal(fruits.objectAt(0).get('farmer'), fruits.objectAt(1).get('farmer'), 'points at the same object');
    equal(fruits.objectAt(2).get('farmer.name'), 'Luke Skywalker');
  });
});
---
[Medium] chunk lines 101-120 in test/javascripts/helpers/create-pretender.js.es6:

    this.put('/users/eviltrout', () => {
      return response({ user: {} });
    });

    this.get(""/t/280.json"", function() {
      return response(fixturesByUrl['/t/280/1.json']);
    });

    this.get(""/t/28830.json"", function() {
      return response(fixturesByUrl['/t/28830/1.json']);
    });

    this.get(""/t/id_for/:slug"", function() {
      return response({id: 280, slug: ""internationalization-localization"", url: ""/t/internationalization-localization/280""});
    });

    this.get(""/404
---
[Medium] chunk lines 81-100 in test/javascripts/helpers/create-pretender.js.es6:

    this.get(""/latest.json"", () => {
      const json = fixturesByUrl['/latest.json'];

      if (loggedIn()) {
        // Stuff to let us post
        json.topic_list.can_create_topic = true;
        json.topic_list.draft_key = ""new_topic"";
        json.topic_list.draft_sequence = 1;
      }
      return response(json);
    });

    this.get('/users/eviltrout.json', () => {
      const json = fixturesByUrl['/users/eviltrout.json'];
      if (loggedIn()) {
        json.user.can_edit = true;
   
---
[Medium] chunk lines 121-140 in test/javascripts/helpers/create-pretender.js.es6:

    this.delete('/draft.json', success);

    this.get('/users/:username/staff-info.json', () => response({}));

    this.put('/categories/:category_id', function(request) {
      const category = parsePostData(request.requestBody);
      return response({category});
    });

    this.get('/draft.json', function() {
      return response({});
    });

    this.put('/queued_posts/:queued_post_id', function(request) {
      return response({ queued_post: {id: request.params.queued_post_id } });
 
---
[Medium] chunk lines 41-60 in app/assets/javascripts/admin/routes/admin-route-map.js.es6:
      this.route('list', { path: '/:filter' });
    });

    this.resource('adminLogs', { path: '/logs' }, function() {
      this.route('staffActionLogs', { path: '/staff_action_logs' });
      this.route('screenedEmails', { path: '/screened_emails' });
      this.route('screenedIpAddresses', { path: '/screened_ip_addresses' });
      this.route('screenedUrls', { path: '/screened_urls' });
    });

    this.resource('adminGroups', { path: '/groups' }, function() {
      this.resource('adminGrou
---
[Medium] chunk lines 21-40 in app/assets/javascripts/admin/routes/admin-route-map.js.es6:
        this.route('show', {path: '/:site_customization_id/:section'});
      });

      this.resource('adminSiteText', { path: '/site_texts' }, function() {
        this.route('edit', {path: '/:text_type'});
      });
      this.resource('adminUserFields', { path: '/user_fields' });
      this.resource('adminEmojis', { path: '/emojis' });
      this.resource('adminPermalinks', { path: '/permalinks' });
      this.resource('adminEmbedding', { path: '/embedding' });
    });
    this.route('api');
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/adapters/rest.js.es6:
  basePath(store, type) {
    if (ADMIN_MODELS.indexOf(type.replace('_', '-')) !== -1) { return ""/admin/""; }
    return ""/"";
  },

  pathFor(store, type, findArgs) {
    let path = this.basePath(store, type, findArgs) + Ember.String.underscore(store.pluralize(type));

    if (findArgs) {
      if (typeof findArgs === ""object"") {
        const queryString = Object.keys(findArgs)
                                  .reject(k => !findArgs[k])
                                  .map(k => k + ""="" + enco
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/adapters/rest.js.es6:
const ADMIN_MODELS = ['plugin', 'site-customization', 'embeddable-host'];

export function Result(payload, responseJson) {
  this.payload = payload;
  this.responseJson = responseJson;
  this.target = null;
}

const ajax = Discourse.ajax;

// We use this to make sure 404s are caught
function rethrow(error) {
  if (error.status === 404) {
    throw ""404: "" + error.responseText;
  }
  throw(error);
}

export default Ember.Object.extend({

---
[Medium] chunk lines 181-200 in app/assets/javascripts/discourse/models/store.js.es6:
      if (found) {
        const hydrated = this._hydrate(subType, found, root);
        hashedCollection[id] = hydrated;
        return hydrated;
      }
    }
  },

  _hydrateEmbedded(type, obj, root) {
    const self = this;
    Object.keys(obj).forEach(function(k) {
      const m = /(.+)\_id(s?)$/.exec(k);
      if (m) {
        const subType = m[1];

        if (m[2]) {
          const hydrated = obj[k].map(function(id) {
            return self._lookupSubType(subType, type, id, root);
    
---
[Medium] chunk lines 201-220 in app/assets/javascripts/discourse/models/store.js.es6:
          delete obj[k];
        } else {
          const hydrated = self._lookupSubType(subType, type, obj[k], root);
          if (hydrated) {
            obj[subType] = hydrated;
            delete obj[k];
          }
        }

      }
    });
  },

  _hydrate(type, obj, root) {
    if (!obj) { throw ""Can't hydrate "" + type + "" of `null`""; }
    if (!obj.id) { throw ""Can't hydrate "" + type + "" without an `id`""; }

    root = root || obj;

    // Experimental: If serialized with a certain opt
---
[Medium] class EmbedController in app/controllers/embed_controller.rb:
class EmbedController < ApplicationController
  skip_before_filter :check_xhr, :preload_json, :verify_authenticity_token
  before_filter :ensure_embeddable

  layout 'embed'

  def comments
    embed_url = params[:embed_url]

    topic_id = nil
    if embed_url.present?
      topic_id = TopicEmbed.topic_id_for_embed(embed_url)
    else
      topic_id = params[:topic_id].to_i
    end

    if topic_id
      @topic_view = TopicView.new(topic_id,
                                  current_user,
     
---
[Medium] method ensure_embeddable in app/controllers/embed_controller.rb:
def ensure_embeddable

      if !(Rails.env.development? && current_user.try(:admin?))
        raise Discourse::InvalidAccess.new('invalid referer host') unless EmbeddableHost.host_allowed?(request.referer)
      end

      response.headers['X-Frame-Options'] = ""ALLOWALL""
    rescue URI::InvalidURIError
      raise Discourse::InvalidAccess.new('invalid referer host')
    end
---
[Medium] method expandable_first_post? in app/models/topic.rb:
def expandable_first_post?
    SiteSetting.embed_truncate? && has_topic_embed?
  end
---
[Medium] method import in app/models/topic_embed.rb:
def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    if SiteSetting.embed_truncate
      contents = first_paragraph_from(contents)
    end
    contents ||= ''
    contents << imported_from_html(url)

    url = normalize_url(url)

    embed = TopicEmbed.find_by(""lower(embed_url) = ?"", url)
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transacti
---
[Medium] section embedding in config/site_settings.yml:
embedding:
  feed_polling_enabled: false
  feed_polling_url: ''
  embed_by_username:
    default: ''
    type: username
  embed_username_key_from_feed: ''
  embed_post_limit: 100
  embed_truncate: false
  embed_whitelist_selector: ''
  embed_blacklist_selector: ''
---
[Medium] method invalid_host? in lib/topic_retriever.rb:
def invalid_host?
      !EmbeddableHost.host_allowed?(@embed_url)
    end
---
[Medium] chunk lines 261-280 in test/javascripts/helpers/create-pretender.js.es6:
    this.get('/widgets', function(request) {
      let result = _widgets;

      const qp = request.queryParams;
      if (qp) {
        if (qp.name) { result = result.filterBy('name', qp.name); }
        if (qp.id) { result = result.filterBy('id', parseInt(qp.id)); }
      }

      return response({ widgets: result,
                        total_rows_widgets: 4,
                        load_more_widgets: '/load-more-widgets',
                        refresh_widgets: '/widgets?refresh=true' });

---
[Medium] chunk lines 221-240 in test/javascripts/helpers/create-pretender.js.es6:
        action: 'create_post',
        post: {id: 12345, topic_id: 280, topic_slug: 'internationalization-localization'}
      });
    });

    this.get('/fruits/:id', function() {
      const fruit = fruits[0];
      return response({ __rest_serializer: ""1"", fruit, farmers, colors });
    });

    this.get('/fruits', function() {
      return response({ __rest_serializer: ""1"", fruits, farmers, colors });
    });

    this.get('/widgets/:widget_id', function(request) {
      const w = _widgets.f
---
[Medium] chunk lines 41-60 in test/javascripts/helpers/create-pretender.js.es6:

const fruits = [{id: 1, name: 'apple', farmer_id: 1, color_ids: [1,2], category_id: 4},
                {id: 2, name: 'banana', farmer_id: 1, color_ids: [3], category_id: 3},
                {id: 3, name: 'grape', farmer_id: 2, color_ids: [2], category_id: 5}];

const farmers = [{id: 1, name: 'Old MacDonald'},
                 {id: 2, name: 'Luke Skywalker'}];

const colors = [{id: 1, name: 'Red'},
                {id: 2, name: 'Green'},
                {id: 3, name: 'Yellow'}];

function logge
---
[Medium] chunk lines 161-180 in test/javascripts/helpers/create-pretender.js.es6:

    this.get('/users/check_username', function(request) {
      if (request.queryParams.username === 'taken') {
        return response({available: false, suggestion: 'nottaken'});
      }
      return response({available: true});
    });

    this.post('/users', function() {
      return response({success: true});
    });

    this.get('/login.html', function() {
      return [200, {}, 'LOGIN PAGE'];
    });

    this.delete('/posts/:post_id', success);
    this.put('/posts/:post_id/recover', 
---
[Medium] chunk lines 281-300 in test/javascripts/helpers/create-pretender.js.es6:

    this.post('/topics/timings', function() {
      return response(200, {});
    });
  });

  server.prepareBody = function(body){
    if (body && typeof body === ""object"") {
      return JSON.stringify(body);
    }
    return body;
  };

  server.unhandledRequest = function(verb, path) {
    const error = 'Unhandled request in test environment: ' + path + ' (' + verb + ')';
    window.console.error(error);
    throw error;
  };

  server.checkPassthrough = function(request) {
---
[Medium] chunk lines 201-220 in test/javascripts/helpers/create-pretender.js.es6:

      return response(200, { basic_topic: {id: request.params.id,
                                           title: data.title,
                                           fancy_title: data.title,
                                           slug: request.params.slug } });
    });

    this.post('/posts', function(request) {
      const data = parsePostData(request.requestBody);

      if (data.title === ""this title triggers an error"") {
        return response(422, {errors: ['That title has alrea
---
[Medium] chunk lines 241-260 in test/javascripts/helpers/create-pretender.js.es6:
      }
    });

    this.post('/widgets', function(request) {
      const widget = parsePostData(request.requestBody).widget;
      widget.id = 100;
      return response(200, {widget});
    });

    this.put('/widgets/:widget_id', function(request) {
      const widget = parsePostData(request.requestBody).widget;
      return response({ widget });
    });

    this.put('/cool_things/:cool_thing_id', function(request) {
      const cool_thing = parsePostData(request.requestBody).cool_thing;
   
---
[Medium] chunk lines 141-160 in test/javascripts/helpers/create-pretender.js.es6:
        queued_posts: [{id: 1, raw: 'queued post text', can_delete_user: true}]
      });
    });

    this.post('/session', function(request) {
      const data = parsePostData(request.requestBody);

      if (data.password === 'correct') {
        return response({username: 'eviltrout'});
      }
      return response(400, {error: 'invalid login'});
    });

    this.get('/users/hp.json', function() {
      return response({""value"":""32faff1b1ef1ac3"",""challenge"":""61a3de0ccf086fb9604b76e884d7580
---
[Medium] chunk lines 181-200 in test/javascripts/helpers/create-pretender.js.es6:
      const data = parsePostData(request.requestBody);
      data.post.id = request.params.post_id;
      data.post.version = 2;
      return response(200, data.post);
    });

    this.get('/t/403.json', () => {
      return response(403, {});
    });

    this.get('/t/404.json', () => {
      return response(404, ""not found"");
    });

    this.get('/t/500.json', () => {
      return response(502, {});
    });

    this.put('/t/:slug/:id', (request) => {
      const data = parsePostData(reques
---
[Medium] chunk lines 101-120 in test/javascripts/models/store-test.js.es6:
  const store = createStore();
  const w = store.createRecord('widget', {name: 'hello'});
  store.destroyRecord('widget', w).then(function(result) {
    assert.ok(result);
  });
});


test('find embedded', function(assert) {
  const store = createStore();
  return store.find('fruit', 2).then(function(f) {
    assert.ok(f.get('farmer'), 'it has the embedded object');

    const fruitCols = f.get('colors');
    assert.equal(fruitCols.length, 2);
    assert.equal(fruitCols[0].get('id'), 1);
    ass","TopicEmbed (Critical), Topic (Critical), SiteSetting (Critical), EmbeddableHost (Critical), TopicRetriever (High), EmbeddableHostSerializer (Medium), save_host (Medium), EmbeddingSerializer (Medium), create (Medium), update (Medium), fetch_embedding (Medium), lines 61-80 (Medium), lines 1-18 (Medium), lines 1-9 (Medium), destroy (Medium), show (Medium), update (Medium), change (Medium), lines 221-230 (Medium), allows_embeddable_host? (Medium), lines 301-302 (Medium), lines 121-124 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 121-140 (Medium), lines 41-60 (Medium), lines 21-40 (Medium), lines 21-40 (Medium), lines 1-20 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), EmbedController (Medium), ensure_embeddable (Medium), expandable_first_post? (Medium), import (Medium), embedding (Medium), invalid_host? (Medium), lines 261-280 (Medium), lines 221-240 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 281-300 (Medium), lines 201-220 (Medium), lines 241-260 (Medium), lines 141-160 (Medium), lines 181-200 (Medium), lines 101-120 (Medium), lines 61-72 (Low), lines 1-13 (Low), lines 1-7 (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-63 (Low), lines 1-19 (Low), lines 1-15 (Low), lines 221-240 (Low), Admin::EmbeddableHostsController (Low), Admin::EmbeddingController (Low), record_for_host (Low), host_allowed? (Low), id (Low), host (Low), category_id (Low), id (Low), CreateEmbeddableHosts (Low), lines 301-305 (Low), lines 121-136 (Low)",match,'EmbeddableHost' matches HC entity 'embeddablehost'
discourse,10,FEATURE: Can edit category/host relationships for embedding,"The update and destroy methods in Admin::EmbeddableHostsController do not validate the existence of the EmbeddableHost record retrieved by ID. If EmbeddableHost.where(id: params[:id]).first returns nil (i.e., the host does not exist), attempting to call methods on the nil object (e.g., save_host or destroy) will result in a NoMethodError.",Medium,68,5,42,"class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.96] | class::Topic (app/models/topic.rb) [Critical, score=0.90] | class::SiteSetting (app/models/site_setting.rb) [Critical, score=0.89] | class::EmbeddableHost (app/models/embeddable_host.rb) [Critical, score=0.81] | class::TopicRetriever (lib/topic_retriever.rb) [High, score=0.51]","[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_uniqueness_of :embed_url

  def self.normalize_url(url)
    url.downcase.sub(/\/$/, '').sub(/\-+/, '-').strip
  end

  def self.imported_from_html(url)
    ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""
  end

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    if SiteSetting.embed_truncate
      contents = first_paragraph_from(contents)
    end
    contents ||= ''
    contents << imported_from_html(url)

    url = normalize_url(url)

    embed = TopicEmbed.find_by(""lower(embed_url) = ?"", url)
    content_sha1 = Digest::SHA1.he
---
[Critical] class Topic in app/models/topic.rb:
class Topic < ActiveRecord::Base
  include ActionView::Helpers::SanitizeHelper
  include RateLimiter::OnCreateRecord
  include HasCustomFields
  include Trashable
  include LimitedEdit
  extend Forwardable

  def_delegator :featured_users, :user_ids, :featured_user_ids
  def_delegator :featured_users, :choose, :feature_topic_users

  def_delegator :notifier, :watch!, :notify_watch!
  def_delegator :notifier, :tracking!, :notify_tracking!
  def_delegator :notifier, :regular!, :notify_regular!
  def_delegator :notifier, :muted!, :notify_muted!
  def_delegator :notifier, :toggle_mute, :toggle_mute

  attr_accessor :allowed_user_ids

  def self.max_sort_order
    2**31 - 1
  end

  def featured_users
    @featured_users ||= TopicFeaturedUsers.new(self)
  end

  def trash!(trashed_by=nil)
    u
---
[Critical] class SiteSetting in app/models/site_setting.rb:
class SiteSetting < ActiveRecord::Base
  extend SiteSettingExtension

  validates_presence_of :name
  validates_presence_of :data_type

  after_save do |site_setting|
    DiscourseEvent.trigger(:site_setting_saved, site_setting)
    true
  end

  def self.load_settings(file)
    SiteSettings::YamlLoader.new(file).load do |category, name, default, opts|
      if opts.delete(:client)
        client_setting(name, default, opts.merge(category: category))
      else
        setting(name, default, opts.merge(category: category))
      end
    end
  end

  load_settings(File.join(Rails.root, 'config', 'site_settings.yml'))

  unless Rails.env.test? && ENV['LOAD_PLUGINS'] != ""1""
    Dir[File.join(Rails.root, ""plugins"", ""*"", ""config"", ""settings.yml"")].each do |file|
      load_settings(file)
    en
---
[Critical] class EmbeddableHost in app/models/embeddable_host.rb:
class EmbeddableHost < ActiveRecord::Base
  validates_format_of :host, :with => /\A[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?\Z/i
  belongs_to :category

  before_validation do
    self.host.sub!(/^https?:\/\//, '')
    self.host.sub!(/\/.*$/, '')
  end

  def self.record_for_host(host)
    uri = URI(host) rescue nil
    return false unless uri.present?

    host = uri.host
    return false unless host.present?

    where(""lower(host) = ?"", host).first
  end

  def self.host_allowed?(host)
    record_for_host(host).present?
  end

end
---
[High] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @author_username = opts[:author_username]
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      !EmbeddableHost.host_allowed?(@embed_url)
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return false if @opts[:no_throttle]

      # Throttle other users to once every 60 seconds
      retrieved_key = ""retrieved:#{@embed_url}""
      if $redis.setnx(retrieved_key, ""1"")
        $redis.expire(retrieved_key, 60)
        return false
      end

      true
    end

    def perform_retrieve
      # It's possible another process or job found the embe","[Medium] class EmbeddableHostSerializer in app/serializers/embeddable_host_serializer.rb:
class EmbeddableHostSerializer < ApplicationSerializer
  attributes :id, :host, :category_id

  def id
    object.id
  end

  def host
    object.host
  end

  def category_id
    object.category_id
  end
end
---
[Medium] method save_host in app/controllers/admin/embeddable_hosts_controller.rb:
def save_host(host)
      host.host = params[:embeddable_host][:host]
      host.category_id = params[:embeddable_host][:category_id]
      host.category_id = SiteSetting.uncategorized_category_id if host.category_id.blank?

      if host.save
        render_serialized(host, EmbeddableHostSerializer, root: 'embeddable_host', rest_serializer: true)
      else
        render_json_error(host)
      end
    end
---
[Medium] class EmbeddingSerializer in app/serializers/embedding_serializer.rb:
class EmbeddingSerializer < ApplicationSerializer
  attributes :id
  has_many :embeddable_hosts, serializer: EmbeddableHostSerializer, embed: :ids

  def id
    object.id
  end
end
---
[Medium] method create in app/controllers/admin/embeddable_hosts_controller.rb:
def create
    save_host(EmbeddableHost.new)
  end
---
[Medium] method update in app/controllers/admin/embeddable_hosts_controller.rb:
def update
    host = EmbeddableHost.where(id: params[:id]).first
    save_host(host)
  end
---
[Medium] method fetch_embedding in app/controllers/admin/embedding_controller.rb:
def fetch_embedding
      @embedding = OpenStruct.new({
        id: 'default',
        embeddable_hosts: EmbeddableHost.all.order(:host)
      })
    end
---
[Medium] chunk lines 61-80 in test/javascripts/helpers/create-pretender.js.es6:
    const fixturesByUrl = {};

    // Load any fixtures automatically
    const self = this;
    Ember.keys(require._eak_seen).forEach(function(entry) {
      if (/^fixtures/.test(entry)) {
        const fixture = require(entry, null, null, true);
        if (fixture && fixture.default) {
          const obj = fixture.default;
          Ember.keys(obj).forEach(function(url) {
            fixturesByUrl[url] = obj[url];
            self.get(url, function() {
              return response(obj[url])
---
[Medium] chunk lines 1-18 in app/assets/javascripts/admin/controllers/admin-embedding.js.es6:
export default Ember.Controller.extend({
  embedding: null,

  actions: {
    saveChanges() {
      this.get('embedding').update({});
    },

    addHost() {
      const host = this.store.createRecord('embeddable-host');
      this.get('embedding.embeddable_hosts').pushObject(host);
    },

    deleteHost(host) {
      this.get('embedding.embeddable_hosts').removeObject(host);
    }
  }
});
---
[Medium] chunk lines 1-9 in app/assets/javascripts/admin/routes/admin-embedding.js.es6:
export default Ember.Route.extend({
  model() {
    return this.store.find('embedding');
  },

  setupController(controller, model) {
    controller.set('embedding', model);
  }
});
---
[Medium] method destroy in app/controllers/admin/embeddable_hosts_controller.rb:
def destroy
    host = EmbeddableHost.where(id: params[:id]).first
    host.destroy
    render json: success_json
  end
---
[Medium] method show in app/controllers/admin/embedding_controller.rb:
def show
    render_serialized(@embedding, EmbeddingSerializer, root: 'embedding', rest_serializer: true)
  end
---
[Medium] method update in app/controllers/admin/embedding_controller.rb:
def update
    render_serialized(@embedding, EmbeddingSerializer, root: 'embedding', rest_serializer: true)
  end
---
[Medium] method change in db/migrate/20150818190757_create_embeddable_hosts.rb:
def change
    create_table :embeddable_hosts, force: true do |t|
      t.string :host, null: false
      t.integer :category_id, null: false
      t.timestamps
    end

    category_id = execute(""SELECT c.id FROM categories AS c
                        INNER JOIN site_settings AS s ON s.value = c.name
                        WHERE s.name = 'embed_category'"")[0]['id'].to_i


    if category_id == 0
      category_id = execute(""SELECT value FROM site_settings WHERE name = 'uncategorized_category_
---
[Medium] chunk lines 221-230 in app/assets/javascripts/discourse/models/store.js.es6:
      const klass = this.container.lookupFactory('model:' + type) || RestModel;
      existing.setProperties(klass.munge(obj));
      return existing;
    }

    return this._build(type, obj);
  }
});

export { flushMap };
---
[Medium] method allows_embeddable_host? in app/models/site_setting.rb:
def self.allows_embeddable_host?(host)
    return false if embeddable_hosts.blank?
    uri = URI(host) rescue nil
    return false unless uri.present?

    host = uri.host
    return false unless host.present?

    !!embeddable_hosts.split(""\n"").detect {|h| h.sub(/^https?\:\/\//, '') == host }

    hosts = embeddable_hosts.split(""\n"").map {|h| (URI(h).host rescue nil) || h  }
    !!hosts.detect {|h| h == host}
  end
---
[Medium] chunk lines 301-302 in test/javascripts/helpers/create-pretender.js.es6:
  return server;
}
---
[Medium] chunk lines 121-124 in test/javascripts/models/store-test.js.es6:
    equal(fruits.objectAt(0).get('farmer'), fruits.objectAt(1).get('farmer'), 'points at the same object');
    equal(fruits.objectAt(2).get('farmer.name'), 'Luke Skywalker');
  });
});
---
[Medium] chunk lines 101-120 in test/javascripts/helpers/create-pretender.js.es6:

    this.put('/users/eviltrout', () => {
      return response({ user: {} });
    });

    this.get(""/t/280.json"", function() {
      return response(fixturesByUrl['/t/280/1.json']);
    });

    this.get(""/t/28830.json"", function() {
      return response(fixturesByUrl['/t/28830/1.json']);
    });

    this.get(""/t/id_for/:slug"", function() {
      return response({id: 280, slug: ""internationalization-localization"", url: ""/t/internationalization-localization/280""});
    });

    this.get(""/404
---
[Medium] chunk lines 81-100 in test/javascripts/helpers/create-pretender.js.es6:

    this.get(""/latest.json"", () => {
      const json = fixturesByUrl['/latest.json'];

      if (loggedIn()) {
        // Stuff to let us post
        json.topic_list.can_create_topic = true;
        json.topic_list.draft_key = ""new_topic"";
        json.topic_list.draft_sequence = 1;
      }
      return response(json);
    });

    this.get('/users/eviltrout.json', () => {
      const json = fixturesByUrl['/users/eviltrout.json'];
      if (loggedIn()) {
        json.user.can_edit = true;
   
---
[Medium] chunk lines 121-140 in test/javascripts/helpers/create-pretender.js.es6:

    this.delete('/draft.json', success);

    this.get('/users/:username/staff-info.json', () => response({}));

    this.put('/categories/:category_id', function(request) {
      const category = parsePostData(request.requestBody);
      return response({category});
    });

    this.get('/draft.json', function() {
      return response({});
    });

    this.put('/queued_posts/:queued_post_id', function(request) {
      return response({ queued_post: {id: request.params.queued_post_id } });
 
---
[Medium] chunk lines 41-60 in app/assets/javascripts/admin/routes/admin-route-map.js.es6:
      this.route('list', { path: '/:filter' });
    });

    this.resource('adminLogs', { path: '/logs' }, function() {
      this.route('staffActionLogs', { path: '/staff_action_logs' });
      this.route('screenedEmails', { path: '/screened_emails' });
      this.route('screenedIpAddresses', { path: '/screened_ip_addresses' });
      this.route('screenedUrls', { path: '/screened_urls' });
    });

    this.resource('adminGroups', { path: '/groups' }, function() {
      this.resource('adminGrou
---
[Medium] chunk lines 21-40 in app/assets/javascripts/admin/routes/admin-route-map.js.es6:
        this.route('show', {path: '/:site_customization_id/:section'});
      });

      this.resource('adminSiteText', { path: '/site_texts' }, function() {
        this.route('edit', {path: '/:text_type'});
      });
      this.resource('adminUserFields', { path: '/user_fields' });
      this.resource('adminEmojis', { path: '/emojis' });
      this.resource('adminPermalinks', { path: '/permalinks' });
      this.resource('adminEmbedding', { path: '/embedding' });
    });
    this.route('api');
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/adapters/rest.js.es6:
  basePath(store, type) {
    if (ADMIN_MODELS.indexOf(type.replace('_', '-')) !== -1) { return ""/admin/""; }
    return ""/"";
  },

  pathFor(store, type, findArgs) {
    let path = this.basePath(store, type, findArgs) + Ember.String.underscore(store.pluralize(type));

    if (findArgs) {
      if (typeof findArgs === ""object"") {
        const queryString = Object.keys(findArgs)
                                  .reject(k => !findArgs[k])
                                  .map(k => k + ""="" + enco
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/adapters/rest.js.es6:
const ADMIN_MODELS = ['plugin', 'site-customization', 'embeddable-host'];

export function Result(payload, responseJson) {
  this.payload = payload;
  this.responseJson = responseJson;
  this.target = null;
}

const ajax = Discourse.ajax;

// We use this to make sure 404s are caught
function rethrow(error) {
  if (error.status === 404) {
    throw ""404: "" + error.responseText;
  }
  throw(error);
}

export default Ember.Object.extend({

---
[Medium] chunk lines 181-200 in app/assets/javascripts/discourse/models/store.js.es6:
      if (found) {
        const hydrated = this._hydrate(subType, found, root);
        hashedCollection[id] = hydrated;
        return hydrated;
      }
    }
  },

  _hydrateEmbedded(type, obj, root) {
    const self = this;
    Object.keys(obj).forEach(function(k) {
      const m = /(.+)\_id(s?)$/.exec(k);
      if (m) {
        const subType = m[1];

        if (m[2]) {
          const hydrated = obj[k].map(function(id) {
            return self._lookupSubType(subType, type, id, root);
    
---
[Medium] chunk lines 201-220 in app/assets/javascripts/discourse/models/store.js.es6:
          delete obj[k];
        } else {
          const hydrated = self._lookupSubType(subType, type, obj[k], root);
          if (hydrated) {
            obj[subType] = hydrated;
            delete obj[k];
          }
        }

      }
    });
  },

  _hydrate(type, obj, root) {
    if (!obj) { throw ""Can't hydrate "" + type + "" of `null`""; }
    if (!obj.id) { throw ""Can't hydrate "" + type + "" without an `id`""; }

    root = root || obj;

    // Experimental: If serialized with a certain opt
---
[Medium] class EmbedController in app/controllers/embed_controller.rb:
class EmbedController < ApplicationController
  skip_before_filter :check_xhr, :preload_json, :verify_authenticity_token
  before_filter :ensure_embeddable

  layout 'embed'

  def comments
    embed_url = params[:embed_url]

    topic_id = nil
    if embed_url.present?
      topic_id = TopicEmbed.topic_id_for_embed(embed_url)
    else
      topic_id = params[:topic_id].to_i
    end

    if topic_id
      @topic_view = TopicView.new(topic_id,
                                  current_user,
     
---
[Medium] method ensure_embeddable in app/controllers/embed_controller.rb:
def ensure_embeddable

      if !(Rails.env.development? && current_user.try(:admin?))
        raise Discourse::InvalidAccess.new('invalid referer host') unless EmbeddableHost.host_allowed?(request.referer)
      end

      response.headers['X-Frame-Options'] = ""ALLOWALL""
    rescue URI::InvalidURIError
      raise Discourse::InvalidAccess.new('invalid referer host')
    end
---
[Medium] method expandable_first_post? in app/models/topic.rb:
def expandable_first_post?
    SiteSetting.embed_truncate? && has_topic_embed?
  end
---
[Medium] method import in app/models/topic_embed.rb:
def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    if SiteSetting.embed_truncate
      contents = first_paragraph_from(contents)
    end
    contents ||= ''
    contents << imported_from_html(url)

    url = normalize_url(url)

    embed = TopicEmbed.find_by(""lower(embed_url) = ?"", url)
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transacti
---
[Medium] section embedding in config/site_settings.yml:
embedding:
  feed_polling_enabled: false
  feed_polling_url: ''
  embed_by_username:
    default: ''
    type: username
  embed_username_key_from_feed: ''
  embed_post_limit: 100
  embed_truncate: false
  embed_whitelist_selector: ''
  embed_blacklist_selector: ''
---
[Medium] method invalid_host? in lib/topic_retriever.rb:
def invalid_host?
      !EmbeddableHost.host_allowed?(@embed_url)
    end
---
[Medium] chunk lines 261-280 in test/javascripts/helpers/create-pretender.js.es6:
    this.get('/widgets', function(request) {
      let result = _widgets;

      const qp = request.queryParams;
      if (qp) {
        if (qp.name) { result = result.filterBy('name', qp.name); }
        if (qp.id) { result = result.filterBy('id', parseInt(qp.id)); }
      }

      return response({ widgets: result,
                        total_rows_widgets: 4,
                        load_more_widgets: '/load-more-widgets',
                        refresh_widgets: '/widgets?refresh=true' });

---
[Medium] chunk lines 221-240 in test/javascripts/helpers/create-pretender.js.es6:
        action: 'create_post',
        post: {id: 12345, topic_id: 280, topic_slug: 'internationalization-localization'}
      });
    });

    this.get('/fruits/:id', function() {
      const fruit = fruits[0];
      return response({ __rest_serializer: ""1"", fruit, farmers, colors });
    });

    this.get('/fruits', function() {
      return response({ __rest_serializer: ""1"", fruits, farmers, colors });
    });

    this.get('/widgets/:widget_id', function(request) {
      const w = _widgets.f
---
[Medium] chunk lines 41-60 in test/javascripts/helpers/create-pretender.js.es6:

const fruits = [{id: 1, name: 'apple', farmer_id: 1, color_ids: [1,2], category_id: 4},
                {id: 2, name: 'banana', farmer_id: 1, color_ids: [3], category_id: 3},
                {id: 3, name: 'grape', farmer_id: 2, color_ids: [2], category_id: 5}];

const farmers = [{id: 1, name: 'Old MacDonald'},
                 {id: 2, name: 'Luke Skywalker'}];

const colors = [{id: 1, name: 'Red'},
                {id: 2, name: 'Green'},
                {id: 3, name: 'Yellow'}];

function logge
---
[Medium] chunk lines 161-180 in test/javascripts/helpers/create-pretender.js.es6:

    this.get('/users/check_username', function(request) {
      if (request.queryParams.username === 'taken') {
        return response({available: false, suggestion: 'nottaken'});
      }
      return response({available: true});
    });

    this.post('/users', function() {
      return response({success: true});
    });

    this.get('/login.html', function() {
      return [200, {}, 'LOGIN PAGE'];
    });

    this.delete('/posts/:post_id', success);
    this.put('/posts/:post_id/recover', 
---
[Medium] chunk lines 281-300 in test/javascripts/helpers/create-pretender.js.es6:

    this.post('/topics/timings', function() {
      return response(200, {});
    });
  });

  server.prepareBody = function(body){
    if (body && typeof body === ""object"") {
      return JSON.stringify(body);
    }
    return body;
  };

  server.unhandledRequest = function(verb, path) {
    const error = 'Unhandled request in test environment: ' + path + ' (' + verb + ')';
    window.console.error(error);
    throw error;
  };

  server.checkPassthrough = function(request) {
---
[Medium] chunk lines 201-220 in test/javascripts/helpers/create-pretender.js.es6:

      return response(200, { basic_topic: {id: request.params.id,
                                           title: data.title,
                                           fancy_title: data.title,
                                           slug: request.params.slug } });
    });

    this.post('/posts', function(request) {
      const data = parsePostData(request.requestBody);

      if (data.title === ""this title triggers an error"") {
        return response(422, {errors: ['That title has alrea
---
[Medium] chunk lines 241-260 in test/javascripts/helpers/create-pretender.js.es6:
      }
    });

    this.post('/widgets', function(request) {
      const widget = parsePostData(request.requestBody).widget;
      widget.id = 100;
      return response(200, {widget});
    });

    this.put('/widgets/:widget_id', function(request) {
      const widget = parsePostData(request.requestBody).widget;
      return response({ widget });
    });

    this.put('/cool_things/:cool_thing_id', function(request) {
      const cool_thing = parsePostData(request.requestBody).cool_thing;
   
---
[Medium] chunk lines 141-160 in test/javascripts/helpers/create-pretender.js.es6:
        queued_posts: [{id: 1, raw: 'queued post text', can_delete_user: true}]
      });
    });

    this.post('/session', function(request) {
      const data = parsePostData(request.requestBody);

      if (data.password === 'correct') {
        return response({username: 'eviltrout'});
      }
      return response(400, {error: 'invalid login'});
    });

    this.get('/users/hp.json', function() {
      return response({""value"":""32faff1b1ef1ac3"",""challenge"":""61a3de0ccf086fb9604b76e884d7580
---
[Medium] chunk lines 181-200 in test/javascripts/helpers/create-pretender.js.es6:
      const data = parsePostData(request.requestBody);
      data.post.id = request.params.post_id;
      data.post.version = 2;
      return response(200, data.post);
    });

    this.get('/t/403.json', () => {
      return response(403, {});
    });

    this.get('/t/404.json', () => {
      return response(404, ""not found"");
    });

    this.get('/t/500.json', () => {
      return response(502, {});
    });

    this.put('/t/:slug/:id', (request) => {
      const data = parsePostData(reques
---
[Medium] chunk lines 101-120 in test/javascripts/models/store-test.js.es6:
  const store = createStore();
  const w = store.createRecord('widget', {name: 'hello'});
  store.destroyRecord('widget', w).then(function(result) {
    assert.ok(result);
  });
});


test('find embedded', function(assert) {
  const store = createStore();
  return store.find('fruit', 2).then(function(f) {
    assert.ok(f.get('farmer'), 'it has the embedded object');

    const fruitCols = f.get('colors');
    assert.equal(fruitCols.length, 2);
    assert.equal(fruitCols[0].get('id'), 1);
    ass","TopicEmbed (Critical), Topic (Critical), SiteSetting (Critical), EmbeddableHost (Critical), TopicRetriever (High), EmbeddableHostSerializer (Medium), save_host (Medium), EmbeddingSerializer (Medium), create (Medium), update (Medium), fetch_embedding (Medium), lines 61-80 (Medium), lines 1-18 (Medium), lines 1-9 (Medium), destroy (Medium), show (Medium), update (Medium), change (Medium), lines 221-230 (Medium), allows_embeddable_host? (Medium), lines 301-302 (Medium), lines 121-124 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 121-140 (Medium), lines 41-60 (Medium), lines 21-40 (Medium), lines 21-40 (Medium), lines 1-20 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), EmbedController (Medium), ensure_embeddable (Medium), expandable_first_post? (Medium), import (Medium), embedding (Medium), invalid_host? (Medium), lines 261-280 (Medium), lines 221-240 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 281-300 (Medium), lines 201-220 (Medium), lines 241-260 (Medium), lines 141-160 (Medium), lines 181-200 (Medium), lines 101-120 (Medium), lines 61-72 (Low), lines 1-13 (Low), lines 1-7 (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-63 (Low), lines 1-19 (Low), lines 1-15 (Low), lines 221-240 (Low), Admin::EmbeddableHostsController (Low), Admin::EmbeddingController (Low), record_for_host (Low), host_allowed? (Low), id (Low), host (Low), category_id (Low), id (Low), CreateEmbeddableHosts (Low), lines 301-305 (Low), lines 121-136 (Low)",match,'EmbeddableHost.where' matches HC entity 'embeddablehost'
discourse,10,FEATURE: Can edit category/host relationships for embedding,"record_for_host compares lower(host) = ? but does not normalize the parameterâ€™s case, so mixedâ€‘case referer hosts may fail to match even though comparison intends to be caseâ€‘insensitive.",Medium,68,5,42,"class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.96] | class::Topic (app/models/topic.rb) [Critical, score=0.90] | class::SiteSetting (app/models/site_setting.rb) [Critical, score=0.89] | class::EmbeddableHost (app/models/embeddable_host.rb) [Critical, score=0.81] | class::TopicRetriever (lib/topic_retriever.rb) [High, score=0.51]","[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_uniqueness_of :embed_url

  def self.normalize_url(url)
    url.downcase.sub(/\/$/, '').sub(/\-+/, '-').strip
  end

  def self.imported_from_html(url)
    ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""
  end

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    if SiteSetting.embed_truncate
      contents = first_paragraph_from(contents)
    end
    contents ||= ''
    contents << imported_from_html(url)

    url = normalize_url(url)

    embed = TopicEmbed.find_by(""lower(embed_url) = ?"", url)
    content_sha1 = Digest::SHA1.he
---
[Critical] class Topic in app/models/topic.rb:
class Topic < ActiveRecord::Base
  include ActionView::Helpers::SanitizeHelper
  include RateLimiter::OnCreateRecord
  include HasCustomFields
  include Trashable
  include LimitedEdit
  extend Forwardable

  def_delegator :featured_users, :user_ids, :featured_user_ids
  def_delegator :featured_users, :choose, :feature_topic_users

  def_delegator :notifier, :watch!, :notify_watch!
  def_delegator :notifier, :tracking!, :notify_tracking!
  def_delegator :notifier, :regular!, :notify_regular!
  def_delegator :notifier, :muted!, :notify_muted!
  def_delegator :notifier, :toggle_mute, :toggle_mute

  attr_accessor :allowed_user_ids

  def self.max_sort_order
    2**31 - 1
  end

  def featured_users
    @featured_users ||= TopicFeaturedUsers.new(self)
  end

  def trash!(trashed_by=nil)
    u
---
[Critical] class SiteSetting in app/models/site_setting.rb:
class SiteSetting < ActiveRecord::Base
  extend SiteSettingExtension

  validates_presence_of :name
  validates_presence_of :data_type

  after_save do |site_setting|
    DiscourseEvent.trigger(:site_setting_saved, site_setting)
    true
  end

  def self.load_settings(file)
    SiteSettings::YamlLoader.new(file).load do |category, name, default, opts|
      if opts.delete(:client)
        client_setting(name, default, opts.merge(category: category))
      else
        setting(name, default, opts.merge(category: category))
      end
    end
  end

  load_settings(File.join(Rails.root, 'config', 'site_settings.yml'))

  unless Rails.env.test? && ENV['LOAD_PLUGINS'] != ""1""
    Dir[File.join(Rails.root, ""plugins"", ""*"", ""config"", ""settings.yml"")].each do |file|
      load_settings(file)
    en
---
[Critical] class EmbeddableHost in app/models/embeddable_host.rb:
class EmbeddableHost < ActiveRecord::Base
  validates_format_of :host, :with => /\A[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?\Z/i
  belongs_to :category

  before_validation do
    self.host.sub!(/^https?:\/\//, '')
    self.host.sub!(/\/.*$/, '')
  end

  def self.record_for_host(host)
    uri = URI(host) rescue nil
    return false unless uri.present?

    host = uri.host
    return false unless host.present?

    where(""lower(host) = ?"", host).first
  end

  def self.host_allowed?(host)
    record_for_host(host).present?
  end

end
---
[High] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @author_username = opts[:author_username]
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      !EmbeddableHost.host_allowed?(@embed_url)
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return false if @opts[:no_throttle]

      # Throttle other users to once every 60 seconds
      retrieved_key = ""retrieved:#{@embed_url}""
      if $redis.setnx(retrieved_key, ""1"")
        $redis.expire(retrieved_key, 60)
        return false
      end

      true
    end

    def perform_retrieve
      # It's possible another process or job found the embe","[Medium] class EmbeddableHostSerializer in app/serializers/embeddable_host_serializer.rb:
class EmbeddableHostSerializer < ApplicationSerializer
  attributes :id, :host, :category_id

  def id
    object.id
  end

  def host
    object.host
  end

  def category_id
    object.category_id
  end
end
---
[Medium] method save_host in app/controllers/admin/embeddable_hosts_controller.rb:
def save_host(host)
      host.host = params[:embeddable_host][:host]
      host.category_id = params[:embeddable_host][:category_id]
      host.category_id = SiteSetting.uncategorized_category_id if host.category_id.blank?

      if host.save
        render_serialized(host, EmbeddableHostSerializer, root: 'embeddable_host', rest_serializer: true)
      else
        render_json_error(host)
      end
    end
---
[Medium] class EmbeddingSerializer in app/serializers/embedding_serializer.rb:
class EmbeddingSerializer < ApplicationSerializer
  attributes :id
  has_many :embeddable_hosts, serializer: EmbeddableHostSerializer, embed: :ids

  def id
    object.id
  end
end
---
[Medium] method create in app/controllers/admin/embeddable_hosts_controller.rb:
def create
    save_host(EmbeddableHost.new)
  end
---
[Medium] method update in app/controllers/admin/embeddable_hosts_controller.rb:
def update
    host = EmbeddableHost.where(id: params[:id]).first
    save_host(host)
  end
---
[Medium] method fetch_embedding in app/controllers/admin/embedding_controller.rb:
def fetch_embedding
      @embedding = OpenStruct.new({
        id: 'default',
        embeddable_hosts: EmbeddableHost.all.order(:host)
      })
    end
---
[Medium] chunk lines 61-80 in test/javascripts/helpers/create-pretender.js.es6:
    const fixturesByUrl = {};

    // Load any fixtures automatically
    const self = this;
    Ember.keys(require._eak_seen).forEach(function(entry) {
      if (/^fixtures/.test(entry)) {
        const fixture = require(entry, null, null, true);
        if (fixture && fixture.default) {
          const obj = fixture.default;
          Ember.keys(obj).forEach(function(url) {
            fixturesByUrl[url] = obj[url];
            self.get(url, function() {
              return response(obj[url])
---
[Medium] chunk lines 1-18 in app/assets/javascripts/admin/controllers/admin-embedding.js.es6:
export default Ember.Controller.extend({
  embedding: null,

  actions: {
    saveChanges() {
      this.get('embedding').update({});
    },

    addHost() {
      const host = this.store.createRecord('embeddable-host');
      this.get('embedding.embeddable_hosts').pushObject(host);
    },

    deleteHost(host) {
      this.get('embedding.embeddable_hosts').removeObject(host);
    }
  }
});
---
[Medium] chunk lines 1-9 in app/assets/javascripts/admin/routes/admin-embedding.js.es6:
export default Ember.Route.extend({
  model() {
    return this.store.find('embedding');
  },

  setupController(controller, model) {
    controller.set('embedding', model);
  }
});
---
[Medium] method destroy in app/controllers/admin/embeddable_hosts_controller.rb:
def destroy
    host = EmbeddableHost.where(id: params[:id]).first
    host.destroy
    render json: success_json
  end
---
[Medium] method show in app/controllers/admin/embedding_controller.rb:
def show
    render_serialized(@embedding, EmbeddingSerializer, root: 'embedding', rest_serializer: true)
  end
---
[Medium] method update in app/controllers/admin/embedding_controller.rb:
def update
    render_serialized(@embedding, EmbeddingSerializer, root: 'embedding', rest_serializer: true)
  end
---
[Medium] method change in db/migrate/20150818190757_create_embeddable_hosts.rb:
def change
    create_table :embeddable_hosts, force: true do |t|
      t.string :host, null: false
      t.integer :category_id, null: false
      t.timestamps
    end

    category_id = execute(""SELECT c.id FROM categories AS c
                        INNER JOIN site_settings AS s ON s.value = c.name
                        WHERE s.name = 'embed_category'"")[0]['id'].to_i


    if category_id == 0
      category_id = execute(""SELECT value FROM site_settings WHERE name = 'uncategorized_category_
---
[Medium] chunk lines 221-230 in app/assets/javascripts/discourse/models/store.js.es6:
      const klass = this.container.lookupFactory('model:' + type) || RestModel;
      existing.setProperties(klass.munge(obj));
      return existing;
    }

    return this._build(type, obj);
  }
});

export { flushMap };
---
[Medium] method allows_embeddable_host? in app/models/site_setting.rb:
def self.allows_embeddable_host?(host)
    return false if embeddable_hosts.blank?
    uri = URI(host) rescue nil
    return false unless uri.present?

    host = uri.host
    return false unless host.present?

    !!embeddable_hosts.split(""\n"").detect {|h| h.sub(/^https?\:\/\//, '') == host }

    hosts = embeddable_hosts.split(""\n"").map {|h| (URI(h).host rescue nil) || h  }
    !!hosts.detect {|h| h == host}
  end
---
[Medium] chunk lines 301-302 in test/javascripts/helpers/create-pretender.js.es6:
  return server;
}
---
[Medium] chunk lines 121-124 in test/javascripts/models/store-test.js.es6:
    equal(fruits.objectAt(0).get('farmer'), fruits.objectAt(1).get('farmer'), 'points at the same object');
    equal(fruits.objectAt(2).get('farmer.name'), 'Luke Skywalker');
  });
});
---
[Medium] chunk lines 101-120 in test/javascripts/helpers/create-pretender.js.es6:

    this.put('/users/eviltrout', () => {
      return response({ user: {} });
    });

    this.get(""/t/280.json"", function() {
      return response(fixturesByUrl['/t/280/1.json']);
    });

    this.get(""/t/28830.json"", function() {
      return response(fixturesByUrl['/t/28830/1.json']);
    });

    this.get(""/t/id_for/:slug"", function() {
      return response({id: 280, slug: ""internationalization-localization"", url: ""/t/internationalization-localization/280""});
    });

    this.get(""/404
---
[Medium] chunk lines 81-100 in test/javascripts/helpers/create-pretender.js.es6:

    this.get(""/latest.json"", () => {
      const json = fixturesByUrl['/latest.json'];

      if (loggedIn()) {
        // Stuff to let us post
        json.topic_list.can_create_topic = true;
        json.topic_list.draft_key = ""new_topic"";
        json.topic_list.draft_sequence = 1;
      }
      return response(json);
    });

    this.get('/users/eviltrout.json', () => {
      const json = fixturesByUrl['/users/eviltrout.json'];
      if (loggedIn()) {
        json.user.can_edit = true;
   
---
[Medium] chunk lines 121-140 in test/javascripts/helpers/create-pretender.js.es6:

    this.delete('/draft.json', success);

    this.get('/users/:username/staff-info.json', () => response({}));

    this.put('/categories/:category_id', function(request) {
      const category = parsePostData(request.requestBody);
      return response({category});
    });

    this.get('/draft.json', function() {
      return response({});
    });

    this.put('/queued_posts/:queued_post_id', function(request) {
      return response({ queued_post: {id: request.params.queued_post_id } });
 
---
[Medium] chunk lines 41-60 in app/assets/javascripts/admin/routes/admin-route-map.js.es6:
      this.route('list', { path: '/:filter' });
    });

    this.resource('adminLogs', { path: '/logs' }, function() {
      this.route('staffActionLogs', { path: '/staff_action_logs' });
      this.route('screenedEmails', { path: '/screened_emails' });
      this.route('screenedIpAddresses', { path: '/screened_ip_addresses' });
      this.route('screenedUrls', { path: '/screened_urls' });
    });

    this.resource('adminGroups', { path: '/groups' }, function() {
      this.resource('adminGrou
---
[Medium] chunk lines 21-40 in app/assets/javascripts/admin/routes/admin-route-map.js.es6:
        this.route('show', {path: '/:site_customization_id/:section'});
      });

      this.resource('adminSiteText', { path: '/site_texts' }, function() {
        this.route('edit', {path: '/:text_type'});
      });
      this.resource('adminUserFields', { path: '/user_fields' });
      this.resource('adminEmojis', { path: '/emojis' });
      this.resource('adminPermalinks', { path: '/permalinks' });
      this.resource('adminEmbedding', { path: '/embedding' });
    });
    this.route('api');
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/adapters/rest.js.es6:
  basePath(store, type) {
    if (ADMIN_MODELS.indexOf(type.replace('_', '-')) !== -1) { return ""/admin/""; }
    return ""/"";
  },

  pathFor(store, type, findArgs) {
    let path = this.basePath(store, type, findArgs) + Ember.String.underscore(store.pluralize(type));

    if (findArgs) {
      if (typeof findArgs === ""object"") {
        const queryString = Object.keys(findArgs)
                                  .reject(k => !findArgs[k])
                                  .map(k => k + ""="" + enco
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/adapters/rest.js.es6:
const ADMIN_MODELS = ['plugin', 'site-customization', 'embeddable-host'];

export function Result(payload, responseJson) {
  this.payload = payload;
  this.responseJson = responseJson;
  this.target = null;
}

const ajax = Discourse.ajax;

// We use this to make sure 404s are caught
function rethrow(error) {
  if (error.status === 404) {
    throw ""404: "" + error.responseText;
  }
  throw(error);
}

export default Ember.Object.extend({

---
[Medium] chunk lines 181-200 in app/assets/javascripts/discourse/models/store.js.es6:
      if (found) {
        const hydrated = this._hydrate(subType, found, root);
        hashedCollection[id] = hydrated;
        return hydrated;
      }
    }
  },

  _hydrateEmbedded(type, obj, root) {
    const self = this;
    Object.keys(obj).forEach(function(k) {
      const m = /(.+)\_id(s?)$/.exec(k);
      if (m) {
        const subType = m[1];

        if (m[2]) {
          const hydrated = obj[k].map(function(id) {
            return self._lookupSubType(subType, type, id, root);
    
---
[Medium] chunk lines 201-220 in app/assets/javascripts/discourse/models/store.js.es6:
          delete obj[k];
        } else {
          const hydrated = self._lookupSubType(subType, type, obj[k], root);
          if (hydrated) {
            obj[subType] = hydrated;
            delete obj[k];
          }
        }

      }
    });
  },

  _hydrate(type, obj, root) {
    if (!obj) { throw ""Can't hydrate "" + type + "" of `null`""; }
    if (!obj.id) { throw ""Can't hydrate "" + type + "" without an `id`""; }

    root = root || obj;

    // Experimental: If serialized with a certain opt
---
[Medium] class EmbedController in app/controllers/embed_controller.rb:
class EmbedController < ApplicationController
  skip_before_filter :check_xhr, :preload_json, :verify_authenticity_token
  before_filter :ensure_embeddable

  layout 'embed'

  def comments
    embed_url = params[:embed_url]

    topic_id = nil
    if embed_url.present?
      topic_id = TopicEmbed.topic_id_for_embed(embed_url)
    else
      topic_id = params[:topic_id].to_i
    end

    if topic_id
      @topic_view = TopicView.new(topic_id,
                                  current_user,
     
---
[Medium] method ensure_embeddable in app/controllers/embed_controller.rb:
def ensure_embeddable

      if !(Rails.env.development? && current_user.try(:admin?))
        raise Discourse::InvalidAccess.new('invalid referer host') unless EmbeddableHost.host_allowed?(request.referer)
      end

      response.headers['X-Frame-Options'] = ""ALLOWALL""
    rescue URI::InvalidURIError
      raise Discourse::InvalidAccess.new('invalid referer host')
    end
---
[Medium] method expandable_first_post? in app/models/topic.rb:
def expandable_first_post?
    SiteSetting.embed_truncate? && has_topic_embed?
  end
---
[Medium] method import in app/models/topic_embed.rb:
def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    if SiteSetting.embed_truncate
      contents = first_paragraph_from(contents)
    end
    contents ||= ''
    contents << imported_from_html(url)

    url = normalize_url(url)

    embed = TopicEmbed.find_by(""lower(embed_url) = ?"", url)
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transacti
---
[Medium] section embedding in config/site_settings.yml:
embedding:
  feed_polling_enabled: false
  feed_polling_url: ''
  embed_by_username:
    default: ''
    type: username
  embed_username_key_from_feed: ''
  embed_post_limit: 100
  embed_truncate: false
  embed_whitelist_selector: ''
  embed_blacklist_selector: ''
---
[Medium] method invalid_host? in lib/topic_retriever.rb:
def invalid_host?
      !EmbeddableHost.host_allowed?(@embed_url)
    end
---
[Medium] chunk lines 261-280 in test/javascripts/helpers/create-pretender.js.es6:
    this.get('/widgets', function(request) {
      let result = _widgets;

      const qp = request.queryParams;
      if (qp) {
        if (qp.name) { result = result.filterBy('name', qp.name); }
        if (qp.id) { result = result.filterBy('id', parseInt(qp.id)); }
      }

      return response({ widgets: result,
                        total_rows_widgets: 4,
                        load_more_widgets: '/load-more-widgets',
                        refresh_widgets: '/widgets?refresh=true' });

---
[Medium] chunk lines 221-240 in test/javascripts/helpers/create-pretender.js.es6:
        action: 'create_post',
        post: {id: 12345, topic_id: 280, topic_slug: 'internationalization-localization'}
      });
    });

    this.get('/fruits/:id', function() {
      const fruit = fruits[0];
      return response({ __rest_serializer: ""1"", fruit, farmers, colors });
    });

    this.get('/fruits', function() {
      return response({ __rest_serializer: ""1"", fruits, farmers, colors });
    });

    this.get('/widgets/:widget_id', function(request) {
      const w = _widgets.f
---
[Medium] chunk lines 41-60 in test/javascripts/helpers/create-pretender.js.es6:

const fruits = [{id: 1, name: 'apple', farmer_id: 1, color_ids: [1,2], category_id: 4},
                {id: 2, name: 'banana', farmer_id: 1, color_ids: [3], category_id: 3},
                {id: 3, name: 'grape', farmer_id: 2, color_ids: [2], category_id: 5}];

const farmers = [{id: 1, name: 'Old MacDonald'},
                 {id: 2, name: 'Luke Skywalker'}];

const colors = [{id: 1, name: 'Red'},
                {id: 2, name: 'Green'},
                {id: 3, name: 'Yellow'}];

function logge
---
[Medium] chunk lines 161-180 in test/javascripts/helpers/create-pretender.js.es6:

    this.get('/users/check_username', function(request) {
      if (request.queryParams.username === 'taken') {
        return response({available: false, suggestion: 'nottaken'});
      }
      return response({available: true});
    });

    this.post('/users', function() {
      return response({success: true});
    });

    this.get('/login.html', function() {
      return [200, {}, 'LOGIN PAGE'];
    });

    this.delete('/posts/:post_id', success);
    this.put('/posts/:post_id/recover', 
---
[Medium] chunk lines 281-300 in test/javascripts/helpers/create-pretender.js.es6:

    this.post('/topics/timings', function() {
      return response(200, {});
    });
  });

  server.prepareBody = function(body){
    if (body && typeof body === ""object"") {
      return JSON.stringify(body);
    }
    return body;
  };

  server.unhandledRequest = function(verb, path) {
    const error = 'Unhandled request in test environment: ' + path + ' (' + verb + ')';
    window.console.error(error);
    throw error;
  };

  server.checkPassthrough = function(request) {
---
[Medium] chunk lines 201-220 in test/javascripts/helpers/create-pretender.js.es6:

      return response(200, { basic_topic: {id: request.params.id,
                                           title: data.title,
                                           fancy_title: data.title,
                                           slug: request.params.slug } });
    });

    this.post('/posts', function(request) {
      const data = parsePostData(request.requestBody);

      if (data.title === ""this title triggers an error"") {
        return response(422, {errors: ['That title has alrea
---
[Medium] chunk lines 241-260 in test/javascripts/helpers/create-pretender.js.es6:
      }
    });

    this.post('/widgets', function(request) {
      const widget = parsePostData(request.requestBody).widget;
      widget.id = 100;
      return response(200, {widget});
    });

    this.put('/widgets/:widget_id', function(request) {
      const widget = parsePostData(request.requestBody).widget;
      return response({ widget });
    });

    this.put('/cool_things/:cool_thing_id', function(request) {
      const cool_thing = parsePostData(request.requestBody).cool_thing;
   
---
[Medium] chunk lines 141-160 in test/javascripts/helpers/create-pretender.js.es6:
        queued_posts: [{id: 1, raw: 'queued post text', can_delete_user: true}]
      });
    });

    this.post('/session', function(request) {
      const data = parsePostData(request.requestBody);

      if (data.password === 'correct') {
        return response({username: 'eviltrout'});
      }
      return response(400, {error: 'invalid login'});
    });

    this.get('/users/hp.json', function() {
      return response({""value"":""32faff1b1ef1ac3"",""challenge"":""61a3de0ccf086fb9604b76e884d7580
---
[Medium] chunk lines 181-200 in test/javascripts/helpers/create-pretender.js.es6:
      const data = parsePostData(request.requestBody);
      data.post.id = request.params.post_id;
      data.post.version = 2;
      return response(200, data.post);
    });

    this.get('/t/403.json', () => {
      return response(403, {});
    });

    this.get('/t/404.json', () => {
      return response(404, ""not found"");
    });

    this.get('/t/500.json', () => {
      return response(502, {});
    });

    this.put('/t/:slug/:id', (request) => {
      const data = parsePostData(reques
---
[Medium] chunk lines 101-120 in test/javascripts/models/store-test.js.es6:
  const store = createStore();
  const w = store.createRecord('widget', {name: 'hello'});
  store.destroyRecord('widget', w).then(function(result) {
    assert.ok(result);
  });
});


test('find embedded', function(assert) {
  const store = createStore();
  return store.find('fruit', 2).then(function(f) {
    assert.ok(f.get('farmer'), 'it has the embedded object');

    const fruitCols = f.get('colors');
    assert.equal(fruitCols.length, 2);
    assert.equal(fruitCols[0].get('id'), 1);
    ass","TopicEmbed (Critical), Topic (Critical), SiteSetting (Critical), EmbeddableHost (Critical), TopicRetriever (High), EmbeddableHostSerializer (Medium), save_host (Medium), EmbeddingSerializer (Medium), create (Medium), update (Medium), fetch_embedding (Medium), lines 61-80 (Medium), lines 1-18 (Medium), lines 1-9 (Medium), destroy (Medium), show (Medium), update (Medium), change (Medium), lines 221-230 (Medium), allows_embeddable_host? (Medium), lines 301-302 (Medium), lines 121-124 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 121-140 (Medium), lines 41-60 (Medium), lines 21-40 (Medium), lines 21-40 (Medium), lines 1-20 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), EmbedController (Medium), ensure_embeddable (Medium), expandable_first_post? (Medium), import (Medium), embedding (Medium), invalid_host? (Medium), lines 261-280 (Medium), lines 221-240 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 281-300 (Medium), lines 201-220 (Medium), lines 241-260 (Medium), lines 141-160 (Medium), lines 181-200 (Medium), lines 101-120 (Medium), lines 61-72 (Low), lines 1-13 (Low), lines 1-7 (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-63 (Low), lines 1-19 (Low), lines 1-15 (Low), lines 221-240 (Low), Admin::EmbeddableHostsController (Low), Admin::EmbeddingController (Low), record_for_host (Low), host_allowed? (Low), id (Low), host (Low), category_id (Low), id (Low), CreateEmbeddableHosts (Low), lines 301-305 (Low), lines 121-136 (Low)",match,'host' matches HC entity 'embeddablehost'
discourse,10,FEATURE: Can edit category/host relationships for embedding,"Because this migration inserts embeddable_hosts rows with raw SQL, any existing embeddable_hosts values that include http:// or /https:// or path segments wonâ€™t go through the EmbeddableHost modelâ€™s normalization, so the new host lookup (which compares only the bare host) may fail for migrated data. Consider ensuring that migrated hosts are normalized to the same format as newly created EmbeddableHost records so existing embedding configurations keep working.",High,68,5,42,"class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.96] | class::Topic (app/models/topic.rb) [Critical, score=0.90] | class::SiteSetting (app/models/site_setting.rb) [Critical, score=0.89] | class::EmbeddableHost (app/models/embeddable_host.rb) [Critical, score=0.81] | class::TopicRetriever (lib/topic_retriever.rb) [High, score=0.51]","[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_uniqueness_of :embed_url

  def self.normalize_url(url)
    url.downcase.sub(/\/$/, '').sub(/\-+/, '-').strip
  end

  def self.imported_from_html(url)
    ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""
  end

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    if SiteSetting.embed_truncate
      contents = first_paragraph_from(contents)
    end
    contents ||= ''
    contents << imported_from_html(url)

    url = normalize_url(url)

    embed = TopicEmbed.find_by(""lower(embed_url) = ?"", url)
    content_sha1 = Digest::SHA1.he
---
[Critical] class Topic in app/models/topic.rb:
class Topic < ActiveRecord::Base
  include ActionView::Helpers::SanitizeHelper
  include RateLimiter::OnCreateRecord
  include HasCustomFields
  include Trashable
  include LimitedEdit
  extend Forwardable

  def_delegator :featured_users, :user_ids, :featured_user_ids
  def_delegator :featured_users, :choose, :feature_topic_users

  def_delegator :notifier, :watch!, :notify_watch!
  def_delegator :notifier, :tracking!, :notify_tracking!
  def_delegator :notifier, :regular!, :notify_regular!
  def_delegator :notifier, :muted!, :notify_muted!
  def_delegator :notifier, :toggle_mute, :toggle_mute

  attr_accessor :allowed_user_ids

  def self.max_sort_order
    2**31 - 1
  end

  def featured_users
    @featured_users ||= TopicFeaturedUsers.new(self)
  end

  def trash!(trashed_by=nil)
    u
---
[Critical] class SiteSetting in app/models/site_setting.rb:
class SiteSetting < ActiveRecord::Base
  extend SiteSettingExtension

  validates_presence_of :name
  validates_presence_of :data_type

  after_save do |site_setting|
    DiscourseEvent.trigger(:site_setting_saved, site_setting)
    true
  end

  def self.load_settings(file)
    SiteSettings::YamlLoader.new(file).load do |category, name, default, opts|
      if opts.delete(:client)
        client_setting(name, default, opts.merge(category: category))
      else
        setting(name, default, opts.merge(category: category))
      end
    end
  end

  load_settings(File.join(Rails.root, 'config', 'site_settings.yml'))

  unless Rails.env.test? && ENV['LOAD_PLUGINS'] != ""1""
    Dir[File.join(Rails.root, ""plugins"", ""*"", ""config"", ""settings.yml"")].each do |file|
      load_settings(file)
    en
---
[Critical] class EmbeddableHost in app/models/embeddable_host.rb:
class EmbeddableHost < ActiveRecord::Base
  validates_format_of :host, :with => /\A[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?\Z/i
  belongs_to :category

  before_validation do
    self.host.sub!(/^https?:\/\//, '')
    self.host.sub!(/\/.*$/, '')
  end

  def self.record_for_host(host)
    uri = URI(host) rescue nil
    return false unless uri.present?

    host = uri.host
    return false unless host.present?

    where(""lower(host) = ?"", host).first
  end

  def self.host_allowed?(host)
    record_for_host(host).present?
  end

end
---
[High] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @author_username = opts[:author_username]
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      !EmbeddableHost.host_allowed?(@embed_url)
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return false if @opts[:no_throttle]

      # Throttle other users to once every 60 seconds
      retrieved_key = ""retrieved:#{@embed_url}""
      if $redis.setnx(retrieved_key, ""1"")
        $redis.expire(retrieved_key, 60)
        return false
      end

      true
    end

    def perform_retrieve
      # It's possible another process or job found the embe","[Medium] class EmbeddableHostSerializer in app/serializers/embeddable_host_serializer.rb:
class EmbeddableHostSerializer < ApplicationSerializer
  attributes :id, :host, :category_id

  def id
    object.id
  end

  def host
    object.host
  end

  def category_id
    object.category_id
  end
end
---
[Medium] method save_host in app/controllers/admin/embeddable_hosts_controller.rb:
def save_host(host)
      host.host = params[:embeddable_host][:host]
      host.category_id = params[:embeddable_host][:category_id]
      host.category_id = SiteSetting.uncategorized_category_id if host.category_id.blank?

      if host.save
        render_serialized(host, EmbeddableHostSerializer, root: 'embeddable_host', rest_serializer: true)
      else
        render_json_error(host)
      end
    end
---
[Medium] class EmbeddingSerializer in app/serializers/embedding_serializer.rb:
class EmbeddingSerializer < ApplicationSerializer
  attributes :id
  has_many :embeddable_hosts, serializer: EmbeddableHostSerializer, embed: :ids

  def id
    object.id
  end
end
---
[Medium] method create in app/controllers/admin/embeddable_hosts_controller.rb:
def create
    save_host(EmbeddableHost.new)
  end
---
[Medium] method update in app/controllers/admin/embeddable_hosts_controller.rb:
def update
    host = EmbeddableHost.where(id: params[:id]).first
    save_host(host)
  end
---
[Medium] method fetch_embedding in app/controllers/admin/embedding_controller.rb:
def fetch_embedding
      @embedding = OpenStruct.new({
        id: 'default',
        embeddable_hosts: EmbeddableHost.all.order(:host)
      })
    end
---
[Medium] chunk lines 61-80 in test/javascripts/helpers/create-pretender.js.es6:
    const fixturesByUrl = {};

    // Load any fixtures automatically
    const self = this;
    Ember.keys(require._eak_seen).forEach(function(entry) {
      if (/^fixtures/.test(entry)) {
        const fixture = require(entry, null, null, true);
        if (fixture && fixture.default) {
          const obj = fixture.default;
          Ember.keys(obj).forEach(function(url) {
            fixturesByUrl[url] = obj[url];
            self.get(url, function() {
              return response(obj[url])
---
[Medium] chunk lines 1-18 in app/assets/javascripts/admin/controllers/admin-embedding.js.es6:
export default Ember.Controller.extend({
  embedding: null,

  actions: {
    saveChanges() {
      this.get('embedding').update({});
    },

    addHost() {
      const host = this.store.createRecord('embeddable-host');
      this.get('embedding.embeddable_hosts').pushObject(host);
    },

    deleteHost(host) {
      this.get('embedding.embeddable_hosts').removeObject(host);
    }
  }
});
---
[Medium] chunk lines 1-9 in app/assets/javascripts/admin/routes/admin-embedding.js.es6:
export default Ember.Route.extend({
  model() {
    return this.store.find('embedding');
  },

  setupController(controller, model) {
    controller.set('embedding', model);
  }
});
---
[Medium] method destroy in app/controllers/admin/embeddable_hosts_controller.rb:
def destroy
    host = EmbeddableHost.where(id: params[:id]).first
    host.destroy
    render json: success_json
  end
---
[Medium] method show in app/controllers/admin/embedding_controller.rb:
def show
    render_serialized(@embedding, EmbeddingSerializer, root: 'embedding', rest_serializer: true)
  end
---
[Medium] method update in app/controllers/admin/embedding_controller.rb:
def update
    render_serialized(@embedding, EmbeddingSerializer, root: 'embedding', rest_serializer: true)
  end
---
[Medium] method change in db/migrate/20150818190757_create_embeddable_hosts.rb:
def change
    create_table :embeddable_hosts, force: true do |t|
      t.string :host, null: false
      t.integer :category_id, null: false
      t.timestamps
    end

    category_id = execute(""SELECT c.id FROM categories AS c
                        INNER JOIN site_settings AS s ON s.value = c.name
                        WHERE s.name = 'embed_category'"")[0]['id'].to_i


    if category_id == 0
      category_id = execute(""SELECT value FROM site_settings WHERE name = 'uncategorized_category_
---
[Medium] chunk lines 221-230 in app/assets/javascripts/discourse/models/store.js.es6:
      const klass = this.container.lookupFactory('model:' + type) || RestModel;
      existing.setProperties(klass.munge(obj));
      return existing;
    }

    return this._build(type, obj);
  }
});

export { flushMap };
---
[Medium] method allows_embeddable_host? in app/models/site_setting.rb:
def self.allows_embeddable_host?(host)
    return false if embeddable_hosts.blank?
    uri = URI(host) rescue nil
    return false unless uri.present?

    host = uri.host
    return false unless host.present?

    !!embeddable_hosts.split(""\n"").detect {|h| h.sub(/^https?\:\/\//, '') == host }

    hosts = embeddable_hosts.split(""\n"").map {|h| (URI(h).host rescue nil) || h  }
    !!hosts.detect {|h| h == host}
  end
---
[Medium] chunk lines 301-302 in test/javascripts/helpers/create-pretender.js.es6:
  return server;
}
---
[Medium] chunk lines 121-124 in test/javascripts/models/store-test.js.es6:
    equal(fruits.objectAt(0).get('farmer'), fruits.objectAt(1).get('farmer'), 'points at the same object');
    equal(fruits.objectAt(2).get('farmer.name'), 'Luke Skywalker');
  });
});
---
[Medium] chunk lines 101-120 in test/javascripts/helpers/create-pretender.js.es6:

    this.put('/users/eviltrout', () => {
      return response({ user: {} });
    });

    this.get(""/t/280.json"", function() {
      return response(fixturesByUrl['/t/280/1.json']);
    });

    this.get(""/t/28830.json"", function() {
      return response(fixturesByUrl['/t/28830/1.json']);
    });

    this.get(""/t/id_for/:slug"", function() {
      return response({id: 280, slug: ""internationalization-localization"", url: ""/t/internationalization-localization/280""});
    });

    this.get(""/404
---
[Medium] chunk lines 81-100 in test/javascripts/helpers/create-pretender.js.es6:

    this.get(""/latest.json"", () => {
      const json = fixturesByUrl['/latest.json'];

      if (loggedIn()) {
        // Stuff to let us post
        json.topic_list.can_create_topic = true;
        json.topic_list.draft_key = ""new_topic"";
        json.topic_list.draft_sequence = 1;
      }
      return response(json);
    });

    this.get('/users/eviltrout.json', () => {
      const json = fixturesByUrl['/users/eviltrout.json'];
      if (loggedIn()) {
        json.user.can_edit = true;
   
---
[Medium] chunk lines 121-140 in test/javascripts/helpers/create-pretender.js.es6:

    this.delete('/draft.json', success);

    this.get('/users/:username/staff-info.json', () => response({}));

    this.put('/categories/:category_id', function(request) {
      const category = parsePostData(request.requestBody);
      return response({category});
    });

    this.get('/draft.json', function() {
      return response({});
    });

    this.put('/queued_posts/:queued_post_id', function(request) {
      return response({ queued_post: {id: request.params.queued_post_id } });
 
---
[Medium] chunk lines 41-60 in app/assets/javascripts/admin/routes/admin-route-map.js.es6:
      this.route('list', { path: '/:filter' });
    });

    this.resource('adminLogs', { path: '/logs' }, function() {
      this.route('staffActionLogs', { path: '/staff_action_logs' });
      this.route('screenedEmails', { path: '/screened_emails' });
      this.route('screenedIpAddresses', { path: '/screened_ip_addresses' });
      this.route('screenedUrls', { path: '/screened_urls' });
    });

    this.resource('adminGroups', { path: '/groups' }, function() {
      this.resource('adminGrou
---
[Medium] chunk lines 21-40 in app/assets/javascripts/admin/routes/admin-route-map.js.es6:
        this.route('show', {path: '/:site_customization_id/:section'});
      });

      this.resource('adminSiteText', { path: '/site_texts' }, function() {
        this.route('edit', {path: '/:text_type'});
      });
      this.resource('adminUserFields', { path: '/user_fields' });
      this.resource('adminEmojis', { path: '/emojis' });
      this.resource('adminPermalinks', { path: '/permalinks' });
      this.resource('adminEmbedding', { path: '/embedding' });
    });
    this.route('api');
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/adapters/rest.js.es6:
  basePath(store, type) {
    if (ADMIN_MODELS.indexOf(type.replace('_', '-')) !== -1) { return ""/admin/""; }
    return ""/"";
  },

  pathFor(store, type, findArgs) {
    let path = this.basePath(store, type, findArgs) + Ember.String.underscore(store.pluralize(type));

    if (findArgs) {
      if (typeof findArgs === ""object"") {
        const queryString = Object.keys(findArgs)
                                  .reject(k => !findArgs[k])
                                  .map(k => k + ""="" + enco
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/adapters/rest.js.es6:
const ADMIN_MODELS = ['plugin', 'site-customization', 'embeddable-host'];

export function Result(payload, responseJson) {
  this.payload = payload;
  this.responseJson = responseJson;
  this.target = null;
}

const ajax = Discourse.ajax;

// We use this to make sure 404s are caught
function rethrow(error) {
  if (error.status === 404) {
    throw ""404: "" + error.responseText;
  }
  throw(error);
}

export default Ember.Object.extend({

---
[Medium] chunk lines 181-200 in app/assets/javascripts/discourse/models/store.js.es6:
      if (found) {
        const hydrated = this._hydrate(subType, found, root);
        hashedCollection[id] = hydrated;
        return hydrated;
      }
    }
  },

  _hydrateEmbedded(type, obj, root) {
    const self = this;
    Object.keys(obj).forEach(function(k) {
      const m = /(.+)\_id(s?)$/.exec(k);
      if (m) {
        const subType = m[1];

        if (m[2]) {
          const hydrated = obj[k].map(function(id) {
            return self._lookupSubType(subType, type, id, root);
    
---
[Medium] chunk lines 201-220 in app/assets/javascripts/discourse/models/store.js.es6:
          delete obj[k];
        } else {
          const hydrated = self._lookupSubType(subType, type, obj[k], root);
          if (hydrated) {
            obj[subType] = hydrated;
            delete obj[k];
          }
        }

      }
    });
  },

  _hydrate(type, obj, root) {
    if (!obj) { throw ""Can't hydrate "" + type + "" of `null`""; }
    if (!obj.id) { throw ""Can't hydrate "" + type + "" without an `id`""; }

    root = root || obj;

    // Experimental: If serialized with a certain opt
---
[Medium] class EmbedController in app/controllers/embed_controller.rb:
class EmbedController < ApplicationController
  skip_before_filter :check_xhr, :preload_json, :verify_authenticity_token
  before_filter :ensure_embeddable

  layout 'embed'

  def comments
    embed_url = params[:embed_url]

    topic_id = nil
    if embed_url.present?
      topic_id = TopicEmbed.topic_id_for_embed(embed_url)
    else
      topic_id = params[:topic_id].to_i
    end

    if topic_id
      @topic_view = TopicView.new(topic_id,
                                  current_user,
     
---
[Medium] method ensure_embeddable in app/controllers/embed_controller.rb:
def ensure_embeddable

      if !(Rails.env.development? && current_user.try(:admin?))
        raise Discourse::InvalidAccess.new('invalid referer host') unless EmbeddableHost.host_allowed?(request.referer)
      end

      response.headers['X-Frame-Options'] = ""ALLOWALL""
    rescue URI::InvalidURIError
      raise Discourse::InvalidAccess.new('invalid referer host')
    end
---
[Medium] method expandable_first_post? in app/models/topic.rb:
def expandable_first_post?
    SiteSetting.embed_truncate? && has_topic_embed?
  end
---
[Medium] method import in app/models/topic_embed.rb:
def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    if SiteSetting.embed_truncate
      contents = first_paragraph_from(contents)
    end
    contents ||= ''
    contents << imported_from_html(url)

    url = normalize_url(url)

    embed = TopicEmbed.find_by(""lower(embed_url) = ?"", url)
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transacti
---
[Medium] section embedding in config/site_settings.yml:
embedding:
  feed_polling_enabled: false
  feed_polling_url: ''
  embed_by_username:
    default: ''
    type: username
  embed_username_key_from_feed: ''
  embed_post_limit: 100
  embed_truncate: false
  embed_whitelist_selector: ''
  embed_blacklist_selector: ''
---
[Medium] method invalid_host? in lib/topic_retriever.rb:
def invalid_host?
      !EmbeddableHost.host_allowed?(@embed_url)
    end
---
[Medium] chunk lines 261-280 in test/javascripts/helpers/create-pretender.js.es6:
    this.get('/widgets', function(request) {
      let result = _widgets;

      const qp = request.queryParams;
      if (qp) {
        if (qp.name) { result = result.filterBy('name', qp.name); }
        if (qp.id) { result = result.filterBy('id', parseInt(qp.id)); }
      }

      return response({ widgets: result,
                        total_rows_widgets: 4,
                        load_more_widgets: '/load-more-widgets',
                        refresh_widgets: '/widgets?refresh=true' });

---
[Medium] chunk lines 221-240 in test/javascripts/helpers/create-pretender.js.es6:
        action: 'create_post',
        post: {id: 12345, topic_id: 280, topic_slug: 'internationalization-localization'}
      });
    });

    this.get('/fruits/:id', function() {
      const fruit = fruits[0];
      return response({ __rest_serializer: ""1"", fruit, farmers, colors });
    });

    this.get('/fruits', function() {
      return response({ __rest_serializer: ""1"", fruits, farmers, colors });
    });

    this.get('/widgets/:widget_id', function(request) {
      const w = _widgets.f
---
[Medium] chunk lines 41-60 in test/javascripts/helpers/create-pretender.js.es6:

const fruits = [{id: 1, name: 'apple', farmer_id: 1, color_ids: [1,2], category_id: 4},
                {id: 2, name: 'banana', farmer_id: 1, color_ids: [3], category_id: 3},
                {id: 3, name: 'grape', farmer_id: 2, color_ids: [2], category_id: 5}];

const farmers = [{id: 1, name: 'Old MacDonald'},
                 {id: 2, name: 'Luke Skywalker'}];

const colors = [{id: 1, name: 'Red'},
                {id: 2, name: 'Green'},
                {id: 3, name: 'Yellow'}];

function logge
---
[Medium] chunk lines 161-180 in test/javascripts/helpers/create-pretender.js.es6:

    this.get('/users/check_username', function(request) {
      if (request.queryParams.username === 'taken') {
        return response({available: false, suggestion: 'nottaken'});
      }
      return response({available: true});
    });

    this.post('/users', function() {
      return response({success: true});
    });

    this.get('/login.html', function() {
      return [200, {}, 'LOGIN PAGE'];
    });

    this.delete('/posts/:post_id', success);
    this.put('/posts/:post_id/recover', 
---
[Medium] chunk lines 281-300 in test/javascripts/helpers/create-pretender.js.es6:

    this.post('/topics/timings', function() {
      return response(200, {});
    });
  });

  server.prepareBody = function(body){
    if (body && typeof body === ""object"") {
      return JSON.stringify(body);
    }
    return body;
  };

  server.unhandledRequest = function(verb, path) {
    const error = 'Unhandled request in test environment: ' + path + ' (' + verb + ')';
    window.console.error(error);
    throw error;
  };

  server.checkPassthrough = function(request) {
---
[Medium] chunk lines 201-220 in test/javascripts/helpers/create-pretender.js.es6:

      return response(200, { basic_topic: {id: request.params.id,
                                           title: data.title,
                                           fancy_title: data.title,
                                           slug: request.params.slug } });
    });

    this.post('/posts', function(request) {
      const data = parsePostData(request.requestBody);

      if (data.title === ""this title triggers an error"") {
        return response(422, {errors: ['That title has alrea
---
[Medium] chunk lines 241-260 in test/javascripts/helpers/create-pretender.js.es6:
      }
    });

    this.post('/widgets', function(request) {
      const widget = parsePostData(request.requestBody).widget;
      widget.id = 100;
      return response(200, {widget});
    });

    this.put('/widgets/:widget_id', function(request) {
      const widget = parsePostData(request.requestBody).widget;
      return response({ widget });
    });

    this.put('/cool_things/:cool_thing_id', function(request) {
      const cool_thing = parsePostData(request.requestBody).cool_thing;
   
---
[Medium] chunk lines 141-160 in test/javascripts/helpers/create-pretender.js.es6:
        queued_posts: [{id: 1, raw: 'queued post text', can_delete_user: true}]
      });
    });

    this.post('/session', function(request) {
      const data = parsePostData(request.requestBody);

      if (data.password === 'correct') {
        return response({username: 'eviltrout'});
      }
      return response(400, {error: 'invalid login'});
    });

    this.get('/users/hp.json', function() {
      return response({""value"":""32faff1b1ef1ac3"",""challenge"":""61a3de0ccf086fb9604b76e884d7580
---
[Medium] chunk lines 181-200 in test/javascripts/helpers/create-pretender.js.es6:
      const data = parsePostData(request.requestBody);
      data.post.id = request.params.post_id;
      data.post.version = 2;
      return response(200, data.post);
    });

    this.get('/t/403.json', () => {
      return response(403, {});
    });

    this.get('/t/404.json', () => {
      return response(404, ""not found"");
    });

    this.get('/t/500.json', () => {
      return response(502, {});
    });

    this.put('/t/:slug/:id', (request) => {
      const data = parsePostData(reques
---
[Medium] chunk lines 101-120 in test/javascripts/models/store-test.js.es6:
  const store = createStore();
  const w = store.createRecord('widget', {name: 'hello'});
  store.destroyRecord('widget', w).then(function(result) {
    assert.ok(result);
  });
});


test('find embedded', function(assert) {
  const store = createStore();
  return store.find('fruit', 2).then(function(f) {
    assert.ok(f.get('farmer'), 'it has the embedded object');

    const fruitCols = f.get('colors');
    assert.equal(fruitCols.length, 2);
    assert.equal(fruitCols[0].get('id'), 1);
    ass","TopicEmbed (Critical), Topic (Critical), SiteSetting (Critical), EmbeddableHost (Critical), TopicRetriever (High), EmbeddableHostSerializer (Medium), save_host (Medium), EmbeddingSerializer (Medium), create (Medium), update (Medium), fetch_embedding (Medium), lines 61-80 (Medium), lines 1-18 (Medium), lines 1-9 (Medium), destroy (Medium), show (Medium), update (Medium), change (Medium), lines 221-230 (Medium), allows_embeddable_host? (Medium), lines 301-302 (Medium), lines 121-124 (Medium), lines 101-120 (Medium), lines 81-100 (Medium), lines 121-140 (Medium), lines 41-60 (Medium), lines 21-40 (Medium), lines 21-40 (Medium), lines 1-20 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), EmbedController (Medium), ensure_embeddable (Medium), expandable_first_post? (Medium), import (Medium), embedding (Medium), invalid_host? (Medium), lines 261-280 (Medium), lines 221-240 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 281-300 (Medium), lines 201-220 (Medium), lines 241-260 (Medium), lines 141-160 (Medium), lines 181-200 (Medium), lines 101-120 (Medium), lines 61-72 (Low), lines 1-13 (Low), lines 1-7 (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-63 (Low), lines 1-19 (Low), lines 1-15 (Low), lines 221-240 (Low), Admin::EmbeddableHostsController (Low), Admin::EmbeddingController (Low), record_for_host (Low), host_allowed? (Low), id (Low), host (Low), category_id (Low), id (Low), CreateEmbeddableHosts (Low), lines 301-305 (Low), lines 121-136 (Low)",match,'EmbeddableHost' matches HC entity 'embeddablehost'
discourse,9,FEATURE: Localization fallbacks (server-side),Thread-safety issue with lazy @loaded_locales,Low,7,2,1,"module::I18n (lib/freedom_patches/translate_accelerator.rb) [High, score=0.60] | class::ApplicationController (app/controllers/application_controller.rb) [High, score=0.54]","[High] module I18n in lib/freedom_patches/translate_accelerator.rb:
module I18n
  module Backend

    class Simple
      def available_locales
        # in case you are wondering this is:
        # Dir.glob( File.join(Rails.root, 'config', 'locales', 'client.*.yml') )
        #    .map {|x| x.split('.')[-2]}.sort
        LocaleSiteSetting.supported_locales.map(&:to_sym)
      end
    end

    module Base
      # force explicit loading
      def load_translations(*filenames)
        unless filenames.empty?
          filenames.flatten.each { |filename| load_file(filename) }
        end
      end

    end
  end
  # this accelerates translation a tiny bit (halves the time it takes)
  class << self
    alias_method :translate_no_cache, :translate
    alias_method :reload_no_cache!, :reload!
    LRU_CACHE_SIZE = 300

    def reload!
      @loaded_locales = []
  
---
[High] class ApplicationController in app/controllers/application_controller.rb:
class ApplicationController < ActionController::Base
  include CurrentUser
  include CanonicalURL::ControllerExtensions
  include JsonError
  include GlobalPath

  serialization_scope :guardian

  protect_from_forgery

  # Default Rails 3.2 lets the request through with a blank session
  #  we are being more pedantic here and nulling session / current_user
  #  and then raising a CSRF exception
  def handle_unverified_request
    # NOTE: API key is secret, having it invalidates the need for a CSRF token
    unless is_api?
      super
      clear_current_user
      render text: ""['BAD CSRF']"", status: 403
    end
  end

  before_filter :set_current_user_for_logs
  before_filter :set_locale
  before_filter :set_mobile_view
  before_filter :inject_preview_style
  before_filter :disable_custom","[Medium] method set_locale in app/controllers/application_controller.rb:
def set_locale
    I18n.locale = if current_user
                    current_user.effective_locale
                  else
                    SiteSetting.default_locale
                  end

    I18n.fallbacks.ensure_loaded!
  end","I18n (High), ApplicationController (High), set_locale (Medium), FallbackLocaleList (Low), [] (Low), ensure_loaded! (Low), ensure_loaded! (Low)",partial,"HC entities exist (2) but no name match; golden idents: {'Thread', 'loaded_locales', 'safety', 'lazy'}"
discourse,9,FEATURE: Localization fallbacks (server-side),"Consider normalizing the input locale (e.g., to a symbol) when checking/loading here to avoid double-loading if the same locale is passed as a String vs Symbol (also applies to other locations in the PR).",Low,7,2,1,"module::I18n (lib/freedom_patches/translate_accelerator.rb) [High, score=0.60] | class::ApplicationController (app/controllers/application_controller.rb) [High, score=0.54]","[High] module I18n in lib/freedom_patches/translate_accelerator.rb:
module I18n
  module Backend

    class Simple
      def available_locales
        # in case you are wondering this is:
        # Dir.glob( File.join(Rails.root, 'config', 'locales', 'client.*.yml') )
        #    .map {|x| x.split('.')[-2]}.sort
        LocaleSiteSetting.supported_locales.map(&:to_sym)
      end
    end

    module Base
      # force explicit loading
      def load_translations(*filenames)
        unless filenames.empty?
          filenames.flatten.each { |filename| load_file(filename) }
        end
      end

    end
  end
  # this accelerates translation a tiny bit (halves the time it takes)
  class << self
    alias_method :translate_no_cache, :translate
    alias_method :reload_no_cache!, :reload!
    LRU_CACHE_SIZE = 300

    def reload!
      @loaded_locales = []
  
---
[High] class ApplicationController in app/controllers/application_controller.rb:
class ApplicationController < ActionController::Base
  include CurrentUser
  include CanonicalURL::ControllerExtensions
  include JsonError
  include GlobalPath

  serialization_scope :guardian

  protect_from_forgery

  # Default Rails 3.2 lets the request through with a blank session
  #  we are being more pedantic here and nulling session / current_user
  #  and then raising a CSRF exception
  def handle_unverified_request
    # NOTE: API key is secret, having it invalidates the need for a CSRF token
    unless is_api?
      super
      clear_current_user
      render text: ""['BAD CSRF']"", status: 403
    end
  end

  before_filter :set_current_user_for_logs
  before_filter :set_locale
  before_filter :set_mobile_view
  before_filter :inject_preview_style
  before_filter :disable_custom","[Medium] method set_locale in app/controllers/application_controller.rb:
def set_locale
    I18n.locale = if current_user
                    current_user.effective_locale
                  else
                    SiteSetting.default_locale
                  end

    I18n.fallbacks.ensure_loaded!
  end","I18n (High), ApplicationController (High), set_locale (Medium), FallbackLocaleList (Low), [] (Low), ensure_loaded! (Low), ensure_loaded! (Low)",match,'locale' matches entity 'fallbacklocalelist'
discourse,8,FIX: proper handling of group memberships," The findMembers() call is now asynchronous and unhandled. The controller may not have member data immediately available, creating a race condition.",High,101,1,83,"method::members (app/controllers/groups_controller.rb) [Critical, score=1.00]","[Critical] method members in app/controllers/groups_controller.rb:
def members
    group = find_group(:group_id)

    limit = (params[:limit] || 50).to_i
    offset = params[:offset].to_i

    total = group.users.count
    members = group.users.order(:username_lower).limit(limit).offset(offset)

    render json: {
      members: serialize_data(members, GroupUserSerializer),
      meta: {
        total: total,
        limit: limit,
        offset: offset
      }
    }
  end","[Medium] class GroupsController in app/controllers/groups_controller.rb:
class GroupsController < ApplicationController

  def show
    render_serialized(find_group(:id), BasicGroupSerializer)
  end

  def counts
    group = find_group(:group_id)
    render json: {counts: { posts: group.posts_for(guardian).count,
                            members: group.users.count } }
  end

  def posts
    group = find_group(:group_id)
    posts = group.posts_for(guardian, params[:before_post_id]).limit(20)
    render_serialized posts.to_a, GroupPostSerializer
  end

  def member
---
[Medium] chunk lines 1-20 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
export default Em.ObjectController.extend({
  needs: ['adminGroups'],
  disableSave: false,
  usernames: null,

  currentPage: function() {
    if (this.get(""user_count"") == 0) { return 0; }
    return Math.floor(this.get(""offset"") / this.get(""limit"")) + 1;
  }.property(""limit"", ""offset"", ""user_count""),

  totalPages: function() {
    if (this.get(""user_count"") == 0) { return 0; }
    return Math.floor(this.get(""user_count"") / this.get(""limit"")) + 1;
  }.property(""limit"", ""user_count""),

  showi
---
[Medium] method index in app/controllers/admin/groups_controller.rb:
def index
    groups = Group.order(:name)

    if search = params[:search]
      search = search.to_s
      groups = groups.where(""name ILIKE ?"", ""%#{search}%"")
    end

    if params[:ignore_automatic].to_s == ""true""
      groups = groups.where(automatic: false)
    end

    render_serialized(groups, BasicGroupSerializer)
  end
---
[Medium] method create in app/controllers/admin/groups_controller.rb:
def create
    group = Group.new
    group.name = (params[:name] || '').strip
    group.visible = params[:visible] == ""true""

    if group.save
      render_serialized(group, BasicGroupSerializer)
    else
      render_json_error group
    end
  end
---
[Medium] class Admin::GroupsController in app/controllers/admin/groups_controller.rb:
class Admin::GroupsController < Admin::AdminController

  def index
    groups = Group.order(:name)

    if search = params[:search]
      search = search.to_s
      groups = groups.where(""name ILIKE ?"", ""%#{search}%"")
    end

    if params[:ignore_automatic].to_s == ""true""
      groups = groups.where(automatic: false)
    end

    render_serialized(groups, BasicGroupSerializer)
  end

  def show
    render nothing: true
  end

  def create
    group = Group.new
    group.name = (params[:name] 
---
[Medium] chunk lines 1-4 in app/assets/javascripts/admin/views/group-member.js.es6:
export default Discourse.View.extend({
  classNames: [""item""],
  templateName: ""admin/templates/group_member""
});
---
[Medium] chunk lines 61-77 in app/assets/javascripts/admin/controllers/admin-group.js.es6:

      bootbox.confirm(I18n.t(""admin.groups.delete_confirm""), I18n.t(""no_value""), I18n.t(""yes_value""), function(result) {
        if (result) {
          self.set('disableSave', true);
          group.destroy().then(function() {
            groupsController.get('model').removeObject(group);
            self.transitionToRoute('adminGroups.index');
          }, function() {
            bootbox.alert(I18n.t(""admin.groups.delete_failed""));
          }).finally(function() {
            self.set('disa
---
[Medium] variable self in app/assets/javascripts/admin/routes/admin_group_route.js:
var self = this;
---
[Medium] chunk lines 21-29 in app/assets/javascripts/admin/templates/group.hbs:
    {{combo-box valueAttribute=""value"" value=alias_level content=aliasLevelOptions}}
  </div>
</div>
<div class='controls'>
  <button {{action ""save""}} {{bind-attr disabled=""disableSave""}} class='btn'>{{i18n 'admin.customize.save'}}</button>
  {{#unless automatic}}
    <button {{action ""destroy""}} class='btn btn-danger'><i class=""fa fa-trash-o""></i>{{i18n 'admin.customize.delete'}}</button>
  {{/unless}}
</div>
---
[Medium] variable json in app/assets/javascripts/discourse/models/group.js:
var json = this.asJSON();
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/routes/group-members.js.es6:
import ShowFooter from ""discourse/mixins/show-footer"";

export default Discourse.Route.extend(ShowFooter, {
  model: function() {
    return this.modelFor('group');
  },

  afterModel: function(model) {
    var self = this;
    return model.findMembers().then(function(result) {
      self.set('_members', result);
    });
  },

  setupController: function(controller) {
    controller.set('model', this.get('_members'));
    this.controllerFor('group').set('showing', 'members');
  }

});
---
[Medium] chunk lines 21-21 in app/assets/javascripts/discourse/routes/group-members.js.es6:

---
[Medium] chunk lines 21-22 in app/assets/javascripts/discourse/templates/user-selector-autocomplete.raw.hbs:
  </ul>
</div>
---
[Medium] method update_patch in app/controllers/admin/groups_controller.rb:
def update_patch(group)
    raise Discourse::InvalidAccess.new(""automatic groups do not permit membership changes"") if group.automatic

    if actions = params[:changes]
      Array(actions[:add]).each do |username|
        if user = User.find_by_username(username)
          group.add(user)
        end
      end
      Array(actions[:delete]).each do |username|
        if user = User.find_by_username(username)
          group.remove(user)
        end
      end
    end

    render json: success_js
---
[Medium] method update_put in app/controllers/admin/groups_controller.rb:
def update_put(group)
    payload = params[:group]

    group.alias_level = payload[:alias_level].to_i if payload[:alias_level].present?
    group.visible = payload[:visible] == ""true""

    if group.automatic
      # group rename & membership changes are ignored/prohibited for automatic groups
    else
      group.usernames = payload[:usernames] if payload[:usernames]
      group.name = payload[:name] if payload[:name]
    end

    if group.save
      render json: success_json
    else
      ren
---
[Medium] chunk lines 41-60 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
      if (this.get(""showingFirst"")) { return; }

      var group = this.get(""model""),
          offset = Math.max(group.get(""offset"") - group.get(""limit""), 0);

      group.set(""offset"", offset);

      return group.findMembers();
    },

    removeMember: function(member) {
      var self = this,
          message = I18n.t(""admin.groups.delete_member_confirm"", { username: member.get(""username""), group: this.get(""name"") });
      return bootbox.confirm(message, I18n.t(""no_value""), I18n.t(""yes_va
---
[Medium] chunk lines 21-40 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
      { name: I18n.t(""groups.alias_levels.nobody""), value: 0 },
      { name: I18n.t(""groups.alias_levels.mods_and_admins""), value: 2 },
      { name: I18n.t(""groups.alias_levels.members_mods_and_admins""), value: 3 },
      { name: I18n.t(""groups.alias_levels.everyone""), value: 99 }
    ];
  }.property(),

  actions: {
    next: function() {
      if (this.get(""showingLast"")) { return; }

      var group = this.get(""model""),
          offset = Math.min(group.get(""offset"") + group.get(""limit""), g
---
[Medium] chunk lines 1-20 in app/assets/javascripts/admin/templates/group.hbs:
<form class=""form-horizontal"">

  <div>
    {{#if automatic}}
      <h3>{{name}}</h3>
    {{else}}
      <label for=""name"">{{i18n 'admin.groups.name'}}</label>
      {{text-field name=""name"" value=name placeholderKey=""admin.groups.name_placeholder""}}
    {{/if}}
  </div>

  {{#if id}}
    <div>
      <label>{{i18n 'admin.groups.group_members'}} ({{user_count}})</label>
      <div>
        <a {{bind-attr class="":previous showingFirst:disabled""}} {{action ""previous""}}>{{fa-icon ""fast-backward""}}</
---
[Medium] variable self in app/assets/javascripts/discourse/models/group.js:
var self = this;
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/templates/group/members.hbs:
{{#if model}}
  <table class='group-members'>
    <tr>
      <th colspan=""3"" class=""seen"">{{i18n 'last_seen'}}</th>
    </tr>
  {{#each m in members}}
  <tr>
      <td class='avatar'>
        {{avatar m imageSize=""large""}}
      </td>
      <td>
        <h3>{{#link-to 'user' m}}{{m.username}}{{/link-to}}</h3>
        <p>{{m.name}}</p>
      </td>
      <td>
        <span class='last-seen-at'>{{bound-date m.last_seen_at}}</span>
      </td>
    </tr>
    </div>
  {{/each}}
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/templates/user-selector-autocomplete.raw.hbs:
<div class='autocomplete'>
  <ul>
    {{#each options.users}}
      <li>
        <a href='#'>{{avatar this imageSize=""tiny""}}
          <span class='username'>{{this.username}}</span>
          <span class='name'>{{this.name}}</span>
        </a>
      </li>
    {{/each}}
    {{#if options.groups}}
      {{#if options.users}}<hr>{{/if}}
      {{#each options.groups}}
        <li>
          <a href=''>
            <i class='icon-group'></i>
            <span class='username'>{{this.name}}</span>

---
[Medium] chunk lines 641-660 in app/assets/stylesheets/common/admin/admin_base.scss:
    tr {
      height: 44px;
    }
    td {
      vertical-align: middle;
      padding: 3px;
      line-height: 1.4;
    }
  }
  .action {
     button { margin: 4px; }
     text-align: right;
     padding-bottom: 20px;
  }
  td p {
    font-size: 0.929em;
    margin: 0 0 5px 0;
  }
  .flagged-posts { background: $danger; }
}
---
[Medium] chunk lines 941-960 in app/assets/stylesheets/common/admin/admin_base.scss:
        font-weight: bold;
      }

      .commit-meta {
        color: $primary;
        font-size: 0.857em;
      }

      .committer-name {
        font-weight: bold;
        color: $primary;
      }
    }
    li:last-child {
      border: none;
    }
  }

  // Always show the scrollbar:
  ::-webkit-scrollbar {
---
[Medium] chunk lines 1021-1040 in app/assets/stylesheets/common/admin/admin_base.scss:
  .controls {
    margin-top: 10px;
  }

  #pagedown-editor {
    width: 98%;
  }

  textarea.plain {
    width: 98%;
    height: 200px;
  }

  #wmd-input {
    width: 98%;
    height: 200px;
  }

  .ace-wrapper {
    position: relative;
---
[Medium] chunk lines 921-940 in app/assets/stylesheets/common/admin/admin_base.scss:
      line-height: 1.0em;
      padding: 6px 8px;
    background-color: scale-color-diff();
      .left {
        float: left;
      }
      .right {
        margin-left: 52px;
      }

      img {
        margin-top: 2px;
        border: solid 1px scale-color-diff();
        padding: 2px;
        background-color: $secondary;
      }

      .commit-message {
        color: $primary;
        font-size: 0.857em;
---
[Medium] chunk lines 1101-1120 in app/assets/stylesheets/common/admin/admin_base.scss:
  .ip_address {
    width: 150px;
    text-align: left;
    input {
      width: 130px;
    }
  }
  .col.actions {
    width: 275px;
    padding-top: 4px;
    a {
      text-decoration: underline;
    }
  }
}

.staff-actions {
  width: 100%;
  .action {
    width: 10.810%;
---
[Medium] chunk lines 341-360 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
  .field {
    font-weight: bold;
    width: 17.65765%;
    float: left;
    margin-left: 12px;
  }
  .value {
    width: 250px;
    float: left;
    margin-left: 12px;
  }
  .long-value {
    width: 800px;
    float: left;
    margin-left: 12px;
    font-size: 0.929em;

    button {
      margin-left: 10px;
---
[Medium] chunk lines 761-780 in app/assets/stylesheets/common/admin/admin_base.scss:
    th {
      font-weight: normal;
      text-align: center;
      background: dark-light-diff($primary, $secondary, 80%, -65%);
    }
    th.title {
      text-align: left;
    }
    thead {
      tr:hover > td {
        background-color: $secondary;
      }
    }

    td.value {
      font-weight: bold;
      text-align: center;

      i {
        display: none;
---
[Medium] chunk lines 581-600 in app/assets/stylesheets/common/admin/admin_base.scss:
  .color-scheme {
    .controls {
      span, button, a {
        margin-right: 10px;
      }
    }
  }
  .colors {
    thead th       { border: none; }
    td.hex         { width: 100px; }
    td.actions     { width: 200px; }
    .hex-input     { width: 80px; margin-bottom: 0; }
    .hex           { text-align: center; }
    .description   { color: scale-color($primary, $lightness: 50%); }

    .invalid .hex input {
      background-color: white;
      color: black;
      border-color: $danger;
---
[Medium] chunk lines 681-700 in app/assets/stylesheets/common/admin/admin_base.scss:
.version-check {
  margin-top: 10px;

  .version-number {
    font-size: 1.286em;
    font-weight: bold;
    text-align: center;
  }

  .face {
    width: 20px;
  }

  .version-notes .fa {
    vertical-align: bottom;
  }

  &.critical .version-notes .normal-note {
    display: none;
  }
---
[Medium] chunk lines 601-620 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}


.admin-flags {
  table-layout: fixed;

  .hidden-post td.excerpt, .hidden-post td.user { opacity: 0.5; }
  .deleted td.excerpt, .deleted td.user { background-color: scale-color($danger, $lightness: 70%); }
  .message { background-color: dark-light-diff($highlight, $secondary, 50%, -70%); }
  .message:hover { background-color: dark-light-diff($highlight, $secondary, 60%, -60%); }
  td { vertical-align: top; }
  th { text-align: left; }
  .user {
    width: 25px;
    padding: 8px 0 0 0;
  
---
[Medium] chunk lines 1221-1240 in app/assets/stylesheets/common/admin/admin_base.scss:
    color: $success;
  }
  .fa-times {
    color: $danger;
  }
}

// Backups
// --------------------------------------------------

$rollback: #3D9970;
$rollback-dark: darken($rollback, 10%) !default;
$rollback-darker: darken($rollback, 20%) !default;

.btn-rollback {
  color: $secondary;
  background: $rollback;
  &:hover {
    background: $rollback-dark;
  }
---
[Medium] chunk lines 1201-1220 in app/assets/stylesheets/common/admin/admin_base.scss:
    padding-top: 6px;
    vertical-align: top;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .ember-list-item-view {
    width: 100%;
    border-top: solid 1px scale-color-diff();
  }
}

.log-details-modal {
  .modal-tab {
    width: 95%;
  }
}

.tl3-requirements {
  .fa-check {
---
[Medium] chunk lines 401-420 in app/assets/stylesheets/common/admin/admin_base.scss:
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    textarea {
      height: 200px;
    }
  }

  .current-badge-actions {
    margin: 10px;
    padding: 10px;
    border-top: 1px solid scale-color($primary, $lightness: 80%);
  }

  .buttons {
    float: left;
    width: 200px;
    .saving {
      padding: 5px 0 0 0;
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/admin/admin_base.scss:
      }
    }
    .setting-controls {
      float: left;
    }
    .input-setting-string {
      width: 404px;
      @include medium-width { width: 314px; }
      @include small-width  { width: 284px; }
    }
    .input-setting-list {
      width: 408px;
      padding: 1px;
      background-color: $secondary;
      border: 1px solid scale-color-diff();
      border-radius: 3px;
      box-shadow: inset 0 1px 1px rgba(51, 51, 51, 0.3);
      transition: border linear 0.2s, box-shadow linear 0.2s;

---
[Medium] chunk lines 361-380 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  .controls {
    width: 480px;
    float: left;
    margin-left: 12px;
    .btn {
      margin-right: 5px;
    }
  }
}

// Badges area
.badges {
  .content-list ul {
    margin-bottom: 10px;

    .list-badge {
      float: right;
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/common/admin/admin_base.scss:

// Customise area
.customize {
  .admin-footer {
    margin-top: 20px;
  }
  .current-style.maximized {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100000;
    background-color: white;
    width: 100%;
    padding: 0;
    margin: 0;
    .wrapper {
      position: absolute;
      top: 20px;
---
[Medium] chunk lines 721-740 in app/assets/stylesheets/common/admin/admin_base.scss:
  i.fa {
    font-size: 1.429em;
  }
}

table.api-keys {
  margin-top: 10px;
  width: 100%;

  th {
    text-align: left;
    padding: 5px;
  }

  td {
    padding: 5px;
  }

  td.key {
    font-size: 0.857em;
---
[Medium] chunk lines 1161-1180 in app/assets/stylesheets/common/admin/admin_base.scss:

    }
    .label {
      font-weight: bold;
    }
    i {
      margin-left: 6px;
    }
  }
}

.staff-action-logs-instructions {
  margin: 0 0 10px 10px;
}

// Ember.ListView

.ember-list-view {
  overflow-y: auto;
  overflow-x: hidden;
---
[Medium] chunk lines 1281-1300 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.start-backup-modal {
  .btn {
    margin: 10px 0 10px 5px;
  }
  .btn:first-of-type {
    margin-left: 10px;
  }
}

@media all
and (max-width : 850px) {
  .nav-stacked {
    .glyph {width: auto; position: relative;}
    > li > a {padding: 13px}
  }
}

---
[Medium] chunk lines 881-900 in app/assets/stylesheets/common/admin/admin_base.scss:
  ul, li {
    margin: 0;
    padding: 0;
  }
  ul {
    list-style: none;
  }
  a {
    color: $primary;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  .header {
    color: $primary;
    font-weight: bold;
    height: 30px;
    background: dark-light-diff($primary, $secondary, 80%, -75%);
---
[Medium] chunk lines 1261-1280 in app/assets/stylesheets/common/admin/admin_base.scss:
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: rgba(0, 175, 0, 0.3);
}

.is-uploading:hover .ru-progress {
  background: rgba(200, 0, 0, 0.3);
}

.invisible {
  visibility: hidden;
}

.delete-flag-modal, .agree-flag-modal {
  button {
    display: block;
    margin: 10px 0 10px 10px;
    padding: 10px 15px;
---
[Medium] chunk lines 1141-1160 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
    &.value {
      height: 70px;
    }
  }
}

.staff-action-logs-controls {
  margin: 0 0 20px 6px;
  a.filter {
    display: inline-block;
    background-color: scale-color($primary, $lightness: 75%);
    padding: 3px 10px;
    border-radius: 3px;

    color: $primary;
    &:hover {
      color: $primary;
      background-color: scale-color-diff();

---
[Medium] chunk lines 781-800 in app/assets/stylesheets/common/admin/admin_base.scss:
      }

      &.trending-up {
        color: $success;
        i.up {
          display: inline;
        }
      }
      &.trending-down {
        color: $danger;
        i.down {
          display: inline;
        }
      }
      &.no-change {
        i.down {
          display: inline;
          visibility: hidden;
        }
      }
---
[Medium] chunk lines 841-860 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

  &.totals {
    table {
      width: auto;
    }
    margin-top: 12px;
    padding-left: 5px;
    .value {
      text-align: left;
      font-weight: bold;
      padding-left: 8px;
      padding-right: 30px;
    }
  }

  &.trust-levels {
    margin-bottom: 0;
    table {
---
[Medium] chunk lines 861-880 in app/assets/stylesheets/common/admin/admin_base.scss:
      margin-bottom: 0;
    }
    td.value {
      width: 45px;
    }
  }

  .referred-topic-title {
    width: 355px;
    @include medium-width { width: 305px; }
    @include small-width  { width: 265px; }
  }
}


.commits-widget {
  border: solid 1px scale-color-diff();
  height: 180px;
  margin-bottom: 36px;

---
[Medium] chunk lines 821-840 in app/assets/stylesheets/common/admin/admin_base.scss:
    .problem-messages {
      float: left;
      width: 80%;
      margin-left: 1%;
      a {
        text-decoration: underline;
      }
      .actions {
        text-align: right;
      }
      .btn {
        background: dark-light-diff($primary, $secondary, 80%, -85%);
      }
      ul {
        margin-left: 0;
        padding-left: 20px;
      li {
        margin-bottom: 10px;
        }
      }
---
[Medium] chunk lines 1321-1340 in app/assets/stylesheets/common/admin/admin_base.scss:
      }
      .setting-value {
        width: 100%;
        }
      label {
        font-size: 0.929em;
        }
    }
  }

  .content-editor {
    width: 100%;
      #pagedown-editor {
        box-sizing: border-box;
      }
  }

  div.ac-wrap {
    width: 100% !important;
    box-sizing: border-box;
---
[Medium] chunk lines 541-560 in app/assets/stylesheets/common/admin/admin_base.scss:
    &.maximized {
      .admin-container {
        position: absolute;
        bottom: 50px;
        top: 80px;
        width: 100%;
      }
      .admin-footer {
        position: absolute;
        bottom: 10px;
      }
      .ace-wrapper {
        height: 100%;
      }
    }
    .ace_editor {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
---
[Medium] chunk lines 701-720 in app/assets/stylesheets/common/admin/admin_base.scss:
  &.normal .version-notes .critical-note {
    display: none;
  }

  .fa {
    font-size: 1.857em;
  }

  .up-to-date {
    color: $success;
  }
  .updates-available {
    color: $danger;
  }
  .critical-updates-available {
    color: $danger;
  }
}

.update-nag {
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.site-settings-nav {
  width: 18.018%;
  margin-top: 30px;
  .nav-stacked {
    border-right: none;
  }
  li a.active {
    color: $secondary;
    background-color: $quaternary;
  }
}

.site-settings-detail {
  width: 76.5765%;
  min-height: 800px;
  margin-left: 0;
  border-left: solid 1px scale-color-diff();
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/admin/admin_base.scss:

    }

    .desc, .validation-error {
      padding-top: 3px;
      font-size: 80%;
      line-height: 1.4em;
    }

    .validation-error {
      color: $danger;
    }

    .desc {
      color: scale-color($primary, $lightness: 50%);
    }

    h3 {
      font-size: 0.929em;
      font-weight: normal;
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/common/admin/admin_base.scss:
      font-size: 11px;
      font-weight: normal;
      padding: 0 6px;
      color: $secondary;
      background-color: scale-color($tertiary, $lightness: 50%);
      border-radius: 3px;
    }
  }

  .current-badge {
    margin: 20px;

    p.help {
      margin: 0;
      color: scale-color($primary, $lightness: 40%);
      font-size: 0.9em;
    }
  }

  .form-horizontal {
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  .setting.overridden {
    input[type=text] {
      background-color: dark-light-diff($highlight, $secondary, 50%, -60%);

    }

    h3 {
      color: scale-color($highlight, $lightness: -50%);
    }
  }
}

section.details {
  h1 {
    font-size: 1.286em;
    color: $primary;
    padding: 5px 10px;
---
[Medium] chunk lines 421-440 in app/assets/stylesheets/common/admin/admin_base.scss:
      margin-left: 10px;
      width: 80px;
      color: $primary;
    }
  }
}

.badge-query-preview {
  .grant-count, .sample, .error-header {
    margin-left: 10px;
  }

  .badge-errors {
    font-size: 1em;
    line-height: 16px;
    padding: 4px;
    background-color: scale-color-diff();
  }

  .badge-query-plan {
---
[Medium] chunk lines 741-760 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.dashboard-stats {
  margin-bottom: 30px;
  margin-right: 40px;
  h4 {
    font-weight: normal;
    margin-bottom: 8px;
  }

  table {
    width: 100%;

    .title {
      i.fa {
        color: $primary;
      }
    }

---
[Medium] chunk lines 1041-1060 in app/assets/stylesheets/common/admin/admin_base.scss:
    height: 600px;
    width: 100%;
  }
  .ace_editor {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
  }

}

.row.groups {
  input[type='text'] {
    width: 500px;
  }
  input#group-users {
    width: 600px;
  }
---
[Medium] chunk lines 301-320 in app/assets/stylesheets/common/admin/admin_base.scss:
    margin: 30px 0 5px 0;
    border-bottom: 5px solid scale-color-diff();
  }
}

#selected-controls {
  background-color: scale-color($tertiary, $lightness: 75%);
  padding: 8px;
  min-height: 27px;
  position: fixed;
  bottom: 0;
  width: 1075px;
}

.user-controls {
  padding: 5px;
  clear: both;
  text-align: right;
}

---
[Medium] chunk lines 561-580 in app/assets/stylesheets/common/admin/admin_base.scss:
      bottom: 0;
    }
    .status-actions {
      float: right;
      margin-top: 7px;
      span {
        margin-right: 10px;
      }
    }
    .buttons {
      float: left;
      width: 200px;
      .saving {
        padding: 5px 0 0 0;
        margin-left: 10px;
        width: 80px;
        color: $primary;
      }
    }
  }
---
[Medium] chunk lines 901-920 in app/assets/stylesheets/common/admin/admin_base.scss:
    cursor: pointer;

    h1 {
      font-size: 1.286em;
      margin: 5px 0 0 8px;
      display: inline-block;
      line-height: 1.0em;
    }
  }

  .header:hover h1 {
    color: $tertiary;
  }

  .commits-list {
    height: 149px;
    overflow-y:auto;

    li {
      @extend .clearfix;
---
[Medium] chunk lines 1121-1140 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
  .staff_user {
    width: 9.009%;
  }
  .subject {
    width: 18.018%;
  }
  .created_at {
    width: 4.5045%;
  }
  .context {
    width: 18.018%;
  }
  .created_at {
    text-align: center;
  }
  .details {
    width: 300px;
    a {
      text-decoration: underline;
---
[Medium] chunk lines 621-640 in app/assets/stylesheets/common/admin/admin_base.scss:
    width: 75%;
    padding: 8px;
    word-wrap: break-word;
    .fa { display: inline-block; }
    h3 {
      max-height: 1.2em;
      overflow: hidden;
      margin-top: 0;
      margin-bottom: 5px;
    }
  }
  .flaggers {
    font-size: 11px;
    padding: 8px 0 0 5px;
    .avatar {
      width: 25px;
    }
    table {
      max-width: 145px;
    }
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/admin/admin_base.scss:
        cursor: pointer;
        .select2-search-choice-close {
          content: ""x""
        }
      }

      li.sortable-placeholder {
        padding: 3px 5px 3px 18px;
        margin: 3px 0px 3px 5px;
        position: relative;
        line-height: 13px;
        cursor: default;
        border: 1px dashed #AAA;
        border-radius: 3px;
        background-clip: padding-box;
        -moz-user-select: none;
        background-color: none;
        width: 3em;
        height: 1em;
      }
---
[Medium] chunk lines 661-680 in app/assets/stylesheets/common/admin/admin_base.scss:

/* Dashboard */

.dashboard-left {
  float: left;
  margin-top: 10px;
  width: 60%;
}
.dashboard-right {
  float: right;
  margin-top: 10px;
  width: 40%;


  .dashboard-stats {
    width: 100%;
    margin-left: 0;
  }
}

---
[Medium] chunk lines 441-460 in app/assets/stylesheets/common/admin/admin_base.scss:
    font-size: 0.857em;
    line-height: 13px;
    padding: 4px;
    background-color: scale-color-diff();
  }

  .count-warning {
    background-color: dark-light-diff(rgba($danger,.7), $secondary, 50%, -60%);
    margin: 0 0 7px 0;
    padding: 10px 20px;

    p {
      margin: 0;
    }
    .heading {
      color: $danger;
      font-weight: bold;
    }
  }
}
---
[Medium] chunk lines 1341-1360 in app/assets/stylesheets/common/admin/admin_base.scss:
    }

  .admin-container {
    h2 {
      float: left;
      }
  }

  .dashboard-left, .dashboard-right { width: 100%; }
  .dashboard-stats { margin: 0; }

  .badges {
    .current-badge {margin: 70px 0 0 0;}
    .current-badge-actions {padding: 0;}
  }

  .customize .content-list, .customize .current-style {
    width: 100%;
  }
}
---
[Medium] chunk lines 1001-1020 in app/assets/stylesheets/common/admin/admin_base.scss:

      &.active {
        font-weight: bold;
        color: $primary;
      }
    }
  }
}

.content-editor {
  min-height: 500px;

  float: left;
  width: 54.0540%;
  margin-left: 1.8018%;

  p.description {
    color: $primary;
  }

---
[Medium] chunk lines 501-520 in app/assets/stylesheets/common/admin/admin_base.scss:
      bottom: 10px;
      left: 20px;
      right: 20px;
    }
  }
  .nav.nav-pills {
    margin-left: 10px;
  }
  .content-list, .current-style {
    float: left;
  }
  .content-list ul {
    margin-bottom: 10px;
  }
  .current-style {
    .nav.nav-pills{
      position: relative;
    }
    .toggle-maximize {
      position: absolute;
---
[Medium] chunk lines 1301-1320 in app/assets/stylesheets/common/admin/admin_base.scss:
@media all
and (min-width : 320px)
and (max-width : 500px) {

.full-width { margin: 0; }
.site-settings-nav { width: 100%; }
.site-settings-detail {
  width: 100%;
  padding: 0;
  border: none;

  .settings .setting {
      .setting-label {
      float: left;
      width: 100%;
      h3 {
        margin-bottom: 5px;
        font-weight: bold;
        margin-top: 25px;
        }
---
[Medium] chunk lines 1061-1080 in app/assets/stylesheets/common/admin/admin_base.scss:
}

// Logs

.admin-logs-table {
  input.ember-text-field {
    padding: 1px 4px;
  }
  .btn {
    padding: 2px 8px;
    .fa {
      margin-right: 2px;
    }
  }
}

.screened-emails, .screened-urls, .screened-ip-addresses {
  .email, .url, .domain {
    width: 300px;
  }
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/common/admin/admin_base.scss:
      right: -5px;
    }
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    .preview-link {
      margin-left: 15px;
    }
    padding-left: 10px;
    width: 70%;
    .style-name {
      width: 350px;
      height: 25px;
    }
    .ace-wrapper {
      position: relative;
      height: 400px;
      width: 100%;
    }
---
[Medium] chunk lines 961-980 in app/assets/stylesheets/common/admin/admin_base.scss:
    width: 6px;
  }
  ::-webkit-scrollbar-thumb {
    background: dark-light-diff($primary, $secondary, 90%, -75%);
    -webkit-border-radius: 3px;
  }
  ::-webkit-scrollbar-track {
    border-left: solid 1px scale-color-diff();
  }
}

.content-list {

  h3 {
    color: dark-light-diff($primary, $secondary, 50%, -60%);
    font-size: 1.071em;
    padding-left: 5px;
    margin-bottom: 10px;
  }

---
[Medium] chunk lines 1361-1380 in app/assets/stylesheets/common/admin/admin_base.scss:

.badge-groupings {
  list-style: none;
  margin: 0;
  padding: 10px 3px;
  li {
    padding: 6px 0;
    width: 600px;
    border-bottom: 1px solid #dfdfdf;
  }
  .actions {
    font-size: 1.214em;
    float: right;
    a {
      margin-left: 5px;
    }
  }
}

tr.not-activated {
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/common/admin/admin_base.scss:
.display-row.associations .value {
  width: 750px;
}

.display-row {
  line-height: 30px;
  padding: 5px;
  &:nth-of-type(1) {
    border-top: 0;
  }
  &.highlight-danger {
    background-color: scale-color($danger, $lightness: 50%);
  }
  border-top: 1px solid scale-color-diff();
  &:before, &:after {
    display: table;
    content: """";
  }
  &:after {
    clear: both;
---
[Medium] chunk lines 461-480 in app/assets/stylesheets/common/admin/admin_base.scss:

// Groups area
.groups {
  .ac-wrap {
    width: 100% !important;
    .item {
      width: 190px;
      margin-right: 0 !important;
    }
  }
  .next, .previous {
    color: #333 !important;
    &.disabled {
      color: #aaa !important;
    }
  }
  .btn.add {
    margin-top: 7px;
  }
}
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.groups, .badges {
  .form-horizontal {
    label {
      font-weight: bold;
    }

    & > div {
      margin-top: 10px;
    }

    input, textarea, select {
      width: 350px;
    }

    input[type=""checkbox""] {
      width: 20px;
    }
---
[Medium] chunk lines 201-220 in app/assets/stylesheets/common/admin/admin_base.scss:
  padding: 30px 0 30px 30px;
}

.settings {
  .setting {
    padding-bottom: 20px;

    .setting-label {
      float: left;
      width: 17.6576%;
      margin-right: 12px;
    }
    .setting-value {
      float: left;
      width: 53%;
      .select2-container {
        width: 100%;
      }
      .select2-container-multi .select2-choices {
        border: none;
---
[Medium] chunk lines 981-1000 in app/assets/stylesheets/common/admin/admin_base.scss:
  ul {
    list-style: none;
    margin: 0;

    li:first-of-type {
      border-top: 1px solid scale-color-diff();
    }
    li {
      border-bottom: 1px solid scale-color-diff();
    }

    li a {
      display: block;
      padding: 10px;
      color: $primary;

      &:hover {
        background-color: scale-color-diff();
        color: $primary;
      }
---
[Medium] chunk lines 1241-1260 in app/assets/stylesheets/common/admin/admin_base.scss:
  &:active {
    @include linear-gradient($rollback-darker, $rollback-dark);
  }
  &[disabled] {
    background: $rollback;
  }
}

.admin-backups-logs {
  max-height: 500px;
  overflow: auto;
}


button.ru {
  position: relative;
  min-width: 110px;
}

.ru-progress {
---
[Medium] chunk lines 1181-1200 in app/assets/stylesheets/common/admin/admin_base.scss:
  position: relative;
}
.ember-list-item-view {
  position: absolute;
}

.staff-actions, .screened-emails, .screened-urls, .screened-ip-addresses {

  border-bottom: dotted 1px scale-color($primary, $lightness: 75%);

  .heading-container {
    width: 100%;
    background-color: scale-color-diff();
  }
  .col.heading {
    font-weight: bold;
    padding: 4px 0;
  }
  .col {
    display: inline-block;
---
[Medium] chunk lines 1081-1100 in app/assets/stylesheets/common/admin/admin_base.scss:
  .action, .match_count, .last_match_at, .created_at {
    text-align: center;
    width: 9.9099%;
  }
}

.screened-ip-address-form {
  margin-left: 6px;
  .combobox {
    width: 130px;
  }
}

.screened-emails, .screened-urls {
  .ip_address {
    width: 9.9099%;
    text-align: center;
  }
}
.screened-ip-addresses {
---
[Medium] chunk lines 801-820 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  &.detected-problems {
    background: dark-light-diff($primary, $secondary, 90%, -75%);
    margin-bottom: 20px;
    margin-top: 10px;

    .look-here {
      float: left;
      margin: 20px 10px 0 10px;

      .fa {
        font-size: 2.286em
;
        vertical-align: middle;
        color: $primary
      }
    }

---
[Medium] method update in app/controllers/admin/groups_controller.rb:
def update
    group = Group.find(params[:id].to_i)

    group.alias_level = params[:alias_level].to_i if params[:alias_level].present?
    group.visible = params[:visible] == ""true""
    # group rename is ignored for automatic groups
    group.name = params[:name] if params[:name] && !group.automatic

    if group.save
      render json: success_json
    else
      render_json_error group
    end
  end","members (Critical), GroupsController (Medium), lines 1-20 (Medium), index (Medium), create (Medium), Admin::GroupsController (Medium), lines 1-4 (Medium), lines 61-77 (Medium), self (Medium), lines 21-29 (Medium), json (Medium), lines 1-20 (Medium), lines 21-21 (Medium), lines 21-22 (Medium), update_patch (Medium), update_put (Medium), lines 41-60 (Medium), lines 21-40 (Medium), lines 1-20 (Medium), self (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 641-660 (Medium), lines 941-960 (Medium), lines 1021-1040 (Medium), lines 921-940 (Medium), lines 1101-1120 (Medium), lines 341-360 (Medium), lines 761-780 (Medium), lines 581-600 (Medium), lines 681-700 (Medium), lines 601-620 (Medium), lines 1221-1240 (Medium), lines 1201-1220 (Medium), lines 401-420 (Medium), lines 221-240 (Medium), lines 361-380 (Medium), lines 481-500 (Medium), lines 721-740 (Medium), lines 1161-1180 (Medium), lines 1281-1300 (Medium), lines 881-900 (Medium), lines 1261-1280 (Medium), lines 1141-1160 (Medium), lines 781-800 (Medium), lines 841-860 (Medium), lines 861-880 (Medium), lines 821-840 (Medium), lines 1321-1340 (Medium), lines 541-560 (Medium), lines 701-720 (Medium), lines 181-200 (Medium), lines 261-280 (Medium), lines 381-400 (Medium), lines 281-300 (Medium), lines 421-440 (Medium), lines 741-760 (Medium), lines 1041-1060 (Medium), lines 301-320 (Medium), lines 561-580 (Medium), lines 901-920 (Medium), lines 1121-1140 (Medium), lines 621-640 (Medium), lines 241-260 (Medium), lines 661-680 (Medium), lines 441-460 (Medium), lines 1341-1360 (Medium), lines 1001-1020 (Medium), lines 501-520 (Medium), lines 1301-1320 (Medium), lines 1061-1080 (Medium), lines 521-540 (Medium), lines 961-980 (Medium), lines 1361-1380 (Medium), lines 321-340 (Medium), lines 461-480 (Medium), lines 161-180 (Medium), lines 201-220 (Medium), lines 981-1000 (Medium), lines 1241-1260 (Medium), lines 1181-1200 (Medium), lines 1081-1100 (Medium), lines 801-820 (Medium), update (Medium), lines 1401-1420 (Low), lines 61-80 (Low), lines 81-100 (Low), lines 101-112 (Low), lines 21-40 (Low), lines 41-53 (Low), lines 1-1 (Low), lines 1-14 (Low), lines 21-24 (Low), lines 1381-1400 (Low), lines 1421-1422 (Low), add_members (Low), remove_member (Low), find_group (Low), can_not_modify_automatic (Low), lines 1-1 (Low), destroy (Low)",match,'member' matches HC entity 'members'
discourse,8,FIX: proper handling of group memberships,"In the next action, capping the next offset at user_count can produce an empty page (e.g., total equal to limit results in offset == total, showing 2/2 with no members). This can cause confusing UX on the last page.",Medium,101,1,83,"method::members (app/controllers/groups_controller.rb) [Critical, score=1.00]","[Critical] method members in app/controllers/groups_controller.rb:
def members
    group = find_group(:group_id)

    limit = (params[:limit] || 50).to_i
    offset = params[:offset].to_i

    total = group.users.count
    members = group.users.order(:username_lower).limit(limit).offset(offset)

    render json: {
      members: serialize_data(members, GroupUserSerializer),
      meta: {
        total: total,
        limit: limit,
        offset: offset
      }
    }
  end","[Medium] class GroupsController in app/controllers/groups_controller.rb:
class GroupsController < ApplicationController

  def show
    render_serialized(find_group(:id), BasicGroupSerializer)
  end

  def counts
    group = find_group(:group_id)
    render json: {counts: { posts: group.posts_for(guardian).count,
                            members: group.users.count } }
  end

  def posts
    group = find_group(:group_id)
    posts = group.posts_for(guardian, params[:before_post_id]).limit(20)
    render_serialized posts.to_a, GroupPostSerializer
  end

  def member
---
[Medium] chunk lines 1-20 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
export default Em.ObjectController.extend({
  needs: ['adminGroups'],
  disableSave: false,
  usernames: null,

  currentPage: function() {
    if (this.get(""user_count"") == 0) { return 0; }
    return Math.floor(this.get(""offset"") / this.get(""limit"")) + 1;
  }.property(""limit"", ""offset"", ""user_count""),

  totalPages: function() {
    if (this.get(""user_count"") == 0) { return 0; }
    return Math.floor(this.get(""user_count"") / this.get(""limit"")) + 1;
  }.property(""limit"", ""user_count""),

  showi
---
[Medium] method index in app/controllers/admin/groups_controller.rb:
def index
    groups = Group.order(:name)

    if search = params[:search]
      search = search.to_s
      groups = groups.where(""name ILIKE ?"", ""%#{search}%"")
    end

    if params[:ignore_automatic].to_s == ""true""
      groups = groups.where(automatic: false)
    end

    render_serialized(groups, BasicGroupSerializer)
  end
---
[Medium] method create in app/controllers/admin/groups_controller.rb:
def create
    group = Group.new
    group.name = (params[:name] || '').strip
    group.visible = params[:visible] == ""true""

    if group.save
      render_serialized(group, BasicGroupSerializer)
    else
      render_json_error group
    end
  end
---
[Medium] class Admin::GroupsController in app/controllers/admin/groups_controller.rb:
class Admin::GroupsController < Admin::AdminController

  def index
    groups = Group.order(:name)

    if search = params[:search]
      search = search.to_s
      groups = groups.where(""name ILIKE ?"", ""%#{search}%"")
    end

    if params[:ignore_automatic].to_s == ""true""
      groups = groups.where(automatic: false)
    end

    render_serialized(groups, BasicGroupSerializer)
  end

  def show
    render nothing: true
  end

  def create
    group = Group.new
    group.name = (params[:name] 
---
[Medium] chunk lines 1-4 in app/assets/javascripts/admin/views/group-member.js.es6:
export default Discourse.View.extend({
  classNames: [""item""],
  templateName: ""admin/templates/group_member""
});
---
[Medium] chunk lines 61-77 in app/assets/javascripts/admin/controllers/admin-group.js.es6:

      bootbox.confirm(I18n.t(""admin.groups.delete_confirm""), I18n.t(""no_value""), I18n.t(""yes_value""), function(result) {
        if (result) {
          self.set('disableSave', true);
          group.destroy().then(function() {
            groupsController.get('model').removeObject(group);
            self.transitionToRoute('adminGroups.index');
          }, function() {
            bootbox.alert(I18n.t(""admin.groups.delete_failed""));
          }).finally(function() {
            self.set('disa
---
[Medium] variable self in app/assets/javascripts/admin/routes/admin_group_route.js:
var self = this;
---
[Medium] chunk lines 21-29 in app/assets/javascripts/admin/templates/group.hbs:
    {{combo-box valueAttribute=""value"" value=alias_level content=aliasLevelOptions}}
  </div>
</div>
<div class='controls'>
  <button {{action ""save""}} {{bind-attr disabled=""disableSave""}} class='btn'>{{i18n 'admin.customize.save'}}</button>
  {{#unless automatic}}
    <button {{action ""destroy""}} class='btn btn-danger'><i class=""fa fa-trash-o""></i>{{i18n 'admin.customize.delete'}}</button>
  {{/unless}}
</div>
---
[Medium] variable json in app/assets/javascripts/discourse/models/group.js:
var json = this.asJSON();
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/routes/group-members.js.es6:
import ShowFooter from ""discourse/mixins/show-footer"";

export default Discourse.Route.extend(ShowFooter, {
  model: function() {
    return this.modelFor('group');
  },

  afterModel: function(model) {
    var self = this;
    return model.findMembers().then(function(result) {
      self.set('_members', result);
    });
  },

  setupController: function(controller) {
    controller.set('model', this.get('_members'));
    this.controllerFor('group').set('showing', 'members');
  }

});
---
[Medium] chunk lines 21-21 in app/assets/javascripts/discourse/routes/group-members.js.es6:

---
[Medium] chunk lines 21-22 in app/assets/javascripts/discourse/templates/user-selector-autocomplete.raw.hbs:
  </ul>
</div>
---
[Medium] method update_patch in app/controllers/admin/groups_controller.rb:
def update_patch(group)
    raise Discourse::InvalidAccess.new(""automatic groups do not permit membership changes"") if group.automatic

    if actions = params[:changes]
      Array(actions[:add]).each do |username|
        if user = User.find_by_username(username)
          group.add(user)
        end
      end
      Array(actions[:delete]).each do |username|
        if user = User.find_by_username(username)
          group.remove(user)
        end
      end
    end

    render json: success_js
---
[Medium] method update_put in app/controllers/admin/groups_controller.rb:
def update_put(group)
    payload = params[:group]

    group.alias_level = payload[:alias_level].to_i if payload[:alias_level].present?
    group.visible = payload[:visible] == ""true""

    if group.automatic
      # group rename & membership changes are ignored/prohibited for automatic groups
    else
      group.usernames = payload[:usernames] if payload[:usernames]
      group.name = payload[:name] if payload[:name]
    end

    if group.save
      render json: success_json
    else
      ren
---
[Medium] chunk lines 41-60 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
      if (this.get(""showingFirst"")) { return; }

      var group = this.get(""model""),
          offset = Math.max(group.get(""offset"") - group.get(""limit""), 0);

      group.set(""offset"", offset);

      return group.findMembers();
    },

    removeMember: function(member) {
      var self = this,
          message = I18n.t(""admin.groups.delete_member_confirm"", { username: member.get(""username""), group: this.get(""name"") });
      return bootbox.confirm(message, I18n.t(""no_value""), I18n.t(""yes_va
---
[Medium] chunk lines 21-40 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
      { name: I18n.t(""groups.alias_levels.nobody""), value: 0 },
      { name: I18n.t(""groups.alias_levels.mods_and_admins""), value: 2 },
      { name: I18n.t(""groups.alias_levels.members_mods_and_admins""), value: 3 },
      { name: I18n.t(""groups.alias_levels.everyone""), value: 99 }
    ];
  }.property(),

  actions: {
    next: function() {
      if (this.get(""showingLast"")) { return; }

      var group = this.get(""model""),
          offset = Math.min(group.get(""offset"") + group.get(""limit""), g
---
[Medium] chunk lines 1-20 in app/assets/javascripts/admin/templates/group.hbs:
<form class=""form-horizontal"">

  <div>
    {{#if automatic}}
      <h3>{{name}}</h3>
    {{else}}
      <label for=""name"">{{i18n 'admin.groups.name'}}</label>
      {{text-field name=""name"" value=name placeholderKey=""admin.groups.name_placeholder""}}
    {{/if}}
  </div>

  {{#if id}}
    <div>
      <label>{{i18n 'admin.groups.group_members'}} ({{user_count}})</label>
      <div>
        <a {{bind-attr class="":previous showingFirst:disabled""}} {{action ""previous""}}>{{fa-icon ""fast-backward""}}</
---
[Medium] variable self in app/assets/javascripts/discourse/models/group.js:
var self = this;
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/templates/group/members.hbs:
{{#if model}}
  <table class='group-members'>
    <tr>
      <th colspan=""3"" class=""seen"">{{i18n 'last_seen'}}</th>
    </tr>
  {{#each m in members}}
  <tr>
      <td class='avatar'>
        {{avatar m imageSize=""large""}}
      </td>
      <td>
        <h3>{{#link-to 'user' m}}{{m.username}}{{/link-to}}</h3>
        <p>{{m.name}}</p>
      </td>
      <td>
        <span class='last-seen-at'>{{bound-date m.last_seen_at}}</span>
      </td>
    </tr>
    </div>
  {{/each}}
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/templates/user-selector-autocomplete.raw.hbs:
<div class='autocomplete'>
  <ul>
    {{#each options.users}}
      <li>
        <a href='#'>{{avatar this imageSize=""tiny""}}
          <span class='username'>{{this.username}}</span>
          <span class='name'>{{this.name}}</span>
        </a>
      </li>
    {{/each}}
    {{#if options.groups}}
      {{#if options.users}}<hr>{{/if}}
      {{#each options.groups}}
        <li>
          <a href=''>
            <i class='icon-group'></i>
            <span class='username'>{{this.name}}</span>

---
[Medium] chunk lines 641-660 in app/assets/stylesheets/common/admin/admin_base.scss:
    tr {
      height: 44px;
    }
    td {
      vertical-align: middle;
      padding: 3px;
      line-height: 1.4;
    }
  }
  .action {
     button { margin: 4px; }
     text-align: right;
     padding-bottom: 20px;
  }
  td p {
    font-size: 0.929em;
    margin: 0 0 5px 0;
  }
  .flagged-posts { background: $danger; }
}
---
[Medium] chunk lines 941-960 in app/assets/stylesheets/common/admin/admin_base.scss:
        font-weight: bold;
      }

      .commit-meta {
        color: $primary;
        font-size: 0.857em;
      }

      .committer-name {
        font-weight: bold;
        color: $primary;
      }
    }
    li:last-child {
      border: none;
    }
  }

  // Always show the scrollbar:
  ::-webkit-scrollbar {
---
[Medium] chunk lines 1021-1040 in app/assets/stylesheets/common/admin/admin_base.scss:
  .controls {
    margin-top: 10px;
  }

  #pagedown-editor {
    width: 98%;
  }

  textarea.plain {
    width: 98%;
    height: 200px;
  }

  #wmd-input {
    width: 98%;
    height: 200px;
  }

  .ace-wrapper {
    position: relative;
---
[Medium] chunk lines 921-940 in app/assets/stylesheets/common/admin/admin_base.scss:
      line-height: 1.0em;
      padding: 6px 8px;
    background-color: scale-color-diff();
      .left {
        float: left;
      }
      .right {
        margin-left: 52px;
      }

      img {
        margin-top: 2px;
        border: solid 1px scale-color-diff();
        padding: 2px;
        background-color: $secondary;
      }

      .commit-message {
        color: $primary;
        font-size: 0.857em;
---
[Medium] chunk lines 1101-1120 in app/assets/stylesheets/common/admin/admin_base.scss:
  .ip_address {
    width: 150px;
    text-align: left;
    input {
      width: 130px;
    }
  }
  .col.actions {
    width: 275px;
    padding-top: 4px;
    a {
      text-decoration: underline;
    }
  }
}

.staff-actions {
  width: 100%;
  .action {
    width: 10.810%;
---
[Medium] chunk lines 341-360 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
  .field {
    font-weight: bold;
    width: 17.65765%;
    float: left;
    margin-left: 12px;
  }
  .value {
    width: 250px;
    float: left;
    margin-left: 12px;
  }
  .long-value {
    width: 800px;
    float: left;
    margin-left: 12px;
    font-size: 0.929em;

    button {
      margin-left: 10px;
---
[Medium] chunk lines 761-780 in app/assets/stylesheets/common/admin/admin_base.scss:
    th {
      font-weight: normal;
      text-align: center;
      background: dark-light-diff($primary, $secondary, 80%, -65%);
    }
    th.title {
      text-align: left;
    }
    thead {
      tr:hover > td {
        background-color: $secondary;
      }
    }

    td.value {
      font-weight: bold;
      text-align: center;

      i {
        display: none;
---
[Medium] chunk lines 581-600 in app/assets/stylesheets/common/admin/admin_base.scss:
  .color-scheme {
    .controls {
      span, button, a {
        margin-right: 10px;
      }
    }
  }
  .colors {
    thead th       { border: none; }
    td.hex         { width: 100px; }
    td.actions     { width: 200px; }
    .hex-input     { width: 80px; margin-bottom: 0; }
    .hex           { text-align: center; }
    .description   { color: scale-color($primary, $lightness: 50%); }

    .invalid .hex input {
      background-color: white;
      color: black;
      border-color: $danger;
---
[Medium] chunk lines 681-700 in app/assets/stylesheets/common/admin/admin_base.scss:
.version-check {
  margin-top: 10px;

  .version-number {
    font-size: 1.286em;
    font-weight: bold;
    text-align: center;
  }

  .face {
    width: 20px;
  }

  .version-notes .fa {
    vertical-align: bottom;
  }

  &.critical .version-notes .normal-note {
    display: none;
  }
---
[Medium] chunk lines 601-620 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}


.admin-flags {
  table-layout: fixed;

  .hidden-post td.excerpt, .hidden-post td.user { opacity: 0.5; }
  .deleted td.excerpt, .deleted td.user { background-color: scale-color($danger, $lightness: 70%); }
  .message { background-color: dark-light-diff($highlight, $secondary, 50%, -70%); }
  .message:hover { background-color: dark-light-diff($highlight, $secondary, 60%, -60%); }
  td { vertical-align: top; }
  th { text-align: left; }
  .user {
    width: 25px;
    padding: 8px 0 0 0;
  
---
[Medium] chunk lines 1221-1240 in app/assets/stylesheets/common/admin/admin_base.scss:
    color: $success;
  }
  .fa-times {
    color: $danger;
  }
}

// Backups
// --------------------------------------------------

$rollback: #3D9970;
$rollback-dark: darken($rollback, 10%) !default;
$rollback-darker: darken($rollback, 20%) !default;

.btn-rollback {
  color: $secondary;
  background: $rollback;
  &:hover {
    background: $rollback-dark;
  }
---
[Medium] chunk lines 1201-1220 in app/assets/stylesheets/common/admin/admin_base.scss:
    padding-top: 6px;
    vertical-align: top;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .ember-list-item-view {
    width: 100%;
    border-top: solid 1px scale-color-diff();
  }
}

.log-details-modal {
  .modal-tab {
    width: 95%;
  }
}

.tl3-requirements {
  .fa-check {
---
[Medium] chunk lines 401-420 in app/assets/stylesheets/common/admin/admin_base.scss:
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    textarea {
      height: 200px;
    }
  }

  .current-badge-actions {
    margin: 10px;
    padding: 10px;
    border-top: 1px solid scale-color($primary, $lightness: 80%);
  }

  .buttons {
    float: left;
    width: 200px;
    .saving {
      padding: 5px 0 0 0;
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/admin/admin_base.scss:
      }
    }
    .setting-controls {
      float: left;
    }
    .input-setting-string {
      width: 404px;
      @include medium-width { width: 314px; }
      @include small-width  { width: 284px; }
    }
    .input-setting-list {
      width: 408px;
      padding: 1px;
      background-color: $secondary;
      border: 1px solid scale-color-diff();
      border-radius: 3px;
      box-shadow: inset 0 1px 1px rgba(51, 51, 51, 0.3);
      transition: border linear 0.2s, box-shadow linear 0.2s;

---
[Medium] chunk lines 361-380 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  .controls {
    width: 480px;
    float: left;
    margin-left: 12px;
    .btn {
      margin-right: 5px;
    }
  }
}

// Badges area
.badges {
  .content-list ul {
    margin-bottom: 10px;

    .list-badge {
      float: right;
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/common/admin/admin_base.scss:

// Customise area
.customize {
  .admin-footer {
    margin-top: 20px;
  }
  .current-style.maximized {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100000;
    background-color: white;
    width: 100%;
    padding: 0;
    margin: 0;
    .wrapper {
      position: absolute;
      top: 20px;
---
[Medium] chunk lines 721-740 in app/assets/stylesheets/common/admin/admin_base.scss:
  i.fa {
    font-size: 1.429em;
  }
}

table.api-keys {
  margin-top: 10px;
  width: 100%;

  th {
    text-align: left;
    padding: 5px;
  }

  td {
    padding: 5px;
  }

  td.key {
    font-size: 0.857em;
---
[Medium] chunk lines 1161-1180 in app/assets/stylesheets/common/admin/admin_base.scss:

    }
    .label {
      font-weight: bold;
    }
    i {
      margin-left: 6px;
    }
  }
}

.staff-action-logs-instructions {
  margin: 0 0 10px 10px;
}

// Ember.ListView

.ember-list-view {
  overflow-y: auto;
  overflow-x: hidden;
---
[Medium] chunk lines 1281-1300 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.start-backup-modal {
  .btn {
    margin: 10px 0 10px 5px;
  }
  .btn:first-of-type {
    margin-left: 10px;
  }
}

@media all
and (max-width : 850px) {
  .nav-stacked {
    .glyph {width: auto; position: relative;}
    > li > a {padding: 13px}
  }
}

---
[Medium] chunk lines 881-900 in app/assets/stylesheets/common/admin/admin_base.scss:
  ul, li {
    margin: 0;
    padding: 0;
  }
  ul {
    list-style: none;
  }
  a {
    color: $primary;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  .header {
    color: $primary;
    font-weight: bold;
    height: 30px;
    background: dark-light-diff($primary, $secondary, 80%, -75%);
---
[Medium] chunk lines 1261-1280 in app/assets/stylesheets/common/admin/admin_base.scss:
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: rgba(0, 175, 0, 0.3);
}

.is-uploading:hover .ru-progress {
  background: rgba(200, 0, 0, 0.3);
}

.invisible {
  visibility: hidden;
}

.delete-flag-modal, .agree-flag-modal {
  button {
    display: block;
    margin: 10px 0 10px 10px;
    padding: 10px 15px;
---
[Medium] chunk lines 1141-1160 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
    &.value {
      height: 70px;
    }
  }
}

.staff-action-logs-controls {
  margin: 0 0 20px 6px;
  a.filter {
    display: inline-block;
    background-color: scale-color($primary, $lightness: 75%);
    padding: 3px 10px;
    border-radius: 3px;

    color: $primary;
    &:hover {
      color: $primary;
      background-color: scale-color-diff();

---
[Medium] chunk lines 781-800 in app/assets/stylesheets/common/admin/admin_base.scss:
      }

      &.trending-up {
        color: $success;
        i.up {
          display: inline;
        }
      }
      &.trending-down {
        color: $danger;
        i.down {
          display: inline;
        }
      }
      &.no-change {
        i.down {
          display: inline;
          visibility: hidden;
        }
      }
---
[Medium] chunk lines 841-860 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

  &.totals {
    table {
      width: auto;
    }
    margin-top: 12px;
    padding-left: 5px;
    .value {
      text-align: left;
      font-weight: bold;
      padding-left: 8px;
      padding-right: 30px;
    }
  }

  &.trust-levels {
    margin-bottom: 0;
    table {
---
[Medium] chunk lines 861-880 in app/assets/stylesheets/common/admin/admin_base.scss:
      margin-bottom: 0;
    }
    td.value {
      width: 45px;
    }
  }

  .referred-topic-title {
    width: 355px;
    @include medium-width { width: 305px; }
    @include small-width  { width: 265px; }
  }
}


.commits-widget {
  border: solid 1px scale-color-diff();
  height: 180px;
  margin-bottom: 36px;

---
[Medium] chunk lines 821-840 in app/assets/stylesheets/common/admin/admin_base.scss:
    .problem-messages {
      float: left;
      width: 80%;
      margin-left: 1%;
      a {
        text-decoration: underline;
      }
      .actions {
        text-align: right;
      }
      .btn {
        background: dark-light-diff($primary, $secondary, 80%, -85%);
      }
      ul {
        margin-left: 0;
        padding-left: 20px;
      li {
        margin-bottom: 10px;
        }
      }
---
[Medium] chunk lines 1321-1340 in app/assets/stylesheets/common/admin/admin_base.scss:
      }
      .setting-value {
        width: 100%;
        }
      label {
        font-size: 0.929em;
        }
    }
  }

  .content-editor {
    width: 100%;
      #pagedown-editor {
        box-sizing: border-box;
      }
  }

  div.ac-wrap {
    width: 100% !important;
    box-sizing: border-box;
---
[Medium] chunk lines 541-560 in app/assets/stylesheets/common/admin/admin_base.scss:
    &.maximized {
      .admin-container {
        position: absolute;
        bottom: 50px;
        top: 80px;
        width: 100%;
      }
      .admin-footer {
        position: absolute;
        bottom: 10px;
      }
      .ace-wrapper {
        height: 100%;
      }
    }
    .ace_editor {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
---
[Medium] chunk lines 701-720 in app/assets/stylesheets/common/admin/admin_base.scss:
  &.normal .version-notes .critical-note {
    display: none;
  }

  .fa {
    font-size: 1.857em;
  }

  .up-to-date {
    color: $success;
  }
  .updates-available {
    color: $danger;
  }
  .critical-updates-available {
    color: $danger;
  }
}

.update-nag {
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.site-settings-nav {
  width: 18.018%;
  margin-top: 30px;
  .nav-stacked {
    border-right: none;
  }
  li a.active {
    color: $secondary;
    background-color: $quaternary;
  }
}

.site-settings-detail {
  width: 76.5765%;
  min-height: 800px;
  margin-left: 0;
  border-left: solid 1px scale-color-diff();
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/admin/admin_base.scss:

    }

    .desc, .validation-error {
      padding-top: 3px;
      font-size: 80%;
      line-height: 1.4em;
    }

    .validation-error {
      color: $danger;
    }

    .desc {
      color: scale-color($primary, $lightness: 50%);
    }

    h3 {
      font-size: 0.929em;
      font-weight: normal;
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/common/admin/admin_base.scss:
      font-size: 11px;
      font-weight: normal;
      padding: 0 6px;
      color: $secondary;
      background-color: scale-color($tertiary, $lightness: 50%);
      border-radius: 3px;
    }
  }

  .current-badge {
    margin: 20px;

    p.help {
      margin: 0;
      color: scale-color($primary, $lightness: 40%);
      font-size: 0.9em;
    }
  }

  .form-horizontal {
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  .setting.overridden {
    input[type=text] {
      background-color: dark-light-diff($highlight, $secondary, 50%, -60%);

    }

    h3 {
      color: scale-color($highlight, $lightness: -50%);
    }
  }
}

section.details {
  h1 {
    font-size: 1.286em;
    color: $primary;
    padding: 5px 10px;
---
[Medium] chunk lines 421-440 in app/assets/stylesheets/common/admin/admin_base.scss:
      margin-left: 10px;
      width: 80px;
      color: $primary;
    }
  }
}

.badge-query-preview {
  .grant-count, .sample, .error-header {
    margin-left: 10px;
  }

  .badge-errors {
    font-size: 1em;
    line-height: 16px;
    padding: 4px;
    background-color: scale-color-diff();
  }

  .badge-query-plan {
---
[Medium] chunk lines 741-760 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.dashboard-stats {
  margin-bottom: 30px;
  margin-right: 40px;
  h4 {
    font-weight: normal;
    margin-bottom: 8px;
  }

  table {
    width: 100%;

    .title {
      i.fa {
        color: $primary;
      }
    }

---
[Medium] chunk lines 1041-1060 in app/assets/stylesheets/common/admin/admin_base.scss:
    height: 600px;
    width: 100%;
  }
  .ace_editor {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
  }

}

.row.groups {
  input[type='text'] {
    width: 500px;
  }
  input#group-users {
    width: 600px;
  }
---
[Medium] chunk lines 301-320 in app/assets/stylesheets/common/admin/admin_base.scss:
    margin: 30px 0 5px 0;
    border-bottom: 5px solid scale-color-diff();
  }
}

#selected-controls {
  background-color: scale-color($tertiary, $lightness: 75%);
  padding: 8px;
  min-height: 27px;
  position: fixed;
  bottom: 0;
  width: 1075px;
}

.user-controls {
  padding: 5px;
  clear: both;
  text-align: right;
}

---
[Medium] chunk lines 561-580 in app/assets/stylesheets/common/admin/admin_base.scss:
      bottom: 0;
    }
    .status-actions {
      float: right;
      margin-top: 7px;
      span {
        margin-right: 10px;
      }
    }
    .buttons {
      float: left;
      width: 200px;
      .saving {
        padding: 5px 0 0 0;
        margin-left: 10px;
        width: 80px;
        color: $primary;
      }
    }
  }
---
[Medium] chunk lines 901-920 in app/assets/stylesheets/common/admin/admin_base.scss:
    cursor: pointer;

    h1 {
      font-size: 1.286em;
      margin: 5px 0 0 8px;
      display: inline-block;
      line-height: 1.0em;
    }
  }

  .header:hover h1 {
    color: $tertiary;
  }

  .commits-list {
    height: 149px;
    overflow-y:auto;

    li {
      @extend .clearfix;
---
[Medium] chunk lines 1121-1140 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
  .staff_user {
    width: 9.009%;
  }
  .subject {
    width: 18.018%;
  }
  .created_at {
    width: 4.5045%;
  }
  .context {
    width: 18.018%;
  }
  .created_at {
    text-align: center;
  }
  .details {
    width: 300px;
    a {
      text-decoration: underline;
---
[Medium] chunk lines 621-640 in app/assets/stylesheets/common/admin/admin_base.scss:
    width: 75%;
    padding: 8px;
    word-wrap: break-word;
    .fa { display: inline-block; }
    h3 {
      max-height: 1.2em;
      overflow: hidden;
      margin-top: 0;
      margin-bottom: 5px;
    }
  }
  .flaggers {
    font-size: 11px;
    padding: 8px 0 0 5px;
    .avatar {
      width: 25px;
    }
    table {
      max-width: 145px;
    }
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/admin/admin_base.scss:
        cursor: pointer;
        .select2-search-choice-close {
          content: ""x""
        }
      }

      li.sortable-placeholder {
        padding: 3px 5px 3px 18px;
        margin: 3px 0px 3px 5px;
        position: relative;
        line-height: 13px;
        cursor: default;
        border: 1px dashed #AAA;
        border-radius: 3px;
        background-clip: padding-box;
        -moz-user-select: none;
        background-color: none;
        width: 3em;
        height: 1em;
      }
---
[Medium] chunk lines 661-680 in app/assets/stylesheets/common/admin/admin_base.scss:

/* Dashboard */

.dashboard-left {
  float: left;
  margin-top: 10px;
  width: 60%;
}
.dashboard-right {
  float: right;
  margin-top: 10px;
  width: 40%;


  .dashboard-stats {
    width: 100%;
    margin-left: 0;
  }
}

---
[Medium] chunk lines 441-460 in app/assets/stylesheets/common/admin/admin_base.scss:
    font-size: 0.857em;
    line-height: 13px;
    padding: 4px;
    background-color: scale-color-diff();
  }

  .count-warning {
    background-color: dark-light-diff(rgba($danger,.7), $secondary, 50%, -60%);
    margin: 0 0 7px 0;
    padding: 10px 20px;

    p {
      margin: 0;
    }
    .heading {
      color: $danger;
      font-weight: bold;
    }
  }
}
---
[Medium] chunk lines 1341-1360 in app/assets/stylesheets/common/admin/admin_base.scss:
    }

  .admin-container {
    h2 {
      float: left;
      }
  }

  .dashboard-left, .dashboard-right { width: 100%; }
  .dashboard-stats { margin: 0; }

  .badges {
    .current-badge {margin: 70px 0 0 0;}
    .current-badge-actions {padding: 0;}
  }

  .customize .content-list, .customize .current-style {
    width: 100%;
  }
}
---
[Medium] chunk lines 1001-1020 in app/assets/stylesheets/common/admin/admin_base.scss:

      &.active {
        font-weight: bold;
        color: $primary;
      }
    }
  }
}

.content-editor {
  min-height: 500px;

  float: left;
  width: 54.0540%;
  margin-left: 1.8018%;

  p.description {
    color: $primary;
  }

---
[Medium] chunk lines 501-520 in app/assets/stylesheets/common/admin/admin_base.scss:
      bottom: 10px;
      left: 20px;
      right: 20px;
    }
  }
  .nav.nav-pills {
    margin-left: 10px;
  }
  .content-list, .current-style {
    float: left;
  }
  .content-list ul {
    margin-bottom: 10px;
  }
  .current-style {
    .nav.nav-pills{
      position: relative;
    }
    .toggle-maximize {
      position: absolute;
---
[Medium] chunk lines 1301-1320 in app/assets/stylesheets/common/admin/admin_base.scss:
@media all
and (min-width : 320px)
and (max-width : 500px) {

.full-width { margin: 0; }
.site-settings-nav { width: 100%; }
.site-settings-detail {
  width: 100%;
  padding: 0;
  border: none;

  .settings .setting {
      .setting-label {
      float: left;
      width: 100%;
      h3 {
        margin-bottom: 5px;
        font-weight: bold;
        margin-top: 25px;
        }
---
[Medium] chunk lines 1061-1080 in app/assets/stylesheets/common/admin/admin_base.scss:
}

// Logs

.admin-logs-table {
  input.ember-text-field {
    padding: 1px 4px;
  }
  .btn {
    padding: 2px 8px;
    .fa {
      margin-right: 2px;
    }
  }
}

.screened-emails, .screened-urls, .screened-ip-addresses {
  .email, .url, .domain {
    width: 300px;
  }
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/common/admin/admin_base.scss:
      right: -5px;
    }
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    .preview-link {
      margin-left: 15px;
    }
    padding-left: 10px;
    width: 70%;
    .style-name {
      width: 350px;
      height: 25px;
    }
    .ace-wrapper {
      position: relative;
      height: 400px;
      width: 100%;
    }
---
[Medium] chunk lines 961-980 in app/assets/stylesheets/common/admin/admin_base.scss:
    width: 6px;
  }
  ::-webkit-scrollbar-thumb {
    background: dark-light-diff($primary, $secondary, 90%, -75%);
    -webkit-border-radius: 3px;
  }
  ::-webkit-scrollbar-track {
    border-left: solid 1px scale-color-diff();
  }
}

.content-list {

  h3 {
    color: dark-light-diff($primary, $secondary, 50%, -60%);
    font-size: 1.071em;
    padding-left: 5px;
    margin-bottom: 10px;
  }

---
[Medium] chunk lines 1361-1380 in app/assets/stylesheets/common/admin/admin_base.scss:

.badge-groupings {
  list-style: none;
  margin: 0;
  padding: 10px 3px;
  li {
    padding: 6px 0;
    width: 600px;
    border-bottom: 1px solid #dfdfdf;
  }
  .actions {
    font-size: 1.214em;
    float: right;
    a {
      margin-left: 5px;
    }
  }
}

tr.not-activated {
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/common/admin/admin_base.scss:
.display-row.associations .value {
  width: 750px;
}

.display-row {
  line-height: 30px;
  padding: 5px;
  &:nth-of-type(1) {
    border-top: 0;
  }
  &.highlight-danger {
    background-color: scale-color($danger, $lightness: 50%);
  }
  border-top: 1px solid scale-color-diff();
  &:before, &:after {
    display: table;
    content: """";
  }
  &:after {
    clear: both;
---
[Medium] chunk lines 461-480 in app/assets/stylesheets/common/admin/admin_base.scss:

// Groups area
.groups {
  .ac-wrap {
    width: 100% !important;
    .item {
      width: 190px;
      margin-right: 0 !important;
    }
  }
  .next, .previous {
    color: #333 !important;
    &.disabled {
      color: #aaa !important;
    }
  }
  .btn.add {
    margin-top: 7px;
  }
}
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.groups, .badges {
  .form-horizontal {
    label {
      font-weight: bold;
    }

    & > div {
      margin-top: 10px;
    }

    input, textarea, select {
      width: 350px;
    }

    input[type=""checkbox""] {
      width: 20px;
    }
---
[Medium] chunk lines 201-220 in app/assets/stylesheets/common/admin/admin_base.scss:
  padding: 30px 0 30px 30px;
}

.settings {
  .setting {
    padding-bottom: 20px;

    .setting-label {
      float: left;
      width: 17.6576%;
      margin-right: 12px;
    }
    .setting-value {
      float: left;
      width: 53%;
      .select2-container {
        width: 100%;
      }
      .select2-container-multi .select2-choices {
        border: none;
---
[Medium] chunk lines 981-1000 in app/assets/stylesheets/common/admin/admin_base.scss:
  ul {
    list-style: none;
    margin: 0;

    li:first-of-type {
      border-top: 1px solid scale-color-diff();
    }
    li {
      border-bottom: 1px solid scale-color-diff();
    }

    li a {
      display: block;
      padding: 10px;
      color: $primary;

      &:hover {
        background-color: scale-color-diff();
        color: $primary;
      }
---
[Medium] chunk lines 1241-1260 in app/assets/stylesheets/common/admin/admin_base.scss:
  &:active {
    @include linear-gradient($rollback-darker, $rollback-dark);
  }
  &[disabled] {
    background: $rollback;
  }
}

.admin-backups-logs {
  max-height: 500px;
  overflow: auto;
}


button.ru {
  position: relative;
  min-width: 110px;
}

.ru-progress {
---
[Medium] chunk lines 1181-1200 in app/assets/stylesheets/common/admin/admin_base.scss:
  position: relative;
}
.ember-list-item-view {
  position: absolute;
}

.staff-actions, .screened-emails, .screened-urls, .screened-ip-addresses {

  border-bottom: dotted 1px scale-color($primary, $lightness: 75%);

  .heading-container {
    width: 100%;
    background-color: scale-color-diff();
  }
  .col.heading {
    font-weight: bold;
    padding: 4px 0;
  }
  .col {
    display: inline-block;
---
[Medium] chunk lines 1081-1100 in app/assets/stylesheets/common/admin/admin_base.scss:
  .action, .match_count, .last_match_at, .created_at {
    text-align: center;
    width: 9.9099%;
  }
}

.screened-ip-address-form {
  margin-left: 6px;
  .combobox {
    width: 130px;
  }
}

.screened-emails, .screened-urls {
  .ip_address {
    width: 9.9099%;
    text-align: center;
  }
}
.screened-ip-addresses {
---
[Medium] chunk lines 801-820 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  &.detected-problems {
    background: dark-light-diff($primary, $secondary, 90%, -75%);
    margin-bottom: 20px;
    margin-top: 10px;

    .look-here {
      float: left;
      margin: 20px 10px 0 10px;

      .fa {
        font-size: 2.286em
;
        vertical-align: middle;
        color: $primary
      }
    }

---
[Medium] method update in app/controllers/admin/groups_controller.rb:
def update
    group = Group.find(params[:id].to_i)

    group.alias_level = params[:alias_level].to_i if params[:alias_level].present?
    group.visible = params[:visible] == ""true""
    # group rename is ignored for automatic groups
    group.name = params[:name] if params[:name] && !group.automatic

    if group.save
      render json: success_json
    else
      render_json_error group
    end
  end","members (Critical), GroupsController (Medium), lines 1-20 (Medium), index (Medium), create (Medium), Admin::GroupsController (Medium), lines 1-4 (Medium), lines 61-77 (Medium), self (Medium), lines 21-29 (Medium), json (Medium), lines 1-20 (Medium), lines 21-21 (Medium), lines 21-22 (Medium), update_patch (Medium), update_put (Medium), lines 41-60 (Medium), lines 21-40 (Medium), lines 1-20 (Medium), self (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 641-660 (Medium), lines 941-960 (Medium), lines 1021-1040 (Medium), lines 921-940 (Medium), lines 1101-1120 (Medium), lines 341-360 (Medium), lines 761-780 (Medium), lines 581-600 (Medium), lines 681-700 (Medium), lines 601-620 (Medium), lines 1221-1240 (Medium), lines 1201-1220 (Medium), lines 401-420 (Medium), lines 221-240 (Medium), lines 361-380 (Medium), lines 481-500 (Medium), lines 721-740 (Medium), lines 1161-1180 (Medium), lines 1281-1300 (Medium), lines 881-900 (Medium), lines 1261-1280 (Medium), lines 1141-1160 (Medium), lines 781-800 (Medium), lines 841-860 (Medium), lines 861-880 (Medium), lines 821-840 (Medium), lines 1321-1340 (Medium), lines 541-560 (Medium), lines 701-720 (Medium), lines 181-200 (Medium), lines 261-280 (Medium), lines 381-400 (Medium), lines 281-300 (Medium), lines 421-440 (Medium), lines 741-760 (Medium), lines 1041-1060 (Medium), lines 301-320 (Medium), lines 561-580 (Medium), lines 901-920 (Medium), lines 1121-1140 (Medium), lines 621-640 (Medium), lines 241-260 (Medium), lines 661-680 (Medium), lines 441-460 (Medium), lines 1341-1360 (Medium), lines 1001-1020 (Medium), lines 501-520 (Medium), lines 1301-1320 (Medium), lines 1061-1080 (Medium), lines 521-540 (Medium), lines 961-980 (Medium), lines 1361-1380 (Medium), lines 321-340 (Medium), lines 461-480 (Medium), lines 161-180 (Medium), lines 201-220 (Medium), lines 981-1000 (Medium), lines 1241-1260 (Medium), lines 1181-1200 (Medium), lines 1081-1100 (Medium), lines 801-820 (Medium), update (Medium), lines 1401-1420 (Low), lines 61-80 (Low), lines 81-100 (Low), lines 101-112 (Low), lines 21-40 (Low), lines 41-53 (Low), lines 1-1 (Low), lines 1-14 (Low), lines 21-24 (Low), lines 1381-1400 (Low), lines 1421-1422 (Low), add_members (Low), remove_member (Low), find_group (Low), can_not_modify_automatic (Low), lines 1-1 (Low), destroy (Low)",match,'members' matches HC entity 'members'
discourse,8,FIX: proper handling of group memberships,HTTP method mismatch in .remove_member - test uses PUT but remove_member action expects DELETE,Medium,101,1,83,"method::members (app/controllers/groups_controller.rb) [Critical, score=1.00]","[Critical] method members in app/controllers/groups_controller.rb:
def members
    group = find_group(:group_id)

    limit = (params[:limit] || 50).to_i
    offset = params[:offset].to_i

    total = group.users.count
    members = group.users.order(:username_lower).limit(limit).offset(offset)

    render json: {
      members: serialize_data(members, GroupUserSerializer),
      meta: {
        total: total,
        limit: limit,
        offset: offset
      }
    }
  end","[Medium] class GroupsController in app/controllers/groups_controller.rb:
class GroupsController < ApplicationController

  def show
    render_serialized(find_group(:id), BasicGroupSerializer)
  end

  def counts
    group = find_group(:group_id)
    render json: {counts: { posts: group.posts_for(guardian).count,
                            members: group.users.count } }
  end

  def posts
    group = find_group(:group_id)
    posts = group.posts_for(guardian, params[:before_post_id]).limit(20)
    render_serialized posts.to_a, GroupPostSerializer
  end

  def member
---
[Medium] chunk lines 1-20 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
export default Em.ObjectController.extend({
  needs: ['adminGroups'],
  disableSave: false,
  usernames: null,

  currentPage: function() {
    if (this.get(""user_count"") == 0) { return 0; }
    return Math.floor(this.get(""offset"") / this.get(""limit"")) + 1;
  }.property(""limit"", ""offset"", ""user_count""),

  totalPages: function() {
    if (this.get(""user_count"") == 0) { return 0; }
    return Math.floor(this.get(""user_count"") / this.get(""limit"")) + 1;
  }.property(""limit"", ""user_count""),

  showi
---
[Medium] method index in app/controllers/admin/groups_controller.rb:
def index
    groups = Group.order(:name)

    if search = params[:search]
      search = search.to_s
      groups = groups.where(""name ILIKE ?"", ""%#{search}%"")
    end

    if params[:ignore_automatic].to_s == ""true""
      groups = groups.where(automatic: false)
    end

    render_serialized(groups, BasicGroupSerializer)
  end
---
[Medium] method create in app/controllers/admin/groups_controller.rb:
def create
    group = Group.new
    group.name = (params[:name] || '').strip
    group.visible = params[:visible] == ""true""

    if group.save
      render_serialized(group, BasicGroupSerializer)
    else
      render_json_error group
    end
  end
---
[Medium] class Admin::GroupsController in app/controllers/admin/groups_controller.rb:
class Admin::GroupsController < Admin::AdminController

  def index
    groups = Group.order(:name)

    if search = params[:search]
      search = search.to_s
      groups = groups.where(""name ILIKE ?"", ""%#{search}%"")
    end

    if params[:ignore_automatic].to_s == ""true""
      groups = groups.where(automatic: false)
    end

    render_serialized(groups, BasicGroupSerializer)
  end

  def show
    render nothing: true
  end

  def create
    group = Group.new
    group.name = (params[:name] 
---
[Medium] chunk lines 1-4 in app/assets/javascripts/admin/views/group-member.js.es6:
export default Discourse.View.extend({
  classNames: [""item""],
  templateName: ""admin/templates/group_member""
});
---
[Medium] chunk lines 61-77 in app/assets/javascripts/admin/controllers/admin-group.js.es6:

      bootbox.confirm(I18n.t(""admin.groups.delete_confirm""), I18n.t(""no_value""), I18n.t(""yes_value""), function(result) {
        if (result) {
          self.set('disableSave', true);
          group.destroy().then(function() {
            groupsController.get('model').removeObject(group);
            self.transitionToRoute('adminGroups.index');
          }, function() {
            bootbox.alert(I18n.t(""admin.groups.delete_failed""));
          }).finally(function() {
            self.set('disa
---
[Medium] variable self in app/assets/javascripts/admin/routes/admin_group_route.js:
var self = this;
---
[Medium] chunk lines 21-29 in app/assets/javascripts/admin/templates/group.hbs:
    {{combo-box valueAttribute=""value"" value=alias_level content=aliasLevelOptions}}
  </div>
</div>
<div class='controls'>
  <button {{action ""save""}} {{bind-attr disabled=""disableSave""}} class='btn'>{{i18n 'admin.customize.save'}}</button>
  {{#unless automatic}}
    <button {{action ""destroy""}} class='btn btn-danger'><i class=""fa fa-trash-o""></i>{{i18n 'admin.customize.delete'}}</button>
  {{/unless}}
</div>
---
[Medium] variable json in app/assets/javascripts/discourse/models/group.js:
var json = this.asJSON();
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/routes/group-members.js.es6:
import ShowFooter from ""discourse/mixins/show-footer"";

export default Discourse.Route.extend(ShowFooter, {
  model: function() {
    return this.modelFor('group');
  },

  afterModel: function(model) {
    var self = this;
    return model.findMembers().then(function(result) {
      self.set('_members', result);
    });
  },

  setupController: function(controller) {
    controller.set('model', this.get('_members'));
    this.controllerFor('group').set('showing', 'members');
  }

});
---
[Medium] chunk lines 21-21 in app/assets/javascripts/discourse/routes/group-members.js.es6:

---
[Medium] chunk lines 21-22 in app/assets/javascripts/discourse/templates/user-selector-autocomplete.raw.hbs:
  </ul>
</div>
---
[Medium] method update_patch in app/controllers/admin/groups_controller.rb:
def update_patch(group)
    raise Discourse::InvalidAccess.new(""automatic groups do not permit membership changes"") if group.automatic

    if actions = params[:changes]
      Array(actions[:add]).each do |username|
        if user = User.find_by_username(username)
          group.add(user)
        end
      end
      Array(actions[:delete]).each do |username|
        if user = User.find_by_username(username)
          group.remove(user)
        end
      end
    end

    render json: success_js
---
[Medium] method update_put in app/controllers/admin/groups_controller.rb:
def update_put(group)
    payload = params[:group]

    group.alias_level = payload[:alias_level].to_i if payload[:alias_level].present?
    group.visible = payload[:visible] == ""true""

    if group.automatic
      # group rename & membership changes are ignored/prohibited for automatic groups
    else
      group.usernames = payload[:usernames] if payload[:usernames]
      group.name = payload[:name] if payload[:name]
    end

    if group.save
      render json: success_json
    else
      ren
---
[Medium] chunk lines 41-60 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
      if (this.get(""showingFirst"")) { return; }

      var group = this.get(""model""),
          offset = Math.max(group.get(""offset"") - group.get(""limit""), 0);

      group.set(""offset"", offset);

      return group.findMembers();
    },

    removeMember: function(member) {
      var self = this,
          message = I18n.t(""admin.groups.delete_member_confirm"", { username: member.get(""username""), group: this.get(""name"") });
      return bootbox.confirm(message, I18n.t(""no_value""), I18n.t(""yes_va
---
[Medium] chunk lines 21-40 in app/assets/javascripts/admin/controllers/admin-group.js.es6:
      { name: I18n.t(""groups.alias_levels.nobody""), value: 0 },
      { name: I18n.t(""groups.alias_levels.mods_and_admins""), value: 2 },
      { name: I18n.t(""groups.alias_levels.members_mods_and_admins""), value: 3 },
      { name: I18n.t(""groups.alias_levels.everyone""), value: 99 }
    ];
  }.property(),

  actions: {
    next: function() {
      if (this.get(""showingLast"")) { return; }

      var group = this.get(""model""),
          offset = Math.min(group.get(""offset"") + group.get(""limit""), g
---
[Medium] chunk lines 1-20 in app/assets/javascripts/admin/templates/group.hbs:
<form class=""form-horizontal"">

  <div>
    {{#if automatic}}
      <h3>{{name}}</h3>
    {{else}}
      <label for=""name"">{{i18n 'admin.groups.name'}}</label>
      {{text-field name=""name"" value=name placeholderKey=""admin.groups.name_placeholder""}}
    {{/if}}
  </div>

  {{#if id}}
    <div>
      <label>{{i18n 'admin.groups.group_members'}} ({{user_count}})</label>
      <div>
        <a {{bind-attr class="":previous showingFirst:disabled""}} {{action ""previous""}}>{{fa-icon ""fast-backward""}}</
---
[Medium] variable self in app/assets/javascripts/discourse/models/group.js:
var self = this;
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/templates/group/members.hbs:
{{#if model}}
  <table class='group-members'>
    <tr>
      <th colspan=""3"" class=""seen"">{{i18n 'last_seen'}}</th>
    </tr>
  {{#each m in members}}
  <tr>
      <td class='avatar'>
        {{avatar m imageSize=""large""}}
      </td>
      <td>
        <h3>{{#link-to 'user' m}}{{m.username}}{{/link-to}}</h3>
        <p>{{m.name}}</p>
      </td>
      <td>
        <span class='last-seen-at'>{{bound-date m.last_seen_at}}</span>
      </td>
    </tr>
    </div>
  {{/each}}
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/templates/user-selector-autocomplete.raw.hbs:
<div class='autocomplete'>
  <ul>
    {{#each options.users}}
      <li>
        <a href='#'>{{avatar this imageSize=""tiny""}}
          <span class='username'>{{this.username}}</span>
          <span class='name'>{{this.name}}</span>
        </a>
      </li>
    {{/each}}
    {{#if options.groups}}
      {{#if options.users}}<hr>{{/if}}
      {{#each options.groups}}
        <li>
          <a href=''>
            <i class='icon-group'></i>
            <span class='username'>{{this.name}}</span>

---
[Medium] chunk lines 641-660 in app/assets/stylesheets/common/admin/admin_base.scss:
    tr {
      height: 44px;
    }
    td {
      vertical-align: middle;
      padding: 3px;
      line-height: 1.4;
    }
  }
  .action {
     button { margin: 4px; }
     text-align: right;
     padding-bottom: 20px;
  }
  td p {
    font-size: 0.929em;
    margin: 0 0 5px 0;
  }
  .flagged-posts { background: $danger; }
}
---
[Medium] chunk lines 941-960 in app/assets/stylesheets/common/admin/admin_base.scss:
        font-weight: bold;
      }

      .commit-meta {
        color: $primary;
        font-size: 0.857em;
      }

      .committer-name {
        font-weight: bold;
        color: $primary;
      }
    }
    li:last-child {
      border: none;
    }
  }

  // Always show the scrollbar:
  ::-webkit-scrollbar {
---
[Medium] chunk lines 1021-1040 in app/assets/stylesheets/common/admin/admin_base.scss:
  .controls {
    margin-top: 10px;
  }

  #pagedown-editor {
    width: 98%;
  }

  textarea.plain {
    width: 98%;
    height: 200px;
  }

  #wmd-input {
    width: 98%;
    height: 200px;
  }

  .ace-wrapper {
    position: relative;
---
[Medium] chunk lines 921-940 in app/assets/stylesheets/common/admin/admin_base.scss:
      line-height: 1.0em;
      padding: 6px 8px;
    background-color: scale-color-diff();
      .left {
        float: left;
      }
      .right {
        margin-left: 52px;
      }

      img {
        margin-top: 2px;
        border: solid 1px scale-color-diff();
        padding: 2px;
        background-color: $secondary;
      }

      .commit-message {
        color: $primary;
        font-size: 0.857em;
---
[Medium] chunk lines 1101-1120 in app/assets/stylesheets/common/admin/admin_base.scss:
  .ip_address {
    width: 150px;
    text-align: left;
    input {
      width: 130px;
    }
  }
  .col.actions {
    width: 275px;
    padding-top: 4px;
    a {
      text-decoration: underline;
    }
  }
}

.staff-actions {
  width: 100%;
  .action {
    width: 10.810%;
---
[Medium] chunk lines 341-360 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
  .field {
    font-weight: bold;
    width: 17.65765%;
    float: left;
    margin-left: 12px;
  }
  .value {
    width: 250px;
    float: left;
    margin-left: 12px;
  }
  .long-value {
    width: 800px;
    float: left;
    margin-left: 12px;
    font-size: 0.929em;

    button {
      margin-left: 10px;
---
[Medium] chunk lines 761-780 in app/assets/stylesheets/common/admin/admin_base.scss:
    th {
      font-weight: normal;
      text-align: center;
      background: dark-light-diff($primary, $secondary, 80%, -65%);
    }
    th.title {
      text-align: left;
    }
    thead {
      tr:hover > td {
        background-color: $secondary;
      }
    }

    td.value {
      font-weight: bold;
      text-align: center;

      i {
        display: none;
---
[Medium] chunk lines 581-600 in app/assets/stylesheets/common/admin/admin_base.scss:
  .color-scheme {
    .controls {
      span, button, a {
        margin-right: 10px;
      }
    }
  }
  .colors {
    thead th       { border: none; }
    td.hex         { width: 100px; }
    td.actions     { width: 200px; }
    .hex-input     { width: 80px; margin-bottom: 0; }
    .hex           { text-align: center; }
    .description   { color: scale-color($primary, $lightness: 50%); }

    .invalid .hex input {
      background-color: white;
      color: black;
      border-color: $danger;
---
[Medium] chunk lines 681-700 in app/assets/stylesheets/common/admin/admin_base.scss:
.version-check {
  margin-top: 10px;

  .version-number {
    font-size: 1.286em;
    font-weight: bold;
    text-align: center;
  }

  .face {
    width: 20px;
  }

  .version-notes .fa {
    vertical-align: bottom;
  }

  &.critical .version-notes .normal-note {
    display: none;
  }
---
[Medium] chunk lines 601-620 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}


.admin-flags {
  table-layout: fixed;

  .hidden-post td.excerpt, .hidden-post td.user { opacity: 0.5; }
  .deleted td.excerpt, .deleted td.user { background-color: scale-color($danger, $lightness: 70%); }
  .message { background-color: dark-light-diff($highlight, $secondary, 50%, -70%); }
  .message:hover { background-color: dark-light-diff($highlight, $secondary, 60%, -60%); }
  td { vertical-align: top; }
  th { text-align: left; }
  .user {
    width: 25px;
    padding: 8px 0 0 0;
  
---
[Medium] chunk lines 1221-1240 in app/assets/stylesheets/common/admin/admin_base.scss:
    color: $success;
  }
  .fa-times {
    color: $danger;
  }
}

// Backups
// --------------------------------------------------

$rollback: #3D9970;
$rollback-dark: darken($rollback, 10%) !default;
$rollback-darker: darken($rollback, 20%) !default;

.btn-rollback {
  color: $secondary;
  background: $rollback;
  &:hover {
    background: $rollback-dark;
  }
---
[Medium] chunk lines 1201-1220 in app/assets/stylesheets/common/admin/admin_base.scss:
    padding-top: 6px;
    vertical-align: top;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .ember-list-item-view {
    width: 100%;
    border-top: solid 1px scale-color-diff();
  }
}

.log-details-modal {
  .modal-tab {
    width: 95%;
  }
}

.tl3-requirements {
  .fa-check {
---
[Medium] chunk lines 401-420 in app/assets/stylesheets/common/admin/admin_base.scss:
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    textarea {
      height: 200px;
    }
  }

  .current-badge-actions {
    margin: 10px;
    padding: 10px;
    border-top: 1px solid scale-color($primary, $lightness: 80%);
  }

  .buttons {
    float: left;
    width: 200px;
    .saving {
      padding: 5px 0 0 0;
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/admin/admin_base.scss:
      }
    }
    .setting-controls {
      float: left;
    }
    .input-setting-string {
      width: 404px;
      @include medium-width { width: 314px; }
      @include small-width  { width: 284px; }
    }
    .input-setting-list {
      width: 408px;
      padding: 1px;
      background-color: $secondary;
      border: 1px solid scale-color-diff();
      border-radius: 3px;
      box-shadow: inset 0 1px 1px rgba(51, 51, 51, 0.3);
      transition: border linear 0.2s, box-shadow linear 0.2s;

---
[Medium] chunk lines 361-380 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  .controls {
    width: 480px;
    float: left;
    margin-left: 12px;
    .btn {
      margin-right: 5px;
    }
  }
}

// Badges area
.badges {
  .content-list ul {
    margin-bottom: 10px;

    .list-badge {
      float: right;
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/common/admin/admin_base.scss:

// Customise area
.customize {
  .admin-footer {
    margin-top: 20px;
  }
  .current-style.maximized {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100000;
    background-color: white;
    width: 100%;
    padding: 0;
    margin: 0;
    .wrapper {
      position: absolute;
      top: 20px;
---
[Medium] chunk lines 721-740 in app/assets/stylesheets/common/admin/admin_base.scss:
  i.fa {
    font-size: 1.429em;
  }
}

table.api-keys {
  margin-top: 10px;
  width: 100%;

  th {
    text-align: left;
    padding: 5px;
  }

  td {
    padding: 5px;
  }

  td.key {
    font-size: 0.857em;
---
[Medium] chunk lines 1161-1180 in app/assets/stylesheets/common/admin/admin_base.scss:

    }
    .label {
      font-weight: bold;
    }
    i {
      margin-left: 6px;
    }
  }
}

.staff-action-logs-instructions {
  margin: 0 0 10px 10px;
}

// Ember.ListView

.ember-list-view {
  overflow-y: auto;
  overflow-x: hidden;
---
[Medium] chunk lines 1281-1300 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.start-backup-modal {
  .btn {
    margin: 10px 0 10px 5px;
  }
  .btn:first-of-type {
    margin-left: 10px;
  }
}

@media all
and (max-width : 850px) {
  .nav-stacked {
    .glyph {width: auto; position: relative;}
    > li > a {padding: 13px}
  }
}

---
[Medium] chunk lines 881-900 in app/assets/stylesheets/common/admin/admin_base.scss:
  ul, li {
    margin: 0;
    padding: 0;
  }
  ul {
    list-style: none;
  }
  a {
    color: $primary;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  .header {
    color: $primary;
    font-weight: bold;
    height: 30px;
    background: dark-light-diff($primary, $secondary, 80%, -75%);
---
[Medium] chunk lines 1261-1280 in app/assets/stylesheets/common/admin/admin_base.scss:
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: rgba(0, 175, 0, 0.3);
}

.is-uploading:hover .ru-progress {
  background: rgba(200, 0, 0, 0.3);
}

.invisible {
  visibility: hidden;
}

.delete-flag-modal, .agree-flag-modal {
  button {
    display: block;
    margin: 10px 0 10px 10px;
    padding: 10px 15px;
---
[Medium] chunk lines 1141-1160 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
    &.value {
      height: 70px;
    }
  }
}

.staff-action-logs-controls {
  margin: 0 0 20px 6px;
  a.filter {
    display: inline-block;
    background-color: scale-color($primary, $lightness: 75%);
    padding: 3px 10px;
    border-radius: 3px;

    color: $primary;
    &:hover {
      color: $primary;
      background-color: scale-color-diff();

---
[Medium] chunk lines 781-800 in app/assets/stylesheets/common/admin/admin_base.scss:
      }

      &.trending-up {
        color: $success;
        i.up {
          display: inline;
        }
      }
      &.trending-down {
        color: $danger;
        i.down {
          display: inline;
        }
      }
      &.no-change {
        i.down {
          display: inline;
          visibility: hidden;
        }
      }
---
[Medium] chunk lines 841-860 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

  &.totals {
    table {
      width: auto;
    }
    margin-top: 12px;
    padding-left: 5px;
    .value {
      text-align: left;
      font-weight: bold;
      padding-left: 8px;
      padding-right: 30px;
    }
  }

  &.trust-levels {
    margin-bottom: 0;
    table {
---
[Medium] chunk lines 861-880 in app/assets/stylesheets/common/admin/admin_base.scss:
      margin-bottom: 0;
    }
    td.value {
      width: 45px;
    }
  }

  .referred-topic-title {
    width: 355px;
    @include medium-width { width: 305px; }
    @include small-width  { width: 265px; }
  }
}


.commits-widget {
  border: solid 1px scale-color-diff();
  height: 180px;
  margin-bottom: 36px;

---
[Medium] chunk lines 821-840 in app/assets/stylesheets/common/admin/admin_base.scss:
    .problem-messages {
      float: left;
      width: 80%;
      margin-left: 1%;
      a {
        text-decoration: underline;
      }
      .actions {
        text-align: right;
      }
      .btn {
        background: dark-light-diff($primary, $secondary, 80%, -85%);
      }
      ul {
        margin-left: 0;
        padding-left: 20px;
      li {
        margin-bottom: 10px;
        }
      }
---
[Medium] chunk lines 1321-1340 in app/assets/stylesheets/common/admin/admin_base.scss:
      }
      .setting-value {
        width: 100%;
        }
      label {
        font-size: 0.929em;
        }
    }
  }

  .content-editor {
    width: 100%;
      #pagedown-editor {
        box-sizing: border-box;
      }
  }

  div.ac-wrap {
    width: 100% !important;
    box-sizing: border-box;
---
[Medium] chunk lines 541-560 in app/assets/stylesheets/common/admin/admin_base.scss:
    &.maximized {
      .admin-container {
        position: absolute;
        bottom: 50px;
        top: 80px;
        width: 100%;
      }
      .admin-footer {
        position: absolute;
        bottom: 10px;
      }
      .ace-wrapper {
        height: 100%;
      }
    }
    .ace_editor {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
---
[Medium] chunk lines 701-720 in app/assets/stylesheets/common/admin/admin_base.scss:
  &.normal .version-notes .critical-note {
    display: none;
  }

  .fa {
    font-size: 1.857em;
  }

  .up-to-date {
    color: $success;
  }
  .updates-available {
    color: $danger;
  }
  .critical-updates-available {
    color: $danger;
  }
}

.update-nag {
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.site-settings-nav {
  width: 18.018%;
  margin-top: 30px;
  .nav-stacked {
    border-right: none;
  }
  li a.active {
    color: $secondary;
    background-color: $quaternary;
  }
}

.site-settings-detail {
  width: 76.5765%;
  min-height: 800px;
  margin-left: 0;
  border-left: solid 1px scale-color-diff();
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/admin/admin_base.scss:

    }

    .desc, .validation-error {
      padding-top: 3px;
      font-size: 80%;
      line-height: 1.4em;
    }

    .validation-error {
      color: $danger;
    }

    .desc {
      color: scale-color($primary, $lightness: 50%);
    }

    h3 {
      font-size: 0.929em;
      font-weight: normal;
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/common/admin/admin_base.scss:
      font-size: 11px;
      font-weight: normal;
      padding: 0 6px;
      color: $secondary;
      background-color: scale-color($tertiary, $lightness: 50%);
      border-radius: 3px;
    }
  }

  .current-badge {
    margin: 20px;

    p.help {
      margin: 0;
      color: scale-color($primary, $lightness: 40%);
      font-size: 0.9em;
    }
  }

  .form-horizontal {
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  .setting.overridden {
    input[type=text] {
      background-color: dark-light-diff($highlight, $secondary, 50%, -60%);

    }

    h3 {
      color: scale-color($highlight, $lightness: -50%);
    }
  }
}

section.details {
  h1 {
    font-size: 1.286em;
    color: $primary;
    padding: 5px 10px;
---
[Medium] chunk lines 421-440 in app/assets/stylesheets/common/admin/admin_base.scss:
      margin-left: 10px;
      width: 80px;
      color: $primary;
    }
  }
}

.badge-query-preview {
  .grant-count, .sample, .error-header {
    margin-left: 10px;
  }

  .badge-errors {
    font-size: 1em;
    line-height: 16px;
    padding: 4px;
    background-color: scale-color-diff();
  }

  .badge-query-plan {
---
[Medium] chunk lines 741-760 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.dashboard-stats {
  margin-bottom: 30px;
  margin-right: 40px;
  h4 {
    font-weight: normal;
    margin-bottom: 8px;
  }

  table {
    width: 100%;

    .title {
      i.fa {
        color: $primary;
      }
    }

---
[Medium] chunk lines 1041-1060 in app/assets/stylesheets/common/admin/admin_base.scss:
    height: 600px;
    width: 100%;
  }
  .ace_editor {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
  }

}

.row.groups {
  input[type='text'] {
    width: 500px;
  }
  input#group-users {
    width: 600px;
  }
---
[Medium] chunk lines 301-320 in app/assets/stylesheets/common/admin/admin_base.scss:
    margin: 30px 0 5px 0;
    border-bottom: 5px solid scale-color-diff();
  }
}

#selected-controls {
  background-color: scale-color($tertiary, $lightness: 75%);
  padding: 8px;
  min-height: 27px;
  position: fixed;
  bottom: 0;
  width: 1075px;
}

.user-controls {
  padding: 5px;
  clear: both;
  text-align: right;
}

---
[Medium] chunk lines 561-580 in app/assets/stylesheets/common/admin/admin_base.scss:
      bottom: 0;
    }
    .status-actions {
      float: right;
      margin-top: 7px;
      span {
        margin-right: 10px;
      }
    }
    .buttons {
      float: left;
      width: 200px;
      .saving {
        padding: 5px 0 0 0;
        margin-left: 10px;
        width: 80px;
        color: $primary;
      }
    }
  }
---
[Medium] chunk lines 901-920 in app/assets/stylesheets/common/admin/admin_base.scss:
    cursor: pointer;

    h1 {
      font-size: 1.286em;
      margin: 5px 0 0 8px;
      display: inline-block;
      line-height: 1.0em;
    }
  }

  .header:hover h1 {
    color: $tertiary;
  }

  .commits-list {
    height: 149px;
    overflow-y:auto;

    li {
      @extend .clearfix;
---
[Medium] chunk lines 1121-1140 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
  .staff_user {
    width: 9.009%;
  }
  .subject {
    width: 18.018%;
  }
  .created_at {
    width: 4.5045%;
  }
  .context {
    width: 18.018%;
  }
  .created_at {
    text-align: center;
  }
  .details {
    width: 300px;
    a {
      text-decoration: underline;
---
[Medium] chunk lines 621-640 in app/assets/stylesheets/common/admin/admin_base.scss:
    width: 75%;
    padding: 8px;
    word-wrap: break-word;
    .fa { display: inline-block; }
    h3 {
      max-height: 1.2em;
      overflow: hidden;
      margin-top: 0;
      margin-bottom: 5px;
    }
  }
  .flaggers {
    font-size: 11px;
    padding: 8px 0 0 5px;
    .avatar {
      width: 25px;
    }
    table {
      max-width: 145px;
    }
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/admin/admin_base.scss:
        cursor: pointer;
        .select2-search-choice-close {
          content: ""x""
        }
      }

      li.sortable-placeholder {
        padding: 3px 5px 3px 18px;
        margin: 3px 0px 3px 5px;
        position: relative;
        line-height: 13px;
        cursor: default;
        border: 1px dashed #AAA;
        border-radius: 3px;
        background-clip: padding-box;
        -moz-user-select: none;
        background-color: none;
        width: 3em;
        height: 1em;
      }
---
[Medium] chunk lines 661-680 in app/assets/stylesheets/common/admin/admin_base.scss:

/* Dashboard */

.dashboard-left {
  float: left;
  margin-top: 10px;
  width: 60%;
}
.dashboard-right {
  float: right;
  margin-top: 10px;
  width: 40%;


  .dashboard-stats {
    width: 100%;
    margin-left: 0;
  }
}

---
[Medium] chunk lines 441-460 in app/assets/stylesheets/common/admin/admin_base.scss:
    font-size: 0.857em;
    line-height: 13px;
    padding: 4px;
    background-color: scale-color-diff();
  }

  .count-warning {
    background-color: dark-light-diff(rgba($danger,.7), $secondary, 50%, -60%);
    margin: 0 0 7px 0;
    padding: 10px 20px;

    p {
      margin: 0;
    }
    .heading {
      color: $danger;
      font-weight: bold;
    }
  }
}
---
[Medium] chunk lines 1341-1360 in app/assets/stylesheets/common/admin/admin_base.scss:
    }

  .admin-container {
    h2 {
      float: left;
      }
  }

  .dashboard-left, .dashboard-right { width: 100%; }
  .dashboard-stats { margin: 0; }

  .badges {
    .current-badge {margin: 70px 0 0 0;}
    .current-badge-actions {padding: 0;}
  }

  .customize .content-list, .customize .current-style {
    width: 100%;
  }
}
---
[Medium] chunk lines 1001-1020 in app/assets/stylesheets/common/admin/admin_base.scss:

      &.active {
        font-weight: bold;
        color: $primary;
      }
    }
  }
}

.content-editor {
  min-height: 500px;

  float: left;
  width: 54.0540%;
  margin-left: 1.8018%;

  p.description {
    color: $primary;
  }

---
[Medium] chunk lines 501-520 in app/assets/stylesheets/common/admin/admin_base.scss:
      bottom: 10px;
      left: 20px;
      right: 20px;
    }
  }
  .nav.nav-pills {
    margin-left: 10px;
  }
  .content-list, .current-style {
    float: left;
  }
  .content-list ul {
    margin-bottom: 10px;
  }
  .current-style {
    .nav.nav-pills{
      position: relative;
    }
    .toggle-maximize {
      position: absolute;
---
[Medium] chunk lines 1301-1320 in app/assets/stylesheets/common/admin/admin_base.scss:
@media all
and (min-width : 320px)
and (max-width : 500px) {

.full-width { margin: 0; }
.site-settings-nav { width: 100%; }
.site-settings-detail {
  width: 100%;
  padding: 0;
  border: none;

  .settings .setting {
      .setting-label {
      float: left;
      width: 100%;
      h3 {
        margin-bottom: 5px;
        font-weight: bold;
        margin-top: 25px;
        }
---
[Medium] chunk lines 1061-1080 in app/assets/stylesheets/common/admin/admin_base.scss:
}

// Logs

.admin-logs-table {
  input.ember-text-field {
    padding: 1px 4px;
  }
  .btn {
    padding: 2px 8px;
    .fa {
      margin-right: 2px;
    }
  }
}

.screened-emails, .screened-urls, .screened-ip-addresses {
  .email, .url, .domain {
    width: 300px;
  }
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/common/admin/admin_base.scss:
      right: -5px;
    }
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    .preview-link {
      margin-left: 15px;
    }
    padding-left: 10px;
    width: 70%;
    .style-name {
      width: 350px;
      height: 25px;
    }
    .ace-wrapper {
      position: relative;
      height: 400px;
      width: 100%;
    }
---
[Medium] chunk lines 961-980 in app/assets/stylesheets/common/admin/admin_base.scss:
    width: 6px;
  }
  ::-webkit-scrollbar-thumb {
    background: dark-light-diff($primary, $secondary, 90%, -75%);
    -webkit-border-radius: 3px;
  }
  ::-webkit-scrollbar-track {
    border-left: solid 1px scale-color-diff();
  }
}

.content-list {

  h3 {
    color: dark-light-diff($primary, $secondary, 50%, -60%);
    font-size: 1.071em;
    padding-left: 5px;
    margin-bottom: 10px;
  }

---
[Medium] chunk lines 1361-1380 in app/assets/stylesheets/common/admin/admin_base.scss:

.badge-groupings {
  list-style: none;
  margin: 0;
  padding: 10px 3px;
  li {
    padding: 6px 0;
    width: 600px;
    border-bottom: 1px solid #dfdfdf;
  }
  .actions {
    font-size: 1.214em;
    float: right;
    a {
      margin-left: 5px;
    }
  }
}

tr.not-activated {
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/common/admin/admin_base.scss:
.display-row.associations .value {
  width: 750px;
}

.display-row {
  line-height: 30px;
  padding: 5px;
  &:nth-of-type(1) {
    border-top: 0;
  }
  &.highlight-danger {
    background-color: scale-color($danger, $lightness: 50%);
  }
  border-top: 1px solid scale-color-diff();
  &:before, &:after {
    display: table;
    content: """";
  }
  &:after {
    clear: both;
---
[Medium] chunk lines 461-480 in app/assets/stylesheets/common/admin/admin_base.scss:

// Groups area
.groups {
  .ac-wrap {
    width: 100% !important;
    .item {
      width: 190px;
      margin-right: 0 !important;
    }
  }
  .next, .previous {
    color: #333 !important;
    &.disabled {
      color: #aaa !important;
    }
  }
  .btn.add {
    margin-top: 7px;
  }
}
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/common/admin/admin_base.scss:
  }
}

.groups, .badges {
  .form-horizontal {
    label {
      font-weight: bold;
    }

    & > div {
      margin-top: 10px;
    }

    input, textarea, select {
      width: 350px;
    }

    input[type=""checkbox""] {
      width: 20px;
    }
---
[Medium] chunk lines 201-220 in app/assets/stylesheets/common/admin/admin_base.scss:
  padding: 30px 0 30px 30px;
}

.settings {
  .setting {
    padding-bottom: 20px;

    .setting-label {
      float: left;
      width: 17.6576%;
      margin-right: 12px;
    }
    .setting-value {
      float: left;
      width: 53%;
      .select2-container {
        width: 100%;
      }
      .select2-container-multi .select2-choices {
        border: none;
---
[Medium] chunk lines 981-1000 in app/assets/stylesheets/common/admin/admin_base.scss:
  ul {
    list-style: none;
    margin: 0;

    li:first-of-type {
      border-top: 1px solid scale-color-diff();
    }
    li {
      border-bottom: 1px solid scale-color-diff();
    }

    li a {
      display: block;
      padding: 10px;
      color: $primary;

      &:hover {
        background-color: scale-color-diff();
        color: $primary;
      }
---
[Medium] chunk lines 1241-1260 in app/assets/stylesheets/common/admin/admin_base.scss:
  &:active {
    @include linear-gradient($rollback-darker, $rollback-dark);
  }
  &[disabled] {
    background: $rollback;
  }
}

.admin-backups-logs {
  max-height: 500px;
  overflow: auto;
}


button.ru {
  position: relative;
  min-width: 110px;
}

.ru-progress {
---
[Medium] chunk lines 1181-1200 in app/assets/stylesheets/common/admin/admin_base.scss:
  position: relative;
}
.ember-list-item-view {
  position: absolute;
}

.staff-actions, .screened-emails, .screened-urls, .screened-ip-addresses {

  border-bottom: dotted 1px scale-color($primary, $lightness: 75%);

  .heading-container {
    width: 100%;
    background-color: scale-color-diff();
  }
  .col.heading {
    font-weight: bold;
    padding: 4px 0;
  }
  .col {
    display: inline-block;
---
[Medium] chunk lines 1081-1100 in app/assets/stylesheets/common/admin/admin_base.scss:
  .action, .match_count, .last_match_at, .created_at {
    text-align: center;
    width: 9.9099%;
  }
}

.screened-ip-address-form {
  margin-left: 6px;
  .combobox {
    width: 130px;
  }
}

.screened-emails, .screened-urls {
  .ip_address {
    width: 9.9099%;
    text-align: center;
  }
}
.screened-ip-addresses {
---
[Medium] chunk lines 801-820 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }

  &.detected-problems {
    background: dark-light-diff($primary, $secondary, 90%, -75%);
    margin-bottom: 20px;
    margin-top: 10px;

    .look-here {
      float: left;
      margin: 20px 10px 0 10px;

      .fa {
        font-size: 2.286em
;
        vertical-align: middle;
        color: $primary
      }
    }

---
[Medium] method update in app/controllers/admin/groups_controller.rb:
def update
    group = Group.find(params[:id].to_i)

    group.alias_level = params[:alias_level].to_i if params[:alias_level].present?
    group.visible = params[:visible] == ""true""
    # group rename is ignored for automatic groups
    group.name = params[:name] if params[:name] && !group.automatic

    if group.save
      render json: success_json
    else
      render_json_error group
    end
  end","members (Critical), GroupsController (Medium), lines 1-20 (Medium), index (Medium), create (Medium), Admin::GroupsController (Medium), lines 1-4 (Medium), lines 61-77 (Medium), self (Medium), lines 21-29 (Medium), json (Medium), lines 1-20 (Medium), lines 21-21 (Medium), lines 21-22 (Medium), update_patch (Medium), update_put (Medium), lines 41-60 (Medium), lines 21-40 (Medium), lines 1-20 (Medium), self (Medium), lines 1-20 (Medium), lines 1-20 (Medium), lines 641-660 (Medium), lines 941-960 (Medium), lines 1021-1040 (Medium), lines 921-940 (Medium), lines 1101-1120 (Medium), lines 341-360 (Medium), lines 761-780 (Medium), lines 581-600 (Medium), lines 681-700 (Medium), lines 601-620 (Medium), lines 1221-1240 (Medium), lines 1201-1220 (Medium), lines 401-420 (Medium), lines 221-240 (Medium), lines 361-380 (Medium), lines 481-500 (Medium), lines 721-740 (Medium), lines 1161-1180 (Medium), lines 1281-1300 (Medium), lines 881-900 (Medium), lines 1261-1280 (Medium), lines 1141-1160 (Medium), lines 781-800 (Medium), lines 841-860 (Medium), lines 861-880 (Medium), lines 821-840 (Medium), lines 1321-1340 (Medium), lines 541-560 (Medium), lines 701-720 (Medium), lines 181-200 (Medium), lines 261-280 (Medium), lines 381-400 (Medium), lines 281-300 (Medium), lines 421-440 (Medium), lines 741-760 (Medium), lines 1041-1060 (Medium), lines 301-320 (Medium), lines 561-580 (Medium), lines 901-920 (Medium), lines 1121-1140 (Medium), lines 621-640 (Medium), lines 241-260 (Medium), lines 661-680 (Medium), lines 441-460 (Medium), lines 1341-1360 (Medium), lines 1001-1020 (Medium), lines 501-520 (Medium), lines 1301-1320 (Medium), lines 1061-1080 (Medium), lines 521-540 (Medium), lines 961-980 (Medium), lines 1361-1380 (Medium), lines 321-340 (Medium), lines 461-480 (Medium), lines 161-180 (Medium), lines 201-220 (Medium), lines 981-1000 (Medium), lines 1241-1260 (Medium), lines 1181-1200 (Medium), lines 1081-1100 (Medium), lines 801-820 (Medium), update (Medium), lines 1401-1420 (Low), lines 61-80 (Low), lines 81-100 (Low), lines 101-112 (Low), lines 21-40 (Low), lines 41-53 (Low), lines 1-1 (Low), lines 1-14 (Low), lines 21-24 (Low), lines 1381-1400 (Low), lines 1421-1422 (Low), add_members (Low), remove_member (Low), find_group (Low), can_not_modify_automatic (Low), lines 1-1 (Low), destroy (Low)",match,'remove_member' matches entity 'remove_member'
discourse,7,scale-color $lightness must use $secondary for dark themes,"In .topic-meta-data h5 a, the original code had color: scale-color($primary, $lightness: 30%) but was changed to dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%)). The lightness for the light theme changed from 30% to 70%, which is a dramatic inversion",Low,93,0,93,,,"[Medium] chunk lines 581-600 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }
  .next, .previous {
    color: #333 !important;
    &.disabled {
      color: #aaa !important;
    }
  }
  .btn.add {
    margin-top: 7px;
  }
  .controls {
    margin-top: 10px;
  }
  .select2-container {
    width: 100%;
  }
  .select2-choices {
    width: 100%;
    border-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/common/admin/admin_base.scss:
      color: $danger;
    }

    .desc {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }

    h3 {
      font-size: 0.929em;
      font-weight: normal;
    }
  }

  .setting.overridden {
    h3 {
      color: scale-color($highlight, $lightness: -50%);
    }
  }

  .setting.overridden.string {
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/common/admin/admin_base.scss:
  .current-badge-actions {
    margin: 10px;
    padding: 10px;
    border-top: 1px solid dark-light-choose(scale-color($primary, $lightness: 80%), scale-color($secondary, $lightness: 20%));
  }

  .buttons {
    float: left;
    width: 200px;
    .saving {
      padding: 5px 0 0 0;
      margin-left: 10px;
      width: 80px;
      color: $primary;
    }
  }
}

.badge-query-preview {
  .grant-count, .sample, .error-header {
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/common/admin/admin_base.scss:
  .current-badge {
    margin: 20px;

    p.help {
      margin: 0;
      color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
      font-size: 0.9em;
    }
  }

  .form-horizontal {
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    textarea {
      height: 200px;
    }
  }

---
[Medium] chunk lines 1281-1300 in app/assets/stylesheets/common/admin/admin_base.scss:
    a {
      text-decoration: underline;
    }
    &.value {
      height: 70px;
    }
  }
}

.staff-action-logs-controls {
  margin: 0 0 20px 6px;
  a.filter {
    display: inline-block;
    background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    padding: 3px 10px;
    border-radius: 3px;

    color: $primary;
    &:hover {
      color: $primary;
---
[Medium] chunk lines 1321-1340 in app/assets/stylesheets/common/admin/admin_base.scss:
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
}
.ember-list-item-view {
  position: absolute;
}

.staff-actions, .screened-emails, .screened-urls, .screened-ip-addresses, .permalinks {

  border-bottom: dotted 1px dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));

  .heading-container {
    width: 100%;
    background-color: dark-light-diff($primary, $secondary, 90%, -60%);
  }
  .col.heading {
    font-weight: bold;
    paddin
---
[Medium] chunk lines 721-740 in app/assets/stylesheets/common/admin/admin_base.scss:
    thead th       { border: none; }
    td.hex         { width: 100px; }
    td.actions     { width: 200px; }
    .hex-input     { width: 80px; margin-bottom: 0; }
    .hex           { text-align: center; }
    .description   { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }

    .invalid .hex input {
      background-color: white;
      color: black;
      border-color: $danger;
    }
  }
}


.admin-flags {
  table-layout: fixed;

 
---
[Medium] chunk lines 561-580 in app/assets/stylesheets/common/admin/admin_base.scss:
    padding: 10px 20px;

    p {
      margin: 0;
    }
    .heading {
      color: $danger;
      font-weight: bold;
    }
  }
}

// Groups area
.groups {
  .ac-wrap {
    width: 100% !important;
    border-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    .item {
      width: 190px;
      margin-right: 0 !important;
---
[Medium] chunk lines 301-302 in app/assets/stylesheets/common/base/_topic-list.scss:
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
}
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/base/_topic-list.scss:
  td {
    line-height: 1.25;
    text-align: left;
    vertical-align: middle;

  }
  th {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 1em;
    button i.fa {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));}

  }
  td {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
 
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/_topic-list.scss:
    a.title {
      padding: 15px 0;
    }
  }

  .topic-excerpt {
    font-size: 0.929em;
    margin-top: 8px;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    word-wrap: break-word;
    line-height: 1.4;
    padding-right: 20px;
  }
  .topic-statuses:empty {
    display: none;
  }
  .topic-status {
    margin-right: 4px;
    padding: 0;
    font-size: 1.071em;
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/base/_topic-list.scss:
  h2 {
    float: left;
    margin: 5px 0 10px;

    .top-date-string {
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
      font-weight: normal;
      font-size: 0.7em;
      text-transform: uppercase;
    }
  }

  button {
    outline: 0;
    background: transparent;
    border: 0;
    font-size: 1.429em;
    padding: 5px 10px 0 10px;
  }

---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/discourse.scss:
    }
  }
  button.cancel {
    background: $danger;
    color: $secondary;
    @include hover {
      background: lighten($danger, 10%);
      color: $secondary;
    }
  }

  // the default for table cells in topic list
  // is scale-color($primary, $lightness: 50%)
  // numbers get dimmer as they get colder
  .coldmap-high {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%)) !important;
  }
  .coldmap-med {
    color: dark-light-choos
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/base/discourse.scss:
  .coldmap-low {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)) !important;
  }
  .heatmap-high {
    color: #fe7a15 !important;
  }
  .heatmap-med {
    color: #cf7721 !important;
  }
  .heatmap-low {
    color: #9b764f !important;
  }

  #loading-message {
    position: absolute;
    font-size: 2.143em;
    text-align: center;
    top: 120px;
    left: 500px;
    color: $primary;
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/base/header.scss:
      button {margin-left: 5px;}
  }

  .heading a:hover  {
    background-color: dark-light-diff($highlight, $secondary, 50%, -70%);
  }

  .selected {
    background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
  }


  // Notifications
  &#notifications-dropdown {
    .fa { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
    .icon { color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary,
---
[Medium] chunk lines 301-320 in app/assets/stylesheets/common/base/header.scss:
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      background-color: transparent;
      vertical-align: top;
      padding: 5px 5px 2px 5px;
    }
  }

  &#user-dropdown {
    width: 118px;
  }

  .btn {
    padding: 2px 8px;
    margin-bottom: 2px;
    .fa {
      margin-right: 5px;
    }
  }
}

---
[Medium] chunk lines 321-340 in app/assets/stylesheets/common/base/header.scss:
.search-link {
  .badge-category-parent {
    line-height: 0.8em;
  }
  .topic-title {
    margin-right: 6px;
  }

  .topic-statuses {
    float: none;
    display: inline-block;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin: 0;
    .fa {
      margin: 0;
    }
  }
}

.highlight-strong {
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/base/header.scss:
    max-height: 417px;
    top: 100%;
    right: 0;
    z-index: 1100;
    overflow: auto;
    border: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
    padding: 5px;

    box-shadow: 0 2px 2px rgba(0,0,0, .4);

  // note these topic counts only appear for anons in the category hamburger drop down
  b.topics-count {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 11px;
  }

  ul 
---
[Medium] chunk lines 41-55 in app/assets/stylesheets/common/base/login.scss:
      }
    }
    clear: both;
  }
}

// alternate login / create new account buttons should be de-emphasized

button#login-link, button#new-account-link
{
  background: transparent;
  padding-left: 0;
  margin-left: 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/login.scss:
    label {
      width: 92px;
      float: left;
    }
    input[type=text] {
      width: 220px;
      margin-bottom: 0;
    }
    .controls {
      margin-left: 92px;
      margin-bottom: 15px;
      label {
        width: auto;
        text-align: left;
        font-weight: normal;
        float: auto;
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        margin: 0;
---
[Medium] chunk lines 1-7 in app/assets/stylesheets/common/base/notification-options.scss:
.fa.muted {
  color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
}
.fa.tracking, .fa.watching {
  color: $tertiary;
  font-weight: normal;
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/search.scss:
  .search-link {
    .topic-statuses, .topic-title {
      font-size: 1.25em;
    }
  }
  .blurb {
    font-size: 1.0em;
    line-height: 20px;
    word-wrap: break-word;
    clear: both;
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    .date {
      color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    }

    .search-highlight {
      color: dark-light-choose(scale-color(
---
[Medium] chunk lines 61-77 in app/assets/stylesheets/common/base/share_link.scss:
    margin: 5px;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  input[type=text] {
    font-size: 1.143em;
    margin-bottom: 10px;
  }
}

.discourse-no-touch #share-link .share-for-touch {
  display: none;
}

.discourse-touch #share-link input[type=text] {
  display: none;
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/topic-post.scss:
   color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
 }
  .new_user a, .user-title, .user-title a {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
 }
}

// global styles for the cooked HTML content in posts (and preview)
.cooked, .wmd-preview {
  word-wrap: break-word;
  h1, h2, h3, h4, h5, h6 { margin: 30px 0 10px; }
  h1 { line-height: 1em; } /* normalize.css sets h1 font 
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/base/topic-post.scss:
  sup sup {
    top: 0;
  }
}
// we use aside to hold expandable quotes (versus, say, static blockquotes)
aside.quote {
  margin-top: 1em;
  margin-bottom: 1em;

  .badge-wrapper { margin-left: 5px; }

  .title {
    @include post-aside;

    color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    // IE will screw up the blockquote underneath if bottom padding is 0px
    padding: 12px 12px 1px 12px;
    // blockquote is underneath this and 
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/base/topic-post.scss:
// this ensures consistent top margin on topic posts even if the first line of a post
// is a top-margin-less element like a list or image.
.topic-body .regular {
  margin-top: 15px;
}

.post-info {
  &.wiki, &.via-email {
    margin-right: 5px;
    i.fa {
      font-size: 1em;
    }
  }
  &.wiki {
    cursor: pointer;
    color: $wiki;
  }
  &.via-email {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  }
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/topic-post.scss:
    @include unselectable;
  }

  // blockquote is docked within aside for content
  blockquote {
    margin-top: 0;
  }
}

.quote-controls, .quote-controls .back:before, .quote-controls .quote-other-topic:before {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

.cooked .highlight {
  background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
  padding: 2px;
  margin: -2px;
}

.post-action {
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/common/base/topic-post.scss:
.names {
 float: left;
 .username {
   font-weight: bold;
 }
 span {
   font-size: 0.929em;
   padding-right: 8px;
   display: inline-block;
   max-width: 280px;
   white-space: nowrap;
   overflow: hidden;
   text-overflow: ellipsis;
   a {
     color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
   }
 }
 .fa {
   font-size: 11px;
   margin-left: 3px;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/user-badges.scss:
      font-size: 0.8em;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }
}

/* Badge listing in /badges. */
table.badges-listing {
  margin: 20px 0;
  border-bottom: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
  width: 90%;

  .user-badge {
    font-size: $base-font-size;
  }

  tr.title td {
    padding-top: 30px;
    padding-bottom: 15px;
  }
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/base/user-badges.scss:

  tr.title {
    border-top: 0px solid;
  }

  td {
    padding: 10px 0px;
  }

  td.granted{
   color: $success;
   font-size: 120%;
  }

  td.grant-count {
    text-align: center;
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    font-size: 120%;
  }

---
[Medium] chunk lines 101-120 in app/assets/stylesheets/common/base/user.scss:
    float: left;
    padding-right: 4px;
  }

  .user-detail {
    float: left;
    width: 70%;
    padding-left: 5px;
    font-size: 13px;

    .name-line {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .username a {
      font-weight: bold;
      color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    }
---
[Medium] chunk lines 121-133 in app/assets/stylesheets/common/base/user.scss:

    .name {
      margin-left: 5px;
      color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    }

    .title {
      margin-top: 3px;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }

  }
}
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/components/badges.css.scss:
  }

}




// Notification badge
// --------------------------------------------------

.badge-notification {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  vertical-align: middle;
  color: $secondary;
  font-size: 11px;
  line-height: 1;
  text-align: center;
  background-color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  &[href] {
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/components/badges.css.scss:
  font-weight: normal;
  font-size: 1em;
  line-height: 1;
  &[href] {
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
  }
}

// Group badge
// --------------------------------------------------

.badge-group {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  color: $primary;
  text-shadow: 0 1px 0 rgba($primary, 0.1);
  background-color: dark-light-diff($primary, $secondary, 90%, -65%);
  border-color: dark-light-diff($primary, $sec
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/components/buttons.css.scss:

// Default button
// --------------------------------------------------

.btn {
  border: none;
  color: $primary;
  font-weight: normal;
  background: dark-light-diff($primary, $secondary, 90%, -65%);

  &[href] {
    color: $primary;
  }
  &:hover {
    background: dark-light-diff($primary, $secondary, 65%, -75%);
    color: #fff;
  }
  &[disabled] {
    background: dark-light-diff($primary, $secondary, 90%, -60%);
    &:hover { color: dark-light-choose(scale-color($primary, $lightness: 70%),
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/desktop/compose.scss:
    background: $primary;
  }
  }
  .title-input .popup-tip {
    width: 300px;
    left: -8px;
    margin-top: 8px;
  }
  .category-input .popup-tip {
    width: 240px;
    left: 432px;
    top: -19px;
  }
}

.reply-to {
  margin-bottom: 10px;

  i {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/header.scss:
  // Categories

  .btn {
    padding: 2px 8px;
    margin-bottom: 2px;
    .fa {
      margin-right: 5px;
    }
  }
}

.search-link .blurb {
  color: dark-light-choose(scale-color($primary, $lightness: 45%), scale-color($secondary, $lightness: 55%));
  display: block;
  word-wrap: break-word;
  font-size: 11px;
  line-height: 1.3em;
  .search-highlight {
    color: dark-light-choose(scale-color($primary, $lightness: 25%), scale-color($secondary, $lightness: 75%));
  }
---
[Medium] chunk lines 41-56 in app/assets/stylesheets/desktop/login.scss:
    .tip {
      max-width: 340px;
    }
  }

  tr.instructions {
    label {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  .tos-agree {
    margin-bottom: 12px;
  }

}
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/login.scss:
// style that apply to the login popup

#login-buttons {
  button {
    margin: 0 5px 5px 0;
    min-width: 180px;
    &:lang(zh_CN) {
      min-width: 200px;
    }
  }
  margin-top: 10px;
  margin-bottom: 20px;
}

#login-form {
  a {
    color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  }
}

---
[Medium] chunk lines 81-100 in app/assets/stylesheets/desktop/modal.scss:
    }
    .select2-search input {
      width: 378px;
    }
  }
}

.flag-modal {
  max-height: 450px;
}

.custom-message-length {
  margin: -10px 0 10px 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  font-size: 85%;
}

.flag-message {
  margin-left: 20px;
  width: 95% !important;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/desktop/modal.scss:
  .close {margin: 10px;}
}
.close {
  float: right;
  font-size: 1.429em;
  text-decoration: none;
  color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  cursor: pointer;
  &:hover {
    color: $primary;
  }
}

.modal {
  .category-combobox {
    width: 430px;

    .select2-drop {
      left: -9000px;
      width: 428px;
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/desktop/modal.scss:
}

.edit-category-modal {
  .modal-body {
    position: relative;
    height: 420px;
    max-height: 420px;
    padding-bottom: 0;
  }
  .secure-category-options {
    margin: 10px 0 0 16px;
    .badge-list {
      margin: 10px 0;
      li {
        margin: 0 4px 8px 0;
        a {
          color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
          cursor: pointer;
        }
        a:hover {
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/modal.scss:
.modal-footer .btn.right {
  float: right;
}

.modal-footer .btn-group .btn + .btn {
  margin-left: -1px;
}

.modal-footer span.hint {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  float: right;
  line-height: 30px;
}

.modal-header {
  border-bottom: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
  h3 {
    font-size: 1.429em;
    padding: 10px 15px 7px;
  }
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/modal.scss:
          color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
        }
      }
    }
  }

  .cannot_delete_reason {
    float: right;
    text-align: right;
    max-width: 380px;
    color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
  }
}

.topic-bulk-actions-modal {
  p {
    margin-top: 0;
  }
  &.full .modal-body {
    height: 400px;
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/queued-posts.scss:
.queued-posts {
  .queued-post {
    padding: 1em 0;

    .poster {
      width: 70px;
      float: left;
    }
     .post-info  {
       display: inline-block;
       float: right;
       font-size: 0.929em;
       margin-top: 1px;
       span {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
     }

    .cooked {
      width: $topic-body-width;
      float: left;

---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/topic-list.scss:
  }
  .likes {
    width: 65px;
  }
  .views {
    width: 65px;
  }
  .posts {
    width: 65px;
  }

  .post-actions {
    clear: both;
    width: auto;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    text-align: left;
    font-size: 12px;
    margin-top: 5px;
    .fa {
      margin-right: 2px;
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/topic-list.scss:
  a.title {color: $primary;}
  .fa-bookmark { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  th,
  td {
    padding: 12px 5px;
    &:first-of-type {
      padding-left: 10px;
    }
    &:last-of-type {
      padding-right: 10px;
    }
  }
  th {
    button i.fa {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  }

  > tbody > tr {
    &.highlighted {
        background-c
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/desktop/topic-list.scss:
    }
    a {
      font-size: 11px;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      margin-right: 3px;
      line-height: 20px;
    }
  }
  .activity {
    width: 60px;
    &:lang(zh_CN) {
      width: 80px;
    }
    span {
      cursor: pointer;
    }
  }
  .age {
    width: 60px;
  }
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/desktop/topic-list.scss:

  .search .btn {
    float: none;
  }


  a.badge-category {
    padding: 3px 12px;
    font-size: 1.143em;
  }

}

// Base list
// --------------------------------------------------

.topic-list {
  margin: 0 0 10px;
  .fa-thumb-tack { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  .fa-thumb-tack.unpinned { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/desktop/topic-list.scss:
    /* topic status glyphs */
    i {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)) !important;
      font-size: 0.929em;
    }
    a.last-posted-at, a.last-posted-at:visited {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      font-size: 0.88em;
    }
    .badge {
      font-size: 0.714em;
      top: -1px;
    }
  }
}

.topic-list-bottom {
  margin: 20px 0;
}

---
[Medium] chunk lines 261-280 in app/assets/stylesheets/desktop/topic-post.scss:
  }
  &.bottom {
    .row {
      padding-top: 7px;
    }
  }

  // top means ""in reply to expansion"" above a post
  &.top {
    margin-left: 56px;
    width: 701px;
  }
  &.top.topic-body {
    padding-left: 0;
    padding-right: 0;
  }

  .post-date { color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
  .fa-arrow-up, .fa-arrow-down { margin-left: 5px; }
  .reply:first-of-type .row { border-top: none; }
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/desktop/topic-post.scss:

  .topic-meta-data {
    position: relative;
  }
  .topic-meta-data h5 {
    position: absolute;
    z-index: 1;
    font-size: 0.929em;
    a {
      font-weight: bold;
      color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
    }
  }
  .arrow {color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
}

.post-action {
  .relative-date {
    margin-left: 5px;
  }
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/desktop/topic-post.scss:
    color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
    line-height: 23px;
    font-weight: normal;
    font-size: 1em;
  }

  h4 {
    margin: 1px 0 2px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 0.857em;
    line-height: 15px;
  }

  ul {
    margin: 0;
    list-style: none;
  }

  span.domain {
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/topic-post.scss:
    }
  }

  button.create {
    margin-right: 0;
    color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
    margin-left: 10px;
  }

  .create i {
    margin-right: 5px;
  }

  button {
    font-size: 1.143em;
    padding: 8px 10px;
    vertical-align: top;
    background: transparent;
    border: none;
    margin-left: 3px;
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/desktop/topic-post.scss:
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
    }
    a, button {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    margin-right: 2px;
    display: inline-block;
  }

  a.toggle-likes {
    padding: 8px 0;
    margin-right: -3px;
  }

  span.badge-posts {
    margin-right: 5px;
    transition: all linear 0.15s;

  }

  .actions {
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/desktop/topic-post.scss:
    text-align: right;
    float: right;
    display: inline-block;
    .more-actions {
      display: none;
      overflow: hidden;
    }
  }

  .show-replies {
    margin-left: -10px;
    font-size: inherit;
    span.badge-posts {color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
    &:hover {
      background: dark-light-diff($primary, $secondary, 90%, -65%);
      span.badge-posts {color: $primary;}
    }
    i {
      margin-left: 5
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/desktop/topic-post.scss:

.post-cloak {
  padding: 0;

  &:first-of-type {
    border-top: none;
  }

  .reply-to-tab {
    z-index: 400;
    font-size: 0.929em;
    float: right;
    margin: 1px 25px 0 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  .gutter {
    .reply-new {
      .discourse-no-touch & {
        opacity:0;
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/desktop/topic-post.scss:
    .number, i {
      color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
      font-size: 130%;
    }
    .avatar  a {
      float: left;
    }
  }
  .avatars,
  .links,
  .information {
    padding: 7px 10px 15px 10px;
    color: $primary;
  }

  .participants { // PMs //
    .user {float: left; margin: 7px 20px 7px 0;}
  }

  .topic-links {
---
[Medium] chunk lines 401-420 in app/assets/stylesheets/desktop/topic-post.scss:
    .badge-notification {
      margin: 1px 5px 5px 0;
    }
  }

  td {
    vertical-align: top;
    padding:1px;
  }

  .buttons {
    float: right;
    .btn {
      border: 0;
      padding: 0 23px;
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
      background: dark-light-diff($primary, $secondary, 97%, -75%);
      border-left: 1px solid dark-light-diff($primary, $secondary, 90%, -65%);
      border-top: 1px solid dark-ligh
---
[Medium] chunk lines 881-900 in app/assets/stylesheets/desktop/topic-post.scss:
  }
  article.boxed {
    position: relative;

    .select-posts {
      position: absolute;
      left: 100%;
      z-index: 490;
      top: 8px;
      width: 800px;
      height: 100px;
      background-color: $secondary;

      button {
        margin-left: 8px;
        background-color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
        border: 1px solid dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary,
---
[Medium] chunk lines 341-360 in app/assets/stylesheets/desktop/topic-post.scss:
    font-size: 0.714em;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  .avatars {
    > div {
      float: left;
      position: relative;
      margin: 3px 0;
    }
    .post-count {
      position: absolute;
      right: 3px;
      border-radius: 100px;
      padding: 4px 5px 2px 5px;
      text-align: center;
      font-weight: normal;
      font-size: 11px;
      line-height: 1;
    }
---
[Medium] chunk lines 941-960 in app/assets/stylesheets/desktop/topic-post.scss:
   a {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
 }

}

.who-liked {
  margin-top: 20px;
  margin-bottom: 0px;
  width: 100%;
  text-align: right;
}

span.highlighted {
  background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
}

.username.new-user a {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

---
[Medium] chunk lines 61-80 in app/assets/stylesheets/desktop/topic.scss:
  color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  float: left;
  margin: 0 5px 0 0;
}
.private_message #topic-title .private-message-glyph { display: inline; }

a.reply-new {
  margin-top: 3px;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  i {
    margin-right: 3px;
    background: $secondary;
    padding: 1.5px 3px;
    border-radius: 20px;
    transition: all linear .
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/upload.scss:
.upload-selector {
  label {
    display: inline-block;
    padding-left: 10px;
  }
  .radios {
    height: 60px;
    .inputs {
      float: right;
      width: 75%;
      input {
        width: 90%;
        margin: 0 0 5px 0;
      }
      input[type=""file""] {
        font-size: 1em;
        line-height: 18px;
      }
      .description, .hint {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/user.scss:

  .pagedown-editor {
    width: 450px;

    textarea {
      width: 440px;
    }
  }

  .bio-composer #wmd-quote-post {
    display: none;
  }

  .static {
    color: $primary;
    display: inline-block;
  }
  .instructions {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin-left: 160px;
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/desktop/user.scss:
    h2 {
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      margin-top: 10px;

      th {
        text-align: left;
        border-bottom: 3px solid dark-light-diff($primary, $secondary, 90%, -60%);
        padding: 0 0 10px 0;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-weight: normal;
      }

      td {
        padding: 10px 0 10px 0;
        border-bottom: 1px solid dark-light-diff($prima
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/desktop/user.scss:
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
      .title {
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }

  .staff-counters {
    text-align: left;
    background: $primary;
    color: $secondary;
    a {
      color: $secondary;
    }
    > div {
   
---
[Medium] chunk lines 601-620 in app/assets/stylesheets/desktop/user.scss:
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        margin-top: 5px;
        margin-bottom: 10px;
        font-size: 80%;
        line-height: 1.4em;
      }
    }
    clear: both;
    margin-bottom: 10px;
  }
}

.paginated-topics-list {
  .user-content {
    width: 100%;
    margin-top: 0;
  }
}
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/desktop/user.scss:
        display: inline-block;
        margin-left: 10px;
        span {
          color: $primary;
        }
      }
      .time {
        display: inline-block;
        margin-left: 10px;
        float: none;
      }
      // common/base/header.scss
      .fa, .icon {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-size: 1.714em;
      }
    }
    .group-member-info {
      .name {
        display: inline-block;
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/embed.css.scss:
  a {
    color: #5c5c5c
  }
  a.staff {
    background-color: #ffffc2;
  }

  a.new-user {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  }

  span.title {
    font-weight: normal;
    color: #999;
  }
}

img.emoji {
  width: 20px;
  height: 20px;
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/mobile/compose.scss:
    right: -5px;
  }
  .toggle-preview { display:none; }
  .preview-wrapper { display:none; }
  #mobile-uploader { display: none; }
  #draft-status, #file-uploading, .mobile-file-upload {
    float: right;
    margin-right: 8px;
  }
  #file-uploading {
    left: 51%;
    font-size: 0.857em;
    color: scale-color($secondary, $lightness: 50%);
  }
  #draft-status {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  }
  transition: hei
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/compose.scss:
  height: 0;
  background-color: dark-light-diff($primary, $secondary, 90%, -60%);
  bottom: 0;
  font-size: 1em;
  position: fixed;
  .toggler {
    width: 15px;
    right: 1px;
    position: absolute;
    font-size: 1.071em;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    padding: 0 10px 5px 10px;
    &:before {
      font-family: ""FontAwesome"";
      content: ""\f078"";
    }
  }
  a.cancel {
    padding-left: 7px;
    float: l
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/mobile/compose.scss:
        margin: 0;
        padding: 2px;
      }
    }
    #reply-title {
      margin-right: 10px;
      &:disabled {
        background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
      }
    }
    .wmd-input:disabled {
      background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    }
    .wmd-input {
      color: darken($primary, 40%);
    }
    .wmd-input {
      b
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/mobile/login.scss:
// style that apply to the login popup

.btn-social {
  width: 250px;
  font-size: 1.143em;
}

#login-buttons {
  button {
    margin: 0 0 5px 0;
  }
  display: inline-block;
}

#login-form {
  a {
    color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  }
  label { float: left; display: block; }
  textarea, input, select {font-size: 1.143em; clear: left; margin-top: 0; }
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/login.scss:
  }

  tr.instructions {
    label {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  tr.input {
    td.label {
      padding-right: 5px;
    }
  }
}

.create-account {
  .user-field.confirm {
    margin-top: 10px;
    margin-bottom: 10px;
  }
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/mobile/modal.scss:
  margin: -10px 0 10px 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
  font-size: 85%;
}

.flag-message {
  margin-left: 20px;
  width: 95% !important;
}

.edit-category-modal {
  .modal-body {
    position: relative;
    height: 350px;
  }
  &.small .modal-body {
    height: 310px;
  }
  .secure-category-options {
    margin: 10px 0 0 16px;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/mobile/topic-list.scss:
// Base list
// --------------------------------------------------

.topic-list {

  > tbody > tr {
    &.highlighted {
      background-color: scale-color($tertiary, $lightness: 85%);
    }
  }

  th,
  td {
    padding: 7px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  a.title {color: $primary;}

  .badge-notification {
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/mobile/topic-list.scss:
    @include mobile-landscape { width: 270px; }
    @include tablet-landscape { width: 450px; }
    .featured-topic {
      margin: 8px 0;
      a.last-posted-at, a.last-posted-at:visited {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }
  .stats {
    @include not-tablet-landscape { display: none; }
    @include tablet-landscape { min-width: 80px; }
  }
}

.category-list-item {

  border-left: 6px solid;

  h3
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/mobile/topic-list.scss:
    position: relative;
    top: -1px;
      i {color: $secondary;}
  }

  .topic-item-stats {
    margin-top: 8px;
    .category, .num, .last-poster {
      float: left;
    }
    .category a {
      max-width: 160px;
    }
    .num .fa {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  .num.posts {
    font-weight: bold;
---
[Medium] chunk lines 201-220 in app/assets/stylesheets/mobile/topic-list.scss:
    float: left;
  }
  > footer {
    border-top: 0;
    padding: 7px 10px;
    figure {
      float: left;
      margin: 3px 7px 0 0;
      color: dark-light-choose(scale-color($primary, $lightness: 10%), scale-color($secondary, $lightness: 90%));
      font-weight: bold;
      font-size: 0.857em;
    }
    figcaption {
      display: inline;
      font-weight: normal;
    }
    .btn {
      float: right;
      margin-left: 7px;
    }
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/mobile/topic-post.scss:
    color: $primary;
    overflow: auto;
  }

  .participants { // PMs //
    .user {float: left; margin: 0 10px 10px 0;}
  }

  .domain {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  }

  .topic-links {
    .badge-notification {
      margin: 1px 5px 2px 0;
    }
  }

  td {
    vertical-align: top;
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/topic-post.scss:
}

button {
  border: none;
  font-size: 1.214em;
  padding: 8px 10px;
  vertical-align: top;
  background: transparent;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  float: left;
  &.hidden {
    display: none;
  }
  &.admin {
    position: relative;
  }
  &.expand-post {
    margin:10px 0 10px 0;
  }
  &.has-like {color: $love;}
---
[Medium] chunk lines 441-460 in app/assets/stylesheets/mobile/topic-post.scss:
#show-topic-admin {
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  right: 0;
  border-right: 0;
  padding-right: 4px;
  padding-left: 5px;
}

.deleted-user-avatar {
  font-size: 2.571em;
}

span.btn-text {display: none;}

blockquote {
  clear:both;
  /* leave browser defaults for top and bottom here */
  margin-left: 0;
  margin-right: 0;
}
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/mobile/topic-post.scss:
  .names {
    margin: 5px 0 0 5px;
    line-height: 17px;
    padding-left: 60px;
    span {
      display: block;
    }
  }
  .post-info {
    float: right;
    font-size: 0.929em;
    margin: 4px 10px 0 0;
    .edits { margin-right: 5px; }
  }
}

.username.new-user a {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

---
[Medium] chunk lines 241-260 in app/assets/stylesheets/mobile/topic-post.scss:
      }
    }
    a, .number {
      line-height: 20px;
    }
    .number, i {
      color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
      font-size: 110%;
    }

    .avatar + a {
      float: left;
    }
  }
  li.avatars {
    display: none;
  }

  .links, .information, .avatars {
    padding: 7px 10px;
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/mobile/topic-post.scss:
    margin-top: 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    line-height: 23px;
    font-weight: normal;
    font-size: 1em;
  }

  h4 {
    margin: 0 0 3px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 0.857em;
    line-height: 15px;
  }

  .user {
    float: left;
    margin-right: 10px;
  }

---
[Medium] chunk lines 141-160 in app/assets/stylesheets/mobile/topic-post.scss:
}

.post-action .relative-date {
  margin-left: 5px;
}

a.reply-to-tab {
  position: absolute;
  z-index: 400;
  right: 80px;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  span { display: none; }
}

a.star {
  display: inline-block;
  float: left;
  font-size: 1.3em;
}

---
[Medium] chunk lines 21-40 in app/assets/stylesheets/mobile/topic.scss:
    line-height: 1.25em;
    margin: 0;
    a {
      color: $primary;
      vertical-align: middle;
    }
  }
  .title-category-wrapper {
    margin-top:5px;
  }
  .private-message-glyph { display: none; }
}

.private-message-glyph { color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%)); }
.private_message #topic-title .private-message-glyph { display: inline; }


/* both blocks that appear under the standard post control buttons */
.notifica
---
[Medium] chunk lines 1-16 in app/assets/stylesheets/mobile/upload.scss:
.upload-selector {
  input[type=""text""]{
    width: 520px;
  }
  input[type=""file""] {
    font-size: 1em;
    line-height: 18px;
  }
  .description {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }
}

.uploaded-image-preview {
  height: 150px;
}
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/mobile/user.scss:
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }

  .staff-counters {
    text-align: left;
    background: $primary;
    padding: 7px 0;
    display: inline;
    > div {
      margin: 0 10px 0 0;
      display: inline-block;
      padding: 5px 0;
      &:first-of-type {
        padding-left: 10px;
        }
      span {
---
[Medium] chunk lines 561-580 in app/assets/stylesheets/mobile/user.scss:

  .user-field {
    label {
      width: 140px;
      float: left;
      text-align: right;
      font-weight: bold;
    }
    input[type=text] {
      width: 530px;
    }
    .controls {
      label {
        width: auto;
        text-align: left;
        font-weight: normal;
        float: auto;
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/mobile/user.scss:
  input[type=text] {
    @include small-width {
    }
  }

  .bio-composer #wmd-quote-post {
    display: none;
  }

  .static {
    color: $primary;
    display: inline-block;
  }
  .instructions {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin-top: 5px;
    margin-bottom: 10px;
    font-size: 80%;
    line-height: 1.4em;
  }
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/mobile/user.scss:
      }
      .time {
        display: inline-block;
        margin-left: 10px;
        float: none;
      }
      // common/base/header.scss
      .fa, .icon {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-size: 1.714em;
      }
    }
    .group-member-info {
      .name {
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($","lines 581-600 (Medium), lines 381-400 (Medium), lines 521-540 (Medium), lines 501-520 (Medium), lines 1281-1300 (Medium), lines 1321-1340 (Medium), lines 721-740 (Medium), lines 561-580 (Medium), lines 301-302 (Medium), lines 41-60 (Medium), lines 61-80 (Medium), lines 241-260 (Medium), lines 61-80 (Medium), lines 81-100 (Medium), lines 181-200 (Medium), lines 301-320 (Medium), lines 321-340 (Medium), lines 141-160 (Medium), lines 41-55 (Medium), lines 21-40 (Medium), lines 1-7 (Medium), lines 21-40 (Medium), lines 61-77 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 141-160 (Medium), lines 61-80 (Medium), lines 1-20 (Medium), lines 61-80 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 121-133 (Medium), lines 221-240 (Medium), lines 281-300 (Medium), lines 41-60 (Medium), lines 321-340 (Medium), lines 41-60 (Medium), lines 41-56 (Medium), lines 1-20 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), lines 101-120 (Medium), lines 41-60 (Medium), lines 121-140 (Medium), lines 1-20 (Medium), lines 121-140 (Medium), lines 41-60 (Medium), lines 141-160 (Medium), lines 21-40 (Medium), lines 221-240 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 321-340 (Medium), lines 121-140 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 21-40 (Medium), lines 381-400 (Medium), lines 401-420 (Medium), lines 881-900 (Medium), lines 341-360 (Medium), lines 941-960 (Medium), lines 61-80 (Medium), lines 1-20 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 521-540 (Medium), lines 601-620 (Medium), lines 501-520 (Medium), lines 81-100 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 1-20 (Medium), lines 41-60 (Medium), lines 101-120 (Medium), lines 61-80 (Medium), lines 141-160 (Medium), lines 81-100 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 41-60 (Medium), lines 441-460 (Medium), lines 481-500 (Medium), lines 241-260 (Medium), lines 181-200 (Medium), lines 141-160 (Medium), lines 21-40 (Medium), lines 1-16 (Medium), lines 501-520 (Medium), lines 561-580 (Medium), lines 101-120 (Medium), lines 481-500 (Medium)",miss,"CSS changes, no HC entities, only line-range Medium chunks"
discourse,7,scale-color $lightness must use $secondary for dark themes,This change for desktop/user.css changes $primary from 30% to 50% for the light theme; most other changes preserve the original $primary value and move the complement to $secondary for dark. Consider reviewing this (also applies to a similar .name change in the mobile variant).,Low,93,0,93,,,"[Medium] chunk lines 581-600 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }
  .next, .previous {
    color: #333 !important;
    &.disabled {
      color: #aaa !important;
    }
  }
  .btn.add {
    margin-top: 7px;
  }
  .controls {
    margin-top: 10px;
  }
  .select2-container {
    width: 100%;
  }
  .select2-choices {
    width: 100%;
    border-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/common/admin/admin_base.scss:
      color: $danger;
    }

    .desc {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }

    h3 {
      font-size: 0.929em;
      font-weight: normal;
    }
  }

  .setting.overridden {
    h3 {
      color: scale-color($highlight, $lightness: -50%);
    }
  }

  .setting.overridden.string {
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/common/admin/admin_base.scss:
  .current-badge-actions {
    margin: 10px;
    padding: 10px;
    border-top: 1px solid dark-light-choose(scale-color($primary, $lightness: 80%), scale-color($secondary, $lightness: 20%));
  }

  .buttons {
    float: left;
    width: 200px;
    .saving {
      padding: 5px 0 0 0;
      margin-left: 10px;
      width: 80px;
      color: $primary;
    }
  }
}

.badge-query-preview {
  .grant-count, .sample, .error-header {
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/common/admin/admin_base.scss:
  .current-badge {
    margin: 20px;

    p.help {
      margin: 0;
      color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
      font-size: 0.9em;
    }
  }

  .form-horizontal {
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    textarea {
      height: 200px;
    }
  }

---
[Medium] chunk lines 1281-1300 in app/assets/stylesheets/common/admin/admin_base.scss:
    a {
      text-decoration: underline;
    }
    &.value {
      height: 70px;
    }
  }
}

.staff-action-logs-controls {
  margin: 0 0 20px 6px;
  a.filter {
    display: inline-block;
    background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    padding: 3px 10px;
    border-radius: 3px;

    color: $primary;
    &:hover {
      color: $primary;
---
[Medium] chunk lines 1321-1340 in app/assets/stylesheets/common/admin/admin_base.scss:
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
}
.ember-list-item-view {
  position: absolute;
}

.staff-actions, .screened-emails, .screened-urls, .screened-ip-addresses, .permalinks {

  border-bottom: dotted 1px dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));

  .heading-container {
    width: 100%;
    background-color: dark-light-diff($primary, $secondary, 90%, -60%);
  }
  .col.heading {
    font-weight: bold;
    paddin
---
[Medium] chunk lines 721-740 in app/assets/stylesheets/common/admin/admin_base.scss:
    thead th       { border: none; }
    td.hex         { width: 100px; }
    td.actions     { width: 200px; }
    .hex-input     { width: 80px; margin-bottom: 0; }
    .hex           { text-align: center; }
    .description   { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }

    .invalid .hex input {
      background-color: white;
      color: black;
      border-color: $danger;
    }
  }
}


.admin-flags {
  table-layout: fixed;

 
---
[Medium] chunk lines 561-580 in app/assets/stylesheets/common/admin/admin_base.scss:
    padding: 10px 20px;

    p {
      margin: 0;
    }
    .heading {
      color: $danger;
      font-weight: bold;
    }
  }
}

// Groups area
.groups {
  .ac-wrap {
    width: 100% !important;
    border-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    .item {
      width: 190px;
      margin-right: 0 !important;
---
[Medium] chunk lines 301-302 in app/assets/stylesheets/common/base/_topic-list.scss:
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
}
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/base/_topic-list.scss:
  td {
    line-height: 1.25;
    text-align: left;
    vertical-align: middle;

  }
  th {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 1em;
    button i.fa {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));}

  }
  td {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
 
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/_topic-list.scss:
    a.title {
      padding: 15px 0;
    }
  }

  .topic-excerpt {
    font-size: 0.929em;
    margin-top: 8px;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    word-wrap: break-word;
    line-height: 1.4;
    padding-right: 20px;
  }
  .topic-statuses:empty {
    display: none;
  }
  .topic-status {
    margin-right: 4px;
    padding: 0;
    font-size: 1.071em;
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/base/_topic-list.scss:
  h2 {
    float: left;
    margin: 5px 0 10px;

    .top-date-string {
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
      font-weight: normal;
      font-size: 0.7em;
      text-transform: uppercase;
    }
  }

  button {
    outline: 0;
    background: transparent;
    border: 0;
    font-size: 1.429em;
    padding: 5px 10px 0 10px;
  }

---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/discourse.scss:
    }
  }
  button.cancel {
    background: $danger;
    color: $secondary;
    @include hover {
      background: lighten($danger, 10%);
      color: $secondary;
    }
  }

  // the default for table cells in topic list
  // is scale-color($primary, $lightness: 50%)
  // numbers get dimmer as they get colder
  .coldmap-high {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%)) !important;
  }
  .coldmap-med {
    color: dark-light-choos
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/base/discourse.scss:
  .coldmap-low {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)) !important;
  }
  .heatmap-high {
    color: #fe7a15 !important;
  }
  .heatmap-med {
    color: #cf7721 !important;
  }
  .heatmap-low {
    color: #9b764f !important;
  }

  #loading-message {
    position: absolute;
    font-size: 2.143em;
    text-align: center;
    top: 120px;
    left: 500px;
    color: $primary;
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/base/header.scss:
      button {margin-left: 5px;}
  }

  .heading a:hover  {
    background-color: dark-light-diff($highlight, $secondary, 50%, -70%);
  }

  .selected {
    background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
  }


  // Notifications
  &#notifications-dropdown {
    .fa { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
    .icon { color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary,
---
[Medium] chunk lines 301-320 in app/assets/stylesheets/common/base/header.scss:
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      background-color: transparent;
      vertical-align: top;
      padding: 5px 5px 2px 5px;
    }
  }

  &#user-dropdown {
    width: 118px;
  }

  .btn {
    padding: 2px 8px;
    margin-bottom: 2px;
    .fa {
      margin-right: 5px;
    }
  }
}

---
[Medium] chunk lines 321-340 in app/assets/stylesheets/common/base/header.scss:
.search-link {
  .badge-category-parent {
    line-height: 0.8em;
  }
  .topic-title {
    margin-right: 6px;
  }

  .topic-statuses {
    float: none;
    display: inline-block;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin: 0;
    .fa {
      margin: 0;
    }
  }
}

.highlight-strong {
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/base/header.scss:
    max-height: 417px;
    top: 100%;
    right: 0;
    z-index: 1100;
    overflow: auto;
    border: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
    padding: 5px;

    box-shadow: 0 2px 2px rgba(0,0,0, .4);

  // note these topic counts only appear for anons in the category hamburger drop down
  b.topics-count {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 11px;
  }

  ul 
---
[Medium] chunk lines 41-55 in app/assets/stylesheets/common/base/login.scss:
      }
    }
    clear: both;
  }
}

// alternate login / create new account buttons should be de-emphasized

button#login-link, button#new-account-link
{
  background: transparent;
  padding-left: 0;
  margin-left: 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/login.scss:
    label {
      width: 92px;
      float: left;
    }
    input[type=text] {
      width: 220px;
      margin-bottom: 0;
    }
    .controls {
      margin-left: 92px;
      margin-bottom: 15px;
      label {
        width: auto;
        text-align: left;
        font-weight: normal;
        float: auto;
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        margin: 0;
---
[Medium] chunk lines 1-7 in app/assets/stylesheets/common/base/notification-options.scss:
.fa.muted {
  color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
}
.fa.tracking, .fa.watching {
  color: $tertiary;
  font-weight: normal;
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/search.scss:
  .search-link {
    .topic-statuses, .topic-title {
      font-size: 1.25em;
    }
  }
  .blurb {
    font-size: 1.0em;
    line-height: 20px;
    word-wrap: break-word;
    clear: both;
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    .date {
      color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    }

    .search-highlight {
      color: dark-light-choose(scale-color(
---
[Medium] chunk lines 61-77 in app/assets/stylesheets/common/base/share_link.scss:
    margin: 5px;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  input[type=text] {
    font-size: 1.143em;
    margin-bottom: 10px;
  }
}

.discourse-no-touch #share-link .share-for-touch {
  display: none;
}

.discourse-touch #share-link input[type=text] {
  display: none;
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/topic-post.scss:
   color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
 }
  .new_user a, .user-title, .user-title a {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
 }
}

// global styles for the cooked HTML content in posts (and preview)
.cooked, .wmd-preview {
  word-wrap: break-word;
  h1, h2, h3, h4, h5, h6 { margin: 30px 0 10px; }
  h1 { line-height: 1em; } /* normalize.css sets h1 font 
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/base/topic-post.scss:
  sup sup {
    top: 0;
  }
}
// we use aside to hold expandable quotes (versus, say, static blockquotes)
aside.quote {
  margin-top: 1em;
  margin-bottom: 1em;

  .badge-wrapper { margin-left: 5px; }

  .title {
    @include post-aside;

    color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    // IE will screw up the blockquote underneath if bottom padding is 0px
    padding: 12px 12px 1px 12px;
    // blockquote is underneath this and 
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/base/topic-post.scss:
// this ensures consistent top margin on topic posts even if the first line of a post
// is a top-margin-less element like a list or image.
.topic-body .regular {
  margin-top: 15px;
}

.post-info {
  &.wiki, &.via-email {
    margin-right: 5px;
    i.fa {
      font-size: 1em;
    }
  }
  &.wiki {
    cursor: pointer;
    color: $wiki;
  }
  &.via-email {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  }
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/topic-post.scss:
    @include unselectable;
  }

  // blockquote is docked within aside for content
  blockquote {
    margin-top: 0;
  }
}

.quote-controls, .quote-controls .back:before, .quote-controls .quote-other-topic:before {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

.cooked .highlight {
  background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
  padding: 2px;
  margin: -2px;
}

.post-action {
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/common/base/topic-post.scss:
.names {
 float: left;
 .username {
   font-weight: bold;
 }
 span {
   font-size: 0.929em;
   padding-right: 8px;
   display: inline-block;
   max-width: 280px;
   white-space: nowrap;
   overflow: hidden;
   text-overflow: ellipsis;
   a {
     color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
   }
 }
 .fa {
   font-size: 11px;
   margin-left: 3px;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/user-badges.scss:
      font-size: 0.8em;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }
}

/* Badge listing in /badges. */
table.badges-listing {
  margin: 20px 0;
  border-bottom: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
  width: 90%;

  .user-badge {
    font-size: $base-font-size;
  }

  tr.title td {
    padding-top: 30px;
    padding-bottom: 15px;
  }
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/base/user-badges.scss:

  tr.title {
    border-top: 0px solid;
  }

  td {
    padding: 10px 0px;
  }

  td.granted{
   color: $success;
   font-size: 120%;
  }

  td.grant-count {
    text-align: center;
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    font-size: 120%;
  }

---
[Medium] chunk lines 101-120 in app/assets/stylesheets/common/base/user.scss:
    float: left;
    padding-right: 4px;
  }

  .user-detail {
    float: left;
    width: 70%;
    padding-left: 5px;
    font-size: 13px;

    .name-line {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .username a {
      font-weight: bold;
      color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    }
---
[Medium] chunk lines 121-133 in app/assets/stylesheets/common/base/user.scss:

    .name {
      margin-left: 5px;
      color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    }

    .title {
      margin-top: 3px;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }

  }
}
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/components/badges.css.scss:
  }

}




// Notification badge
// --------------------------------------------------

.badge-notification {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  vertical-align: middle;
  color: $secondary;
  font-size: 11px;
  line-height: 1;
  text-align: center;
  background-color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  &[href] {
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/components/badges.css.scss:
  font-weight: normal;
  font-size: 1em;
  line-height: 1;
  &[href] {
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
  }
}

// Group badge
// --------------------------------------------------

.badge-group {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  color: $primary;
  text-shadow: 0 1px 0 rgba($primary, 0.1);
  background-color: dark-light-diff($primary, $secondary, 90%, -65%);
  border-color: dark-light-diff($primary, $sec
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/components/buttons.css.scss:

// Default button
// --------------------------------------------------

.btn {
  border: none;
  color: $primary;
  font-weight: normal;
  background: dark-light-diff($primary, $secondary, 90%, -65%);

  &[href] {
    color: $primary;
  }
  &:hover {
    background: dark-light-diff($primary, $secondary, 65%, -75%);
    color: #fff;
  }
  &[disabled] {
    background: dark-light-diff($primary, $secondary, 90%, -60%);
    &:hover { color: dark-light-choose(scale-color($primary, $lightness: 70%),
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/desktop/compose.scss:
    background: $primary;
  }
  }
  .title-input .popup-tip {
    width: 300px;
    left: -8px;
    margin-top: 8px;
  }
  .category-input .popup-tip {
    width: 240px;
    left: 432px;
    top: -19px;
  }
}

.reply-to {
  margin-bottom: 10px;

  i {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/header.scss:
  // Categories

  .btn {
    padding: 2px 8px;
    margin-bottom: 2px;
    .fa {
      margin-right: 5px;
    }
  }
}

.search-link .blurb {
  color: dark-light-choose(scale-color($primary, $lightness: 45%), scale-color($secondary, $lightness: 55%));
  display: block;
  word-wrap: break-word;
  font-size: 11px;
  line-height: 1.3em;
  .search-highlight {
    color: dark-light-choose(scale-color($primary, $lightness: 25%), scale-color($secondary, $lightness: 75%));
  }
---
[Medium] chunk lines 41-56 in app/assets/stylesheets/desktop/login.scss:
    .tip {
      max-width: 340px;
    }
  }

  tr.instructions {
    label {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  .tos-agree {
    margin-bottom: 12px;
  }

}
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/login.scss:
// style that apply to the login popup

#login-buttons {
  button {
    margin: 0 5px 5px 0;
    min-width: 180px;
    &:lang(zh_CN) {
      min-width: 200px;
    }
  }
  margin-top: 10px;
  margin-bottom: 20px;
}

#login-form {
  a {
    color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  }
}

---
[Medium] chunk lines 81-100 in app/assets/stylesheets/desktop/modal.scss:
    }
    .select2-search input {
      width: 378px;
    }
  }
}

.flag-modal {
  max-height: 450px;
}

.custom-message-length {
  margin: -10px 0 10px 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  font-size: 85%;
}

.flag-message {
  margin-left: 20px;
  width: 95% !important;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/desktop/modal.scss:
  .close {margin: 10px;}
}
.close {
  float: right;
  font-size: 1.429em;
  text-decoration: none;
  color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  cursor: pointer;
  &:hover {
    color: $primary;
  }
}

.modal {
  .category-combobox {
    width: 430px;

    .select2-drop {
      left: -9000px;
      width: 428px;
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/desktop/modal.scss:
}

.edit-category-modal {
  .modal-body {
    position: relative;
    height: 420px;
    max-height: 420px;
    padding-bottom: 0;
  }
  .secure-category-options {
    margin: 10px 0 0 16px;
    .badge-list {
      margin: 10px 0;
      li {
        margin: 0 4px 8px 0;
        a {
          color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
          cursor: pointer;
        }
        a:hover {
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/modal.scss:
.modal-footer .btn.right {
  float: right;
}

.modal-footer .btn-group .btn + .btn {
  margin-left: -1px;
}

.modal-footer span.hint {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  float: right;
  line-height: 30px;
}

.modal-header {
  border-bottom: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
  h3 {
    font-size: 1.429em;
    padding: 10px 15px 7px;
  }
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/modal.scss:
          color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
        }
      }
    }
  }

  .cannot_delete_reason {
    float: right;
    text-align: right;
    max-width: 380px;
    color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
  }
}

.topic-bulk-actions-modal {
  p {
    margin-top: 0;
  }
  &.full .modal-body {
    height: 400px;
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/queued-posts.scss:
.queued-posts {
  .queued-post {
    padding: 1em 0;

    .poster {
      width: 70px;
      float: left;
    }
     .post-info  {
       display: inline-block;
       float: right;
       font-size: 0.929em;
       margin-top: 1px;
       span {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
     }

    .cooked {
      width: $topic-body-width;
      float: left;

---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/topic-list.scss:
  }
  .likes {
    width: 65px;
  }
  .views {
    width: 65px;
  }
  .posts {
    width: 65px;
  }

  .post-actions {
    clear: both;
    width: auto;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    text-align: left;
    font-size: 12px;
    margin-top: 5px;
    .fa {
      margin-right: 2px;
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/topic-list.scss:
  a.title {color: $primary;}
  .fa-bookmark { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  th,
  td {
    padding: 12px 5px;
    &:first-of-type {
      padding-left: 10px;
    }
    &:last-of-type {
      padding-right: 10px;
    }
  }
  th {
    button i.fa {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  }

  > tbody > tr {
    &.highlighted {
        background-c
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/desktop/topic-list.scss:
    }
    a {
      font-size: 11px;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      margin-right: 3px;
      line-height: 20px;
    }
  }
  .activity {
    width: 60px;
    &:lang(zh_CN) {
      width: 80px;
    }
    span {
      cursor: pointer;
    }
  }
  .age {
    width: 60px;
  }
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/desktop/topic-list.scss:

  .search .btn {
    float: none;
  }


  a.badge-category {
    padding: 3px 12px;
    font-size: 1.143em;
  }

}

// Base list
// --------------------------------------------------

.topic-list {
  margin: 0 0 10px;
  .fa-thumb-tack { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  .fa-thumb-tack.unpinned { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/desktop/topic-list.scss:
    /* topic status glyphs */
    i {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)) !important;
      font-size: 0.929em;
    }
    a.last-posted-at, a.last-posted-at:visited {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      font-size: 0.88em;
    }
    .badge {
      font-size: 0.714em;
      top: -1px;
    }
  }
}

.topic-list-bottom {
  margin: 20px 0;
}

---
[Medium] chunk lines 261-280 in app/assets/stylesheets/desktop/topic-post.scss:
  }
  &.bottom {
    .row {
      padding-top: 7px;
    }
  }

  // top means ""in reply to expansion"" above a post
  &.top {
    margin-left: 56px;
    width: 701px;
  }
  &.top.topic-body {
    padding-left: 0;
    padding-right: 0;
  }

  .post-date { color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
  .fa-arrow-up, .fa-arrow-down { margin-left: 5px; }
  .reply:first-of-type .row { border-top: none; }
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/desktop/topic-post.scss:

  .topic-meta-data {
    position: relative;
  }
  .topic-meta-data h5 {
    position: absolute;
    z-index: 1;
    font-size: 0.929em;
    a {
      font-weight: bold;
      color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
    }
  }
  .arrow {color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
}

.post-action {
  .relative-date {
    margin-left: 5px;
  }
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/desktop/topic-post.scss:
    color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
    line-height: 23px;
    font-weight: normal;
    font-size: 1em;
  }

  h4 {
    margin: 1px 0 2px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 0.857em;
    line-height: 15px;
  }

  ul {
    margin: 0;
    list-style: none;
  }

  span.domain {
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/topic-post.scss:
    }
  }

  button.create {
    margin-right: 0;
    color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
    margin-left: 10px;
  }

  .create i {
    margin-right: 5px;
  }

  button {
    font-size: 1.143em;
    padding: 8px 10px;
    vertical-align: top;
    background: transparent;
    border: none;
    margin-left: 3px;
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/desktop/topic-post.scss:
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
    }
    a, button {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    margin-right: 2px;
    display: inline-block;
  }

  a.toggle-likes {
    padding: 8px 0;
    margin-right: -3px;
  }

  span.badge-posts {
    margin-right: 5px;
    transition: all linear 0.15s;

  }

  .actions {
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/desktop/topic-post.scss:
    text-align: right;
    float: right;
    display: inline-block;
    .more-actions {
      display: none;
      overflow: hidden;
    }
  }

  .show-replies {
    margin-left: -10px;
    font-size: inherit;
    span.badge-posts {color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
    &:hover {
      background: dark-light-diff($primary, $secondary, 90%, -65%);
      span.badge-posts {color: $primary;}
    }
    i {
      margin-left: 5
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/desktop/topic-post.scss:

.post-cloak {
  padding: 0;

  &:first-of-type {
    border-top: none;
  }

  .reply-to-tab {
    z-index: 400;
    font-size: 0.929em;
    float: right;
    margin: 1px 25px 0 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  .gutter {
    .reply-new {
      .discourse-no-touch & {
        opacity:0;
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/desktop/topic-post.scss:
    .number, i {
      color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
      font-size: 130%;
    }
    .avatar  a {
      float: left;
    }
  }
  .avatars,
  .links,
  .information {
    padding: 7px 10px 15px 10px;
    color: $primary;
  }

  .participants { // PMs //
    .user {float: left; margin: 7px 20px 7px 0;}
  }

  .topic-links {
---
[Medium] chunk lines 401-420 in app/assets/stylesheets/desktop/topic-post.scss:
    .badge-notification {
      margin: 1px 5px 5px 0;
    }
  }

  td {
    vertical-align: top;
    padding:1px;
  }

  .buttons {
    float: right;
    .btn {
      border: 0;
      padding: 0 23px;
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
      background: dark-light-diff($primary, $secondary, 97%, -75%);
      border-left: 1px solid dark-light-diff($primary, $secondary, 90%, -65%);
      border-top: 1px solid dark-ligh
---
[Medium] chunk lines 881-900 in app/assets/stylesheets/desktop/topic-post.scss:
  }
  article.boxed {
    position: relative;

    .select-posts {
      position: absolute;
      left: 100%;
      z-index: 490;
      top: 8px;
      width: 800px;
      height: 100px;
      background-color: $secondary;

      button {
        margin-left: 8px;
        background-color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
        border: 1px solid dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary,
---
[Medium] chunk lines 341-360 in app/assets/stylesheets/desktop/topic-post.scss:
    font-size: 0.714em;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  .avatars {
    > div {
      float: left;
      position: relative;
      margin: 3px 0;
    }
    .post-count {
      position: absolute;
      right: 3px;
      border-radius: 100px;
      padding: 4px 5px 2px 5px;
      text-align: center;
      font-weight: normal;
      font-size: 11px;
      line-height: 1;
    }
---
[Medium] chunk lines 941-960 in app/assets/stylesheets/desktop/topic-post.scss:
   a {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
 }

}

.who-liked {
  margin-top: 20px;
  margin-bottom: 0px;
  width: 100%;
  text-align: right;
}

span.highlighted {
  background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
}

.username.new-user a {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

---
[Medium] chunk lines 61-80 in app/assets/stylesheets/desktop/topic.scss:
  color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  float: left;
  margin: 0 5px 0 0;
}
.private_message #topic-title .private-message-glyph { display: inline; }

a.reply-new {
  margin-top: 3px;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  i {
    margin-right: 3px;
    background: $secondary;
    padding: 1.5px 3px;
    border-radius: 20px;
    transition: all linear .
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/upload.scss:
.upload-selector {
  label {
    display: inline-block;
    padding-left: 10px;
  }
  .radios {
    height: 60px;
    .inputs {
      float: right;
      width: 75%;
      input {
        width: 90%;
        margin: 0 0 5px 0;
      }
      input[type=""file""] {
        font-size: 1em;
        line-height: 18px;
      }
      .description, .hint {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/user.scss:

  .pagedown-editor {
    width: 450px;

    textarea {
      width: 440px;
    }
  }

  .bio-composer #wmd-quote-post {
    display: none;
  }

  .static {
    color: $primary;
    display: inline-block;
  }
  .instructions {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin-left: 160px;
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/desktop/user.scss:
    h2 {
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      margin-top: 10px;

      th {
        text-align: left;
        border-bottom: 3px solid dark-light-diff($primary, $secondary, 90%, -60%);
        padding: 0 0 10px 0;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-weight: normal;
      }

      td {
        padding: 10px 0 10px 0;
        border-bottom: 1px solid dark-light-diff($prima
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/desktop/user.scss:
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
      .title {
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }

  .staff-counters {
    text-align: left;
    background: $primary;
    color: $secondary;
    a {
      color: $secondary;
    }
    > div {
   
---
[Medium] chunk lines 601-620 in app/assets/stylesheets/desktop/user.scss:
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        margin-top: 5px;
        margin-bottom: 10px;
        font-size: 80%;
        line-height: 1.4em;
      }
    }
    clear: both;
    margin-bottom: 10px;
  }
}

.paginated-topics-list {
  .user-content {
    width: 100%;
    margin-top: 0;
  }
}
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/desktop/user.scss:
        display: inline-block;
        margin-left: 10px;
        span {
          color: $primary;
        }
      }
      .time {
        display: inline-block;
        margin-left: 10px;
        float: none;
      }
      // common/base/header.scss
      .fa, .icon {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-size: 1.714em;
      }
    }
    .group-member-info {
      .name {
        display: inline-block;
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/embed.css.scss:
  a {
    color: #5c5c5c
  }
  a.staff {
    background-color: #ffffc2;
  }

  a.new-user {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  }

  span.title {
    font-weight: normal;
    color: #999;
  }
}

img.emoji {
  width: 20px;
  height: 20px;
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/mobile/compose.scss:
    right: -5px;
  }
  .toggle-preview { display:none; }
  .preview-wrapper { display:none; }
  #mobile-uploader { display: none; }
  #draft-status, #file-uploading, .mobile-file-upload {
    float: right;
    margin-right: 8px;
  }
  #file-uploading {
    left: 51%;
    font-size: 0.857em;
    color: scale-color($secondary, $lightness: 50%);
  }
  #draft-status {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  }
  transition: hei
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/compose.scss:
  height: 0;
  background-color: dark-light-diff($primary, $secondary, 90%, -60%);
  bottom: 0;
  font-size: 1em;
  position: fixed;
  .toggler {
    width: 15px;
    right: 1px;
    position: absolute;
    font-size: 1.071em;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    padding: 0 10px 5px 10px;
    &:before {
      font-family: ""FontAwesome"";
      content: ""\f078"";
    }
  }
  a.cancel {
    padding-left: 7px;
    float: l
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/mobile/compose.scss:
        margin: 0;
        padding: 2px;
      }
    }
    #reply-title {
      margin-right: 10px;
      &:disabled {
        background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
      }
    }
    .wmd-input:disabled {
      background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    }
    .wmd-input {
      color: darken($primary, 40%);
    }
    .wmd-input {
      b
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/mobile/login.scss:
// style that apply to the login popup

.btn-social {
  width: 250px;
  font-size: 1.143em;
}

#login-buttons {
  button {
    margin: 0 0 5px 0;
  }
  display: inline-block;
}

#login-form {
  a {
    color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  }
  label { float: left; display: block; }
  textarea, input, select {font-size: 1.143em; clear: left; margin-top: 0; }
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/login.scss:
  }

  tr.instructions {
    label {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  tr.input {
    td.label {
      padding-right: 5px;
    }
  }
}

.create-account {
  .user-field.confirm {
    margin-top: 10px;
    margin-bottom: 10px;
  }
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/mobile/modal.scss:
  margin: -10px 0 10px 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
  font-size: 85%;
}

.flag-message {
  margin-left: 20px;
  width: 95% !important;
}

.edit-category-modal {
  .modal-body {
    position: relative;
    height: 350px;
  }
  &.small .modal-body {
    height: 310px;
  }
  .secure-category-options {
    margin: 10px 0 0 16px;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/mobile/topic-list.scss:
// Base list
// --------------------------------------------------

.topic-list {

  > tbody > tr {
    &.highlighted {
      background-color: scale-color($tertiary, $lightness: 85%);
    }
  }

  th,
  td {
    padding: 7px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  a.title {color: $primary;}

  .badge-notification {
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/mobile/topic-list.scss:
    @include mobile-landscape { width: 270px; }
    @include tablet-landscape { width: 450px; }
    .featured-topic {
      margin: 8px 0;
      a.last-posted-at, a.last-posted-at:visited {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }
  .stats {
    @include not-tablet-landscape { display: none; }
    @include tablet-landscape { min-width: 80px; }
  }
}

.category-list-item {

  border-left: 6px solid;

  h3
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/mobile/topic-list.scss:
    position: relative;
    top: -1px;
      i {color: $secondary;}
  }

  .topic-item-stats {
    margin-top: 8px;
    .category, .num, .last-poster {
      float: left;
    }
    .category a {
      max-width: 160px;
    }
    .num .fa {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  .num.posts {
    font-weight: bold;
---
[Medium] chunk lines 201-220 in app/assets/stylesheets/mobile/topic-list.scss:
    float: left;
  }
  > footer {
    border-top: 0;
    padding: 7px 10px;
    figure {
      float: left;
      margin: 3px 7px 0 0;
      color: dark-light-choose(scale-color($primary, $lightness: 10%), scale-color($secondary, $lightness: 90%));
      font-weight: bold;
      font-size: 0.857em;
    }
    figcaption {
      display: inline;
      font-weight: normal;
    }
    .btn {
      float: right;
      margin-left: 7px;
    }
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/mobile/topic-post.scss:
    color: $primary;
    overflow: auto;
  }

  .participants { // PMs //
    .user {float: left; margin: 0 10px 10px 0;}
  }

  .domain {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  }

  .topic-links {
    .badge-notification {
      margin: 1px 5px 2px 0;
    }
  }

  td {
    vertical-align: top;
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/topic-post.scss:
}

button {
  border: none;
  font-size: 1.214em;
  padding: 8px 10px;
  vertical-align: top;
  background: transparent;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  float: left;
  &.hidden {
    display: none;
  }
  &.admin {
    position: relative;
  }
  &.expand-post {
    margin:10px 0 10px 0;
  }
  &.has-like {color: $love;}
---
[Medium] chunk lines 441-460 in app/assets/stylesheets/mobile/topic-post.scss:
#show-topic-admin {
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  right: 0;
  border-right: 0;
  padding-right: 4px;
  padding-left: 5px;
}

.deleted-user-avatar {
  font-size: 2.571em;
}

span.btn-text {display: none;}

blockquote {
  clear:both;
  /* leave browser defaults for top and bottom here */
  margin-left: 0;
  margin-right: 0;
}
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/mobile/topic-post.scss:
  .names {
    margin: 5px 0 0 5px;
    line-height: 17px;
    padding-left: 60px;
    span {
      display: block;
    }
  }
  .post-info {
    float: right;
    font-size: 0.929em;
    margin: 4px 10px 0 0;
    .edits { margin-right: 5px; }
  }
}

.username.new-user a {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

---
[Medium] chunk lines 241-260 in app/assets/stylesheets/mobile/topic-post.scss:
      }
    }
    a, .number {
      line-height: 20px;
    }
    .number, i {
      color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
      font-size: 110%;
    }

    .avatar + a {
      float: left;
    }
  }
  li.avatars {
    display: none;
  }

  .links, .information, .avatars {
    padding: 7px 10px;
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/mobile/topic-post.scss:
    margin-top: 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    line-height: 23px;
    font-weight: normal;
    font-size: 1em;
  }

  h4 {
    margin: 0 0 3px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 0.857em;
    line-height: 15px;
  }

  .user {
    float: left;
    margin-right: 10px;
  }

---
[Medium] chunk lines 141-160 in app/assets/stylesheets/mobile/topic-post.scss:
}

.post-action .relative-date {
  margin-left: 5px;
}

a.reply-to-tab {
  position: absolute;
  z-index: 400;
  right: 80px;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  span { display: none; }
}

a.star {
  display: inline-block;
  float: left;
  font-size: 1.3em;
}

---
[Medium] chunk lines 21-40 in app/assets/stylesheets/mobile/topic.scss:
    line-height: 1.25em;
    margin: 0;
    a {
      color: $primary;
      vertical-align: middle;
    }
  }
  .title-category-wrapper {
    margin-top:5px;
  }
  .private-message-glyph { display: none; }
}

.private-message-glyph { color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%)); }
.private_message #topic-title .private-message-glyph { display: inline; }


/* both blocks that appear under the standard post control buttons */
.notifica
---
[Medium] chunk lines 1-16 in app/assets/stylesheets/mobile/upload.scss:
.upload-selector {
  input[type=""text""]{
    width: 520px;
  }
  input[type=""file""] {
    font-size: 1em;
    line-height: 18px;
  }
  .description {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }
}

.uploaded-image-preview {
  height: 150px;
}
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/mobile/user.scss:
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }

  .staff-counters {
    text-align: left;
    background: $primary;
    padding: 7px 0;
    display: inline;
    > div {
      margin: 0 10px 0 0;
      display: inline-block;
      padding: 5px 0;
      &:first-of-type {
        padding-left: 10px;
        }
      span {
---
[Medium] chunk lines 561-580 in app/assets/stylesheets/mobile/user.scss:

  .user-field {
    label {
      width: 140px;
      float: left;
      text-align: right;
      font-weight: bold;
    }
    input[type=text] {
      width: 530px;
    }
    .controls {
      label {
        width: auto;
        text-align: left;
        font-weight: normal;
        float: auto;
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/mobile/user.scss:
  input[type=text] {
    @include small-width {
    }
  }

  .bio-composer #wmd-quote-post {
    display: none;
  }

  .static {
    color: $primary;
    display: inline-block;
  }
  .instructions {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin-top: 5px;
    margin-bottom: 10px;
    font-size: 80%;
    line-height: 1.4em;
  }
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/mobile/user.scss:
      }
      .time {
        display: inline-block;
        margin-left: 10px;
        float: none;
      }
      // common/base/header.scss
      .fa, .icon {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-size: 1.714em;
      }
    }
    .group-member-info {
      .name {
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($","lines 581-600 (Medium), lines 381-400 (Medium), lines 521-540 (Medium), lines 501-520 (Medium), lines 1281-1300 (Medium), lines 1321-1340 (Medium), lines 721-740 (Medium), lines 561-580 (Medium), lines 301-302 (Medium), lines 41-60 (Medium), lines 61-80 (Medium), lines 241-260 (Medium), lines 61-80 (Medium), lines 81-100 (Medium), lines 181-200 (Medium), lines 301-320 (Medium), lines 321-340 (Medium), lines 141-160 (Medium), lines 41-55 (Medium), lines 21-40 (Medium), lines 1-7 (Medium), lines 21-40 (Medium), lines 61-77 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 141-160 (Medium), lines 61-80 (Medium), lines 1-20 (Medium), lines 61-80 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 121-133 (Medium), lines 221-240 (Medium), lines 281-300 (Medium), lines 41-60 (Medium), lines 321-340 (Medium), lines 41-60 (Medium), lines 41-56 (Medium), lines 1-20 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), lines 101-120 (Medium), lines 41-60 (Medium), lines 121-140 (Medium), lines 1-20 (Medium), lines 121-140 (Medium), lines 41-60 (Medium), lines 141-160 (Medium), lines 21-40 (Medium), lines 221-240 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 321-340 (Medium), lines 121-140 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 21-40 (Medium), lines 381-400 (Medium), lines 401-420 (Medium), lines 881-900 (Medium), lines 341-360 (Medium), lines 941-960 (Medium), lines 61-80 (Medium), lines 1-20 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 521-540 (Medium), lines 601-620 (Medium), lines 501-520 (Medium), lines 81-100 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 1-20 (Medium), lines 41-60 (Medium), lines 101-120 (Medium), lines 61-80 (Medium), lines 141-160 (Medium), lines 81-100 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 41-60 (Medium), lines 441-460 (Medium), lines 481-500 (Medium), lines 241-260 (Medium), lines 181-200 (Medium), lines 141-160 (Medium), lines 21-40 (Medium), lines 1-16 (Medium), lines 501-520 (Medium), lines 561-580 (Medium), lines 101-120 (Medium), lines 481-500 (Medium)",miss,"CSS changes, no HC entities"
discourse,7,scale-color $lightness must use $secondary for dark themes,In topic-post.css the original code used $lightness: 70% but the replacement uses $lightness: 30% for the light theme. This makes the text significantly darker than intended.,Low,93,0,93,,,"[Medium] chunk lines 581-600 in app/assets/stylesheets/common/admin/admin_base.scss:
    }
  }
  .next, .previous {
    color: #333 !important;
    &.disabled {
      color: #aaa !important;
    }
  }
  .btn.add {
    margin-top: 7px;
  }
  .controls {
    margin-top: 10px;
  }
  .select2-container {
    width: 100%;
  }
  .select2-choices {
    width: 100%;
    border-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/common/admin/admin_base.scss:
      color: $danger;
    }

    .desc {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }

    h3 {
      font-size: 0.929em;
      font-weight: normal;
    }
  }

  .setting.overridden {
    h3 {
      color: scale-color($highlight, $lightness: -50%);
    }
  }

  .setting.overridden.string {
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/common/admin/admin_base.scss:
  .current-badge-actions {
    margin: 10px;
    padding: 10px;
    border-top: 1px solid dark-light-choose(scale-color($primary, $lightness: 80%), scale-color($secondary, $lightness: 20%));
  }

  .buttons {
    float: left;
    width: 200px;
    .saving {
      padding: 5px 0 0 0;
      margin-left: 10px;
      width: 80px;
      color: $primary;
    }
  }
}

.badge-query-preview {
  .grant-count, .sample, .error-header {
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/common/admin/admin_base.scss:
  .current-badge {
    margin: 20px;

    p.help {
      margin: 0;
      color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
      font-size: 0.9em;
    }
  }

  .form-horizontal {
    .delete-link {
      margin-left: 15px;
      margin-top: 5px;
    }
    textarea {
      height: 200px;
    }
  }

---
[Medium] chunk lines 1281-1300 in app/assets/stylesheets/common/admin/admin_base.scss:
    a {
      text-decoration: underline;
    }
    &.value {
      height: 70px;
    }
  }
}

.staff-action-logs-controls {
  margin: 0 0 20px 6px;
  a.filter {
    display: inline-block;
    background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    padding: 3px 10px;
    border-radius: 3px;

    color: $primary;
    &:hover {
      color: $primary;
---
[Medium] chunk lines 1321-1340 in app/assets/stylesheets/common/admin/admin_base.scss:
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
}
.ember-list-item-view {
  position: absolute;
}

.staff-actions, .screened-emails, .screened-urls, .screened-ip-addresses, .permalinks {

  border-bottom: dotted 1px dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));

  .heading-container {
    width: 100%;
    background-color: dark-light-diff($primary, $secondary, 90%, -60%);
  }
  .col.heading {
    font-weight: bold;
    paddin
---
[Medium] chunk lines 721-740 in app/assets/stylesheets/common/admin/admin_base.scss:
    thead th       { border: none; }
    td.hex         { width: 100px; }
    td.actions     { width: 200px; }
    .hex-input     { width: 80px; margin-bottom: 0; }
    .hex           { text-align: center; }
    .description   { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }

    .invalid .hex input {
      background-color: white;
      color: black;
      border-color: $danger;
    }
  }
}


.admin-flags {
  table-layout: fixed;

 
---
[Medium] chunk lines 561-580 in app/assets/stylesheets/common/admin/admin_base.scss:
    padding: 10px 20px;

    p {
      margin: 0;
    }
    .heading {
      color: $danger;
      font-weight: bold;
    }
  }
}

// Groups area
.groups {
  .ac-wrap {
    width: 100% !important;
    border-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    .item {
      width: 190px;
      margin-right: 0 !important;
---
[Medium] chunk lines 301-302 in app/assets/stylesheets/common/base/_topic-list.scss:
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
}
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/base/_topic-list.scss:
  td {
    line-height: 1.25;
    text-align: left;
    vertical-align: middle;

  }
  th {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 1em;
    button i.fa {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));}

  }
  td {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
 
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/_topic-list.scss:
    a.title {
      padding: 15px 0;
    }
  }

  .topic-excerpt {
    font-size: 0.929em;
    margin-top: 8px;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    word-wrap: break-word;
    line-height: 1.4;
    padding-right: 20px;
  }
  .topic-statuses:empty {
    display: none;
  }
  .topic-status {
    margin-right: 4px;
    padding: 0;
    font-size: 1.071em;
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/base/_topic-list.scss:
  h2 {
    float: left;
    margin: 5px 0 10px;

    .top-date-string {
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
      font-weight: normal;
      font-size: 0.7em;
      text-transform: uppercase;
    }
  }

  button {
    outline: 0;
    background: transparent;
    border: 0;
    font-size: 1.429em;
    padding: 5px 10px 0 10px;
  }

---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/discourse.scss:
    }
  }
  button.cancel {
    background: $danger;
    color: $secondary;
    @include hover {
      background: lighten($danger, 10%);
      color: $secondary;
    }
  }

  // the default for table cells in topic list
  // is scale-color($primary, $lightness: 50%)
  // numbers get dimmer as they get colder
  .coldmap-high {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%)) !important;
  }
  .coldmap-med {
    color: dark-light-choos
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/base/discourse.scss:
  .coldmap-low {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)) !important;
  }
  .heatmap-high {
    color: #fe7a15 !important;
  }
  .heatmap-med {
    color: #cf7721 !important;
  }
  .heatmap-low {
    color: #9b764f !important;
  }

  #loading-message {
    position: absolute;
    font-size: 2.143em;
    text-align: center;
    top: 120px;
    left: 500px;
    color: $primary;
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/base/header.scss:
      button {margin-left: 5px;}
  }

  .heading a:hover  {
    background-color: dark-light-diff($highlight, $secondary, 50%, -70%);
  }

  .selected {
    background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
  }


  // Notifications
  &#notifications-dropdown {
    .fa { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
    .icon { color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary,
---
[Medium] chunk lines 301-320 in app/assets/stylesheets/common/base/header.scss:
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      background-color: transparent;
      vertical-align: top;
      padding: 5px 5px 2px 5px;
    }
  }

  &#user-dropdown {
    width: 118px;
  }

  .btn {
    padding: 2px 8px;
    margin-bottom: 2px;
    .fa {
      margin-right: 5px;
    }
  }
}

---
[Medium] chunk lines 321-340 in app/assets/stylesheets/common/base/header.scss:
.search-link {
  .badge-category-parent {
    line-height: 0.8em;
  }
  .topic-title {
    margin-right: 6px;
  }

  .topic-statuses {
    float: none;
    display: inline-block;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin: 0;
    .fa {
      margin: 0;
    }
  }
}

.highlight-strong {
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/base/header.scss:
    max-height: 417px;
    top: 100%;
    right: 0;
    z-index: 1100;
    overflow: auto;
    border: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
    padding: 5px;

    box-shadow: 0 2px 2px rgba(0,0,0, .4);

  // note these topic counts only appear for anons in the category hamburger drop down
  b.topics-count {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 11px;
  }

  ul 
---
[Medium] chunk lines 41-55 in app/assets/stylesheets/common/base/login.scss:
      }
    }
    clear: both;
  }
}

// alternate login / create new account buttons should be de-emphasized

button#login-link, button#new-account-link
{
  background: transparent;
  padding-left: 0;
  margin-left: 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/login.scss:
    label {
      width: 92px;
      float: left;
    }
    input[type=text] {
      width: 220px;
      margin-bottom: 0;
    }
    .controls {
      margin-left: 92px;
      margin-bottom: 15px;
      label {
        width: auto;
        text-align: left;
        font-weight: normal;
        float: auto;
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        margin: 0;
---
[Medium] chunk lines 1-7 in app/assets/stylesheets/common/base/notification-options.scss:
.fa.muted {
  color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
}
.fa.tracking, .fa.watching {
  color: $tertiary;
  font-weight: normal;
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/search.scss:
  .search-link {
    .topic-statuses, .topic-title {
      font-size: 1.25em;
    }
  }
  .blurb {
    font-size: 1.0em;
    line-height: 20px;
    word-wrap: break-word;
    clear: both;
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    .date {
      color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    }

    .search-highlight {
      color: dark-light-choose(scale-color(
---
[Medium] chunk lines 61-77 in app/assets/stylesheets/common/base/share_link.scss:
    margin: 5px;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  input[type=text] {
    font-size: 1.143em;
    margin-bottom: 10px;
  }
}

.discourse-no-touch #share-link .share-for-touch {
  display: none;
}

.discourse-touch #share-link input[type=text] {
  display: none;
}
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/topic-post.scss:
   color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
 }
  .new_user a, .user-title, .user-title a {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
 }
}

// global styles for the cooked HTML content in posts (and preview)
.cooked, .wmd-preview {
  word-wrap: break-word;
  h1, h2, h3, h4, h5, h6 { margin: 30px 0 10px; }
  h1 { line-height: 1em; } /* normalize.css sets h1 font 
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/base/topic-post.scss:
  sup sup {
    top: 0;
  }
}
// we use aside to hold expandable quotes (versus, say, static blockquotes)
aside.quote {
  margin-top: 1em;
  margin-bottom: 1em;

  .badge-wrapper { margin-left: 5px; }

  .title {
    @include post-aside;

    color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    // IE will screw up the blockquote underneath if bottom padding is 0px
    padding: 12px 12px 1px 12px;
    // blockquote is underneath this and 
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/base/topic-post.scss:
// this ensures consistent top margin on topic posts even if the first line of a post
// is a top-margin-less element like a list or image.
.topic-body .regular {
  margin-top: 15px;
}

.post-info {
  &.wiki, &.via-email {
    margin-right: 5px;
    i.fa {
      font-size: 1em;
    }
  }
  &.wiki {
    cursor: pointer;
    color: $wiki;
  }
  &.via-email {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  }
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/topic-post.scss:
    @include unselectable;
  }

  // blockquote is docked within aside for content
  blockquote {
    margin-top: 0;
  }
}

.quote-controls, .quote-controls .back:before, .quote-controls .quote-other-topic:before {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

.cooked .highlight {
  background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
  padding: 2px;
  margin: -2px;
}

.post-action {
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/common/base/topic-post.scss:
.names {
 float: left;
 .username {
   font-weight: bold;
 }
 span {
   font-size: 0.929em;
   padding-right: 8px;
   display: inline-block;
   max-width: 280px;
   white-space: nowrap;
   overflow: hidden;
   text-overflow: ellipsis;
   a {
     color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
   }
 }
 .fa {
   font-size: 11px;
   margin-left: 3px;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/user-badges.scss:
      font-size: 0.8em;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }
}

/* Badge listing in /badges. */
table.badges-listing {
  margin: 20px 0;
  border-bottom: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
  width: 90%;

  .user-badge {
    font-size: $base-font-size;
  }

  tr.title td {
    padding-top: 30px;
    padding-bottom: 15px;
  }
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/base/user-badges.scss:

  tr.title {
    border-top: 0px solid;
  }

  td {
    padding: 10px 0px;
  }

  td.granted{
   color: $success;
   font-size: 120%;
  }

  td.grant-count {
    text-align: center;
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
    font-size: 120%;
  }

---
[Medium] chunk lines 101-120 in app/assets/stylesheets/common/base/user.scss:
    float: left;
    padding-right: 4px;
  }

  .user-detail {
    float: left;
    width: 70%;
    padding-left: 5px;
    font-size: 13px;

    .name-line {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .username a {
      font-weight: bold;
      color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    }
---
[Medium] chunk lines 121-133 in app/assets/stylesheets/common/base/user.scss:

    .name {
      margin-left: 5px;
      color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
    }

    .title {
      margin-top: 3px;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }

  }
}
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/components/badges.css.scss:
  }

}




// Notification badge
// --------------------------------------------------

.badge-notification {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  vertical-align: middle;
  color: $secondary;
  font-size: 11px;
  line-height: 1;
  text-align: center;
  background-color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  &[href] {
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/components/badges.css.scss:
  font-weight: normal;
  font-size: 1em;
  line-height: 1;
  &[href] {
    color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
  }
}

// Group badge
// --------------------------------------------------

.badge-group {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  color: $primary;
  text-shadow: 0 1px 0 rgba($primary, 0.1);
  background-color: dark-light-diff($primary, $secondary, 90%, -65%);
  border-color: dark-light-diff($primary, $sec
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/components/buttons.css.scss:

// Default button
// --------------------------------------------------

.btn {
  border: none;
  color: $primary;
  font-weight: normal;
  background: dark-light-diff($primary, $secondary, 90%, -65%);

  &[href] {
    color: $primary;
  }
  &:hover {
    background: dark-light-diff($primary, $secondary, 65%, -75%);
    color: #fff;
  }
  &[disabled] {
    background: dark-light-diff($primary, $secondary, 90%, -60%);
    &:hover { color: dark-light-choose(scale-color($primary, $lightness: 70%),
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/desktop/compose.scss:
    background: $primary;
  }
  }
  .title-input .popup-tip {
    width: 300px;
    left: -8px;
    margin-top: 8px;
  }
  .category-input .popup-tip {
    width: 240px;
    left: 432px;
    top: -19px;
  }
}

.reply-to {
  margin-bottom: 10px;

  i {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/header.scss:
  // Categories

  .btn {
    padding: 2px 8px;
    margin-bottom: 2px;
    .fa {
      margin-right: 5px;
    }
  }
}

.search-link .blurb {
  color: dark-light-choose(scale-color($primary, $lightness: 45%), scale-color($secondary, $lightness: 55%));
  display: block;
  word-wrap: break-word;
  font-size: 11px;
  line-height: 1.3em;
  .search-highlight {
    color: dark-light-choose(scale-color($primary, $lightness: 25%), scale-color($secondary, $lightness: 75%));
  }
---
[Medium] chunk lines 41-56 in app/assets/stylesheets/desktop/login.scss:
    .tip {
      max-width: 340px;
    }
  }

  tr.instructions {
    label {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  .tos-agree {
    margin-bottom: 12px;
  }

}
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/login.scss:
// style that apply to the login popup

#login-buttons {
  button {
    margin: 0 5px 5px 0;
    min-width: 180px;
    &:lang(zh_CN) {
      min-width: 200px;
    }
  }
  margin-top: 10px;
  margin-bottom: 20px;
}

#login-form {
  a {
    color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  }
}

---
[Medium] chunk lines 81-100 in app/assets/stylesheets/desktop/modal.scss:
    }
    .select2-search input {
      width: 378px;
    }
  }
}

.flag-modal {
  max-height: 450px;
}

.custom-message-length {
  margin: -10px 0 10px 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  font-size: 85%;
}

.flag-message {
  margin-left: 20px;
  width: 95% !important;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/desktop/modal.scss:
  .close {margin: 10px;}
}
.close {
  float: right;
  font-size: 1.429em;
  text-decoration: none;
  color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  cursor: pointer;
  &:hover {
    color: $primary;
  }
}

.modal {
  .category-combobox {
    width: 430px;

    .select2-drop {
      left: -9000px;
      width: 428px;
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/desktop/modal.scss:
}

.edit-category-modal {
  .modal-body {
    position: relative;
    height: 420px;
    max-height: 420px;
    padding-bottom: 0;
  }
  .secure-category-options {
    margin: 10px 0 0 16px;
    .badge-list {
      margin: 10px 0;
      li {
        margin: 0 4px 8px 0;
        a {
          color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
          cursor: pointer;
        }
        a:hover {
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/modal.scss:
.modal-footer .btn.right {
  float: right;
}

.modal-footer .btn-group .btn + .btn {
  margin-left: -1px;
}

.modal-footer span.hint {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  float: right;
  line-height: 30px;
}

.modal-header {
  border-bottom: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
  h3 {
    font-size: 1.429em;
    padding: 10px 15px 7px;
  }
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/modal.scss:
          color: dark-light-choose(scale-color($primary, $lightness: 40%), scale-color($secondary, $lightness: 60%));
        }
      }
    }
  }

  .cannot_delete_reason {
    float: right;
    text-align: right;
    max-width: 380px;
    color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
  }
}

.topic-bulk-actions-modal {
  p {
    margin-top: 0;
  }
  &.full .modal-body {
    height: 400px;
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/queued-posts.scss:
.queued-posts {
  .queued-post {
    padding: 1em 0;

    .poster {
      width: 70px;
      float: left;
    }
     .post-info  {
       display: inline-block;
       float: right;
       font-size: 0.929em;
       margin-top: 1px;
       span {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
     }

    .cooked {
      width: $topic-body-width;
      float: left;

---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/topic-list.scss:
  }
  .likes {
    width: 65px;
  }
  .views {
    width: 65px;
  }
  .posts {
    width: 65px;
  }

  .post-actions {
    clear: both;
    width: auto;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    text-align: left;
    font-size: 12px;
    margin-top: 5px;
    .fa {
      margin-right: 2px;
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/topic-list.scss:
  a.title {color: $primary;}
  .fa-bookmark { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  th,
  td {
    padding: 12px 5px;
    &:first-of-type {
      padding-left: 10px;
    }
    &:last-of-type {
      padding-right: 10px;
    }
  }
  th {
    button i.fa {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  }

  > tbody > tr {
    &.highlighted {
        background-c
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/desktop/topic-list.scss:
    }
    a {
      font-size: 11px;
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      margin-right: 3px;
      line-height: 20px;
    }
  }
  .activity {
    width: 60px;
    &:lang(zh_CN) {
      width: 80px;
    }
    span {
      cursor: pointer;
    }
  }
  .age {
    width: 60px;
  }
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/desktop/topic-list.scss:

  .search .btn {
    float: none;
  }


  a.badge-category {
    padding: 3px 12px;
    font-size: 1.143em;
  }

}

// Base list
// --------------------------------------------------

.topic-list {
  margin: 0 0 10px;
  .fa-thumb-tack { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
  .fa-thumb-tack.unpinned { color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/desktop/topic-list.scss:
    /* topic status glyphs */
    i {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)) !important;
      font-size: 0.929em;
    }
    a.last-posted-at, a.last-posted-at:visited {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      font-size: 0.88em;
    }
    .badge {
      font-size: 0.714em;
      top: -1px;
    }
  }
}

.topic-list-bottom {
  margin: 20px 0;
}

---
[Medium] chunk lines 261-280 in app/assets/stylesheets/desktop/topic-post.scss:
  }
  &.bottom {
    .row {
      padding-top: 7px;
    }
  }

  // top means ""in reply to expansion"" above a post
  &.top {
    margin-left: 56px;
    width: 701px;
  }
  &.top.topic-body {
    padding-left: 0;
    padding-right: 0;
  }

  .post-date { color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
  .fa-arrow-up, .fa-arrow-down { margin-left: 5px; }
  .reply:first-of-type .row { border-top: none; }
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/desktop/topic-post.scss:

  .topic-meta-data {
    position: relative;
  }
  .topic-meta-data h5 {
    position: absolute;
    z-index: 1;
    font-size: 0.929em;
    a {
      font-weight: bold;
      color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
    }
  }
  .arrow {color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
}

.post-action {
  .relative-date {
    margin-left: 5px;
  }
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/desktop/topic-post.scss:
    color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
    line-height: 23px;
    font-weight: normal;
    font-size: 1em;
  }

  h4 {
    margin: 1px 0 2px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 0.857em;
    line-height: 15px;
  }

  ul {
    margin: 0;
    list-style: none;
  }

  span.domain {
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/desktop/topic-post.scss:
    }
  }

  button.create {
    margin-right: 0;
    color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
    margin-left: 10px;
  }

  .create i {
    margin-right: 5px;
  }

  button {
    font-size: 1.143em;
    padding: 8px 10px;
    vertical-align: top;
    background: transparent;
    border: none;
    margin-left: 3px;
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/desktop/topic-post.scss:
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
    }
    a, button {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    margin-right: 2px;
    display: inline-block;
  }

  a.toggle-likes {
    padding: 8px 0;
    margin-right: -3px;
  }

  span.badge-posts {
    margin-right: 5px;
    transition: all linear 0.15s;

  }

  .actions {
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/desktop/topic-post.scss:
    text-align: right;
    float: right;
    display: inline-block;
    .more-actions {
      display: none;
      overflow: hidden;
    }
  }

  .show-replies {
    margin-left: -10px;
    font-size: inherit;
    span.badge-posts {color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%)); }
    &:hover {
      background: dark-light-diff($primary, $secondary, 90%, -65%);
      span.badge-posts {color: $primary;}
    }
    i {
      margin-left: 5
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/desktop/topic-post.scss:

.post-cloak {
  padding: 0;

  &:first-of-type {
    border-top: none;
  }

  .reply-to-tab {
    z-index: 400;
    font-size: 0.929em;
    float: right;
    margin: 1px 25px 0 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  .gutter {
    .reply-new {
      .discourse-no-touch & {
        opacity:0;
---
[Medium] chunk lines 381-400 in app/assets/stylesheets/desktop/topic-post.scss:
    .number, i {
      color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
      font-size: 130%;
    }
    .avatar  a {
      float: left;
    }
  }
  .avatars,
  .links,
  .information {
    padding: 7px 10px 15px 10px;
    color: $primary;
  }

  .participants { // PMs //
    .user {float: left; margin: 7px 20px 7px 0;}
  }

  .topic-links {
---
[Medium] chunk lines 401-420 in app/assets/stylesheets/desktop/topic-post.scss:
    .badge-notification {
      margin: 1px 5px 5px 0;
    }
  }

  td {
    vertical-align: top;
    padding:1px;
  }

  .buttons {
    float: right;
    .btn {
      border: 0;
      padding: 0 23px;
      color: dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary, $lightness: 40%));
      background: dark-light-diff($primary, $secondary, 97%, -75%);
      border-left: 1px solid dark-light-diff($primary, $secondary, 90%, -65%);
      border-top: 1px solid dark-ligh
---
[Medium] chunk lines 881-900 in app/assets/stylesheets/desktop/topic-post.scss:
  }
  article.boxed {
    position: relative;

    .select-posts {
      position: absolute;
      left: 100%;
      z-index: 490;
      top: 8px;
      width: 800px;
      height: 100px;
      background-color: $secondary;

      button {
        margin-left: 8px;
        background-color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
        border: 1px solid dark-light-choose(scale-color($primary, $lightness: 60%), scale-color($secondary,
---
[Medium] chunk lines 341-360 in app/assets/stylesheets/desktop/topic-post.scss:
    font-size: 0.714em;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  .avatars {
    > div {
      float: left;
      position: relative;
      margin: 3px 0;
    }
    .post-count {
      position: absolute;
      right: 3px;
      border-radius: 100px;
      padding: 4px 5px 2px 5px;
      text-align: center;
      font-weight: normal;
      font-size: 11px;
      line-height: 1;
    }
---
[Medium] chunk lines 941-960 in app/assets/stylesheets/desktop/topic-post.scss:
   a {color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%)); }
 }

}

.who-liked {
  margin-top: 20px;
  margin-bottom: 0px;
  width: 100%;
  text-align: right;
}

span.highlighted {
  background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
}

.username.new-user a {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

---
[Medium] chunk lines 61-80 in app/assets/stylesheets/desktop/topic.scss:
  color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  float: left;
  margin: 0 5px 0 0;
}
.private_message #topic-title .private-message-glyph { display: inline; }

a.reply-new {
  margin-top: 3px;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  i {
    margin-right: 3px;
    background: $secondary;
    padding: 1.5px 3px;
    border-radius: 20px;
    transition: all linear .
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/desktop/upload.scss:
.upload-selector {
  label {
    display: inline-block;
    padding-left: 10px;
  }
  .radios {
    height: 60px;
    .inputs {
      float: right;
      width: 75%;
      input {
        width: 90%;
        margin: 0 0 5px 0;
      }
      input[type=""file""] {
        font-size: 1em;
        line-height: 18px;
      }
      .description, .hint {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/desktop/user.scss:

  .pagedown-editor {
    width: 450px;

    textarea {
      width: 440px;
    }
  }

  .bio-composer #wmd-quote-post {
    display: none;
  }

  .static {
    color: $primary;
    display: inline-block;
  }
  .instructions {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin-left: 160px;
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/desktop/user.scss:
    h2 {
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      margin-top: 10px;

      th {
        text-align: left;
        border-bottom: 3px solid dark-light-diff($primary, $secondary, 90%, -60%);
        padding: 0 0 10px 0;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-weight: normal;
      }

      td {
        padding: 10px 0 10px 0;
        border-bottom: 1px solid dark-light-diff($prima
---
[Medium] chunk lines 521-540 in app/assets/stylesheets/desktop/user.scss:
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
      .title {
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }

  .staff-counters {
    text-align: left;
    background: $primary;
    color: $secondary;
    a {
      color: $secondary;
    }
    > div {
   
---
[Medium] chunk lines 601-620 in app/assets/stylesheets/desktop/user.scss:
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        margin-top: 5px;
        margin-bottom: 10px;
        font-size: 80%;
        line-height: 1.4em;
      }
    }
    clear: both;
    margin-bottom: 10px;
  }
}

.paginated-topics-list {
  .user-content {
    width: 100%;
    margin-top: 0;
  }
}
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/desktop/user.scss:
        display: inline-block;
        margin-left: 10px;
        span {
          color: $primary;
        }
      }
      .time {
        display: inline-block;
        margin-left: 10px;
        float: none;
      }
      // common/base/header.scss
      .fa, .icon {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-size: 1.714em;
      }
    }
    .group-member-info {
      .name {
        display: inline-block;
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/embed.css.scss:
  a {
    color: #5c5c5c
  }
  a.staff {
    background-color: #ffffc2;
  }

  a.new-user {
    color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
  }

  span.title {
    font-weight: normal;
    color: #999;
  }
}

img.emoji {
  width: 20px;
  height: 20px;
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/mobile/compose.scss:
    right: -5px;
  }
  .toggle-preview { display:none; }
  .preview-wrapper { display:none; }
  #mobile-uploader { display: none; }
  #draft-status, #file-uploading, .mobile-file-upload {
    float: right;
    margin-right: 8px;
  }
  #file-uploading {
    left: 51%;
    font-size: 0.857em;
    color: scale-color($secondary, $lightness: 50%);
  }
  #draft-status {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  }
  transition: hei
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/compose.scss:
  height: 0;
  background-color: dark-light-diff($primary, $secondary, 90%, -60%);
  bottom: 0;
  font-size: 1em;
  position: fixed;
  .toggler {
    width: 15px;
    right: 1px;
    position: absolute;
    font-size: 1.071em;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    padding: 0 10px 5px 10px;
    &:before {
      font-family: ""FontAwesome"";
      content: ""\f078"";
    }
  }
  a.cancel {
    padding-left: 7px;
    float: l
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/mobile/compose.scss:
        margin: 0;
        padding: 2px;
      }
    }
    #reply-title {
      margin-right: 10px;
      &:disabled {
        background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
      }
    }
    .wmd-input:disabled {
      background-color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
    }
    .wmd-input {
      color: darken($primary, 40%);
    }
    .wmd-input {
      b
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/mobile/login.scss:
// style that apply to the login popup

.btn-social {
  width: 250px;
  font-size: 1.143em;
}

#login-buttons {
  button {
    margin: 0 0 5px 0;
  }
  display: inline-block;
}

#login-form {
  a {
    color: dark-light-choose(scale-color($primary, $lightness: 35%), scale-color($secondary, $lightness: 65%));
  }
  label { float: left; display: block; }
  textarea, input, select {font-size: 1.143em; clear: left; margin-top: 0; }
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/login.scss:
  }

  tr.instructions {
    label {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  tr.input {
    td.label {
      padding-right: 5px;
    }
  }
}

.create-account {
  .user-field.confirm {
    margin-top: 10px;
    margin-bottom: 10px;
  }
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/mobile/modal.scss:
  margin: -10px 0 10px 20px;
  color: dark-light-choose(scale-color($primary, $lightness: 30%), scale-color($secondary, $lightness: 70%));
  font-size: 85%;
}

.flag-message {
  margin-left: 20px;
  width: 95% !important;
}

.edit-category-modal {
  .modal-body {
    position: relative;
    height: 350px;
  }
  &.small .modal-body {
    height: 310px;
  }
  .secure-category-options {
    margin: 10px 0 0 16px;
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/mobile/topic-list.scss:
// Base list
// --------------------------------------------------

.topic-list {

  > tbody > tr {
    &.highlighted {
      background-color: scale-color($tertiary, $lightness: 85%);
    }
  }

  th,
  td {
    padding: 7px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }

  a.title {color: $primary;}

  .badge-notification {
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/mobile/topic-list.scss:
    @include mobile-landscape { width: 270px; }
    @include tablet-landscape { width: 450px; }
    .featured-topic {
      margin: 8px 0;
      a.last-posted-at, a.last-posted-at:visited {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }
  .stats {
    @include not-tablet-landscape { display: none; }
    @include tablet-landscape { min-width: 80px; }
  }
}

.category-list-item {

  border-left: 6px solid;

  h3
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/mobile/topic-list.scss:
    position: relative;
    top: -1px;
      i {color: $secondary;}
  }

  .topic-item-stats {
    margin-top: 8px;
    .category, .num, .last-poster {
      float: left;
    }
    .category a {
      max-width: 160px;
    }
    .num .fa {
      color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    }
  }

  .num.posts {
    font-weight: bold;
---
[Medium] chunk lines 201-220 in app/assets/stylesheets/mobile/topic-list.scss:
    float: left;
  }
  > footer {
    border-top: 0;
    padding: 7px 10px;
    figure {
      float: left;
      margin: 3px 7px 0 0;
      color: dark-light-choose(scale-color($primary, $lightness: 10%), scale-color($secondary, $lightness: 90%));
      font-weight: bold;
      font-size: 0.857em;
    }
    figcaption {
      display: inline;
      font-weight: normal;
    }
    .btn {
      float: right;
      margin-left: 7px;
    }
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/mobile/topic-post.scss:
    color: $primary;
    overflow: auto;
  }

  .participants { // PMs //
    .user {float: left; margin: 0 10px 10px 0;}
  }

  .domain {
    color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%));
  }

  .topic-links {
    .badge-notification {
      margin: 1px 5px 2px 0;
    }
  }

  td {
    vertical-align: top;
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/mobile/topic-post.scss:
}

button {
  border: none;
  font-size: 1.214em;
  padding: 8px 10px;
  vertical-align: top;
  background: transparent;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  float: left;
  &.hidden {
    display: none;
  }
  &.admin {
    position: relative;
  }
  &.expand-post {
    margin:10px 0 10px 0;
  }
  &.has-like {color: $love;}
---
[Medium] chunk lines 441-460 in app/assets/stylesheets/mobile/topic-post.scss:
#show-topic-admin {
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  right: 0;
  border-right: 0;
  padding-right: 4px;
  padding-left: 5px;
}

.deleted-user-avatar {
  font-size: 2.571em;
}

span.btn-text {display: none;}

blockquote {
  clear:both;
  /* leave browser defaults for top and bottom here */
  margin-left: 0;
  margin-right: 0;
}
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/mobile/topic-post.scss:
  .names {
    margin: 5px 0 0 5px;
    line-height: 17px;
    padding-left: 60px;
    span {
      display: block;
    }
  }
  .post-info {
    float: right;
    font-size: 0.929em;
    margin: 4px 10px 0 0;
    .edits { margin-right: 5px; }
  }
}

.username.new-user a {
  color: dark-light-choose(scale-color($primary, $lightness: 70%), scale-color($secondary, $lightness: 30%));
}

---
[Medium] chunk lines 241-260 in app/assets/stylesheets/mobile/topic-post.scss:
      }
    }
    a, .number {
      line-height: 20px;
    }
    .number, i {
      color: dark-light-choose(scale-color($primary, $lightness: 20%), scale-color($secondary, $lightness: 80%));
      font-size: 110%;
    }

    .avatar + a {
      float: left;
    }
  }
  li.avatars {
    display: none;
  }

  .links, .information, .avatars {
    padding: 7px 10px;
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/mobile/topic-post.scss:
    margin-top: 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    line-height: 23px;
    font-weight: normal;
    font-size: 1em;
  }

  h4 {
    margin: 0 0 3px 0;
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    font-weight: normal;
    font-size: 0.857em;
    line-height: 15px;
  }

  .user {
    float: left;
    margin-right: 10px;
  }

---
[Medium] chunk lines 141-160 in app/assets/stylesheets/mobile/topic-post.scss:
}

.post-action .relative-date {
  margin-left: 5px;
}

a.reply-to-tab {
  position: absolute;
  z-index: 400;
  right: 80px;
  color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  span { display: none; }
}

a.star {
  display: inline-block;
  float: left;
  font-size: 1.3em;
}

---
[Medium] chunk lines 21-40 in app/assets/stylesheets/mobile/topic.scss:
    line-height: 1.25em;
    margin: 0;
    a {
      color: $primary;
      vertical-align: middle;
    }
  }
  .title-category-wrapper {
    margin-top:5px;
  }
  .private-message-glyph { display: none; }
}

.private-message-glyph { color: dark-light-choose(scale-color($primary, $lightness: 75%), scale-color($secondary, $lightness: 25%)); }
.private_message #topic-title .private-message-glyph { display: inline; }


/* both blocks that appear under the standard post control buttons */
.notifica
---
[Medium] chunk lines 1-16 in app/assets/stylesheets/mobile/upload.scss:
.upload-selector {
  input[type=""text""]{
    width: 520px;
  }
  input[type=""file""] {
    font-size: 1em;
    line-height: 18px;
  }
  .description {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
  }
}

.uploaded-image-preview {
  height: 150px;
}
---
[Medium] chunk lines 501-520 in app/assets/stylesheets/mobile/user.scss:
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
      }
    }
  }

  .staff-counters {
    text-align: left;
    background: $primary;
    padding: 7px 0;
    display: inline;
    > div {
      margin: 0 10px 0 0;
      display: inline-block;
      padding: 5px 0;
      &:first-of-type {
        padding-left: 10px;
        }
      span {
---
[Medium] chunk lines 561-580 in app/assets/stylesheets/mobile/user.scss:

  .user-field {
    label {
      width: 140px;
      float: left;
      text-align: right;
      font-weight: bold;
    }
    input[type=text] {
      width: 530px;
    }
    .controls {
      label {
        width: auto;
        text-align: left;
        font-weight: normal;
        float: auto;
      }
      p {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/mobile/user.scss:
  input[type=text] {
    @include small-width {
    }
  }

  .bio-composer #wmd-quote-post {
    display: none;
  }

  .static {
    color: $primary;
    display: inline-block;
  }
  .instructions {
    color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
    margin-top: 5px;
    margin-bottom: 10px;
    font-size: 80%;
    line-height: 1.4em;
  }
---
[Medium] chunk lines 481-500 in app/assets/stylesheets/mobile/user.scss:
      }
      .time {
        display: inline-block;
        margin-left: 10px;
        float: none;
      }
      // common/base/header.scss
      .fa, .icon {
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($secondary, $lightness: 50%));
        font-size: 1.714em;
      }
    }
    .group-member-info {
      .name {
        display: inline-block;
        margin-top: 5px;
        color: dark-light-choose(scale-color($primary, $lightness: 50%), scale-color($","lines 581-600 (Medium), lines 381-400 (Medium), lines 521-540 (Medium), lines 501-520 (Medium), lines 1281-1300 (Medium), lines 1321-1340 (Medium), lines 721-740 (Medium), lines 561-580 (Medium), lines 301-302 (Medium), lines 41-60 (Medium), lines 61-80 (Medium), lines 241-260 (Medium), lines 61-80 (Medium), lines 81-100 (Medium), lines 181-200 (Medium), lines 301-320 (Medium), lines 321-340 (Medium), lines 141-160 (Medium), lines 41-55 (Medium), lines 21-40 (Medium), lines 1-7 (Medium), lines 21-40 (Medium), lines 61-77 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 141-160 (Medium), lines 61-80 (Medium), lines 1-20 (Medium), lines 61-80 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 121-133 (Medium), lines 221-240 (Medium), lines 281-300 (Medium), lines 41-60 (Medium), lines 321-340 (Medium), lines 41-60 (Medium), lines 41-56 (Medium), lines 1-20 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), lines 101-120 (Medium), lines 41-60 (Medium), lines 121-140 (Medium), lines 1-20 (Medium), lines 121-140 (Medium), lines 41-60 (Medium), lines 141-160 (Medium), lines 21-40 (Medium), lines 221-240 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 321-340 (Medium), lines 121-140 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 21-40 (Medium), lines 381-400 (Medium), lines 401-420 (Medium), lines 881-900 (Medium), lines 341-360 (Medium), lines 941-960 (Medium), lines 61-80 (Medium), lines 1-20 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 521-540 (Medium), lines 601-620 (Medium), lines 501-520 (Medium), lines 81-100 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 161-180 (Medium), lines 1-20 (Medium), lines 41-60 (Medium), lines 101-120 (Medium), lines 61-80 (Medium), lines 141-160 (Medium), lines 81-100 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 41-60 (Medium), lines 441-460 (Medium), lines 481-500 (Medium), lines 241-260 (Medium), lines 181-200 (Medium), lines 141-160 (Medium), lines 21-40 (Medium), lines 1-16 (Medium), lines 501-520 (Medium), lines 561-580 (Medium), lines 101-120 (Medium), lines 481-500 (Medium)",miss,"CSS changes, no HC entities"
discourse,6,UX: show complete URL path if website domain is same as instance domain,"The include_website_name method is missing the required ? suffix. Rails serializers expect include_ methods to end with ? for conditional attribute inclusion, a convention followed by other methods in this serializer. Without it, the website_name attribute may not be conditionally included as intended. Additionally, the '.' << website_host string concatenation should be replaced with '.' + website_host or '.#{website_host}' to avoid mutating string literals, which can lead to issues.",Medium,11,0,8,,,"[Medium] class UserSerializer in app/serializers/user_serializer.rb:
class UserSerializer < BasicUserSerializer

  attr_accessor :omit_stats,
                :topic_post_count

  def self.staff_attributes(*attrs)
    attributes(*attrs)
    attrs.each do |attr|
      define_method ""include_#{attr}?"" do
        scope.is_staff?
      end
    end
  end

  def self.private_attributes(*attrs)
    attributes(*attrs)
    attrs.each do |attr|
      define_method ""include_#{attr}?"" do
        can_edit
      end
    end
  end

  # attributes that are hidden for TL0 users wh
---
[Medium] chunk lines 81-88 in app/assets/javascripts/discourse/controllers/user.js.es6:
          if (confirmed) {
            exportUserArchive();
          }
        }
      );
    }
  }
});
---
[Medium] chunk lines 61-80 in app/assets/javascripts/discourse/controllers/user.js.es6:

  actions: {
    adminDelete: function() {
      Discourse.AdminUser.find(this.get('username').toLowerCase()).then(function(user){
        user.destroy({deletePosts: true});
      });
    },

    exportUserArchive: function() {
      bootbox.confirm(
        I18n.t(""admin.export_csv.user_archive_confirm""),
        I18n.t(""no_value""),
        I18n.t(""yes_value""),
        function(confirmed) {
          if (confirmed) {
            exportUserArchive();
          }
        }
      );
    }
---
[Medium] chunk lines 41-60 in app/assets/javascripts/discourse/controllers/user.js.es6:
  }.property('model.can_be_deleted', 'model.can_delete_all_posts'),

  publicUserFields: function() {
    var siteUserFields = this.site.get('user_fields');
    if (!Ember.isEmpty(siteUserFields)) {
      var userFields = this.get('model.user_fields');
      return siteUserFields.filterProperty('show_on_profile', true).sortBy('id').map(function(uf) {
        var val = userFields ? userFields[uf.get('id').toString()] : null;
        if (Ember.isEmpty(val)) {
          return null;
        } else 
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/controllers/user.js.es6:
import { exportUserArchive } from 'discourse/lib/export-csv';
import ObjectController from 'discourse/controllers/object';
import CanCheckEmails from 'discourse/mixins/can-check-emails';

export default ObjectController.extend(CanCheckEmails, {
  indexStream: false,
  pmView: false,
  userActionType: null,
  needs: ['user-notifications', 'user-topics-list'],

  viewingSelf: function() {
    return this.get('content.username') === Discourse.User.currentProp('username');
  }.property('content.user
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/controllers/user.js.es6:
  }.property('model.trust_level'),

  canSeePrivateMessages: Ember.computed.or('viewingSelf', 'currentUser.admin'),
  canSeeNotificationHistory: Em.computed.alias('canSeePrivateMessages'),

  showBadges: function() {
    return Discourse.SiteSettings.enable_badges && (this.get('content.badge_count') > 0);
  }.property('content.badge_count'),

  privateMessageView: function() {
    return (this.get('userActionType') === Discourse.UserAction.TYPES.messages_sent) ||
           (this.get('userAction
---
[Medium] chunk lines 41-60 in app/assets/javascripts/discourse/models/user.js.es6:

  /**
    This user's display name. Returns the name if possible, otherwise returns the
    username.

    @property displayName
    @type {String}
  **/
  displayName: function() {
    if (Discourse.SiteSettings.enable_names && !this.blank('name')) {
      return this.get('name');
    }
    return this.get('username');
  }.property('username', 'name'),

  /**
    This user's profile background(in CSS).

    @property profileBackground
    @type {String}
---
[Medium] chunk lines 61-80 in app/assets/javascripts/discourse/templates/user/user.hbs:
            {{#if model.title}}
              <h3>{{model.title}}</h3>
            {{/if}}
            <h3>
            {{#if model.location}}{{fa-icon ""map-marker""}} {{model.location}}{{/if}}
            {{#if model.website_name}}
              {{fa-icon ""globe""}}
              {{#if linkWebsite}}
                <a href={{model.website}} rel={{unless removeNoFollow 'nofollow'}} target=""_blank"">{{model.website_name}}</a>
              {{else}}
                <span title={{model.website}}>{{mod","UserSerializer (Medium), lines 81-88 (Medium), lines 61-80 (Medium), lines 41-60 (Medium), lines 1-20 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 61-80 (Medium), lines 81-82 (Low), website_name (Low), include_website_name (Low)",miss,"no HC entities, only Medium line-range chunks for serializer"
discourse,5,Optimize header layout performance with flexbox mixins,"Mixing float: left with flexbox causes layout issues. Further this PR removes the float-based right alignment for .d-header .panel, which may cause the login panel in the non-Ember/noscript header (where .panel is nested inside .row and not a flex item) to stack under the title instead of remaining right-aligned.",Low,42,0,36,,,"[Medium] chunk lines 301-312 in app/assets/stylesheets/common/base/topic-post.scss:
      padding-top: 4px;
    }
  }

  button {
    background: transparent;
    border: 0;
    float: right;
  }

  clear: both;
}
---
[Medium] chunk lines 301-301 in app/assets/stylesheets/common/components/badges.css.scss:
}
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/base/header.scss:
        &:active {
          color: $primary;
          background-color: dark-light-diff($primary, $secondary, 90%, -60%);
        }
      }
      .active .icon {
        position: relative;
        color: #7b7b7b;
        background-color: $secondary;
        cursor: default;
        border-top: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
        border-left: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
        border-right: 1px solid dark-light-diff($primary, $s
---
[Medium] chunk lines 301-320 in app/assets/stylesheets/common/base/header.scss:
    .badge-notification {
      color: scale-color($primary, $lightness: 50%);
      background-color: transparent;
      vertical-align: top;
      padding: 5px 5px 2px 5px;
    }
  }

  &#user-dropdown {
    width: 118px;
  }

  .btn {
    padding: 2px 8px;
    margin-bottom: 2px;
    .fa {
      margin-right: 5px;
    }
  }
}
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/common/base/header.scss:
          height: 0;
          content: """";
          border-top: 1px solid $secondary;
        }
        &:hover {
        border-bottom: none;
        }
      }
      [class^=""fa fa-""] {
        width: 32px;
        height: 32px;
        font-size: 1.714em;
        line-height: 32px;
        display: inline-block;
      }
      .notifications {
        position: relative;
      }
      .badge-notification {
        position: absolute;
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/base/header.scss:

    .login-button, button.sign-up-button {
      float: left;
      margin-top: 7px;
      padding: 6px 10px;
      .fa { margin-right: 3px; }
    }

    button.login-button {
      margin-left: 7px;
    }

    .icons {
      float: left;
      text-align: center;
      margin: 0 0 0 5px;
      list-style: none;

      > li {
        float: left;
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/base/header.scss:
      padding: 5px 5px 5px 0;
      a {
        display: block;
        padding: 0 5px;
      }
    }
  }

  // Search

  &#search-dropdown {
    .heading {
      padding: 5px 0 5px 5px;
    .filter {
      padding: 0 5px;
    }
     }
  }

  input[type='text'] {
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/common/base/header.scss:
    list-style: none;
  }

  li:not(.category):not(.heading) {
    font-size: 0.929em;
    line-height: 16px;

      .fa {
        font-size: inherit;
      }

      a {
        display: block;
        padding: 5px;
        transition: all linear .15s;
      }

      &:hover a:not(.badge-notification) {
        background-color: dark-light-diff($highlight, $secondary, 50%, -70%);
        }
---
[Medium] chunk lines 201-220 in app/assets/stylesheets/common/base/header.scss:
        float: left;
        margin-right: 5px;
        padding-top: 2px;
      }
      span { color: $primary; }
      &:hover a { background-color: dark-light-diff($highlight, $secondary, 50%, -70%); }
      a { padding: 4px 0 3px 2px; }
      p {
        margin: 0;
        overflow: hidden;
      }
    }
    .is-warning {
      i.fa-envelope-o {
        &:before {
          content: ""\f0e0"";
        }
        color: $danger;
      }
    }
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/common/base/header.scss:
.d-header {
    width: 100%;
    position: absolute;
    top: 0;
    z-index: 1001;
    background-color: $header_background;
    box-shadow: 0 2px 4px -1px rgba(0,0,0, .25);

    .docked & {
      position: fixed;
      backface-visibility: hidden;  /** do magic for scrolling performance **/
    }

    .contents {
      margin: 8px 0;

      @include flexbox();
      @include align-items(center);
    }

---
[Medium] chunk lines 341-360 in app/assets/stylesheets/common/base/header.scss:
.highlight-strong {
  background-color: dark-light-diff($highlight, $secondary, 40%, -50%);
}

.search-highlight {
  font-weight: bold;
}

.search-context .show-help {
  position: absolute;
  right: 10px;
  top: 0;
}

.search-context {
  min-height: 30px;
  position: relative;
}

.d-dropdown#search-dropdown {
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/common/base/header.scss:
        top: -9px;
        z-index: 1;
        margin-left: 0;
      }
      .unread-notifications {
        right: -4px;
        background-color: scale-color($tertiary, $lightness: 50%);
      }
      .unread-private-messages {
        left: -4px;
      }
    }
    .flagged-posts {
      background: $danger;
    }
}

.d-dropdown {
    display: none;
    position: absolute;
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/common/base/header.scss:

.search-link {
  .badge-category-parent {
    line-height: 0.8em;
  }
  .topic-title {
    margin-right: 6px;
  }

  .topic-statuses {
    float: none;
    display: inline-block;
    color: scale-color($primary, $lightness: 50%);
    margin: 0;
    .fa {
      margin: 0;
    }
  }
}

---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/header.scss:
    .valign-helper {
      display: inline-block;
      height: 100%;
      vertical-align: middle;
    }

    #site-logo {
      max-height: 40px;
    }

    .fa-home {
      font-size: 1.643em;
    }

    .panel {
      position: relative;
      margin-left: auto;

      @include order(3);
    }
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/header.scss:
      }
      .icon {
        display: block;
        padding: 3px;
        color: scale-color($header_primary, $lightness: 50%);
        text-decoration: none;
        cursor: pointer;
        border-top: 1px solid transparent;
        border-left: 1px solid transparent;
        border-right: 1px solid transparent;
        transition: all linear .15s;


        &:hover {
          color: $primary;
          background-color:  dark-light-diff($primary, $secondary, 90%, -60%);
          border-to
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/base/header.scss:
    .read {
      background-color: $secondary;
    }
    .none {
      padding: 5px;
    }
    .spinner {
      width: 20px;
      height: 20px;
      border-width: 2px;
      margin: 0 auto;
    }
    /* as a big ol' click target, don't let text inside be selected */
    @include unselectable;
  }

  // Site map

  &#site-map-dropdown {
    .heading {
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/base/header.scss:

      button {margin-left: 5px;}
  }

  .heading a:hover  {
    background-color: dark-light-diff($highlight, $secondary, 50%, -70%);
  }

  .selected {
    background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
  }


  // Notifications
  &#notifications-dropdown {
    .fa { color: scale-color($primary, $lightness: 50%); }
    .icon { color: scale-color($primary, $lightness: 30%); }
    li {
      background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
      i {
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/base/header.scss:
    background: $secondary;
    max-height: 417px;
    top: 100%;
    right: 0;
    z-index: 1100;
    overflow: auto;
    border: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
    padding: 5px;

    box-shadow: 0 2px 2px rgba(0,0,0, .4);

  // note these topic counts only appear for anons in the category hamburger drop down
  b.topics-count {
    color: scale-color($primary, $lightness: 50%);
    font-weight: normal;
    font-size: 11px;
  }

  ul {
    margin: 0;
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/base/header.scss:
    width: 518px;
    height: 22px;
    margin: 5px;
    padding: 5px;
  }

  .search-context {
    padding: 0 5px;
    label { margin-bottom: 0; }
  }

  .searching {
    position: absolute;
    top: 0;
    right: 0;
    .spinner {
      width: 10px;
      height: 10px;
      border-width: 2px;
      margin: 20px 0 0 0;
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/base/header.scss:
      }
  }
  // I am ghetto using this to display ""Show More"".. be warned
  .no-results {
    padding: 5px;
    text-align: center;
  }
  .filter {
    padding: 0;
    &:hover {background: transparent;}
  }

  // Categories

  .category {
    float: left;
    background-color: transparent;
    width: 45%;
    margin: 5px 5px 0 5px;
    .box {margin-top: 0;}
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/base/topic-post.scss:
    text-transform: uppercase;
    font-weight: bold;
    font-size: 0.9em;
    color: lighten($primary, 50%);

    .custom-message {
      text-transform: none;
      margin: 15px 0px 5px;
      font-weight: normal;
      font-size: 14px;
      p {
        margin: 0;
      }
    }

    .avatar {
      margin-right: 0.8em;
      float: left;
    }

---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/base/topic-post.scss:
}

.small-action {
  @include flexbox();
  @include align-items(center);

  .topic-avatar {
    padding: 5px 0;
    border-top: none;
    float: left;
    i {
      font-size: 35px;
      width: 45px;
      text-align: center;
      color: lighten($primary, 75%);
    }
  }

  .small-action-desc {
    padding: 0 1.5%;
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/topic.scss:

  a.edit-topic i { font-size: 0.8em; }
}

.topic-title-outlet {
  clear: both;
}

.extra-info-wrapper {
  @include order(2);

  line-height: 1.5;
  .badge-wrapper {
    float: left;
  }

}

.has-pending-posts {
  padding: 0.5em;
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/components/badges.css.scss:
     &:before {
       content: ""\a0"";
     }
   }

   span {
     &.badge-category-parent-bg { //subcategory style
       width: 5px;
       margin-right: 0;
       & + .badge-category-bg {
         width: 5px;
       }
     }
   }

 }


  &.box {  //box category style (apply custom widths to the wrapper, not the children)
    line-height: 1.5;
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/common/components/badges.css.scss:
    margin-top: 5px;
    margin-right: 5px;

    span {
      display: block;

      &.badge-category-bg, &.badge-category-parent-bg {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      &.badge-category-parent-bg { //subcategory style
        width: calc(100% - 5px);
        & + .badge-category-bg {
          left: 5px;
          width: calc(100% - 5px);
          & + .badge-category {
            margin-left: 5px;
          }
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/components/badges.css.scss:
    }

  }

}




// Notification badge
// --------------------------------------------------

.badge-notification {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  vertical-align: middle;
  color: $secondary;
  font-size: 11px;
  line-height: 1;
  text-align: center;
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/common/components/badges.css.scss:
        }
      }
    }

    li.bar>.badge-category:not(.home):first-child {
      border-left: 5px solid;
    }

    li.bar>.badge-category {
      background: dark-light-diff($primary, $secondary, 90%, -65%) !important;
      color: $primary !important;
    }

    li.bullet>.badge-category {
      background: dark-light-diff($primary, $secondary, 90%, -65%) !important;
      color: $primary !important;

      .badge-category-bg {
        width: 10px;
        height: 10px;
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/components/badges.css.scss:
  background-color: scale-color($primary, $lightness: 70%);
  &[href] {
  color: $secondary;
  }

  // New posts

  &.new-posts, &.unread-posts {
    background-color: scale-color($tertiary, $lightness: 50%);
    color: $secondary;
    font-weight: normal;
  }

  &.new-topic {
    background-color: transparent;
    color: scale-color($tertiary, $lightness: 20%);
    font-weight: normal;
    font-size: 0.929em;
  }

---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/components/badges.css.scss:
   .badge-category-parent-bg, .badge-category-bg {
     display: inline-block;
     padding: 1px;

     &:before {
       content: ""\a0"";
     }

   }

  }


  &.bullet { //bullet category style
    @include inline-flex();

    @include align-items(baseline);

    margin-right: 10px;

---
[Medium] chunk lines 201-220 in app/assets/stylesheets/common/components/badges.css.scss:
        margin: 5px 0;
        .badge-category {
          max-width: 100px;
        }
      }
      &.bullet {
        margin: 5px;
        .badge-category {
          max-width: 100px;
        }
      }
      &.box {
        margin-top: 0;
        width: 100%;
        line-height: 1;
        span.badge-category {
          padding: 5px;
        }
      }

---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/components/badges.css.scss:

.badge-posts {
  font-weight: normal;
  font-size: 1em;
  line-height: 1;
  &[href] {
    color: scale-color($primary, $lightness: 40%);
  }
}

// Group badge
// --------------------------------------------------

.badge-group {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  color: $primary;
  text-shadow: 0 1px 0 rgba($primary, 0.1);
  background-color: dark-light-diff($primary, $secondary, 90%, -65%);
  border-color: dark-light-diff($primary, $secondary, 90%, -65%);
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/common/components/badges.css.scss:
        }
      }

      &.badge-category {
        position: relative;
        padding: 0 5px;
        margin-top: 2px;
      }
    }
  }

  span.badge-category {
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;

    .d-dropdown & {
      max-width: 90px;
    }
  }
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/components/badges.css.scss:
    span.badge-category {
      color: $primary !important;
      display: inline-block;

      #search-dropdown & {
        margin-top: -2px;
      }

      .extra-info-wrapper & {
        color: $header-primary !important;
      }
   }

   .badge-category-parent-bg, .badge-category-bg {
     width: 10px;
     height: 10px;
     margin-right: 5px;
     display: inline-block;
     line-height: 1;

---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/components/badges.css.scss:

}

// Category badge dropdown
// --------------------------------------------------


.list-controls {
.category-breadcrumb {
  a.badge-category {
      display: inline-block;
      padding: 5px 8px;
      line-height: 20px;
    &.category-dropdown-button {
      margin-left: -4px;
      padding: 5px;
      width: 13px;

      .fa-caret-right {
        margin-left: 2px;
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/components/badges.css.scss:
        display: inline-block;
        margin: 0 2px;
      }
    }


  }

  .category-dropdown-menu {
    .badge-category {
      &.home {
        margin-left: 4px;
        padding-left: 0;
      }
    }
    .cat {
        line-height: 1;
      }
    .badge-wrapper {
      &.bar {
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/components/badges.css.scss:
  &.new-topic::before {
    content: ""â—"";
    margin-right: 2px;
  }

  // Click count

  &.clicks {
    font-weight: normal;
    background-color: dark-light-diff($primary, $secondary, 85%, -65%);
    top: -1px;
    color: dark-light-diff($primary, $secondary, 50%, -45%);
    position: relative;
    margin-left: 2px;
    border: none;
  }
}

// Posts badge
// --------------------------------------------------","lines 301-312 (Medium), lines 301-301 (Medium), lines 81-100 (Medium), lines 301-320 (Medium), lines 101-120 (Medium), lines 41-60 (Medium), lines 241-260 (Medium), lines 161-180 (Medium), lines 201-220 (Medium), lines 1-20 (Medium), lines 341-360 (Medium), lines 121-140 (Medium), lines 321-340 (Medium), lines 21-40 (Medium), lines 61-80 (Medium), lines 221-240 (Medium), lines 181-200 (Medium), lines 141-160 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 281-300 (Medium), lines 261-280 (Medium), lines 21-40 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 221-240 (Medium), lines 161-180 (Medium), lines 241-260 (Medium), lines 41-60 (Medium), lines 201-220 (Medium), lines 281-300 (Medium), lines 121-140 (Medium), lines 61-80 (Medium), lines 141-160 (Medium), lines 181-200 (Medium), lines 261-280 (Medium), lines 361-377 (Low), lines 81-100 (Low), lines 301-313 (Low), lines 301-303 (Low), lines 101-120 (Low), lines 121-131 (Low)",miss,"CSS layout issues, no HC entities"
discourse,5,Optimize header layout performance with flexbox mixins,-ms-align-items never existed in any version of IE/Edge; the correct legacy property is -ms-flex-align.,Low,42,0,36,,,"[Medium] chunk lines 301-312 in app/assets/stylesheets/common/base/topic-post.scss:
      padding-top: 4px;
    }
  }

  button {
    background: transparent;
    border: 0;
    float: right;
  }

  clear: both;
}
---
[Medium] chunk lines 301-301 in app/assets/stylesheets/common/components/badges.css.scss:
}
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/base/header.scss:
        &:active {
          color: $primary;
          background-color: dark-light-diff($primary, $secondary, 90%, -60%);
        }
      }
      .active .icon {
        position: relative;
        color: #7b7b7b;
        background-color: $secondary;
        cursor: default;
        border-top: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
        border-left: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
        border-right: 1px solid dark-light-diff($primary, $s
---
[Medium] chunk lines 301-320 in app/assets/stylesheets/common/base/header.scss:
    .badge-notification {
      color: scale-color($primary, $lightness: 50%);
      background-color: transparent;
      vertical-align: top;
      padding: 5px 5px 2px 5px;
    }
  }

  &#user-dropdown {
    width: 118px;
  }

  .btn {
    padding: 2px 8px;
    margin-bottom: 2px;
    .fa {
      margin-right: 5px;
    }
  }
}
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/common/base/header.scss:
          height: 0;
          content: """";
          border-top: 1px solid $secondary;
        }
        &:hover {
        border-bottom: none;
        }
      }
      [class^=""fa fa-""] {
        width: 32px;
        height: 32px;
        font-size: 1.714em;
        line-height: 32px;
        display: inline-block;
      }
      .notifications {
        position: relative;
      }
      .badge-notification {
        position: absolute;
---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/base/header.scss:

    .login-button, button.sign-up-button {
      float: left;
      margin-top: 7px;
      padding: 6px 10px;
      .fa { margin-right: 3px; }
    }

    button.login-button {
      margin-left: 7px;
    }

    .icons {
      float: left;
      text-align: center;
      margin: 0 0 0 5px;
      list-style: none;

      > li {
        float: left;
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/base/header.scss:
      padding: 5px 5px 5px 0;
      a {
        display: block;
        padding: 0 5px;
      }
    }
  }

  // Search

  &#search-dropdown {
    .heading {
      padding: 5px 0 5px 5px;
    .filter {
      padding: 0 5px;
    }
     }
  }

  input[type='text'] {
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/common/base/header.scss:
    list-style: none;
  }

  li:not(.category):not(.heading) {
    font-size: 0.929em;
    line-height: 16px;

      .fa {
        font-size: inherit;
      }

      a {
        display: block;
        padding: 5px;
        transition: all linear .15s;
      }

      &:hover a:not(.badge-notification) {
        background-color: dark-light-diff($highlight, $secondary, 50%, -70%);
        }
---
[Medium] chunk lines 201-220 in app/assets/stylesheets/common/base/header.scss:
        float: left;
        margin-right: 5px;
        padding-top: 2px;
      }
      span { color: $primary; }
      &:hover a { background-color: dark-light-diff($highlight, $secondary, 50%, -70%); }
      a { padding: 4px 0 3px 2px; }
      p {
        margin: 0;
        overflow: hidden;
      }
    }
    .is-warning {
      i.fa-envelope-o {
        &:before {
          content: ""\f0e0"";
        }
        color: $danger;
      }
    }
---
[Medium] chunk lines 1-20 in app/assets/stylesheets/common/base/header.scss:
.d-header {
    width: 100%;
    position: absolute;
    top: 0;
    z-index: 1001;
    background-color: $header_background;
    box-shadow: 0 2px 4px -1px rgba(0,0,0, .25);

    .docked & {
      position: fixed;
      backface-visibility: hidden;  /** do magic for scrolling performance **/
    }

    .contents {
      margin: 8px 0;

      @include flexbox();
      @include align-items(center);
    }

---
[Medium] chunk lines 341-360 in app/assets/stylesheets/common/base/header.scss:
.highlight-strong {
  background-color: dark-light-diff($highlight, $secondary, 40%, -50%);
}

.search-highlight {
  font-weight: bold;
}

.search-context .show-help {
  position: absolute;
  right: 10px;
  top: 0;
}

.search-context {
  min-height: 30px;
  position: relative;
}

.d-dropdown#search-dropdown {
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/common/base/header.scss:
        top: -9px;
        z-index: 1;
        margin-left: 0;
      }
      .unread-notifications {
        right: -4px;
        background-color: scale-color($tertiary, $lightness: 50%);
      }
      .unread-private-messages {
        left: -4px;
      }
    }
    .flagged-posts {
      background: $danger;
    }
}

.d-dropdown {
    display: none;
    position: absolute;
---
[Medium] chunk lines 321-340 in app/assets/stylesheets/common/base/header.scss:

.search-link {
  .badge-category-parent {
    line-height: 0.8em;
  }
  .topic-title {
    margin-right: 6px;
  }

  .topic-statuses {
    float: none;
    display: inline-block;
    color: scale-color($primary, $lightness: 50%);
    margin: 0;
    .fa {
      margin: 0;
    }
  }
}

---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/header.scss:
    .valign-helper {
      display: inline-block;
      height: 100%;
      vertical-align: middle;
    }

    #site-logo {
      max-height: 40px;
    }

    .fa-home {
      font-size: 1.643em;
    }

    .panel {
      position: relative;
      margin-left: auto;

      @include order(3);
    }
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/base/header.scss:
      }
      .icon {
        display: block;
        padding: 3px;
        color: scale-color($header_primary, $lightness: 50%);
        text-decoration: none;
        cursor: pointer;
        border-top: 1px solid transparent;
        border-left: 1px solid transparent;
        border-right: 1px solid transparent;
        transition: all linear .15s;


        &:hover {
          color: $primary;
          background-color:  dark-light-diff($primary, $secondary, 90%, -60%);
          border-to
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/base/header.scss:
    .read {
      background-color: $secondary;
    }
    .none {
      padding: 5px;
    }
    .spinner {
      width: 20px;
      height: 20px;
      border-width: 2px;
      margin: 0 auto;
    }
    /* as a big ol' click target, don't let text inside be selected */
    @include unselectable;
  }

  // Site map

  &#site-map-dropdown {
    .heading {
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/base/header.scss:

      button {margin-left: 5px;}
  }

  .heading a:hover  {
    background-color: dark-light-diff($highlight, $secondary, 50%, -70%);
  }

  .selected {
    background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
  }


  // Notifications
  &#notifications-dropdown {
    .fa { color: scale-color($primary, $lightness: 50%); }
    .icon { color: scale-color($primary, $lightness: 30%); }
    li {
      background-color: dark-light-diff($tertiary, $secondary, 85%, -65%);
      i {
---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/base/header.scss:
    background: $secondary;
    max-height: 417px;
    top: 100%;
    right: 0;
    z-index: 1100;
    overflow: auto;
    border: 1px solid dark-light-diff($primary, $secondary, 90%, -60%);
    padding: 5px;

    box-shadow: 0 2px 2px rgba(0,0,0, .4);

  // note these topic counts only appear for anons in the category hamburger drop down
  b.topics-count {
    color: scale-color($primary, $lightness: 50%);
    font-weight: normal;
    font-size: 11px;
  }

  ul {
    margin: 0;
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/base/header.scss:
    width: 518px;
    height: 22px;
    margin: 5px;
    padding: 5px;
  }

  .search-context {
    padding: 0 5px;
    label { margin-bottom: 0; }
  }

  .searching {
    position: absolute;
    top: 0;
    right: 0;
    .spinner {
      width: 10px;
      height: 10px;
      border-width: 2px;
      margin: 20px 0 0 0;
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/base/header.scss:
      }
  }
  // I am ghetto using this to display ""Show More"".. be warned
  .no-results {
    padding: 5px;
    text-align: center;
  }
  .filter {
    padding: 0;
    &:hover {background: transparent;}
  }

  // Categories

  .category {
    float: left;
    background-color: transparent;
    width: 45%;
    margin: 5px 5px 0 5px;
    .box {margin-top: 0;}
---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/base/topic-post.scss:
    text-transform: uppercase;
    font-weight: bold;
    font-size: 0.9em;
    color: lighten($primary, 50%);

    .custom-message {
      text-transform: none;
      margin: 15px 0px 5px;
      font-weight: normal;
      font-size: 14px;
      p {
        margin: 0;
      }
    }

    .avatar {
      margin-right: 0.8em;
      float: left;
    }

---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/base/topic-post.scss:
}

.small-action {
  @include flexbox();
  @include align-items(center);

  .topic-avatar {
    padding: 5px 0;
    border-top: none;
    float: left;
    i {
      font-size: 35px;
      width: 45px;
      text-align: center;
      color: lighten($primary, 75%);
    }
  }

  .small-action-desc {
    padding: 0 1.5%;
---
[Medium] chunk lines 21-40 in app/assets/stylesheets/common/base/topic.scss:

  a.edit-topic i { font-size: 0.8em; }
}

.topic-title-outlet {
  clear: both;
}

.extra-info-wrapper {
  @include order(2);

  line-height: 1.5;
  .badge-wrapper {
    float: left;
  }

}

.has-pending-posts {
  padding: 0.5em;
---
[Medium] chunk lines 81-100 in app/assets/stylesheets/common/components/badges.css.scss:
     &:before {
       content: ""\a0"";
     }
   }

   span {
     &.badge-category-parent-bg { //subcategory style
       width: 5px;
       margin-right: 0;
       & + .badge-category-bg {
         width: 5px;
       }
     }
   }

 }


  &.box {  //box category style (apply custom widths to the wrapper, not the children)
    line-height: 1.5;
---
[Medium] chunk lines 101-120 in app/assets/stylesheets/common/components/badges.css.scss:
    margin-top: 5px;
    margin-right: 5px;

    span {
      display: block;

      &.badge-category-bg, &.badge-category-parent-bg {
        position: absolute;
        width: 100%;
        height: 100%;
      }

      &.badge-category-parent-bg { //subcategory style
        width: calc(100% - 5px);
        & + .badge-category-bg {
          left: 5px;
          width: calc(100% - 5px);
          & + .badge-category {
            margin-left: 5px;
          }
---
[Medium] chunk lines 221-240 in app/assets/stylesheets/common/components/badges.css.scss:
    }

  }

}




// Notification badge
// --------------------------------------------------

.badge-notification {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  vertical-align: middle;
  color: $secondary;
  font-size: 11px;
  line-height: 1;
  text-align: center;
---
[Medium] chunk lines 161-180 in app/assets/stylesheets/common/components/badges.css.scss:
        }
      }
    }

    li.bar>.badge-category:not(.home):first-child {
      border-left: 5px solid;
    }

    li.bar>.badge-category {
      background: dark-light-diff($primary, $secondary, 90%, -65%) !important;
      color: $primary !important;
    }

    li.bullet>.badge-category {
      background: dark-light-diff($primary, $secondary, 90%, -65%) !important;
      color: $primary !important;

      .badge-category-bg {
        width: 10px;
        height: 10px;
---
[Medium] chunk lines 241-260 in app/assets/stylesheets/common/components/badges.css.scss:
  background-color: scale-color($primary, $lightness: 70%);
  &[href] {
  color: $secondary;
  }

  // New posts

  &.new-posts, &.unread-posts {
    background-color: scale-color($tertiary, $lightness: 50%);
    color: $secondary;
    font-weight: normal;
  }

  &.new-topic {
    background-color: transparent;
    color: scale-color($tertiary, $lightness: 20%);
    font-weight: normal;
    font-size: 0.929em;
  }

---
[Medium] chunk lines 41-60 in app/assets/stylesheets/common/components/badges.css.scss:
   .badge-category-parent-bg, .badge-category-bg {
     display: inline-block;
     padding: 1px;

     &:before {
       content: ""\a0"";
     }

   }

  }


  &.bullet { //bullet category style
    @include inline-flex();

    @include align-items(baseline);

    margin-right: 10px;

---
[Medium] chunk lines 201-220 in app/assets/stylesheets/common/components/badges.css.scss:
        margin: 5px 0;
        .badge-category {
          max-width: 100px;
        }
      }
      &.bullet {
        margin: 5px;
        .badge-category {
          max-width: 100px;
        }
      }
      &.box {
        margin-top: 0;
        width: 100%;
        line-height: 1;
        span.badge-category {
          padding: 5px;
        }
      }

---
[Medium] chunk lines 281-300 in app/assets/stylesheets/common/components/badges.css.scss:

.badge-posts {
  font-weight: normal;
  font-size: 1em;
  line-height: 1;
  &[href] {
    color: scale-color($primary, $lightness: 40%);
  }
}

// Group badge
// --------------------------------------------------

.badge-group {
  @extend %badge;
  padding: 4px 5px 2px 5px;
  color: $primary;
  text-shadow: 0 1px 0 rgba($primary, 0.1);
  background-color: dark-light-diff($primary, $secondary, 90%, -65%);
  border-color: dark-light-diff($primary, $secondary, 90%, -65%);
---
[Medium] chunk lines 121-140 in app/assets/stylesheets/common/components/badges.css.scss:
        }
      }

      &.badge-category {
        position: relative;
        padding: 0 5px;
        margin-top: 2px;
      }
    }
  }

  span.badge-category {
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;

    .d-dropdown & {
      max-width: 90px;
    }
  }
---
[Medium] chunk lines 61-80 in app/assets/stylesheets/common/components/badges.css.scss:
    span.badge-category {
      color: $primary !important;
      display: inline-block;

      #search-dropdown & {
        margin-top: -2px;
      }

      .extra-info-wrapper & {
        color: $header-primary !important;
      }
   }

   .badge-category-parent-bg, .badge-category-bg {
     width: 10px;
     height: 10px;
     margin-right: 5px;
     display: inline-block;
     line-height: 1;

---
[Medium] chunk lines 141-160 in app/assets/stylesheets/common/components/badges.css.scss:

}

// Category badge dropdown
// --------------------------------------------------


.list-controls {
.category-breadcrumb {
  a.badge-category {
      display: inline-block;
      padding: 5px 8px;
      line-height: 20px;
    &.category-dropdown-button {
      margin-left: -4px;
      padding: 5px;
      width: 13px;

      .fa-caret-right {
        margin-left: 2px;
---
[Medium] chunk lines 181-200 in app/assets/stylesheets/common/components/badges.css.scss:
        display: inline-block;
        margin: 0 2px;
      }
    }


  }

  .category-dropdown-menu {
    .badge-category {
      &.home {
        margin-left: 4px;
        padding-left: 0;
      }
    }
    .cat {
        line-height: 1;
      }
    .badge-wrapper {
      &.bar {
---
[Medium] chunk lines 261-280 in app/assets/stylesheets/common/components/badges.css.scss:
  &.new-topic::before {
    content: ""â—"";
    margin-right: 2px;
  }

  // Click count

  &.clicks {
    font-weight: normal;
    background-color: dark-light-diff($primary, $secondary, 85%, -65%);
    top: -1px;
    color: dark-light-diff($primary, $secondary, 50%, -45%);
    position: relative;
    margin-left: 2px;
    border: none;
  }
}

// Posts badge
// --------------------------------------------------","lines 301-312 (Medium), lines 301-301 (Medium), lines 81-100 (Medium), lines 301-320 (Medium), lines 101-120 (Medium), lines 41-60 (Medium), lines 241-260 (Medium), lines 161-180 (Medium), lines 201-220 (Medium), lines 1-20 (Medium), lines 341-360 (Medium), lines 121-140 (Medium), lines 321-340 (Medium), lines 21-40 (Medium), lines 61-80 (Medium), lines 221-240 (Medium), lines 181-200 (Medium), lines 141-160 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 281-300 (Medium), lines 261-280 (Medium), lines 21-40 (Medium), lines 81-100 (Medium), lines 101-120 (Medium), lines 221-240 (Medium), lines 161-180 (Medium), lines 241-260 (Medium), lines 41-60 (Medium), lines 201-220 (Medium), lines 281-300 (Medium), lines 121-140 (Medium), lines 61-80 (Medium), lines 141-160 (Medium), lines 181-200 (Medium), lines 261-280 (Medium), lines 361-377 (Low), lines 81-100 (Low), lines 301-313 (Low), lines 301-303 (Low), lines 101-120 (Low), lines 121-131 (Low)",miss,"CSS vendor prefix issue, no HC entities"
discourse,4,Enhance embed URL handling and validation system,SSRF vulnerability using open(url) without validation,Critical,78,11,36,"class::PostCreator (lib/post_creator.rb) [Critical, score=1.00] | class::PostRevisor (lib/post_revisor.rb) [Critical, score=1.00] | class::Post (app/models/post.rb) [Critical, score=0.94] | class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.90] | method::cook_methods (app/models/post.rb) [Critical, score=0.87] | method::import_remote (app/models/topic_embed.rb) [High, score=0.64] | method::cook (app/models/post.rb) [High, score=0.60] | method::setup_post (lib/post_creator.rb) [High, score=0.60] | method::update_post (lib/post_revisor.rb) [High, score=0.60] | method::topic_id_for_embed (app/models/topic_embed.rb) [High, score=0.58] | method::absolutize_urls (app/models/topic_embed.rb) [High, score=0.54]","[Critical] class PostCreator in lib/post_creator.rb:
class PostCreator

  attr_reader :errors, :opts

  # Acceptable options:
  #
  #   raw                     - raw text of post
  #   image_sizes             - We can pass a list of the sizes of images in the post as a shortcut.
  #   invalidate_oneboxes     - Whether to force invalidation of oneboxes in this post
  #   acting_user             - The user performing the action might be different than the user
  #                             who is the post ""author."" For example when copying posts to a new
  #                             topic.
  #   created_at              - Post creation time (optional)
  #   auto_track              - Automatically track this topic if needed (default true)
  #
  #   When replying to a topic:
  #     topic_id              - topic we're replying to
  #     rep
---
[Critical] class PostRevisor in lib/post_revisor.rb:
class PostRevisor

  attr_reader :category_changed

  def initialize(post)
    @post = post
  end

  def revise!(user, new_raw, opts = {})
    @user, @new_raw, @opts = user, new_raw, opts
    return false if not should_revise?
    @post.acting_user = @user
    revise_post
    update_category_description
    post_process_post
    update_topic_word_counts
    @post.advance_draft_sequence

    true
  end

  private

  def should_revise?
    @post.raw != @new_raw
  end

  def revise_post
    if should_create_new_version?
      revise_and_create_new_version
    else
      update_post
    end
  end

  def get_revised_at
    @opts[:revised_at] || Time.now
  end

  def should_create_new_version?
    @post.last_editor_id != @user.id ||
    get_revised_at - @post.last_version_at > SiteSetting.ninja_
---
[Critical] class Post in app/models/post.rb:
class Post < ActiveRecord::Base
  include RateLimiter::OnCreateRecord
  include Trashable

  rate_limit
  rate_limit :limit_posts_per_day

  belongs_to :user
  belongs_to :topic, counter_cache: :posts_count
  belongs_to :reply_to_user, class_name: ""User""

  has_many :post_replies
  has_many :replies, through: :post_replies
  has_many :post_actions
  has_many :topic_links

  has_many :post_uploads
  has_many :uploads, through: :post_uploads

  has_one :post_search_data

  has_many :post_details

  has_many :post_revisions
  has_many :revisions, foreign_key: :post_id, class_name: 'PostRevision'

  validates_with ::Validators::PostValidator

  # We can pass several creating options to a post via attributes
  attr_accessor :image_sizes, :quoted_post_numbers, :no_bump, :invalidate_oneboxes, :co
---
[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_presence_of :content_sha1

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    contents << ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""

    embed = TopicEmbed.where(embed_url: url).first
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transaction do
        creator = PostCreator.new(user, title: title, raw: absolutize_urls(url, contents), skip_validations: true, cook_method: Post.cook_methods[:raw_html])
      
---
[Critical] method cook_methods in app/models/post.rb:
def self.cook_methods
    @cook_methods ||= Enum.new(:regular, :raw_html)
  end
---
[High] method import_remote in app/models/topic_embed.rb:
def self.import_remote(user, url, opts=nil)
    require 'ruby-readability'

    opts = opts || {}
    doc = Readability::Document.new(open(url).read,
                                        tags: %w[div p code pre h1 h2 h3 b em i strong a img],
                                        attributes: %w[href src])

    TopicEmbed.import(user, url, opts[:title] || doc.title, doc.content)
  end
---
[High] method cook in app/models/post.rb:
def cook(*args)
    # For some posts, for example those imported via RSS, we support raw HTML. In that
    # case we can skip the rendering pipeline.
    return raw if cook_method == Post.cook_methods[:raw_html]

    # Default is to cook posts
    Plugin::Filter.apply(:after_post_cook, self, post_analyzer.cook(*args))
  end
---
[High] method setup_post in lib/post_creator.rb:
def setup_post
    post = @topic.posts.new(raw: @opts[:raw],
                            user: @user,
                            reply_to_post_number: @opts[:reply_to_post_number])

    # Attributes we pass through to the post instance if present
    [:post_type, :no_bump, :cooking_options, :image_sizes, :acting_user, :invalidate_oneboxes].each do |a|
      post.send(""#{a}="", @opts[a]) if @opts[a].present?
    end

    post.cook_method = @opts[:cook_method] if @opts[:cook_method].present?
    post.extract_quoted_post_numbers
    post.created_at = Time.zone.parse(@opts[:created_at].to_s) if @opts[:created_at].present?
    @post = post
  end
---
[High] method update_post in lib/post_revisor.rb:
def update_post
    @post.raw = @new_raw
    @post.word_count = @new_raw.scan(/\w+/).size
    @post.last_editor_id = @user.id
    @post.edit_reason = @opts[:edit_reason] if @opts[:edit_reason]

    if @post.hidden && @post.hidden_reason_id == Post.hidden_reasons[:flag_threshold_reached]
      @post.hidden = false
      @post.hidden_reason_id = nil
      @post.topic.update_attributes(visible: true)

      PostAction.clear_flags!(@post, -1)
    end

    @post.extract_quoted_post_numbers
    @post.save(validate: !@opts[:skip_validations])

    @post.save_reply_relationships
  end
---
[High] method topic_id_for_embed in app/models/topic_embed.rb:
def self.topic_id_for_embed(embed_url)
    TopicEmbed.where(embed_url: embed_url).pluck(:topic_id).first
  end
---
[High] method absolutize_urls in app/models/topic_embed.rb:
def self.absolutize_urls(url, contents)
    uri = URI(url)
    prefix = ""#{uri.scheme}://#{uri.host}""
    prefix << "":#{uri.port}"" if uri.port != 80 && uri.port != 443

    fragment = Nokogiri::HTML.fragment(contents)
    fragment.css('a').each do |a|
      href = a['href']
      if href.present? && href.start_with?('/')
        a['href'] = ""#{prefix}/#{href.sub(/^\/+/, '')}""
      end
    end
    fragment.css('img').each do |a|
      src = a['src']
      if src.present? && src.start_with?('/')
        a['src'] = ""#{prefix}/#{src.sub(/^\/+/, '')}""
      end
    end

    fragment.to_html
  end","[Medium] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      SiteSetting.embeddable_host != URI(@embed_url).host
    rescue URI::InvalidURIError
      # An invalid URI is an invalid host
      true
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return fa
---
[Medium] method perform_retrieve in lib/topic_retriever.rb:
def perform_retrieve
      # It's possible another process or job found the embed already. So if that happened bail out.
      return if TopicEmbed.where(embed_url: @embed_url).exists?

      # First check RSS if that is enabled
      if SiteSetting.feed_polling_enabled?
        Jobs::PollFeed.new.execute({})
        return if TopicEmbed.where(embed_url: @embed_url).exists?
      end

      fetch_http
    end
---
[Medium] method execute in app/jobs/regular/retrieve_topic.rb:
def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end
---
[Medium] method change in db/migrate/20131223171005_create_top_topics.rb:
def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{period}_#{sort}_count"".to_sym, order: 'desc'
      en
---
[Medium] method initialize in lib/topic_retriever.rb:
def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end
---
[Medium] method retrieve in lib/topic_retriever.rb:
def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end
---
[Medium] module Jobs in app/jobs/regular/retrieve_topic.rb:
module Jobs

  # Asynchronously retrieve a topic from an embedded site
  class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end

end
---
[Medium] class RetrieveTopic in app/jobs/regular/retrieve_topic.rb:
class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end
---
[Medium] method change in db/migrate/20131217174004_create_topic_embeds.rb:
def change
    create_table :topic_embeds, force: true do |t|
      t.integer :topic_id, null: false
      t.integer :post_id, null: false
      t.string :embed_url, null: false
      t.string :content_sha1, null: false, limit: 40
      t.timestamps
    end

    add_index :topic_embeds, :embed_url, unique: true
  end
---
[Medium] method change in db/migrate/20131219203905_add_cook_method_to_posts.rb:
def change
    add_column :posts, :cook_method, :integer, default: 1, null: false
  end
---
[Medium] chunk lines 481-486 in Gemfile_rails4.lock:
  therubyracer-discourse
  thin
  timecop
  uglifier
  unf
  unicorn
---
[Medium] chunk lines 181-195 in lib/tasks/disqus.thor:
            post = PostCreator.new(post_user, attrs).create
            p[:discourse_number] = post.post_number
          end
          TopicFeaturedUsers.new(post.topic).choose
        end
      end
    end

  ensure
    RateLimiter.enable
    SiteSetting.email_domains_blacklist = email_blacklist
  end
end


---
[Medium] chunk lines 101-120 in Gemfile_rails4.lock:
    fast_xs (0.8.0)
    fastimage (1.5.2)
    ffi (1.9.3)
    flamegraph (0.0.5)
      fast_stack
    fog (1.18.0)
      builder
      excon (~> 0.28.0)
      formatador (~> 0.2.0)
      mime-types
      multi_json (~> 1.0)
      net-scp (~> 1.1)
      net-ssh (>= 2.1.3)
      nokogiri (~> 1.5)
      ruby-hmac
    formatador (0.2.4)
    fspath (2.0.5)
    given_core (3.1.1)
      sorcerer (>= 0.3.7)
    guess_html_encoding (0.0.9)
---
[Medium] chunk lines 361-380 in Gemfile_rails4.lock:
      spork (>= 1.0rc0)
    sprockets (2.10.1)
      hike (~> 1.2)
      multi_json (~> 1.0)
      rack (~> 1.0)
      tilt (~> 1.1, != 1.3.0)
    sprockets-rails (2.0.1)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      sprockets (~> 2.8)
    temple (0.6.7)
    therubyracer-discourse (0.12.0)
      libv8 (~> 3.16.14.0)
      ref
    thin (1.6.1)
      daemons (>= 1.0.9)
      eventmachine (>= 1.0.0)
      rack (>= 1.0.0)
    thor (0.18.1)
    thread_safe (0.1.3)
---
[Medium] chunk lines 401-420 in Gemfile_rails4.lock:
PLATFORMS
  ruby

DEPENDENCIES
  actionpack-action_caching
  active_model_serializers
  airbrake (= 3.1.2)
  annotate
  barber
  better_errors
  binding_of_caller
  certified
  discourse_plugin!
  email_reply_parser-discourse
  ember-rails
  ember-source (~> 1.2.0.1)
  eventmachine
  fabrication
  fakeweb (~> 1.3.0)
  fast_blank
---
[Medium] chunk lines 421-440 in Gemfile_rails4.lock:
  fast_xor
  fast_xs
  fastimage
  flamegraph
  fog (= 1.18.0)
  handlebars-source (~> 1.1.2)
  highline
  hiredis
  html_truncator
  image_optim
  image_sorcery
  librarian (>= 0.0.25)
  listen (= 0.7.3)
  lru_redux
  message_bus
  minitest
  mocha
  mock_redis
  multi_json
  mustache
---
[Medium] chunk lines 181-200 in Gemfile_rails4.lock:
      jwt (~> 0.1.4)
      multi_json (~> 1.0)
      rack (~> 1.2)
    oj (2.2.3)
    omniauth (1.1.4)
      hashie (>= 1.2, < 3)
      rack
    omniauth-browserid-discourse (0.0.2)
      faraday
      multi_json
      omniauth (~> 1.0)
    omniauth-cas (1.0.4)
      addressable (~> 2.3)
      nokogiri (~> 1.6)
      omniauth (~> 1.1.0)
    omniauth-facebook (1.4.1)
      omniauth-oauth2 (~> 1.1.0)
    omniauth-github (1.1.1)
      omniauth (~> 1.0)
      omniauth-oauth2 (~> 1.1)
---
[Medium] chunk lines 201-220 in Gemfile_rails4.lock:
    omniauth-oauth (1.0.1)
      oauth
      omniauth (~> 1.0)
    omniauth-oauth2 (1.1.1)
      oauth2 (~> 0.8.0)
      omniauth (~> 1.0)
    omniauth-openid (1.0.1)
      omniauth (~> 1.0)
      rack-openid (~> 1.3.1)
    omniauth-twitter (1.0.1)
      multi_json (~> 1.3)
      omniauth-oauth (~> 1.0)
    openid-redis-store (0.0.2)
      redis
      ruby-openid
    pg (0.15.1)
    polyglot (0.3.3)
    progress (3.0.0)
    pry (0.9.12.4)
      coderay (~> 1.0)
---
[Medium] chunk lines 261-280 in Gemfile_rails4.lock:
      rake
    rb-fsevent (0.9.3)
    rb-inotify (0.9.2)
      ffi (>= 0.5.0)
    rbtrace (0.4.1)
      ffi (>= 1.0.6)
      msgpack (>= 0.4.3)
      trollop (>= 1.16.2)
    redcarpet (3.0.0)
    redis (3.0.6)
    redis-actionpack (4.0.0)
      actionpack (~> 4)
      redis-rack (~> 1.5.0)
      redis-store (~> 1.1.0)
    redis-activesupport (4.0.0)
      activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-namespace (1.3.2)
      redis (~> 3.0.4)
    redis-rack (1.5.0)
---
[Medium] chunk lines 281-300 in Gemfile_rails4.lock:
      rack (~> 1.5)
      redis-store (~> 1.1.0)
    redis-rails (4.0.0)
      redis-actionpack (~> 4)
      redis-activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-store (1.1.4)
      redis (>= 2.2)
    ref (1.0.5)
    rest-client (1.6.7)
      mime-types (>= 1.16)
    rinku (1.7.3)
    rspec (2.14.1)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    rspec-core (2.14.6)
    rspec-expectations (2.14.3)
      diff-lcs (>= 1.1.3, < 2.0)
 
---
[Medium] chunk lines 121-140 in Gemfile_rails4.lock:
    handlebars-source (1.1.2)
    hashie (2.0.5)
    highline (1.6.20)
    hike (1.2.3)
    hiredis (0.4.5)
    html_truncator (0.3.1)
      nokogiri (~> 1.5)
    httpauth (0.2.0)
    i18n (0.6.9)
    ice_cube (0.11.1)
    image_optim (0.9.1)
      exifr (~> 1.1.3)
      fspath (~> 2.0.5)
      image_size (~> 1.1.2)
      in_threads (~> 1.2.0)
      progress (~> 3.0.0)
    image_size (1.1.3)
    image_sorcery (1.1.0)
    in_threads (1.2.0)
    jquery-rails (3.0.4)
---
[Medium] chunk lines 221-240 in Gemfile_rails4.lock:
      method_source (~> 0.8)
      slop (~> 3.4)
    pry-nav (0.2.3)
      pry (~> 0.9.10)
    pry-rails (0.3.2)
      pry (>= 0.9.10)
    puma (2.6.0)
      rack (>= 1.1, < 2.0)
    qunit-rails (0.0.4)
      railties (>= 3.2.3)
    rack (1.5.2)
    rack-cors (0.2.8)
      rack
    rack-mini-profiler (0.9.0.pre)
      rack (>= 1.1.3)
    rack-openid (1.3.1)
      rack (>= 1.1.0)
      ruby-openid (>= 2.1.8)
    rack-protection (1.5.1)
      rack
---
[Medium] chunk lines 301-320 in Gemfile_rails4.lock:
      given_core (= 3.1.1)
      rspec (>= 2.12)
    rspec-mocks (2.14.4)
    rspec-rails (2.14.0)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      railties (>= 3.0)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    ruby-hmac (0.4.0)
    ruby-openid (2.3.0)
    ruby-readability (0.5.7)
      guess_html_encoding (>= 0.0.4)
      nokogiri (>= 1.4.2)
    sanitize (2.0.6)
      nokogiri (>= 1.4.4)
    sass (3.2.12)
    sass-rails (4.0.1)

---
[Medium] chunk lines 341-360 in Gemfile_rails4.lock:
      celluloid (>= 0.14.1)
      ice_cube (~> 0.11.0)
      sidekiq (~> 2.15.0)
    simple-rss (1.3.1)
    simplecov (0.7.1)
      multi_json (~> 1.0)
      simplecov-html (~> 0.7.1)
    simplecov-html (0.7.1)
    sinatra (1.4.4)
      rack (~> 1.4)
      rack-protection (~> 1.4)
      tilt (~> 1.3, >= 1.3.4)
    slim (2.0.1)
      temple (~> 0.6.6)
      tilt (>= 1.3.3, < 2.1)
    slop (3.4.7)
    sorcerer (1.0.2)
    spork (1.0.0rc4)
    spork-rails (4.0.0)
      rails (>= 3.0.0, < 5)
---
[Medium] chunk lines 161-180 in Gemfile_rails4.lock:
    method_source (0.8.2)
    mime-types (1.25.1)
    mini_portile (0.5.1)
    minitest (4.7.5)
    mocha (0.14.0)
      metaclass (~> 0.0.1)
    mock_redis (0.9.0)
    msgpack (0.5.7)
    multi_json (1.8.2)
    multipart-post (1.2.0)
    mustache (0.99.4)
    net-scp (1.1.2)
      net-ssh (>= 2.6.5)
    net-ssh (2.7.0)
    nokogiri (1.6.0)
      mini_portile (~> 0.5.0)
    oauth (0.4.7)
    oauth2 (0.8.1)
      faraday (~> 0.8)
      httpauth (~> 0.1)
---
[Medium] chunk lines 441-460 in Gemfile_rails4.lock:
  nokogiri
  oj
  omniauth
  omniauth-browserid-discourse
  omniauth-cas
  omniauth-facebook
  omniauth-github
  omniauth-oauth2
  omniauth-openid
  omniauth-twitter
  openid-redis-store
  pg (= 0.15.1)
  pry-nav
  pry-rails
  puma
  qunit-rails
  rack-cors
  rack-mini-profiler (= 0.9.0.pre)
  rack-protection
  rails
---
[Medium] chunk lines 141-160 in Gemfile_rails4.lock:
      railties (>= 3.0, < 5.0)
      thor (>= 0.14, < 2.0)
    json (1.8.1)
    jwt (0.1.8)
      multi_json (>= 1.5)
    kgio (2.8.1)
    librarian (0.1.1)
      highline
      thor (~> 0.15)
    libv8 (3.16.14.3)
    listen (0.7.3)
    lru_redux (0.8.1)
    mail (2.5.4)
      mime-types (~> 1.16)
      treetop (~> 1.4.8)
    message_bus (0.9.3.2)
      eventmachine
      rack (>= 1.1.3)
      redis
    metaclass (0.0.1)
---
[Medium] chunk lines 381-400 in Gemfile_rails4.lock:
      atomic
    tilt (1.4.1)
    timecop (0.6.3)
    timers (1.1.0)
    treetop (1.4.15)
      polyglot
      polyglot (>= 0.3.1)
    trollop (2.0)
    tzinfo (0.3.38)
    uglifier (2.3.3)
      execjs (>= 0.3.0)
      json (>= 1.8.0)
    unf (0.1.3)
      unf_ext
    unf_ext (0.0.6)
    unicorn (4.7.0)
      kgio (~> 2.6)
      rack
      raindrops (~> 0.7)

---
[Medium] chunk lines 321-340 in Gemfile_rails4.lock:
      sass (>= 3.1.10)
      sprockets-rails (~> 2.0.0)
    seed-fu-discourse (2.2.0)
      activerecord (>= 3.1, < 4.1)
      activesupport (>= 3.1, < 4.1)
    shoulda (3.5.0)
      shoulda-context (~> 1.0, >= 1.0.1)
      shoulda-matchers (>= 1.4.1, < 3.0)
    shoulda-context (1.1.5)
    shoulda-matchers (2.4.0)
      activesupport (>= 3.0.0)
    sidekiq (2.15.1)
      celluloid (>= 0.15.1)
      connection_pool (>= 1.0.0)
      json
      redis (>= 3.0.4)
      redis-namespace (>= 1.3.1)
    
---
[Medium] chunk lines 241-260 in Gemfile_rails4.lock:
    rack-test (0.6.2)
      rack (>= 1.0)
    rails (4.0.2)
      actionmailer (= 4.0.2)
      actionpack (= 4.0.2)
      activerecord (= 4.0.2)
      activesupport (= 4.0.2)
      bundler (>= 1.3.0, < 2.0)
      railties (= 4.0.2)
      sprockets-rails (~> 2.0.0)
    rails-observers (0.1.2)
      activemodel (~> 4.0)
    railties (4.0.2)
      actionpack (= 4.0.2)
      activesupport (= 4.0.2)
      rake (>= 0.8.7)
      thor (>= 0.18.1, < 2.0)
    raindrops (0.12.0)
    rake (10.1.0)
    rake-
---
[Medium] chunk lines 461-480 in Gemfile_rails4.lock:
  rails-observers
  rails_multisite!
  rake
  rb-fsevent
  rb-inotify (~> 0.9)
  rbtrace
  redcarpet
  redis
  redis-rails
  rest-client
  rinku
  rspec-given
  rspec-rails
  ruby-readability
  sanitize
  sass
  sass-rails
  seed-fu-discourse
  shoulda
  sidekiq (= 2.15.1)
---
[Medium] section en in config/locales/server.en.yml:
en:
  dates:
    short_date_no_year: ""D MMM""
    short_date: ""D MMM, YYYY""
    long_date: ""MMMM D, YYYY h:mma""
  time:
    formats:
      short: ""%m-%d-%Y""
      short_no_year: ""%B %-d""
      date_only: ""%b %-d, %Y""

  title: ""Discourse""
  topics: ""Topics""
  posts: ""posts""
  loading: ""Loading""
  powered_by_html: 'Powered by <a href=""http://www.discourse.org"">Discourse</a>, best viewed with JavaScript enabled'

  via: ""%{username} via %{site_name}""
  is_reserved: ""is reserved""

  site_under_maint
---
[Medium] class CreateTopTopics in db/migrate/20131223171005_create_top_topics.rb:
class CreateTopTopics < ActiveRecord::Migration
  def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{per
---
[Medium] chunk lines 141-160 in lib/tasks/disqus.thor:
    SiteSetting.email_domains_blacklist = """"

    parser.threads.each do |id, t|
      puts ""Creating #{t[:title]}... (#{t[:posts].size} posts)""

      if options[:dry_run].blank?

        post = TopicEmbed.import_remote(user, t[:link], title: t[:title])
        if post.present?
          t[:posts].each do |p|
            post_user = user
            if p[:author_email]
              email = Email.downcase(p[:author_email])
              post_user = User.where(email: email).first
              i
---
[Medium] chunk lines 161-180 in lib/tasks/disqus.thor:
              topic_id: post.topic_id,
              raw: p[:cooked],
              cooked: p[:cooked],
              created_at: Date.parse(p[:created_at])
            }

            if p[:parent_id]
              parent = parser.posts[p[:parent_id]]
              if parent && parent[:discourse_number]
                attrs[:reply_to_post_number] = parent[:discourse_number]
              end
            end

            post = PostCreator.new(post_user, attrs).create
            p[:discourse_nu
---
[Medium] chunk lines 101-120 in lib/tasks/disqus.thor:
        existing[:posts] << t[:posts]
        existing[:posts].flatten!
        @threads.delete(t[:id])
      end
    end


  end
end

class Disqus < Thor
  desc ""import"", ""Imports posts from a Disqus XML export""
  method_option :file, aliases: '-f', required: true, desc: ""The disqus XML file to import""
  method_option :dry_run, required: false, desc: ""Just output what will be imported rather than doing it""
  method_option :post_as, aliases: '-p', required: true, desc: ""The Discourse username to","PostCreator (Critical), PostRevisor (Critical), Post (Critical), TopicEmbed (Critical), cook_methods (Critical), import_remote (High), cook (High), setup_post (High), update_post (High), topic_id_for_embed (High), absolutize_urls (High), TopicRetriever (Medium), perform_retrieve (Medium), execute (Medium), change (Medium), initialize (Medium), retrieve (Medium), Jobs (Medium), RetrieveTopic (Medium), change (Medium), change (Medium), lines 481-486 (Medium), lines 181-195 (Medium), lines 101-120 (Medium), lines 361-380 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 121-140 (Medium), lines 221-240 (Medium), lines 301-320 (Medium), lines 341-360 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 141-160 (Medium), lines 381-400 (Medium), lines 321-340 (Medium), lines 241-260 (Medium), lines 461-480 (Medium), en (Medium), CreateTopTopics (Medium), lines 141-160 (Medium), lines 161-180 (Medium), lines 101-120 (Medium), lines 201-219 (Low), lines 481-493 (Low), comments (Low), postMessageReceived (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-69 (Low), EmbedController (Low), best (Low), ensure_embeddable (Low), Jobs (Low), PollFeed (Low), execute (Low), feed_key (Low), poll_feed (Low), import (Low), lines 1-20 (Low), lines 21-30 (Low), lines 1-12 (Low), lines 1-20 (Low), embedding (Low), CreateTopicEmbeds (Low), AddCookMethodToPosts (Low), lines 181-188 (Low), invalid_host? (Low), retrieved_recently? (Low), fetch_http (Low), lines 121-140 (Low), MigrateWordCounts (Low), revise! (Low)",match,"SSRF vulnerability in embedding code, TopicEmbed is Critical"
discourse,4,Enhance embed URL handling and validation system,The current origin validation using indexOf is insufficient and can be bypassed. An attacker could use a malicious domain like evil-discourseUrl.com to pass this check.,Medium,78,11,36,"class::PostCreator (lib/post_creator.rb) [Critical, score=1.00] | class::PostRevisor (lib/post_revisor.rb) [Critical, score=1.00] | class::Post (app/models/post.rb) [Critical, score=0.94] | class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.90] | method::cook_methods (app/models/post.rb) [Critical, score=0.87] | method::import_remote (app/models/topic_embed.rb) [High, score=0.64] | method::cook (app/models/post.rb) [High, score=0.60] | method::setup_post (lib/post_creator.rb) [High, score=0.60] | method::update_post (lib/post_revisor.rb) [High, score=0.60] | method::topic_id_for_embed (app/models/topic_embed.rb) [High, score=0.58] | method::absolutize_urls (app/models/topic_embed.rb) [High, score=0.54]","[Critical] class PostCreator in lib/post_creator.rb:
class PostCreator

  attr_reader :errors, :opts

  # Acceptable options:
  #
  #   raw                     - raw text of post
  #   image_sizes             - We can pass a list of the sizes of images in the post as a shortcut.
  #   invalidate_oneboxes     - Whether to force invalidation of oneboxes in this post
  #   acting_user             - The user performing the action might be different than the user
  #                             who is the post ""author."" For example when copying posts to a new
  #                             topic.
  #   created_at              - Post creation time (optional)
  #   auto_track              - Automatically track this topic if needed (default true)
  #
  #   When replying to a topic:
  #     topic_id              - topic we're replying to
  #     rep
---
[Critical] class PostRevisor in lib/post_revisor.rb:
class PostRevisor

  attr_reader :category_changed

  def initialize(post)
    @post = post
  end

  def revise!(user, new_raw, opts = {})
    @user, @new_raw, @opts = user, new_raw, opts
    return false if not should_revise?
    @post.acting_user = @user
    revise_post
    update_category_description
    post_process_post
    update_topic_word_counts
    @post.advance_draft_sequence

    true
  end

  private

  def should_revise?
    @post.raw != @new_raw
  end

  def revise_post
    if should_create_new_version?
      revise_and_create_new_version
    else
      update_post
    end
  end

  def get_revised_at
    @opts[:revised_at] || Time.now
  end

  def should_create_new_version?
    @post.last_editor_id != @user.id ||
    get_revised_at - @post.last_version_at > SiteSetting.ninja_
---
[Critical] class Post in app/models/post.rb:
class Post < ActiveRecord::Base
  include RateLimiter::OnCreateRecord
  include Trashable

  rate_limit
  rate_limit :limit_posts_per_day

  belongs_to :user
  belongs_to :topic, counter_cache: :posts_count
  belongs_to :reply_to_user, class_name: ""User""

  has_many :post_replies
  has_many :replies, through: :post_replies
  has_many :post_actions
  has_many :topic_links

  has_many :post_uploads
  has_many :uploads, through: :post_uploads

  has_one :post_search_data

  has_many :post_details

  has_many :post_revisions
  has_many :revisions, foreign_key: :post_id, class_name: 'PostRevision'

  validates_with ::Validators::PostValidator

  # We can pass several creating options to a post via attributes
  attr_accessor :image_sizes, :quoted_post_numbers, :no_bump, :invalidate_oneboxes, :co
---
[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_presence_of :content_sha1

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    contents << ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""

    embed = TopicEmbed.where(embed_url: url).first
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transaction do
        creator = PostCreator.new(user, title: title, raw: absolutize_urls(url, contents), skip_validations: true, cook_method: Post.cook_methods[:raw_html])
      
---
[Critical] method cook_methods in app/models/post.rb:
def self.cook_methods
    @cook_methods ||= Enum.new(:regular, :raw_html)
  end
---
[High] method import_remote in app/models/topic_embed.rb:
def self.import_remote(user, url, opts=nil)
    require 'ruby-readability'

    opts = opts || {}
    doc = Readability::Document.new(open(url).read,
                                        tags: %w[div p code pre h1 h2 h3 b em i strong a img],
                                        attributes: %w[href src])

    TopicEmbed.import(user, url, opts[:title] || doc.title, doc.content)
  end
---
[High] method cook in app/models/post.rb:
def cook(*args)
    # For some posts, for example those imported via RSS, we support raw HTML. In that
    # case we can skip the rendering pipeline.
    return raw if cook_method == Post.cook_methods[:raw_html]

    # Default is to cook posts
    Plugin::Filter.apply(:after_post_cook, self, post_analyzer.cook(*args))
  end
---
[High] method setup_post in lib/post_creator.rb:
def setup_post
    post = @topic.posts.new(raw: @opts[:raw],
                            user: @user,
                            reply_to_post_number: @opts[:reply_to_post_number])

    # Attributes we pass through to the post instance if present
    [:post_type, :no_bump, :cooking_options, :image_sizes, :acting_user, :invalidate_oneboxes].each do |a|
      post.send(""#{a}="", @opts[a]) if @opts[a].present?
    end

    post.cook_method = @opts[:cook_method] if @opts[:cook_method].present?
    post.extract_quoted_post_numbers
    post.created_at = Time.zone.parse(@opts[:created_at].to_s) if @opts[:created_at].present?
    @post = post
  end
---
[High] method update_post in lib/post_revisor.rb:
def update_post
    @post.raw = @new_raw
    @post.word_count = @new_raw.scan(/\w+/).size
    @post.last_editor_id = @user.id
    @post.edit_reason = @opts[:edit_reason] if @opts[:edit_reason]

    if @post.hidden && @post.hidden_reason_id == Post.hidden_reasons[:flag_threshold_reached]
      @post.hidden = false
      @post.hidden_reason_id = nil
      @post.topic.update_attributes(visible: true)

      PostAction.clear_flags!(@post, -1)
    end

    @post.extract_quoted_post_numbers
    @post.save(validate: !@opts[:skip_validations])

    @post.save_reply_relationships
  end
---
[High] method topic_id_for_embed in app/models/topic_embed.rb:
def self.topic_id_for_embed(embed_url)
    TopicEmbed.where(embed_url: embed_url).pluck(:topic_id).first
  end
---
[High] method absolutize_urls in app/models/topic_embed.rb:
def self.absolutize_urls(url, contents)
    uri = URI(url)
    prefix = ""#{uri.scheme}://#{uri.host}""
    prefix << "":#{uri.port}"" if uri.port != 80 && uri.port != 443

    fragment = Nokogiri::HTML.fragment(contents)
    fragment.css('a').each do |a|
      href = a['href']
      if href.present? && href.start_with?('/')
        a['href'] = ""#{prefix}/#{href.sub(/^\/+/, '')}""
      end
    end
    fragment.css('img').each do |a|
      src = a['src']
      if src.present? && src.start_with?('/')
        a['src'] = ""#{prefix}/#{src.sub(/^\/+/, '')}""
      end
    end

    fragment.to_html
  end","[Medium] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      SiteSetting.embeddable_host != URI(@embed_url).host
    rescue URI::InvalidURIError
      # An invalid URI is an invalid host
      true
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return fa
---
[Medium] method perform_retrieve in lib/topic_retriever.rb:
def perform_retrieve
      # It's possible another process or job found the embed already. So if that happened bail out.
      return if TopicEmbed.where(embed_url: @embed_url).exists?

      # First check RSS if that is enabled
      if SiteSetting.feed_polling_enabled?
        Jobs::PollFeed.new.execute({})
        return if TopicEmbed.where(embed_url: @embed_url).exists?
      end

      fetch_http
    end
---
[Medium] method execute in app/jobs/regular/retrieve_topic.rb:
def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end
---
[Medium] method change in db/migrate/20131223171005_create_top_topics.rb:
def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{period}_#{sort}_count"".to_sym, order: 'desc'
      en
---
[Medium] method initialize in lib/topic_retriever.rb:
def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end
---
[Medium] method retrieve in lib/topic_retriever.rb:
def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end
---
[Medium] module Jobs in app/jobs/regular/retrieve_topic.rb:
module Jobs

  # Asynchronously retrieve a topic from an embedded site
  class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end

end
---
[Medium] class RetrieveTopic in app/jobs/regular/retrieve_topic.rb:
class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end
---
[Medium] method change in db/migrate/20131217174004_create_topic_embeds.rb:
def change
    create_table :topic_embeds, force: true do |t|
      t.integer :topic_id, null: false
      t.integer :post_id, null: false
      t.string :embed_url, null: false
      t.string :content_sha1, null: false, limit: 40
      t.timestamps
    end

    add_index :topic_embeds, :embed_url, unique: true
  end
---
[Medium] method change in db/migrate/20131219203905_add_cook_method_to_posts.rb:
def change
    add_column :posts, :cook_method, :integer, default: 1, null: false
  end
---
[Medium] chunk lines 481-486 in Gemfile_rails4.lock:
  therubyracer-discourse
  thin
  timecop
  uglifier
  unf
  unicorn
---
[Medium] chunk lines 181-195 in lib/tasks/disqus.thor:
            post = PostCreator.new(post_user, attrs).create
            p[:discourse_number] = post.post_number
          end
          TopicFeaturedUsers.new(post.topic).choose
        end
      end
    end

  ensure
    RateLimiter.enable
    SiteSetting.email_domains_blacklist = email_blacklist
  end
end


---
[Medium] chunk lines 101-120 in Gemfile_rails4.lock:
    fast_xs (0.8.0)
    fastimage (1.5.2)
    ffi (1.9.3)
    flamegraph (0.0.5)
      fast_stack
    fog (1.18.0)
      builder
      excon (~> 0.28.0)
      formatador (~> 0.2.0)
      mime-types
      multi_json (~> 1.0)
      net-scp (~> 1.1)
      net-ssh (>= 2.1.3)
      nokogiri (~> 1.5)
      ruby-hmac
    formatador (0.2.4)
    fspath (2.0.5)
    given_core (3.1.1)
      sorcerer (>= 0.3.7)
    guess_html_encoding (0.0.9)
---
[Medium] chunk lines 361-380 in Gemfile_rails4.lock:
      spork (>= 1.0rc0)
    sprockets (2.10.1)
      hike (~> 1.2)
      multi_json (~> 1.0)
      rack (~> 1.0)
      tilt (~> 1.1, != 1.3.0)
    sprockets-rails (2.0.1)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      sprockets (~> 2.8)
    temple (0.6.7)
    therubyracer-discourse (0.12.0)
      libv8 (~> 3.16.14.0)
      ref
    thin (1.6.1)
      daemons (>= 1.0.9)
      eventmachine (>= 1.0.0)
      rack (>= 1.0.0)
    thor (0.18.1)
    thread_safe (0.1.3)
---
[Medium] chunk lines 401-420 in Gemfile_rails4.lock:
PLATFORMS
  ruby

DEPENDENCIES
  actionpack-action_caching
  active_model_serializers
  airbrake (= 3.1.2)
  annotate
  barber
  better_errors
  binding_of_caller
  certified
  discourse_plugin!
  email_reply_parser-discourse
  ember-rails
  ember-source (~> 1.2.0.1)
  eventmachine
  fabrication
  fakeweb (~> 1.3.0)
  fast_blank
---
[Medium] chunk lines 421-440 in Gemfile_rails4.lock:
  fast_xor
  fast_xs
  fastimage
  flamegraph
  fog (= 1.18.0)
  handlebars-source (~> 1.1.2)
  highline
  hiredis
  html_truncator
  image_optim
  image_sorcery
  librarian (>= 0.0.25)
  listen (= 0.7.3)
  lru_redux
  message_bus
  minitest
  mocha
  mock_redis
  multi_json
  mustache
---
[Medium] chunk lines 181-200 in Gemfile_rails4.lock:
      jwt (~> 0.1.4)
      multi_json (~> 1.0)
      rack (~> 1.2)
    oj (2.2.3)
    omniauth (1.1.4)
      hashie (>= 1.2, < 3)
      rack
    omniauth-browserid-discourse (0.0.2)
      faraday
      multi_json
      omniauth (~> 1.0)
    omniauth-cas (1.0.4)
      addressable (~> 2.3)
      nokogiri (~> 1.6)
      omniauth (~> 1.1.0)
    omniauth-facebook (1.4.1)
      omniauth-oauth2 (~> 1.1.0)
    omniauth-github (1.1.1)
      omniauth (~> 1.0)
      omniauth-oauth2 (~> 1.1)
---
[Medium] chunk lines 201-220 in Gemfile_rails4.lock:
    omniauth-oauth (1.0.1)
      oauth
      omniauth (~> 1.0)
    omniauth-oauth2 (1.1.1)
      oauth2 (~> 0.8.0)
      omniauth (~> 1.0)
    omniauth-openid (1.0.1)
      omniauth (~> 1.0)
      rack-openid (~> 1.3.1)
    omniauth-twitter (1.0.1)
      multi_json (~> 1.3)
      omniauth-oauth (~> 1.0)
    openid-redis-store (0.0.2)
      redis
      ruby-openid
    pg (0.15.1)
    polyglot (0.3.3)
    progress (3.0.0)
    pry (0.9.12.4)
      coderay (~> 1.0)
---
[Medium] chunk lines 261-280 in Gemfile_rails4.lock:
      rake
    rb-fsevent (0.9.3)
    rb-inotify (0.9.2)
      ffi (>= 0.5.0)
    rbtrace (0.4.1)
      ffi (>= 1.0.6)
      msgpack (>= 0.4.3)
      trollop (>= 1.16.2)
    redcarpet (3.0.0)
    redis (3.0.6)
    redis-actionpack (4.0.0)
      actionpack (~> 4)
      redis-rack (~> 1.5.0)
      redis-store (~> 1.1.0)
    redis-activesupport (4.0.0)
      activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-namespace (1.3.2)
      redis (~> 3.0.4)
    redis-rack (1.5.0)
---
[Medium] chunk lines 281-300 in Gemfile_rails4.lock:
      rack (~> 1.5)
      redis-store (~> 1.1.0)
    redis-rails (4.0.0)
      redis-actionpack (~> 4)
      redis-activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-store (1.1.4)
      redis (>= 2.2)
    ref (1.0.5)
    rest-client (1.6.7)
      mime-types (>= 1.16)
    rinku (1.7.3)
    rspec (2.14.1)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    rspec-core (2.14.6)
    rspec-expectations (2.14.3)
      diff-lcs (>= 1.1.3, < 2.0)
 
---
[Medium] chunk lines 121-140 in Gemfile_rails4.lock:
    handlebars-source (1.1.2)
    hashie (2.0.5)
    highline (1.6.20)
    hike (1.2.3)
    hiredis (0.4.5)
    html_truncator (0.3.1)
      nokogiri (~> 1.5)
    httpauth (0.2.0)
    i18n (0.6.9)
    ice_cube (0.11.1)
    image_optim (0.9.1)
      exifr (~> 1.1.3)
      fspath (~> 2.0.5)
      image_size (~> 1.1.2)
      in_threads (~> 1.2.0)
      progress (~> 3.0.0)
    image_size (1.1.3)
    image_sorcery (1.1.0)
    in_threads (1.2.0)
    jquery-rails (3.0.4)
---
[Medium] chunk lines 221-240 in Gemfile_rails4.lock:
      method_source (~> 0.8)
      slop (~> 3.4)
    pry-nav (0.2.3)
      pry (~> 0.9.10)
    pry-rails (0.3.2)
      pry (>= 0.9.10)
    puma (2.6.0)
      rack (>= 1.1, < 2.0)
    qunit-rails (0.0.4)
      railties (>= 3.2.3)
    rack (1.5.2)
    rack-cors (0.2.8)
      rack
    rack-mini-profiler (0.9.0.pre)
      rack (>= 1.1.3)
    rack-openid (1.3.1)
      rack (>= 1.1.0)
      ruby-openid (>= 2.1.8)
    rack-protection (1.5.1)
      rack
---
[Medium] chunk lines 301-320 in Gemfile_rails4.lock:
      given_core (= 3.1.1)
      rspec (>= 2.12)
    rspec-mocks (2.14.4)
    rspec-rails (2.14.0)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      railties (>= 3.0)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    ruby-hmac (0.4.0)
    ruby-openid (2.3.0)
    ruby-readability (0.5.7)
      guess_html_encoding (>= 0.0.4)
      nokogiri (>= 1.4.2)
    sanitize (2.0.6)
      nokogiri (>= 1.4.4)
    sass (3.2.12)
    sass-rails (4.0.1)

---
[Medium] chunk lines 341-360 in Gemfile_rails4.lock:
      celluloid (>= 0.14.1)
      ice_cube (~> 0.11.0)
      sidekiq (~> 2.15.0)
    simple-rss (1.3.1)
    simplecov (0.7.1)
      multi_json (~> 1.0)
      simplecov-html (~> 0.7.1)
    simplecov-html (0.7.1)
    sinatra (1.4.4)
      rack (~> 1.4)
      rack-protection (~> 1.4)
      tilt (~> 1.3, >= 1.3.4)
    slim (2.0.1)
      temple (~> 0.6.6)
      tilt (>= 1.3.3, < 2.1)
    slop (3.4.7)
    sorcerer (1.0.2)
    spork (1.0.0rc4)
    spork-rails (4.0.0)
      rails (>= 3.0.0, < 5)
---
[Medium] chunk lines 161-180 in Gemfile_rails4.lock:
    method_source (0.8.2)
    mime-types (1.25.1)
    mini_portile (0.5.1)
    minitest (4.7.5)
    mocha (0.14.0)
      metaclass (~> 0.0.1)
    mock_redis (0.9.0)
    msgpack (0.5.7)
    multi_json (1.8.2)
    multipart-post (1.2.0)
    mustache (0.99.4)
    net-scp (1.1.2)
      net-ssh (>= 2.6.5)
    net-ssh (2.7.0)
    nokogiri (1.6.0)
      mini_portile (~> 0.5.0)
    oauth (0.4.7)
    oauth2 (0.8.1)
      faraday (~> 0.8)
      httpauth (~> 0.1)
---
[Medium] chunk lines 441-460 in Gemfile_rails4.lock:
  nokogiri
  oj
  omniauth
  omniauth-browserid-discourse
  omniauth-cas
  omniauth-facebook
  omniauth-github
  omniauth-oauth2
  omniauth-openid
  omniauth-twitter
  openid-redis-store
  pg (= 0.15.1)
  pry-nav
  pry-rails
  puma
  qunit-rails
  rack-cors
  rack-mini-profiler (= 0.9.0.pre)
  rack-protection
  rails
---
[Medium] chunk lines 141-160 in Gemfile_rails4.lock:
      railties (>= 3.0, < 5.0)
      thor (>= 0.14, < 2.0)
    json (1.8.1)
    jwt (0.1.8)
      multi_json (>= 1.5)
    kgio (2.8.1)
    librarian (0.1.1)
      highline
      thor (~> 0.15)
    libv8 (3.16.14.3)
    listen (0.7.3)
    lru_redux (0.8.1)
    mail (2.5.4)
      mime-types (~> 1.16)
      treetop (~> 1.4.8)
    message_bus (0.9.3.2)
      eventmachine
      rack (>= 1.1.3)
      redis
    metaclass (0.0.1)
---
[Medium] chunk lines 381-400 in Gemfile_rails4.lock:
      atomic
    tilt (1.4.1)
    timecop (0.6.3)
    timers (1.1.0)
    treetop (1.4.15)
      polyglot
      polyglot (>= 0.3.1)
    trollop (2.0)
    tzinfo (0.3.38)
    uglifier (2.3.3)
      execjs (>= 0.3.0)
      json (>= 1.8.0)
    unf (0.1.3)
      unf_ext
    unf_ext (0.0.6)
    unicorn (4.7.0)
      kgio (~> 2.6)
      rack
      raindrops (~> 0.7)

---
[Medium] chunk lines 321-340 in Gemfile_rails4.lock:
      sass (>= 3.1.10)
      sprockets-rails (~> 2.0.0)
    seed-fu-discourse (2.2.0)
      activerecord (>= 3.1, < 4.1)
      activesupport (>= 3.1, < 4.1)
    shoulda (3.5.0)
      shoulda-context (~> 1.0, >= 1.0.1)
      shoulda-matchers (>= 1.4.1, < 3.0)
    shoulda-context (1.1.5)
    shoulda-matchers (2.4.0)
      activesupport (>= 3.0.0)
    sidekiq (2.15.1)
      celluloid (>= 0.15.1)
      connection_pool (>= 1.0.0)
      json
      redis (>= 3.0.4)
      redis-namespace (>= 1.3.1)
    
---
[Medium] chunk lines 241-260 in Gemfile_rails4.lock:
    rack-test (0.6.2)
      rack (>= 1.0)
    rails (4.0.2)
      actionmailer (= 4.0.2)
      actionpack (= 4.0.2)
      activerecord (= 4.0.2)
      activesupport (= 4.0.2)
      bundler (>= 1.3.0, < 2.0)
      railties (= 4.0.2)
      sprockets-rails (~> 2.0.0)
    rails-observers (0.1.2)
      activemodel (~> 4.0)
    railties (4.0.2)
      actionpack (= 4.0.2)
      activesupport (= 4.0.2)
      rake (>= 0.8.7)
      thor (>= 0.18.1, < 2.0)
    raindrops (0.12.0)
    rake (10.1.0)
    rake-
---
[Medium] chunk lines 461-480 in Gemfile_rails4.lock:
  rails-observers
  rails_multisite!
  rake
  rb-fsevent
  rb-inotify (~> 0.9)
  rbtrace
  redcarpet
  redis
  redis-rails
  rest-client
  rinku
  rspec-given
  rspec-rails
  ruby-readability
  sanitize
  sass
  sass-rails
  seed-fu-discourse
  shoulda
  sidekiq (= 2.15.1)
---
[Medium] section en in config/locales/server.en.yml:
en:
  dates:
    short_date_no_year: ""D MMM""
    short_date: ""D MMM, YYYY""
    long_date: ""MMMM D, YYYY h:mma""
  time:
    formats:
      short: ""%m-%d-%Y""
      short_no_year: ""%B %-d""
      date_only: ""%b %-d, %Y""

  title: ""Discourse""
  topics: ""Topics""
  posts: ""posts""
  loading: ""Loading""
  powered_by_html: 'Powered by <a href=""http://www.discourse.org"">Discourse</a>, best viewed with JavaScript enabled'

  via: ""%{username} via %{site_name}""
  is_reserved: ""is reserved""

  site_under_maint
---
[Medium] class CreateTopTopics in db/migrate/20131223171005_create_top_topics.rb:
class CreateTopTopics < ActiveRecord::Migration
  def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{per
---
[Medium] chunk lines 141-160 in lib/tasks/disqus.thor:
    SiteSetting.email_domains_blacklist = """"

    parser.threads.each do |id, t|
      puts ""Creating #{t[:title]}... (#{t[:posts].size} posts)""

      if options[:dry_run].blank?

        post = TopicEmbed.import_remote(user, t[:link], title: t[:title])
        if post.present?
          t[:posts].each do |p|
            post_user = user
            if p[:author_email]
              email = Email.downcase(p[:author_email])
              post_user = User.where(email: email).first
              i
---
[Medium] chunk lines 161-180 in lib/tasks/disqus.thor:
              topic_id: post.topic_id,
              raw: p[:cooked],
              cooked: p[:cooked],
              created_at: Date.parse(p[:created_at])
            }

            if p[:parent_id]
              parent = parser.posts[p[:parent_id]]
              if parent && parent[:discourse_number]
                attrs[:reply_to_post_number] = parent[:discourse_number]
              end
            end

            post = PostCreator.new(post_user, attrs).create
            p[:discourse_nu
---
[Medium] chunk lines 101-120 in lib/tasks/disqus.thor:
        existing[:posts] << t[:posts]
        existing[:posts].flatten!
        @threads.delete(t[:id])
      end
    end


  end
end

class Disqus < Thor
  desc ""import"", ""Imports posts from a Disqus XML export""
  method_option :file, aliases: '-f', required: true, desc: ""The disqus XML file to import""
  method_option :dry_run, required: false, desc: ""Just output what will be imported rather than doing it""
  method_option :post_as, aliases: '-p', required: true, desc: ""The Discourse username to","PostCreator (Critical), PostRevisor (Critical), Post (Critical), TopicEmbed (Critical), cook_methods (Critical), import_remote (High), cook (High), setup_post (High), update_post (High), topic_id_for_embed (High), absolutize_urls (High), TopicRetriever (Medium), perform_retrieve (Medium), execute (Medium), change (Medium), initialize (Medium), retrieve (Medium), Jobs (Medium), RetrieveTopic (Medium), change (Medium), change (Medium), lines 481-486 (Medium), lines 181-195 (Medium), lines 101-120 (Medium), lines 361-380 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 121-140 (Medium), lines 221-240 (Medium), lines 301-320 (Medium), lines 341-360 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 141-160 (Medium), lines 381-400 (Medium), lines 321-340 (Medium), lines 241-260 (Medium), lines 461-480 (Medium), en (Medium), CreateTopTopics (Medium), lines 141-160 (Medium), lines 161-180 (Medium), lines 101-120 (Medium), lines 201-219 (Low), lines 481-493 (Low), comments (Low), postMessageReceived (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-69 (Low), EmbedController (Low), best (Low), ensure_embeddable (Low), Jobs (Low), PollFeed (Low), execute (Low), feed_key (Low), poll_feed (Low), import (Low), lines 1-20 (Low), lines 21-30 (Low), lines 1-12 (Low), lines 1-20 (Low), embedding (Low), CreateTopicEmbeds (Low), AddCookMethodToPosts (Low), lines 181-188 (Low), invalid_host? (Low), retrieved_recently? (Low), fetch_http (Low), lines 121-140 (Low), MigrateWordCounts (Low), revise! (Low)",partial,"origin validation is likely in JS/ERB, not in the Ruby model classes flagged as HC"
discourse,4,Enhance embed URL handling and validation system,"postMessage targetOrigin should be the origin (scheme+host+port), not the full referrer URL; using the full URL will cause the message to be dropped and prevent resizing.",Medium,78,11,36,"class::PostCreator (lib/post_creator.rb) [Critical, score=1.00] | class::PostRevisor (lib/post_revisor.rb) [Critical, score=1.00] | class::Post (app/models/post.rb) [Critical, score=0.94] | class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.90] | method::cook_methods (app/models/post.rb) [Critical, score=0.87] | method::import_remote (app/models/topic_embed.rb) [High, score=0.64] | method::cook (app/models/post.rb) [High, score=0.60] | method::setup_post (lib/post_creator.rb) [High, score=0.60] | method::update_post (lib/post_revisor.rb) [High, score=0.60] | method::topic_id_for_embed (app/models/topic_embed.rb) [High, score=0.58] | method::absolutize_urls (app/models/topic_embed.rb) [High, score=0.54]","[Critical] class PostCreator in lib/post_creator.rb:
class PostCreator

  attr_reader :errors, :opts

  # Acceptable options:
  #
  #   raw                     - raw text of post
  #   image_sizes             - We can pass a list of the sizes of images in the post as a shortcut.
  #   invalidate_oneboxes     - Whether to force invalidation of oneboxes in this post
  #   acting_user             - The user performing the action might be different than the user
  #                             who is the post ""author."" For example when copying posts to a new
  #                             topic.
  #   created_at              - Post creation time (optional)
  #   auto_track              - Automatically track this topic if needed (default true)
  #
  #   When replying to a topic:
  #     topic_id              - topic we're replying to
  #     rep
---
[Critical] class PostRevisor in lib/post_revisor.rb:
class PostRevisor

  attr_reader :category_changed

  def initialize(post)
    @post = post
  end

  def revise!(user, new_raw, opts = {})
    @user, @new_raw, @opts = user, new_raw, opts
    return false if not should_revise?
    @post.acting_user = @user
    revise_post
    update_category_description
    post_process_post
    update_topic_word_counts
    @post.advance_draft_sequence

    true
  end

  private

  def should_revise?
    @post.raw != @new_raw
  end

  def revise_post
    if should_create_new_version?
      revise_and_create_new_version
    else
      update_post
    end
  end

  def get_revised_at
    @opts[:revised_at] || Time.now
  end

  def should_create_new_version?
    @post.last_editor_id != @user.id ||
    get_revised_at - @post.last_version_at > SiteSetting.ninja_
---
[Critical] class Post in app/models/post.rb:
class Post < ActiveRecord::Base
  include RateLimiter::OnCreateRecord
  include Trashable

  rate_limit
  rate_limit :limit_posts_per_day

  belongs_to :user
  belongs_to :topic, counter_cache: :posts_count
  belongs_to :reply_to_user, class_name: ""User""

  has_many :post_replies
  has_many :replies, through: :post_replies
  has_many :post_actions
  has_many :topic_links

  has_many :post_uploads
  has_many :uploads, through: :post_uploads

  has_one :post_search_data

  has_many :post_details

  has_many :post_revisions
  has_many :revisions, foreign_key: :post_id, class_name: 'PostRevision'

  validates_with ::Validators::PostValidator

  # We can pass several creating options to a post via attributes
  attr_accessor :image_sizes, :quoted_post_numbers, :no_bump, :invalidate_oneboxes, :co
---
[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_presence_of :content_sha1

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    contents << ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""

    embed = TopicEmbed.where(embed_url: url).first
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transaction do
        creator = PostCreator.new(user, title: title, raw: absolutize_urls(url, contents), skip_validations: true, cook_method: Post.cook_methods[:raw_html])
      
---
[Critical] method cook_methods in app/models/post.rb:
def self.cook_methods
    @cook_methods ||= Enum.new(:regular, :raw_html)
  end
---
[High] method import_remote in app/models/topic_embed.rb:
def self.import_remote(user, url, opts=nil)
    require 'ruby-readability'

    opts = opts || {}
    doc = Readability::Document.new(open(url).read,
                                        tags: %w[div p code pre h1 h2 h3 b em i strong a img],
                                        attributes: %w[href src])

    TopicEmbed.import(user, url, opts[:title] || doc.title, doc.content)
  end
---
[High] method cook in app/models/post.rb:
def cook(*args)
    # For some posts, for example those imported via RSS, we support raw HTML. In that
    # case we can skip the rendering pipeline.
    return raw if cook_method == Post.cook_methods[:raw_html]

    # Default is to cook posts
    Plugin::Filter.apply(:after_post_cook, self, post_analyzer.cook(*args))
  end
---
[High] method setup_post in lib/post_creator.rb:
def setup_post
    post = @topic.posts.new(raw: @opts[:raw],
                            user: @user,
                            reply_to_post_number: @opts[:reply_to_post_number])

    # Attributes we pass through to the post instance if present
    [:post_type, :no_bump, :cooking_options, :image_sizes, :acting_user, :invalidate_oneboxes].each do |a|
      post.send(""#{a}="", @opts[a]) if @opts[a].present?
    end

    post.cook_method = @opts[:cook_method] if @opts[:cook_method].present?
    post.extract_quoted_post_numbers
    post.created_at = Time.zone.parse(@opts[:created_at].to_s) if @opts[:created_at].present?
    @post = post
  end
---
[High] method update_post in lib/post_revisor.rb:
def update_post
    @post.raw = @new_raw
    @post.word_count = @new_raw.scan(/\w+/).size
    @post.last_editor_id = @user.id
    @post.edit_reason = @opts[:edit_reason] if @opts[:edit_reason]

    if @post.hidden && @post.hidden_reason_id == Post.hidden_reasons[:flag_threshold_reached]
      @post.hidden = false
      @post.hidden_reason_id = nil
      @post.topic.update_attributes(visible: true)

      PostAction.clear_flags!(@post, -1)
    end

    @post.extract_quoted_post_numbers
    @post.save(validate: !@opts[:skip_validations])

    @post.save_reply_relationships
  end
---
[High] method topic_id_for_embed in app/models/topic_embed.rb:
def self.topic_id_for_embed(embed_url)
    TopicEmbed.where(embed_url: embed_url).pluck(:topic_id).first
  end
---
[High] method absolutize_urls in app/models/topic_embed.rb:
def self.absolutize_urls(url, contents)
    uri = URI(url)
    prefix = ""#{uri.scheme}://#{uri.host}""
    prefix << "":#{uri.port}"" if uri.port != 80 && uri.port != 443

    fragment = Nokogiri::HTML.fragment(contents)
    fragment.css('a').each do |a|
      href = a['href']
      if href.present? && href.start_with?('/')
        a['href'] = ""#{prefix}/#{href.sub(/^\/+/, '')}""
      end
    end
    fragment.css('img').each do |a|
      src = a['src']
      if src.present? && src.start_with?('/')
        a['src'] = ""#{prefix}/#{src.sub(/^\/+/, '')}""
      end
    end

    fragment.to_html
  end","[Medium] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      SiteSetting.embeddable_host != URI(@embed_url).host
    rescue URI::InvalidURIError
      # An invalid URI is an invalid host
      true
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return fa
---
[Medium] method perform_retrieve in lib/topic_retriever.rb:
def perform_retrieve
      # It's possible another process or job found the embed already. So if that happened bail out.
      return if TopicEmbed.where(embed_url: @embed_url).exists?

      # First check RSS if that is enabled
      if SiteSetting.feed_polling_enabled?
        Jobs::PollFeed.new.execute({})
        return if TopicEmbed.where(embed_url: @embed_url).exists?
      end

      fetch_http
    end
---
[Medium] method execute in app/jobs/regular/retrieve_topic.rb:
def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end
---
[Medium] method change in db/migrate/20131223171005_create_top_topics.rb:
def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{period}_#{sort}_count"".to_sym, order: 'desc'
      en
---
[Medium] method initialize in lib/topic_retriever.rb:
def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end
---
[Medium] method retrieve in lib/topic_retriever.rb:
def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end
---
[Medium] module Jobs in app/jobs/regular/retrieve_topic.rb:
module Jobs

  # Asynchronously retrieve a topic from an embedded site
  class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end

end
---
[Medium] class RetrieveTopic in app/jobs/regular/retrieve_topic.rb:
class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end
---
[Medium] method change in db/migrate/20131217174004_create_topic_embeds.rb:
def change
    create_table :topic_embeds, force: true do |t|
      t.integer :topic_id, null: false
      t.integer :post_id, null: false
      t.string :embed_url, null: false
      t.string :content_sha1, null: false, limit: 40
      t.timestamps
    end

    add_index :topic_embeds, :embed_url, unique: true
  end
---
[Medium] method change in db/migrate/20131219203905_add_cook_method_to_posts.rb:
def change
    add_column :posts, :cook_method, :integer, default: 1, null: false
  end
---
[Medium] chunk lines 481-486 in Gemfile_rails4.lock:
  therubyracer-discourse
  thin
  timecop
  uglifier
  unf
  unicorn
---
[Medium] chunk lines 181-195 in lib/tasks/disqus.thor:
            post = PostCreator.new(post_user, attrs).create
            p[:discourse_number] = post.post_number
          end
          TopicFeaturedUsers.new(post.topic).choose
        end
      end
    end

  ensure
    RateLimiter.enable
    SiteSetting.email_domains_blacklist = email_blacklist
  end
end


---
[Medium] chunk lines 101-120 in Gemfile_rails4.lock:
    fast_xs (0.8.0)
    fastimage (1.5.2)
    ffi (1.9.3)
    flamegraph (0.0.5)
      fast_stack
    fog (1.18.0)
      builder
      excon (~> 0.28.0)
      formatador (~> 0.2.0)
      mime-types
      multi_json (~> 1.0)
      net-scp (~> 1.1)
      net-ssh (>= 2.1.3)
      nokogiri (~> 1.5)
      ruby-hmac
    formatador (0.2.4)
    fspath (2.0.5)
    given_core (3.1.1)
      sorcerer (>= 0.3.7)
    guess_html_encoding (0.0.9)
---
[Medium] chunk lines 361-380 in Gemfile_rails4.lock:
      spork (>= 1.0rc0)
    sprockets (2.10.1)
      hike (~> 1.2)
      multi_json (~> 1.0)
      rack (~> 1.0)
      tilt (~> 1.1, != 1.3.0)
    sprockets-rails (2.0.1)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      sprockets (~> 2.8)
    temple (0.6.7)
    therubyracer-discourse (0.12.0)
      libv8 (~> 3.16.14.0)
      ref
    thin (1.6.1)
      daemons (>= 1.0.9)
      eventmachine (>= 1.0.0)
      rack (>= 1.0.0)
    thor (0.18.1)
    thread_safe (0.1.3)
---
[Medium] chunk lines 401-420 in Gemfile_rails4.lock:
PLATFORMS
  ruby

DEPENDENCIES
  actionpack-action_caching
  active_model_serializers
  airbrake (= 3.1.2)
  annotate
  barber
  better_errors
  binding_of_caller
  certified
  discourse_plugin!
  email_reply_parser-discourse
  ember-rails
  ember-source (~> 1.2.0.1)
  eventmachine
  fabrication
  fakeweb (~> 1.3.0)
  fast_blank
---
[Medium] chunk lines 421-440 in Gemfile_rails4.lock:
  fast_xor
  fast_xs
  fastimage
  flamegraph
  fog (= 1.18.0)
  handlebars-source (~> 1.1.2)
  highline
  hiredis
  html_truncator
  image_optim
  image_sorcery
  librarian (>= 0.0.25)
  listen (= 0.7.3)
  lru_redux
  message_bus
  minitest
  mocha
  mock_redis
  multi_json
  mustache
---
[Medium] chunk lines 181-200 in Gemfile_rails4.lock:
      jwt (~> 0.1.4)
      multi_json (~> 1.0)
      rack (~> 1.2)
    oj (2.2.3)
    omniauth (1.1.4)
      hashie (>= 1.2, < 3)
      rack
    omniauth-browserid-discourse (0.0.2)
      faraday
      multi_json
      omniauth (~> 1.0)
    omniauth-cas (1.0.4)
      addressable (~> 2.3)
      nokogiri (~> 1.6)
      omniauth (~> 1.1.0)
    omniauth-facebook (1.4.1)
      omniauth-oauth2 (~> 1.1.0)
    omniauth-github (1.1.1)
      omniauth (~> 1.0)
      omniauth-oauth2 (~> 1.1)
---
[Medium] chunk lines 201-220 in Gemfile_rails4.lock:
    omniauth-oauth (1.0.1)
      oauth
      omniauth (~> 1.0)
    omniauth-oauth2 (1.1.1)
      oauth2 (~> 0.8.0)
      omniauth (~> 1.0)
    omniauth-openid (1.0.1)
      omniauth (~> 1.0)
      rack-openid (~> 1.3.1)
    omniauth-twitter (1.0.1)
      multi_json (~> 1.3)
      omniauth-oauth (~> 1.0)
    openid-redis-store (0.0.2)
      redis
      ruby-openid
    pg (0.15.1)
    polyglot (0.3.3)
    progress (3.0.0)
    pry (0.9.12.4)
      coderay (~> 1.0)
---
[Medium] chunk lines 261-280 in Gemfile_rails4.lock:
      rake
    rb-fsevent (0.9.3)
    rb-inotify (0.9.2)
      ffi (>= 0.5.0)
    rbtrace (0.4.1)
      ffi (>= 1.0.6)
      msgpack (>= 0.4.3)
      trollop (>= 1.16.2)
    redcarpet (3.0.0)
    redis (3.0.6)
    redis-actionpack (4.0.0)
      actionpack (~> 4)
      redis-rack (~> 1.5.0)
      redis-store (~> 1.1.0)
    redis-activesupport (4.0.0)
      activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-namespace (1.3.2)
      redis (~> 3.0.4)
    redis-rack (1.5.0)
---
[Medium] chunk lines 281-300 in Gemfile_rails4.lock:
      rack (~> 1.5)
      redis-store (~> 1.1.0)
    redis-rails (4.0.0)
      redis-actionpack (~> 4)
      redis-activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-store (1.1.4)
      redis (>= 2.2)
    ref (1.0.5)
    rest-client (1.6.7)
      mime-types (>= 1.16)
    rinku (1.7.3)
    rspec (2.14.1)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    rspec-core (2.14.6)
    rspec-expectations (2.14.3)
      diff-lcs (>= 1.1.3, < 2.0)
 
---
[Medium] chunk lines 121-140 in Gemfile_rails4.lock:
    handlebars-source (1.1.2)
    hashie (2.0.5)
    highline (1.6.20)
    hike (1.2.3)
    hiredis (0.4.5)
    html_truncator (0.3.1)
      nokogiri (~> 1.5)
    httpauth (0.2.0)
    i18n (0.6.9)
    ice_cube (0.11.1)
    image_optim (0.9.1)
      exifr (~> 1.1.3)
      fspath (~> 2.0.5)
      image_size (~> 1.1.2)
      in_threads (~> 1.2.0)
      progress (~> 3.0.0)
    image_size (1.1.3)
    image_sorcery (1.1.0)
    in_threads (1.2.0)
    jquery-rails (3.0.4)
---
[Medium] chunk lines 221-240 in Gemfile_rails4.lock:
      method_source (~> 0.8)
      slop (~> 3.4)
    pry-nav (0.2.3)
      pry (~> 0.9.10)
    pry-rails (0.3.2)
      pry (>= 0.9.10)
    puma (2.6.0)
      rack (>= 1.1, < 2.0)
    qunit-rails (0.0.4)
      railties (>= 3.2.3)
    rack (1.5.2)
    rack-cors (0.2.8)
      rack
    rack-mini-profiler (0.9.0.pre)
      rack (>= 1.1.3)
    rack-openid (1.3.1)
      rack (>= 1.1.0)
      ruby-openid (>= 2.1.8)
    rack-protection (1.5.1)
      rack
---
[Medium] chunk lines 301-320 in Gemfile_rails4.lock:
      given_core (= 3.1.1)
      rspec (>= 2.12)
    rspec-mocks (2.14.4)
    rspec-rails (2.14.0)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      railties (>= 3.0)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    ruby-hmac (0.4.0)
    ruby-openid (2.3.0)
    ruby-readability (0.5.7)
      guess_html_encoding (>= 0.0.4)
      nokogiri (>= 1.4.2)
    sanitize (2.0.6)
      nokogiri (>= 1.4.4)
    sass (3.2.12)
    sass-rails (4.0.1)

---
[Medium] chunk lines 341-360 in Gemfile_rails4.lock:
      celluloid (>= 0.14.1)
      ice_cube (~> 0.11.0)
      sidekiq (~> 2.15.0)
    simple-rss (1.3.1)
    simplecov (0.7.1)
      multi_json (~> 1.0)
      simplecov-html (~> 0.7.1)
    simplecov-html (0.7.1)
    sinatra (1.4.4)
      rack (~> 1.4)
      rack-protection (~> 1.4)
      tilt (~> 1.3, >= 1.3.4)
    slim (2.0.1)
      temple (~> 0.6.6)
      tilt (>= 1.3.3, < 2.1)
    slop (3.4.7)
    sorcerer (1.0.2)
    spork (1.0.0rc4)
    spork-rails (4.0.0)
      rails (>= 3.0.0, < 5)
---
[Medium] chunk lines 161-180 in Gemfile_rails4.lock:
    method_source (0.8.2)
    mime-types (1.25.1)
    mini_portile (0.5.1)
    minitest (4.7.5)
    mocha (0.14.0)
      metaclass (~> 0.0.1)
    mock_redis (0.9.0)
    msgpack (0.5.7)
    multi_json (1.8.2)
    multipart-post (1.2.0)
    mustache (0.99.4)
    net-scp (1.1.2)
      net-ssh (>= 2.6.5)
    net-ssh (2.7.0)
    nokogiri (1.6.0)
      mini_portile (~> 0.5.0)
    oauth (0.4.7)
    oauth2 (0.8.1)
      faraday (~> 0.8)
      httpauth (~> 0.1)
---
[Medium] chunk lines 441-460 in Gemfile_rails4.lock:
  nokogiri
  oj
  omniauth
  omniauth-browserid-discourse
  omniauth-cas
  omniauth-facebook
  omniauth-github
  omniauth-oauth2
  omniauth-openid
  omniauth-twitter
  openid-redis-store
  pg (= 0.15.1)
  pry-nav
  pry-rails
  puma
  qunit-rails
  rack-cors
  rack-mini-profiler (= 0.9.0.pre)
  rack-protection
  rails
---
[Medium] chunk lines 141-160 in Gemfile_rails4.lock:
      railties (>= 3.0, < 5.0)
      thor (>= 0.14, < 2.0)
    json (1.8.1)
    jwt (0.1.8)
      multi_json (>= 1.5)
    kgio (2.8.1)
    librarian (0.1.1)
      highline
      thor (~> 0.15)
    libv8 (3.16.14.3)
    listen (0.7.3)
    lru_redux (0.8.1)
    mail (2.5.4)
      mime-types (~> 1.16)
      treetop (~> 1.4.8)
    message_bus (0.9.3.2)
      eventmachine
      rack (>= 1.1.3)
      redis
    metaclass (0.0.1)
---
[Medium] chunk lines 381-400 in Gemfile_rails4.lock:
      atomic
    tilt (1.4.1)
    timecop (0.6.3)
    timers (1.1.0)
    treetop (1.4.15)
      polyglot
      polyglot (>= 0.3.1)
    trollop (2.0)
    tzinfo (0.3.38)
    uglifier (2.3.3)
      execjs (>= 0.3.0)
      json (>= 1.8.0)
    unf (0.1.3)
      unf_ext
    unf_ext (0.0.6)
    unicorn (4.7.0)
      kgio (~> 2.6)
      rack
      raindrops (~> 0.7)

---
[Medium] chunk lines 321-340 in Gemfile_rails4.lock:
      sass (>= 3.1.10)
      sprockets-rails (~> 2.0.0)
    seed-fu-discourse (2.2.0)
      activerecord (>= 3.1, < 4.1)
      activesupport (>= 3.1, < 4.1)
    shoulda (3.5.0)
      shoulda-context (~> 1.0, >= 1.0.1)
      shoulda-matchers (>= 1.4.1, < 3.0)
    shoulda-context (1.1.5)
    shoulda-matchers (2.4.0)
      activesupport (>= 3.0.0)
    sidekiq (2.15.1)
      celluloid (>= 0.15.1)
      connection_pool (>= 1.0.0)
      json
      redis (>= 3.0.4)
      redis-namespace (>= 1.3.1)
    
---
[Medium] chunk lines 241-260 in Gemfile_rails4.lock:
    rack-test (0.6.2)
      rack (>= 1.0)
    rails (4.0.2)
      actionmailer (= 4.0.2)
      actionpack (= 4.0.2)
      activerecord (= 4.0.2)
      activesupport (= 4.0.2)
      bundler (>= 1.3.0, < 2.0)
      railties (= 4.0.2)
      sprockets-rails (~> 2.0.0)
    rails-observers (0.1.2)
      activemodel (~> 4.0)
    railties (4.0.2)
      actionpack (= 4.0.2)
      activesupport (= 4.0.2)
      rake (>= 0.8.7)
      thor (>= 0.18.1, < 2.0)
    raindrops (0.12.0)
    rake (10.1.0)
    rake-
---
[Medium] chunk lines 461-480 in Gemfile_rails4.lock:
  rails-observers
  rails_multisite!
  rake
  rb-fsevent
  rb-inotify (~> 0.9)
  rbtrace
  redcarpet
  redis
  redis-rails
  rest-client
  rinku
  rspec-given
  rspec-rails
  ruby-readability
  sanitize
  sass
  sass-rails
  seed-fu-discourse
  shoulda
  sidekiq (= 2.15.1)
---
[Medium] section en in config/locales/server.en.yml:
en:
  dates:
    short_date_no_year: ""D MMM""
    short_date: ""D MMM, YYYY""
    long_date: ""MMMM D, YYYY h:mma""
  time:
    formats:
      short: ""%m-%d-%Y""
      short_no_year: ""%B %-d""
      date_only: ""%b %-d, %Y""

  title: ""Discourse""
  topics: ""Topics""
  posts: ""posts""
  loading: ""Loading""
  powered_by_html: 'Powered by <a href=""http://www.discourse.org"">Discourse</a>, best viewed with JavaScript enabled'

  via: ""%{username} via %{site_name}""
  is_reserved: ""is reserved""

  site_under_maint
---
[Medium] class CreateTopTopics in db/migrate/20131223171005_create_top_topics.rb:
class CreateTopTopics < ActiveRecord::Migration
  def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{per
---
[Medium] chunk lines 141-160 in lib/tasks/disqus.thor:
    SiteSetting.email_domains_blacklist = """"

    parser.threads.each do |id, t|
      puts ""Creating #{t[:title]}... (#{t[:posts].size} posts)""

      if options[:dry_run].blank?

        post = TopicEmbed.import_remote(user, t[:link], title: t[:title])
        if post.present?
          t[:posts].each do |p|
            post_user = user
            if p[:author_email]
              email = Email.downcase(p[:author_email])
              post_user = User.where(email: email).first
              i
---
[Medium] chunk lines 161-180 in lib/tasks/disqus.thor:
              topic_id: post.topic_id,
              raw: p[:cooked],
              cooked: p[:cooked],
              created_at: Date.parse(p[:created_at])
            }

            if p[:parent_id]
              parent = parser.posts[p[:parent_id]]
              if parent && parent[:discourse_number]
                attrs[:reply_to_post_number] = parent[:discourse_number]
              end
            end

            post = PostCreator.new(post_user, attrs).create
            p[:discourse_nu
---
[Medium] chunk lines 101-120 in lib/tasks/disqus.thor:
        existing[:posts] << t[:posts]
        existing[:posts].flatten!
        @threads.delete(t[:id])
      end
    end


  end
end

class Disqus < Thor
  desc ""import"", ""Imports posts from a Disqus XML export""
  method_option :file, aliases: '-f', required: true, desc: ""The disqus XML file to import""
  method_option :dry_run, required: false, desc: ""Just output what will be imported rather than doing it""
  method_option :post_as, aliases: '-p', required: true, desc: ""The Discourse username to","PostCreator (Critical), PostRevisor (Critical), Post (Critical), TopicEmbed (Critical), cook_methods (Critical), import_remote (High), cook (High), setup_post (High), update_post (High), topic_id_for_embed (High), absolutize_urls (High), TopicRetriever (Medium), perform_retrieve (Medium), execute (Medium), change (Medium), initialize (Medium), retrieve (Medium), Jobs (Medium), RetrieveTopic (Medium), change (Medium), change (Medium), lines 481-486 (Medium), lines 181-195 (Medium), lines 101-120 (Medium), lines 361-380 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 121-140 (Medium), lines 221-240 (Medium), lines 301-320 (Medium), lines 341-360 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 141-160 (Medium), lines 381-400 (Medium), lines 321-340 (Medium), lines 241-260 (Medium), lines 461-480 (Medium), en (Medium), CreateTopTopics (Medium), lines 141-160 (Medium), lines 161-180 (Medium), lines 101-120 (Medium), lines 201-219 (Low), lines 481-493 (Low), comments (Low), postMessageReceived (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-69 (Low), EmbedController (Low), best (Low), ensure_embeddable (Low), Jobs (Low), PollFeed (Low), execute (Low), feed_key (Low), poll_feed (Low), import (Low), lines 1-20 (Low), lines 21-30 (Low), lines 1-12 (Low), lines 1-20 (Low), embedding (Low), CreateTopicEmbeds (Low), AddCookMethodToPosts (Low), lines 181-188 (Low), invalid_host? (Low), retrieved_recently? (Low), fetch_http (Low), lines 121-140 (Low), MigrateWordCounts (Low), revise! (Low)",partial,"postMessage is in JS embed code, not in the Ruby models flagged as HC"
discourse,4,Enhance embed URL handling and validation system,"The code sets X-Frame-Options: ALLOWALL which completely disables clickjacking protection. The referer validation can be bypassed (referer headers are easily spoofed), and the fallback to empty string for nil referer masks validation failures.",Medium,78,11,36,"class::PostCreator (lib/post_creator.rb) [Critical, score=1.00] | class::PostRevisor (lib/post_revisor.rb) [Critical, score=1.00] | class::Post (app/models/post.rb) [Critical, score=0.94] | class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.90] | method::cook_methods (app/models/post.rb) [Critical, score=0.87] | method::import_remote (app/models/topic_embed.rb) [High, score=0.64] | method::cook (app/models/post.rb) [High, score=0.60] | method::setup_post (lib/post_creator.rb) [High, score=0.60] | method::update_post (lib/post_revisor.rb) [High, score=0.60] | method::topic_id_for_embed (app/models/topic_embed.rb) [High, score=0.58] | method::absolutize_urls (app/models/topic_embed.rb) [High, score=0.54]","[Critical] class PostCreator in lib/post_creator.rb:
class PostCreator

  attr_reader :errors, :opts

  # Acceptable options:
  #
  #   raw                     - raw text of post
  #   image_sizes             - We can pass a list of the sizes of images in the post as a shortcut.
  #   invalidate_oneboxes     - Whether to force invalidation of oneboxes in this post
  #   acting_user             - The user performing the action might be different than the user
  #                             who is the post ""author."" For example when copying posts to a new
  #                             topic.
  #   created_at              - Post creation time (optional)
  #   auto_track              - Automatically track this topic if needed (default true)
  #
  #   When replying to a topic:
  #     topic_id              - topic we're replying to
  #     rep
---
[Critical] class PostRevisor in lib/post_revisor.rb:
class PostRevisor

  attr_reader :category_changed

  def initialize(post)
    @post = post
  end

  def revise!(user, new_raw, opts = {})
    @user, @new_raw, @opts = user, new_raw, opts
    return false if not should_revise?
    @post.acting_user = @user
    revise_post
    update_category_description
    post_process_post
    update_topic_word_counts
    @post.advance_draft_sequence

    true
  end

  private

  def should_revise?
    @post.raw != @new_raw
  end

  def revise_post
    if should_create_new_version?
      revise_and_create_new_version
    else
      update_post
    end
  end

  def get_revised_at
    @opts[:revised_at] || Time.now
  end

  def should_create_new_version?
    @post.last_editor_id != @user.id ||
    get_revised_at - @post.last_version_at > SiteSetting.ninja_
---
[Critical] class Post in app/models/post.rb:
class Post < ActiveRecord::Base
  include RateLimiter::OnCreateRecord
  include Trashable

  rate_limit
  rate_limit :limit_posts_per_day

  belongs_to :user
  belongs_to :topic, counter_cache: :posts_count
  belongs_to :reply_to_user, class_name: ""User""

  has_many :post_replies
  has_many :replies, through: :post_replies
  has_many :post_actions
  has_many :topic_links

  has_many :post_uploads
  has_many :uploads, through: :post_uploads

  has_one :post_search_data

  has_many :post_details

  has_many :post_revisions
  has_many :revisions, foreign_key: :post_id, class_name: 'PostRevision'

  validates_with ::Validators::PostValidator

  # We can pass several creating options to a post via attributes
  attr_accessor :image_sizes, :quoted_post_numbers, :no_bump, :invalidate_oneboxes, :co
---
[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_presence_of :content_sha1

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    contents << ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""

    embed = TopicEmbed.where(embed_url: url).first
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transaction do
        creator = PostCreator.new(user, title: title, raw: absolutize_urls(url, contents), skip_validations: true, cook_method: Post.cook_methods[:raw_html])
      
---
[Critical] method cook_methods in app/models/post.rb:
def self.cook_methods
    @cook_methods ||= Enum.new(:regular, :raw_html)
  end
---
[High] method import_remote in app/models/topic_embed.rb:
def self.import_remote(user, url, opts=nil)
    require 'ruby-readability'

    opts = opts || {}
    doc = Readability::Document.new(open(url).read,
                                        tags: %w[div p code pre h1 h2 h3 b em i strong a img],
                                        attributes: %w[href src])

    TopicEmbed.import(user, url, opts[:title] || doc.title, doc.content)
  end
---
[High] method cook in app/models/post.rb:
def cook(*args)
    # For some posts, for example those imported via RSS, we support raw HTML. In that
    # case we can skip the rendering pipeline.
    return raw if cook_method == Post.cook_methods[:raw_html]

    # Default is to cook posts
    Plugin::Filter.apply(:after_post_cook, self, post_analyzer.cook(*args))
  end
---
[High] method setup_post in lib/post_creator.rb:
def setup_post
    post = @topic.posts.new(raw: @opts[:raw],
                            user: @user,
                            reply_to_post_number: @opts[:reply_to_post_number])

    # Attributes we pass through to the post instance if present
    [:post_type, :no_bump, :cooking_options, :image_sizes, :acting_user, :invalidate_oneboxes].each do |a|
      post.send(""#{a}="", @opts[a]) if @opts[a].present?
    end

    post.cook_method = @opts[:cook_method] if @opts[:cook_method].present?
    post.extract_quoted_post_numbers
    post.created_at = Time.zone.parse(@opts[:created_at].to_s) if @opts[:created_at].present?
    @post = post
  end
---
[High] method update_post in lib/post_revisor.rb:
def update_post
    @post.raw = @new_raw
    @post.word_count = @new_raw.scan(/\w+/).size
    @post.last_editor_id = @user.id
    @post.edit_reason = @opts[:edit_reason] if @opts[:edit_reason]

    if @post.hidden && @post.hidden_reason_id == Post.hidden_reasons[:flag_threshold_reached]
      @post.hidden = false
      @post.hidden_reason_id = nil
      @post.topic.update_attributes(visible: true)

      PostAction.clear_flags!(@post, -1)
    end

    @post.extract_quoted_post_numbers
    @post.save(validate: !@opts[:skip_validations])

    @post.save_reply_relationships
  end
---
[High] method topic_id_for_embed in app/models/topic_embed.rb:
def self.topic_id_for_embed(embed_url)
    TopicEmbed.where(embed_url: embed_url).pluck(:topic_id).first
  end
---
[High] method absolutize_urls in app/models/topic_embed.rb:
def self.absolutize_urls(url, contents)
    uri = URI(url)
    prefix = ""#{uri.scheme}://#{uri.host}""
    prefix << "":#{uri.port}"" if uri.port != 80 && uri.port != 443

    fragment = Nokogiri::HTML.fragment(contents)
    fragment.css('a').each do |a|
      href = a['href']
      if href.present? && href.start_with?('/')
        a['href'] = ""#{prefix}/#{href.sub(/^\/+/, '')}""
      end
    end
    fragment.css('img').each do |a|
      src = a['src']
      if src.present? && src.start_with?('/')
        a['src'] = ""#{prefix}/#{src.sub(/^\/+/, '')}""
      end
    end

    fragment.to_html
  end","[Medium] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      SiteSetting.embeddable_host != URI(@embed_url).host
    rescue URI::InvalidURIError
      # An invalid URI is an invalid host
      true
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return fa
---
[Medium] method perform_retrieve in lib/topic_retriever.rb:
def perform_retrieve
      # It's possible another process or job found the embed already. So if that happened bail out.
      return if TopicEmbed.where(embed_url: @embed_url).exists?

      # First check RSS if that is enabled
      if SiteSetting.feed_polling_enabled?
        Jobs::PollFeed.new.execute({})
        return if TopicEmbed.where(embed_url: @embed_url).exists?
      end

      fetch_http
    end
---
[Medium] method execute in app/jobs/regular/retrieve_topic.rb:
def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end
---
[Medium] method change in db/migrate/20131223171005_create_top_topics.rb:
def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{period}_#{sort}_count"".to_sym, order: 'desc'
      en
---
[Medium] method initialize in lib/topic_retriever.rb:
def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end
---
[Medium] method retrieve in lib/topic_retriever.rb:
def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end
---
[Medium] module Jobs in app/jobs/regular/retrieve_topic.rb:
module Jobs

  # Asynchronously retrieve a topic from an embedded site
  class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end

end
---
[Medium] class RetrieveTopic in app/jobs/regular/retrieve_topic.rb:
class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end
---
[Medium] method change in db/migrate/20131217174004_create_topic_embeds.rb:
def change
    create_table :topic_embeds, force: true do |t|
      t.integer :topic_id, null: false
      t.integer :post_id, null: false
      t.string :embed_url, null: false
      t.string :content_sha1, null: false, limit: 40
      t.timestamps
    end

    add_index :topic_embeds, :embed_url, unique: true
  end
---
[Medium] method change in db/migrate/20131219203905_add_cook_method_to_posts.rb:
def change
    add_column :posts, :cook_method, :integer, default: 1, null: false
  end
---
[Medium] chunk lines 481-486 in Gemfile_rails4.lock:
  therubyracer-discourse
  thin
  timecop
  uglifier
  unf
  unicorn
---
[Medium] chunk lines 181-195 in lib/tasks/disqus.thor:
            post = PostCreator.new(post_user, attrs).create
            p[:discourse_number] = post.post_number
          end
          TopicFeaturedUsers.new(post.topic).choose
        end
      end
    end

  ensure
    RateLimiter.enable
    SiteSetting.email_domains_blacklist = email_blacklist
  end
end


---
[Medium] chunk lines 101-120 in Gemfile_rails4.lock:
    fast_xs (0.8.0)
    fastimage (1.5.2)
    ffi (1.9.3)
    flamegraph (0.0.5)
      fast_stack
    fog (1.18.0)
      builder
      excon (~> 0.28.0)
      formatador (~> 0.2.0)
      mime-types
      multi_json (~> 1.0)
      net-scp (~> 1.1)
      net-ssh (>= 2.1.3)
      nokogiri (~> 1.5)
      ruby-hmac
    formatador (0.2.4)
    fspath (2.0.5)
    given_core (3.1.1)
      sorcerer (>= 0.3.7)
    guess_html_encoding (0.0.9)
---
[Medium] chunk lines 361-380 in Gemfile_rails4.lock:
      spork (>= 1.0rc0)
    sprockets (2.10.1)
      hike (~> 1.2)
      multi_json (~> 1.0)
      rack (~> 1.0)
      tilt (~> 1.1, != 1.3.0)
    sprockets-rails (2.0.1)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      sprockets (~> 2.8)
    temple (0.6.7)
    therubyracer-discourse (0.12.0)
      libv8 (~> 3.16.14.0)
      ref
    thin (1.6.1)
      daemons (>= 1.0.9)
      eventmachine (>= 1.0.0)
      rack (>= 1.0.0)
    thor (0.18.1)
    thread_safe (0.1.3)
---
[Medium] chunk lines 401-420 in Gemfile_rails4.lock:
PLATFORMS
  ruby

DEPENDENCIES
  actionpack-action_caching
  active_model_serializers
  airbrake (= 3.1.2)
  annotate
  barber
  better_errors
  binding_of_caller
  certified
  discourse_plugin!
  email_reply_parser-discourse
  ember-rails
  ember-source (~> 1.2.0.1)
  eventmachine
  fabrication
  fakeweb (~> 1.3.0)
  fast_blank
---
[Medium] chunk lines 421-440 in Gemfile_rails4.lock:
  fast_xor
  fast_xs
  fastimage
  flamegraph
  fog (= 1.18.0)
  handlebars-source (~> 1.1.2)
  highline
  hiredis
  html_truncator
  image_optim
  image_sorcery
  librarian (>= 0.0.25)
  listen (= 0.7.3)
  lru_redux
  message_bus
  minitest
  mocha
  mock_redis
  multi_json
  mustache
---
[Medium] chunk lines 181-200 in Gemfile_rails4.lock:
      jwt (~> 0.1.4)
      multi_json (~> 1.0)
      rack (~> 1.2)
    oj (2.2.3)
    omniauth (1.1.4)
      hashie (>= 1.2, < 3)
      rack
    omniauth-browserid-discourse (0.0.2)
      faraday
      multi_json
      omniauth (~> 1.0)
    omniauth-cas (1.0.4)
      addressable (~> 2.3)
      nokogiri (~> 1.6)
      omniauth (~> 1.1.0)
    omniauth-facebook (1.4.1)
      omniauth-oauth2 (~> 1.1.0)
    omniauth-github (1.1.1)
      omniauth (~> 1.0)
      omniauth-oauth2 (~> 1.1)
---
[Medium] chunk lines 201-220 in Gemfile_rails4.lock:
    omniauth-oauth (1.0.1)
      oauth
      omniauth (~> 1.0)
    omniauth-oauth2 (1.1.1)
      oauth2 (~> 0.8.0)
      omniauth (~> 1.0)
    omniauth-openid (1.0.1)
      omniauth (~> 1.0)
      rack-openid (~> 1.3.1)
    omniauth-twitter (1.0.1)
      multi_json (~> 1.3)
      omniauth-oauth (~> 1.0)
    openid-redis-store (0.0.2)
      redis
      ruby-openid
    pg (0.15.1)
    polyglot (0.3.3)
    progress (3.0.0)
    pry (0.9.12.4)
      coderay (~> 1.0)
---
[Medium] chunk lines 261-280 in Gemfile_rails4.lock:
      rake
    rb-fsevent (0.9.3)
    rb-inotify (0.9.2)
      ffi (>= 0.5.0)
    rbtrace (0.4.1)
      ffi (>= 1.0.6)
      msgpack (>= 0.4.3)
      trollop (>= 1.16.2)
    redcarpet (3.0.0)
    redis (3.0.6)
    redis-actionpack (4.0.0)
      actionpack (~> 4)
      redis-rack (~> 1.5.0)
      redis-store (~> 1.1.0)
    redis-activesupport (4.0.0)
      activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-namespace (1.3.2)
      redis (~> 3.0.4)
    redis-rack (1.5.0)
---
[Medium] chunk lines 281-300 in Gemfile_rails4.lock:
      rack (~> 1.5)
      redis-store (~> 1.1.0)
    redis-rails (4.0.0)
      redis-actionpack (~> 4)
      redis-activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-store (1.1.4)
      redis (>= 2.2)
    ref (1.0.5)
    rest-client (1.6.7)
      mime-types (>= 1.16)
    rinku (1.7.3)
    rspec (2.14.1)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    rspec-core (2.14.6)
    rspec-expectations (2.14.3)
      diff-lcs (>= 1.1.3, < 2.0)
 
---
[Medium] chunk lines 121-140 in Gemfile_rails4.lock:
    handlebars-source (1.1.2)
    hashie (2.0.5)
    highline (1.6.20)
    hike (1.2.3)
    hiredis (0.4.5)
    html_truncator (0.3.1)
      nokogiri (~> 1.5)
    httpauth (0.2.0)
    i18n (0.6.9)
    ice_cube (0.11.1)
    image_optim (0.9.1)
      exifr (~> 1.1.3)
      fspath (~> 2.0.5)
      image_size (~> 1.1.2)
      in_threads (~> 1.2.0)
      progress (~> 3.0.0)
    image_size (1.1.3)
    image_sorcery (1.1.0)
    in_threads (1.2.0)
    jquery-rails (3.0.4)
---
[Medium] chunk lines 221-240 in Gemfile_rails4.lock:
      method_source (~> 0.8)
      slop (~> 3.4)
    pry-nav (0.2.3)
      pry (~> 0.9.10)
    pry-rails (0.3.2)
      pry (>= 0.9.10)
    puma (2.6.0)
      rack (>= 1.1, < 2.0)
    qunit-rails (0.0.4)
      railties (>= 3.2.3)
    rack (1.5.2)
    rack-cors (0.2.8)
      rack
    rack-mini-profiler (0.9.0.pre)
      rack (>= 1.1.3)
    rack-openid (1.3.1)
      rack (>= 1.1.0)
      ruby-openid (>= 2.1.8)
    rack-protection (1.5.1)
      rack
---
[Medium] chunk lines 301-320 in Gemfile_rails4.lock:
      given_core (= 3.1.1)
      rspec (>= 2.12)
    rspec-mocks (2.14.4)
    rspec-rails (2.14.0)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      railties (>= 3.0)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    ruby-hmac (0.4.0)
    ruby-openid (2.3.0)
    ruby-readability (0.5.7)
      guess_html_encoding (>= 0.0.4)
      nokogiri (>= 1.4.2)
    sanitize (2.0.6)
      nokogiri (>= 1.4.4)
    sass (3.2.12)
    sass-rails (4.0.1)

---
[Medium] chunk lines 341-360 in Gemfile_rails4.lock:
      celluloid (>= 0.14.1)
      ice_cube (~> 0.11.0)
      sidekiq (~> 2.15.0)
    simple-rss (1.3.1)
    simplecov (0.7.1)
      multi_json (~> 1.0)
      simplecov-html (~> 0.7.1)
    simplecov-html (0.7.1)
    sinatra (1.4.4)
      rack (~> 1.4)
      rack-protection (~> 1.4)
      tilt (~> 1.3, >= 1.3.4)
    slim (2.0.1)
      temple (~> 0.6.6)
      tilt (>= 1.3.3, < 2.1)
    slop (3.4.7)
    sorcerer (1.0.2)
    spork (1.0.0rc4)
    spork-rails (4.0.0)
      rails (>= 3.0.0, < 5)
---
[Medium] chunk lines 161-180 in Gemfile_rails4.lock:
    method_source (0.8.2)
    mime-types (1.25.1)
    mini_portile (0.5.1)
    minitest (4.7.5)
    mocha (0.14.0)
      metaclass (~> 0.0.1)
    mock_redis (0.9.0)
    msgpack (0.5.7)
    multi_json (1.8.2)
    multipart-post (1.2.0)
    mustache (0.99.4)
    net-scp (1.1.2)
      net-ssh (>= 2.6.5)
    net-ssh (2.7.0)
    nokogiri (1.6.0)
      mini_portile (~> 0.5.0)
    oauth (0.4.7)
    oauth2 (0.8.1)
      faraday (~> 0.8)
      httpauth (~> 0.1)
---
[Medium] chunk lines 441-460 in Gemfile_rails4.lock:
  nokogiri
  oj
  omniauth
  omniauth-browserid-discourse
  omniauth-cas
  omniauth-facebook
  omniauth-github
  omniauth-oauth2
  omniauth-openid
  omniauth-twitter
  openid-redis-store
  pg (= 0.15.1)
  pry-nav
  pry-rails
  puma
  qunit-rails
  rack-cors
  rack-mini-profiler (= 0.9.0.pre)
  rack-protection
  rails
---
[Medium] chunk lines 141-160 in Gemfile_rails4.lock:
      railties (>= 3.0, < 5.0)
      thor (>= 0.14, < 2.0)
    json (1.8.1)
    jwt (0.1.8)
      multi_json (>= 1.5)
    kgio (2.8.1)
    librarian (0.1.1)
      highline
      thor (~> 0.15)
    libv8 (3.16.14.3)
    listen (0.7.3)
    lru_redux (0.8.1)
    mail (2.5.4)
      mime-types (~> 1.16)
      treetop (~> 1.4.8)
    message_bus (0.9.3.2)
      eventmachine
      rack (>= 1.1.3)
      redis
    metaclass (0.0.1)
---
[Medium] chunk lines 381-400 in Gemfile_rails4.lock:
      atomic
    tilt (1.4.1)
    timecop (0.6.3)
    timers (1.1.0)
    treetop (1.4.15)
      polyglot
      polyglot (>= 0.3.1)
    trollop (2.0)
    tzinfo (0.3.38)
    uglifier (2.3.3)
      execjs (>= 0.3.0)
      json (>= 1.8.0)
    unf (0.1.3)
      unf_ext
    unf_ext (0.0.6)
    unicorn (4.7.0)
      kgio (~> 2.6)
      rack
      raindrops (~> 0.7)

---
[Medium] chunk lines 321-340 in Gemfile_rails4.lock:
      sass (>= 3.1.10)
      sprockets-rails (~> 2.0.0)
    seed-fu-discourse (2.2.0)
      activerecord (>= 3.1, < 4.1)
      activesupport (>= 3.1, < 4.1)
    shoulda (3.5.0)
      shoulda-context (~> 1.0, >= 1.0.1)
      shoulda-matchers (>= 1.4.1, < 3.0)
    shoulda-context (1.1.5)
    shoulda-matchers (2.4.0)
      activesupport (>= 3.0.0)
    sidekiq (2.15.1)
      celluloid (>= 0.15.1)
      connection_pool (>= 1.0.0)
      json
      redis (>= 3.0.4)
      redis-namespace (>= 1.3.1)
    
---
[Medium] chunk lines 241-260 in Gemfile_rails4.lock:
    rack-test (0.6.2)
      rack (>= 1.0)
    rails (4.0.2)
      actionmailer (= 4.0.2)
      actionpack (= 4.0.2)
      activerecord (= 4.0.2)
      activesupport (= 4.0.2)
      bundler (>= 1.3.0, < 2.0)
      railties (= 4.0.2)
      sprockets-rails (~> 2.0.0)
    rails-observers (0.1.2)
      activemodel (~> 4.0)
    railties (4.0.2)
      actionpack (= 4.0.2)
      activesupport (= 4.0.2)
      rake (>= 0.8.7)
      thor (>= 0.18.1, < 2.0)
    raindrops (0.12.0)
    rake (10.1.0)
    rake-
---
[Medium] chunk lines 461-480 in Gemfile_rails4.lock:
  rails-observers
  rails_multisite!
  rake
  rb-fsevent
  rb-inotify (~> 0.9)
  rbtrace
  redcarpet
  redis
  redis-rails
  rest-client
  rinku
  rspec-given
  rspec-rails
  ruby-readability
  sanitize
  sass
  sass-rails
  seed-fu-discourse
  shoulda
  sidekiq (= 2.15.1)
---
[Medium] section en in config/locales/server.en.yml:
en:
  dates:
    short_date_no_year: ""D MMM""
    short_date: ""D MMM, YYYY""
    long_date: ""MMMM D, YYYY h:mma""
  time:
    formats:
      short: ""%m-%d-%Y""
      short_no_year: ""%B %-d""
      date_only: ""%b %-d, %Y""

  title: ""Discourse""
  topics: ""Topics""
  posts: ""posts""
  loading: ""Loading""
  powered_by_html: 'Powered by <a href=""http://www.discourse.org"">Discourse</a>, best viewed with JavaScript enabled'

  via: ""%{username} via %{site_name}""
  is_reserved: ""is reserved""

  site_under_maint
---
[Medium] class CreateTopTopics in db/migrate/20131223171005_create_top_topics.rb:
class CreateTopTopics < ActiveRecord::Migration
  def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{per
---
[Medium] chunk lines 141-160 in lib/tasks/disqus.thor:
    SiteSetting.email_domains_blacklist = """"

    parser.threads.each do |id, t|
      puts ""Creating #{t[:title]}... (#{t[:posts].size} posts)""

      if options[:dry_run].blank?

        post = TopicEmbed.import_remote(user, t[:link], title: t[:title])
        if post.present?
          t[:posts].each do |p|
            post_user = user
            if p[:author_email]
              email = Email.downcase(p[:author_email])
              post_user = User.where(email: email).first
              i
---
[Medium] chunk lines 161-180 in lib/tasks/disqus.thor:
              topic_id: post.topic_id,
              raw: p[:cooked],
              cooked: p[:cooked],
              created_at: Date.parse(p[:created_at])
            }

            if p[:parent_id]
              parent = parser.posts[p[:parent_id]]
              if parent && parent[:discourse_number]
                attrs[:reply_to_post_number] = parent[:discourse_number]
              end
            end

            post = PostCreator.new(post_user, attrs).create
            p[:discourse_nu
---
[Medium] chunk lines 101-120 in lib/tasks/disqus.thor:
        existing[:posts] << t[:posts]
        existing[:posts].flatten!
        @threads.delete(t[:id])
      end
    end


  end
end

class Disqus < Thor
  desc ""import"", ""Imports posts from a Disqus XML export""
  method_option :file, aliases: '-f', required: true, desc: ""The disqus XML file to import""
  method_option :dry_run, required: false, desc: ""Just output what will be imported rather than doing it""
  method_option :post_as, aliases: '-p', required: true, desc: ""The Discourse username to","PostCreator (Critical), PostRevisor (Critical), Post (Critical), TopicEmbed (Critical), cook_methods (Critical), import_remote (High), cook (High), setup_post (High), update_post (High), topic_id_for_embed (High), absolutize_urls (High), TopicRetriever (Medium), perform_retrieve (Medium), execute (Medium), change (Medium), initialize (Medium), retrieve (Medium), Jobs (Medium), RetrieveTopic (Medium), change (Medium), change (Medium), lines 481-486 (Medium), lines 181-195 (Medium), lines 101-120 (Medium), lines 361-380 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 121-140 (Medium), lines 221-240 (Medium), lines 301-320 (Medium), lines 341-360 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 141-160 (Medium), lines 381-400 (Medium), lines 321-340 (Medium), lines 241-260 (Medium), lines 461-480 (Medium), en (Medium), CreateTopTopics (Medium), lines 141-160 (Medium), lines 161-180 (Medium), lines 101-120 (Medium), lines 201-219 (Low), lines 481-493 (Low), comments (Low), postMessageReceived (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-69 (Low), EmbedController (Low), best (Low), ensure_embeddable (Low), Jobs (Low), PollFeed (Low), execute (Low), feed_key (Low), poll_feed (Low), import (Low), lines 1-20 (Low), lines 21-30 (Low), lines 1-12 (Low), lines 1-20 (Low), embedding (Low), CreateTopicEmbeds (Low), AddCookMethodToPosts (Low), lines 181-188 (Low), invalid_host? (Low), retrieved_recently? (Low), fetch_http (Low), lines 121-140 (Low), MigrateWordCounts (Low), revise! (Low)",partial,"X-Frame-Options is in controller/middleware, not in the model classes flagged as HC"
discourse,4,Enhance embed URL handling and validation system,"The TopicEmbed.import method is susceptible to a NoMethodError if the contents parameter is nil when attempting to append a string, and an XSS vulnerability due to unescaped url interpolation in the generated HTML.",Medium,78,11,36,"class::PostCreator (lib/post_creator.rb) [Critical, score=1.00] | class::PostRevisor (lib/post_revisor.rb) [Critical, score=1.00] | class::Post (app/models/post.rb) [Critical, score=0.94] | class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.90] | method::cook_methods (app/models/post.rb) [Critical, score=0.87] | method::import_remote (app/models/topic_embed.rb) [High, score=0.64] | method::cook (app/models/post.rb) [High, score=0.60] | method::setup_post (lib/post_creator.rb) [High, score=0.60] | method::update_post (lib/post_revisor.rb) [High, score=0.60] | method::topic_id_for_embed (app/models/topic_embed.rb) [High, score=0.58] | method::absolutize_urls (app/models/topic_embed.rb) [High, score=0.54]","[Critical] class PostCreator in lib/post_creator.rb:
class PostCreator

  attr_reader :errors, :opts

  # Acceptable options:
  #
  #   raw                     - raw text of post
  #   image_sizes             - We can pass a list of the sizes of images in the post as a shortcut.
  #   invalidate_oneboxes     - Whether to force invalidation of oneboxes in this post
  #   acting_user             - The user performing the action might be different than the user
  #                             who is the post ""author."" For example when copying posts to a new
  #                             topic.
  #   created_at              - Post creation time (optional)
  #   auto_track              - Automatically track this topic if needed (default true)
  #
  #   When replying to a topic:
  #     topic_id              - topic we're replying to
  #     rep
---
[Critical] class PostRevisor in lib/post_revisor.rb:
class PostRevisor

  attr_reader :category_changed

  def initialize(post)
    @post = post
  end

  def revise!(user, new_raw, opts = {})
    @user, @new_raw, @opts = user, new_raw, opts
    return false if not should_revise?
    @post.acting_user = @user
    revise_post
    update_category_description
    post_process_post
    update_topic_word_counts
    @post.advance_draft_sequence

    true
  end

  private

  def should_revise?
    @post.raw != @new_raw
  end

  def revise_post
    if should_create_new_version?
      revise_and_create_new_version
    else
      update_post
    end
  end

  def get_revised_at
    @opts[:revised_at] || Time.now
  end

  def should_create_new_version?
    @post.last_editor_id != @user.id ||
    get_revised_at - @post.last_version_at > SiteSetting.ninja_
---
[Critical] class Post in app/models/post.rb:
class Post < ActiveRecord::Base
  include RateLimiter::OnCreateRecord
  include Trashable

  rate_limit
  rate_limit :limit_posts_per_day

  belongs_to :user
  belongs_to :topic, counter_cache: :posts_count
  belongs_to :reply_to_user, class_name: ""User""

  has_many :post_replies
  has_many :replies, through: :post_replies
  has_many :post_actions
  has_many :topic_links

  has_many :post_uploads
  has_many :uploads, through: :post_uploads

  has_one :post_search_data

  has_many :post_details

  has_many :post_revisions
  has_many :revisions, foreign_key: :post_id, class_name: 'PostRevision'

  validates_with ::Validators::PostValidator

  # We can pass several creating options to a post via attributes
  attr_accessor :image_sizes, :quoted_post_numbers, :no_bump, :invalidate_oneboxes, :co
---
[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_presence_of :content_sha1

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    contents << ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""

    embed = TopicEmbed.where(embed_url: url).first
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transaction do
        creator = PostCreator.new(user, title: title, raw: absolutize_urls(url, contents), skip_validations: true, cook_method: Post.cook_methods[:raw_html])
      
---
[Critical] method cook_methods in app/models/post.rb:
def self.cook_methods
    @cook_methods ||= Enum.new(:regular, :raw_html)
  end
---
[High] method import_remote in app/models/topic_embed.rb:
def self.import_remote(user, url, opts=nil)
    require 'ruby-readability'

    opts = opts || {}
    doc = Readability::Document.new(open(url).read,
                                        tags: %w[div p code pre h1 h2 h3 b em i strong a img],
                                        attributes: %w[href src])

    TopicEmbed.import(user, url, opts[:title] || doc.title, doc.content)
  end
---
[High] method cook in app/models/post.rb:
def cook(*args)
    # For some posts, for example those imported via RSS, we support raw HTML. In that
    # case we can skip the rendering pipeline.
    return raw if cook_method == Post.cook_methods[:raw_html]

    # Default is to cook posts
    Plugin::Filter.apply(:after_post_cook, self, post_analyzer.cook(*args))
  end
---
[High] method setup_post in lib/post_creator.rb:
def setup_post
    post = @topic.posts.new(raw: @opts[:raw],
                            user: @user,
                            reply_to_post_number: @opts[:reply_to_post_number])

    # Attributes we pass through to the post instance if present
    [:post_type, :no_bump, :cooking_options, :image_sizes, :acting_user, :invalidate_oneboxes].each do |a|
      post.send(""#{a}="", @opts[a]) if @opts[a].present?
    end

    post.cook_method = @opts[:cook_method] if @opts[:cook_method].present?
    post.extract_quoted_post_numbers
    post.created_at = Time.zone.parse(@opts[:created_at].to_s) if @opts[:created_at].present?
    @post = post
  end
---
[High] method update_post in lib/post_revisor.rb:
def update_post
    @post.raw = @new_raw
    @post.word_count = @new_raw.scan(/\w+/).size
    @post.last_editor_id = @user.id
    @post.edit_reason = @opts[:edit_reason] if @opts[:edit_reason]

    if @post.hidden && @post.hidden_reason_id == Post.hidden_reasons[:flag_threshold_reached]
      @post.hidden = false
      @post.hidden_reason_id = nil
      @post.topic.update_attributes(visible: true)

      PostAction.clear_flags!(@post, -1)
    end

    @post.extract_quoted_post_numbers
    @post.save(validate: !@opts[:skip_validations])

    @post.save_reply_relationships
  end
---
[High] method topic_id_for_embed in app/models/topic_embed.rb:
def self.topic_id_for_embed(embed_url)
    TopicEmbed.where(embed_url: embed_url).pluck(:topic_id).first
  end
---
[High] method absolutize_urls in app/models/topic_embed.rb:
def self.absolutize_urls(url, contents)
    uri = URI(url)
    prefix = ""#{uri.scheme}://#{uri.host}""
    prefix << "":#{uri.port}"" if uri.port != 80 && uri.port != 443

    fragment = Nokogiri::HTML.fragment(contents)
    fragment.css('a').each do |a|
      href = a['href']
      if href.present? && href.start_with?('/')
        a['href'] = ""#{prefix}/#{href.sub(/^\/+/, '')}""
      end
    end
    fragment.css('img').each do |a|
      src = a['src']
      if src.present? && src.start_with?('/')
        a['src'] = ""#{prefix}/#{src.sub(/^\/+/, '')}""
      end
    end

    fragment.to_html
  end","[Medium] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      SiteSetting.embeddable_host != URI(@embed_url).host
    rescue URI::InvalidURIError
      # An invalid URI is an invalid host
      true
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return fa
---
[Medium] method perform_retrieve in lib/topic_retriever.rb:
def perform_retrieve
      # It's possible another process or job found the embed already. So if that happened bail out.
      return if TopicEmbed.where(embed_url: @embed_url).exists?

      # First check RSS if that is enabled
      if SiteSetting.feed_polling_enabled?
        Jobs::PollFeed.new.execute({})
        return if TopicEmbed.where(embed_url: @embed_url).exists?
      end

      fetch_http
    end
---
[Medium] method execute in app/jobs/regular/retrieve_topic.rb:
def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end
---
[Medium] method change in db/migrate/20131223171005_create_top_topics.rb:
def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{period}_#{sort}_count"".to_sym, order: 'desc'
      en
---
[Medium] method initialize in lib/topic_retriever.rb:
def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end
---
[Medium] method retrieve in lib/topic_retriever.rb:
def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end
---
[Medium] module Jobs in app/jobs/regular/retrieve_topic.rb:
module Jobs

  # Asynchronously retrieve a topic from an embedded site
  class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end

end
---
[Medium] class RetrieveTopic in app/jobs/regular/retrieve_topic.rb:
class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end
---
[Medium] method change in db/migrate/20131217174004_create_topic_embeds.rb:
def change
    create_table :topic_embeds, force: true do |t|
      t.integer :topic_id, null: false
      t.integer :post_id, null: false
      t.string :embed_url, null: false
      t.string :content_sha1, null: false, limit: 40
      t.timestamps
    end

    add_index :topic_embeds, :embed_url, unique: true
  end
---
[Medium] method change in db/migrate/20131219203905_add_cook_method_to_posts.rb:
def change
    add_column :posts, :cook_method, :integer, default: 1, null: false
  end
---
[Medium] chunk lines 481-486 in Gemfile_rails4.lock:
  therubyracer-discourse
  thin
  timecop
  uglifier
  unf
  unicorn
---
[Medium] chunk lines 181-195 in lib/tasks/disqus.thor:
            post = PostCreator.new(post_user, attrs).create
            p[:discourse_number] = post.post_number
          end
          TopicFeaturedUsers.new(post.topic).choose
        end
      end
    end

  ensure
    RateLimiter.enable
    SiteSetting.email_domains_blacklist = email_blacklist
  end
end


---
[Medium] chunk lines 101-120 in Gemfile_rails4.lock:
    fast_xs (0.8.0)
    fastimage (1.5.2)
    ffi (1.9.3)
    flamegraph (0.0.5)
      fast_stack
    fog (1.18.0)
      builder
      excon (~> 0.28.0)
      formatador (~> 0.2.0)
      mime-types
      multi_json (~> 1.0)
      net-scp (~> 1.1)
      net-ssh (>= 2.1.3)
      nokogiri (~> 1.5)
      ruby-hmac
    formatador (0.2.4)
    fspath (2.0.5)
    given_core (3.1.1)
      sorcerer (>= 0.3.7)
    guess_html_encoding (0.0.9)
---
[Medium] chunk lines 361-380 in Gemfile_rails4.lock:
      spork (>= 1.0rc0)
    sprockets (2.10.1)
      hike (~> 1.2)
      multi_json (~> 1.0)
      rack (~> 1.0)
      tilt (~> 1.1, != 1.3.0)
    sprockets-rails (2.0.1)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      sprockets (~> 2.8)
    temple (0.6.7)
    therubyracer-discourse (0.12.0)
      libv8 (~> 3.16.14.0)
      ref
    thin (1.6.1)
      daemons (>= 1.0.9)
      eventmachine (>= 1.0.0)
      rack (>= 1.0.0)
    thor (0.18.1)
    thread_safe (0.1.3)
---
[Medium] chunk lines 401-420 in Gemfile_rails4.lock:
PLATFORMS
  ruby

DEPENDENCIES
  actionpack-action_caching
  active_model_serializers
  airbrake (= 3.1.2)
  annotate
  barber
  better_errors
  binding_of_caller
  certified
  discourse_plugin!
  email_reply_parser-discourse
  ember-rails
  ember-source (~> 1.2.0.1)
  eventmachine
  fabrication
  fakeweb (~> 1.3.0)
  fast_blank
---
[Medium] chunk lines 421-440 in Gemfile_rails4.lock:
  fast_xor
  fast_xs
  fastimage
  flamegraph
  fog (= 1.18.0)
  handlebars-source (~> 1.1.2)
  highline
  hiredis
  html_truncator
  image_optim
  image_sorcery
  librarian (>= 0.0.25)
  listen (= 0.7.3)
  lru_redux
  message_bus
  minitest
  mocha
  mock_redis
  multi_json
  mustache
---
[Medium] chunk lines 181-200 in Gemfile_rails4.lock:
      jwt (~> 0.1.4)
      multi_json (~> 1.0)
      rack (~> 1.2)
    oj (2.2.3)
    omniauth (1.1.4)
      hashie (>= 1.2, < 3)
      rack
    omniauth-browserid-discourse (0.0.2)
      faraday
      multi_json
      omniauth (~> 1.0)
    omniauth-cas (1.0.4)
      addressable (~> 2.3)
      nokogiri (~> 1.6)
      omniauth (~> 1.1.0)
    omniauth-facebook (1.4.1)
      omniauth-oauth2 (~> 1.1.0)
    omniauth-github (1.1.1)
      omniauth (~> 1.0)
      omniauth-oauth2 (~> 1.1)
---
[Medium] chunk lines 201-220 in Gemfile_rails4.lock:
    omniauth-oauth (1.0.1)
      oauth
      omniauth (~> 1.0)
    omniauth-oauth2 (1.1.1)
      oauth2 (~> 0.8.0)
      omniauth (~> 1.0)
    omniauth-openid (1.0.1)
      omniauth (~> 1.0)
      rack-openid (~> 1.3.1)
    omniauth-twitter (1.0.1)
      multi_json (~> 1.3)
      omniauth-oauth (~> 1.0)
    openid-redis-store (0.0.2)
      redis
      ruby-openid
    pg (0.15.1)
    polyglot (0.3.3)
    progress (3.0.0)
    pry (0.9.12.4)
      coderay (~> 1.0)
---
[Medium] chunk lines 261-280 in Gemfile_rails4.lock:
      rake
    rb-fsevent (0.9.3)
    rb-inotify (0.9.2)
      ffi (>= 0.5.0)
    rbtrace (0.4.1)
      ffi (>= 1.0.6)
      msgpack (>= 0.4.3)
      trollop (>= 1.16.2)
    redcarpet (3.0.0)
    redis (3.0.6)
    redis-actionpack (4.0.0)
      actionpack (~> 4)
      redis-rack (~> 1.5.0)
      redis-store (~> 1.1.0)
    redis-activesupport (4.0.0)
      activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-namespace (1.3.2)
      redis (~> 3.0.4)
    redis-rack (1.5.0)
---
[Medium] chunk lines 281-300 in Gemfile_rails4.lock:
      rack (~> 1.5)
      redis-store (~> 1.1.0)
    redis-rails (4.0.0)
      redis-actionpack (~> 4)
      redis-activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-store (1.1.4)
      redis (>= 2.2)
    ref (1.0.5)
    rest-client (1.6.7)
      mime-types (>= 1.16)
    rinku (1.7.3)
    rspec (2.14.1)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    rspec-core (2.14.6)
    rspec-expectations (2.14.3)
      diff-lcs (>= 1.1.3, < 2.0)
 
---
[Medium] chunk lines 121-140 in Gemfile_rails4.lock:
    handlebars-source (1.1.2)
    hashie (2.0.5)
    highline (1.6.20)
    hike (1.2.3)
    hiredis (0.4.5)
    html_truncator (0.3.1)
      nokogiri (~> 1.5)
    httpauth (0.2.0)
    i18n (0.6.9)
    ice_cube (0.11.1)
    image_optim (0.9.1)
      exifr (~> 1.1.3)
      fspath (~> 2.0.5)
      image_size (~> 1.1.2)
      in_threads (~> 1.2.0)
      progress (~> 3.0.0)
    image_size (1.1.3)
    image_sorcery (1.1.0)
    in_threads (1.2.0)
    jquery-rails (3.0.4)
---
[Medium] chunk lines 221-240 in Gemfile_rails4.lock:
      method_source (~> 0.8)
      slop (~> 3.4)
    pry-nav (0.2.3)
      pry (~> 0.9.10)
    pry-rails (0.3.2)
      pry (>= 0.9.10)
    puma (2.6.0)
      rack (>= 1.1, < 2.0)
    qunit-rails (0.0.4)
      railties (>= 3.2.3)
    rack (1.5.2)
    rack-cors (0.2.8)
      rack
    rack-mini-profiler (0.9.0.pre)
      rack (>= 1.1.3)
    rack-openid (1.3.1)
      rack (>= 1.1.0)
      ruby-openid (>= 2.1.8)
    rack-protection (1.5.1)
      rack
---
[Medium] chunk lines 301-320 in Gemfile_rails4.lock:
      given_core (= 3.1.1)
      rspec (>= 2.12)
    rspec-mocks (2.14.4)
    rspec-rails (2.14.0)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      railties (>= 3.0)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    ruby-hmac (0.4.0)
    ruby-openid (2.3.0)
    ruby-readability (0.5.7)
      guess_html_encoding (>= 0.0.4)
      nokogiri (>= 1.4.2)
    sanitize (2.0.6)
      nokogiri (>= 1.4.4)
    sass (3.2.12)
    sass-rails (4.0.1)

---
[Medium] chunk lines 341-360 in Gemfile_rails4.lock:
      celluloid (>= 0.14.1)
      ice_cube (~> 0.11.0)
      sidekiq (~> 2.15.0)
    simple-rss (1.3.1)
    simplecov (0.7.1)
      multi_json (~> 1.0)
      simplecov-html (~> 0.7.1)
    simplecov-html (0.7.1)
    sinatra (1.4.4)
      rack (~> 1.4)
      rack-protection (~> 1.4)
      tilt (~> 1.3, >= 1.3.4)
    slim (2.0.1)
      temple (~> 0.6.6)
      tilt (>= 1.3.3, < 2.1)
    slop (3.4.7)
    sorcerer (1.0.2)
    spork (1.0.0rc4)
    spork-rails (4.0.0)
      rails (>= 3.0.0, < 5)
---
[Medium] chunk lines 161-180 in Gemfile_rails4.lock:
    method_source (0.8.2)
    mime-types (1.25.1)
    mini_portile (0.5.1)
    minitest (4.7.5)
    mocha (0.14.0)
      metaclass (~> 0.0.1)
    mock_redis (0.9.0)
    msgpack (0.5.7)
    multi_json (1.8.2)
    multipart-post (1.2.0)
    mustache (0.99.4)
    net-scp (1.1.2)
      net-ssh (>= 2.6.5)
    net-ssh (2.7.0)
    nokogiri (1.6.0)
      mini_portile (~> 0.5.0)
    oauth (0.4.7)
    oauth2 (0.8.1)
      faraday (~> 0.8)
      httpauth (~> 0.1)
---
[Medium] chunk lines 441-460 in Gemfile_rails4.lock:
  nokogiri
  oj
  omniauth
  omniauth-browserid-discourse
  omniauth-cas
  omniauth-facebook
  omniauth-github
  omniauth-oauth2
  omniauth-openid
  omniauth-twitter
  openid-redis-store
  pg (= 0.15.1)
  pry-nav
  pry-rails
  puma
  qunit-rails
  rack-cors
  rack-mini-profiler (= 0.9.0.pre)
  rack-protection
  rails
---
[Medium] chunk lines 141-160 in Gemfile_rails4.lock:
      railties (>= 3.0, < 5.0)
      thor (>= 0.14, < 2.0)
    json (1.8.1)
    jwt (0.1.8)
      multi_json (>= 1.5)
    kgio (2.8.1)
    librarian (0.1.1)
      highline
      thor (~> 0.15)
    libv8 (3.16.14.3)
    listen (0.7.3)
    lru_redux (0.8.1)
    mail (2.5.4)
      mime-types (~> 1.16)
      treetop (~> 1.4.8)
    message_bus (0.9.3.2)
      eventmachine
      rack (>= 1.1.3)
      redis
    metaclass (0.0.1)
---
[Medium] chunk lines 381-400 in Gemfile_rails4.lock:
      atomic
    tilt (1.4.1)
    timecop (0.6.3)
    timers (1.1.0)
    treetop (1.4.15)
      polyglot
      polyglot (>= 0.3.1)
    trollop (2.0)
    tzinfo (0.3.38)
    uglifier (2.3.3)
      execjs (>= 0.3.0)
      json (>= 1.8.0)
    unf (0.1.3)
      unf_ext
    unf_ext (0.0.6)
    unicorn (4.7.0)
      kgio (~> 2.6)
      rack
      raindrops (~> 0.7)

---
[Medium] chunk lines 321-340 in Gemfile_rails4.lock:
      sass (>= 3.1.10)
      sprockets-rails (~> 2.0.0)
    seed-fu-discourse (2.2.0)
      activerecord (>= 3.1, < 4.1)
      activesupport (>= 3.1, < 4.1)
    shoulda (3.5.0)
      shoulda-context (~> 1.0, >= 1.0.1)
      shoulda-matchers (>= 1.4.1, < 3.0)
    shoulda-context (1.1.5)
    shoulda-matchers (2.4.0)
      activesupport (>= 3.0.0)
    sidekiq (2.15.1)
      celluloid (>= 0.15.1)
      connection_pool (>= 1.0.0)
      json
      redis (>= 3.0.4)
      redis-namespace (>= 1.3.1)
    
---
[Medium] chunk lines 241-260 in Gemfile_rails4.lock:
    rack-test (0.6.2)
      rack (>= 1.0)
    rails (4.0.2)
      actionmailer (= 4.0.2)
      actionpack (= 4.0.2)
      activerecord (= 4.0.2)
      activesupport (= 4.0.2)
      bundler (>= 1.3.0, < 2.0)
      railties (= 4.0.2)
      sprockets-rails (~> 2.0.0)
    rails-observers (0.1.2)
      activemodel (~> 4.0)
    railties (4.0.2)
      actionpack (= 4.0.2)
      activesupport (= 4.0.2)
      rake (>= 0.8.7)
      thor (>= 0.18.1, < 2.0)
    raindrops (0.12.0)
    rake (10.1.0)
    rake-
---
[Medium] chunk lines 461-480 in Gemfile_rails4.lock:
  rails-observers
  rails_multisite!
  rake
  rb-fsevent
  rb-inotify (~> 0.9)
  rbtrace
  redcarpet
  redis
  redis-rails
  rest-client
  rinku
  rspec-given
  rspec-rails
  ruby-readability
  sanitize
  sass
  sass-rails
  seed-fu-discourse
  shoulda
  sidekiq (= 2.15.1)
---
[Medium] section en in config/locales/server.en.yml:
en:
  dates:
    short_date_no_year: ""D MMM""
    short_date: ""D MMM, YYYY""
    long_date: ""MMMM D, YYYY h:mma""
  time:
    formats:
      short: ""%m-%d-%Y""
      short_no_year: ""%B %-d""
      date_only: ""%b %-d, %Y""

  title: ""Discourse""
  topics: ""Topics""
  posts: ""posts""
  loading: ""Loading""
  powered_by_html: 'Powered by <a href=""http://www.discourse.org"">Discourse</a>, best viewed with JavaScript enabled'

  via: ""%{username} via %{site_name}""
  is_reserved: ""is reserved""

  site_under_maint
---
[Medium] class CreateTopTopics in db/migrate/20131223171005_create_top_topics.rb:
class CreateTopTopics < ActiveRecord::Migration
  def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{per
---
[Medium] chunk lines 141-160 in lib/tasks/disqus.thor:
    SiteSetting.email_domains_blacklist = """"

    parser.threads.each do |id, t|
      puts ""Creating #{t[:title]}... (#{t[:posts].size} posts)""

      if options[:dry_run].blank?

        post = TopicEmbed.import_remote(user, t[:link], title: t[:title])
        if post.present?
          t[:posts].each do |p|
            post_user = user
            if p[:author_email]
              email = Email.downcase(p[:author_email])
              post_user = User.where(email: email).first
              i
---
[Medium] chunk lines 161-180 in lib/tasks/disqus.thor:
              topic_id: post.topic_id,
              raw: p[:cooked],
              cooked: p[:cooked],
              created_at: Date.parse(p[:created_at])
            }

            if p[:parent_id]
              parent = parser.posts[p[:parent_id]]
              if parent && parent[:discourse_number]
                attrs[:reply_to_post_number] = parent[:discourse_number]
              end
            end

            post = PostCreator.new(post_user, attrs).create
            p[:discourse_nu
---
[Medium] chunk lines 101-120 in lib/tasks/disqus.thor:
        existing[:posts] << t[:posts]
        existing[:posts].flatten!
        @threads.delete(t[:id])
      end
    end


  end
end

class Disqus < Thor
  desc ""import"", ""Imports posts from a Disqus XML export""
  method_option :file, aliases: '-f', required: true, desc: ""The disqus XML file to import""
  method_option :dry_run, required: false, desc: ""Just output what will be imported rather than doing it""
  method_option :post_as, aliases: '-p', required: true, desc: ""The Discourse username to","PostCreator (Critical), PostRevisor (Critical), Post (Critical), TopicEmbed (Critical), cook_methods (Critical), import_remote (High), cook (High), setup_post (High), update_post (High), topic_id_for_embed (High), absolutize_urls (High), TopicRetriever (Medium), perform_retrieve (Medium), execute (Medium), change (Medium), initialize (Medium), retrieve (Medium), Jobs (Medium), RetrieveTopic (Medium), change (Medium), change (Medium), lines 481-486 (Medium), lines 181-195 (Medium), lines 101-120 (Medium), lines 361-380 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 121-140 (Medium), lines 221-240 (Medium), lines 301-320 (Medium), lines 341-360 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 141-160 (Medium), lines 381-400 (Medium), lines 321-340 (Medium), lines 241-260 (Medium), lines 461-480 (Medium), en (Medium), CreateTopTopics (Medium), lines 141-160 (Medium), lines 161-180 (Medium), lines 101-120 (Medium), lines 201-219 (Low), lines 481-493 (Low), comments (Low), postMessageReceived (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-69 (Low), EmbedController (Low), best (Low), ensure_embeddable (Low), Jobs (Low), PollFeed (Low), execute (Low), feed_key (Low), poll_feed (Low), import (Low), lines 1-20 (Low), lines 21-30 (Low), lines 1-12 (Low), lines 1-20 (Low), embedding (Low), CreateTopicEmbeds (Low), AddCookMethodToPosts (Low), lines 181-188 (Low), invalid_host? (Low), retrieved_recently? (Low), fetch_http (Low), lines 121-140 (Low), MigrateWordCounts (Low), revise! (Low)",match,TopicEmbed is flagged as Critical
discourse,4,Enhance embed URL handling and validation system,"The ERB block closes with end if, which is invalid Ruby/ERB and will raise at render; it should just be end to close the if block.",Medium,78,11,36,"class::PostCreator (lib/post_creator.rb) [Critical, score=1.00] | class::PostRevisor (lib/post_revisor.rb) [Critical, score=1.00] | class::Post (app/models/post.rb) [Critical, score=0.94] | class::TopicEmbed (app/models/topic_embed.rb) [Critical, score=0.90] | method::cook_methods (app/models/post.rb) [Critical, score=0.87] | method::import_remote (app/models/topic_embed.rb) [High, score=0.64] | method::cook (app/models/post.rb) [High, score=0.60] | method::setup_post (lib/post_creator.rb) [High, score=0.60] | method::update_post (lib/post_revisor.rb) [High, score=0.60] | method::topic_id_for_embed (app/models/topic_embed.rb) [High, score=0.58] | method::absolutize_urls (app/models/topic_embed.rb) [High, score=0.54]","[Critical] class PostCreator in lib/post_creator.rb:
class PostCreator

  attr_reader :errors, :opts

  # Acceptable options:
  #
  #   raw                     - raw text of post
  #   image_sizes             - We can pass a list of the sizes of images in the post as a shortcut.
  #   invalidate_oneboxes     - Whether to force invalidation of oneboxes in this post
  #   acting_user             - The user performing the action might be different than the user
  #                             who is the post ""author."" For example when copying posts to a new
  #                             topic.
  #   created_at              - Post creation time (optional)
  #   auto_track              - Automatically track this topic if needed (default true)
  #
  #   When replying to a topic:
  #     topic_id              - topic we're replying to
  #     rep
---
[Critical] class PostRevisor in lib/post_revisor.rb:
class PostRevisor

  attr_reader :category_changed

  def initialize(post)
    @post = post
  end

  def revise!(user, new_raw, opts = {})
    @user, @new_raw, @opts = user, new_raw, opts
    return false if not should_revise?
    @post.acting_user = @user
    revise_post
    update_category_description
    post_process_post
    update_topic_word_counts
    @post.advance_draft_sequence

    true
  end

  private

  def should_revise?
    @post.raw != @new_raw
  end

  def revise_post
    if should_create_new_version?
      revise_and_create_new_version
    else
      update_post
    end
  end

  def get_revised_at
    @opts[:revised_at] || Time.now
  end

  def should_create_new_version?
    @post.last_editor_id != @user.id ||
    get_revised_at - @post.last_version_at > SiteSetting.ninja_
---
[Critical] class Post in app/models/post.rb:
class Post < ActiveRecord::Base
  include RateLimiter::OnCreateRecord
  include Trashable

  rate_limit
  rate_limit :limit_posts_per_day

  belongs_to :user
  belongs_to :topic, counter_cache: :posts_count
  belongs_to :reply_to_user, class_name: ""User""

  has_many :post_replies
  has_many :replies, through: :post_replies
  has_many :post_actions
  has_many :topic_links

  has_many :post_uploads
  has_many :uploads, through: :post_uploads

  has_one :post_search_data

  has_many :post_details

  has_many :post_revisions
  has_many :revisions, foreign_key: :post_id, class_name: 'PostRevision'

  validates_with ::Validators::PostValidator

  # We can pass several creating options to a post via attributes
  attr_accessor :image_sizes, :quoted_post_numbers, :no_bump, :invalidate_oneboxes, :co
---
[Critical] class TopicEmbed in app/models/topic_embed.rb:
class TopicEmbed < ActiveRecord::Base
  belongs_to :topic
  belongs_to :post
  validates_presence_of :embed_url
  validates_presence_of :content_sha1

  # Import an article from a source (RSS/Atom/Other)
  def self.import(user, url, title, contents)
    return unless url =~ /^https?\:\/\//

    contents << ""\n<hr>\n<small>#{I18n.t('embed.imported_from', link: ""<a href='#{url}'>#{url}</a>"")}</small>\n""

    embed = TopicEmbed.where(embed_url: url).first
    content_sha1 = Digest::SHA1.hexdigest(contents)
    post = nil

    # If there is no embed, create a topic, post and the embed.
    if embed.blank?
      Topic.transaction do
        creator = PostCreator.new(user, title: title, raw: absolutize_urls(url, contents), skip_validations: true, cook_method: Post.cook_methods[:raw_html])
      
---
[Critical] method cook_methods in app/models/post.rb:
def self.cook_methods
    @cook_methods ||= Enum.new(:regular, :raw_html)
  end
---
[High] method import_remote in app/models/topic_embed.rb:
def self.import_remote(user, url, opts=nil)
    require 'ruby-readability'

    opts = opts || {}
    doc = Readability::Document.new(open(url).read,
                                        tags: %w[div p code pre h1 h2 h3 b em i strong a img],
                                        attributes: %w[href src])

    TopicEmbed.import(user, url, opts[:title] || doc.title, doc.content)
  end
---
[High] method cook in app/models/post.rb:
def cook(*args)
    # For some posts, for example those imported via RSS, we support raw HTML. In that
    # case we can skip the rendering pipeline.
    return raw if cook_method == Post.cook_methods[:raw_html]

    # Default is to cook posts
    Plugin::Filter.apply(:after_post_cook, self, post_analyzer.cook(*args))
  end
---
[High] method setup_post in lib/post_creator.rb:
def setup_post
    post = @topic.posts.new(raw: @opts[:raw],
                            user: @user,
                            reply_to_post_number: @opts[:reply_to_post_number])

    # Attributes we pass through to the post instance if present
    [:post_type, :no_bump, :cooking_options, :image_sizes, :acting_user, :invalidate_oneboxes].each do |a|
      post.send(""#{a}="", @opts[a]) if @opts[a].present?
    end

    post.cook_method = @opts[:cook_method] if @opts[:cook_method].present?
    post.extract_quoted_post_numbers
    post.created_at = Time.zone.parse(@opts[:created_at].to_s) if @opts[:created_at].present?
    @post = post
  end
---
[High] method update_post in lib/post_revisor.rb:
def update_post
    @post.raw = @new_raw
    @post.word_count = @new_raw.scan(/\w+/).size
    @post.last_editor_id = @user.id
    @post.edit_reason = @opts[:edit_reason] if @opts[:edit_reason]

    if @post.hidden && @post.hidden_reason_id == Post.hidden_reasons[:flag_threshold_reached]
      @post.hidden = false
      @post.hidden_reason_id = nil
      @post.topic.update_attributes(visible: true)

      PostAction.clear_flags!(@post, -1)
    end

    @post.extract_quoted_post_numbers
    @post.save(validate: !@opts[:skip_validations])

    @post.save_reply_relationships
  end
---
[High] method topic_id_for_embed in app/models/topic_embed.rb:
def self.topic_id_for_embed(embed_url)
    TopicEmbed.where(embed_url: embed_url).pluck(:topic_id).first
  end
---
[High] method absolutize_urls in app/models/topic_embed.rb:
def self.absolutize_urls(url, contents)
    uri = URI(url)
    prefix = ""#{uri.scheme}://#{uri.host}""
    prefix << "":#{uri.port}"" if uri.port != 80 && uri.port != 443

    fragment = Nokogiri::HTML.fragment(contents)
    fragment.css('a').each do |a|
      href = a['href']
      if href.present? && href.start_with?('/')
        a['href'] = ""#{prefix}/#{href.sub(/^\/+/, '')}""
      end
    end
    fragment.css('img').each do |a|
      src = a['src']
      if src.present? && src.start_with?('/')
        a['src'] = ""#{prefix}/#{src.sub(/^\/+/, '')}""
      end
    end

    fragment.to_html
  end","[Medium] class TopicRetriever in lib/topic_retriever.rb:
class TopicRetriever

  def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end

  def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end

  private

    def invalid_host?
      SiteSetting.embeddable_host != URI(@embed_url).host
    rescue URI::InvalidURIError
      # An invalid URI is an invalid host
      true
    end

    def retrieved_recently?
      # We can disable the throttle for some users, such as staff
      return fa
---
[Medium] method perform_retrieve in lib/topic_retriever.rb:
def perform_retrieve
      # It's possible another process or job found the embed already. So if that happened bail out.
      return if TopicEmbed.where(embed_url: @embed_url).exists?

      # First check RSS if that is enabled
      if SiteSetting.feed_polling_enabled?
        Jobs::PollFeed.new.execute({})
        return if TopicEmbed.where(embed_url: @embed_url).exists?
      end

      fetch_http
    end
---
[Medium] method execute in app/jobs/regular/retrieve_topic.rb:
def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end
---
[Medium] method change in db/migrate/20131223171005_create_top_topics.rb:
def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{period}_#{sort}_count"".to_sym, order: 'desc'
      en
---
[Medium] method initialize in lib/topic_retriever.rb:
def initialize(embed_url, opts=nil)
    @embed_url = embed_url
    @opts = opts || {}
  end
---
[Medium] method retrieve in lib/topic_retriever.rb:
def retrieve
    perform_retrieve unless (invalid_host? || retrieved_recently?)
  end
---
[Medium] module Jobs in app/jobs/regular/retrieve_topic.rb:
module Jobs

  # Asynchronously retrieve a topic from an embedded site
  class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end

end
---
[Medium] class RetrieveTopic in app/jobs/regular/retrieve_topic.rb:
class RetrieveTopic < Jobs::Base

    def execute(args)
      raise Discourse::InvalidParameters.new(:embed_url) unless args[:embed_url].present?

      user = nil
      if args[:user_id]
        user = User.where(id: args[:user_id]).first
      end

      TopicRetriever.new(args[:embed_url], no_throttle: user.try(:staff?)).retrieve
    end

  end
---
[Medium] method change in db/migrate/20131217174004_create_topic_embeds.rb:
def change
    create_table :topic_embeds, force: true do |t|
      t.integer :topic_id, null: false
      t.integer :post_id, null: false
      t.string :embed_url, null: false
      t.string :content_sha1, null: false, limit: 40
      t.timestamps
    end

    add_index :topic_embeds, :embed_url, unique: true
  end
---
[Medium] method change in db/migrate/20131219203905_add_cook_method_to_posts.rb:
def change
    add_column :posts, :cook_method, :integer, default: 1, null: false
  end
---
[Medium] chunk lines 481-486 in Gemfile_rails4.lock:
  therubyracer-discourse
  thin
  timecop
  uglifier
  unf
  unicorn
---
[Medium] chunk lines 181-195 in lib/tasks/disqus.thor:
            post = PostCreator.new(post_user, attrs).create
            p[:discourse_number] = post.post_number
          end
          TopicFeaturedUsers.new(post.topic).choose
        end
      end
    end

  ensure
    RateLimiter.enable
    SiteSetting.email_domains_blacklist = email_blacklist
  end
end


---
[Medium] chunk lines 101-120 in Gemfile_rails4.lock:
    fast_xs (0.8.0)
    fastimage (1.5.2)
    ffi (1.9.3)
    flamegraph (0.0.5)
      fast_stack
    fog (1.18.0)
      builder
      excon (~> 0.28.0)
      formatador (~> 0.2.0)
      mime-types
      multi_json (~> 1.0)
      net-scp (~> 1.1)
      net-ssh (>= 2.1.3)
      nokogiri (~> 1.5)
      ruby-hmac
    formatador (0.2.4)
    fspath (2.0.5)
    given_core (3.1.1)
      sorcerer (>= 0.3.7)
    guess_html_encoding (0.0.9)
---
[Medium] chunk lines 361-380 in Gemfile_rails4.lock:
      spork (>= 1.0rc0)
    sprockets (2.10.1)
      hike (~> 1.2)
      multi_json (~> 1.0)
      rack (~> 1.0)
      tilt (~> 1.1, != 1.3.0)
    sprockets-rails (2.0.1)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      sprockets (~> 2.8)
    temple (0.6.7)
    therubyracer-discourse (0.12.0)
      libv8 (~> 3.16.14.0)
      ref
    thin (1.6.1)
      daemons (>= 1.0.9)
      eventmachine (>= 1.0.0)
      rack (>= 1.0.0)
    thor (0.18.1)
    thread_safe (0.1.3)
---
[Medium] chunk lines 401-420 in Gemfile_rails4.lock:
PLATFORMS
  ruby

DEPENDENCIES
  actionpack-action_caching
  active_model_serializers
  airbrake (= 3.1.2)
  annotate
  barber
  better_errors
  binding_of_caller
  certified
  discourse_plugin!
  email_reply_parser-discourse
  ember-rails
  ember-source (~> 1.2.0.1)
  eventmachine
  fabrication
  fakeweb (~> 1.3.0)
  fast_blank
---
[Medium] chunk lines 421-440 in Gemfile_rails4.lock:
  fast_xor
  fast_xs
  fastimage
  flamegraph
  fog (= 1.18.0)
  handlebars-source (~> 1.1.2)
  highline
  hiredis
  html_truncator
  image_optim
  image_sorcery
  librarian (>= 0.0.25)
  listen (= 0.7.3)
  lru_redux
  message_bus
  minitest
  mocha
  mock_redis
  multi_json
  mustache
---
[Medium] chunk lines 181-200 in Gemfile_rails4.lock:
      jwt (~> 0.1.4)
      multi_json (~> 1.0)
      rack (~> 1.2)
    oj (2.2.3)
    omniauth (1.1.4)
      hashie (>= 1.2, < 3)
      rack
    omniauth-browserid-discourse (0.0.2)
      faraday
      multi_json
      omniauth (~> 1.0)
    omniauth-cas (1.0.4)
      addressable (~> 2.3)
      nokogiri (~> 1.6)
      omniauth (~> 1.1.0)
    omniauth-facebook (1.4.1)
      omniauth-oauth2 (~> 1.1.0)
    omniauth-github (1.1.1)
      omniauth (~> 1.0)
      omniauth-oauth2 (~> 1.1)
---
[Medium] chunk lines 201-220 in Gemfile_rails4.lock:
    omniauth-oauth (1.0.1)
      oauth
      omniauth (~> 1.0)
    omniauth-oauth2 (1.1.1)
      oauth2 (~> 0.8.0)
      omniauth (~> 1.0)
    omniauth-openid (1.0.1)
      omniauth (~> 1.0)
      rack-openid (~> 1.3.1)
    omniauth-twitter (1.0.1)
      multi_json (~> 1.3)
      omniauth-oauth (~> 1.0)
    openid-redis-store (0.0.2)
      redis
      ruby-openid
    pg (0.15.1)
    polyglot (0.3.3)
    progress (3.0.0)
    pry (0.9.12.4)
      coderay (~> 1.0)
---
[Medium] chunk lines 261-280 in Gemfile_rails4.lock:
      rake
    rb-fsevent (0.9.3)
    rb-inotify (0.9.2)
      ffi (>= 0.5.0)
    rbtrace (0.4.1)
      ffi (>= 1.0.6)
      msgpack (>= 0.4.3)
      trollop (>= 1.16.2)
    redcarpet (3.0.0)
    redis (3.0.6)
    redis-actionpack (4.0.0)
      actionpack (~> 4)
      redis-rack (~> 1.5.0)
      redis-store (~> 1.1.0)
    redis-activesupport (4.0.0)
      activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-namespace (1.3.2)
      redis (~> 3.0.4)
    redis-rack (1.5.0)
---
[Medium] chunk lines 281-300 in Gemfile_rails4.lock:
      rack (~> 1.5)
      redis-store (~> 1.1.0)
    redis-rails (4.0.0)
      redis-actionpack (~> 4)
      redis-activesupport (~> 4)
      redis-store (~> 1.1.0)
    redis-store (1.1.4)
      redis (>= 2.2)
    ref (1.0.5)
    rest-client (1.6.7)
      mime-types (>= 1.16)
    rinku (1.7.3)
    rspec (2.14.1)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    rspec-core (2.14.6)
    rspec-expectations (2.14.3)
      diff-lcs (>= 1.1.3, < 2.0)
 
---
[Medium] chunk lines 121-140 in Gemfile_rails4.lock:
    handlebars-source (1.1.2)
    hashie (2.0.5)
    highline (1.6.20)
    hike (1.2.3)
    hiredis (0.4.5)
    html_truncator (0.3.1)
      nokogiri (~> 1.5)
    httpauth (0.2.0)
    i18n (0.6.9)
    ice_cube (0.11.1)
    image_optim (0.9.1)
      exifr (~> 1.1.3)
      fspath (~> 2.0.5)
      image_size (~> 1.1.2)
      in_threads (~> 1.2.0)
      progress (~> 3.0.0)
    image_size (1.1.3)
    image_sorcery (1.1.0)
    in_threads (1.2.0)
    jquery-rails (3.0.4)
---
[Medium] chunk lines 221-240 in Gemfile_rails4.lock:
      method_source (~> 0.8)
      slop (~> 3.4)
    pry-nav (0.2.3)
      pry (~> 0.9.10)
    pry-rails (0.3.2)
      pry (>= 0.9.10)
    puma (2.6.0)
      rack (>= 1.1, < 2.0)
    qunit-rails (0.0.4)
      railties (>= 3.2.3)
    rack (1.5.2)
    rack-cors (0.2.8)
      rack
    rack-mini-profiler (0.9.0.pre)
      rack (>= 1.1.3)
    rack-openid (1.3.1)
      rack (>= 1.1.0)
      ruby-openid (>= 2.1.8)
    rack-protection (1.5.1)
      rack
---
[Medium] chunk lines 301-320 in Gemfile_rails4.lock:
      given_core (= 3.1.1)
      rspec (>= 2.12)
    rspec-mocks (2.14.4)
    rspec-rails (2.14.0)
      actionpack (>= 3.0)
      activesupport (>= 3.0)
      railties (>= 3.0)
      rspec-core (~> 2.14.0)
      rspec-expectations (~> 2.14.0)
      rspec-mocks (~> 2.14.0)
    ruby-hmac (0.4.0)
    ruby-openid (2.3.0)
    ruby-readability (0.5.7)
      guess_html_encoding (>= 0.0.4)
      nokogiri (>= 1.4.2)
    sanitize (2.0.6)
      nokogiri (>= 1.4.4)
    sass (3.2.12)
    sass-rails (4.0.1)

---
[Medium] chunk lines 341-360 in Gemfile_rails4.lock:
      celluloid (>= 0.14.1)
      ice_cube (~> 0.11.0)
      sidekiq (~> 2.15.0)
    simple-rss (1.3.1)
    simplecov (0.7.1)
      multi_json (~> 1.0)
      simplecov-html (~> 0.7.1)
    simplecov-html (0.7.1)
    sinatra (1.4.4)
      rack (~> 1.4)
      rack-protection (~> 1.4)
      tilt (~> 1.3, >= 1.3.4)
    slim (2.0.1)
      temple (~> 0.6.6)
      tilt (>= 1.3.3, < 2.1)
    slop (3.4.7)
    sorcerer (1.0.2)
    spork (1.0.0rc4)
    spork-rails (4.0.0)
      rails (>= 3.0.0, < 5)
---
[Medium] chunk lines 161-180 in Gemfile_rails4.lock:
    method_source (0.8.2)
    mime-types (1.25.1)
    mini_portile (0.5.1)
    minitest (4.7.5)
    mocha (0.14.0)
      metaclass (~> 0.0.1)
    mock_redis (0.9.0)
    msgpack (0.5.7)
    multi_json (1.8.2)
    multipart-post (1.2.0)
    mustache (0.99.4)
    net-scp (1.1.2)
      net-ssh (>= 2.6.5)
    net-ssh (2.7.0)
    nokogiri (1.6.0)
      mini_portile (~> 0.5.0)
    oauth (0.4.7)
    oauth2 (0.8.1)
      faraday (~> 0.8)
      httpauth (~> 0.1)
---
[Medium] chunk lines 441-460 in Gemfile_rails4.lock:
  nokogiri
  oj
  omniauth
  omniauth-browserid-discourse
  omniauth-cas
  omniauth-facebook
  omniauth-github
  omniauth-oauth2
  omniauth-openid
  omniauth-twitter
  openid-redis-store
  pg (= 0.15.1)
  pry-nav
  pry-rails
  puma
  qunit-rails
  rack-cors
  rack-mini-profiler (= 0.9.0.pre)
  rack-protection
  rails
---
[Medium] chunk lines 141-160 in Gemfile_rails4.lock:
      railties (>= 3.0, < 5.0)
      thor (>= 0.14, < 2.0)
    json (1.8.1)
    jwt (0.1.8)
      multi_json (>= 1.5)
    kgio (2.8.1)
    librarian (0.1.1)
      highline
      thor (~> 0.15)
    libv8 (3.16.14.3)
    listen (0.7.3)
    lru_redux (0.8.1)
    mail (2.5.4)
      mime-types (~> 1.16)
      treetop (~> 1.4.8)
    message_bus (0.9.3.2)
      eventmachine
      rack (>= 1.1.3)
      redis
    metaclass (0.0.1)
---
[Medium] chunk lines 381-400 in Gemfile_rails4.lock:
      atomic
    tilt (1.4.1)
    timecop (0.6.3)
    timers (1.1.0)
    treetop (1.4.15)
      polyglot
      polyglot (>= 0.3.1)
    trollop (2.0)
    tzinfo (0.3.38)
    uglifier (2.3.3)
      execjs (>= 0.3.0)
      json (>= 1.8.0)
    unf (0.1.3)
      unf_ext
    unf_ext (0.0.6)
    unicorn (4.7.0)
      kgio (~> 2.6)
      rack
      raindrops (~> 0.7)

---
[Medium] chunk lines 321-340 in Gemfile_rails4.lock:
      sass (>= 3.1.10)
      sprockets-rails (~> 2.0.0)
    seed-fu-discourse (2.2.0)
      activerecord (>= 3.1, < 4.1)
      activesupport (>= 3.1, < 4.1)
    shoulda (3.5.0)
      shoulda-context (~> 1.0, >= 1.0.1)
      shoulda-matchers (>= 1.4.1, < 3.0)
    shoulda-context (1.1.5)
    shoulda-matchers (2.4.0)
      activesupport (>= 3.0.0)
    sidekiq (2.15.1)
      celluloid (>= 0.15.1)
      connection_pool (>= 1.0.0)
      json
      redis (>= 3.0.4)
      redis-namespace (>= 1.3.1)
    
---
[Medium] chunk lines 241-260 in Gemfile_rails4.lock:
    rack-test (0.6.2)
      rack (>= 1.0)
    rails (4.0.2)
      actionmailer (= 4.0.2)
      actionpack (= 4.0.2)
      activerecord (= 4.0.2)
      activesupport (= 4.0.2)
      bundler (>= 1.3.0, < 2.0)
      railties (= 4.0.2)
      sprockets-rails (~> 2.0.0)
    rails-observers (0.1.2)
      activemodel (~> 4.0)
    railties (4.0.2)
      actionpack (= 4.0.2)
      activesupport (= 4.0.2)
      rake (>= 0.8.7)
      thor (>= 0.18.1, < 2.0)
    raindrops (0.12.0)
    rake (10.1.0)
    rake-
---
[Medium] chunk lines 461-480 in Gemfile_rails4.lock:
  rails-observers
  rails_multisite!
  rake
  rb-fsevent
  rb-inotify (~> 0.9)
  rbtrace
  redcarpet
  redis
  redis-rails
  rest-client
  rinku
  rspec-given
  rspec-rails
  ruby-readability
  sanitize
  sass
  sass-rails
  seed-fu-discourse
  shoulda
  sidekiq (= 2.15.1)
---
[Medium] section en in config/locales/server.en.yml:
en:
  dates:
    short_date_no_year: ""D MMM""
    short_date: ""D MMM, YYYY""
    long_date: ""MMMM D, YYYY h:mma""
  time:
    formats:
      short: ""%m-%d-%Y""
      short_no_year: ""%B %-d""
      date_only: ""%b %-d, %Y""

  title: ""Discourse""
  topics: ""Topics""
  posts: ""posts""
  loading: ""Loading""
  powered_by_html: 'Powered by <a href=""http://www.discourse.org"">Discourse</a>, best viewed with JavaScript enabled'

  via: ""%{username} via %{site_name}""
  is_reserved: ""is reserved""

  site_under_maint
---
[Medium] class CreateTopTopics in db/migrate/20131223171005_create_top_topics.rb:
class CreateTopTopics < ActiveRecord::Migration
  def change
    create_table :top_topics, force: true do |t|
      t.belongs_to :topic

      TopTopic.periods.each do |period|
        TopTopic.sort_orders.each do |sort|
          t.integer ""#{period}_#{sort}_count"".to_sym, null: false, default: 0
        end
      end

    end

    add_index :top_topics, :topic_id, unique: true

    TopTopic.periods.each do |period|
      TopTopic.sort_orders.each do |sort|
        add_index :top_topics, ""#{per
---
[Medium] chunk lines 141-160 in lib/tasks/disqus.thor:
    SiteSetting.email_domains_blacklist = """"

    parser.threads.each do |id, t|
      puts ""Creating #{t[:title]}... (#{t[:posts].size} posts)""

      if options[:dry_run].blank?

        post = TopicEmbed.import_remote(user, t[:link], title: t[:title])
        if post.present?
          t[:posts].each do |p|
            post_user = user
            if p[:author_email]
              email = Email.downcase(p[:author_email])
              post_user = User.where(email: email).first
              i
---
[Medium] chunk lines 161-180 in lib/tasks/disqus.thor:
              topic_id: post.topic_id,
              raw: p[:cooked],
              cooked: p[:cooked],
              created_at: Date.parse(p[:created_at])
            }

            if p[:parent_id]
              parent = parser.posts[p[:parent_id]]
              if parent && parent[:discourse_number]
                attrs[:reply_to_post_number] = parent[:discourse_number]
              end
            end

            post = PostCreator.new(post_user, attrs).create
            p[:discourse_nu
---
[Medium] chunk lines 101-120 in lib/tasks/disqus.thor:
        existing[:posts] << t[:posts]
        existing[:posts].flatten!
        @threads.delete(t[:id])
      end
    end


  end
end

class Disqus < Thor
  desc ""import"", ""Imports posts from a Disqus XML export""
  method_option :file, aliases: '-f', required: true, desc: ""The disqus XML file to import""
  method_option :dry_run, required: false, desc: ""Just output what will be imported rather than doing it""
  method_option :post_as, aliases: '-p', required: true, desc: ""The Discourse username to","PostCreator (Critical), PostRevisor (Critical), Post (Critical), TopicEmbed (Critical), cook_methods (Critical), import_remote (High), cook (High), setup_post (High), update_post (High), topic_id_for_embed (High), absolutize_urls (High), TopicRetriever (Medium), perform_retrieve (Medium), execute (Medium), change (Medium), initialize (Medium), retrieve (Medium), Jobs (Medium), RetrieveTopic (Medium), change (Medium), change (Medium), lines 481-486 (Medium), lines 181-195 (Medium), lines 101-120 (Medium), lines 361-380 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), lines 261-280 (Medium), lines 281-300 (Medium), lines 121-140 (Medium), lines 221-240 (Medium), lines 301-320 (Medium), lines 341-360 (Medium), lines 161-180 (Medium), lines 441-460 (Medium), lines 141-160 (Medium), lines 381-400 (Medium), lines 321-340 (Medium), lines 241-260 (Medium), lines 461-480 (Medium), en (Medium), CreateTopTopics (Medium), lines 141-160 (Medium), lines 161-180 (Medium), lines 101-120 (Medium), lines 201-219 (Low), lines 481-493 (Low), comments (Low), postMessageReceived (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-69 (Low), EmbedController (Low), best (Low), ensure_embeddable (Low), Jobs (Low), PollFeed (Low), execute (Low), feed_key (Low), poll_feed (Low), import (Low), lines 1-20 (Low), lines 21-30 (Low), lines 1-12 (Low), lines 1-20 (Low), embedding (Low), CreateTopicEmbeds (Low), AddCookMethodToPosts (Low), lines 181-188 (Low), invalid_host? (Low), retrieved_recently? (Low), fetch_http (Low), lines 121-140 (Low), MigrateWordCounts (Low), revise! (Low)",partial,"ERB template error, not in the model classes flagged"
discourse,3,Add comprehensive email validation for blocked users,BlockedEmail.should_block_email? method has side effects during a read operation - it updates statistics even when just checking if an email should be blocked. This could cause race conditions in concurrent environments and makes the method name misleading.,Medium,15,3,6,"class::User (app/models/user.rb) [Critical, score=0.94] | class::EmailValidator (lib/validators/email_validator.rb) [Critical, score=0.81] | method::create (app/controllers/users_controller.rb) [Critical, score=0.79]","[Critical] class User in app/models/user.rb:
class User < ActiveRecord::Base
  include Roleable

  has_many :posts
  has_many :notifications
  has_many :topic_users
  has_many :topics
  has_many :user_open_ids, dependent: :destroy
  has_many :user_actions
  has_many :post_actions
  has_many :email_logs
  has_many :post_timings
  has_many :topic_allowed_users
  has_many :topics_allowed, through: :topic_allowed_users, source: :topic
  has_many :email_tokens
  has_many :views
  has_many :user_visits
  has_many :invites
  has_many :topic_links

  has_one :facebook_user_info, dependent: :destroy
  has_one :twitter_user_info, dependent: :destroy
  has_one :github_user_info, dependent: :destroy
  has_one :cas_user_info, dependent: :destroy
  belongs_to :approved_by, class_name: 'User'

  has_many :group_users
  has_many :groups, through: :g
---
[Critical] class EmailValidator in lib/validators/email_validator.rb:
class EmailValidator < ActiveModel::EachValidator

  def validate_each(record, attribute, value)
    if (setting = SiteSetting.email_domains_whitelist).present?
      unless email_in_restriction_setting?(setting, value)
        record.errors.add(attribute, I18n.t(:'user.email.not_allowed'))
      end
    elsif (setting = SiteSetting.email_domains_blacklist).present?
      if email_in_restriction_setting?(setting, value)
        record.errors.add(attribute, I18n.t(:'user.email.not_allowed'))
      end
    end
    if record.errors[attribute].blank? and BlockedEmail.should_block?(value)
      record.errors.add(attribute, I18n.t(:'user.email.blocked'))
    end
  end

  def email_in_restriction_setting?(setting, value)
    domains = setting.gsub('.', '\.')
    regexp = Regexp.new(""@(#{domains})
---
[Critical] method create in app/controllers/users_controller.rb:
def create
    return fake_success_response if suspicious? params

    user = User.new_from_params(params)

    auth = session[:authentication]
    if valid_session_authentication?(auth, params[:email])
      user.active = true
    end
    user.password_required! unless auth

    if user.valid? && SiteSetting.call_discourse_hub?
      DiscourseHub.register_nickname(user.username, user.email)
    end

    if user.save
      if SiteSetting.must_approve_users?
        message = I18n.t(""login.wait_approval"")
      elsif !user.active?
        message = I18n.t(""login.activate_email"", email: user.email)
        Jobs.enqueue(:user_email,
          type: :signup,
          user_id: user.id,
          email_token: user.email_tokens.first.token
        )
      else
        message = I18n.t(""login.act","[Medium] method validate_each in lib/validators/email_validator.rb:
def validate_each(record, attribute, value)
    if (setting = SiteSetting.email_domains_whitelist).present?
      unless email_in_restriction_setting?(setting, value)
        record.errors.add(attribute, I18n.t(:'user.email.not_allowed'))
      end
    elsif (setting = SiteSetting.email_domains_blacklist).present?
      if email_in_restriction_setting?(setting, value)
        record.errors.add(attribute, I18n.t(:'user.email.not_allowed'))
      end
    end
    if record.errors[attribute].blank? 
---
[Medium] method change in db/migrate/20130724201552_create_blocked_emails.rb:
def change
    create_table :blocked_emails do |t|
      t.string :email, null: false
      t.integer :action_type, null: false
      t.integer :match_count, null: false, default: 0
      t.datetime :last_match_at
      t.timestamps
    end
    add_index :blocked_emails, :email, unique: true
  end
---
[Medium] method email_validator in app/models/user.rb:
def email_validator
    if (setting = SiteSetting.email_domains_whitelist).present?
      unless email_in_restriction_setting?(setting)
        errors.add(:email, I18n.t(:'user.email.not_allowed'))
      end
    elsif (setting = SiteSetting.email_domains_blacklist).present?
      if email_in_restriction_setting?(setting)
        errors.add(:email, I18n.t(:'user.email.not_allowed'))
      end
    end
  end
---
[Medium] method email_in_restriction_setting? in app/models/user.rb:
def email_in_restriction_setting?(setting)
    domains = setting.gsub('.', '\.')
    regexp = Regexp.new(""@(#{domains})"", true)
    self.email =~ regexp
  end
---
[Medium] class UsersController in app/controllers/users_controller.rb:
class UsersController < ApplicationController

  skip_before_filter :check_xhr, only: [:show, :password_reset, :update, :activate_account, :avatar, :authorize_email, :user_preferences_redirect]
  skip_before_filter :authorize_mini_profiler, only: [:avatar]

  before_filter :ensure_logged_in, only: [:username, :update, :change_email, :user_preferences_redirect]

  # we need to allow account creation with bad CSRF tokens, if people are caching, the CSRF token on the
  #  page is going to be empty,
---
[Medium] section en in config/locales/server.en.yml:
en:
  dates:
    short_date_no_year: ""D MMM""
    short_date: ""D MMM, YYYY""
    long_date: ""MMMM D, YYYY h:mma""
  time:
    formats:
      short: ""%m-%d-%Y""
      short_no_year: ""%B %-d""
      date_only: ""%b %-d, %Y""

  title: ""Discourse""
  topics: ""Topics""
  posts: ""posts""
  loading: ""Loading""
  powered_by_html: 'Powered by <a href=""http://www.discourse.org"">Discourse</a>, best viewed with JavaScript enabled'

  via: ""%{username} via %{site_name}""
  is_reserved: ""is reserved""

  site_under_maint","User (Critical), EmailValidator (Critical), create (Critical), validate_each (Medium), change (Medium), email_validator (Medium), email_in_restriction_setting? (Medium), UsersController (Medium), en (Medium), BlockedEmail (Low), actions (Low), should_block? (Low), set_defaults (Low), CreateBlockedEmails (Low), email_in_restriction_setting? (Low)",match,'email' matches HC entity 'emailvalidator'
discourse,3,Add comprehensive email validation for blocked users,"Regex pattern @(#{domains}) only matches domain suffixes, not full domains. evil.example.com would match whitelist entry example.com.",Medium,15,3,6,"class::User (app/models/user.rb) [Critical, score=0.94] | class::EmailValidator (lib/validators/email_validator.rb) [Critical, score=0.81] | method::create (app/controllers/users_controller.rb) [Critical, score=0.79]","[Critical] class User in app/models/user.rb:
class User < ActiveRecord::Base
  include Roleable

  has_many :posts
  has_many :notifications
  has_many :topic_users
  has_many :topics
  has_many :user_open_ids, dependent: :destroy
  has_many :user_actions
  has_many :post_actions
  has_many :email_logs
  has_many :post_timings
  has_many :topic_allowed_users
  has_many :topics_allowed, through: :topic_allowed_users, source: :topic
  has_many :email_tokens
  has_many :views
  has_many :user_visits
  has_many :invites
  has_many :topic_links

  has_one :facebook_user_info, dependent: :destroy
  has_one :twitter_user_info, dependent: :destroy
  has_one :github_user_info, dependent: :destroy
  has_one :cas_user_info, dependent: :destroy
  belongs_to :approved_by, class_name: 'User'

  has_many :group_users
  has_many :groups, through: :g
---
[Critical] class EmailValidator in lib/validators/email_validator.rb:
class EmailValidator < ActiveModel::EachValidator

  def validate_each(record, attribute, value)
    if (setting = SiteSetting.email_domains_whitelist).present?
      unless email_in_restriction_setting?(setting, value)
        record.errors.add(attribute, I18n.t(:'user.email.not_allowed'))
      end
    elsif (setting = SiteSetting.email_domains_blacklist).present?
      if email_in_restriction_setting?(setting, value)
        record.errors.add(attribute, I18n.t(:'user.email.not_allowed'))
      end
    end
    if record.errors[attribute].blank? and BlockedEmail.should_block?(value)
      record.errors.add(attribute, I18n.t(:'user.email.blocked'))
    end
  end

  def email_in_restriction_setting?(setting, value)
    domains = setting.gsub('.', '\.')
    regexp = Regexp.new(""@(#{domains})
---
[Critical] method create in app/controllers/users_controller.rb:
def create
    return fake_success_response if suspicious? params

    user = User.new_from_params(params)

    auth = session[:authentication]
    if valid_session_authentication?(auth, params[:email])
      user.active = true
    end
    user.password_required! unless auth

    if user.valid? && SiteSetting.call_discourse_hub?
      DiscourseHub.register_nickname(user.username, user.email)
    end

    if user.save
      if SiteSetting.must_approve_users?
        message = I18n.t(""login.wait_approval"")
      elsif !user.active?
        message = I18n.t(""login.activate_email"", email: user.email)
        Jobs.enqueue(:user_email,
          type: :signup,
          user_id: user.id,
          email_token: user.email_tokens.first.token
        )
      else
        message = I18n.t(""login.act","[Medium] method validate_each in lib/validators/email_validator.rb:
def validate_each(record, attribute, value)
    if (setting = SiteSetting.email_domains_whitelist).present?
      unless email_in_restriction_setting?(setting, value)
        record.errors.add(attribute, I18n.t(:'user.email.not_allowed'))
      end
    elsif (setting = SiteSetting.email_domains_blacklist).present?
      if email_in_restriction_setting?(setting, value)
        record.errors.add(attribute, I18n.t(:'user.email.not_allowed'))
      end
    end
    if record.errors[attribute].blank? 
---
[Medium] method change in db/migrate/20130724201552_create_blocked_emails.rb:
def change
    create_table :blocked_emails do |t|
      t.string :email, null: false
      t.integer :action_type, null: false
      t.integer :match_count, null: false, default: 0
      t.datetime :last_match_at
      t.timestamps
    end
    add_index :blocked_emails, :email, unique: true
  end
---
[Medium] method email_validator in app/models/user.rb:
def email_validator
    if (setting = SiteSetting.email_domains_whitelist).present?
      unless email_in_restriction_setting?(setting)
        errors.add(:email, I18n.t(:'user.email.not_allowed'))
      end
    elsif (setting = SiteSetting.email_domains_blacklist).present?
      if email_in_restriction_setting?(setting)
        errors.add(:email, I18n.t(:'user.email.not_allowed'))
      end
    end
  end
---
[Medium] method email_in_restriction_setting? in app/models/user.rb:
def email_in_restriction_setting?(setting)
    domains = setting.gsub('.', '\.')
    regexp = Regexp.new(""@(#{domains})"", true)
    self.email =~ regexp
  end
---
[Medium] class UsersController in app/controllers/users_controller.rb:
class UsersController < ApplicationController

  skip_before_filter :check_xhr, only: [:show, :password_reset, :update, :activate_account, :avatar, :authorize_email, :user_preferences_redirect]
  skip_before_filter :authorize_mini_profiler, only: [:avatar]

  before_filter :ensure_logged_in, only: [:username, :update, :change_email, :user_preferences_redirect]

  # we need to allow account creation with bad CSRF tokens, if people are caching, the CSRF token on the
  #  page is going to be empty,
---
[Medium] section en in config/locales/server.en.yml:
en:
  dates:
    short_date_no_year: ""D MMM""
    short_date: ""D MMM, YYYY""
    long_date: ""MMMM D, YYYY h:mma""
  time:
    formats:
      short: ""%m-%d-%Y""
      short_no_year: ""%B %-d""
      date_only: ""%b %-d, %Y""

  title: ""Discourse""
  topics: ""Topics""
  posts: ""posts""
  loading: ""Loading""
  powered_by_html: 'Powered by <a href=""http://www.discourse.org"">Discourse</a>, best viewed with JavaScript enabled'

  via: ""%{username} via %{site_name}""
  is_reserved: ""is reserved""

  site_under_maint","User (Critical), EmailValidator (Critical), create (Critical), validate_each (Medium), change (Medium), email_validator (Medium), email_in_restriction_setting? (Medium), UsersController (Medium), en (Medium), BlockedEmail (Low), actions (Low), should_block? (Low), set_defaults (Low), CreateBlockedEmails (Low), email_in_restriction_setting? (Low)",match,'entry' matches entity 'en'
discourse,2,FEATURE: per-topic unsubscribe option in emails,"logic: Potential nil pointer exception - if no TopicUser record exists, tu will be nil and calling methods on it will crash",High,39,9,14,"class::TopicUser (app/models/topic_user.rb) [Critical, score=1.00] | class::Topic (app/models/topic.rb) [Critical, score=0.93] | class::TopicsController (app/controllers/topics_controller.rb) [Critical, score=0.81] | class::MessageBuilder (lib/email/message_builder.rb) [Critical, score=0.78] | method::send_notification_email (app/mailers/user_notifications.rb) [Critical, score=0.70] | module::Email (lib/email/message_builder.rb) [High, score=0.64] | method::perform_show_response (app/controllers/topics_controller.rb) [High, score=0.60] | method::create_lookup (app/models/topic_user.rb) [High, score=0.60] | method::initialize (lib/email/message_builder.rb) [High, score=0.60]","[Critical] class TopicUser in app/models/topic_user.rb:
class TopicUser < ActiveRecord::Base
  belongs_to :user
  belongs_to :topic

  # used for serialization
  attr_accessor :post_action_data

  scope :tracking, lambda { |topic_id|
    where(topic_id: topic_id)
   .where(""COALESCE(topic_users.notification_level, :regular) >= :tracking"",
     regular: TopicUser.notification_levels[:regular],
     tracking: TopicUser.notification_levels[:tracking])
  }

  # Class methods
  class << self

    # Enums
    def notification_levels
      @notification_levels ||= Enum.new(:muted, :regular, :tracking, :watching, start: 0)
    end

    def notification_reasons
      @notification_reasons ||= Enum.new(
        :created_topic,
        :user_changed,
        :user_interacted,
        :created_post,
        :auto_watch,
        :auto_watch_category,
      
---
[Critical] class Topic in app/models/topic.rb:
class Topic < ActiveRecord::Base
  include ActionView::Helpers::SanitizeHelper
  include RateLimiter::OnCreateRecord
  include HasCustomFields
  include Trashable
  include LimitedEdit
  extend Forwardable

  def_delegator :featured_users, :user_ids, :featured_user_ids
  def_delegator :featured_users, :choose, :feature_topic_users

  def_delegator :notifier, :watch!, :notify_watch!
  def_delegator :notifier, :tracking!, :notify_tracking!
  def_delegator :notifier, :regular!, :notify_regular!
  def_delegator :notifier, :muted!, :notify_muted!
  def_delegator :notifier, :toggle_mute, :toggle_mute

  attr_accessor :allowed_user_ids

  def self.max_sort_order
    2**31 - 1
  end

  def featured_users
    @featured_users ||= TopicFeaturedUsers.new(self)
  end

  def trash!(trashed_by=nil)
    u
---
[Critical] class TopicsController in app/controllers/topics_controller.rb:
class TopicsController < ApplicationController
  before_filter :ensure_logged_in, only: [:timings,
                                          :destroy_timings,
                                          :update,
                                          :star,
                                          :destroy,
                                          :recover,
                                          :status,
                                          :invite,
                                          :mute,
                                          :unmute,
                                          :set_notifications,
                                          :move_posts,
                                          :merge_topic,
                                          :clear_pin,
        
---
[Critical] class MessageBuilder in lib/email/message_builder.rb:
class MessageBuilder
    attr_reader :template_args

    def initialize(to, opts=nil)
      @to = to
      @opts = opts || {}

      @template_args = {
        site_name: SiteSetting.email_prefix.presence || SiteSetting.title,
        base_url: Discourse.base_url,
        user_preferences_url: ""#{Discourse.base_url}/my/preferences"",
      }.merge!(@opts)

      if @template_args[:url].present?
        if @opts[:include_respond_instructions] == false
          @template_args[:respond_instructions] = ''
        else
          @template_args[:respond_instructions] = if allow_reply_by_email?
            I18n.t('user_notifications.reply_by_email', @template_args)
          else
            I18n.t('user_notifications.visit_link_to_respond', @template_args)
          end
        end
      end
   
---
[Critical] method send_notification_email in app/mailers/user_notifications.rb:
def send_notification_email(opts)
    post = opts[:post]
    title = opts[:title]
    allow_reply_by_email = opts[:allow_reply_by_email]
    use_site_subject = opts[:use_site_subject]
    add_re_to_subject = opts[:add_re_to_subject] && post.post_number > 1
    username = opts[:username]
    from_alias = opts[:from_alias]
    notification_type = opts[:notification_type]
    user = opts[:user]

    # category name
    category = Topic.find_by(id: post.topic_id).category
    if opts[:show_category_in_subject] && post.topic_id && category && !category.uncategorized?
      show_category_in_subject = category.name

      # subcategory case
      if !category.parent_category_id.nil?
        show_category_in_subject = ""#{Category.find_by(id: category.parent_category_id).name}/#{show_category_in_su
---
[High] module Email in lib/email/message_builder.rb:
module Email

  module BuildEmailHelper
    def build_email(*builder_args)
      builder = Email::MessageBuilder.new(*builder_args)
      headers(builder.header_args) if builder.header_args.present?
      mail(builder.build_args).tap { |message|
        if message and h = builder.html_part
          message.html_part = h
        end
      }
    end
  end

  class MessageBuilder
    attr_reader :template_args

    def initialize(to, opts=nil)
      @to = to
      @opts = opts || {}

      @template_args = {
        site_name: SiteSetting.email_prefix.presence || SiteSetting.title,
        base_url: Discourse.base_url,
        user_preferences_url: ""#{Discourse.base_url}/my/preferences"",
      }.merge!(@opts)

      if @template_args[:url].present?
        if @opts[:include_respond_instructi
---
[High] method perform_show_response in app/controllers/topics_controller.rb:
def perform_show_response
    topic_view_serializer = TopicViewSerializer.new(@topic_view, scope: guardian, root: false, include_raw: !!params[:include_raw])

    respond_to do |format|
      format.html do
        @description_meta = @topic_view.topic.excerpt
        store_preloaded(""topic_#{@topic_view.topic.id}"", MultiJson.dump(topic_view_serializer))
        render :show
      end

      format.json do
        render_json_dump(topic_view_serializer)
      end
    end
  end
---
[High] method create_lookup in app/models/topic_user.rb:
def create_lookup(topic_users)
      topic_users = topic_users.to_a
      result = {}
      return result if topic_users.blank?
      topic_users.each { |ftu| result[ftu.topic_id] = ftu }
      result
    end
---
[High] method initialize in lib/email/message_builder.rb:
def initialize(to, opts=nil)
      @to = to
      @opts = opts || {}

      @template_args = {
        site_name: SiteSetting.email_prefix.presence || SiteSetting.title,
        base_url: Discourse.base_url,
        user_preferences_url: ""#{Discourse.base_url}/my/preferences"",
      }.merge!(@opts)

      if @template_args[:url].present?
        if @opts[:include_respond_instructions] == false
          @template_args[:respond_instructions] = ''
        else
          @template_args[:respond_instructions] = if allow_reply_by_email?
            I18n.t('user_notifications.reply_by_email', @template_args)
          else
            I18n.t('user_notifications.visit_link_to_respond', @template_args)
          end
        end
      end
    end","[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/routes/app-route-map.js.es6:
export default function() {
  // Error page
  this.route('exception', { path: '/exception' });

  this.resource('about', { path: '/about' });

  // Topic routes
  this.resource('topic', { path: '/t/:slug/:id' }, function() {
    this.route('fromParams', { path: '/' });
    this.route('fromParamsNear', { path: '/:nearPost' });
  });
  this.resource('topicBySlug', { path: '/t/:slug' });
  this.route('topicUnsubscribe', { path: '/t/:slug/:id/unsubscribe' });

  this.resource('discovery', { path: '/
---
[Medium] chunk lines 1-3 in app/assets/javascripts/discourse/views/topic-unsubscribe.js.es6:
export default Discourse.View.extend({
  classNames: [""topic-unsubscribe""]
});
---
[Medium] chunk lines 61-62 in app/assets/javascripts/discourse/routes/topic-from-params.js.es6:

});
---
[Medium] chunk lines 61-65 in app/assets/stylesheets/common/base/topic.scss:
#suggested-topics h3 .badge-wrapper.bullet span.badge-category-parent-bg,
#suggested-topics h3 .badge-wrapper.bullet span.badge-category-bg {
  // Top of bullet aligns with top of line - adjust line height to vertically align bullet.
  line-height: 0.8;
}
---
[Medium] chunk lines 1-20 in app/views/email/notification.html.erb:
<div id='main' class=<%= classes %>>

  <%= render partial: 'email/post', locals: { post: post } %>

  <% if context_posts.present? %>
    <div class='footer'>%{respond_instructions}</div>

    <hr>

    <h4 class='.previous-discussion'><%= t ""user_notifications.previous_discussion"" %></h4>

    <% context_posts.each do |p| %>
      <%= render partial: 'email/post', locals: { post: p } %>
    <% end %>
  <% end %>

  <hr>

  <div class='footer'>%{respond_instructions}</div>
  <div class='footer'
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/components/dropdown-button.js.es6:

  _unbindClick: function() {
    this.$().off('click.dropdown-button', 'ul li');
  }.on('willDestroyElement'),

  renderString(buffer) {
    const title = this.get('title');
    if (title) {
      buffer.push(""<h4 class='title'>"" + title + ""</h4>"");
    }

    buffer.push(""<button class='btn standard dropdown-toggle' data-toggle='dropdown'>"");
    buffer.push(this.get('text'));
    buffer.push(""</button>"");
    buffer.push(""<ul class='dropdown-menu'>"");

    const contents = this.get('dropDownC
---
[Medium] chunk lines 41-60 in app/assets/javascripts/discourse/routes/app-route-map.js.es6:

    // default filter for a category
    this.route('parentCategory', { path: '/c/:slug' });
    this.route('categoryNone', { path: '/c/:slug/none' });
    this.route('category', { path: '/c/:parentSlug/:slug' });

    // homepage
    this.route(Discourse.Utilities.defaultHomepage(), { path: '/' });
  });

  this.resource('group', { path: '/groups/:name' }, function() {
    this.route('members');
  });

  // User routes
  this.resource('users');
  this.resource('user', { path: '/users/:username
---
[Medium] chunk lines 81-100 in app/assets/javascripts/discourse/routes/app-route-map.js.es6:
    });

    this.resource('userInvited', { path: '/invited' }, function() {
      this.route('show', { path: '/:filter' });
    });
  });

  this.route('signup', {path: '/signup'});
  this.route('login', {path: '/login'});
  this.route('forgot-password', {path: '/password-reset'});
  this.route('faq', {path: '/faq'});
  this.route('tos', {path: '/tos'});
  this.route('privacy', {path: '/privacy'});
  this.route('guidelines', {path: '/guidelines'});

  this.route('new-topic', {path: '/new-topic'
---
[Medium] chunk lines 61-80 in app/assets/javascripts/discourse/routes/app-route-map.js.es6:
        self.route(userAction, { path: userAction.replace('_', '-') });
      });
    });

    this.route('badges');
    this.route('notifications');
    this.route('flaggedPosts', { path: '/flagged-posts' });
    this.route('deletedPosts', { path: '/deleted-posts' });

    this.resource('userPrivateMessages', { path: '/messages' }, function() {
      this.route('mine');
      this.route('unread');
    });

    this.resource('preferences', function() {
      this.route('username');
      this.ro
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/routes/topic-from-params.js.es6:
// This route is used for retrieving a topic based on params
export default Discourse.Route.extend({

  // Avoid default model hook
  model(params) { return params; },

  setupController(controller, params) {
    params = params || {};
    params.track_visit = true;

    const self = this,
          topic = this.modelFor('topic'),
          postStream = topic.get('postStream'),
          topicController = this.controllerFor('topic'),
          topicProgressController = this.controllerFor('topic-
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/routes/topic-from-params.js.es6:
    params.forceLoad = true;

    postStream.refresh(params).then(function () {
      // TODO we are seeing errors where closest post is null and this is exploding
      // we need better handling and logging for this condition.

      // The post we requested might not exist. Let's find the closest post
      const closestPost = postStream.closestPostForPostNumber(params.nearPost || 1),
            closest = closestPost.get('post_number'),
            progress = postStream.progressIndexOfPost(c
---
[Medium] chunk lines 41-60 in app/assets/javascripts/discourse/routes/topic-from-params.js.es6:

      // Highlight our post after the next render
      Ember.run.scheduleOnce('afterRender', function() {
        self.appEvents.trigger('post:highlight', closest);
      });

      Discourse.URL.jumpToPost(closest);

      if (topic.present('draft')) {
        composerController.open({
          draft: Discourse.Draft.getLocal(topic.get('draft_key'), topic.get('draft')),
          draftKey: topic.get('draft_key'),
          draftSequence: topic.get('draft_sequence'),
          topic: topic,
 
---
[Medium] class UserNotifications in app/mailers/user_notifications.rb:
class UserNotifications < ActionMailer::Base
  helper :application
  default charset: 'UTF-8'

  include Email::BuildEmailHelper

  def signup(user, opts={})
    build_email(user.email,
                template: ""user_notifications.signup"",
                email_token: opts[:email_token])
  end

  def signup_after_approval(user, opts={})
    build_email(user.email,
                template: 'user_notifications.signup_after_approval',
                email_token: opts[:email_token],
             
---
[Medium] method track_visit! in app/models/topic_user.rb:
def track_visit!(topic,user)
      topic_id = topic.is_a?(Topic) ? topic.id : topic
      user_id = user.is_a?(User) ? user.id : topic

      now = DateTime.now
      rows = TopicUser.where(topic_id: topic_id, user_id: user_id).update_all(last_visited_at: now)
      if rows == 0
        TopicUser.create(topic_id: topic_id, user_id: user_id, last_visited_at: now, first_visited_at: now)
      else
        observe_after_save_callbacks_for topic_id, user_id
      end
    end","TopicUser (Critical), Topic (Critical), TopicsController (Critical), MessageBuilder (Critical), send_notification_email (Critical), Email (High), perform_show_response (High), create_lookup (High), initialize (High), lines 1-20 (Medium), lines 1-3 (Medium), lines 61-62 (Medium), lines 61-65 (Medium), lines 1-20 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), lines 1-20 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), UserNotifications (Medium), track_visit! (Medium), lines 41-60 (Low), lines 21-29 (Low), lines 61-61 (Low), lines 1-9 (Low), lines 61-63 (Low), lines 1-20 (Low), lines 21-23 (Low), lines 1-8 (Low), lines 61-77 (Low), unsubscribe (Low), unsubscribe_url (Low), html_part (Low), change (Low), lines 21-40 (Low), update_last_read (Low), lines 101-105 (Low)",match,'TopicUser' matches HC entity 'topicuser'
discourse,2,FEATURE: per-topic unsubscribe option in emails,Typo in property name: 'stopNotificiationsText' should be 'stopNotificationsText' (missing 'n' in 'Notifications'),Low,39,9,14,"class::TopicUser (app/models/topic_user.rb) [Critical, score=1.00] | class::Topic (app/models/topic.rb) [Critical, score=0.93] | class::TopicsController (app/controllers/topics_controller.rb) [Critical, score=0.81] | class::MessageBuilder (lib/email/message_builder.rb) [Critical, score=0.78] | method::send_notification_email (app/mailers/user_notifications.rb) [Critical, score=0.70] | module::Email (lib/email/message_builder.rb) [High, score=0.64] | method::perform_show_response (app/controllers/topics_controller.rb) [High, score=0.60] | method::create_lookup (app/models/topic_user.rb) [High, score=0.60] | method::initialize (lib/email/message_builder.rb) [High, score=0.60]","[Critical] class TopicUser in app/models/topic_user.rb:
class TopicUser < ActiveRecord::Base
  belongs_to :user
  belongs_to :topic

  # used for serialization
  attr_accessor :post_action_data

  scope :tracking, lambda { |topic_id|
    where(topic_id: topic_id)
   .where(""COALESCE(topic_users.notification_level, :regular) >= :tracking"",
     regular: TopicUser.notification_levels[:regular],
     tracking: TopicUser.notification_levels[:tracking])
  }

  # Class methods
  class << self

    # Enums
    def notification_levels
      @notification_levels ||= Enum.new(:muted, :regular, :tracking, :watching, start: 0)
    end

    def notification_reasons
      @notification_reasons ||= Enum.new(
        :created_topic,
        :user_changed,
        :user_interacted,
        :created_post,
        :auto_watch,
        :auto_watch_category,
      
---
[Critical] class Topic in app/models/topic.rb:
class Topic < ActiveRecord::Base
  include ActionView::Helpers::SanitizeHelper
  include RateLimiter::OnCreateRecord
  include HasCustomFields
  include Trashable
  include LimitedEdit
  extend Forwardable

  def_delegator :featured_users, :user_ids, :featured_user_ids
  def_delegator :featured_users, :choose, :feature_topic_users

  def_delegator :notifier, :watch!, :notify_watch!
  def_delegator :notifier, :tracking!, :notify_tracking!
  def_delegator :notifier, :regular!, :notify_regular!
  def_delegator :notifier, :muted!, :notify_muted!
  def_delegator :notifier, :toggle_mute, :toggle_mute

  attr_accessor :allowed_user_ids

  def self.max_sort_order
    2**31 - 1
  end

  def featured_users
    @featured_users ||= TopicFeaturedUsers.new(self)
  end

  def trash!(trashed_by=nil)
    u
---
[Critical] class TopicsController in app/controllers/topics_controller.rb:
class TopicsController < ApplicationController
  before_filter :ensure_logged_in, only: [:timings,
                                          :destroy_timings,
                                          :update,
                                          :star,
                                          :destroy,
                                          :recover,
                                          :status,
                                          :invite,
                                          :mute,
                                          :unmute,
                                          :set_notifications,
                                          :move_posts,
                                          :merge_topic,
                                          :clear_pin,
        
---
[Critical] class MessageBuilder in lib/email/message_builder.rb:
class MessageBuilder
    attr_reader :template_args

    def initialize(to, opts=nil)
      @to = to
      @opts = opts || {}

      @template_args = {
        site_name: SiteSetting.email_prefix.presence || SiteSetting.title,
        base_url: Discourse.base_url,
        user_preferences_url: ""#{Discourse.base_url}/my/preferences"",
      }.merge!(@opts)

      if @template_args[:url].present?
        if @opts[:include_respond_instructions] == false
          @template_args[:respond_instructions] = ''
        else
          @template_args[:respond_instructions] = if allow_reply_by_email?
            I18n.t('user_notifications.reply_by_email', @template_args)
          else
            I18n.t('user_notifications.visit_link_to_respond', @template_args)
          end
        end
      end
   
---
[Critical] method send_notification_email in app/mailers/user_notifications.rb:
def send_notification_email(opts)
    post = opts[:post]
    title = opts[:title]
    allow_reply_by_email = opts[:allow_reply_by_email]
    use_site_subject = opts[:use_site_subject]
    add_re_to_subject = opts[:add_re_to_subject] && post.post_number > 1
    username = opts[:username]
    from_alias = opts[:from_alias]
    notification_type = opts[:notification_type]
    user = opts[:user]

    # category name
    category = Topic.find_by(id: post.topic_id).category
    if opts[:show_category_in_subject] && post.topic_id && category && !category.uncategorized?
      show_category_in_subject = category.name

      # subcategory case
      if !category.parent_category_id.nil?
        show_category_in_subject = ""#{Category.find_by(id: category.parent_category_id).name}/#{show_category_in_su
---
[High] module Email in lib/email/message_builder.rb:
module Email

  module BuildEmailHelper
    def build_email(*builder_args)
      builder = Email::MessageBuilder.new(*builder_args)
      headers(builder.header_args) if builder.header_args.present?
      mail(builder.build_args).tap { |message|
        if message and h = builder.html_part
          message.html_part = h
        end
      }
    end
  end

  class MessageBuilder
    attr_reader :template_args

    def initialize(to, opts=nil)
      @to = to
      @opts = opts || {}

      @template_args = {
        site_name: SiteSetting.email_prefix.presence || SiteSetting.title,
        base_url: Discourse.base_url,
        user_preferences_url: ""#{Discourse.base_url}/my/preferences"",
      }.merge!(@opts)

      if @template_args[:url].present?
        if @opts[:include_respond_instructi
---
[High] method perform_show_response in app/controllers/topics_controller.rb:
def perform_show_response
    topic_view_serializer = TopicViewSerializer.new(@topic_view, scope: guardian, root: false, include_raw: !!params[:include_raw])

    respond_to do |format|
      format.html do
        @description_meta = @topic_view.topic.excerpt
        store_preloaded(""topic_#{@topic_view.topic.id}"", MultiJson.dump(topic_view_serializer))
        render :show
      end

      format.json do
        render_json_dump(topic_view_serializer)
      end
    end
  end
---
[High] method create_lookup in app/models/topic_user.rb:
def create_lookup(topic_users)
      topic_users = topic_users.to_a
      result = {}
      return result if topic_users.blank?
      topic_users.each { |ftu| result[ftu.topic_id] = ftu }
      result
    end
---
[High] method initialize in lib/email/message_builder.rb:
def initialize(to, opts=nil)
      @to = to
      @opts = opts || {}

      @template_args = {
        site_name: SiteSetting.email_prefix.presence || SiteSetting.title,
        base_url: Discourse.base_url,
        user_preferences_url: ""#{Discourse.base_url}/my/preferences"",
      }.merge!(@opts)

      if @template_args[:url].present?
        if @opts[:include_respond_instructions] == false
          @template_args[:respond_instructions] = ''
        else
          @template_args[:respond_instructions] = if allow_reply_by_email?
            I18n.t('user_notifications.reply_by_email', @template_args)
          else
            I18n.t('user_notifications.visit_link_to_respond', @template_args)
          end
        end
      end
    end","[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/routes/app-route-map.js.es6:
export default function() {
  // Error page
  this.route('exception', { path: '/exception' });

  this.resource('about', { path: '/about' });

  // Topic routes
  this.resource('topic', { path: '/t/:slug/:id' }, function() {
    this.route('fromParams', { path: '/' });
    this.route('fromParamsNear', { path: '/:nearPost' });
  });
  this.resource('topicBySlug', { path: '/t/:slug' });
  this.route('topicUnsubscribe', { path: '/t/:slug/:id/unsubscribe' });

  this.resource('discovery', { path: '/
---
[Medium] chunk lines 1-3 in app/assets/javascripts/discourse/views/topic-unsubscribe.js.es6:
export default Discourse.View.extend({
  classNames: [""topic-unsubscribe""]
});
---
[Medium] chunk lines 61-62 in app/assets/javascripts/discourse/routes/topic-from-params.js.es6:

});
---
[Medium] chunk lines 61-65 in app/assets/stylesheets/common/base/topic.scss:
#suggested-topics h3 .badge-wrapper.bullet span.badge-category-parent-bg,
#suggested-topics h3 .badge-wrapper.bullet span.badge-category-bg {
  // Top of bullet aligns with top of line - adjust line height to vertically align bullet.
  line-height: 0.8;
}
---
[Medium] chunk lines 1-20 in app/views/email/notification.html.erb:
<div id='main' class=<%= classes %>>

  <%= render partial: 'email/post', locals: { post: post } %>

  <% if context_posts.present? %>
    <div class='footer'>%{respond_instructions}</div>

    <hr>

    <h4 class='.previous-discussion'><%= t ""user_notifications.previous_discussion"" %></h4>

    <% context_posts.each do |p| %>
      <%= render partial: 'email/post', locals: { post: p } %>
    <% end %>
  <% end %>

  <hr>

  <div class='footer'>%{respond_instructions}</div>
  <div class='footer'
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/components/dropdown-button.js.es6:

  _unbindClick: function() {
    this.$().off('click.dropdown-button', 'ul li');
  }.on('willDestroyElement'),

  renderString(buffer) {
    const title = this.get('title');
    if (title) {
      buffer.push(""<h4 class='title'>"" + title + ""</h4>"");
    }

    buffer.push(""<button class='btn standard dropdown-toggle' data-toggle='dropdown'>"");
    buffer.push(this.get('text'));
    buffer.push(""</button>"");
    buffer.push(""<ul class='dropdown-menu'>"");

    const contents = this.get('dropDownC
---
[Medium] chunk lines 41-60 in app/assets/javascripts/discourse/routes/app-route-map.js.es6:

    // default filter for a category
    this.route('parentCategory', { path: '/c/:slug' });
    this.route('categoryNone', { path: '/c/:slug/none' });
    this.route('category', { path: '/c/:parentSlug/:slug' });

    // homepage
    this.route(Discourse.Utilities.defaultHomepage(), { path: '/' });
  });

  this.resource('group', { path: '/groups/:name' }, function() {
    this.route('members');
  });

  // User routes
  this.resource('users');
  this.resource('user', { path: '/users/:username
---
[Medium] chunk lines 81-100 in app/assets/javascripts/discourse/routes/app-route-map.js.es6:
    });

    this.resource('userInvited', { path: '/invited' }, function() {
      this.route('show', { path: '/:filter' });
    });
  });

  this.route('signup', {path: '/signup'});
  this.route('login', {path: '/login'});
  this.route('forgot-password', {path: '/password-reset'});
  this.route('faq', {path: '/faq'});
  this.route('tos', {path: '/tos'});
  this.route('privacy', {path: '/privacy'});
  this.route('guidelines', {path: '/guidelines'});

  this.route('new-topic', {path: '/new-topic'
---
[Medium] chunk lines 61-80 in app/assets/javascripts/discourse/routes/app-route-map.js.es6:
        self.route(userAction, { path: userAction.replace('_', '-') });
      });
    });

    this.route('badges');
    this.route('notifications');
    this.route('flaggedPosts', { path: '/flagged-posts' });
    this.route('deletedPosts', { path: '/deleted-posts' });

    this.resource('userPrivateMessages', { path: '/messages' }, function() {
      this.route('mine');
      this.route('unread');
    });

    this.resource('preferences', function() {
      this.route('username');
      this.ro
---
[Medium] chunk lines 1-20 in app/assets/javascripts/discourse/routes/topic-from-params.js.es6:
// This route is used for retrieving a topic based on params
export default Discourse.Route.extend({

  // Avoid default model hook
  model(params) { return params; },

  setupController(controller, params) {
    params = params || {};
    params.track_visit = true;

    const self = this,
          topic = this.modelFor('topic'),
          postStream = topic.get('postStream'),
          topicController = this.controllerFor('topic'),
          topicProgressController = this.controllerFor('topic-
---
[Medium] chunk lines 21-40 in app/assets/javascripts/discourse/routes/topic-from-params.js.es6:
    params.forceLoad = true;

    postStream.refresh(params).then(function () {
      // TODO we are seeing errors where closest post is null and this is exploding
      // we need better handling and logging for this condition.

      // The post we requested might not exist. Let's find the closest post
      const closestPost = postStream.closestPostForPostNumber(params.nearPost || 1),
            closest = closestPost.get('post_number'),
            progress = postStream.progressIndexOfPost(c
---
[Medium] chunk lines 41-60 in app/assets/javascripts/discourse/routes/topic-from-params.js.es6:

      // Highlight our post after the next render
      Ember.run.scheduleOnce('afterRender', function() {
        self.appEvents.trigger('post:highlight', closest);
      });

      Discourse.URL.jumpToPost(closest);

      if (topic.present('draft')) {
        composerController.open({
          draft: Discourse.Draft.getLocal(topic.get('draft_key'), topic.get('draft')),
          draftKey: topic.get('draft_key'),
          draftSequence: topic.get('draft_sequence'),
          topic: topic,
 
---
[Medium] class UserNotifications in app/mailers/user_notifications.rb:
class UserNotifications < ActionMailer::Base
  helper :application
  default charset: 'UTF-8'

  include Email::BuildEmailHelper

  def signup(user, opts={})
    build_email(user.email,
                template: ""user_notifications.signup"",
                email_token: opts[:email_token])
  end

  def signup_after_approval(user, opts={})
    build_email(user.email,
                template: 'user_notifications.signup_after_approval',
                email_token: opts[:email_token],
             
---
[Medium] method track_visit! in app/models/topic_user.rb:
def track_visit!(topic,user)
      topic_id = topic.is_a?(Topic) ? topic.id : topic
      user_id = user.is_a?(User) ? user.id : topic

      now = DateTime.now
      rows = TopicUser.where(topic_id: topic_id, user_id: user_id).update_all(last_visited_at: now)
      if rows == 0
        TopicUser.create(topic_id: topic_id, user_id: user_id, last_visited_at: now, first_visited_at: now)
      else
        observe_after_save_callbacks_for topic_id, user_id
      end
    end","TopicUser (Critical), Topic (Critical), TopicsController (Critical), MessageBuilder (Critical), send_notification_email (Critical), Email (High), perform_show_response (High), create_lookup (High), initialize (High), lines 1-20 (Medium), lines 1-3 (Medium), lines 61-62 (Medium), lines 61-65 (Medium), lines 1-20 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), lines 81-100 (Medium), lines 61-80 (Medium), lines 1-20 (Medium), lines 21-40 (Medium), lines 41-60 (Medium), UserNotifications (Medium), track_visit! (Medium), lines 41-60 (Low), lines 21-29 (Low), lines 61-61 (Low), lines 1-9 (Low), lines 61-63 (Low), lines 1-20 (Low), lines 21-23 (Low), lines 1-8 (Low), lines 61-77 (Low), unsubscribe (Low), unsubscribe_url (Low), html_part (Low), change (Low), lines 21-40 (Low), update_last_read (Low), lines 101-105 (Low)",miss,"typo is in JavaScript frontend code, not in Ruby models/controllers flagged"
discourse,1,FEATURE: automatically downsize large images,"The downsize method is defined twice. The second definition, which expects a single dimensions string parameter, overrides the first, which expected separate max_width and max_height parameters. This makes the original method unreachable and breaks existing code that calls it with separate width and height arguments.",Medium,8,6,2,"method::create_upload (app/controllers/uploads_controller.rb) [Critical, score=1.00] | method::resize (app/models/optimized_image.rb) [Critical, score=1.00] | class::OptimizedImage (app/models/optimized_image.rb) [Critical, score=1.00] | method::optimize (app/models/optimized_image.rb) [Critical, score=0.94] | method::downsize (app/models/optimized_image.rb) [Critical, score=0.79] | class::UploadsController (app/controllers/uploads_controller.rb) [High, score=0.67]","[Critical] method create_upload in app/controllers/uploads_controller.rb:
def create_upload(type, file, url)
    begin
      # API can provide a URL
      if file.nil? && url.present? && is_api?
        tempfile = FileHelper.download(url, 10.megabytes, ""discourse-upload-#{type}"") rescue nil
        filename = File.basename(URI.parse(url).path)
      else
        tempfile = file.tempfile
        filename = file.original_filename
        content_type = file.content_type
      end

      # allow users to upload large images that will be automatically reduced to allowed size
      if tempfile && tempfile.size > 0 && SiteSetting.max_image_size_kb > 0 && FileHelper.is_image?(filename)
        attempt = 5
        while attempt > 0 && tempfile.size > SiteSetting.max_image_size_kb.kilobytes
          OptimizedImage.downsize(tempfile.path, tempfile.path, ""80%"", allow_anim
---
[Critical] method resize in app/models/optimized_image.rb:
def self.resize(from, to, width, height, opts={})
    optimize(""resize"", from, to, ""#{width}x#{height}"", opts)
  end
---
[Critical] class OptimizedImage in app/models/optimized_image.rb:
class OptimizedImage < ActiveRecord::Base
  belongs_to :upload

  # BUMP UP if optimized image algorithm changes
  VERSION = 1

  def self.create_for(upload, width, height, opts={})
    return unless width > 0 && height > 0
    return if upload.try(:sha1).blank?

    DistributedMutex.synchronize(""optimized_image_#{upload.id}_#{width}_#{height}"") do
      # do we already have that thumbnail?
      thumbnail = find_by(upload_id: upload.id, width: width, height: height)

      # make sure we have an url
      if thumbnail && thumbnail.url.blank?
        thumbnail.destroy
        thumbnail = nil
      end

      # return the previous thumbnail if any
      return thumbnail unless thumbnail.nil?

      # create the thumbnail otherwise
      original_path = Discourse.store.path_for(upload)
     
---
[Critical] method optimize in app/models/optimized_image.rb:
def self.optimize(operation, from, to, dimensions, opts={})
    method_name = ""#{operation}_instructions""
    method_name += ""_animated"" if !!opts[:allow_animation] && from =~ /\.GIF$/i
    instructions = self.send(method_name.to_sym, from, to, dimensions, opts)
    convert_with(instructions, to)
  end
---
[Critical] method downsize in app/models/optimized_image.rb:
def self.downsize(from, to, dimensions, opts={})
    optimize(""downsize"", from, to, dimensions, opts)
  end
---
[High] class UploadsController in app/controllers/uploads_controller.rb:
class UploadsController < ApplicationController
  before_filter :ensure_logged_in, except: [:show]
  skip_before_filter :preload_json, :check_xhr, :redirect_to_login_if_required, only: [:show]

  def create
    type = params.require(:type)
    file = params[:file] || params[:files].try(:first)
    url = params[:url]
    client_id = params[:client_id]
    synchronous = is_api? && params[:synchronous]

    # HACK FOR IE9 to prevent the ""download dialog""
    response.headers[""Content-Type""] = ""text/plain"" if request.user_agent =~ /MSIE 9/

    if synchronous
      data = create_upload(type, file, url)
      render json: data.as_json
    else
      Scheduler::Defer.later(""Create Upload"") do
        data = create_upload(type, file, url)
        MessageBus.publish(""/uploads/#{type}"", data.as_jso","[Medium] method dimensions in app/models/optimized_image.rb:
def self.dimensions(width, height)
    ""#{width}x#{height}""
  end
---
[Medium] variable maxSizeKB in app/assets/javascripts/discourse/lib/utilities.js:
var maxSizeKB = 10 * 1024;","create_upload (Critical), resize (Critical), OptimizedImage (Critical), optimize (Critical), downsize (Critical), UploadsController (High), dimensions (Medium), maxSizeKB (Medium)",match,'downsize' matches HC entity 'downsize'
discourse,1,FEATURE: automatically downsize large images,"Hardcoding maxSizeKB = 10 * 1024 ignores Discourse.SiteSettings['max_' + type + '_size_kb'], so the client-side limit can diverge from server-side and per-type settings (also applies to the 413 handler below).",Low,8,6,2,"method::create_upload (app/controllers/uploads_controller.rb) [Critical, score=1.00] | method::resize (app/models/optimized_image.rb) [Critical, score=1.00] | class::OptimizedImage (app/models/optimized_image.rb) [Critical, score=1.00] | method::optimize (app/models/optimized_image.rb) [Critical, score=0.94] | method::downsize (app/models/optimized_image.rb) [Critical, score=0.79] | class::UploadsController (app/controllers/uploads_controller.rb) [High, score=0.67]","[Critical] method create_upload in app/controllers/uploads_controller.rb:
def create_upload(type, file, url)
    begin
      # API can provide a URL
      if file.nil? && url.present? && is_api?
        tempfile = FileHelper.download(url, 10.megabytes, ""discourse-upload-#{type}"") rescue nil
        filename = File.basename(URI.parse(url).path)
      else
        tempfile = file.tempfile
        filename = file.original_filename
        content_type = file.content_type
      end

      # allow users to upload large images that will be automatically reduced to allowed size
      if tempfile && tempfile.size > 0 && SiteSetting.max_image_size_kb > 0 && FileHelper.is_image?(filename)
        attempt = 5
        while attempt > 0 && tempfile.size > SiteSetting.max_image_size_kb.kilobytes
          OptimizedImage.downsize(tempfile.path, tempfile.path, ""80%"", allow_anim
---
[Critical] method resize in app/models/optimized_image.rb:
def self.resize(from, to, width, height, opts={})
    optimize(""resize"", from, to, ""#{width}x#{height}"", opts)
  end
---
[Critical] class OptimizedImage in app/models/optimized_image.rb:
class OptimizedImage < ActiveRecord::Base
  belongs_to :upload

  # BUMP UP if optimized image algorithm changes
  VERSION = 1

  def self.create_for(upload, width, height, opts={})
    return unless width > 0 && height > 0
    return if upload.try(:sha1).blank?

    DistributedMutex.synchronize(""optimized_image_#{upload.id}_#{width}_#{height}"") do
      # do we already have that thumbnail?
      thumbnail = find_by(upload_id: upload.id, width: width, height: height)

      # make sure we have an url
      if thumbnail && thumbnail.url.blank?
        thumbnail.destroy
        thumbnail = nil
      end

      # return the previous thumbnail if any
      return thumbnail unless thumbnail.nil?

      # create the thumbnail otherwise
      original_path = Discourse.store.path_for(upload)
     
---
[Critical] method optimize in app/models/optimized_image.rb:
def self.optimize(operation, from, to, dimensions, opts={})
    method_name = ""#{operation}_instructions""
    method_name += ""_animated"" if !!opts[:allow_animation] && from =~ /\.GIF$/i
    instructions = self.send(method_name.to_sym, from, to, dimensions, opts)
    convert_with(instructions, to)
  end
---
[Critical] method downsize in app/models/optimized_image.rb:
def self.downsize(from, to, dimensions, opts={})
    optimize(""downsize"", from, to, dimensions, opts)
  end
---
[High] class UploadsController in app/controllers/uploads_controller.rb:
class UploadsController < ApplicationController
  before_filter :ensure_logged_in, except: [:show]
  skip_before_filter :preload_json, :check_xhr, :redirect_to_login_if_required, only: [:show]

  def create
    type = params.require(:type)
    file = params[:file] || params[:files].try(:first)
    url = params[:url]
    client_id = params[:client_id]
    synchronous = is_api? && params[:synchronous]

    # HACK FOR IE9 to prevent the ""download dialog""
    response.headers[""Content-Type""] = ""text/plain"" if request.user_agent =~ /MSIE 9/

    if synchronous
      data = create_upload(type, file, url)
      render json: data.as_json
    else
      Scheduler::Defer.later(""Create Upload"") do
        data = create_upload(type, file, url)
        MessageBus.publish(""/uploads/#{type}"", data.as_jso","[Medium] method dimensions in app/models/optimized_image.rb:
def self.dimensions(width, height)
    ""#{width}x#{height}""
  end
---
[Medium] variable maxSizeKB in app/assets/javascripts/discourse/lib/utilities.js:
var maxSizeKB = 10 * 1024;","create_upload (Critical), resize (Critical), OptimizedImage (Critical), optimize (Critical), downsize (Critical), UploadsController (High), dimensions (Medium), maxSizeKB (Medium)",match,'maxSizeKB' matches entity 'maxsizekb'
discourse,1,FEATURE: automatically downsize large images,"Passing 80% as the dimensions can fail for animated GIFs when allow_animated_thumbnails is true, since the animated path uses gifsicle --resize-fit which expects WxH geometry, not a percentage; downsizing would then silently fail.",Medium,8,6,2,"method::create_upload (app/controllers/uploads_controller.rb) [Critical, score=1.00] | method::resize (app/models/optimized_image.rb) [Critical, score=1.00] | class::OptimizedImage (app/models/optimized_image.rb) [Critical, score=1.00] | method::optimize (app/models/optimized_image.rb) [Critical, score=0.94] | method::downsize (app/models/optimized_image.rb) [Critical, score=0.79] | class::UploadsController (app/controllers/uploads_controller.rb) [High, score=0.67]","[Critical] method create_upload in app/controllers/uploads_controller.rb:
def create_upload(type, file, url)
    begin
      # API can provide a URL
      if file.nil? && url.present? && is_api?
        tempfile = FileHelper.download(url, 10.megabytes, ""discourse-upload-#{type}"") rescue nil
        filename = File.basename(URI.parse(url).path)
      else
        tempfile = file.tempfile
        filename = file.original_filename
        content_type = file.content_type
      end

      # allow users to upload large images that will be automatically reduced to allowed size
      if tempfile && tempfile.size > 0 && SiteSetting.max_image_size_kb > 0 && FileHelper.is_image?(filename)
        attempt = 5
        while attempt > 0 && tempfile.size > SiteSetting.max_image_size_kb.kilobytes
          OptimizedImage.downsize(tempfile.path, tempfile.path, ""80%"", allow_anim
---
[Critical] method resize in app/models/optimized_image.rb:
def self.resize(from, to, width, height, opts={})
    optimize(""resize"", from, to, ""#{width}x#{height}"", opts)
  end
---
[Critical] class OptimizedImage in app/models/optimized_image.rb:
class OptimizedImage < ActiveRecord::Base
  belongs_to :upload

  # BUMP UP if optimized image algorithm changes
  VERSION = 1

  def self.create_for(upload, width, height, opts={})
    return unless width > 0 && height > 0
    return if upload.try(:sha1).blank?

    DistributedMutex.synchronize(""optimized_image_#{upload.id}_#{width}_#{height}"") do
      # do we already have that thumbnail?
      thumbnail = find_by(upload_id: upload.id, width: width, height: height)

      # make sure we have an url
      if thumbnail && thumbnail.url.blank?
        thumbnail.destroy
        thumbnail = nil
      end

      # return the previous thumbnail if any
      return thumbnail unless thumbnail.nil?

      # create the thumbnail otherwise
      original_path = Discourse.store.path_for(upload)
     
---
[Critical] method optimize in app/models/optimized_image.rb:
def self.optimize(operation, from, to, dimensions, opts={})
    method_name = ""#{operation}_instructions""
    method_name += ""_animated"" if !!opts[:allow_animation] && from =~ /\.GIF$/i
    instructions = self.send(method_name.to_sym, from, to, dimensions, opts)
    convert_with(instructions, to)
  end
---
[Critical] method downsize in app/models/optimized_image.rb:
def self.downsize(from, to, dimensions, opts={})
    optimize(""downsize"", from, to, dimensions, opts)
  end
---
[High] class UploadsController in app/controllers/uploads_controller.rb:
class UploadsController < ApplicationController
  before_filter :ensure_logged_in, except: [:show]
  skip_before_filter :preload_json, :check_xhr, :redirect_to_login_if_required, only: [:show]

  def create
    type = params.require(:type)
    file = params[:file] || params[:files].try(:first)
    url = params[:url]
    client_id = params[:client_id]
    synchronous = is_api? && params[:synchronous]

    # HACK FOR IE9 to prevent the ""download dialog""
    response.headers[""Content-Type""] = ""text/plain"" if request.user_agent =~ /MSIE 9/

    if synchronous
      data = create_upload(type, file, url)
      render json: data.as_json
    else
      Scheduler::Defer.later(""Create Upload"") do
        data = create_upload(type, file, url)
        MessageBus.publish(""/uploads/#{type}"", data.as_jso","[Medium] method dimensions in app/models/optimized_image.rb:
def self.dimensions(width, height)
    ""#{width}x#{height}""
  end
---
[Medium] variable maxSizeKB in app/assets/javascripts/discourse/lib/utilities.js:
var maxSizeKB = 10 * 1024;","create_upload (Critical), resize (Critical), OptimizedImage (Critical), optimize (Critical), downsize (Critical), UploadsController (High), dimensions (Medium), maxSizeKB (Medium)",match,'resize' matches HC entity 'resize'
grafana,10,Unified Storage Performance Optimizations,A race condition in BuildIndex allows multiple goroutines to concurrently build the same expensive index for the same key. This is caused by moving the b.cacheMu lock from protecting the entire function to only protecting the final cache assignment. ,High,20,6,14,"method::build (pkg/storage/unified/resource/search.go) [Critical, score=1.00] | function::NewResourceServer (pkg/storage/unified/resource/server.go) [Critical, score=0.94] | method::Init (pkg/storage/unified/resource/server.go) [High, score=0.70] | method::Search (pkg/storage/unified/resource/server.go) [High, score=0.64] | method::List (pkg/storage/unified/resource/server.go) [High, score=0.53] | method::Read (pkg/storage/unified/resource/server.go) [High, score=0.53]","[Critical] method build in pkg/storage/unified/resource/search.go:
func (s *searchSupport) build(ctx context.Context, nsr NamespacedResource, size int64, rv int64) (ResourceIndex, int64, error) {
	ctx, span := s.tracer.Start(ctx, tracingPrexfixSearch+""Build"")
	defer span.End()

	builder, err := s.builders.get(ctx, nsr)
	if err != nil {
		return nil, 0, err
	}
	fields := s.builders.GetFields(nsr)

	s.log.Debug(fmt.Sprintf(""TODO, build %+v (size:%d, rv:%d) // builder:%+v\n"", nsr, size, rv, builder))

	key := &ResourceKey{
		Group:     nsr.Group,
		Resource:  nsr.Resource,
		Namespace: nsr.Namespace,
	}
	index, err := s.search.BuildIndex(ctx, nsr, size, rv, fields, func(index ResourceIndex) (int64, error) {
		rv, err = s.storage.ListIterator(ctx, &ListRequest{
			Limit: 1000000000000, // big number
			Options: &ListOptions{
				Key: key,
			},
		}, func(iter
---
[Critical] function NewResourceServer in pkg/storage/unified/resource/server.go:
func NewResourceServer(opts ResourceServerOptions) (ResourceServer, error) {
	if opts.Tracer == nil {
		opts.Tracer = noop.NewTracerProvider().Tracer(""resource-server"")
	}

	if opts.Backend == nil {
		return nil, fmt.Errorf(""missing Backend implementation"")
	}

	if opts.AccessClient == nil {
		opts.AccessClient = &staticAuthzClient{allowed: true} // everything OK
	}

	if opts.Diagnostics == nil {
		opts.Diagnostics = &noopService{}
	}
	if opts.Now == nil {
		opts.Now = func() int64 {
			return time.Now().UnixMilli()
		}
	}

	// Initialize the blob storage
	blobstore := opts.Blob.Backend
	if blobstore == nil && opts.Blob.URL != """" {
		ctx := context.Background()
		bucket, err := OpenBlobBucket(ctx, opts.Blob.URL)
		if err != nil {
			return nil, err
		}

		blobstore, err = NewCDKBlobSupport
---
[High] method Init in pkg/storage/unified/resource/server.go:
func (s *server) Init(ctx context.Context) error {
	s.once.Do(func() {
		// Call lifecycle hooks
		if s.lifecycle != nil {
			err := s.lifecycle.Init(ctx)
			if err != nil {
				s.initErr = fmt.Errorf(""initialize Resource Server: %w"", err)
			}
		}

		// initialize the search index
		if s.initErr == nil && s.search != nil {
			s.initErr = s.search.init(ctx)
		}

		// Start watching for changes
		if s.initErr == nil {
			s.initErr = s.initWatcher()
		}

		if s.initErr != nil {
			s.log.Error(""error initializing resource server"", ""error"", s.initErr)
		}
	})
	return s.initErr
}
---
[High] method Search in pkg/storage/unified/resource/server.go:
func (s *server) Search(ctx context.Context, req *ResourceSearchRequest) (*ResourceSearchResponse, error) {
	if s.search == nil {
		return nil, fmt.Errorf(""search index not configured"")
	}
	return s.search.Search(ctx, req)
}
---
[High] method List in pkg/storage/unified/resource/server.go:
func (s *server) List(ctx context.Context, req *ListRequest) (*ListResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""storage_server.List"")
	defer span.End()

	user, ok := claims.From(ctx)
	if !ok || user == nil {
		return &ListResponse{
			Error: &ErrorResult{
				Message: ""no user found in context"",
				Code:    http.StatusUnauthorized,
			}}, nil
	}

	if req.Limit < 1 {
		req.Limit = 50 // default max 50 items in a page
	}
	maxPageBytes := 1024 * 1024 * 2 // 2mb/page
	pageBytes := 0
	rsp := &ListResponse{}

	key := req.Options.Key
	checker, err := s.access.Compile(ctx, user, authz.ListRequest{
		Group:     key.Group,
		Resource:  key.Resource,
		Namespace: key.Namespace,
	})
	if err != nil {
		return &ListResponse{Error: AsErrorResult(err)}, nil
	}
	if checker == nil {
		return &List
---
[High] method Read in pkg/storage/unified/resource/server.go:
func (s *server) Read(ctx context.Context, req *ReadRequest) (*ReadResponse, error) {
	user, ok := claims.From(ctx)
	if !ok || user == nil {
		return &ReadResponse{
			Error: &ErrorResult{
				Message: ""no user found in context"",
				Code:    http.StatusUnauthorized,
			}}, nil
	}

	// if req.Key.Group == """" {
	// 	status, _ := AsErrorResult(apierrors.NewBadRequest(""missing group""))
	// 	return &ReadResponse{Status: status}, nil
	// }
	if req.Key.Resource == """" {
		return &ReadResponse{Error: NewBadRequestError(""missing resource"")}, nil
	}

	rsp := s.backend.ReadResource(ctx, req)

	a, err := s.access.Check(ctx, user, authz.CheckRequest{
		Verb:      ""get"",
		Group:     req.Key.Group,
		Resource:  req.Key.Resource,
		Namespace: req.Key.Namespace,
		Name:      req.Key.Name,
		Folder:    rsp","[Medium] function TestIntegrationWillRunInstrumentationServerWhenTargetHasNoHttpServer in pkg/server/module_server_test.go:
func TestIntegrationWillRunInstrumentationServerWhenTargetHasNoHttpServer(t *testing.T) {
	if testing.Short() {
		t.Skip(""skipping integration test"")
	}
	dbType := os.Getenv(""GRAFANA_TEST_DB"")
	if dbType == """" {
		t.Skip(""skipping - GRAFANA_TEST_DB not defined"")
	}
	if dbType == ""sqlite3"" {
		t.Skip(""skipping - sqlite not supported for storage server target"")
	}
	// TODO - fix this test for postgres
	if dbType == ""postgres"" {
		t.Skip(""skipping - test not working with postgres in Drone. Works lo
---
[Medium] method History in pkg/storage/unified/resource/server.go:
func (s *server) History(ctx context.Context, req *HistoryRequest) (*HistoryResponse, error) {
	return s.search.History(ctx, req)
}
---
[Medium] method Create in pkg/storage/unified/resource/server.go:
func (s *server) Create(ctx context.Context, req *CreateRequest) (*CreateResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""storage_server.Create"")
	defer span.End()

	rsp := &CreateResponse{}
	user, ok := claims.From(ctx)
	if !ok || user == nil {
		rsp.Error = &ErrorResult{
			Message: ""no user found in context"",
			Code:    http.StatusUnauthorized,
		}
		return rsp, nil
	}

	found := s.backend.ReadResource(ctx, &ReadRequest{Key: req.Key})
	if found != nil && len(found.Value) > 0 {
		rsp.Err
---
[Medium] method PutBlob in pkg/storage/unified/resource/server.go:
func (s *server) PutBlob(ctx context.Context, req *PutBlobRequest) (*PutBlobResponse, error) {
	if s.blob == nil {
		return &PutBlobResponse{Error: &ErrorResult{
			Message: ""blob store not configured"",
			Code:    http.StatusNotImplemented,
		}}, nil
	}

	rsp, err := s.blob.PutResourceBlob(ctx, req)
	if err != nil {
		rsp.Error = AsErrorResult(err)
	}
	return rsp, nil
}
---
[Medium] method Delete in pkg/storage/unified/resource/server.go:
func (s *server) Delete(ctx context.Context, req *DeleteRequest) (*DeleteResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""storage_server.Delete"")
	defer span.End()

	rsp := &DeleteResponse{}
	if req.ResourceVersion < 0 {
		return nil, apierrors.NewBadRequest(""update must include the previous version"")
	}
	user, ok := claims.From(ctx)
	if !ok || user == nil {
		rsp.Error = &ErrorResult{
			Message: ""no user found in context"",
			Code:    http.StatusUnauthorized,
		}
		return rsp, nil
	}

	la
---
[Medium] method Update in pkg/storage/unified/resource/server.go:
func (s *server) Update(ctx context.Context, req *UpdateRequest) (*UpdateResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""storage_server.Update"")
	defer span.End()

	rsp := &UpdateResponse{}
	user, ok := claims.From(ctx)
	if !ok || user == nil {
		rsp.Error = &ErrorResult{
			Message: ""no user found in context"",
			Code:    http.StatusUnauthorized,
		}
		return rsp, nil
	}
	if req.ResourceVersion < 0 {
		rsp.Error = AsErrorResult(apierrors.NewBadRequest(""update must include the previous ver
---
[Medium] method Origin in pkg/storage/unified/resource/server.go:
func (s *server) Origin(ctx context.Context, req *OriginRequest) (*OriginResponse, error) {
	return s.search.Origin(ctx, req)
}
---
[Medium] method IsHealthy in pkg/storage/unified/resource/server.go:
func (s *server) IsHealthy(ctx context.Context, req *HealthCheckRequest) (*HealthCheckResponse, error) {
	return s.diagnostics.IsHealthy(ctx, req)
}
---
[Medium] method GetBlob in pkg/storage/unified/resource/server.go:
func (s *server) GetBlob(ctx context.Context, req *GetBlobRequest) (*GetBlobResponse, error) {
	if s.blob == nil {
		return &GetBlobResponse{Error: &ErrorResult{
			Message: ""blob store not configured"",
			Code:    http.StatusNotImplemented,
		}}, nil
	}

	// The linked blob is stored in the resource metadata attributes
	obj, status := s.getPartialObject(ctx, req.Resource, req.ResourceVersion)
	if status != nil {
		return &GetBlobResponse{Error: status}, nil
	}

	info := obj.GetBlob()
	if info =
---
[Medium] method Watch in pkg/storage/unified/resource/server.go:
func (s *server) Watch(req *WatchRequest, srv ResourceStore_WatchServer) error {
	ctx := srv.Context()

	user, ok := claims.From(ctx)
	if !ok || user == nil {
		return apierrors.NewUnauthorized(""no user found in context"")
	}

	key := req.Options.Key
	checker, err := s.access.Compile(ctx, user, authz.ListRequest{
		Group:     key.Group,
		Resource:  key.Resource,
		Namespace: key.Namespace,
	})
	if err != nil {
		return err
	}
	if checker == nil {
		return apierrors.NewUnauthorized(""not allowed t
---
[Medium] method BuildIndex in pkg/storage/unified/search/bleve.go:
func (b *bleveBackend) BuildIndex(ctx context.Context,
	key resource.NamespacedResource,

	// When the size is known, it will be passed along here
	// Depending on the size, the backend may choose different options (eg: memory vs disk)
	size int64,

	// The last known resource version can be used to know that we can skip calling the builder
	resourceVersion int64,

	// the non-standard searchable fields
	fields resource.SearchableDocumentFields,

	// The builder will write all documents before r
---
[Medium] method GetResourceStats in pkg/storage/unified/sql/backend.go:
func (b *backend) GetResourceStats(ctx context.Context, namespace string, minCount int) ([]resource.ResourceStats, error) {
	ctx, span := b.tracer.Start(ctx, tracePrefix+"".GetResourceStats"")
	defer span.End()

	req := &sqlStatsRequest{
		SQLTemplate: sqltemplate.New(b.dialect),
		Namespace:   namespace,
		MinCount:    minCount, // not used in query... yet?
	}

	res := make([]resource.ResourceStats, 0, 100)
	err := b.db.WithTx(ctx, ReadCommittedRO, func(ctx context.Context, tx db.Tx) error {
		ro
---
[Medium] method handleEvent in pkg/storage/unified/resource/search.go:
func (s *searchSupport) handleEvent(ctx context.Context, evt *WrittenEvent) {
	if !slices.Contains([]WatchEvent_Type{WatchEvent_ADDED, WatchEvent_MODIFIED, WatchEvent_DELETED}, evt.Type) {
		s.log.Info(""ignoring watch event"", ""type"", evt.Type)
		return
	}

	nsr := NamespacedResource{
		Namespace: evt.Key.Namespace,
		Group:     evt.Key.Group,
		Resource:  evt.Key.Resource,
	}

	index, err := s.getOrCreateIndex(ctx, nsr)
	if err != nil {
		s.log.Warn(""error getting index for watch event"", ""error""
---
[Medium] method init in pkg/storage/unified/resource/search.go:
func (s *searchSupport) init(ctx context.Context) error {
	ctx, span := s.tracer.Start(ctx, tracingPrexfixSearch+""Init"")
	defer span.End()
	start := time.Now().Unix()

	totalBatchesIndexed := 0
	group := errgroup.Group{}
	group.SetLimit(s.initWorkers)

	stats, err := s.storage.GetResourceStats(ctx, """", s.initMinSize)
	if err != nil {
		return err
	}

	for _, info := range stats {
		group.Go(func() error {
			s.log.Debug(""initializing search index"", ""namespace"", info.Namespace, ""group"", info.Grou","build (Critical), NewResourceServer (Critical), Init (High), Search (High), List (High), Read (High), TestIntegrationWillRunInstrumentationServerWhenTargetHasNoHttpServer (Medium), History (Medium), Create (Medium), PutBlob (Medium), Delete (Medium), Update (Medium), Origin (Medium), IsHealthy (Medium), GetBlob (Medium), Watch (Medium), BuildIndex (Medium), GetResourceStats (Medium), handleEvent (Medium), init (Medium)",match,'BuildIndex' matches HC entity 'build'
grafana,10,Unified Storage Performance Optimizations,"Calling s.search.TotalDocs() here may race with concurrent index creation: TotalDocs iterates b.cache without synchronization, and the event watcher goroutine started just above could trigger BuildIndex writes concurrently, potentially causing a concurrent map read/write panic.",High,20,6,14,"method::build (pkg/storage/unified/resource/search.go) [Critical, score=1.00] | function::NewResourceServer (pkg/storage/unified/resource/server.go) [Critical, score=0.94] | method::Init (pkg/storage/unified/resource/server.go) [High, score=0.70] | method::Search (pkg/storage/unified/resource/server.go) [High, score=0.64] | method::List (pkg/storage/unified/resource/server.go) [High, score=0.53] | method::Read (pkg/storage/unified/resource/server.go) [High, score=0.53]","[Critical] method build in pkg/storage/unified/resource/search.go:
func (s *searchSupport) build(ctx context.Context, nsr NamespacedResource, size int64, rv int64) (ResourceIndex, int64, error) {
	ctx, span := s.tracer.Start(ctx, tracingPrexfixSearch+""Build"")
	defer span.End()

	builder, err := s.builders.get(ctx, nsr)
	if err != nil {
		return nil, 0, err
	}
	fields := s.builders.GetFields(nsr)

	s.log.Debug(fmt.Sprintf(""TODO, build %+v (size:%d, rv:%d) // builder:%+v\n"", nsr, size, rv, builder))

	key := &ResourceKey{
		Group:     nsr.Group,
		Resource:  nsr.Resource,
		Namespace: nsr.Namespace,
	}
	index, err := s.search.BuildIndex(ctx, nsr, size, rv, fields, func(index ResourceIndex) (int64, error) {
		rv, err = s.storage.ListIterator(ctx, &ListRequest{
			Limit: 1000000000000, // big number
			Options: &ListOptions{
				Key: key,
			},
		}, func(iter
---
[Critical] function NewResourceServer in pkg/storage/unified/resource/server.go:
func NewResourceServer(opts ResourceServerOptions) (ResourceServer, error) {
	if opts.Tracer == nil {
		opts.Tracer = noop.NewTracerProvider().Tracer(""resource-server"")
	}

	if opts.Backend == nil {
		return nil, fmt.Errorf(""missing Backend implementation"")
	}

	if opts.AccessClient == nil {
		opts.AccessClient = &staticAuthzClient{allowed: true} // everything OK
	}

	if opts.Diagnostics == nil {
		opts.Diagnostics = &noopService{}
	}
	if opts.Now == nil {
		opts.Now = func() int64 {
			return time.Now().UnixMilli()
		}
	}

	// Initialize the blob storage
	blobstore := opts.Blob.Backend
	if blobstore == nil && opts.Blob.URL != """" {
		ctx := context.Background()
		bucket, err := OpenBlobBucket(ctx, opts.Blob.URL)
		if err != nil {
			return nil, err
		}

		blobstore, err = NewCDKBlobSupport
---
[High] method Init in pkg/storage/unified/resource/server.go:
func (s *server) Init(ctx context.Context) error {
	s.once.Do(func() {
		// Call lifecycle hooks
		if s.lifecycle != nil {
			err := s.lifecycle.Init(ctx)
			if err != nil {
				s.initErr = fmt.Errorf(""initialize Resource Server: %w"", err)
			}
		}

		// initialize the search index
		if s.initErr == nil && s.search != nil {
			s.initErr = s.search.init(ctx)
		}

		// Start watching for changes
		if s.initErr == nil {
			s.initErr = s.initWatcher()
		}

		if s.initErr != nil {
			s.log.Error(""error initializing resource server"", ""error"", s.initErr)
		}
	})
	return s.initErr
}
---
[High] method Search in pkg/storage/unified/resource/server.go:
func (s *server) Search(ctx context.Context, req *ResourceSearchRequest) (*ResourceSearchResponse, error) {
	if s.search == nil {
		return nil, fmt.Errorf(""search index not configured"")
	}
	return s.search.Search(ctx, req)
}
---
[High] method List in pkg/storage/unified/resource/server.go:
func (s *server) List(ctx context.Context, req *ListRequest) (*ListResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""storage_server.List"")
	defer span.End()

	user, ok := claims.From(ctx)
	if !ok || user == nil {
		return &ListResponse{
			Error: &ErrorResult{
				Message: ""no user found in context"",
				Code:    http.StatusUnauthorized,
			}}, nil
	}

	if req.Limit < 1 {
		req.Limit = 50 // default max 50 items in a page
	}
	maxPageBytes := 1024 * 1024 * 2 // 2mb/page
	pageBytes := 0
	rsp := &ListResponse{}

	key := req.Options.Key
	checker, err := s.access.Compile(ctx, user, authz.ListRequest{
		Group:     key.Group,
		Resource:  key.Resource,
		Namespace: key.Namespace,
	})
	if err != nil {
		return &ListResponse{Error: AsErrorResult(err)}, nil
	}
	if checker == nil {
		return &List
---
[High] method Read in pkg/storage/unified/resource/server.go:
func (s *server) Read(ctx context.Context, req *ReadRequest) (*ReadResponse, error) {
	user, ok := claims.From(ctx)
	if !ok || user == nil {
		return &ReadResponse{
			Error: &ErrorResult{
				Message: ""no user found in context"",
				Code:    http.StatusUnauthorized,
			}}, nil
	}

	// if req.Key.Group == """" {
	// 	status, _ := AsErrorResult(apierrors.NewBadRequest(""missing group""))
	// 	return &ReadResponse{Status: status}, nil
	// }
	if req.Key.Resource == """" {
		return &ReadResponse{Error: NewBadRequestError(""missing resource"")}, nil
	}

	rsp := s.backend.ReadResource(ctx, req)

	a, err := s.access.Check(ctx, user, authz.CheckRequest{
		Verb:      ""get"",
		Group:     req.Key.Group,
		Resource:  req.Key.Resource,
		Namespace: req.Key.Namespace,
		Name:      req.Key.Name,
		Folder:    rsp","[Medium] function TestIntegrationWillRunInstrumentationServerWhenTargetHasNoHttpServer in pkg/server/module_server_test.go:
func TestIntegrationWillRunInstrumentationServerWhenTargetHasNoHttpServer(t *testing.T) {
	if testing.Short() {
		t.Skip(""skipping integration test"")
	}
	dbType := os.Getenv(""GRAFANA_TEST_DB"")
	if dbType == """" {
		t.Skip(""skipping - GRAFANA_TEST_DB not defined"")
	}
	if dbType == ""sqlite3"" {
		t.Skip(""skipping - sqlite not supported for storage server target"")
	}
	// TODO - fix this test for postgres
	if dbType == ""postgres"" {
		t.Skip(""skipping - test not working with postgres in Drone. Works lo
---
[Medium] method History in pkg/storage/unified/resource/server.go:
func (s *server) History(ctx context.Context, req *HistoryRequest) (*HistoryResponse, error) {
	return s.search.History(ctx, req)
}
---
[Medium] method Create in pkg/storage/unified/resource/server.go:
func (s *server) Create(ctx context.Context, req *CreateRequest) (*CreateResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""storage_server.Create"")
	defer span.End()

	rsp := &CreateResponse{}
	user, ok := claims.From(ctx)
	if !ok || user == nil {
		rsp.Error = &ErrorResult{
			Message: ""no user found in context"",
			Code:    http.StatusUnauthorized,
		}
		return rsp, nil
	}

	found := s.backend.ReadResource(ctx, &ReadRequest{Key: req.Key})
	if found != nil && len(found.Value) > 0 {
		rsp.Err
---
[Medium] method PutBlob in pkg/storage/unified/resource/server.go:
func (s *server) PutBlob(ctx context.Context, req *PutBlobRequest) (*PutBlobResponse, error) {
	if s.blob == nil {
		return &PutBlobResponse{Error: &ErrorResult{
			Message: ""blob store not configured"",
			Code:    http.StatusNotImplemented,
		}}, nil
	}

	rsp, err := s.blob.PutResourceBlob(ctx, req)
	if err != nil {
		rsp.Error = AsErrorResult(err)
	}
	return rsp, nil
}
---
[Medium] method Delete in pkg/storage/unified/resource/server.go:
func (s *server) Delete(ctx context.Context, req *DeleteRequest) (*DeleteResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""storage_server.Delete"")
	defer span.End()

	rsp := &DeleteResponse{}
	if req.ResourceVersion < 0 {
		return nil, apierrors.NewBadRequest(""update must include the previous version"")
	}
	user, ok := claims.From(ctx)
	if !ok || user == nil {
		rsp.Error = &ErrorResult{
			Message: ""no user found in context"",
			Code:    http.StatusUnauthorized,
		}
		return rsp, nil
	}

	la
---
[Medium] method Update in pkg/storage/unified/resource/server.go:
func (s *server) Update(ctx context.Context, req *UpdateRequest) (*UpdateResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""storage_server.Update"")
	defer span.End()

	rsp := &UpdateResponse{}
	user, ok := claims.From(ctx)
	if !ok || user == nil {
		rsp.Error = &ErrorResult{
			Message: ""no user found in context"",
			Code:    http.StatusUnauthorized,
		}
		return rsp, nil
	}
	if req.ResourceVersion < 0 {
		rsp.Error = AsErrorResult(apierrors.NewBadRequest(""update must include the previous ver
---
[Medium] method Origin in pkg/storage/unified/resource/server.go:
func (s *server) Origin(ctx context.Context, req *OriginRequest) (*OriginResponse, error) {
	return s.search.Origin(ctx, req)
}
---
[Medium] method IsHealthy in pkg/storage/unified/resource/server.go:
func (s *server) IsHealthy(ctx context.Context, req *HealthCheckRequest) (*HealthCheckResponse, error) {
	return s.diagnostics.IsHealthy(ctx, req)
}
---
[Medium] method GetBlob in pkg/storage/unified/resource/server.go:
func (s *server) GetBlob(ctx context.Context, req *GetBlobRequest) (*GetBlobResponse, error) {
	if s.blob == nil {
		return &GetBlobResponse{Error: &ErrorResult{
			Message: ""blob store not configured"",
			Code:    http.StatusNotImplemented,
		}}, nil
	}

	// The linked blob is stored in the resource metadata attributes
	obj, status := s.getPartialObject(ctx, req.Resource, req.ResourceVersion)
	if status != nil {
		return &GetBlobResponse{Error: status}, nil
	}

	info := obj.GetBlob()
	if info =
---
[Medium] method Watch in pkg/storage/unified/resource/server.go:
func (s *server) Watch(req *WatchRequest, srv ResourceStore_WatchServer) error {
	ctx := srv.Context()

	user, ok := claims.From(ctx)
	if !ok || user == nil {
		return apierrors.NewUnauthorized(""no user found in context"")
	}

	key := req.Options.Key
	checker, err := s.access.Compile(ctx, user, authz.ListRequest{
		Group:     key.Group,
		Resource:  key.Resource,
		Namespace: key.Namespace,
	})
	if err != nil {
		return err
	}
	if checker == nil {
		return apierrors.NewUnauthorized(""not allowed t
---
[Medium] method BuildIndex in pkg/storage/unified/search/bleve.go:
func (b *bleveBackend) BuildIndex(ctx context.Context,
	key resource.NamespacedResource,

	// When the size is known, it will be passed along here
	// Depending on the size, the backend may choose different options (eg: memory vs disk)
	size int64,

	// The last known resource version can be used to know that we can skip calling the builder
	resourceVersion int64,

	// the non-standard searchable fields
	fields resource.SearchableDocumentFields,

	// The builder will write all documents before r
---
[Medium] method GetResourceStats in pkg/storage/unified/sql/backend.go:
func (b *backend) GetResourceStats(ctx context.Context, namespace string, minCount int) ([]resource.ResourceStats, error) {
	ctx, span := b.tracer.Start(ctx, tracePrefix+"".GetResourceStats"")
	defer span.End()

	req := &sqlStatsRequest{
		SQLTemplate: sqltemplate.New(b.dialect),
		Namespace:   namespace,
		MinCount:    minCount, // not used in query... yet?
	}

	res := make([]resource.ResourceStats, 0, 100)
	err := b.db.WithTx(ctx, ReadCommittedRO, func(ctx context.Context, tx db.Tx) error {
		ro
---
[Medium] method handleEvent in pkg/storage/unified/resource/search.go:
func (s *searchSupport) handleEvent(ctx context.Context, evt *WrittenEvent) {
	if !slices.Contains([]WatchEvent_Type{WatchEvent_ADDED, WatchEvent_MODIFIED, WatchEvent_DELETED}, evt.Type) {
		s.log.Info(""ignoring watch event"", ""type"", evt.Type)
		return
	}

	nsr := NamespacedResource{
		Namespace: evt.Key.Namespace,
		Group:     evt.Key.Group,
		Resource:  evt.Key.Resource,
	}

	index, err := s.getOrCreateIndex(ctx, nsr)
	if err != nil {
		s.log.Warn(""error getting index for watch event"", ""error""
---
[Medium] method init in pkg/storage/unified/resource/search.go:
func (s *searchSupport) init(ctx context.Context) error {
	ctx, span := s.tracer.Start(ctx, tracingPrexfixSearch+""Init"")
	defer span.End()
	start := time.Now().Unix()

	totalBatchesIndexed := 0
	group := errgroup.Group{}
	group.SetLimit(s.initWorkers)

	stats, err := s.storage.GetResourceStats(ctx, """", s.initMinSize)
	if err != nil {
		return err
	}

	for _, info := range stats {
		group.Go(func() error {
			s.log.Debug(""initializing search index"", ""namespace"", info.Namespace, ""group"", info.Grou","build (Critical), NewResourceServer (Critical), Init (High), Search (High), List (High), Read (High), TestIntegrationWillRunInstrumentationServerWhenTargetHasNoHttpServer (Medium), History (Medium), Create (Medium), PutBlob (Medium), Delete (Medium), Update (Medium), Origin (Medium), IsHealthy (Medium), GetBlob (Medium), Watch (Medium), BuildIndex (Medium), GetResourceStats (Medium), handleEvent (Medium), init (Medium)",match,'search' matches HC entity 'search'
grafana,9,Advanced SQL Analytics Framework,"The enableSqlExpressions function has flawed logic that always returns false, effectively disabling SQL expressions unconditionally:",Critical,215,2,210,"function::TablesList (pkg/expr/sql/parser.go) [High, score=0.64] | method::ReadQuery (pkg/expr/reader.go) [High, score=0.59]","[High] function TablesList in pkg/expr/sql/parser.go:
func TablesList(rawSQL string) ([]string, error) {
	duckDB := NewInMemoryDB()
	rawSQL = strings.Replace(rawSQL, ""'"", ""''"", -1)
	cmd := fmt.Sprintf(""SELECT json_serialize_sql('%s')"", rawSQL)
	ret, err := duckDB.RunCommands([]string{cmd})
	if err != nil {
		logger.Error(""error serializing sql"", ""error"", err.Error(), ""sql"", rawSQL, ""cmd"", cmd)
		return nil, fmt.Errorf(""error serializing sql: %s"", err.Error())
	}

	ast := []map[string]any{}
	err = json.Unmarshal([]byte(ret), &ast)
	if err != nil {
		logger.Error(""error converting json sql to ast"", ""error"", err.Error(), ""ret"", ret)
		return nil, fmt.Errorf(""error converting json to ast: %s"", err.Error())
	}

	return tablesFromAST(ast)
}
---
[High] method ReadQuery in pkg/expr/reader.go:
func (h *ExpressionQueryReader) ReadQuery(
	// Properties that have been parsed off the same node
	common data.DataQuery,
	// An iterator with context for the full node (include common values)
	iter *jsoniter.Iterator,
) (eq ExpressionQuery, err error) {
	referenceVar := """"
	eq.RefID = common.RefID
	eq.QueryType = QueryType(common.GetString(""type""))
	if eq.QueryType == """" {
		return eq, fmt.Errorf(""missing type"")
	}
	switch eq.QueryType {
	case QueryTypeMath:
		q := &MathQuery{}
		err = iter.ReadVal(q)
		if err == nil {
			eq.Command, err = NewMathCommand(common.RefID, q.Expression)
			eq.Properties = q
		}

	case QueryTypeReduce:
		var mapper mathexp.ReduceMapper = nil
		q := &ReduceQuery{}
		err = iter.ReadVal(q)
		if err == nil {
			referenceVar, err = getReferenceVar(q.Expression, comm","[Medium] method Execute in pkg/expr/sql_command.go:
func (gr *SQLCommand) Execute(ctx context.Context, now time.Time, vars mathexp.Vars, tracer tracing.Tracer) (mathexp.Results, error) {
	_, span := tracer.Start(ctx, ""SSE.ExecuteSQL"")
	defer span.End()

	allFrames := []*data.Frame{}
	for _, ref := range gr.varsToQuery {
		results, ok := vars[ref]
		if !ok {
			logger.Warn(""no results found for"", ""ref"", ref)
			continue
		}
		frames := results.Values.AsDataFrames(ref)
		allFrames = append(allFrames, frames...)
	}

	rsp := mathexp.Results{}

	db :=
---
[Medium] chunk lines 481-500 in go.mod:
	github.com/grafana/grafana-app-sdk v0.19.0 // indirect
	github.com/grafana/grafana/pkg/semconv v0.0.0-20240808213237-f4d2e064f435 // indirect
	github.com/grafana/sqlds/v4 v4.1.0 // indirect
	github.com/maypok86/otter v1.2.2 // indirect
	github.com/planetscale/vtprotobuf v0.6.1-0.20240319094008-0393e58bdf10 // indirect
	github.com/shadowspore/fossil-delta v0.0.0-20240102155221-e3a8590b820b // indirect
)

// Use fork of crewjam/saml with fixes for some issues until changes get merged into upstrea
---
[Medium] method TablesList in pkg/expr/sql/db.go:
func (db *DB) TablesList(rawSQL string) ([]string, error) {
	return nil, errors.New(""not implemented"")
}
---
[Medium] method RunCommands in pkg/expr/sql/db.go:
func (db *DB) RunCommands(commands []string) (string, error) {
	return """", errors.New(""not implemented"")
}
---
[Medium] method QueryFramesInto in pkg/expr/sql/db.go:
func (db *DB) QueryFramesInto(name string, query string, frames []*data.Frame, f *data.Frame) error {
	return errors.New(""not implemented"")
}
---
[Medium] function NewInMemoryDB in pkg/expr/sql/db.go:
func NewInMemoryDB() *DB {
	return &DB{}
}
---
[Medium] chunk lines 501-510 in go.mod:
// This is required in order to get notification delivery errors from the receivers API.
replace github.com/prometheus/alertmanager => github.com/grafana/prometheus-alertmanager v0.25.1-0.20240930132144-b5e64e81e8d3

exclude github.com/mattn/go-sqlite3 v2.0.3+incompatible

// Use our fork xorm. go.work currently overrides this and points to the local ./pkg/util/xorm directory.
replace xorm.io/xorm => github.com/grafana/grafana/pkg/util/xorm v0.0.1

// lock for mysql tsdb compat
replace github.co
---
[Medium] chunk lines 4621-4640 in go.sum:
modernc.org/strutil v1.1.3/go.mod h1:MEHNA7PdEnEwLvspRMtWTNnp2nnyvMfkimT1NKNAGbw=
modernc.org/strutil v1.2.0 h1:agBi9dp1I+eOnxXeiZawM8F4LawKv4NzGWSaLfyeNZA=
modernc.org/strutil v1.2.0/go.mod h1:/mdcBmfOibveCTBxUl5B5l6W+TTH1FXPLHZE6bTosX0=
modernc.org/tcl v1.13.1/go.mod h1:XOLfOwzhkljL4itZkK6T72ckMgvj0BDsnKNdZVUOecw=
modernc.org/tcl v1.13.2/go.mod h1:7CLiGIPo1M8Rv1Mitpv5akc2+8fxUd2y2UzC/MfMzy0=
modernc.org/tcl v1.15.1/go.mod h1:aEjeGJX2gz1oWKOLDVZ2tnEWLUrIn8H+GFu+akoDhqs=
modernc.org/token v1.0.0
---
[Medium] chunk lines 4641-4653 in go.sum:
sigs.k8s.io/structured-merge-diff/v4 v4.2.3/go.mod h1:qjx8mGObPmV2aSZepjQjbmb2ihdVs8cGKBraizNC69E=
sigs.k8s.io/structured-merge-diff/v4 v4.4.1 h1:150L+0vs/8DA78h1u02ooW1/fFq/Lwr+sGiqlzvrtq4=
sigs.k8s.io/structured-merge-diff/v4 v4.4.1/go.mod h1:N8hJocpFajUSSeSJ9bOZ77VzejKZaXsTtZo4/u7Io08=
sigs.k8s.io/yaml v1.1.0/go.mod h1:UJmg0vDUVViEyp3mgSv9WPwZCDxu4rQW1olrI1uml+o=
sigs.k8s.io/yaml v1.2.0/go.mod h1:yfXDCHCao9+ENCvLSE62v9VSji2MKu5jeNfTrofGhJc=
sigs.k8s.io/yaml v1.3.0/go.mod h1:GeOyir5tyXNByN85N/
---
[Medium] chunk lines 381-400 in go.mod:
	github.com/prometheus/common/sigv4 v0.1.0 // indirect
	github.com/prometheus/exporter-toolkit v0.11.0 // indirect
	github.com/prometheus/procfs v0.15.1 // indirect
	github.com/protocolbuffers/txtpbfmt v0.0.0-20230328191034-3462fbc510c0 // indirect
	github.com/redis/rueidis v1.0.45 // indirect
	github.com/remyoudompheng/bigfft v0.0.0-20230129092748-24d4a6f8daec // indirect
	github.com/rivo/uniseg v0.4.7 // indirect
	github.com/rs/cors v1.11.1 // @grafana/identity-access-team
	github.com/russross
---
[Medium] chunk lines 221-240 in go.mod:
	github.com/FZambia/eagle v0.1.0 // indirect
	github.com/Masterminds/goutils v1.1.1 // indirect
	github.com/Masterminds/squirrel v1.5.4 // indirect
	github.com/NYTimes/gziphandler v1.1.1 // indirect
	github.com/RoaringBitmap/roaring v1.9.3 // indirect
	github.com/agext/levenshtein v1.2.1 // indirect
	github.com/alecthomas/units v0.0.0-20231202071711-9a357b53e9c9 // indirect
	github.com/alicebob/gopher-json v0.0.0-20200520072559-a9ecdc9d1d3a // indirect
	github.com/antlr4-go/antlr/v4 v4.13.1 // i
---
[Medium] chunk lines 461-480 in go.mod:

require (
	github.com/fxamacker/cbor/v2 v2.7.0 // indirect; indirect0.0.0-20240809095826-8eb5495c0b2a
	github.com/x448/float16 v0.8.4 // indirect
	gopkg.in/evanphx/json-patch.v4 v4.12.0 // indirect
)

require (
	github.com/getkin/kin-openapi v0.127.0 // @grafana/grafana-app-platform-squad
	github.com/grafana/grafana/apps/playlist v0.0.0-20240917082838-e2bce38a7990 // @grafana/grafana-app-platform-squad
)

require github.com/jmespath-community/go-jmespath v1.1.1 // @grafana/identity-access-team

---
[Medium] chunk lines 241-260 in go.mod:
	github.com/blevesearch/segment v0.9.1 // indirect
	github.com/blevesearch/snowballstem v0.9.0 // indirect
	github.com/blevesearch/vellum v1.0.10 // indirect
	github.com/blugelabs/ice v1.0.0 // indirect
	github.com/bufbuild/protocompile v0.4.0 // indirect
	github.com/buger/jsonparser v1.1.1 // indirect
	github.com/caio/go-tdigest v3.1.0+incompatible // indirect
	github.com/cenkalti/backoff/v4 v4.3.0 // indirect
	github.com/centrifugal/protocol v0.13.4 // indirect
	github.com/cespare/xxhash/v2 v2
---
[Medium] chunk lines 361-380 in go.mod:
	github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect
	github.com/mpvl/unique v0.0.0-20150818121801-cbe035fff7de // indirect
	github.com/mschoch/smat v0.2.0 // indirect
	github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822 // indirect
	github.com/mxk/go-flowrate v0.0.0-20140419014527-cca7078d478f // indirect
	github.com/natefinch/wrap v0.2.0 // indirect
	github.com/ncruces/go-strftime v0.1.9 // indirect
	github.com/oapi-codegen/runtime v1.1.1 // indirect
	git
---
[Medium] chunk lines 321-340 in go.mod:
	github.com/jcmturner/aescts/v2 v2.0.0 // indirect
	github.com/jcmturner/dnsutils/v2 v2.0.0 // indirect
	github.com/jcmturner/gofork v1.7.6 // indirect
	github.com/jcmturner/goidentity/v6 v6.0.1 // indirect
	github.com/jcmturner/gokrb5/v8 v8.4.4 // indirect
	github.com/jcmturner/rpc/v2 v2.0.3 // indirect
	github.com/jeremywohl/flatten v1.0.1 // @grafana/grafana-app-platform-squad
	github.com/jessevdk/go-flags v1.5.0 // indirect
	github.com/jhump/protoreflect v1.15.1 // indirect
	github.com/jonbo
---
[Medium] chunk lines 421-440 in go.mod:
	go.etcd.io/etcd/client/pkg/v3 v3.5.14 // indirect
	go.etcd.io/etcd/client/v3 v3.5.14 // indirect
	go.mongodb.org/mongo-driver v1.16.1 // indirect
	go.opencensus.io v0.24.0 // indirect
	go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.55.0 // indirect
	go.opentelemetry.io/otel/metric v1.31.0 // indirect
	go.opentelemetry.io/proto/otlp v1.3.1 // indirect
	go.uber.org/mock v0.4.0 // indirect
	go.uber.org/multierr v1.11.0 // indirect
	go.uber.org/zap v1.27.0 // @grafana/identity-acc
---
[Medium] chunk lines 281-300 in go.mod:
	github.com/go-openapi/swag v0.23.0 // indirect
	github.com/go-openapi/validate v0.24.0 // indirect
	github.com/goccy/go-json v0.10.3 // indirect
	github.com/gofrs/uuid v4.4.0+incompatible // indirect
	github.com/gogo/googleapis v1.4.1 // indirect
	github.com/gogo/status v1.1.1 // indirect
	github.com/golang-jwt/jwt/v5 v5.2.1 // indirect
	github.com/golang-sql/civil v0.0.0-20220223132316-b832511892a9 // indirect
	github.com/golang-sql/sqlexp v0.1.0 // indirect
	github.com/golang/groupcache v0.0.
---
[Medium] chunk lines 261-280 in go.mod:
	github.com/dgryski/go-rendezvous v0.0.0-20200823014737-9f7001d12a5f // indirect
	github.com/docker/go-units v0.5.0 // indirect
	github.com/dustin/go-humanize v1.0.1 // indirect
	github.com/edsrzf/mmap-go v1.1.0 // indirect
	github.com/elazarl/goproxy v0.0.0-20240726154733-8b0c20506380 // indirect
	github.com/emicklei/go-restful/v3 v3.11.0 // indirect
	github.com/emicklei/proto v1.10.0 // indirect
	github.com/envoyproxy/protoc-gen-validate v1.1.0 // indirect
	github.com/facette/natsort v0.0.0-20
---
[Medium] chunk lines 441-460 in go.mod:
	gopkg.in/yaml.v2 v2.4.0 // indirect
	k8s.io/kms v0.31.1 // indirect
	modernc.org/gc/v3 v3.0.0-20240107210532-573471604cb6 // indirect
	modernc.org/libc v1.55.3 // indirect
	modernc.org/mathutil v1.6.0 // indirect
	modernc.org/memory v1.8.0 // indirect
	modernc.org/sqlite v1.33.1 // indirect
	modernc.org/strutil v1.2.0 // indirect
	modernc.org/token v1.1.0 // indirect
	sigs.k8s.io/apiserver-network-proxy/konnectivity-client v0.30.3 // indirect
	sigs.k8s.io/json v0.0.0-20221116044647-bc3834ca7abd
---
[Medium] chunk lines 301-320 in go.mod:
	github.com/grpc-ecosystem/go-grpc-middleware v1.4.0 // indirect
	github.com/grpc-ecosystem/go-grpc-prometheus v1.2.1-0.20191002090509-6af20e3a5340 // indirect; @grafana/plugins-platform-backend
	github.com/grpc-ecosystem/grpc-gateway/v2 v2.22.0 // @grafana/identity-access-team
	github.com/hashicorp/errwrap v1.1.0 // indirect
	github.com/hashicorp/go-immutable-radix v1.3.1 // indirect
	github.com/hashicorp/go-msgpack v0.5.5 // indirect
	github.com/hashicorp/go-sockaddr v1.0.6 // indirect
	github
---
[Medium] chunk lines 341-360 in go.mod:
	github.com/magiconair/properties v1.8.7 // indirect
	github.com/mailru/easyjson v0.7.7 // indirect
	github.com/mattermost/xml-roundtrip-validator v0.1.0 // indirect
	github.com/mattetti/filebuffer v1.0.1 // indirect
	github.com/mattn/go-colorable v0.1.13 // indirect
	github.com/mattn/go-ieproxy v0.0.11 // indirect
	github.com/mattn/go-runewidth v0.0.16 // indirect
	github.com/mfridman/interpolate v0.0.2 // indirect
	github.com/miekg/dns v1.1.59 // indirect
	github.com/mitchellh/copystructure v1
---
[Medium] chunk lines 401-420 in go.mod:
	github.com/spf13/afero v1.11.0 // indirect
	github.com/spf13/cast v1.6.0 // indirect
	github.com/spf13/viper v1.19.0 // indirect
	github.com/stoewer/go-strcase v1.3.0 // indirect
	github.com/stretchr/objx v0.5.2 // indirect
	github.com/subosito/gotenv v1.6.0 // indirect
	github.com/uber/jaeger-client-go v2.30.0+incompatible // indirect
	github.com/uber/jaeger-lib v2.4.1+incompatible // indirect
	github.com/unknwon/bra v0.0.0-20200517080246-1e3013ecaff8 // indirect
	github.com/unknwon/com v1.0.1
---
[Medium] chunk lines 141-160 in go.mod:
	github.com/prometheus/prometheus v1.8.2-0.20221021121301-51a44e6657c3 // @grafana/alerting-backend
	github.com/redis/go-redis/v9 v9.1.0 // @grafana/alerting-backend
	github.com/robfig/cron/v3 v3.0.1 // @grafana/grafana-backend-group
	github.com/russellhaering/goxmldsig v1.4.0 // @grafana/grafana-backend-group
	github.com/spf13/cobra v1.8.1 // @grafana/grafana-app-platform-squad
	github.com/spf13/pflag v1.0.5 // @grafana-app-platform-squad
	github.com/spyzhov/ajson v0.9.0 // @grafana/grafana-app
---
[Medium] chunk lines 161-180 in go.mod:
	go.opentelemetry.io/contrib/samplers/jaegerremote v0.25.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel v1.31.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel/exporters/jaeger v1.17.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.31.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.31.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel/sdk v1.31.0 // @grafana/graf
---
[Medium] chunk lines 181-200 in go.mod:
	google.golang.org/api v0.191.0 // @grafana/grafana-backend-group
	google.golang.org/grpc v1.67.1 // @grafana/plugins-platform-backend
	google.golang.org/protobuf v1.35.1 // @grafana/plugins-platform-backend
	gopkg.in/ini.v1 v1.67.0 // @grafana/alerting-backend
	gopkg.in/mail.v2 v2.3.1 // @grafana/grafana-backend-group
	gopkg.in/yaml.v3 v3.0.1 // @grafana/alerting-backend
	k8s.io/api v0.31.1 // @grafana/grafana-app-platform-squad
	k8s.io/apimachinery v0.31.1 // @grafana/grafana-app-platform-squa
---
[Medium] chunk lines 201-220 in go.mod:

require (
	cloud.google.com/go v0.115.0 // indirect
	cloud.google.com/go/auth v0.8.1 // indirect
	cloud.google.com/go/auth/oauth2adapt v0.2.4 // indirect
	cloud.google.com/go/compute/metadata v0.5.0 // indirect
	cloud.google.com/go/iam v1.1.13 // indirect
	github.com/Azure/azure-pipeline-go v0.2.3 // indirect
	github.com/Azure/azure-sdk-for-go/sdk/azcore v1.14.0 // indirect
	github.com/Azure/azure-sdk-for-go/sdk/internal v1.10.0 // indirect
	github.com/Azure/azure-sdk-for-go/sdk/keyvault/intern
---
[Medium] chunk lines 3101-3120 in go.sum:
github.com/spf13/afero v1.10.0/go.mod h1:UBogFpq8E9Hx+xc5CNTTEpTnuHVmXDwZcZcE1eb/UhQ=
github.com/spf13/afero v1.11.0 h1:WJQKhtpdm3v2IzqG8VMqrr6Rf3UYpEF239Jy9wNepM8=
github.com/spf13/afero v1.11.0/go.mod h1:GH9Y3pIexgf1MTIWtNGyogA5MwRIDXGUr+hbWNoBjkY=
github.com/spf13/cast v1.3.0/go.mod h1:Qx5cxh0v+4UWYiBimWS+eyWzqEqokIECu5etghLkUJE=
github.com/spf13/cast v1.3.1/go.mod h1:Qx5cxh0v+4UWYiBimWS+eyWzqEqokIECu5etghLkUJE=
github.com/spf13/cast v1.5.0/go.mod h1:SpXXQ5YoyJw6s3/6cMTQuxvgRl3PCJiyaX9p6b155U
---
[Medium] chunk lines 4561-4580 in go.sum:
modernc.org/gc/v2 v2.4.1/go.mod h1:wzN5dK1AzVGoH6XOzc3YZ+ey/jPgYHLuVckd62P0GYU=
modernc.org/gc/v3 v3.0.0-20240107210532-573471604cb6 h1:5D53IMaUuA5InSeMu9eJtlQXS2NxAhyWQvkKEgXZhHI=
modernc.org/gc/v3 v3.0.0-20240107210532-573471604cb6/go.mod h1:Qz0X07sNOR1jWYCrJMEnbW/X55x206Q7Vt4mz6/wHp4=
modernc.org/httpfs v1.0.6/go.mod h1:7dosgurJGp0sPaRanU53W4xZYKh14wfzX420oZADeHM=
modernc.org/libc v0.0.0-20220428101251-2d5f3daf273b/go.mod h1:p7Mg4+koNjc8jkqwcoFBJx7tXkpj00G77X7A72jXPXA=
modernc.org/libc v1.16.
---
[Medium] chunk lines 3641-3660 in go.sum:
golang.org/x/oauth2 v0.0.0-20220622183110-fd043fe589d2/go.mod h1:jaDAt6Dkxork7LmZnYtzbRWj0W47D86a3TGe0YHBvmE=
golang.org/x/oauth2 v0.0.0-20220822191816-0ebed06d0094/go.mod h1:h4gKUeWbJ4rQPri7E0u6Gs4e9Ri2zaLxzw5DI5XGrYg=
golang.org/x/oauth2 v0.0.0-20220909003341-f21342109be1/go.mod h1:h4gKUeWbJ4rQPri7E0u6Gs4e9Ri2zaLxzw5DI5XGrYg=
golang.org/x/oauth2 v0.0.0-20221006150949-b44042a4b9c1/go.mod h1:h4gKUeWbJ4rQPri7E0u6Gs4e9Ri2zaLxzw5DI5XGrYg=
golang.org/x/oauth2 v0.0.0-20221014153046-6fdb5e3db783/go.mo
---
[Medium] chunk lines 1561-1580 in go.sum:
github.com/aws/aws-sdk-go-v2/internal/configsources v1.3.15/go.mod h1:U9ke74k1n2bf+RIgoX1SXFed1HLs51OgUSs+Ph0KJP8=
github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.6.15 h1:C6WHdGnTDIYETAm5iErQUiVNsclNx9qbJVPIt03B6bI=
github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.6.15/go.mod h1:ZQLZqhcu+JhSrA9/NXRm8SkDvsycE+JkV3WGY41e+IM=
github.com/aws/aws-sdk-go-v2/internal/ini v1.8.0 h1:hT8rVHwugYE2lEfdFE0QWVo81lF7jMrYJVDWI+f+VxU=
github.com/aws/aws-sdk-go-v2/internal/ini v1.8.0/go.mod h1:8tu/lYfQ
---
[Medium] chunk lines 2681-2700 in go.sum:
github.com/minio/highwayhash v1.0.1/go.mod h1:BQskDq+xkJ12lmlUUi7U0M5Swg3EWR+dLTk+kldvVxY=
github.com/minio/highwayhash v1.0.2/go.mod h1:BQskDq+xkJ12lmlUUi7U0M5Swg3EWR+dLTk+kldvVxY=
github.com/minio/md5-simd v1.1.2 h1:Gdi1DZK69+ZVMoNHRXJyNcxrMA4dSxoYHZSQbirFg34=
github.com/minio/md5-simd v1.1.2/go.mod h1:MzdKDxYpY2BT9XQFocsiZf/NKVtR7nkE4RoEpN+20RM=
github.com/minio/minio-go/v7 v7.0.63 h1:GbZ2oCvaUdgT5640WJOpyDhhDxvknAJU2/T3yurwcbQ=
github.com/minio/minio-go/v7 v7.0.63/go.mod h1:Q6X7Qjb7WMhvG65qK
---
[Medium] chunk lines 2121-2140 in go.sum:
github.com/google/go-cmp v0.2.0/go.mod h1:oXzfMopK8JAjlY9xF4vHSVASa0yLyX7SntLO5aqRK0M=
github.com/google/go-cmp v0.3.0/go.mod h1:8QqcDgzrUqlUb/G2PQTWiueGozuR1884gddMywk6iLU=
github.com/google/go-cmp v0.3.1/go.mod h1:8QqcDgzrUqlUb/G2PQTWiueGozuR1884gddMywk6iLU=
github.com/google/go-cmp v0.4.0/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=
github.com/google/go-cmp v0.4.1/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=
github.com/google/go-cmp v0.5.0/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V
---
[Medium] chunk lines 2881-2900 in go.sum:
github.com/patrickmn/go-cache v2.1.0+incompatible h1:HRMgzkcYKYpi3C8ajMPV8OFXaaRUnok+kx1WdO15EQc=
github.com/patrickmn/go-cache v2.1.0+incompatible/go.mod h1:3Qf8kWWT7OJRJbdiICTKqZju1ZixQ/KpMGzzAfe6+WQ=
github.com/pbnjay/memory v0.0.0-20210728143218-7b4eea64cf58/go.mod h1:DXv8WO4yhMYhSNPKjeNKa5WY9YCIEBRbNzFFPJbWO6Y=
github.com/pborman/getopt v0.0.0-20170112200414-7148bc3a4c30/go.mod h1:85jBQOZwpVEaDAr341tbn15RS4fCAsIst0qp7i8ex1o=
github.com/pborman/uuid v1.2.0/go.mod h1:X/NO0urCmaxf9VXbdlT7C2Yzk
---
[Medium] chunk lines 1901-1920 in go.sum:
github.com/go-fonts/dejavu v0.1.0/go.mod h1:4Wt4I4OU2Nq9asgDCteaAaWZOV24E+0/Pwo0gppep4g=
github.com/go-fonts/latin-modern v0.2.0/go.mod h1:rQVLdDMK+mK1xscDwsqM5J8U2jrRa3T0ecnM9pNujks=
github.com/go-fonts/liberation v0.1.1/go.mod h1:K6qoJYypsmfVjWg8KOVDQhLc8UDgIK2HYqyqAO9z7GY=
github.com/go-fonts/liberation v0.2.0/go.mod h1:K6qoJYypsmfVjWg8KOVDQhLc8UDgIK2HYqyqAO9z7GY=
github.com/go-fonts/stix v0.1.0/go.mod h1:w/c1f0ldAUlJmLBvlbkvVXLAD+tAMqobIIQpmnUIzUY=
github.com/go-gl/glfw v0.0.0-20190409004039
---
[Medium] chunk lines 1761-1780 in go.sum:
github.com/dave/jennifer v1.6.0 h1:MQ/6emI2xM7wt0tJzJzyUik2Q3Tcn2eE0vtYgh4GPVI=
github.com/dave/jennifer v1.6.0/go.mod h1:AxTG893FiZKqxy3FP1kL80VMshSMuz2G+EgvszgGRnk=
github.com/dave/kerr v0.0.0-20170318121727-bc25dd6abe8e/go.mod h1:qZqlPyPvfsDJt+3wHJ1EvSXDuVjFTK0j2p/ca+gtsb8=
github.com/dave/patsy v0.0.0-20210517141501-957256f50cba/go.mod h1:qfR88CgEGLoiqDaE+xxDCi5QA5v4vUoW0UCX2Nd5Tlc=
github.com/dave/rebecca v0.9.1/go.mod h1:N6XYdMD/OKw3lkF3ywh8Z6wPGuwNFDNtWYEMFWEmXBA=
github.com/davecgh/go-sp
---
[Medium] chunk lines 3481-3500 in go.sum:
golang.org/x/lint v0.0.0-20190409202823-959b441ac422/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=
golang.org/x/lint v0.0.0-20190909230951-414d861bb4ac/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=
golang.org/x/lint v0.0.0-20190930215403-16217165b5de/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=
golang.org/x/lint v0.0.0-20191125180803-fdd1cda4f05f/go.mod h1:5qLYkcX4OjUUV8bRuDixDT3tpyyb+LUpUlRWLxfhWrs=
golang.org/x/lint v0.0.0-20200130185559-910be7a94367/go.mod h1:3xt1F
---
[Medium] chunk lines 3801-3820 in go.sum:
golang.org/x/sys v0.0.0-20220624220833-87e55d714810/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220704084225-05e143d24a9e/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220722155257-8c9f86f7a55f/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220728004956-3c1f35247d10/go.mod h1:oPkhp1MJrh
---
[Medium] chunk lines 3361-3380 in go.sum:
go.uber.org/atomic v1.5.0/go.mod h1:sABNBOSYdrvTF6hTgEIbc7YasKWGhgEQZyfxyTvoXHQ=
go.uber.org/atomic v1.7.0/go.mod h1:fEN4uk6kAWBTFdckzkM89CLk9XfWZrxpCo0nPH17wJc=
go.uber.org/atomic v1.9.0/go.mod h1:fEN4uk6kAWBTFdckzkM89CLk9XfWZrxpCo0nPH17wJc=
go.uber.org/atomic v1.11.0 h1:ZvwS0R+56ePWxUNi+Atn9dWONBPp/AUETXlHW0DxSjE=
go.uber.org/atomic v1.11.0/go.mod h1:LUxbIzbOniOlMKjJjyPfpl4v+PKK2cNJn91OQbhoJI0=
go.uber.org/automaxprocs v1.5.3/go.mod h1:eRbA25aqJrxAbsLO0xy5jVwPt7FQnRgjW+efnwa1WM0=
go.uber.org/g
---
[Medium] chunk lines 4261-4280 in go.sum:
google.golang.org/genproto v0.0.0-20240102182953-50ed04b92917/go.mod h1:pZqR+glSb11aJ+JQcczCvgf47+duRuzNSKqE8YAQnV0=
google.golang.org/genproto v0.0.0-20240116215550-a9fa1716bcac/go.mod h1:+Rvu7ElI+aLzyDQhpHMFMMltsD6m7nqpuWDd2CwJw3k=
google.golang.org/genproto v0.0.0-20240123012728-ef4313101c80/go.mod h1:cc8bqMqtv9gMOr0zHg2Vzff5ULhhL2IXP4sbcn32Dro=
google.golang.org/genproto v0.0.0-20240125205218-1f4bbc51befe/go.mod h1:cc8bqMqtv9gMOr0zHg2Vzff5ULhhL2IXP4sbcn32Dro=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 2061-2080 in go.sum:
github.com/golang/glog v1.0.0/go.mod h1:EWib/APOK0SL3dFbYqvxE3UYd8E6s1ouQ7iEp/0LWV4=
github.com/golang/glog v1.1.0/go.mod h1:pfYeQZ3JWZoXTV5sFc986z3HTpwQs9At6P4ImfuP3NQ=
github.com/golang/glog v1.1.2/go.mod h1:zR+okUeTbrL6EL3xHUDxZuEtGv04p5shwip1+mL/rLQ=
github.com/golang/glog v1.2.0/go.mod h1:6AhwSGph0fcJtXVM/PEHPqZlFeoLxhs7/t5UDAwmO+w=
github.com/golang/groupcache v0.0.0-20160516000752-02826c3e7903/go.mod h1:cIg4eruTrX1D+g88fzRXU5OdNfaM+9IcxsU14FzY7Hc=
github.com/golang/groupcache v0.0.0-20190
---
[Medium] chunk lines 4581-4600 in go.sum:
modernc.org/libc v1.55.3/go.mod h1:qFXepLhz+JjFThQ4kzwzOjA/y/artDeg+pcYnY+Q83w=
modernc.org/mathutil v1.2.2/go.mod h1:mZW8CKdRPY1v87qxC/wUdX5O1qDzXMP5TH3wjfpga6E=
modernc.org/mathutil v1.4.1/go.mod h1:mZW8CKdRPY1v87qxC/wUdX5O1qDzXMP5TH3wjfpga6E=
modernc.org/mathutil v1.5.0/go.mod h1:mZW8CKdRPY1v87qxC/wUdX5O1qDzXMP5TH3wjfpga6E=
modernc.org/mathutil v1.6.0 h1:fRe9+AmYlaej+64JsEEhoWuAYBkOtQiMEU7n/XgfYi4=
modernc.org/mathutil v1.6.0/go.mod h1:Ui5Q9q1TR2gFm0AQRqQUaBWFLAhQpCwNcuhBOSedWPo=
modernc.org/
---
[Medium] chunk lines 1681-1700 in go.sum:
github.com/chzyer/logex v1.2.1/go.mod h1:JLbx6lG2kDbNRFnfkgvh4eRJRPX1QCoOIWomwysCBrQ=
github.com/chzyer/readline v0.0.0-20180603132655-2972be24d48e/go.mod h1:nSuG5e5PlCu98SY8svDHJxuZscDgtXS6KTTbou5AhLI=
github.com/chzyer/readline v1.5.0/go.mod h1:x22KAscuvRqlLoK9CsoYsmxoXZMMFVyOl86cAH8qUic=
github.com/chzyer/readline v1.5.1/go.mod h1:Eh+b79XXUwfKfcPLepksvw2tcLE/Ct21YObkaSkeBlk=
github.com/chzyer/test v0.0.0-20180213035817-a1ea475d72b1/go.mod h1:Q3SI9o4m/ZMnBNeIyt5eFwwo7qiLfzFZmjNmxjkiQlU=
github
---
[Medium] chunk lines 2301-2320 in go.sum:
github.com/grafana/grafana/pkg/util/xorm v0.0.1/go.mod h1:eNfbB9f2jM8o9RfwqwjY8SYm5tvowJ8Ly+iE4P9rXII=
github.com/grafana/otel-profiling-go v0.5.1 h1:stVPKAFZSa7eGiqbYuG25VcqYksR6iWvF3YH66t4qL8=
github.com/grafana/otel-profiling-go v0.5.1/go.mod h1:ftN/t5A/4gQI19/8MoWurBEtC6gFw8Dns1sJZ9W4Tls=
github.com/grafana/prometheus-alertmanager v0.25.1-0.20240930132144-b5e64e81e8d3 h1:6D2gGAwyQBElSrp3E+9lSr7k8gLuP3Aiy20rweLWeBw=
github.com/grafana/prometheus-alertmanager v0.25.1-0.20240930132144-b5e64e81e
---
[Medium] chunk lines 2521-2540 in go.sum:
github.com/josharian/intern v1.0.0 h1:vlS4z54oSdjm0bgjRigI+G1HpF+tI+9rE5LLzOg8HmY=
github.com/josharian/intern v1.0.0/go.mod h1:5DoeVV0s6jJacbCEi61lwdGj/aVlrQvzHFFd8Hwg//Y=
github.com/jpillora/backoff v1.0.0 h1:uvFg412JmmHBHw7iwprIxkPMI+sGQ4kzOWsMeHnm2EA=
github.com/jpillora/backoff v1.0.0/go.mod h1:J/6gKK9jxlEcS3zixgDgUAsiuZ7yrSoa/FX5e0EB2j4=
github.com/json-iterator/go v1.1.6/go.mod h1:+SdeFBvtyEkXs7REEP0seUULqWtbJapLOCVDaaPEHmU=
github.com/json-iterator/go v1.1.7/go.mod h1:KdQUCv79m/52Kvf8AW2
---
[Medium] chunk lines 3581-3600 in go.sum:
golang.org/x/net v0.0.0-20220225172249-27dd8689420f/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=
golang.org/x/net v0.0.0-20220325170049-de3da57026de/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=
golang.org/x/net v0.0.0-20220412020605-290c469a71a5/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=
golang.org/x/net v0.0.0-20220425223048-2871e0cb64e4/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=
golang.org/x/net v0.0.0-20220520000938-2e3eb7b945c2/go.mod h1:CfG3xpIq0w
---
[Medium] chunk lines 1481-1500 in go.sum:
github.com/alecthomas/participle/v2 v2.0.0/go.mod h1:rAKZdJldHu8084ojcWevWAL8KmEU+AT+Olodb+WoN2Y=
github.com/alecthomas/participle/v2 v2.1.0/go.mod h1:Y1+hAs8DHPmc3YUFzqllV+eSQ9ljPTk0ZkPMtEdAx2c=
github.com/alecthomas/repr v0.2.0/go.mod h1:Fr0507jx4eOXV7AlPV6AVZLYrLIuIeSOWtW57eE/O/4=
github.com/alecthomas/template v0.0.0-20160405071501-a0175ee3bccc/go.mod h1:LOuyumcjzFXgccqObfd/Ljyb9UuFJ6TxHnclSeseNhc=
github.com/alecthomas/template v0.0.0-20190718012654-fb15b899a751/go.mod h1:LOuyumcjzFXgccqObf
---
[Medium] chunk lines 4161-4180 in go.sum:
google.golang.org/genproto v0.0.0-20210917145530-b395a37504d4/go.mod h1:eFjDcFEctNawg4eG61bRv87N7iHBWyVhJu7u1kqDUXY=
google.golang.org/genproto v0.0.0-20210924002016-3dee208752a0/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=
google.golang.org/genproto v0.0.0-20211008145708-270636b82663/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=
google.golang.org/genproto v0.0.0-20211028162531-8db9c33dc351/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 1821-1840 in go.sum:
github.com/emicklei/go-restful/v3 v3.8.0/go.mod h1:6n3XBCmQQb25CM2LCACGz8ukIrRry+4bhvbpWn3mrbc=
github.com/emicklei/go-restful/v3 v3.11.0 h1:rAQeMHw1c7zTmncogyy8VvRZwtkmkZ4FxERmMY4rD+g=
github.com/emicklei/go-restful/v3 v3.11.0/go.mod h1:6n3XBCmQQb25CM2LCACGz8ukIrRry+4bhvbpWn3mrbc=
github.com/emicklei/proto v1.10.0 h1:pDGyFRVV5RvV+nkBK9iy3q67FBy9Xa7vwrOTE+g5aGw=
github.com/emicklei/proto v1.10.0/go.mod h1:rn1FgRS/FANiZdD2djyH7TMA9jdRDcYQ9IEN9yvjX0A=
github.com/emirpasic/gods v1.18.1 h1:FXtiHYKDG
---
[Medium] chunk lines 1661-1680 in go.sum:
github.com/census-instrumentation/opencensus-proto v0.4.1/go.mod h1:4T9NM4+4Vw91VeyqjLS6ao50K5bOcLKN6Q42XnYaRYw=
github.com/centrifugal/centrifuge v0.33.3 h1:uyqBc27oM+qnC3NX5imvZxuk9+u2ze6QGWHDICZeoSc=
github.com/centrifugal/centrifuge v0.33.3/go.mod h1:GaOF4CiREY5x6lW7zYUz46Qrc6aUZ6J/AMV/kROc2+U=
github.com/centrifugal/protocol v0.13.4 h1:I0YxXtFNfn/ndDIZp5RkkqQcSSNH7DNPUbXKYtJXDzs=
github.com/centrifugal/protocol v0.13.4/go.mod h1:7V5vI30VcoxJe4UD87xi7bOsvI0bmEhvbQuMjrFM2L4=
github.com/cespar
---
[Medium] chunk lines 2181-2200 in go.sum:
github.com/google/s2a-go v0.1.8 h1:zZDs9gcbt9ZPLV0ndSyQk6Kacx2g/X+SKYovpnz3SMM=
github.com/google/s2a-go v0.1.8/go.mod h1:6iNWHTpQ+nfNRN5E00MSdfDwVesa8hhS32PhPO8deJA=
github.com/google/subcommands v1.2.0/go.mod h1:ZjhPrFU+Olkh9WazFPsl27BQ4UPiG37m3yTrtFlrHVk=
github.com/google/uuid v1.0.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=
github.com/google/uuid v1.1.1/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=
github.com/google/uuid v1.1.2/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOe
---
[Medium] chunk lines 2241-2260 in go.sum:
github.com/gorilla/websocket v0.0.0-20170926233335-4201258b820c/go.mod h1:E7qHFY5m1UJ88s3WnNqhKjPHQ0heANvMoAMk2YaljkQ=
github.com/gorilla/websocket v1.4.2/go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU/adAjf1fMHhE=
github.com/gorilla/websocket v1.5.0 h1:PPwGk2jz7EePpoHN/+ClbZu8SPxiqlu12wZP/3sWmnc=
github.com/gorilla/websocket v1.5.0/go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU/adAjf1fMHhE=
github.com/grafana/alerting v0.0.0-20241010165806-807ddf183724 h1:u+ZM5TLkdeEoSWXgYWxc4XRfPHhXpR63MyHXJxbBLrc=
gith
---
[Medium] chunk lines 3501-3520 in go.sum:
golang.org/x/mod v0.5.1/go.mod h1:5OXOZSfqPIIbmVBIIKWRFfZjPR0E5r58TLhUjH0a2Ro=
golang.org/x/mod v0.6.0-dev.0.20211013180041-c96bc1413d57/go.mod h1:3p9vT2HGsQu2K1YbXdKPJLVgG5VJdoTa1poYQBtP1AY=
golang.org/x/mod v0.6.0-dev.0.20220106191415-9b9b3d81d5e3/go.mod h1:3p9vT2HGsQu2K1YbXdKPJLVgG5VJdoTa1poYQBtP1AY=
golang.org/x/mod v0.6.0-dev.0.20220419223038-86c51ed26bb4/go.mod h1:jJ57K6gSWd91VN4djpZkiMVwK6gcyfeH4XE8wZrZaV4=
golang.org/x/mod v0.6.0/go.mod h1:4mET923SAdbXp2ki8ey+zGs1SLqsuM2Y0uvdZR/fUNI=
gol
---
[Medium] chunk lines 3881-3900 in go.sum:
golang.org/x/time v0.0.0-20200416051211-89c76fbcd5d1/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.0.0-20210723032227-1f47c861a9ac/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.0.0-20220922220347-f3bd1da661af/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.1.0/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.3.0/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/tim
---
[Medium] chunk lines 4181-4200 in go.sum:
google.golang.org/genproto v0.0.0-20220429170224-98d788798c3e/go.mod h1:8w6bsBMX6yCPbAVTeqQHvzxW0EIFigd5lZyahWgyfDo=
google.golang.org/genproto v0.0.0-20220502173005-c8bf987b8c21/go.mod h1:RAyBrSAP7Fh3Nc84ghnVLDPuV51xc9agzmm4Ph6i0Q4=
google.golang.org/genproto v0.0.0-20220505152158-f39f71e6c8f3/go.mod h1:RAyBrSAP7Fh3Nc84ghnVLDPuV51xc9agzmm4Ph6i0Q4=
google.golang.org/genproto v0.0.0-20220518221133-4f43b3371335/go.mod h1:RAyBrSAP7Fh3Nc84ghnVLDPuV51xc9agzmm4Ph6i0Q4=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 4221-4240 in go.sum:
google.golang.org/genproto v0.0.0-20230110181048-76db0878b65f/go.mod h1:RGgjbofJ8xD9Sq1VVhDM1Vok1vRONV+rg+CjzG4SZKM=
google.golang.org/genproto v0.0.0-20230112194545-e10362b5ecf9/go.mod h1:RGgjbofJ8xD9Sq1VVhDM1Vok1vRONV+rg+CjzG4SZKM=
google.golang.org/genproto v0.0.0-20230113154510-dbe35b8444a5/go.mod h1:RGgjbofJ8xD9Sq1VVhDM1Vok1vRONV+rg+CjzG4SZKM=
google.golang.org/genproto v0.0.0-20230123190316-2c411cf9d197/go.mod h1:RGgjbofJ8xD9Sq1VVhDM1Vok1vRONV+rg+CjzG4SZKM=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 3301-3320 in go.sum:
go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.55.0 h1:ZIg3ZT/aQ7AfKqdwp7ECpOK6vHqquXXuyTjIO8ZdmPs=
go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.55.0/go.mod h1:DQAwmETtZV00skUwgD6+0U89g80NKsJE3DCKeLLPQMI=
go.opentelemetry.io/contrib/propagators/jaeger v1.29.0 h1:+YPiqF5rR6PqHBlmEFLPumbSP0gY0WmCGFayXRcCLvs=
go.opentelemetry.io/contrib/propagators/jaeger v1.29.0/go.mod h1:6PD7q7qquWSp3Z4HeM3e/2ipRubaY1rXZO8NIHVDZjs=
go.opentelemetry.io/contrib/samplers/jaegerr
---
[Medium] chunk lines 4421-4440 in go.sum:
google.golang.org/protobuf v1.21.0/go.mod h1:47Nbq4nVaFHyn7ilMalzfO3qCViNmqZ2kzikPIcrTAo=
google.golang.org/protobuf v1.22.0/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=
google.golang.org/protobuf v1.23.0/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=
google.golang.org/protobuf v1.23.1-0.20200526195155-81db48ad09cc/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=
google.golang.org/protobuf v1.24.0/go.mod h1:r/3tXBNzIEhYS9I1OUVjXDlt8tc493IdKGjtUeSXeh4=
google.golang.org/pr
---
[Medium] chunk lines 4401-4420 in go.sum:
google.golang.org/grpc v1.57.0/go.mod h1:Sd+9RMTACXwmub0zcNY2c4arhtrbBYD1AUHI/dt16Mo=
google.golang.org/grpc v1.58.2/go.mod h1:tgX3ZQDlNJGU96V6yHh1T/JeoBQ2TXdr43YbYSsCJk0=
google.golang.org/grpc v1.58.3/go.mod h1:tgX3ZQDlNJGU96V6yHh1T/JeoBQ2TXdr43YbYSsCJk0=
google.golang.org/grpc v1.59.0/go.mod h1:aUPDwccQo6OTjy7Hct4AfBPD1GptF4fyUjIkQ9YtF98=
google.golang.org/grpc v1.60.0/go.mod h1:OlCHIeLYqSSsLi6i49B5QGdzaMZK9+M7LXN2FKz4eGM=
google.golang.org/grpc v1.60.1/go.mod h1:OlCHIeLYqSSsLi6i49B5QGdzaMZK9
---
[Medium] chunk lines 2941-2960 in go.sum:
github.com/prometheus/client_golang v1.15.1/go.mod h1:e9yaBhRPU2pPNsZwE+JdQl0KEt1N9XgF6zxWmaC0xOk=
github.com/prometheus/client_golang v1.17.0/go.mod h1:VeL+gMmOAxkS2IqfCq0ZmHSL+LjWfWDUmp1mBz9JgUY=
github.com/prometheus/client_golang v1.18.0/go.mod h1:T+GXkCk5wSJyOqMIzVgvvjFDlkOQntgjkJWKrN5txjA=
github.com/prometheus/client_golang v1.19.0/go.mod h1:ZRM9uEAypZakd+q/x7+gmsvXdURP+DABIEIjnmDdp+k=
github.com/prometheus/client_golang v1.20.4 h1:Tgh3Yr67PaOv/uTqloMsCEdeuFTatm5zIq5+qNN23vI=
github.com/p
---
[Medium] chunk lines 3961-3980 in go.sum:
golang.org/x/tools v0.1.9/go.mod h1:nABZi5QlRsZVlzPpHl034qft6wpY4eDcsTt5AaioBiU=
golang.org/x/tools v0.1.10/go.mod h1:Uh6Zz+xoGYZom868N8YTex3t7RhtHDBrE8Gzo9bV56E=
golang.org/x/tools v0.1.12/go.mod h1:hNGJHUnrk76NpqgfD5Aqm5Crs+Hm0VOH/i9J2+nxYbc=
golang.org/x/tools v0.2.0/go.mod h1:y4OqIKeOV/fWJetJ8bXPU1sEVniLMIyDAZWeHdV+NTA=
golang.org/x/tools v0.3.0/go.mod h1:/rWhSS2+zyEVwoJf8YAX6L2f0ntZ7Kn/mGgAWcipA5k=
golang.org/x/tools v0.4.0/go.mod h1:UE5sM2OK9E/d67R0ANs2xJizIymRP5gJU295PvKXxjQ=
golang.org/x
---
[Medium] chunk lines 3981-4000 in go.sum:
golang.org/x/tools v0.20.0/go.mod h1:WvitBU7JJf6A4jOdg4S1tviW9bhUxkgeCui/0JHctQg=
golang.org/x/tools v0.24.0 h1:J1shsA93PJUEVaUSaay7UXAyE8aimq3GW0pjlolpa24=
golang.org/x/tools v0.24.0/go.mod h1:YhNqVBIfWHdzvTLs0d8LCuMhkKUgSUKldakyV7W/WDQ=
golang.org/x/xerrors v0.0.0-20190717185122-a985d3407aa7/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
golang.org/x/xerrors v0.0.0-20191011141410-1b5146add898/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
golang.org/x/xerrors v0.0.0-20191204190
---
[Medium] chunk lines 3841-3860 in go.sum:
golang.org/x/term v0.9.0/go.mod h1:M6DEAAIenWoTxdKrOltXcmDY3rSplQUkrvaDU5FcQyo=
golang.org/x/term v0.10.0/go.mod h1:lpqdcUyK/oCiQxvxVrppt5ggO2KCZ5QblwqPnfZ6d5o=
golang.org/x/term v0.11.0/go.mod h1:zC9APTIj3jG3FdV/Ons+XE1riIZXG4aZ4GTHiPZJPIU=
golang.org/x/term v0.12.0/go.mod h1:owVbMEjm3cBLCHdkQu9b1opXd4ETQWc3BhuQGKgXgvU=
golang.org/x/term v0.13.0/go.mod h1:LTmsnFJwVN6bCy1rVCoS+qHT1HhALEFxKncY3WNNh4U=
golang.org/x/term v0.14.0/go.mod h1:TySc+nGkYR6qt8km8wUhuFRTVSMIX3XPR58y2lC8vww=
golang.org/x/te
---
[Medium] chunk lines 2701-2720 in go.sum:
github.com/mitchellh/go-testing-interface v1.14.1/go.mod h1:gfgS7OtZj6MA4U1UrDRp04twqAjfvlZyCfX3sDjEym8=
github.com/mitchellh/go-wordwrap v1.0.0/go.mod h1:ZXFpozHsX6DPmq2I0TCekCxypsnAUbP2oI0UX1GXzOo=
github.com/mitchellh/go-wordwrap v1.0.1 h1:TLuKupo69TCn6TQSyGxwI1EblZZEsQ0vMlAFQflz0v0=
github.com/mitchellh/go-wordwrap v1.0.1/go.mod h1:R62XHJLzvMFRBbcrT7m7WgmE1eOyTSsCt+hzestvNj0=
github.com/mitchellh/gox v0.4.0/go.mod h1:Sd9lOJ0+aimLBi73mGofS1ycjY8lL3uZM3JPS42BGNg=
github.com/mitchellh/iochan v1
---
[Medium] chunk lines 3521-3540 in go.sum:
golang.org/x/net v0.0.0-20180826012351-8a410e7b638d/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20180906233101-161cd47e91fd/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20181023162649-9b4f9f5ad519/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20181108082009-03003ca0c849/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20181114220301-adae6a3d119a/go.mod h1:mL1N/T3taQ
---
[Medium] chunk lines 3261-3280 in go.sum:
go.etcd.io/etcd/client/v3 v3.5.14 h1:CWfRs4FDaDoSz81giL7zPpZH2Z35tbOrAJkkjMqOupg=
go.etcd.io/etcd/client/v3 v3.5.14/go.mod h1:k3XfdV/VIHy/97rqWjoUzrj9tk7GgJGH9J8L4dNXmAk=
go.etcd.io/etcd/pkg/v3 v3.5.13 h1:st9bDWNsKkBNpP4PR1MvM/9NqUPfvYZx/YXegsYEH8M=
go.etcd.io/etcd/pkg/v3 v3.5.13/go.mod h1:N+4PLrp7agI/Viy+dUYpX7iRtSPvKq+w8Y14d1vX+m0=
go.etcd.io/etcd/raft/v3 v3.5.13 h1:7r/NKAOups1YnKcfro2RvGGo2PTuizF/xh26Z2CTAzA=
go.etcd.io/etcd/raft/v3 v3.5.13/go.mod h1:uUFibGLn2Ksm2URMxN1fICGhk8Wu96EfDQyuLhAcAm
---
[Medium] chunk lines 1841-1860 in go.sum:
github.com/envoyproxy/go-control-plane v0.11.1/go.mod h1:uhMcXKCQMEJHiAb0w+YGefQLaTEw+YhGluxZkrTmD0g=
github.com/envoyproxy/go-control-plane v0.12.0/go.mod h1:ZBTaoJ23lqITozF0M6G4/IragXCQKCnYbmlmtHvwRG0=
github.com/envoyproxy/go-control-plane v0.13.0 h1:HzkeUz1Knt+3bK+8LG1bxOO/jzWZmdxpwC51i202les=
github.com/envoyproxy/go-control-plane v0.13.0/go.mod h1:GRaKG3dwvFoTg4nj7aXdZnvMg4d7nvT/wl9WgVXn3Q8=
github.com/envoyproxy/protoc-gen-validate v0.1.0/go.mod h1:iSmxcyjqTsJpI2R4NaDN7+kN2VEUnK/pcBlmesAr
---
[Medium] chunk lines 4481-4500 in go.sum:
gopkg.in/yaml.v3 v3.0.0-20200313102051-9f266ea9e77c/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.0-20200615113413-eeeca48fe776/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307b/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.1 h1:fxVm/GzAzEWqLHuvctI91KS9hhNmmWOoWu0XTYJS7CA=
gopkg.in/yaml.v3 v3.0.1/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gotest.tools v2.2.0+incompat
---
[Medium] chunk lines 2261-2280 in go.sum:
github.com/grafana/dskit v0.0.0-20240311184239-73feada6c0d7 h1:yd9yoNgEOtp8O0MbtqXoMVqr+ZbU4oZFE8a04z8WXFE=
github.com/grafana/dskit v0.0.0-20240311184239-73feada6c0d7/go.mod h1:RpTvZ9nkdXqyQro5DULQHJl9B6vwvEj95Dk6WIXqTLQ=
github.com/grafana/e2e v0.1.1 h1:/b6xcv5BtoBnx8cZnCiey9DbjEc8z7gXHO5edoeRYxc=
github.com/grafana/e2e v0.1.1/go.mod h1:RpNLgae5VT+BUHvPE+/zSypmOXKwEu4t+tnEMS1ATaE=
github.com/grafana/gofpdf v0.0.0-20231002120153-857cc45be447 h1:jxJJ5z0GxqhWFbQUsys3BHG8jnmniJ2Q74tXAG1NaDo=
githu
---
[Medium] chunk lines 3741-3760 in go.sum:
golang.org/x/sys v0.0.0-20200615200032-f1bc736245b1/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200625212154-ddb9806d33ae/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200803210538-64077c9b5642/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200905004654-be1d3432aa8f/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200909081042-eff7692f9009/go.mod h1:h1NjWce9XR
---
[Medium] chunk lines 2721-2740 in go.sum:
github.com/mithrandie/go-file/v2 v2.1.0 h1:XA5Tl+73GXMDvgwSE3Sg0uC5FkLr3hnXs8SpUas0hyg=
github.com/mithrandie/go-file/v2 v2.1.0/go.mod h1:9YtTF3Xo59GqC1Pxw6KyGVcM/qubAMlxVsqI/u9r++c=
github.com/mithrandie/go-text v1.6.0 h1:8gOXTMPbMY8DJbKMTv8kHhADcJlDWXqS/YQH4SyWO6s=
github.com/mithrandie/go-text v1.6.0/go.mod h1:xCgj1xiNbI/d4xA9sLVvXkjh5B2tNx2ZT2/3rpmh8to=
github.com/mithrandie/ternary v1.1.1 h1:k/joD6UGVYxHixYmSR8EGgDFNONBMqyD373xT4QRdC4=
github.com/mithrandie/ternary v1.1.1/go.mod h1:0D9Ba3+0
---
[Medium] chunk lines 3161-3180 in go.sum:
github.com/teris-io/shortid v0.0.0-20171029131806-771a37caa5cf/go.mod h1:M8agBzgqHIhgj7wEn9/0hJUZcrvt9VY+Ln+S1I5Mha0=
github.com/thanos-io/objstore v0.0.0-20220809103346-8ef1f215e2bf h1:onQsPyHlq2yIWU+Nfl6yStuqnZuVQQN8FZ8sBb2wqtw=
github.com/thanos-io/objstore v0.0.0-20220809103346-8ef1f215e2bf/go.mod h1:v0NhuxxxUFUPatQcVNSCUkBEVezXzl7LSdaBOZygq98=
github.com/tidwall/pretty v0.0.0-20180105212114-65a9db5fad51/go.mod h1:XNkn88O1ChpSDQmQeStsy+sBenx6DDtFZJxhVysOjyk=
github.com/tmc/grpc-websocket-pro
---
[Medium] chunk lines 2221-2240 in go.sum:
github.com/googleapis/gax-go/v2 v2.12.3/go.mod h1:AKloxT6GtNbaLm8QTNSidHUVsHYcBHwWRvkNFJUQcS4=
github.com/googleapis/gax-go/v2 v2.13.0 h1:yitjD5f7jQHhyDsnhKEBU52NdvvdSeGzlAnDPT0hH1s=
github.com/googleapis/gax-go/v2 v2.13.0/go.mod h1:Z/fvTZXF8/uw7Xu5GuslPw+bplx6SS338j1Is2S+B7A=
github.com/googleapis/go-type-adapters v1.0.0/go.mod h1:zHW75FOG2aur7gAO2B+MLby+cLsWGBF62rFAi7WjWO4=
github.com/googleapis/google-cloud-go-testing v0.0.0-20200911160855-bcd43fbb19e8/go.mod h1:dvDLG8qkwmyD9a/MJJN3XJcT3xFxOK
---
[Medium] chunk lines 1601-1620 in go.sum:
github.com/beorn7/perks v1.0.0/go.mod h1:KWe93zE9D1o94FZ5RNwFwVgaQK1VOXiVxmqh+CedLV8=
github.com/beorn7/perks v1.0.1 h1:VlbKKnNfV8bJzeqoa4cOKqO6bYr3WgKZxO8Z16+hsOM=
github.com/beorn7/perks v1.0.1/go.mod h1:G2ZrVWU2WbWT9wwq4/hrbKbnv/1ERSJQ0ibhJ6rlkpw=
github.com/bgentry/speakeasy v0.1.0/go.mod h1:+zsyZBPWlz7T6j88CTgSN5bM796AkVf0kBD4zp0CCIs=
github.com/bitly/go-hostpool v0.0.0-20171023180738-a3a6125de932/go.mod h1:NOuUCSz6Q9T7+igc/hlvDOUdtWKryOrtFyIVABv/p7k=
github.com/bits-and-blooms/bitset v1.2.
---
[Medium] chunk lines 2341-2360 in go.sum:
github.com/hashicorp/consul/api v1.3.0/go.mod h1:MmDNSzIMUjNpY/mQ398R4bk2FnqQLoPndWW5VkKPlCE=
github.com/hashicorp/consul/api v1.10.1/go.mod h1:XjsvQN+RJGWI2TWy1/kqaE16HrR2J/FWgkYjdZQsX9M=
github.com/hashicorp/consul/api v1.12.0/go.mod h1:6pVBMo0ebnYdt2S3H87XhekM/HHrUoTD2XXb/VrZVy0=
github.com/hashicorp/consul/api v1.28.2 h1:mXfkRHrpHN4YY3RqL09nXU1eHKLNiuAN4kHvDQ16k/8=
github.com/hashicorp/consul/api v1.28.2/go.mod h1:KyzqzgMEya+IZPcD65YFoOVAgPpbfERu4I/tzG6/ueE=
github.com/hashicorp/consul/sdk v
---
[Medium] chunk lines 1941-1960 in go.sum:
github.com/go-logr/zapr v1.3.0 h1:XGdV8XW8zdwFiwOA2Dryh1gj2KRQyOOoNmBy4EplIcQ=
github.com/go-logr/zapr v1.3.0/go.mod h1:YKepepNBd1u/oyhd/yQmtjVXmm9uML4IXUgMOwR8/Gg=
github.com/go-openapi/analysis v0.21.5/go.mod h1:25YcZosX9Lwz2wBsrFrrsL8bmjjXdlyP6zsr2AMy29M=
github.com/go-openapi/analysis v0.22.0/go.mod h1:acDnkkCI2QxIo8sSIPgmp1wUlRohV7vfGtAIVae73b0=
github.com/go-openapi/analysis v0.22.2/go.mod h1:pDF4UbZsQTo/oNuRfAWWd4dAh4yuYf//LYorPTjrpvo=
github.com/go-openapi/analysis v0.23.0 h1:aGday7OWupf
---
[Medium] chunk lines 2621-2640 in go.sum:
github.com/mailru/easyjson v0.7.7/go.mod h1:xzfreul335JAWq5oZzymOObrkdz5UnU4kGfJJLY9Nlc=
github.com/matryer/is v1.4.0 h1:sosSmIWwkYITGrxZ25ULNDeKiMNzFSr4V/eqBQP0PeE=
github.com/matryer/is v1.4.0/go.mod h1:8I/i5uYgLzgsgEloJE1U6xx5HkBQpAZvepWuujKwMRU=
github.com/mattermost/xml-roundtrip-validator v0.1.0 h1:RXbVD2UAl7A7nOTR4u7E3ILa4IbtvKBHw64LDsmu9hU=
github.com/mattermost/xml-roundtrip-validator v0.1.0/go.mod h1:qccnGMcpgwcNaBnxqpJpWWUiPNr5H3O8eDgGV9gT5To=
github.com/mattetti/filebuffer v1.0.1 h1:
---
[Medium] chunk lines 2741-2760 in go.sum:
github.com/modern-go/reflect2 v1.0.2/go.mod h1:yWuevngMOJpCy52FWWMvUC8ws7m/LJsjYzDa0/r8luk=
github.com/modocache/gover v0.0.0-20171022184752-b58185e213c5/go.mod h1:caMODM3PzxT8aQXRPkAt8xlV/e7d7w8GM5g0fa5F0D8=
github.com/mohae/deepcopy v0.0.0-20170929034955-c48cc78d4826 h1:RWengNIwukTxcDr9M+97sNutRR1RKhG96O6jWumTTnw=
github.com/mohae/deepcopy v0.0.0-20170929034955-c48cc78d4826/go.mod h1:TaXosZuwdSHYgviHp1DAtfrULt5eUgsSMsZf+YrPgl8=
github.com/montanaflynn/stats v0.0.0-20171201202039-1bf9dbcd8cbe/g
---
[Medium] chunk lines 1861-1880 in go.sum:
github.com/fatih/color v1.10.0/go.mod h1:ELkj/draVOlAH/xkhN6mQ50Qd0MPOk5AAr3maGEBuJM=
github.com/fatih/color v1.12.0/go.mod h1:ELkj/draVOlAH/xkhN6mQ50Qd0MPOk5AAr3maGEBuJM=
github.com/fatih/color v1.13.0/go.mod h1:kLAiJbzzSOZDVNGyDpeOxJ47H46qBXwg5ILebYFFOfk=
github.com/fatih/color v1.14.1/go.mod h1:2oHN61fhTpgcxD3TSWCgKDiH1+x4OiDVVGH8WlgGZGg=
github.com/fatih/color v1.15.0/go.mod h1:0h5ZqXfHYED7Bhv2ZJamyIOUej9KtShiJESRwBDUSsw=
github.com/fatih/color v1.17.0 h1:GlRw1BRJxkpqUCBKzKOw098ed57fEsKeNjpT
---
[Medium] chunk lines 1521-1540 in go.sum:
github.com/armon/go-metrics v0.0.0-20180917152333-f0300d1749da/go.mod h1:Q73ZrmVTwzkszR9V5SSuryQ31EELlFMUz1kKyl939pY=
github.com/armon/go-metrics v0.3.9/go.mod h1:4O98XIr/9W0sxpJ8UaYkvjk10Iff7SnFrb4QAOwNTFc=
github.com/armon/go-metrics v0.3.10/go.mod h1:4O98XIr/9W0sxpJ8UaYkvjk10Iff7SnFrb4QAOwNTFc=
github.com/armon/go-metrics v0.4.1 h1:hR91U9KYmb6bLBYLQjyM+3j+rcd/UhE+G78SFnF8gJA=
github.com/armon/go-metrics v0.4.1/go.mod h1:E6amYzXo6aW1tqzoZGT755KkbgrJsSdpwZ+3JqfkOG4=
github.com/armon/go-radix v0
---
[Medium] chunk lines 1441-1460 in go.sum:
github.com/Masterminds/semver/v3 v3.2.0 h1:3MEsd0SM6jqZojhjLWWeBY+Kcjy9i6MQAeY7YgDP83g=
github.com/Masterminds/semver/v3 v3.2.0/go.mod h1:qvl/7zhW3nngYb5+80sSMF+FG2BjYrf8m9wsX0PNOMQ=
github.com/Masterminds/sprig/v3 v3.2.1/go.mod h1:UoaO7Yp8KlPnJIYWTFkMaqPUYKTfGFPhxNuwnnxkKlk=
github.com/Masterminds/sprig/v3 v3.2.3 h1:eL2fZNezLomi0uOLqjQoN6BfsDD+fyLtgbJMAj9n6YA=
github.com/Masterminds/sprig/v3 v3.2.3/go.mod h1:rXcFaZ2zZbLRJv/xSysmlgIM1u11eBaRMhvYXJNkGuM=
github.com/Masterminds/squirrel v1.5.4 h1:
---
[Medium] chunk lines 3201-3220 in go.sum:
github.com/x448/float16 v0.8.4/go.mod h1:14CWIYCyZA/cWjXOioeEpHeN/83MdbZDRQHoFcYsOfg=
github.com/xanzy/go-gitlab v0.15.0/go.mod h1:8zdQa/ri1dfn8eS3Ir1SyfvOKlw7WBJ8DVThkpGiXrs=
github.com/xdg-go/pbkdf2 v1.0.0/go.mod h1:jrpuAogTd400dnrH08LKmI/xc1MbPOebTwRqcT5RDeI=
github.com/xdg-go/scram v1.1.2/go.mod h1:RT/sEzTbU5y00aCK8UOx6R7YryM0iF1N2MOmC3kKLN4=
github.com/xdg-go/stringprep v1.0.4/go.mod h1:mPGuuIYwz7CmR2bT9j4GbQqutWS1zV24gijq1dTyGkM=
github.com/xdg/scram v0.0.0-20180814205039-7eeb5667e42c/go.m
---
[Medium] chunk lines 3241-3260 in go.sum:
go.einride.tech/aip v0.66.0/go.mod h1:qAhMsfT7plxBX+Oy7Huol6YUvZ0ZzdUz26yZsQwfl1M=
go.etcd.io/bbolt v1.3.3/go.mod h1:IbVyRI1SCnLcuJnV2u8VeU0CEYM7e686BmAb1XKL+uU=
go.etcd.io/bbolt v1.3.9 h1:8x7aARPEXiXbHmtUwAIv7eV2fQFHrLLavdiJ3uzJXoI=
go.etcd.io/bbolt v1.3.9/go.mod h1:zaO32+Ti0PK1ivdPtgMESzuzL2VPoIG1PCQNvOdo/dE=
go.etcd.io/etcd v0.0.0-20191023171146-3cf2f69b5738 h1:VcrIfasaLFkyjk6KNlXQSzO+B0fZcnECiDrKJsfxka0=
go.etcd.io/etcd v0.0.0-20191023171146-3cf2f69b5738/go.mod h1:dnLIgRNXwCJa5e+c6mIZCrds/GI
---
[Medium] chunk lines 1921-1940 in go.sum:
github.com/go-ldap/ldap/v3 v3.4.4 h1:qPjipEpt+qDa6SI/h1fzuGWoRUY+qqQ9sOZq67/PYUs=
github.com/go-ldap/ldap/v3 v3.4.4/go.mod h1:fe1MsuN5eJJ1FeLT/LEBVdWfNWKh459R7aXgXtJC+aI=
github.com/go-logfmt/logfmt v0.3.0/go.mod h1:Qt1PoO58o5twSAckw1HlFXLmHsOX5/0LbT9GBnD5lWE=
github.com/go-logfmt/logfmt v0.4.0/go.mod h1:3RMwSq7FuexP4Kalkev3ejPJsZTpXXBr9+V4qmtdjCk=
github.com/go-logfmt/logfmt v0.5.0/go.mod h1:wCYkCAKZfumFQihp8CzCvQ3paCTfi41vtzG1KdI/P7A=
github.com/go-logfmt/logfmt v0.5.1/go.mod h1:WYhtIu8zTZfxdn
---
[Medium] chunk lines 2481-2500 in go.sum:
github.com/jarcoal/httpmock v1.3.0/go.mod h1:3yb8rc4BI7TCBhFY8ng0gjuLKJNquuDNiPaZjnENuYg=
github.com/jarcoal/httpmock v1.3.1/go.mod h1:3yb8rc4BI7TCBhFY8ng0gjuLKJNquuDNiPaZjnENuYg=
github.com/jcmturner/aescts/v2 v2.0.0 h1:9YKLH6ey7H4eDBXW8khjYslgyqG2xZikXP0EQFKrle8=
github.com/jcmturner/aescts/v2 v2.0.0/go.mod h1:AiaICIRyfYg35RUkr8yESTqvSy7csK90qZ5xfvvsoNs=
github.com/jcmturner/dnsutils/v2 v2.0.0 h1:lltnkeZGL0wILNvrNiVCR6Ro5PGU/SeBvVO/8c/iPbo=
github.com/jcmturner/dnsutils/v2 v2.0.0/go.mod h1:b0T
---
[Medium] chunk lines 2081-2100 in go.sum:
github.com/golang/protobuf v1.2.0/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.1/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.2/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.3/go.mod h1:vzj43D7+SQXF/4pzW/hwtAqwc6iTitCiVSaWz5lYuqw=
github.com/golang/protobuf v1.3.4/go.mod h1:vzj43D7+SQXF/4pzW/hwtAqwc6iTitCiVSaWz5lYuqw=
github.com/golang/protobuf v1.3.5/go.mod h1:6O5/vntMXwX
---
[Medium] chunk lines 2141-2160 in go.sum:
github.com/google/go-querystring v1.0.0/go.mod h1:odCYkC5MyYFN7vkCjXpyrEuKhc/BUO6wN/zVPAxq5ck=
github.com/google/go-querystring v1.1.0 h1:AnCroh3fv4ZBgVIf1Iwtovgjaw/GiKJo8M8yD/fhyJ8=
github.com/google/go-querystring v1.1.0/go.mod h1:Kcdr2DB4koayq7X8pmAG4sNG59So17icRSOU623lUBU=
github.com/google/gofuzz v1.0.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=
github.com/google/gofuzz v1.1.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=
github.com/google/gofuzz v1.2.0 h1:xRy4A+RhZaiKj
---
[Medium] chunk lines 4001-4020 in go.sum:
gonum.org/v1/gonum v0.15.1 h1:FNy7N6OUZVUaWG9pTiD+jlhdQ3lMP+/LcTpJ6+a8sQ0=
gonum.org/v1/gonum v0.15.1/go.mod h1:eZTZuRFrzu5pcyjN5wJhcIhnUdNijYxX1T2IcrOGY0o=
gonum.org/v1/netlib v0.0.0-20190313105609-8cb42192e0e0/go.mod h1:wa6Ws7BG/ESfp6dHfk7C6KdzKA7wR7u/rKwOGE66zvw=
gonum.org/v1/plot v0.0.0-20190515093506-e2840ee46a6b/go.mod h1:Wt8AAjI+ypCyYX3nZBvf6cAIx93T+c/OS2HFAYskSZc=
gonum.org/v1/plot v0.9.0/go.mod h1:3Pcqqmp6RHvJI72kgb8fThyUnav364FOsdDo2aGW5lY=
gonum.org/v1/plot v0.10.1/go.mod h1:VZW5OlhkL
---
[Medium] chunk lines 4361-4380 in go.sum:
google.golang.org/grpc v1.26.0/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=
google.golang.org/grpc v1.27.0/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=
google.golang.org/grpc v1.27.1/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=
google.golang.org/grpc v1.28.0/go.mod h1:rpkK4SK4GF4Ach/+MFLZUBavHOvF2JJB5uozKKal+60=
google.golang.org/grpc v1.29.1/go.mod h1:itym6AZVZYACWQqET3MqgPpjcuV5QH3BxFS3IjizoKk=
google.golang.org/grpc v1.30.0/go.mod h1:N36X2cJ7JwdamYAgDz+s+rVMFjt3n
---
[Medium] chunk lines 2861-2880 in go.sum:
github.com/opentracing-contrib/go-observer v0.0.0-20170622124052-a52f23424492/go.mod h1:Ngi6UdF0k5OKD5t5wlmGhe/EDKPoUM3BXZSSfIuJbis=
github.com/opentracing-contrib/go-stdlib v1.0.0 h1:TBS7YuVotp8myLon4Pv7BtCBzOTo1DeZCld0Z63mW2w=
github.com/opentracing-contrib/go-stdlib v1.0.0/go.mod h1:qtI1ogk+2JhVPIXVc6q+NHziSmy2W5GbdQZFUHADCBU=
github.com/opentracing/basictracer-go v1.0.0/go.mod h1:QfBfYuafItcjQuMwinw9GhYKwFXS9KnPs5lxoYwgW74=
github.com/opentracing/opentracing-go v1.0.2/go.mod h1:UkNAQd3GIcIGf
---
[Medium] chunk lines 2541-2560 in go.sum:
github.com/julienschmidt/httprouter v1.2.0/go.mod h1:SYymIcj16QtmaHHD7aYtjjsJG7VTCxuUUipMqKk8s4w=
github.com/julienschmidt/httprouter v1.3.0/go.mod h1:JR6WtHb+2LUe8TCKY3cZOxFyyO8IZAc4RVcycCCAKdM=
github.com/jung-kurt/gofpdf v1.0.0/go.mod h1:7Id9E/uU8ce6rXgefFLlgrJj/GYY22cpxn+r32jIOes=
github.com/jung-kurt/gofpdf v1.0.3-0.20190309125859-24315acbbda5/go.mod h1:7Id9E/uU8ce6rXgefFLlgrJj/GYY22cpxn+r32jIOes=
github.com/kardianos/osext v0.0.0-20190222173326-2bc1f35cddc0/go.mod h1:1NbS8ALrpOvjt0rHPNLyCI
---
[Medium] chunk lines 2641-2660 in go.sum:
github.com/mattn/go-isatty v0.0.8/go.mod h1:Iq45c/XA43vh69/j3iqttzPXn0bhXyGjM0Hdxcsrc5s=
github.com/mattn/go-isatty v0.0.10/go.mod h1:qgIWMr58cqv1PHHyhnkY9lrL7etaEgOFcMEpPG5Rm84=
github.com/mattn/go-isatty v0.0.11/go.mod h1:PhnuNfih5lzO57/f3n+odYbM4JtupLOxQOAqxQCu2WE=
github.com/mattn/go-isatty v0.0.12/go.mod h1:cbi8OIDigv2wuxKPP5vlRcQ1OAZbq2CE4Kysco4FUpU=
github.com/mattn/go-isatty v0.0.14/go.mod h1:7GGIvUiUoEMVVmxf/4nioHXj79iQHKdU27kJ6hsGG94=
github.com/mattn/go-isatty v0.0.16/go.mod h1:kYGgaQ
---
[Medium] chunk lines 2901-2920 in go.sum:
github.com/pierrec/lz4 v1.0.2-0.20190131084431-473cd7ce01a1/go.mod h1:3/3N9NVKO0jef7pBehbT1qWhCMrIgbYNnFAZCqQ5LRc=
github.com/pierrec/lz4 v2.0.5+incompatible/go.mod h1:pdkljMzZIN41W+lC3N2tnIh5sFi+IEE17M5jbnwPHcY=
github.com/pierrec/lz4/v4 v4.1.15/go.mod h1:gZWDp/Ze/IJXGXf23ltt2EXimqmTUXEy0GFuRQyBid4=
github.com/pierrec/lz4/v4 v4.1.18/go.mod h1:gZWDp/Ze/IJXGXf23ltt2EXimqmTUXEy0GFuRQyBid4=
github.com/pierrec/lz4/v4 v4.1.21 h1:yOVMLb6qSIDP67pl/5F7RepeKYu/VmTyEXvuMI5d9mQ=
github.com/pierrec/lz4/v4 v
---
[Medium] chunk lines 2921-2940 in go.sum:
github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=
github.com/pmezard/go-difflib v1.0.1-0.20181226105442-5d4384ee4fb2 h1:Jamvg5psRIccs7FGNTlIRMkT8wgtp5eCXdBlqhYGL6U=
github.com/pmezard/go-difflib v1.0.1-0.20181226105442-5d4384ee4fb2/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=
github.com/posener/complete v1.1.1/go.mod h1:em0nMJCgc9GFtwrmVmEMR/ZL6WyhyjMBndrE9hABlRI=
github.com/posener/complete v1.2.3/go.mod h1:WZIdtGGp+qx0sLrYKtIRAruyNpv6hFCicSgv
---
[Medium] chunk lines 2441-2460 in go.sum:
github.com/huandu/xstrings v1.3.3 h1:/Gcsuc1x8JVbJ9/rlye4xZnVAbEkGauT8lbebqcQws4=
github.com/huandu/xstrings v1.3.3/go.mod h1:y5/lhBue+AyNmUVz9RLU9xbLR0o4KIIExikq4ovT0aE=
github.com/hudl/fargo v1.3.0/go.mod h1:y3CKSmjA+wD2gak7sUSXTAoopbhU08POFhmITJgmKTg=
github.com/hudl/fargo v1.4.0/go.mod h1:9Ai6uvFy5fQNq6VPKtg+Ceq1+eTY4nKUlR2JElEOcDo=
github.com/iancoleman/strcase v0.2.0/go.mod h1:iwCmte+B7n89clKwxIoIXy/HfoL7AsD47ZCWhYzw7ho=
github.com/iancoleman/strcase v0.3.0/go.mod h1:iwCmte+B7n89clKwxIoIXy
---
[Medium] chunk lines 3381-3400 in go.sum:
go.uber.org/zap v1.10.0/go.mod h1:vwi/ZaCAaUcBkycHslxD9B2zi4UTXhF60s6SWpuDF0Q=
go.uber.org/zap v1.13.0/go.mod h1:zwrFLgMcdUuIBviXEYEH1YKNaOBnKXsx2IPda5bBwHM=
go.uber.org/zap v1.17.0/go.mod h1:MXVU+bhUf/A7Xi2HNOnopQOrmycQ5Ih87HtOu4q5SSo=
go.uber.org/zap v1.18.1/go.mod h1:xg/QME4nWcxGxrpdeYfq7UvYrLh66cuVKdrbD1XF/NI=
go.uber.org/zap v1.19.1/go.mod h1:j3DNczoxDZroyBnOT1L/Q79cfUMGZxlv/9dzN7SM1rI=
go.uber.org/zap v1.27.0 h1:aJMhYGrd5QSmlpLMr2MftRKl7t8J8PTZPA732ud/XR8=
go.uber.org/zap v1.27.0/go.mod h1
---
[Medium] chunk lines 3181-3200 in go.sum:
github.com/unknwon/com v1.0.1/go.mod h1:tOOxU81rwgoCLoOVVPHb6T/wt8HZygqH5id+GNnlCXM=
github.com/unknwon/log v0.0.0-20150304194804-e617c87089d3/go.mod h1:1xEUf2abjfP92w2GZTV+GgaRxXErwRXcClbUwrNJffU=
github.com/unknwon/log v0.0.0-20200308114134-929b1006e34a h1:vcrhXnj9g9PIE+cmZgaPSwOyJ8MAQTRmsgGrB0x5rF4=
github.com/unknwon/log v0.0.0-20200308114134-929b1006e34a/go.mod h1:1xEUf2abjfP92w2GZTV+GgaRxXErwRXcClbUwrNJffU=
github.com/urfave/cli v1.20.0/go.mod h1:70zkFmudgCuE/ngEzBv17Jvp/497gISqfk5gWijbERA
---
[Medium] chunk lines 2961-2980 in go.sum:
github.com/prometheus/common v0.2.0/go.mod h1:TNfzLD0ON7rHzMJeJkieUDPYmFC7Snx/y86RQel1bk4=
github.com/prometheus/common v0.4.1/go.mod h1:TNfzLD0ON7rHzMJeJkieUDPYmFC7Snx/y86RQel1bk4=
github.com/prometheus/common v0.7.0/go.mod h1:DjGbpBbp5NYNiECxcL/VnbXCCaQpKd3tt26CguLLsqA=
github.com/prometheus/common v0.9.1/go.mod h1:yhUN8i9wzaXS3w1O07YhxHEBxD+W35wd8bs7vj7HSQ4=
github.com/prometheus/common v0.10.0/go.mod h1:Tlit/dnDKsSWFlCLTWaA1cyBgKHSMdTB80sz/V91rCo=
github.com/prometheus/common v0.18.0/go.mod 
---
[Medium] chunk lines 3281-3300 in go.sum:
go.opencensus.io v0.22.5/go.mod h1:5pWMHQbX5EPX2/62yrJeAkowc+lfs/XD7Uxpq3pI6kk=
go.opencensus.io v0.23.0/go.mod h1:XItmlyltB5F7CS4xOC1DcqMoFqwtC6OG2xF7mCv7P7E=
go.opencensus.io v0.24.0 h1:y73uSU6J157QMP2kn2r30vwW1A2W2WFwSCGnAVxeaD0=
go.opencensus.io v0.24.0/go.mod h1:vNK8G9p7aAivkbmorf4v+7Hgx+Zs0yY+0fOtgBfjQKo=
go.opentelemetry.io/collector/featuregate v1.5.0/go.mod h1:w7nUODKxEi3FLf1HslCiE6YWtMtOOrMnSwsDam8Mg9w=
go.opentelemetry.io/collector/pdata v1.5.0/go.mod h1:TYj8aKRWZyT/KuKQXKyqSEvK/GV+sl
---
[Medium] chunk lines 3941-3960 in go.sum:
golang.org/x/tools v0.0.0-20200729194436-6467de6f59a7/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=
golang.org/x/tools v0.0.0-20200804011535-6c149bb5ef0d/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=
golang.org/x/tools v0.0.0-20200825202427-b303f430e36d/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=
golang.org/x/tools v0.0.0-20200904185747-39188db58858/go.mod h1:Cj7w3i3Rnn0Xh82ur9kSqwfTHTeVxaDqrfMjpcNT6bE=
golang.org/x/tools v0.0.0-20201110124207-079ba7bd75cd/go.mod h1:
---
[Medium] chunk lines 3561-3580 in go.sum:
golang.org/x/net v0.0.0-20201021035429-f5854403a974/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=
golang.org/x/net v0.0.0-20201031054903-ff519b6c9102/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=
golang.org/x/net v0.0.0-20201110031124-69a78807bb2b/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=
golang.org/x/net v0.0.0-20201209123823-ac852fbbde11/go.mod h1:m0MpNAwzfU5UDzcl9v0D8zg8gWTRqZa9RBIspLL5mdg=
golang.org/x/net v0.0.0-20201224014010-6772e930b67b/go.mod h1:m0MpNAwzfU
---
[Medium] chunk lines 2401-2420 in go.sum:
github.com/hashicorp/go.net v0.0.1/go.mod h1:hjKkEWcCURg++eb33jQU7oqQcI9XDCnUzHA0oac0k90=
github.com/hashicorp/golang-lru v0.5.0/go.mod h1:/m3WP610KZHVQ1SGc6re/UDhFvYD7pJ4Ao+sR/qLZy8=
github.com/hashicorp/golang-lru v0.5.1/go.mod h1:/m3WP610KZHVQ1SGc6re/UDhFvYD7pJ4Ao+sR/qLZy8=
github.com/hashicorp/golang-lru v0.5.4/go.mod h1:iADmTwqILo4mZ8BN3D2Q6+9jd8WM5uGBxy+E8yxSoD4=
github.com/hashicorp/golang-lru v0.6.0/go.mod h1:iADmTwqILo4mZ8BN3D2Q6+9jd8WM5uGBxy+E8yxSoD4=
github.com/hashicorp/golang-lru v1
---
[Medium] chunk lines 2781-2800 in go.sum:
github.com/nsf/jsondiff v0.0.0-20230430225905-43f6cf3098c1/go.mod h1:mpRZBD8SJ55OIICQ3iWH0Yz3cjzA61JdqMLoWXeB2+8=
github.com/nxadm/tail v1.4.4/go.mod h1:kenIhsEOeOJmVchQTgglprH7qJGnHDVpk1VPCcaMI8A=
github.com/nxadm/tail v1.4.8 h1:nPr65rt6Y5JFSKQO7qToXr7pePgD6Gwiw05lkbyAQTE=
github.com/nxadm/tail v1.4.8/go.mod h1:+ncqLTQzXmGhMZNUePPaPqPvBxHAIsmXswZKocGu+AU=
github.com/oapi-codegen/oapi-codegen/v2 v2.3.0 h1:rICjNsHbPP1LttefanBPnwsSwl09SqhCO7Ee623qR84=
github.com/oapi-codegen/oapi-codegen/v2 v2.3.0
---
[Medium] chunk lines 4121-4140 in go.sum:
google.golang.org/genproto v0.0.0-20200331122359-1ee6d9798940/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=
google.golang.org/genproto v0.0.0-20200423170343-7949de9c1215/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=
google.golang.org/genproto v0.0.0-20200430143042-b979b6f78d84/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=
google.golang.org/genproto v0.0.0-20200511104702-f5ebc3bea380/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 1501-1520 in go.sum:
github.com/antlr4-go/antlr/v4 v4.13.1 h1:SqQKkuVZ+zWkMMNkjy5FZe5mr5WURWnlpmOuzYWrPrQ=
github.com/antlr4-go/antlr/v4 v4.13.1/go.mod h1:GKmUxMtwp6ZgGwZSva4eWPC5mS6vUAmOABFgjdkM7Nw=
github.com/apache/arrow/go/arrow v0.0.0-20210223225224-5bea62493d91/go.mod h1:c9sxoIT3YgLxH4UhLOCKaBlEojuMhVYpk4Ntv3opUTQ=
github.com/apache/arrow/go/v10 v10.0.1/go.mod h1:YvhnlEePVnBS4+0z3fhPfUy7W1Ikj0Ih0vcRo/gZ1M0=
github.com/apache/arrow/go/v11 v11.0.0/go.mod h1:Eg5OsL5H+e299f7u5ssuXsuHQVEGC4xei5aX110hRiI=
github.com
---
[Medium] chunk lines 3541-3560 in go.sum:
golang.org/x/net v0.0.0-20190813141303-74dc4d7220e7/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20190923162816-aa69164e4478/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20191112182307-2180aed22343/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20191209160850-c0dbc17a3553/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20200114155413-6afb5195e5aa/go.mod h1:z5CRVTTTmA
---
[Medium] chunk lines 4041-4060 in go.sum:
google.golang.org/api v0.67.0/go.mod h1:ShHKP8E60yPsKNw/w8w+VYaj9H6buA5UqDp8dhbQZ6g=
google.golang.org/api v0.70.0/go.mod h1:Bs4ZM2HGifEvXwd50TtW70ovgJffJYw2oRCOFU/SkfA=
google.golang.org/api v0.71.0/go.mod h1:4PyU6e6JogV1f9eA4voyrTY2batOLdgZ5qZ5HOCc4j8=
google.golang.org/api v0.74.0/go.mod h1:ZpfMZOVRMywNyvJFeqL9HRWBgAuRfSjJFpe9QtRRyDs=
google.golang.org/api v0.75.0/go.mod h1:pU9QmyHLnzlpar1Mjt4IbapUCy8J+6HD6GeELN69ljA=
google.golang.org/api v0.77.0/go.mod h1:pU9QmyHLnzlpar1Mjt4IbapUCy8J+6HD6Ge
---
[Medium] chunk lines 1721-1740 in go.sum:
github.com/cockroachdb/datadriven v0.0.0-20190809214429-80d97fb3cbaa/go.mod h1:zn76sxSg3SzpJ0PPJaLDCu+Bu0Lg3sKTORVIj19EIF8=
github.com/codahale/hdrhistogram v0.0.0-20161010025455-3a0bb77429bd/go.mod h1:sE/e/2PUdi/liOCUjSTXgM1o87ZssimdTWN964YiIeI=
github.com/containerd/cgroups/v3 v3.0.1/go.mod h1:/vtwk1VXrtoa5AaZLkypuOJgA/6DyPMZHJPGQNtlHnw=
github.com/containerd/cgroups/v3 v3.0.3/go.mod h1:8HBe7V3aWGLFPd/k03swSIsGjZhHI2WzJmticMgVuz0=
github.com/containerd/containerd v1.2.7/go.mod h1:bC6axHOhabU15
---
[Medium] chunk lines 2501-2520 in go.sum:
github.com/jhump/gopoet v0.1.0/go.mod h1:me9yfT6IJSlOL3FCfrg+L6yzUEZ+5jW6WHt4Sk+UPUI=
github.com/jhump/goprotoc v0.5.0/go.mod h1:VrbvcYrQOrTi3i0Vf+m+oqQWk9l72mjkJCYo7UvLHRQ=
github.com/jhump/protoreflect v1.6.0/go.mod h1:eaTn3RZAmMBcV0fifFvlm6VHNz3wSkYyXYWUh7ymB74=
github.com/jhump/protoreflect v1.11.0/go.mod h1:U7aMIjN0NWq9swDP7xDdoMfRHb35uiuTd3Z9nFXJf5E=
github.com/jhump/protoreflect v1.15.1 h1:HUMERORf3I3ZdX05WaQ6MIpd/NJ434hTp5YiKgfCL6c=
github.com/jhump/protoreflect v1.15.1/go.mod h1:jD/2GMK
---
[Medium] chunk lines 3061-3080 in go.sum:
github.com/shadowspore/fossil-delta v0.0.0-20240102155221-e3a8590b820b h1:SCYeryKXBVdW38167VyumGakH+7E4Wxe6b/zxmQxwyM=
github.com/shadowspore/fossil-delta v0.0.0-20240102155221-e3a8590b820b/go.mod h1:daNLfX/GJKuZyN4HkMf0h8dVmTmgRbBSkd9bFQyGNIo=
github.com/shoenig/test v1.7.1/go.mod h1:UxJ6u/x2v/TNs/LoLxBNJRV9DiwBBKYxXSyczsBHFoI=
github.com/shopspring/decimal v0.0.0-20180709203117-cd690d0c9e24/go.mod h1:M+9NzErvs504Cn4c5DxATwIqPbtswREoFCre64PpcG4=
github.com/shopspring/decimal v1.2.0/go.mod h1:DK
---
[Medium] chunk lines 4381-4400 in go.sum:
google.golang.org/grpc v1.40.0/go.mod h1:ogyxbiOoUXAkP+4+xa6PZSE9DZgIHtSpzjDTB9KAK34=
google.golang.org/grpc v1.40.1/go.mod h1:ogyxbiOoUXAkP+4+xa6PZSE9DZgIHtSpzjDTB9KAK34=
google.golang.org/grpc v1.42.0/go.mod h1:k+4IHHFw41K8+bbowsex27ge2rCb65oeWqe4jJ590SU=
google.golang.org/grpc v1.44.0/go.mod h1:k+4IHHFw41K8+bbowsex27ge2rCb65oeWqe4jJ590SU=
google.golang.org/grpc v1.45.0/go.mod h1:lN7owxKUQEqMfSyQikvvk5tf/6zMPsrK+ONuO11+0rQ=
google.golang.org/grpc v1.46.0/go.mod h1:vN9eftEi1UMyUsIF80+uQXhHjbXYb
---
[Medium] chunk lines 1981-2000 in go.sum:
github.com/go-openapi/swag v0.22.9/go.mod h1:3/OXnFfnMAwBD099SwYRk7GD3xOrr1iL7d/XNLXVVwE=
github.com/go-openapi/swag v0.23.0 h1:vsEVJDUo2hPJ2tu0/Xc+4noaxyEffXNIs3cOULZ+GrE=
github.com/go-openapi/swag v0.23.0/go.mod h1:esZ8ITTYEsH1V2trKHjAN8Ai7xHb8RV+YSZ577vPjgQ=
github.com/go-openapi/validate v0.22.4/go.mod h1:qm6O8ZIcPVdSY5219468Jv7kBdGvkiZLPOmqnqTUZ2A=
github.com/go-openapi/validate v0.23.0/go.mod h1:EeiAZ5bmpSIOJV1WLfyYF9qp/B1ZgSaEpHTJHtN5cbE=
github.com/go-openapi/validate v0.24.0 h1:LdfDKwN
---
[Medium] chunk lines 2201-2220 in go.sum:
github.com/googleapis/enterprise-certificate-proxy v0.2.4/go.mod h1:AwSRAtLfXpU5Nm3pW+v7rGDHp09LsPtGY9MduiEsR9k=
github.com/googleapis/enterprise-certificate-proxy v0.2.5/go.mod h1:RxW0N9901Cko1VOCW3SXCpWP+mlIEkk2tP7jnHy9a3w=
github.com/googleapis/enterprise-certificate-proxy v0.3.2 h1:Vie5ybvEvT75RniqhfFxPRy3Bf7vr3h0cechB90XaQs=
github.com/googleapis/enterprise-certificate-proxy v0.3.2/go.mod h1:VLSiSSBs/ksPL8kq3OBOQ6WRI2QnaFynd1DCjZ62+V0=
github.com/googleapis/gax-go/v2 v2.0.4/go.mod h1:0Wqv26
---
[Medium] chunk lines 1581-1600 in go.sum:
github.com/aws/aws-sdk-go-v2/service/ssooidc v1.26.4 h1:yiwVzJW2ZxZTurVbYWA7QOrAaCYQR72t0wrSBfoesUE=
github.com/aws/aws-sdk-go-v2/service/ssooidc v1.26.4/go.mod h1:0oxfLkpz3rQ/CHlx5hB7H69YUpFiI1tql6Q6Ne+1bCw=
github.com/aws/aws-sdk-go-v2/service/sts v1.30.3 h1:ZsDKRLXGWHk8WdtyYMoGNO7bTudrvuKpDKgMVRlepGE=
github.com/aws/aws-sdk-go-v2/service/sts v1.30.3/go.mod h1:zwySh8fpFyXp9yOr/KVzxOl8SRqgf/IDw5aUt9UKFcQ=
github.com/aws/smithy-go v1.8.0/go.mod h1:SObp3lf9smib00L/v3U2eAKG8FyQ7iLrJnQiAmR5n+E=
git
---
[Medium] chunk lines 4601-4620 in go.sum:
modernc.org/sqlite v1.18.2/go.mod h1:kvrTLEWgxUcHa2GfHBQtanR1H9ht3hTJNtKpzH9k1u0=
modernc.org/sqlite v1.21.2/go.mod h1:cxbLkB5WS32DnQqeH4h4o1B0eMr8W/y8/RGuxQ3JsC0=
modernc.org/sqlite v1.33.1 h1:trb6Z3YYoeM9eDL1O8do81kP+0ejv+YzgyFo+Gwy0nM=
modernc.org/sqlite v1.33.1/go.mod h1:pXV2xHxhzXZsgT/RtTFAPY6JJDEvOTcTdwADQCCWD4k=
modernc.org/strutil v1.1.1/go.mod h1:DE+MQQ/hjKBZS2zNInV5hhcipt5rLPWkmpbGeW5mmdw=
modernc.org/strutil v1.1.3/go.mod h1:MEHNA7PdEnEwLvspRMtWTNnp2nnyvMfkimT1NKNAGbw=
modernc.org/str
---
[Medium] chunk lines 2361-2380 in go.sum:
github.com/hashicorp/go-hclog v0.16.2/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=
github.com/hashicorp/go-hclog v1.2.0/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=
github.com/hashicorp/go-hclog v1.5.0/go.mod h1:W4Qnvbt70Wk/zYJryRzDRU/4r0kIg0PVHBcfoyhpF5M=
github.com/hashicorp/go-hclog v1.6.3 h1:Qr2kF+eVWjTiYmU7Y31tYlP1h0q/X3Nl3tPGdaB11/k=
github.com/hashicorp/go-hclog v1.6.3/go.mod h1:W4Qnvbt70Wk/zYJryRzDRU/4r0kIg0PVHBcfoyhpF5M=
github.com/hashicorp/go-immutable-radix v1.0.0
---
[Medium] chunk lines 1641-1660 in go.sum:
github.com/bufbuild/connect-go v1.10.0 h1:QAJ3G9A1OYQW2Jbk3DeoJbkCxuKArrvZgDt47mjdTbg=
github.com/bufbuild/connect-go v1.10.0/go.mod h1:CAIePUgkDR5pAFaylSMtNK45ANQjp9JvpluG20rhpV8=
github.com/bufbuild/protocompile v0.4.0 h1:LbFKd2XowZvQ/kajzguUp2DC9UEIQhIq77fZZlaQsNA=
github.com/bufbuild/protocompile v0.4.0/go.mod h1:3v93+mbWn/v3xzN+31nwkJfrEpAUwp+BagBSZWx+TP8=
github.com/buger/jsonparser v1.1.1 h1:2PnMjfWD7wBILjqQbt530v576A/cAbQvEW9gGIpYMUs=
github.com/buger/jsonparser v1.1.1/go.mod h1:6RYKKt7H
---
[Medium] chunk lines 3121-3140 in go.sum:
github.com/spf13/viper v1.19.0 h1:RWq5SEjt8o25SROyN3z2OrDB9l7RPd3lwTWU8EcEdcI=
github.com/spf13/viper v1.19.0/go.mod h1:GQUN9bilAbhU/jgc1bKs99f/suXKeUMct8Adx5+Ntkg=
github.com/spkg/bom v0.0.0-20160624110644-59b7046e48ad/go.mod h1:qLr4V1qq6nMqFKkMo8ZTx3f+BZEkzsRUY10Xsm2mwU0=
github.com/spyzhov/ajson v0.9.0 h1:tF46gJGOenYVj+k9K1U1XpCxVWhmiyY5PsVCAs1+OJ0=
github.com/spyzhov/ajson v0.9.0/go.mod h1:a6oSw0MMb7Z5aD2tPoPO+jq11ETKgXUr2XktHdT8Wt8=
github.com/stoewer/go-strcase v1.3.0 h1:g0eASXYtp+yvN9fK8s
---
[Medium] chunk lines 2161-2180 in go.sum:
github.com/google/pprof v0.0.0-20200430221834-fc25d7d30c6d/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=
github.com/google/pprof v0.0.0-20200708004538-1a94d8640e99/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=
github.com/google/pprof v0.0.0-20201023163331-3e6fc7fc9c4c/go.mod h1:kpwsk12EmLew5upagYY7GY0pfYCcupk39gWOCRROcvE=
github.com/google/pprof v0.0.0-20201203190320-1bf35d6f28c2/go.mod h1:kpwsk12EmLew5upagYY7GY0pfYCcupk39gWOCRROcvE=
github.com/google/pprof v0.0.0-2020121800293
---
[Medium] chunk lines 2581-2600 in go.sum:
github.com/kr/text v0.2.0 h1:5Nx0Ya0ZqY2ygV366QzturHI13Jq95ApcVaJBhpS+AY=
github.com/kr/text v0.2.0/go.mod h1:eLer722TekiGuMkidMxC/pM04lWEeraHUUmBw8l2grE=
github.com/kshvakov/clickhouse v1.3.5/go.mod h1:DMzX7FxRymoNkVgizH0DWAL8Cur7wHLgx3MUnGwJqpE=
github.com/kylelemons/godebug v1.1.0 h1:RPNrshWIDI6G2gRW9EHilWtl7Z6Sb1BR0xunSBf0SNc=
github.com/kylelemons/godebug v1.1.0/go.mod h1:9/0rRGxNHcop5bhtWyNeEfOS8JIWk580+fNqagV/RAw=
github.com/lann/builder v0.0.0-20180802200727-47ae307949d0 h1:SOEGU9fKiNWd/
---
[Medium] chunk lines 4521-4540 in go.sum:
k8s.io/klog/v2 v2.130.1 h1:n9Xl7H1Xvksem4KFG4PYbdQCQxqc/tTUyrgXaOhHSzk=
k8s.io/klog/v2 v2.130.1/go.mod h1:3Jpz1GvMt720eyJH1ckRHK1EDfpxISzJ7I9OYgaDtPE=
k8s.io/kms v0.31.1 h1:cGLyV3cIwb0ovpP/jtyIe2mEuQ/MkbhmeBF2IYCA9Io=
k8s.io/kms v0.31.1/go.mod h1:OZKwl1fan3n3N5FFxnW5C4V3ygrah/3YXeJWS3O6+94=
k8s.io/kube-aggregator v0.31.1 h1:vrYBTTs3xMrpiEsmBjsLETZE9uuX67oQ8B3i1BFfMPw=
k8s.io/kube-aggregator v0.31.1/go.mod h1:+aW4NX50uneozN+BtoCxI4g7ND922p8Wy3tWKFDiWVk=
k8s.io/kube-openapi v0.0.0-20231010175941-2
---
[Medium] chunk lines 2321-2340 in go.sum:
github.com/grpc-ecosystem/go-grpc-middleware v1.3.0/go.mod h1:z0ButlSOZa5vEBq9m2m2hlwIgKw+rp3sdCBRoJY+30Y=
github.com/grpc-ecosystem/go-grpc-middleware v1.4.0 h1:UH//fgunKIs4JdUbpDl1VZCDaL56wXCB/5+wF6uHfaI=
github.com/grpc-ecosystem/go-grpc-middleware v1.4.0/go.mod h1:g5qyo/la0ALbONm6Vbp88Yd8NsDy6rZz+RcrMPxvld8=
github.com/grpc-ecosystem/go-grpc-middleware/providers/prometheus v1.0.1 h1:qnpSQwGEnkcRpTqNOIR6bJbR0gAorgP9CSALpRcKoAA=
github.com/grpc-ecosystem/go-grpc-middleware/providers/prometheus
---
[Medium] chunk lines 3001-3020 in go.sum:
github.com/protocolbuffers/txtpbfmt v0.0.0-20230328191034-3462fbc510c0 h1:sadMIsgmHpEOGbUs6VtHBXRR1OHevnj7hLx9ZcdNGW4=
github.com/protocolbuffers/txtpbfmt v0.0.0-20230328191034-3462fbc510c0/go.mod h1:jgxiZysxFPM+iWKwQwPR+y+Jvo54ARd4EisXxKYpB5c=
github.com/rcrowley/go-metrics v0.0.0-20181016184325-3113b8401b8a/go.mod h1:bCqnVzQkZxMG4s8nGwiZ5l3QUCyqpo9Y+/ZMZ9VjZe4=
github.com/redis/go-redis/v9 v9.1.0 h1:137FnGdk+EQdCbye1FW+qOEcY5S+SpY9T0NiuqvtfMY=
github.com/redis/go-redis/v9 v9.1.0/go.mod h1:urWj
---
[Medium] chunk lines 4541-4560 in go.sum:
modernc.org/cc/v3 v3.38.1/go.mod h1:vtL+3mdHx/wcj3iEGz84rQa8vEqR6XM84v5Lcvfph20=
modernc.org/cc/v3 v3.40.0/go.mod h1:/bTg4dnWkSXowUO6ssQKnOV0yMVxDYNIsIrzqTFDGH0=
modernc.org/cc/v4 v4.21.4 h1:3Be/Rdo1fpr8GrQ7IVw9OHtplU4gWbb+wNgeoBMmGLQ=
modernc.org/cc/v4 v4.21.4/go.mod h1:HM7VJTZbUCR3rV8EYBi9wxnJ0ZBRiGE5OeGXNA0IsLQ=
modernc.org/ccgo/v3 v3.0.0-20220428102840-41399a37e894/go.mod h1:eI31LL8EwEBKPpNpA4bU1/i+sKOwOrQy8D87zWUcRZc=
modernc.org/ccgo/v3 v3.0.0-20220430103911-bc99d88307be/go.mod h1:bwdAnOoa
---
[Medium] chunk lines 3081-3100 in go.sum:
github.com/sirupsen/logrus v1.9.3/go.mod h1:naHLuLoDiP4jHNo9R0sCBMtWGeIprob74mVsIT4qYEQ=
github.com/smartystreets/assertions v0.0.0-20180927180507-b2de0cb4f26d/go.mod h1:OnSkiWE9lh6wB0YB77sQom3nweQdgAjqCqsofrRNTgc=
github.com/smartystreets/assertions v0.0.0-20190116191733-b6c0e53d7304 h1:Jpy1PXuP99tXNrhbq2BaPz9B+jNAvH1JPQQpG/9GCXY=
github.com/smartystreets/assertions v0.0.0-20190116191733-b6c0e53d7304/go.mod h1:OnSkiWE9lh6wB0YB77sQom3nweQdgAjqCqsofrRNTgc=
github.com/smartystreets/goconvey v0.0.0
---
[Medium] chunk lines 2381-2400 in go.sum:
github.com/hashicorp/go-retryablehttp v0.7.4/go.mod h1:Jy/gPYAdjqffZ/yFGCFV2doI5wjtH1ewM9u8iYVjtX8=
github.com/hashicorp/go-retryablehttp v0.7.7 h1:C8hUCYzor8PIfXHa4UrZkU4VvK8o9ISHxT2Q8+VepXU=
github.com/hashicorp/go-retryablehttp v0.7.7/go.mod h1:pkQpWZeYWskR+D1tR2O5OcBFOxfA7DoAO6xtkuQnHTk=
github.com/hashicorp/go-rootcerts v1.0.0/go.mod h1:K6zTfqpRlCUIjkwsN4Z+hiSfzSTQa6eBIzfwKfwNnHU=
github.com/hashicorp/go-rootcerts v1.0.2 h1:jzhAVGtqPKbwpyCPELlgNWhE1znq+qwJtW5Oi2viEzc=
github.com/hashicorp/g
---
[Medium] chunk lines 2041-2060 in go.sum:
github.com/gogo/protobuf v1.3.2/go.mod h1:P1XiOD3dCwIKUDQYPy72D8LYyHL2YPYrpS2s69NZV8Q=
github.com/gogo/status v1.1.1 h1:DuHXlSFHNKqTQ+/ACf5Vs6r4X/dH2EgIzR9Vr+H65kg=
github.com/gogo/status v1.1.1/go.mod h1:jpG3dM5QPcqu19Hg8lkUhBFBa3TcLs1DG7+2Jqci7oU=
github.com/golang-jwt/jwt v3.2.1+incompatible/go.mod h1:8pz2t5EyA70fFQQSrl6XZXzqecmYZeUEB8OUGHkxJ+I=
github.com/golang-jwt/jwt/v4 v4.0.0/go.mod h1:/xlHOz8bRuivTWchD4jCa+NbatV+wEUSzwAxVc6locg=
github.com/golang-jwt/jwt/v4 v4.2.0/go.mod h1:/xlHOz8bRuiv
---
[Medium] chunk lines 2601-2620 in go.sum:
github.com/linkedin/goavro/v2 v2.10.0/go.mod h1:UgQUb2N/pmueQYH9bfqFioWxzYCZXSfF8Jw03O5sjqA=
github.com/linode/linodego v1.32.0 h1:OmZzB3iON6uu84VtLFf64uKmAQqJJarvmsVguroioPI=
github.com/linode/linodego v1.32.0/go.mod h1:y8GDP9uLVH4jTB9qyrgw79qfKdYJmNCGUOJmfuiOcmI=
github.com/lyft/protoc-gen-star v0.6.0/go.mod h1:TGAoBVkt8w7MPG72TrKIu85MIdXwDuzJYeZuUPFPNwA=
github.com/lyft/protoc-gen-star v0.6.1/go.mod h1:TGAoBVkt8w7MPG72TrKIu85MIdXwDuzJYeZuUPFPNwA=
github.com/lyft/protoc-gen-star/v2 v2.0.1/go.m
---
[Medium] chunk lines 4321-4340 in go.sum:
google.golang.org/genproto/googleapis/rpc v0.0.0-20230920183334-c177e329c48b/go.mod h1:+Bk1OCOj40wS2hwAMA+aCW9ypzm63QTBBHp6lQ3p+9M=
google.golang.org/genproto/googleapis/rpc v0.0.0-20230920204549-e6e6cdab5c13/go.mod h1:KSqppvjFjtoCI+KGd4PELB0qLNxdJHRGqRI09mB6pQA=
google.golang.org/genproto/googleapis/rpc v0.0.0-20231002182017-d307bd883b97/go.mod h1:v7nGkzlmW8P3n/bKmWBn2WpBjpOEx8Q6gMueudAmKfY=
google.golang.org/genproto/googleapis/rpc v0.0.0-20231012201019-e917dd12ba7a/go.mod h1:4cYg8o5yUbm77w8ZX
---
[Medium] chunk lines 2561-2580 in go.sum:
github.com/klauspost/cpuid/v2 v2.0.9/go.mod h1:FInQzS24/EEf25PyTYn52gqo7WaD8xa0213Md/qVLRg=
github.com/klauspost/cpuid/v2 v2.2.3/go.mod h1:RVVoqg1df56z8g3pUjL/3lE5UfnlrJX8tyFgg4nqhuY=
github.com/klauspost/cpuid/v2 v2.2.5/go.mod h1:Lcz8mBdAVJIBVzewtcLocK12l3Y+JytZYpaMropDUws=
github.com/klauspost/cpuid/v2 v2.2.8 h1:+StwCXwm9PdpiEkPyzBXIy+M9KUb4ODm0Zarf1kS5BM=
github.com/klauspost/cpuid/v2 v2.2.8/go.mod h1:Lcz8mBdAVJIBVzewtcLocK12l3Y+JytZYpaMropDUws=
github.com/kolo/xmlrpc v0.0.0-20220921171641-a4
---
[Medium] chunk lines 4241-4260 in go.sum:
google.golang.org/genproto v0.0.0-20230526161137-0005af68ea54/go.mod h1:zqTuNwFlFRsw5zIts5VnzLQxSRqh+CGOTVMlYbY0Eyk=
google.golang.org/genproto v0.0.0-20230526203410-71b5a4ffd15e/go.mod h1:zqTuNwFlFRsw5zIts5VnzLQxSRqh+CGOTVMlYbY0Eyk=
google.golang.org/genproto v0.0.0-20230530153820-e85fd2cbaebc/go.mod h1:xZnkP7mREFX5MORlOPEzLMr+90PPZQ2QWzrVTWfAq64=
google.golang.org/genproto v0.0.0-20230629202037-9506855d4529/go.mod h1:xZnkP7mREFX5MORlOPEzLMr+90PPZQ2QWzrVTWfAq64=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 3421-3440 in go.sum:
golang.org/x/crypto v0.3.0/go.mod h1:hebNnKkNXi2UzZN1eVRvBB7co0a+JxK6XbPiWVs/3J4=
golang.org/x/crypto v0.3.1-0.20221117191849-2c476679df9a/go.mod h1:hebNnKkNXi2UzZN1eVRvBB7co0a+JxK6XbPiWVs/3J4=
golang.org/x/crypto v0.6.0/go.mod h1:OFC/31mSvZgRz0V1QTNCzfAI1aIRzbiufJtkMIlEp58=
golang.org/x/crypto v0.7.0/go.mod h1:pYwdfH91IfpZVANVyUOhSIPZaFoJGxTFbZhFTx+dXZU=
golang.org/x/crypto v0.9.0/go.mod h1:yrmDGqONDYtNj3tH8X9dzUun2m2lzPa9ngI6/RUPGR0=
golang.org/x/crypto v0.10.0/go.mod h1:o4eNf7Ede1fv+hwOwZsTHl
---
[Medium] chunk lines 3681-3700 in go.sum:
golang.org/x/sync v0.3.0/go.mod h1:FU7BRWz2tNW+3quACPkgCx/L+uEAv1htQ0V83Z9Rj+Y=
golang.org/x/sync v0.4.0/go.mod h1:FU7BRWz2tNW+3quACPkgCx/L+uEAv1htQ0V83Z9Rj+Y=
golang.org/x/sync v0.5.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=
golang.org/x/sync v0.6.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=
golang.org/x/sync v0.7.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=
golang.org/x/sync v0.8.0 h1:3NFvSEYkUoMifnESzZl15y791HH1qU2xm6eCJU5ZPXQ=
golang.org/x/sync v0.8.0/go
---
[Medium] chunk lines 3041-3060 in go.sum:
github.com/ryanuber/columnize v2.1.2+incompatible/go.mod h1:sm1tb6uqfes/u+d4ooFouqFdy9/2g9QGwK3SQygK0Ts=
github.com/sagikazarmark/crypt v0.6.0/go.mod h1:U8+INwJo3nBv1m6A/8OBXAq7Jnpspk5AxSgDyEQcea8=
github.com/sagikazarmark/locafero v0.4.0 h1:HApY1R9zGo4DBgr7dqsTH/JJxLTTsOt7u6keLGt6kNQ=
github.com/sagikazarmark/locafero v0.4.0/go.mod h1:Pe1W6UlPYUk/+wc/6KFhbORCfqzgYEpgQ3O5fPuL3H4=
github.com/sagikazarmark/slog-shim v0.1.0 h1:diDBnUNK9N/354PgrxMywXnAwEr1QZcOr6gto+ugjYE=
github.com/sagikazarmark/sl
---
[Medium] chunk lines 1961-1980 in go.sum:
github.com/go-openapi/jsonreference v0.21.0/go.mod h1:LmZmgsrTkVg9LG4EaHeY8cBDslNPMo06cago5JNLkm4=
github.com/go-openapi/loads v0.21.3/go.mod h1:Y3aMR24iHbKHppOj91nQ/SHc0cuPbAr4ndY4a02xydc=
github.com/go-openapi/loads v0.21.5/go.mod h1:PxTsnFBoBe+z89riT+wYt3prmSBP6GDAQh2l9H1Flz8=
github.com/go-openapi/loads v0.22.0 h1:ECPGd4jX1U6NApCGG1We+uEozOAvXvJSF4nnwHZ8Aco=
github.com/go-openapi/loads v0.22.0/go.mod h1:yLsaTCS92mnSAZX5WWoxszLj0u+Ojl+Zs5Stn1oF+rs=
github.com/go-openapi/runtime v0.27.1/go.mod
---
[Medium] chunk lines 2661-2680 in go.sum:
github.com/mattn/go-sqlite3 v1.14.22/go.mod h1:Uh1q+B4BYcTPb+yiD3kU8Ct7aC0hY9fxUwlHK0RXw+Y=
github.com/matttproud/golang_protobuf_extensions v1.0.1/go.mod h1:D8He9yQNgCq6Z5Ld7szi9bcBfOoFv/3dc6xSMkL2PC0=
github.com/matttproud/golang_protobuf_extensions v1.0.4 h1:mmDVorXM7PCGKw94cs5zkfA9PSy5pEvNWRP0ET0TIVo=
github.com/matttproud/golang_protobuf_extensions v1.0.4/go.mod h1:BSXmuO+STAnVfrANrmjBb36TMTDstsz7MSK+HVaYKv4=
github.com/matttproud/golang_protobuf_extensions/v2 v2.0.0/go.mod h1:QUyp042oQthUo
---
[Medium] chunk lines 2981-3000 in go.sum:
github.com/prometheus/common/sigv4 v0.1.0 h1:qoVebwtwwEhS85Czm2dSROY5fTo2PAPEVdDeppTwGX4=
github.com/prometheus/common/sigv4 v0.1.0/go.mod h1:2Jkxxk9yYvCkE5G1sQT7GuEXm57JrvHu9k5YwTjsNtI=
github.com/prometheus/exporter-toolkit v0.11.0 h1:yNTsuZ0aNCNFQ3aFTD2uhPOvr4iD7fdBvKPAEGkNf+g=
github.com/prometheus/exporter-toolkit v0.11.0/go.mod h1:BVnENhnNecpwoTLiABx7mrPB/OLRIgN74qlQbV+FK1Q=
github.com/prometheus/procfs v0.0.0-20181005140218-185b4288413d/go.mod h1:c3At6R/oaqEKCNdg8wHV1ftS6bRYblBhIjjI8uT2IG
---
[Medium] chunk lines 4501-4520 in go.sum:
k8s.io/api v0.31.1 h1:Xe1hX/fPW3PXYYv8BlozYqw63ytA92snr96zMW9gWTU=
k8s.io/api v0.31.1/go.mod h1:sbN1g6eY6XVLeqNsZGLnI5FwVseTrZX7Fv3O26rhAaI=
k8s.io/apimachinery v0.29.3/go.mod h1:hx/S4V2PNW4OMg3WizRrHutyB5la0iCUbZym+W0EQIU=
k8s.io/apimachinery v0.31.1 h1:mhcUBbj7KUjaVhyXILglcVjuS4nYXiwC+KKFBgIVy7U=
k8s.io/apimachinery v0.31.1/go.mod h1:rsPdaZJfTfLsNJSQzNHQvYoTmxhoOEofxtOsF3rtsMo=
k8s.io/apiserver v0.31.1 h1:Sars5ejQDCRBY5f7R3QFHdqN3s61nhkpaX8/k1iEw1c=
k8s.io/apiserver v0.31.1/go.mod h1:lzDhpeToa
---
[Medium] chunk lines 3021-3040 in go.sum:
github.com/rogpeppe/go-internal v1.9.0/go.mod h1:WtVeX8xhTBvf0smdhujwtBcq4Qrzq/fJaraNFVN+nFs=
github.com/rogpeppe/go-internal v1.10.0/go.mod h1:UQnix2H7Ngw/k4C5ijL5+65zddjncjaFoBhdsK/akog=
github.com/rogpeppe/go-internal v1.11.0/go.mod h1:ddIwULY96R17DhadqLgMfk9H9tvdUzkipdSkR5nkCZA=
github.com/rogpeppe/go-internal v1.13.1 h1:KvO1DLK/DRN07sQ1LQKScxyZJuNnedQ5/wKSR38lUII=
github.com/rogpeppe/go-internal v1.13.1/go.mod h1:uMEvuHeurkdAXX61udpOXGD/AzZDWNMNyH2VO9fmH0o=
github.com/rs/cors v1.10.1/go.mod
---
[Medium] chunk lines 1781-1800 in go.sum:
github.com/digitalocean/godo v1.113.0/go.mod h1:Z2mTP848Vi3IXXl5YbPekUgr4j4tOePomA+OE1Ag98w=
github.com/distribution/reference v0.5.0 h1:/FUIFXtfc/x2gpa5/VGfiGLuOIdYa1t65IKK2OFGvA0=
github.com/distribution/reference v0.5.0/go.mod h1:BbU0aIcezP1/5jX/8MP0YiH4SdvB5Y4f/wlDRiLyi3E=
github.com/dlmiddlecote/sqlstats v1.0.2 h1:gSU11YN23D/iY50A2zVYwgXgy072khatTsIW6UPjUtI=
github.com/dlmiddlecote/sqlstats v1.0.2/go.mod h1:0CWaIh/Th+z2aI6Q9Jpfg/o21zmGxWhbByHgQSCUQvY=
github.com/dnaeon/go-vcr v1.1.0/go.mod 
---
[Medium] chunk lines 3921-3940 in go.sum:
golang.org/x/tools v0.0.0-20191216173652-a0e659d51361/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=
golang.org/x/tools v0.0.0-20191227053925-7b8e75db28f4/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=
golang.org/x/tools v0.0.0-20200103221440-774c71fcf114/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=
golang.org/x/tools v0.0.0-20200117161641-43d50277825c/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=
golang.org/x/tools v0.0.0-20200122220014-bf1340f18c4a/go.mod h1:
---
[Medium] chunk lines 3401-3420 in go.sum:
golang.org/x/crypto v0.0.0-20191011191535-87dc89f01550/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
golang.org/x/crypto v0.0.0-20200323165209-0ec3e9974c59/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
golang.org/x/crypto v0.0.0-20200414173820-0848c9571904/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
golang.org/x/crypto v0.0.0-20200622213623-75b288015ac9/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
golang.org/x/crypto v0.0.0-20200820211705-5c72a883971a/go.mo
---
[Medium] chunk lines 3721-3740 in go.sum:
golang.org/x/sys v0.0.0-20191112214154-59a1497f0cea/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20191120155948-bd437916bb0e/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20191204072324-ce4227a45e2e/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20191220142924-d4481acd189f/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20191228213918-04cbcbbfeed8/go.mod h1:h1NjWce9XR
---
[Medium] chunk lines 1881-1900 in go.sum:
github.com/frankban/quicktest v1.14.6/go.mod h1:4ptaffx2x8+WTWXmUCuVU6aPUX1/Mz7zb5vbUoiM6w0=
github.com/fsnotify/fsnotify v1.4.7/go.mod h1:jwhsz4b93w/PPRr/qN1Yymfu8t87LnFCMoQvtojpjFo=
github.com/fsnotify/fsnotify v1.4.9/go.mod h1:znqG4EE+3YCdAaPaxE2ZRY/06pZUdp0tY4IgpuI1SZQ=
github.com/fsnotify/fsnotify v1.5.4/go.mod h1:OVB6XrOHzAwXMpEM7uPOzcehqUV2UqJxmVXmkdnm1bU=
github.com/fsnotify/fsnotify v1.7.0 h1:8JEhPFa5W2WU7YfeZzPNqzMP6Lwt7L2715Ggo0nosvA=
github.com/fsnotify/fsnotify v1.7.0/go.mod h1:40Bi
---
[Medium] chunk lines 1421-1440 in go.sum:
github.com/BurntSushi/toml v1.4.0/go.mod h1:ukJfTF/6rtPPRCnwkur4qwRxa8vTRFBF0uk2lLoLwho=
github.com/BurntSushi/xgb v0.0.0-20160522181843-27f122750802/go.mod h1:IVnqGOEym/WlBOVXweHU+Q+/VP0lqqI8lqeDx9IjBqo=
github.com/Code-Hex/go-generics-cache v1.5.1 h1:6vhZGc5M7Y/YD8cIUcY8kcuQLB4cHR7U+0KMqAA0KcU=
github.com/Code-Hex/go-generics-cache v1.5.1/go.mod h1:qxcC9kRVrct9rHeiYpFWSoW1vxyillCVzX13KZG8dl4=
github.com/DATA-DOG/go-sqlmock v1.5.2 h1:OcvFkGmslmlZibjAjaHm3L//6LiuBgolP7OputlJIzU=
github.com/DATA-
---
[Medium] chunk lines 3821-3840 in go.sum:
golang.org/x/sys v0.14.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.15.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.16.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.17.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.18.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.19.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.
---
[Medium] chunk lines 3861-3880 in go.sum:
golang.org/x/text v0.3.6/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
golang.org/x/text v0.3.7/go.mod h1:u+2+/6zg+i71rQMx5EYifcz6MCKuco9NR6JIITiCfzQ=
golang.org/x/text v0.3.8/go.mod h1:E6s5w1FMmriuDzIBO73fBruAKo1PCIq6d2Q6DHfQ8WQ=
golang.org/x/text v0.4.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=
golang.org/x/text v0.5.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=
golang.org/x/text v0.6.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=
golang.org/x/text v0
---
[Medium] chunk lines 3901-3920 in go.sum:
golang.org/x/tools v0.0.0-20190425222832-ad9eeb80039a/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=
golang.org/x/tools v0.0.0-20190506145303-2d16b83fe98c/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=
golang.org/x/tools v0.0.0-20190524140312-2c0ae7006135/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=
golang.org/x/tools v0.0.0-20190606124116-d0a3d012864b/go.mod h1:/rFqwRUd4F7ZHNgwSSTFct+R/Kf4OFW1sUzUTQQTgfc=
golang.org/x/tools v0.0.0-20190621195816-6e04913cbbac/go.mod h1:
---
[Medium] chunk lines 4141-4160 in go.sum:
google.golang.org/genproto v0.0.0-20210303154014-9728d6b83eeb/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=
google.golang.org/genproto v0.0.0-20210310155132-4ce2db91004e/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=
google.golang.org/genproto v0.0.0-20210319143718-93e7006c17a6/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=
google.golang.org/genproto v0.0.0-20210329143202-679c6ae281ee/go.mod h1:9lPAdzaEmUacj36I+k7YKbEc5CXzPIeORRgDAUOu28A=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 3461-3480 in go.sum:
golang.org/x/exp v0.0.0-20240119083558-1b970713d09a/go.mod h1:idGWGoKP1toJGkd5/ig9ZLuPcZBC3ewk7SzmH0uou08=
golang.org/x/exp v0.0.0-20240904232852-e7e105dedf7e h1:I88y4caeGeuDQxgdoFPUq097j7kNfw6uvuiNxUBfcBk=
golang.org/x/exp v0.0.0-20240904232852-e7e105dedf7e/go.mod h1:akd2r19cwCdwSwWeIdzYQGa/EZZyqcOdwWiwj5L5eKQ=
golang.org/x/image v0.0.0-20180708004352-c73c2afc3b81/go.mod h1:ux5Hcp/YLpHSI86hEcLt0YII63i6oz57MZXIpbrjZUs=
golang.org/x/image v0.0.0-20190227222117-0694c2d4d067/go.mod h1:kZ7UVZpmo3dzQ
---
[Medium] chunk lines 2281-2300 in go.sum:
github.com/grafana/grafana-plugin-sdk-go v0.114.0/go.mod h1:D7x3ah+1d4phNXpbnOaxa/osSaZlwh9/ZUnGGzegRbk=
github.com/grafana/grafana-plugin-sdk-go v0.255.0 h1:e9bmDTdpR6Ho9ru+UhyVoWguVSSGFgInRjOsl4AftBQ=
github.com/grafana/grafana-plugin-sdk-go v0.255.0/go.mod h1:sE25SkFQSj8DwX4qkF7w++6KL6mzOXo1ycDlk9GgFGw=
github.com/grafana/grafana/apps/playlist v0.0.0-20240917082838-e2bce38a7990 h1:uQMZE/z+Y+o/U0z/g8ckAHss7U7LswedilByA2535DU=
github.com/grafana/grafana/apps/playlist v0.0.0-20240917082838-e2bce
---
[Medium] chunk lines 1741-1760 in go.sum:
github.com/cpuguy83/go-md2man/v2 v2.0.4/go.mod h1:tgQtvFlXSQOSOSIRvRPT7W67SCa46tRHOmNcaadrF8o=
github.com/creack/pty v1.1.7/go.mod h1:lj5s0c3V2DBrqTV7llrYr5NG6My20zk30Fl46Y7DoTY=
github.com/creack/pty v1.1.9/go.mod h1:oKZEueFk5CKHvIhNR5MUki03XCEU+Q6VDXinZuGJ33E=
github.com/creack/pty v1.1.11/go.mod h1:oKZEueFk5CKHvIhNR5MUki03XCEU+Q6VDXinZuGJ33E=
github.com/cznic/b v0.0.0-20180115125044-35e9bbe41f07/go.mod h1:URriBxXwVq5ijiJ12C7iIZqlA69nTlI+LgI6/pwftG8=
github.com/cznic/fileutil v0.0.0-2018010821
---
[Medium] chunk lines 2841-2860 in go.sum:
github.com/onsi/gomega v1.27.8/go.mod h1:2J8vzI/s+2shY9XHRApDkdgPo1TKT7P2u6fXeJKFnNQ=
github.com/onsi/gomega v1.27.10/go.mod h1:RsS8tutOdbdgzbPtzzATp12yT7kM5I5aElG3evPbQ0M=
github.com/onsi/gomega v1.29.0/go.mod h1:9sxs+SwGrKI0+PWe4Fxa9tFQQBG5xSsSbMXOI8PPpoQ=
github.com/onsi/gomega v1.34.1 h1:EUMJIKUjM8sKjYbtxQI9A4z2o+rruxnzNvpknOXie6k=
github.com/onsi/gomega v1.34.1/go.mod h1:kU1QgUvBDLXBJq618Xvm2LUX6rSAfRaFRTcdOeDLwwY=
github.com/op/go-logging v0.0.0-20160315200505-970db520ece7/go.mod h1:HzydrM
---
[Medium] chunk lines 4461-4480 in go.sum:
gopkg.in/ini.v1 v1.67.0/go.mod h1:pNLf8WUiyNEtQjuu5G5vTm06TEv9tsIgeAvK8hOrP4k=
gopkg.in/mail.v2 v2.3.1 h1:WYFn/oANrAGP2C0dcV6/pbkPzv8yGzqTjPmTeO7qoXk=
gopkg.in/mail.v2 v2.3.1/go.mod h1:htwXN1Qh09vZJ1NVKxQqHPBaCBbzKhp5GzuJEA4VJWw=
gopkg.in/natefinch/lumberjack.v2 v2.2.1 h1:bBRl1b0OH9s/DuPhuXpNl+VtCaJXFZ5/uEFST95x9zc=
gopkg.in/natefinch/lumberjack.v2 v2.2.1/go.mod h1:YD8tP3GAjkrDg1eZH7EGmyESg/lsYskCTPBJVb9jqSc=
gopkg.in/resty.v1 v1.12.0/go.mod h1:mDo4pnntr5jdWRML875a/NmxYqAlA73dVijT2AXvQQo=
gopkg.
---
[Medium] chunk lines 1461-1480 in go.sum:
github.com/RoaringBitmap/roaring v0.9.1/go.mod h1:h1B7iIUOmnAeb5ytYMvnHJwxMc6LUrwBnzXWRuqTQUc=
github.com/RoaringBitmap/roaring v1.9.3 h1:t4EbC5qQwnisr5PrP9nt0IRhRTb9gMUgQF4t4S2OByM=
github.com/RoaringBitmap/roaring v1.9.3/go.mod h1:6AXUsoIEzDTFFQCe1RbGA6uFONMhvejWj5rqITANK90=
github.com/Shopify/sarama v1.19.0/go.mod h1:FVkBWblsNy7DGZRfXLU0O9RCGt5g3g3yEuWXgklEdEo=
github.com/Shopify/toxiproxy v2.1.4+incompatible/go.mod h1:OXgGpZ6Cli1/URJOF1DMxUHB2q5Ap20/P/eIdh4G0pI=
github.com/VividCortex/gohist
---
[Medium] chunk lines 1621-1640 in go.sum:
github.com/blevesearch/vellum v1.0.5/go.mod h1:atE0EH3fvk43zzS7t1YNdNC7DbmcC3uz+eMD5xZ2OyQ=
github.com/blevesearch/vellum v1.0.10 h1:HGPJDT2bTva12hrHepVT3rOyIKFFF4t7Gf6yMxyMIPI=
github.com/blevesearch/vellum v1.0.10/go.mod h1:ul1oT0FhSMDIExNjIxHqJoGpVrBpKCdgDQNxfqgJt7k=
github.com/blugelabs/bluge v0.1.9 h1:bPgXlcsWugrXNjzeoLdOnvfJpHsyODKpYaAndayl/SM=
github.com/blugelabs/bluge v0.1.9/go.mod h1:5d7LktUkQgvbh5Bmi6tPWtvo4+6uRTm6gAwP+5z6FqQ=
github.com/blugelabs/bluge_segment_api v0.2.0 h1:cCX1Y2y8v
---
[Medium] chunk lines 2101-2120 in go.sum:
github.com/golang/snappy v0.0.0-20170215233205-553a64147049/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/golang/snappy v0.0.0-20180518054509-2e65f85255db/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/golang/snappy v0.0.1/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/golang/snappy v0.0.3/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/golang/snappy v0.0.4 h1:yAGX7huGHXlcLOEtBnF4w7FQwA26wojNCwOYAEhLjQM=
github.com/golan
---
[Medium] chunk lines 3661-3680 in go.sum:
golang.org/x/oauth2 v0.23.0 h1:PbgcYx2W7i4LvjJWEbf0ngHV6qJYr86PkAV3bXdLEbs=
golang.org/x/oauth2 v0.23.0/go.mod h1:XYTD2NtWslqkgxebSiOHnXEap4TF09sJSc7H1sXbhtI=
golang.org/x/sync v0.0.0-20180314180146-1d60e4601c6f/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync v0.0.0-20181108010431-42b317875d0f/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync v0.0.0-20181221193216-37e7f081c4d4/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync
---
[Medium] chunk lines 4061-4080 in go.sum:
google.golang.org/api v0.103.0/go.mod h1:hGtW6nK1AC+d9si/UBhw8Xli+QMOf6xyNAyJw4qU9w0=
google.golang.org/api v0.106.0/go.mod h1:2Ts0XTHNVWxypznxWOYUeI4g3WdP9Pk2Qk58+a/O9MY=
google.golang.org/api v0.107.0/go.mod h1:2Ts0XTHNVWxypznxWOYUeI4g3WdP9Pk2Qk58+a/O9MY=
google.golang.org/api v0.108.0/go.mod h1:2Ts0XTHNVWxypznxWOYUeI4g3WdP9Pk2Qk58+a/O9MY=
google.golang.org/api v0.110.0/go.mod h1:7FC4Vvx1Mooxh8C5HWjzZHcavuS2f6pmJpZx60ca7iI=
google.golang.org/api v0.111.0/go.mod h1:qtFHvU9mhgTJegR31csQ+rwxyUTHO
---
[Medium] chunk lines 1801-1820 in go.sum:
github.com/docopt/docopt-go v0.0.0-20180111231733-ee0de3bc6815/go.mod h1:WwZ+bS3ebgob9U8Nd0kOddGdZWjyMGR8Wziv+TBNwSE=
github.com/dolthub/maphash v0.1.0 h1:bsQ7JsF4FkkWyrP3oCnFJgrCUAFbFf3kOl4L/QxPDyQ=
github.com/dolthub/maphash v0.1.0/go.mod h1:gkg4Ch4CdCDu5h6PMriVLawB7koZ+5ijb9puGMV50a4=
github.com/dustin/go-humanize v0.0.0-20171111073723-bb3d318650d4/go.mod h1:HtrtbFcZ19U5GC7JDqmcUSB87Iq5E25KnS6fMYU6eOk=
github.com/dustin/go-humanize v1.0.0/go.mod h1:HtrtbFcZ19U5GC7JDqmcUSB87Iq5E25KnS6fMYU6eOk=
---
[Medium] chunk lines 3341-3360 in go.sum:
go.opentelemetry.io/otel/sdk v1.31.0/go.mod h1:TfRbMdhvxIIr/B2N2LQW2S5v9m3gOQ/08KsbbO5BPT0=
go.opentelemetry.io/otel/trace v1.17.0/go.mod h1:I/4vKTgFclIsXRVucpH25X0mpFSczM7aHeaz0ZBLWjY=
go.opentelemetry.io/otel/trace v1.19.0/go.mod h1:mfaSyvGyEJEI0nyV2I4qhNQnbBOUUmYZpYojqMnX2vo=
go.opentelemetry.io/otel/trace v1.21.0/go.mod h1:LGbsEB0f9LGjN+OZaQQ26sohbOmiMR+BaslueVtS/qQ=
go.opentelemetry.io/otel/trace v1.22.0/go.mod h1:RbbHXVqKES9QhzZq/fE5UnOSILqRt40a21sPw2He1xo=
go.opentelemetry.io/otel/trace v
---
[Medium] chunk lines 4101-4120 in go.sum:
google.golang.org/genproto v0.0.0-20190404172233-64821d5d2107/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=
google.golang.org/genproto v0.0.0-20190418145605-e7d98fc518a7/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=
google.golang.org/genproto v0.0.0-20190425155659-357c62f0e4bb/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=
google.golang.org/genproto v0.0.0-20190502173448-54afdca5d873/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 2001-2020 in go.sum:
github.com/go-sql-driver/mysql v1.7.1/go.mod h1:OXbVy3sEdcQ2Doequ6Z5BW6fXNQTmx+9S1MCJN5yJMI=
github.com/go-stack/stack v1.8.0/go.mod h1:v0f6uXyyMGvRgIKkXu+yp6POWl0qKG85gN/melR3HDY=
github.com/go-stack/stack v1.8.1 h1:ntEHSVwIt7PNXNpgPmVfMrNhLtgjlmnZha2kOpuRiDw=
github.com/go-stack/stack v1.8.1/go.mod h1:dcoOX6HbPZSZptuspn9bctJ+N/CnF5gGygcUP3XYfe4=
github.com/go-task/slim-sprig v0.0.0-20210107165309-348f09dbbbc0/go.mod h1:fyg7847qk6SyHyPtNmDHnmrv/HOrqktSC+C9fM+CJOE=
github.com/go-task/slim-sprig 
---
[Medium] chunk lines 3221-3240 in go.sum:
github.com/yudai/golcs v0.0.0-20170316035057-ecda9a501e82 h1:BHyfKlQyqbsFN5p3IfnEUduWvb9is428/nNb5L3U01M=
github.com/yudai/golcs v0.0.0-20170316035057-ecda9a501e82/go.mod h1:lgjkn3NuSvDfVJdfcVVdX+jpBxNmX4rDAzaS45IcYoM=
github.com/yudai/pp v2.0.1+incompatible h1:Q4//iY4pNF6yPLZIigmvcl7k/bPgrcTPIFIcmawg5bI=
github.com/yudai/pp v2.0.1+incompatible/go.mod h1:PuxR/8QJ7cyCkFp/aUDS+JY727OFEZkTdatxwunjIkc=
github.com/yuin/goldmark v1.1.25/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=
github.com
---
[Medium] chunk lines 2421-2440 in go.sum:
github.com/hashicorp/memberlist v0.5.0 h1:EtYPN8DpAURiapus508I4n9CzHs2W+8NZGbmmR/prTM=
github.com/hashicorp/memberlist v0.5.0/go.mod h1:yvyXLpo0QaGE59Y7hDTsTzDD25JYBZ4mHgHUZ8lrOI0=
github.com/hashicorp/nomad/api v0.0.0-20240418183417-ea5f2f6748c7 h1:pjE59CS2C9Bg+Xby0ROrnZSSBWtKwx3Sf9gqsrvIFSA=
github.com/hashicorp/nomad/api v0.0.0-20240418183417-ea5f2f6748c7/go.mod h1:svtxn6QnrQ69P23VvIWMR34tg3vmwLz4UdUzm1dSCgE=
github.com/hashicorp/serf v0.8.2/go.mod h1:6hOLApaqBFA1NXqRQAsxw9QxuDEvNxSQRwA/Jwenr
---
[Medium] chunk lines 3601-3620 in go.sum:
golang.org/x/net v0.9.0/go.mod h1:d48xBJpPfHeWQsugry2m+kC02ZBRGRgulfHnEXEuWns=
golang.org/x/net v0.10.0/go.mod h1:0qNGK6F8kojg2nk9dLZ2mShWaEBan6FAoqfSigmmuDg=
golang.org/x/net v0.11.0/go.mod h1:2L/ixqYpgIVXmeoSA/4Lu7BzTG4KIyPIryS4IsOd1oQ=
golang.org/x/net v0.12.0/go.mod h1:zEVYFnQC7m/vmpQFELhcD1EWkZlX69l4oqgmer6hfKA=
golang.org/x/net v0.14.0/go.mod h1:PpSgVXXLK0OxS0F31C1/tv6XNguvCrnXIDrFMspZIUI=
golang.org/x/net v0.15.0/go.mod h1:idbUs1IY1+zTqbi8yxTbhexhEEk5ur9LInksu6HrEpk=
golang.org/x/net v0.1
---
[Medium] chunk lines 3321-3340 in go.sum:
go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.31.0/go.mod h1:B5Ki776z/MBnVha1Nzwp5arlzBbE3+1jk+pGmaP5HME=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.25.0/go.mod h1:8GlBGcDk8KKi7n+2S4BT/CPZQYH3erLu0/k64r1MYgo=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.31.0 h1:FFeLy03iVTXP6ffeN2iXrxfGsZGCjVx0/4KlizjyBwU=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.31.0/go.mod h1:TMu73/k1CP8nBUpDLc71Wj/Kf7ZS9FK5b53VapRsP9o=
go.openteleme
---
[Medium] chunk lines 3761-3780 in go.sum:
golang.org/x/sys v0.0.0-20210330210617-4fbd30eecc44/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210403161142-5e06dd20ab57/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210423082822-04245dca01da/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210423185535-09eb48e85fd7/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210510120138-977fb7262007/go.mod h1:oPkhp1MJrh
---
[Medium] chunk lines 4081-4100 in go.sum:
google.golang.org/api v0.164.0/go.mod h1:2OatzO7ZDQsoS7IFf3rvsE17/TldiU3F/zxFHeqUB5o=
google.golang.org/api v0.169.0/go.mod h1:gpNOiMA2tZ4mf5R9Iwf4rK/Dcz0fbdIgWYWVoxmsyLg=
google.golang.org/api v0.174.0/go.mod h1:aC7tB6j0HR1Nl0ni5ghpx6iLasmAX78Zkh/wgxAAjLg=
google.golang.org/api v0.191.0 h1:cJcF09Z+4HAB2t5qTQM1ZtfL/PemsLFkcFG67qq2afk=
google.golang.org/api v0.191.0/go.mod h1:tD5dsFGxFza0hnQveGfVk9QQYKcfp+VzgRqyXFxE0+E=
google.golang.org/appengine v1.1.0/go.mod h1:EbEs0AVv82hx2wNQdGPgUI5lhzA/G0D9
---
[Medium] chunk lines 4341-4360 in go.sum:
google.golang.org/genproto/googleapis/rpc v0.0.0-20240304161311-37d4d3c04a78/go.mod h1:UCOku4NytXMJuLQE5VuqA5lX3PcHCBo8pxNyvkf4xBs=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240311132316-a219d84964c2/go.mod h1:UCOku4NytXMJuLQE5VuqA5lX3PcHCBo8pxNyvkf4xBs=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240401170217-c3f982113cda/go.mod h1:WtryC6hu0hhx87FDGxWCDptyssuo68sk10vYjF+T9fY=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240415141817-7cd4c1c1f9ec/go.mod h1:WtryC6hu0hhx87FDG
---
[Medium] chunk lines 1701-1720 in go.sum:
github.com/cncf/udpa/go v0.0.0-20210930031921-04548b0d99d4/go.mod h1:6pvJx4me5XPnfI9Z40ddWsdw2W/uZgQLFXToKeRcDiI=
github.com/cncf/udpa/go v0.0.0-20220112060539-c52dc94e7fbe/go.mod h1:6pvJx4me5XPnfI9Z40ddWsdw2W/uZgQLFXToKeRcDiI=
github.com/cncf/xds/go v0.0.0-20210312221358-fbca930ec8ed/go.mod h1:eXthEFrGJvWHgFFCl3hGmgk+/aYT6PnTQLykKQRLhEs=
github.com/cncf/xds/go v0.0.0-20210805033703-aa0b78936158/go.mod h1:eXthEFrGJvWHgFFCl3hGmgk+/aYT6PnTQLykKQRLhEs=
github.com/cncf/xds/go v0.0.0-20210922020428-2
---
[Medium] chunk lines 2461-2480 in go.sum:
github.com/influxdata/influxdb1-client v0.0.0-20191209144304-8bf82d3c094d/go.mod h1:qj24IKcXYK6Iy9ceXlo3Tc+vtHo9lIhSX5JddghvEPo=
github.com/influxdata/influxdb1-client v0.0.0-20200827194710-b269163b24ab/go.mod h1:qj24IKcXYK6Iy9ceXlo3Tc+vtHo9lIhSX5JddghvEPo=
github.com/influxdata/line-protocol v0.0.0-20210922203350-b1ad95c89adf h1:7JTmneyiNEwVBOHSjoMxiWAqB992atOeepeFYegn5RU=
github.com/influxdata/line-protocol v0.0.0-20210922203350-b1ad95c89adf/go.mod h1:xaLFMmpvUxqXtVkUJfg9QmT88cDaCJ3ZKgdZ78oO8Q
---
[Medium] chunk lines 4021-4040 in go.sum:
google.golang.org/api v0.24.0/go.mod h1:lIXQywCXRcnZPGlsd8NbLnOjtAoL6em04bJ9+z0MncE=
google.golang.org/api v0.28.0/go.mod h1:lIXQywCXRcnZPGlsd8NbLnOjtAoL6em04bJ9+z0MncE=
google.golang.org/api v0.29.0/go.mod h1:Lcubydp8VUV7KeIHD9z2Bys/sm/vGKnG1UHuDBSrHWM=
google.golang.org/api v0.30.0/go.mod h1:QGmEvQ87FHZNiUVJkT14jQNYJ4ZJjdRF23ZXz5138Fc=
google.golang.org/api v0.35.0/go.mod h1:/XrVsuzM0rZmrsbjJutiuftIzeuTQcEeaYcSk/mQ1dg=
google.golang.org/api v0.36.0/go.mod h1:+z5ficQTmoYpPn8LCUNVpK5I7hwkpjbcgqA
---
[Medium] chunk lines 3141-3160 in go.sum:
github.com/stretchr/testify v1.3.0/go.mod h1:M5WIy9Dh21IEIfnGCwXGc5bZfKNJtfHm1UVUgZn+9EI=
github.com/stretchr/testify v1.4.0/go.mod h1:j7eGeouHqKxXV5pUuKE4zz7dFj8WfuZ+81PSLYec5m4=
github.com/stretchr/testify v1.5.1/go.mod h1:5W2xD1RspED5o8YsWQXVCued0rvSQ+mT+I5cxcmMvtA=
github.com/stretchr/testify v1.6.1/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/stretchr/testify v1.7.0/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/stretchr/testify v1.7.1/go.mod h1:6Fq8o
---
[Medium] chunk lines 3781-3800 in go.sum:
golang.org/x/sys v0.0.0-20211019181941-9d821ace8654/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211025201205-69cdffdb9359/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211124211545-fe61309f8881/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211210111614-af8b64212486/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211216021012-1d35b9e2eb4e/go.mod h1:oPkhp1MJrh
---
[Medium] chunk lines 2801-2820 in go.sum:
github.com/onsi/ginkgo v1.7.0/go.mod h1:lLunBs/Ym6LB5Z9jYTR76FiuTmxDTDusOGeTQH+WWjE=
github.com/onsi/ginkgo v1.12.1/go.mod h1:zj2OWP4+oCPe1qIXoGWkgMRwljMUYCdkwsT2108oapk=
github.com/onsi/ginkgo v1.16.2/go.mod h1:CObGmKUOKaSC0RjmoAK7tKyn4Azo5P2IWuoMnvwxz1E=
github.com/onsi/ginkgo v1.16.4/go.mod h1:dX+/inL/fNMqNlz0e9LfyB9TswhZpCVdJM/Z6Vvnwo0=
github.com/onsi/ginkgo v1.16.5 h1:8xi0RTUf59SOSfEtZMvwTvXYMzG4gV23XVHOZiXNtnE=
github.com/onsi/ginkgo v1.16.5/go.mod h1:+E8gABHa3K6zRBolWtd+ROzc/U5bkGt0FwiG0
---
[Medium] chunk lines 4201-4220 in go.sum:
google.golang.org/genproto v0.0.0-20220915135415-7fd63a7952de/go.mod h1:0Nb8Qy+Sk5eDzHnzlStwW3itdNaWoZA5XeSG+R3JHSo=
google.golang.org/genproto v0.0.0-20220916172020-2692e8806bfa/go.mod h1:0Nb8Qy+Sk5eDzHnzlStwW3itdNaWoZA5XeSG+R3JHSo=
google.golang.org/genproto v0.0.0-20220919141832-68c03719ef51/go.mod h1:0Nb8Qy+Sk5eDzHnzlStwW3itdNaWoZA5XeSG+R3JHSo=
google.golang.org/genproto v0.0.0-20220920201722-2b89144ce006/go.mod h1:ht8XFiar2npT/g4vkk7O0WYS1sHOHbdujxbEp7CJWbw=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 3621-3640 in go.sum:
golang.org/x/oauth2 v0.0.0-20190402181905-9f3314589c9a/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=
golang.org/x/oauth2 v0.0.0-20190604053449-0f29369cfe45/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=
golang.org/x/oauth2 v0.0.0-20191202225959-858c2ad4c8b6/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=
golang.org/x/oauth2 v0.0.0-20200107190931-bf48bf16ab8d/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=
golang.org/x/oauth2 v0.0.0-20200902213428-5d25da1a8d43/go.mo
---
[Medium] chunk lines 4281-4300 in go.sum:
google.golang.org/genproto/googleapis/api v0.0.0-20230920204549-e6e6cdab5c13/go.mod h1:RdyHbowztCGQySiCvQPgWQWgWhGnouTdCflKoDBt32U=
google.golang.org/genproto/googleapis/api v0.0.0-20231002182017-d307bd883b97/go.mod h1:iargEX0SFPm3xcfMI0d1domjg0ZF4Aa0p2awqyxhvF0=
google.golang.org/genproto/googleapis/api v0.0.0-20231012201019-e917dd12ba7a/go.mod h1:SUBoKXbI1Efip18FClrQVGjWcyd0QZd8KkvdP34t7ww=
google.golang.org/genproto/googleapis/api v0.0.0-20231016165738-49dd2c1f3d0b/go.mod h1:IBQ646DjkDkvUIsVq
---
[Medium] chunk lines 2761-2780 in go.sum:
github.com/mxk/go-flowrate v0.0.0-20140419014527-cca7078d478f/go.mod h1:ZdcZmHo+o7JKHSa8/e818NopupXU1YMK5fe1lsApnBw=
github.com/nakagami/firebirdsql v0.0.0-20190310045651-3c02a58cfed8/go.mod h1:86wM1zFnC6/uDBfZGNwB65O+pR2OFi5q/YQaEUid1qA=
github.com/natefinch/wrap v0.2.0 h1:IXzc/pw5KqxJv55gV0lSOcKHYuEZPGbQrOOXr/bamRk=
github.com/natefinch/wrap v0.2.0/go.mod h1:6gMHlAl12DwYEfKP3TkuykYUfLSEAvHw67itm4/KAS8=
github.com/nats-io/jwt v0.3.0/go.mod h1:fRYCDE99xlTsqUzISS1Bi75UBJ6ljOJQOAAu5VglpSg=
github.
---
[Medium] chunk lines 3701-3720 in go.sum:
golang.org/x/sys v0.0.0-20190222072716-a9d3bda3a223/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
golang.org/x/sys v0.0.0-20190312061237-fead79001313/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190412213103-97732733099d/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190422165155-953cdadca894/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190426135247-a129542de9ae/go.mod h1:h1NjWce9XR
---
[Medium] chunk lines 4301-4320 in go.sum:
google.golang.org/genproto/googleapis/api v0.0.0-20241007155032-5fefd90f89a9/go.mod h1:wp2WsuBYj6j8wUdo3ToZsdxxixbvQNAHqVJrTgi5E5M=
google.golang.org/genproto/googleapis/bytestream v0.0.0-20230530153820-e85fd2cbaebc/go.mod h1:ylj+BE99M198VPbBh6A8d9n3w8fChvyLK3wwBOjXBFA=
google.golang.org/genproto/googleapis/bytestream v0.0.0-20230807174057-1744710a1577/go.mod h1:NjCQG/D8JandXxM57PZbAJL1DCNL6EypA0vPPwfsc7c=
google.golang.org/genproto/googleapis/bytestream v0.0.0-20231030173426-d783a09b4405/go.mod
---
[Medium] chunk lines 4441-4460 in go.sum:
gopkg.in/alexcesaro/quotedprintable.v3 v3.0.0-20150716171945-2caba252f4dc h1:2gGKlE2+asNV9m7xrywl36YYNnBG5ZQ0r/BOOxqPpmk=
gopkg.in/alexcesaro/quotedprintable.v3 v3.0.0-20150716171945-2caba252f4dc/go.mod h1:m7x9LTH6d71AHyAX77c9yqWCCa3UKHcVEj9y7hAtKDk=
gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/check.v1 v1.0.0-20180628173108-788fd7840127/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/check.v1 v1.0.0-20190902
---
[Medium] chunk lines 2021-2040 in go.sum:
github.com/gobwas/ws v1.2.1/go.mod h1:hRKAFb8wOxFROYNsT1bqfWnhX+b5MFeJM9r2ZSwg/KY=
github.com/goccy/go-json v0.9.11/go.mod h1:6MelG93GURQebXPDq3khkgXZkazVtN9CRI+MGFi0w8I=
github.com/goccy/go-json v0.10.2/go.mod h1:6MelG93GURQebXPDq3khkgXZkazVtN9CRI+MGFi0w8I=
github.com/goccy/go-json v0.10.3 h1:KZ5WoDbxAIgm2HNbYckL0se1fHD6rz5j4ywS6ebzDqA=
github.com/goccy/go-json v0.10.3/go.mod h1:oq7eo15ShAhp70Anwd5lgX2pLfOS3QCiwU/PULtXL6M=
github.com/goccy/go-yaml v1.9.5/go.mod h1:U/jl18uSupI5rdI2jmuCswEA2htH9e
---
[Medium] chunk lines 2821-2840 in go.sum:
github.com/onsi/ginkgo/v2 v2.13.0/go.mod h1:TE309ZR8s5FsKKpuB1YAQYBzCaAfUgatB/xlT/ETL/o=
github.com/onsi/ginkgo/v2 v2.19.0 h1:9Cnnf7UHo57Hy3k6/m5k3dRfGTMXGvxhHFvkDTCTpvA=
github.com/onsi/ginkgo/v2 v2.19.0/go.mod h1:rlwLi9PilAFJ8jCg9UE1QP6VBpd6/xj3SRC0d6TU0To=
github.com/onsi/gomega v1.4.3/go.mod h1:ex+gbHU/CVuBBDIJjb2X0qEXbFg53c61hWP/1CpauHY=
github.com/onsi/gomega v1.7.1/go.mod h1:XdKZgCCFLUoM/7CFJVPcG8C1xQ1AJ0vpAezJrB7JYyY=
github.com/onsi/gomega v1.10.1/go.mod h1:iN09h71vgCQne3DLsj+A5owkum+a2
---
[Medium] chunk lines 3441-3460 in go.sum:
golang.org/x/exp v0.0.0-20180807140117-3d87b88a115f/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
golang.org/x/exp v0.0.0-20190121172915-509febef88a4/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
golang.org/x/exp v0.0.0-20190125153040-c74c464bbbf2/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
golang.org/x/exp v0.0.0-20190306152737-a1d7652674e8/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
golang.org/x/exp v0.0.0-20190510132918-efd6b22b2522/go.mod h1:ZjyILWgesf
---
[Medium] chunk lines 1541-1560 in go.sum:
github.com/aws/aws-sdk-go v1.40.45/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=
github.com/aws/aws-sdk-go v1.50.29/go.mod h1:LF8svs817+Nz+DmiMQKTO3ubZ/6IaTpq3TjupRn3Eqk=
github.com/aws/aws-sdk-go v1.51.25/go.mod h1:LF8svs817+Nz+DmiMQKTO3ubZ/6IaTpq3TjupRn3Eqk=
github.com/aws/aws-sdk-go v1.55.5 h1:KKUZBfBoyqy5d3swXyiC7Q76ic40rYcbqH7qjh59kzU=
github.com/aws/aws-sdk-go v1.55.5/go.mod h1:eRwEWoyTWFMVYVQzKMNHWP5/RV4xIUGMQfXQHfHkpNU=
github.com/aws/aws-sdk-go-v2 v0.18.0/go.mod h1:JWVYvqSMppoM
---
[Medium] chunk lines 301-320 in go.work.sum:
github.com/CloudyKit/fastprinter v0.0.0-20200109182630-33d98a066a53 h1:sR+/8Yb4slttB4vD+b9btVEnWgL3Q00OBTzVT8B9C0c=
github.com/CloudyKit/fastprinter v0.0.0-20200109182630-33d98a066a53/go.mod h1:+3IMCy2vIlbG1XG/0ggNQv0SvxCAIpPM5b1nCz56Xno=
github.com/CloudyKit/jet/v6 v6.2.0 h1:EpcZ6SR9n28BUGtNJSvlBqf90IpjeFr36Tizxhn/oME=
github.com/CloudyKit/jet/v6 v6.2.0/go.mod h1:d3ypHeIRNo2+XyqnGA8s+aphtcVpjP5hPwP/Lzo7Ro4=
github.com/DataDog/datadog-go v3.2.0+incompatible h1:qSG2N4FghB1He/r2mFrWKCaL7dXCilEuNEe
---
[Medium] chunk lines 641-660 in go.work.sum:
github.com/hamba/avro/v2 v2.17.2/go.mod h1:Q9YK+qxAhtVrNqOhwlZTATLgLA8qxG2vtvkhK8fJ7Jo=
github.com/hashicorp/consul/api v1.15.3/go.mod h1:/g/qgcoBcEXALCNZgRRisyTW0nY86++L0KbeAMXYCeY=
github.com/hashicorp/consul/sdk v0.11.0/go.mod h1:yPkX5Q6CsxTFMjQQDJwzeNmUUF5NUGGbrDsv9wTb8cw=
github.com/hashicorp/consul/sdk v0.16.0 h1:SE9m0W6DEfgIVCJX7xU+iv/hUl4m/nxqMTnCdMxDpJ8=
github.com/hashicorp/go-hclog v0.14.1/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=
github.com/hashicorp/go-immutable-radix v
---
[Medium] chunk lines 681-700 in go.work.sum:
github.com/jstemmer/go-junit-report v0.9.1 h1:6QPYqodiu3GuPL+7mfx+NwDdp2eTkp9IfEUpgAwUN0o=
github.com/jsternberg/zap-logfmt v1.2.0 h1:1v+PK4/B48cy8cfQbxL4FmmNZrjnIMr2BsnyEmXqv2o=
github.com/jsternberg/zap-logfmt v1.2.0/go.mod h1:kz+1CUmCutPWABnNkOu9hOHKdT2q3TDYCcsFy9hpqb0=
github.com/juju/gnuflag v0.0.0-20171113085948-2ce1bb71843d h1:c93kUJDtVAXFEhsCh5jSxyOJmFHuzcihnslQiX8Urwo=
github.com/julienschmidt/httprouter v1.3.0 h1:U0609e9tgbseu3rBINet9P48AI/D3oJs4dN7jwJOQ1U=
github.com/jung-kurt/gofpdf 
---
[Medium] chunk lines 661-680 in go.work.sum:
github.com/iris-contrib/schema v0.0.6 h1:CPSBLyx2e91H2yJzPuhGuifVRnZBBJ3pCOMbOvPZaTw=
github.com/iris-contrib/schema v0.0.6/go.mod h1:iYszG0IOsuIsfzjymw1kMzTL8YQcCWlm65f3wX8J5iA=
github.com/jackc/fake v0.0.0-20150926172116-812a484cc733 h1:vr3AYkKovP8uR8AvSGGUK1IDqRa5lAAvEkZG1LKaCRc=
github.com/jackc/pgx v3.2.0+incompatible h1:0Vihzu20St42/UDsvZGdNE6jak7oi/UOeMzwMPHkgFY=
github.com/jackspirou/syscerts v0.0.0-20160531025014-b68f5469dff1 h1:9Xm8CKtMZIXgcopfdWk/qZ1rt0HjMgfMR9nxxSeK6vk=
github.com/ja
---
[Medium] chunk lines 581-600 in go.work.sum:
github.com/go-playground/locales v0.14.1 h1:EWaQ/wswjilfKLTECiXz7Rh+3BjFhfDFKv/oXslEjJA=
github.com/go-playground/locales v0.14.1/go.mod h1:hxrqLVvrK65+Rwrd5Fc6F2O76J/NuW9t0sjnWqG1slY=
github.com/go-playground/universal-translator v0.18.1 h1:Bcnm0ZwsGyWbCzImXv+pAJnYK9S473LQFuzCbDbfSFY=
github.com/go-playground/universal-translator v0.18.1/go.mod h1:xekY+UJKNuX9WP91TpwSH2VMlDf28Uj24BCp08ZFTUY=
github.com/go-playground/validator/v10 v10.14.1 h1:9c50NUPC30zyuKprjL3vNZ0m5oG+jU0zvx4AqHGnv4k=
github.c
---
[Medium] chunk lines 321-340 in go.work.sum:
github.com/Nvveen/Gotty v0.0.0-20120604004816-cd527374f1e5 h1:TngWCqHvy9oXAN6lEVMRuU21PR1EtLVZJmdB18Gu3Rw=
github.com/OneOfOne/xxhash v1.2.6 h1:U68crOE3y3MPttCMQGywZOLrTeF5HHJ3/vDBCJn9/bA=
github.com/OneOfOne/xxhash v1.2.6/go.mod h1:eZbhyaAYD41SGSSsnmcpxVoRiQ/MPUTjUdIIOT9Um7Q=
github.com/PuerkitoBio/goquery v1.8.1 h1:uQxhNlArOIdbrH1tr0UXwdVFgDcZDrZVdcpygAcwmWM=
github.com/PuerkitoBio/goquery v1.8.1/go.mod h1:Q8ICL1kNUJ2sXGoAhPGUdYDJvgQgHzJsnnd3H7Ho5jQ=
github.com/RaveNoX/go-jsoncommentstrip v1.0
---
[Medium] chunk lines 441-460 in go.work.sum:
github.com/cockroachdb/apd v1.1.0 h1:3LFP3629v+1aKXU5Q37mxmRxX/pIu1nijXydLShEq5I=
github.com/cockroachdb/cockroach-go v0.0.0-20181001143604-e0a95dfd547c h1:2zRrJWIt/f9c9HhNHAgrRgq0San5gRRUJTBXLkchal0=
github.com/cockroachdb/datadriven v0.0.0-20190809214429-80d97fb3cbaa h1:OaNxuTZr7kxeODyLWsRMC+OD03aFUH+mW6r2d+MWa5Y=
github.com/cockroachdb/errors v1.9.1 h1:yFVvsI0VxmRShfawbt/laCIDy/mtTqqnvoNgiy5bEV8=
github.com/cockroachdb/errors v1.9.1/go.mod h1:2sxOtL2WIc096WSZqZ5h8fa17rdDq9HZOZLBCor4mBk=
githu
---
[Medium] chunk lines 381-400 in go.work.sum:
github.com/aws/aws-sdk-go-v2/service/kms v1.35.3 h1:UPTdlTOwWUX49fVi7cymEN6hDqCwe3LNv1vi7TXUutk=
github.com/aws/aws-sdk-go-v2/service/kms v1.35.3/go.mod h1:gjDP16zn+WWalyaUqwCCioQ8gU8lzttCCc9jYsiQI/8=
github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.32.4 h1:NgRFYyFpiMD62y4VPXh4DosPFbZd4vdMVBWKk0VmWXc=
github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.32.4/go.mod h1:TKKN7IQoM7uTnyuFm9bm9cw5P//ZYTl4m3htBWQ1G/c=
github.com/aws/aws-sdk-go-v2/service/sns v1.31.3 h1:eSTEdxkfle2G98FE+Xl3db/X
---
[Medium] chunk lines 541-560 in go.work.sum:
github.com/getsentry/sentry-go v0.12.0/go.mod h1:NSap0JBYWzHND8oMbyi0+XZhUalc1TBdRL1M71JZW2c=
github.com/gin-contrib/sse v0.1.0 h1:Y/yl/+YNO8GZSjAhjMsSuLt29uWRFHdHYUb5lYOV9qE=
github.com/gin-contrib/sse v0.1.0/go.mod h1:RHrZQHXnP2xjPF+u1gW/2HnVO7nvIa9PG3Gm+fLHvGI=
github.com/gin-gonic/gin v1.9.1 h1:4idEAncQnU5cB7BeOkPtxjfCSye0AAm1R0RVIqJ+Jmg=
github.com/gin-gonic/gin v1.9.1/go.mod h1:hPrL7YrpYKXt5YId3A/Tnip5kqbEAP+KLuI3SUcPTeU=
github.com/go-faster/city v1.0.1 h1:4WAxSZ3V2Ws4QRDrscLEDcibJY8uf41H
---
[Medium] chunk lines 341-360 in go.work.sum:
github.com/ajstarks/svgo v0.0.0-20211024235047-1546f124cd8b h1:slYM766cy2nI3BwyRiyQj/Ud48djTMtMebDqepE95rw=
github.com/alecthomas/assert/v2 v2.3.0 h1:mAsH2wmvjsuvyBvAmCtm7zFsBlb8mIHx5ySLVdDZXL0=
github.com/alecthomas/kingpin/v2 v2.4.0 h1:f48lwail6p8zpO1bC4TxtqACaGqHYA22qkHjHpqDjYY=
github.com/alecthomas/kong v0.8.0 h1:ryDCzutfIqJPnNn0omnrgHLbAggDQM2VWHikE1xqK7s=
github.com/alecthomas/kong v0.8.0/go.mod h1:n1iCIO2xS46oE8ZfYCNDqdR0b0wZNrXAIAqro/2132U=
github.com/alecthomas/participle/v2 v2.1.1 h1:
---
[Medium] chunk lines 561-580 in go.work.sum:
github.com/go-fonts/liberation v0.3.2/go.mod h1:N0QsDLVUQPy3UYg9XAc3Uh3UDMp2Z7M1o4+X98dXkmI=
github.com/go-fonts/stix v0.1.0 h1:UlZlgrvvmT/58o573ot7NFw0vZasZ5I6bcIft/oMdgg=
github.com/go-fonts/stix v0.2.2 h1:v9krocr13J1llaOHLEol1eaHsv8S43UuFX/1bFgEJJ4=
github.com/go-fonts/stix v0.2.2/go.mod h1:SUxggC9dxd/Q+rb5PkJuvfvTbOPtNc2Qaua00fIp9iU=
github.com/go-gl/glfw v0.0.0-20190409004039-e6da0acd62b1 h1:QbL/5oDUmRBzO9/Z7Seo6zf912W/a6Sr4Eu0G/3Jho0=
github.com/go-gl/glfw/v3.3/glfw v0.0.0-20200222043503-6
---
[Medium] chunk lines 401-420 in go.work.sum:
github.com/blevesearch/snowball v0.6.1 h1:cDYjn/NCH+wwt2UdehaLpr2e4BwLIjN4V/TdLsL+B5A=
github.com/blevesearch/snowball v0.6.1/go.mod h1:ZF0IBg5vgpeoUhnMza2v0A/z8m1cWPlwhke08LpNusg=
github.com/blevesearch/stempel v0.2.0 h1:CYzVPaScODMvgE9o+kf6D4RJ/VRomyi9uHF+PtB+Afc=
github.com/blevesearch/stempel v0.2.0/go.mod h1:wjeTHqQv+nQdbPuJ/YcvOjTInA2EIc6Ks1FoSUzSLvc=
github.com/blevesearch/vellum v1.0.7 h1:+vn8rfyCRHxKVRgDLeR0FAXej2+6mEb5Q15aQE/XESQ=
github.com/blevesearch/vellum v1.0.7/go.mod h1:doBZpmRh
---
[Medium] chunk lines 601-620 in go.work.sum:
github.com/golang/freetype v0.0.0-20170609003504-e2365dfdc4a0 h1:DACJavvAHhabrF08vX0COfcOBJRhZ8lUbR+ZWIs0Y5g=
github.com/golang/glog v1.2.1 h1:OptwRhECazUx5ix5TTWC3EZhsZEHWcYWY4FQHTIubm4=
github.com/golang/glog v1.2.2 h1:1+mZ9upx1Dh6FmUTFR1naJ77miKiXgALjWOZ3NVFPmY=
github.com/golang/glog v1.2.2/go.mod h1:6AhwSGph0fcJtXVM/PEHPqZlFeoLxhs7/t5UDAwmO+w=
github.com/gomarkdown/markdown v0.0.0-20230922112808-5421fefb8386 h1:EcQR3gusLHN46TAD+G+EbaaqJArt5vHhNpXAa12PQf4=
github.com/gomarkdown/markdown v0.0
---
[Medium] chunk lines 621-640 in go.work.sum:
github.com/gorilla/context v1.1.1 h1:AWwleXJkX/nhcU9bZSnZoi3h/qGYqQAGhq6zZe/aQW8=
github.com/gorilla/css v1.0.0 h1:BQqNyPTi50JCFMTw/b67hByjMVXZRwGha6wxVGkeihY=
github.com/gorilla/css v1.0.0/go.mod h1:Dn721qIggHpt4+EFCcTLTU/vk5ySda2ReITrtgBl60c=
github.com/gorilla/handlers v1.5.1 h1:9lRY6j8DEeeBT10CvO9hGW0gmky0BprnvDI5vfhUHH4=
github.com/gorilla/handlers v1.5.1/go.mod h1:t8XrUpc4KVXb7HGyJ4/cEnwQiaxrX/hz1Zv/4g96P1Q=
github.com/gorilla/mux v1.8.0/go.mod h1:DVbg23sWSpFRCP0SfiEN6jmj59UnW/n46BH5rLB71S
---
[Medium] chunk lines 281-300 in go.work.sum:
github.com/Azure/azure-sdk-for-go/sdk/messaging/azservicebus v1.7.1/go.mod h1:6QAMYBAbQeeKX+REFJMZ1nFWu9XLw/PPcjYpuc9RDFs=
github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/internal v1.1.2 h1:mLY+pNLjCUeKhgnAJWAKhEUQM+RJQo2H1fuGSw1Ky1E=
github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/internal/v2 v2.0.0 h1:PTFGRSlMKCQelWwxUyYVEUqseBJVemLyqWJjvMyt0do=
github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/managementgroups/armmanagementgroups v1.0.0 h1:pPvTJ1dY0sA35JOeFq6TsY2xj6Z85Yo23Pj4w
---
[Medium] chunk lines 521-540 in go.work.sum:
github.com/expr-lang/expr v1.16.2 h1:JvMnzUs3LeVHBvGFcXYmXo+Q6DPDmzrlcSBO6Wy3w4s=
github.com/expr-lang/expr v1.16.2/go.mod h1:uCkhfG+x7fcZ5A5sXHKuQ07jGZRl6J0FCAaf2k4PtVQ=
github.com/fatih/color v1.16.0/go.mod h1:fL2Sau1YI5c0pdGEVCbKQbLXB6edEj1ZgiY4NijnWvE=
github.com/fatih/structs v1.1.0 h1:Q7juDM0QtcnhCpeyLGQKyg4TOIghuNXrkL32pHAUMxo=
github.com/fatih/structs v1.1.0/go.mod h1:9NiDSp5zOcgEDl+j00MP/WkGVPOlPRLejGD8Ga6PJ7M=
github.com/felixge/fgprof v0.9.3 h1:VvyZxILNuCiUCSXtPtYmmtGvb65nqXh2QFWc0Wpf
---
[Medium] chunk lines 501-520 in go.work.sum:
github.com/docopt/docopt-go v0.0.0-20180111231733-ee0de3bc6815 h1:bWDMxwH3px2JBh6AyO7hdCn/PkvCZXii8TGj7sbtEbQ=
github.com/drone/drone-runtime v1.1.0 h1:IsKbwiLY6+ViNBzX0F8PERJVZZcEJm9rgxEh3uZP5IE=
github.com/drone/drone-runtime v1.1.0/go.mod h1:+osgwGADc/nyl40J0fdsf8Z09bgcBZXvXXnLOY48zYs=
github.com/drone/drone-yaml v1.2.3 h1:SWzLmzr8ARhbtw1WsVDENa8WFY2Pi9l0FVMfafVUWz8=
github.com/drone/drone-yaml v1.2.3/go.mod h1:QsqliFK8nG04AHFN9tTn9XJomRBQHD4wcejWW1uz/10=
github.com/drone/funcmap v0.0.0-20211
---
[Medium] chunk lines 421-440 in go.work.sum:
github.com/cenkalti/backoff v2.2.1+incompatible h1:tNowT99t7UNflLxfYYSlKYsBpXdEet03Pg2g16Swow4=
github.com/census-instrumentation/opencensus-proto v0.4.1 h1:iKLQ0xPNFxR/2hzXZMrBo8f1j86j5WHzznCCQxV/b8g=
github.com/cespare/xxhash v1.1.0 h1:a6HrQnmkObjyL+Gs60czilIUGqrzKutQD6XZog3p+ko=
github.com/chenzhuoyu/base64x v0.0.0-20230717121745-296ad89f973d h1:77cEq6EriyTZ0g/qfRdp61a3Uu/AWrgIq2s0ClJV1g0=
github.com/chenzhuoyu/base64x v0.0.0-20230717121745-296ad89f973d/go.mod h1:8EPpVsBuRksnlj1mLy4AWzRNQYxau
---
[Medium] chunk lines 701-720 in go.work.sum:
github.com/kelseyhightower/envconfig v1.4.0 h1:Im6hONhd3pLkfDFsbRgu68RDNkGF1r3dvMUtDTo2cv8=
github.com/kevinmbeaulieu/eq-go v1.0.0 h1:AQgYHURDOmnVJ62jnEk0W/7yFKEn+Lv8RHN6t7mB0Zo=
github.com/kevinmbeaulieu/eq-go v1.0.0/go.mod h1:G3S8ajA56gKBZm4UB9AOyoOS37JO3roToPzKNM8dtdM=
github.com/kisielk/errcheck v1.5.0 h1:e8esj/e4R+SAOwFwN+n3zr0nYeCyeweozKfO23MvHzY=
github.com/kisielk/gotool v1.0.0 h1:AV2c/EiW3KqPNT9ZKl07ehoAGi4C5/01Cfbblndcapg=
github.com/kisielk/sqlstruct v0.0.0-20201105191214-5f3e10d3ab46
---
[Medium] chunk lines 481-500 in go.work.sum:
github.com/cznic/strutil v0.0.0-20171016134553-529a34b1c186 h1:0rkFMAbn5KBKNpJyHQ6Prb95vIKanmAe62KxsrN+sqA=
github.com/cznic/zappy v0.0.0-20160723133515-2533cb5b45cc h1:YKKpTb2BrXN2GYyGaygIdis1vXbE7SSAG9axGWIMClg=
github.com/dave/astrid v0.0.0-20170323122508-8c2895878b14 h1:YI1gOOdmMk3xodBao7fehcvoZsEeOyy/cfhlpCSPgM4=
github.com/dave/brenda v1.1.0 h1:Sl1LlwXnbw7xMhq3y2x11McFu43AjDcwkllxxgZ3EZw=
github.com/dave/courtney v0.3.0 h1:8aR1os2ImdIQf3Zj4oro+lD/L4Srb5VwGefqZ/jzz7U=
github.com/dave/gopack
---
[Medium] chunk lines 741-760 in go.work.sum:
github.com/lyft/protoc-gen-validate v0.0.13 h1:KNt/RhmQTOLr7Aj8PsJ7mTronaFyx80mRTT9qF261dA=
github.com/mailgun/raymond/v2 v2.0.48 h1:5dmlB680ZkFG2RN/0lvTAghrSxIESeu9/2aeDqACtjw=
github.com/mailgun/raymond/v2 v2.0.48/go.mod h1:lsgvL50kgt1ylcFJYZiULi5fjPBkkhNfj4KA0W54Z18=
github.com/matryer/moq v0.3.3 h1:pScMH9VyrdT4S93yiLpVyU8rCDqGQr24uOyBxmktG5Q=
github.com/matryer/moq v0.3.3/go.mod h1:RJ75ZZZD71hejp39j4crZLsEDszGk6iH4v4YsWFKH4s=
github.com/matryer/moq v0.5.0 h1:h2PJUYjZSiyEahzVogDRmrgL9Bsx9xYAl
---
[Medium] chunk lines 721-740 in go.work.sum:
github.com/kshvakov/clickhouse v1.3.5 h1:PDTYk9VYgbjPAWry3AoDREeMgOVUFij6bh6IjlloHL0=
github.com/labstack/echo/v4 v4.11.4 h1:vDZmA+qNeh1pd/cCkEicDMrjtrnMGQ1QFI9gWN1zGq8=
github.com/labstack/echo/v4 v4.11.4/go.mod h1:noh7EvLwqDsmh/X/HWKPUl1AjzJrhyptRyEbQJfxen8=
github.com/labstack/gommon v0.4.2 h1:F8qTUNXgG1+6WQmqoUWnz8WiEU60mXVVw0P4ht1WRA0=
github.com/labstack/gommon v0.4.2/go.mod h1:QlUFxVM+SNXhDL/Z7YhocGIBYOiwB0mXm1+1bAPHPyU=
github.com/ledongthuc/pdf v0.0.0-20220302134840-0c2507a12d80 h1:6Yzf
---
[Medium] chunk lines 461-480 in go.work.sum:
github.com/coreos/pkg v0.0.0-20160727233714-3ac0863d7acf h1:CAKfRE2YtTUIjjh1bkBtyYFaUT/WmOqsJjgtihT0vMI=
github.com/couchbase/ghistogram v0.1.0 h1:b95QcQTCzjTUocDXp/uMgSNQi8oj1tGwnJ4bODWZnps=
github.com/couchbase/ghistogram v0.1.0/go.mod h1:s1Jhy76zqfEecpNWJfWUiKZookAFaiGOEoyzgHt9i7k=
github.com/couchbase/moss v0.2.0 h1:VCYrMzFwEryyhRSeI+/b3tRBSeTpi/8gn5Kf6dxqn+o=
github.com/couchbase/moss v0.2.0/go.mod h1:9MaHIaRuy9pvLPUJxB8sh8OrLfyDczECVL37grCIubs=
github.com/cpuguy83/go-md2man v1.0.10 h1:BSKM
---
[Medium] chunk lines 361-380 in go.work.sum:
github.com/antlr/antlr4/runtime/Go/antlr/v4 v4.0.0-20230512164433-5d1fd1a340c9 h1:goHVqTbFX3AIo0tzGr14pgfAW2ZfPChKO21Z9MGf/gk=
github.com/antlr/antlr4/runtime/Go/antlr/v4 v4.0.0-20230512164433-5d1fd1a340c9/go.mod h1:pSwJ0fSY5KhvocuWSx4fz3BA8OrA1bQn+K1Eli3BRwM=
github.com/apache/arrow/go/arrow v0.0.0-20211112161151-bc219186db40 h1:q4dksr6ICHXqG5hm0ZW5IHyeEJXoIJSOZeBLmWPNeIQ=
github.com/apache/arrow/go/arrow v0.0.0-20211112161151-bc219186db40/go.mod h1:Q7yQnSMnLvcXlZ8RV+jwz/6y1rQTqbX6C82SndT52Zs=
","TablesList (High), ReadQuery (High), Execute (Medium), lines 481-500 (Medium), TablesList (Medium), RunCommands (Medium), QueryFramesInto (Medium), NewInMemoryDB (Medium), lines 501-510 (Medium), lines 4621-4640 (Medium), lines 4641-4653 (Medium), lines 381-400 (Medium), lines 221-240 (Medium), lines 461-480 (Medium), lines 241-260 (Medium), lines 361-380 (Medium), lines 321-340 (Medium), lines 421-440 (Medium), lines 281-300 (Medium), lines 261-280 (Medium), lines 441-460 (Medium), lines 301-320 (Medium), lines 341-360 (Medium), lines 401-420 (Medium), lines 141-160 (Medium), lines 161-180 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), lines 3101-3120 (Medium), lines 4561-4580 (Medium), lines 3641-3660 (Medium), lines 1561-1580 (Medium), lines 2681-2700 (Medium), lines 2121-2140 (Medium), lines 2881-2900 (Medium), lines 1901-1920 (Medium), lines 1761-1780 (Medium), lines 3481-3500 (Medium), lines 3801-3820 (Medium), lines 3361-3380 (Medium), lines 4261-4280 (Medium), lines 2061-2080 (Medium), lines 4581-4600 (Medium), lines 1681-1700 (Medium), lines 2301-2320 (Medium), lines 2521-2540 (Medium), lines 3581-3600 (Medium), lines 1481-1500 (Medium), lines 4161-4180 (Medium), lines 1821-1840 (Medium), lines 1661-1680 (Medium), lines 2181-2200 (Medium), lines 2241-2260 (Medium), lines 3501-3520 (Medium), lines 3881-3900 (Medium), lines 4181-4200 (Medium), lines 4221-4240 (Medium), lines 3301-3320 (Medium), lines 4421-4440 (Medium), lines 4401-4420 (Medium), lines 2941-2960 (Medium), lines 3961-3980 (Medium), lines 3981-4000 (Medium), lines 3841-3860 (Medium), lines 2701-2720 (Medium), lines 3521-3540 (Medium), lines 3261-3280 (Medium), lines 1841-1860 (Medium), lines 4481-4500 (Medium), lines 2261-2280 (Medium), lines 3741-3760 (Medium), lines 2721-2740 (Medium), lines 3161-3180 (Medium), lines 2221-2240 (Medium), lines 1601-1620 (Medium), lines 2341-2360 (Medium), lines 1941-1960 (Medium), lines 2621-2640 (Medium), lines 2741-2760 (Medium), lines 1861-1880 (Medium), lines 1521-1540 (Medium), lines 1441-1460 (Medium), lines 3201-3220 (Medium), lines 3241-3260 (Medium), lines 1921-1940 (Medium), lines 2481-2500 (Medium), lines 2081-2100 (Medium), lines 2141-2160 (Medium), lines 4001-4020 (Medium), lines 4361-4380 (Medium), lines 2861-2880 (Medium), lines 2541-2560 (Medium), lines 2641-2660 (Medium), lines 2901-2920 (Medium), lines 2921-2940 (Medium), lines 2441-2460 (Medium), lines 3381-3400 (Medium), lines 3181-3200 (Medium), lines 2961-2980 (Medium), lines 3281-3300 (Medium), lines 3941-3960 (Medium), lines 3561-3580 (Medium), lines 2401-2420 (Medium), lines 2781-2800 (Medium), lines 4121-4140 (Medium), lines 1501-1520 (Medium), lines 3541-3560 (Medium), lines 4041-4060 (Medium), lines 1721-1740 (Medium), lines 2501-2520 (Medium), lines 3061-3080 (Medium), lines 4381-4400 (Medium), lines 1981-2000 (Medium), lines 2201-2220 (Medium), lines 1581-1600 (Medium), lines 4601-4620 (Medium), lines 2361-2380 (Medium), lines 1641-1660 (Medium), lines 3121-3140 (Medium), lines 2161-2180 (Medium), lines 2581-2600 (Medium), lines 4521-4540 (Medium), lines 2321-2340 (Medium), lines 3001-3020 (Medium), lines 4541-4560 (Medium), lines 3081-3100 (Medium), lines 2381-2400 (Medium), lines 2041-2060 (Medium), lines 2601-2620 (Medium), lines 4321-4340 (Medium), lines 2561-2580 (Medium), lines 4241-4260 (Medium), lines 3421-3440 (Medium), lines 3681-3700 (Medium), lines 3041-3060 (Medium), lines 1961-1980 (Medium), lines 2661-2680 (Medium), lines 2981-3000 (Medium), lines 4501-4520 (Medium), lines 3021-3040 (Medium), lines 1781-1800 (Medium), lines 3921-3940 (Medium), lines 3401-3420 (Medium), lines 3721-3740 (Medium), lines 1881-1900 (Medium), lines 1421-1440 (Medium), lines 3821-3840 (Medium), lines 3861-3880 (Medium), lines 3901-3920 (Medium), lines 4141-4160 (Medium), lines 3461-3480 (Medium), lines 2281-2300 (Medium), lines 1741-1760 (Medium), lines 2841-2860 (Medium), lines 4461-4480 (Medium), lines 1461-1480 (Medium), lines 1621-1640 (Medium), lines 2101-2120 (Medium), lines 3661-3680 (Medium), lines 4061-4080 (Medium), lines 1801-1820 (Medium), lines 3341-3360 (Medium), lines 4101-4120 (Medium), lines 2001-2020 (Medium), lines 3221-3240 (Medium), lines 2421-2440 (Medium), lines 3601-3620 (Medium), lines 3321-3340 (Medium), lines 3761-3780 (Medium), lines 4081-4100 (Medium), lines 4341-4360 (Medium), lines 1701-1720 (Medium), lines 2461-2480 (Medium), lines 4021-4040 (Medium), lines 3141-3160 (Medium), lines 3781-3800 (Medium), lines 2801-2820 (Medium), lines 4201-4220 (Medium), lines 3621-3640 (Medium), lines 4281-4300 (Medium), lines 2761-2780 (Medium), lines 3701-3720 (Medium), lines 4301-4320 (Medium), lines 4441-4460 (Medium), lines 2021-2040 (Medium), lines 2821-2840 (Medium), lines 3441-3460 (Medium), lines 1541-1560 (Medium), lines 301-320 (Medium), lines 641-660 (Medium), lines 681-700 (Medium), lines 661-680 (Medium), lines 581-600 (Medium), lines 321-340 (Medium), lines 441-460 (Medium), lines 381-400 (Medium), lines 541-560 (Medium), lines 341-360 (Medium), lines 561-580 (Medium), lines 401-420 (Medium), lines 601-620 (Medium), lines 621-640 (Medium), lines 281-300 (Medium), lines 521-540 (Medium), lines 501-520 (Medium), lines 421-440 (Medium), lines 701-720 (Medium), lines 481-500 (Medium), lines 741-760 (Medium), lines 721-740 (Medium), lines 461-480 (Medium), lines 361-380 (Medium), lines 501-502 (Low), lines 4621-4638 (Low), enableSqlExpressions (Low)",miss,enableSqlExpressions function not in HC entities (TablesList and ReadQuery are HC)
grafana,9,Advanced SQL Analytics Framework,Several methods such as NewInMemoryDB().RunCommands and db.QueryFramesInto return 'not implemented'.,High,215,2,210,"function::TablesList (pkg/expr/sql/parser.go) [High, score=0.64] | method::ReadQuery (pkg/expr/reader.go) [High, score=0.59]","[High] function TablesList in pkg/expr/sql/parser.go:
func TablesList(rawSQL string) ([]string, error) {
	duckDB := NewInMemoryDB()
	rawSQL = strings.Replace(rawSQL, ""'"", ""''"", -1)
	cmd := fmt.Sprintf(""SELECT json_serialize_sql('%s')"", rawSQL)
	ret, err := duckDB.RunCommands([]string{cmd})
	if err != nil {
		logger.Error(""error serializing sql"", ""error"", err.Error(), ""sql"", rawSQL, ""cmd"", cmd)
		return nil, fmt.Errorf(""error serializing sql: %s"", err.Error())
	}

	ast := []map[string]any{}
	err = json.Unmarshal([]byte(ret), &ast)
	if err != nil {
		logger.Error(""error converting json sql to ast"", ""error"", err.Error(), ""ret"", ret)
		return nil, fmt.Errorf(""error converting json to ast: %s"", err.Error())
	}

	return tablesFromAST(ast)
}
---
[High] method ReadQuery in pkg/expr/reader.go:
func (h *ExpressionQueryReader) ReadQuery(
	// Properties that have been parsed off the same node
	common data.DataQuery,
	// An iterator with context for the full node (include common values)
	iter *jsoniter.Iterator,
) (eq ExpressionQuery, err error) {
	referenceVar := """"
	eq.RefID = common.RefID
	eq.QueryType = QueryType(common.GetString(""type""))
	if eq.QueryType == """" {
		return eq, fmt.Errorf(""missing type"")
	}
	switch eq.QueryType {
	case QueryTypeMath:
		q := &MathQuery{}
		err = iter.ReadVal(q)
		if err == nil {
			eq.Command, err = NewMathCommand(common.RefID, q.Expression)
			eq.Properties = q
		}

	case QueryTypeReduce:
		var mapper mathexp.ReduceMapper = nil
		q := &ReduceQuery{}
		err = iter.ReadVal(q)
		if err == nil {
			referenceVar, err = getReferenceVar(q.Expression, comm","[Medium] method Execute in pkg/expr/sql_command.go:
func (gr *SQLCommand) Execute(ctx context.Context, now time.Time, vars mathexp.Vars, tracer tracing.Tracer) (mathexp.Results, error) {
	_, span := tracer.Start(ctx, ""SSE.ExecuteSQL"")
	defer span.End()

	allFrames := []*data.Frame{}
	for _, ref := range gr.varsToQuery {
		results, ok := vars[ref]
		if !ok {
			logger.Warn(""no results found for"", ""ref"", ref)
			continue
		}
		frames := results.Values.AsDataFrames(ref)
		allFrames = append(allFrames, frames...)
	}

	rsp := mathexp.Results{}

	db :=
---
[Medium] chunk lines 481-500 in go.mod:
	github.com/grafana/grafana-app-sdk v0.19.0 // indirect
	github.com/grafana/grafana/pkg/semconv v0.0.0-20240808213237-f4d2e064f435 // indirect
	github.com/grafana/sqlds/v4 v4.1.0 // indirect
	github.com/maypok86/otter v1.2.2 // indirect
	github.com/planetscale/vtprotobuf v0.6.1-0.20240319094008-0393e58bdf10 // indirect
	github.com/shadowspore/fossil-delta v0.0.0-20240102155221-e3a8590b820b // indirect
)

// Use fork of crewjam/saml with fixes for some issues until changes get merged into upstrea
---
[Medium] method TablesList in pkg/expr/sql/db.go:
func (db *DB) TablesList(rawSQL string) ([]string, error) {
	return nil, errors.New(""not implemented"")
}
---
[Medium] method RunCommands in pkg/expr/sql/db.go:
func (db *DB) RunCommands(commands []string) (string, error) {
	return """", errors.New(""not implemented"")
}
---
[Medium] method QueryFramesInto in pkg/expr/sql/db.go:
func (db *DB) QueryFramesInto(name string, query string, frames []*data.Frame, f *data.Frame) error {
	return errors.New(""not implemented"")
}
---
[Medium] function NewInMemoryDB in pkg/expr/sql/db.go:
func NewInMemoryDB() *DB {
	return &DB{}
}
---
[Medium] chunk lines 501-510 in go.mod:
// This is required in order to get notification delivery errors from the receivers API.
replace github.com/prometheus/alertmanager => github.com/grafana/prometheus-alertmanager v0.25.1-0.20240930132144-b5e64e81e8d3

exclude github.com/mattn/go-sqlite3 v2.0.3+incompatible

// Use our fork xorm. go.work currently overrides this and points to the local ./pkg/util/xorm directory.
replace xorm.io/xorm => github.com/grafana/grafana/pkg/util/xorm v0.0.1

// lock for mysql tsdb compat
replace github.co
---
[Medium] chunk lines 4621-4640 in go.sum:
modernc.org/strutil v1.1.3/go.mod h1:MEHNA7PdEnEwLvspRMtWTNnp2nnyvMfkimT1NKNAGbw=
modernc.org/strutil v1.2.0 h1:agBi9dp1I+eOnxXeiZawM8F4LawKv4NzGWSaLfyeNZA=
modernc.org/strutil v1.2.0/go.mod h1:/mdcBmfOibveCTBxUl5B5l6W+TTH1FXPLHZE6bTosX0=
modernc.org/tcl v1.13.1/go.mod h1:XOLfOwzhkljL4itZkK6T72ckMgvj0BDsnKNdZVUOecw=
modernc.org/tcl v1.13.2/go.mod h1:7CLiGIPo1M8Rv1Mitpv5akc2+8fxUd2y2UzC/MfMzy0=
modernc.org/tcl v1.15.1/go.mod h1:aEjeGJX2gz1oWKOLDVZ2tnEWLUrIn8H+GFu+akoDhqs=
modernc.org/token v1.0.0
---
[Medium] chunk lines 4641-4653 in go.sum:
sigs.k8s.io/structured-merge-diff/v4 v4.2.3/go.mod h1:qjx8mGObPmV2aSZepjQjbmb2ihdVs8cGKBraizNC69E=
sigs.k8s.io/structured-merge-diff/v4 v4.4.1 h1:150L+0vs/8DA78h1u02ooW1/fFq/Lwr+sGiqlzvrtq4=
sigs.k8s.io/structured-merge-diff/v4 v4.4.1/go.mod h1:N8hJocpFajUSSeSJ9bOZ77VzejKZaXsTtZo4/u7Io08=
sigs.k8s.io/yaml v1.1.0/go.mod h1:UJmg0vDUVViEyp3mgSv9WPwZCDxu4rQW1olrI1uml+o=
sigs.k8s.io/yaml v1.2.0/go.mod h1:yfXDCHCao9+ENCvLSE62v9VSji2MKu5jeNfTrofGhJc=
sigs.k8s.io/yaml v1.3.0/go.mod h1:GeOyir5tyXNByN85N/
---
[Medium] chunk lines 381-400 in go.mod:
	github.com/prometheus/common/sigv4 v0.1.0 // indirect
	github.com/prometheus/exporter-toolkit v0.11.0 // indirect
	github.com/prometheus/procfs v0.15.1 // indirect
	github.com/protocolbuffers/txtpbfmt v0.0.0-20230328191034-3462fbc510c0 // indirect
	github.com/redis/rueidis v1.0.45 // indirect
	github.com/remyoudompheng/bigfft v0.0.0-20230129092748-24d4a6f8daec // indirect
	github.com/rivo/uniseg v0.4.7 // indirect
	github.com/rs/cors v1.11.1 // @grafana/identity-access-team
	github.com/russross
---
[Medium] chunk lines 221-240 in go.mod:
	github.com/FZambia/eagle v0.1.0 // indirect
	github.com/Masterminds/goutils v1.1.1 // indirect
	github.com/Masterminds/squirrel v1.5.4 // indirect
	github.com/NYTimes/gziphandler v1.1.1 // indirect
	github.com/RoaringBitmap/roaring v1.9.3 // indirect
	github.com/agext/levenshtein v1.2.1 // indirect
	github.com/alecthomas/units v0.0.0-20231202071711-9a357b53e9c9 // indirect
	github.com/alicebob/gopher-json v0.0.0-20200520072559-a9ecdc9d1d3a // indirect
	github.com/antlr4-go/antlr/v4 v4.13.1 // i
---
[Medium] chunk lines 461-480 in go.mod:

require (
	github.com/fxamacker/cbor/v2 v2.7.0 // indirect; indirect0.0.0-20240809095826-8eb5495c0b2a
	github.com/x448/float16 v0.8.4 // indirect
	gopkg.in/evanphx/json-patch.v4 v4.12.0 // indirect
)

require (
	github.com/getkin/kin-openapi v0.127.0 // @grafana/grafana-app-platform-squad
	github.com/grafana/grafana/apps/playlist v0.0.0-20240917082838-e2bce38a7990 // @grafana/grafana-app-platform-squad
)

require github.com/jmespath-community/go-jmespath v1.1.1 // @grafana/identity-access-team

---
[Medium] chunk lines 241-260 in go.mod:
	github.com/blevesearch/segment v0.9.1 // indirect
	github.com/blevesearch/snowballstem v0.9.0 // indirect
	github.com/blevesearch/vellum v1.0.10 // indirect
	github.com/blugelabs/ice v1.0.0 // indirect
	github.com/bufbuild/protocompile v0.4.0 // indirect
	github.com/buger/jsonparser v1.1.1 // indirect
	github.com/caio/go-tdigest v3.1.0+incompatible // indirect
	github.com/cenkalti/backoff/v4 v4.3.0 // indirect
	github.com/centrifugal/protocol v0.13.4 // indirect
	github.com/cespare/xxhash/v2 v2
---
[Medium] chunk lines 361-380 in go.mod:
	github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect
	github.com/mpvl/unique v0.0.0-20150818121801-cbe035fff7de // indirect
	github.com/mschoch/smat v0.2.0 // indirect
	github.com/munnerz/goautoneg v0.0.0-20191010083416-a7dc8b61c822 // indirect
	github.com/mxk/go-flowrate v0.0.0-20140419014527-cca7078d478f // indirect
	github.com/natefinch/wrap v0.2.0 // indirect
	github.com/ncruces/go-strftime v0.1.9 // indirect
	github.com/oapi-codegen/runtime v1.1.1 // indirect
	git
---
[Medium] chunk lines 321-340 in go.mod:
	github.com/jcmturner/aescts/v2 v2.0.0 // indirect
	github.com/jcmturner/dnsutils/v2 v2.0.0 // indirect
	github.com/jcmturner/gofork v1.7.6 // indirect
	github.com/jcmturner/goidentity/v6 v6.0.1 // indirect
	github.com/jcmturner/gokrb5/v8 v8.4.4 // indirect
	github.com/jcmturner/rpc/v2 v2.0.3 // indirect
	github.com/jeremywohl/flatten v1.0.1 // @grafana/grafana-app-platform-squad
	github.com/jessevdk/go-flags v1.5.0 // indirect
	github.com/jhump/protoreflect v1.15.1 // indirect
	github.com/jonbo
---
[Medium] chunk lines 421-440 in go.mod:
	go.etcd.io/etcd/client/pkg/v3 v3.5.14 // indirect
	go.etcd.io/etcd/client/v3 v3.5.14 // indirect
	go.mongodb.org/mongo-driver v1.16.1 // indirect
	go.opencensus.io v0.24.0 // indirect
	go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.55.0 // indirect
	go.opentelemetry.io/otel/metric v1.31.0 // indirect
	go.opentelemetry.io/proto/otlp v1.3.1 // indirect
	go.uber.org/mock v0.4.0 // indirect
	go.uber.org/multierr v1.11.0 // indirect
	go.uber.org/zap v1.27.0 // @grafana/identity-acc
---
[Medium] chunk lines 281-300 in go.mod:
	github.com/go-openapi/swag v0.23.0 // indirect
	github.com/go-openapi/validate v0.24.0 // indirect
	github.com/goccy/go-json v0.10.3 // indirect
	github.com/gofrs/uuid v4.4.0+incompatible // indirect
	github.com/gogo/googleapis v1.4.1 // indirect
	github.com/gogo/status v1.1.1 // indirect
	github.com/golang-jwt/jwt/v5 v5.2.1 // indirect
	github.com/golang-sql/civil v0.0.0-20220223132316-b832511892a9 // indirect
	github.com/golang-sql/sqlexp v0.1.0 // indirect
	github.com/golang/groupcache v0.0.
---
[Medium] chunk lines 261-280 in go.mod:
	github.com/dgryski/go-rendezvous v0.0.0-20200823014737-9f7001d12a5f // indirect
	github.com/docker/go-units v0.5.0 // indirect
	github.com/dustin/go-humanize v1.0.1 // indirect
	github.com/edsrzf/mmap-go v1.1.0 // indirect
	github.com/elazarl/goproxy v0.0.0-20240726154733-8b0c20506380 // indirect
	github.com/emicklei/go-restful/v3 v3.11.0 // indirect
	github.com/emicklei/proto v1.10.0 // indirect
	github.com/envoyproxy/protoc-gen-validate v1.1.0 // indirect
	github.com/facette/natsort v0.0.0-20
---
[Medium] chunk lines 441-460 in go.mod:
	gopkg.in/yaml.v2 v2.4.0 // indirect
	k8s.io/kms v0.31.1 // indirect
	modernc.org/gc/v3 v3.0.0-20240107210532-573471604cb6 // indirect
	modernc.org/libc v1.55.3 // indirect
	modernc.org/mathutil v1.6.0 // indirect
	modernc.org/memory v1.8.0 // indirect
	modernc.org/sqlite v1.33.1 // indirect
	modernc.org/strutil v1.2.0 // indirect
	modernc.org/token v1.1.0 // indirect
	sigs.k8s.io/apiserver-network-proxy/konnectivity-client v0.30.3 // indirect
	sigs.k8s.io/json v0.0.0-20221116044647-bc3834ca7abd
---
[Medium] chunk lines 301-320 in go.mod:
	github.com/grpc-ecosystem/go-grpc-middleware v1.4.0 // indirect
	github.com/grpc-ecosystem/go-grpc-prometheus v1.2.1-0.20191002090509-6af20e3a5340 // indirect; @grafana/plugins-platform-backend
	github.com/grpc-ecosystem/grpc-gateway/v2 v2.22.0 // @grafana/identity-access-team
	github.com/hashicorp/errwrap v1.1.0 // indirect
	github.com/hashicorp/go-immutable-radix v1.3.1 // indirect
	github.com/hashicorp/go-msgpack v0.5.5 // indirect
	github.com/hashicorp/go-sockaddr v1.0.6 // indirect
	github
---
[Medium] chunk lines 341-360 in go.mod:
	github.com/magiconair/properties v1.8.7 // indirect
	github.com/mailru/easyjson v0.7.7 // indirect
	github.com/mattermost/xml-roundtrip-validator v0.1.0 // indirect
	github.com/mattetti/filebuffer v1.0.1 // indirect
	github.com/mattn/go-colorable v0.1.13 // indirect
	github.com/mattn/go-ieproxy v0.0.11 // indirect
	github.com/mattn/go-runewidth v0.0.16 // indirect
	github.com/mfridman/interpolate v0.0.2 // indirect
	github.com/miekg/dns v1.1.59 // indirect
	github.com/mitchellh/copystructure v1
---
[Medium] chunk lines 401-420 in go.mod:
	github.com/spf13/afero v1.11.0 // indirect
	github.com/spf13/cast v1.6.0 // indirect
	github.com/spf13/viper v1.19.0 // indirect
	github.com/stoewer/go-strcase v1.3.0 // indirect
	github.com/stretchr/objx v0.5.2 // indirect
	github.com/subosito/gotenv v1.6.0 // indirect
	github.com/uber/jaeger-client-go v2.30.0+incompatible // indirect
	github.com/uber/jaeger-lib v2.4.1+incompatible // indirect
	github.com/unknwon/bra v0.0.0-20200517080246-1e3013ecaff8 // indirect
	github.com/unknwon/com v1.0.1
---
[Medium] chunk lines 141-160 in go.mod:
	github.com/prometheus/prometheus v1.8.2-0.20221021121301-51a44e6657c3 // @grafana/alerting-backend
	github.com/redis/go-redis/v9 v9.1.0 // @grafana/alerting-backend
	github.com/robfig/cron/v3 v3.0.1 // @grafana/grafana-backend-group
	github.com/russellhaering/goxmldsig v1.4.0 // @grafana/grafana-backend-group
	github.com/spf13/cobra v1.8.1 // @grafana/grafana-app-platform-squad
	github.com/spf13/pflag v1.0.5 // @grafana-app-platform-squad
	github.com/spyzhov/ajson v0.9.0 // @grafana/grafana-app
---
[Medium] chunk lines 161-180 in go.mod:
	go.opentelemetry.io/contrib/samplers/jaegerremote v0.25.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel v1.31.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel/exporters/jaeger v1.17.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.31.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.31.0 // @grafana/grafana-backend-group
	go.opentelemetry.io/otel/sdk v1.31.0 // @grafana/graf
---
[Medium] chunk lines 181-200 in go.mod:
	google.golang.org/api v0.191.0 // @grafana/grafana-backend-group
	google.golang.org/grpc v1.67.1 // @grafana/plugins-platform-backend
	google.golang.org/protobuf v1.35.1 // @grafana/plugins-platform-backend
	gopkg.in/ini.v1 v1.67.0 // @grafana/alerting-backend
	gopkg.in/mail.v2 v2.3.1 // @grafana/grafana-backend-group
	gopkg.in/yaml.v3 v3.0.1 // @grafana/alerting-backend
	k8s.io/api v0.31.1 // @grafana/grafana-app-platform-squad
	k8s.io/apimachinery v0.31.1 // @grafana/grafana-app-platform-squa
---
[Medium] chunk lines 201-220 in go.mod:

require (
	cloud.google.com/go v0.115.0 // indirect
	cloud.google.com/go/auth v0.8.1 // indirect
	cloud.google.com/go/auth/oauth2adapt v0.2.4 // indirect
	cloud.google.com/go/compute/metadata v0.5.0 // indirect
	cloud.google.com/go/iam v1.1.13 // indirect
	github.com/Azure/azure-pipeline-go v0.2.3 // indirect
	github.com/Azure/azure-sdk-for-go/sdk/azcore v1.14.0 // indirect
	github.com/Azure/azure-sdk-for-go/sdk/internal v1.10.0 // indirect
	github.com/Azure/azure-sdk-for-go/sdk/keyvault/intern
---
[Medium] chunk lines 3101-3120 in go.sum:
github.com/spf13/afero v1.10.0/go.mod h1:UBogFpq8E9Hx+xc5CNTTEpTnuHVmXDwZcZcE1eb/UhQ=
github.com/spf13/afero v1.11.0 h1:WJQKhtpdm3v2IzqG8VMqrr6Rf3UYpEF239Jy9wNepM8=
github.com/spf13/afero v1.11.0/go.mod h1:GH9Y3pIexgf1MTIWtNGyogA5MwRIDXGUr+hbWNoBjkY=
github.com/spf13/cast v1.3.0/go.mod h1:Qx5cxh0v+4UWYiBimWS+eyWzqEqokIECu5etghLkUJE=
github.com/spf13/cast v1.3.1/go.mod h1:Qx5cxh0v+4UWYiBimWS+eyWzqEqokIECu5etghLkUJE=
github.com/spf13/cast v1.5.0/go.mod h1:SpXXQ5YoyJw6s3/6cMTQuxvgRl3PCJiyaX9p6b155U
---
[Medium] chunk lines 4561-4580 in go.sum:
modernc.org/gc/v2 v2.4.1/go.mod h1:wzN5dK1AzVGoH6XOzc3YZ+ey/jPgYHLuVckd62P0GYU=
modernc.org/gc/v3 v3.0.0-20240107210532-573471604cb6 h1:5D53IMaUuA5InSeMu9eJtlQXS2NxAhyWQvkKEgXZhHI=
modernc.org/gc/v3 v3.0.0-20240107210532-573471604cb6/go.mod h1:Qz0X07sNOR1jWYCrJMEnbW/X55x206Q7Vt4mz6/wHp4=
modernc.org/httpfs v1.0.6/go.mod h1:7dosgurJGp0sPaRanU53W4xZYKh14wfzX420oZADeHM=
modernc.org/libc v0.0.0-20220428101251-2d5f3daf273b/go.mod h1:p7Mg4+koNjc8jkqwcoFBJx7tXkpj00G77X7A72jXPXA=
modernc.org/libc v1.16.
---
[Medium] chunk lines 3641-3660 in go.sum:
golang.org/x/oauth2 v0.0.0-20220622183110-fd043fe589d2/go.mod h1:jaDAt6Dkxork7LmZnYtzbRWj0W47D86a3TGe0YHBvmE=
golang.org/x/oauth2 v0.0.0-20220822191816-0ebed06d0094/go.mod h1:h4gKUeWbJ4rQPri7E0u6Gs4e9Ri2zaLxzw5DI5XGrYg=
golang.org/x/oauth2 v0.0.0-20220909003341-f21342109be1/go.mod h1:h4gKUeWbJ4rQPri7E0u6Gs4e9Ri2zaLxzw5DI5XGrYg=
golang.org/x/oauth2 v0.0.0-20221006150949-b44042a4b9c1/go.mod h1:h4gKUeWbJ4rQPri7E0u6Gs4e9Ri2zaLxzw5DI5XGrYg=
golang.org/x/oauth2 v0.0.0-20221014153046-6fdb5e3db783/go.mo
---
[Medium] chunk lines 1561-1580 in go.sum:
github.com/aws/aws-sdk-go-v2/internal/configsources v1.3.15/go.mod h1:U9ke74k1n2bf+RIgoX1SXFed1HLs51OgUSs+Ph0KJP8=
github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.6.15 h1:C6WHdGnTDIYETAm5iErQUiVNsclNx9qbJVPIt03B6bI=
github.com/aws/aws-sdk-go-v2/internal/endpoints/v2 v2.6.15/go.mod h1:ZQLZqhcu+JhSrA9/NXRm8SkDvsycE+JkV3WGY41e+IM=
github.com/aws/aws-sdk-go-v2/internal/ini v1.8.0 h1:hT8rVHwugYE2lEfdFE0QWVo81lF7jMrYJVDWI+f+VxU=
github.com/aws/aws-sdk-go-v2/internal/ini v1.8.0/go.mod h1:8tu/lYfQ
---
[Medium] chunk lines 2681-2700 in go.sum:
github.com/minio/highwayhash v1.0.1/go.mod h1:BQskDq+xkJ12lmlUUi7U0M5Swg3EWR+dLTk+kldvVxY=
github.com/minio/highwayhash v1.0.2/go.mod h1:BQskDq+xkJ12lmlUUi7U0M5Swg3EWR+dLTk+kldvVxY=
github.com/minio/md5-simd v1.1.2 h1:Gdi1DZK69+ZVMoNHRXJyNcxrMA4dSxoYHZSQbirFg34=
github.com/minio/md5-simd v1.1.2/go.mod h1:MzdKDxYpY2BT9XQFocsiZf/NKVtR7nkE4RoEpN+20RM=
github.com/minio/minio-go/v7 v7.0.63 h1:GbZ2oCvaUdgT5640WJOpyDhhDxvknAJU2/T3yurwcbQ=
github.com/minio/minio-go/v7 v7.0.63/go.mod h1:Q6X7Qjb7WMhvG65qK
---
[Medium] chunk lines 2121-2140 in go.sum:
github.com/google/go-cmp v0.2.0/go.mod h1:oXzfMopK8JAjlY9xF4vHSVASa0yLyX7SntLO5aqRK0M=
github.com/google/go-cmp v0.3.0/go.mod h1:8QqcDgzrUqlUb/G2PQTWiueGozuR1884gddMywk6iLU=
github.com/google/go-cmp v0.3.1/go.mod h1:8QqcDgzrUqlUb/G2PQTWiueGozuR1884gddMywk6iLU=
github.com/google/go-cmp v0.4.0/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=
github.com/google/go-cmp v0.4.1/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V22dbkXbowE6jgT/gNBxE=
github.com/google/go-cmp v0.5.0/go.mod h1:v8dTdLbMG2kIc/vJvl+f65V
---
[Medium] chunk lines 2881-2900 in go.sum:
github.com/patrickmn/go-cache v2.1.0+incompatible h1:HRMgzkcYKYpi3C8ajMPV8OFXaaRUnok+kx1WdO15EQc=
github.com/patrickmn/go-cache v2.1.0+incompatible/go.mod h1:3Qf8kWWT7OJRJbdiICTKqZju1ZixQ/KpMGzzAfe6+WQ=
github.com/pbnjay/memory v0.0.0-20210728143218-7b4eea64cf58/go.mod h1:DXv8WO4yhMYhSNPKjeNKa5WY9YCIEBRbNzFFPJbWO6Y=
github.com/pborman/getopt v0.0.0-20170112200414-7148bc3a4c30/go.mod h1:85jBQOZwpVEaDAr341tbn15RS4fCAsIst0qp7i8ex1o=
github.com/pborman/uuid v1.2.0/go.mod h1:X/NO0urCmaxf9VXbdlT7C2Yzk
---
[Medium] chunk lines 1901-1920 in go.sum:
github.com/go-fonts/dejavu v0.1.0/go.mod h1:4Wt4I4OU2Nq9asgDCteaAaWZOV24E+0/Pwo0gppep4g=
github.com/go-fonts/latin-modern v0.2.0/go.mod h1:rQVLdDMK+mK1xscDwsqM5J8U2jrRa3T0ecnM9pNujks=
github.com/go-fonts/liberation v0.1.1/go.mod h1:K6qoJYypsmfVjWg8KOVDQhLc8UDgIK2HYqyqAO9z7GY=
github.com/go-fonts/liberation v0.2.0/go.mod h1:K6qoJYypsmfVjWg8KOVDQhLc8UDgIK2HYqyqAO9z7GY=
github.com/go-fonts/stix v0.1.0/go.mod h1:w/c1f0ldAUlJmLBvlbkvVXLAD+tAMqobIIQpmnUIzUY=
github.com/go-gl/glfw v0.0.0-20190409004039
---
[Medium] chunk lines 1761-1780 in go.sum:
github.com/dave/jennifer v1.6.0 h1:MQ/6emI2xM7wt0tJzJzyUik2Q3Tcn2eE0vtYgh4GPVI=
github.com/dave/jennifer v1.6.0/go.mod h1:AxTG893FiZKqxy3FP1kL80VMshSMuz2G+EgvszgGRnk=
github.com/dave/kerr v0.0.0-20170318121727-bc25dd6abe8e/go.mod h1:qZqlPyPvfsDJt+3wHJ1EvSXDuVjFTK0j2p/ca+gtsb8=
github.com/dave/patsy v0.0.0-20210517141501-957256f50cba/go.mod h1:qfR88CgEGLoiqDaE+xxDCi5QA5v4vUoW0UCX2Nd5Tlc=
github.com/dave/rebecca v0.9.1/go.mod h1:N6XYdMD/OKw3lkF3ywh8Z6wPGuwNFDNtWYEMFWEmXBA=
github.com/davecgh/go-sp
---
[Medium] chunk lines 3481-3500 in go.sum:
golang.org/x/lint v0.0.0-20190409202823-959b441ac422/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=
golang.org/x/lint v0.0.0-20190909230951-414d861bb4ac/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=
golang.org/x/lint v0.0.0-20190930215403-16217165b5de/go.mod h1:6SW0HCj/g11FgYtHlgUYUwCkIfeOF89ocIRzGO/8vkc=
golang.org/x/lint v0.0.0-20191125180803-fdd1cda4f05f/go.mod h1:5qLYkcX4OjUUV8bRuDixDT3tpyyb+LUpUlRWLxfhWrs=
golang.org/x/lint v0.0.0-20200130185559-910be7a94367/go.mod h1:3xt1F
---
[Medium] chunk lines 3801-3820 in go.sum:
golang.org/x/sys v0.0.0-20220624220833-87e55d714810/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220704084225-05e143d24a9e/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220722155257-8c9f86f7a55f/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20220728004956-3c1f35247d10/go.mod h1:oPkhp1MJrh
---
[Medium] chunk lines 3361-3380 in go.sum:
go.uber.org/atomic v1.5.0/go.mod h1:sABNBOSYdrvTF6hTgEIbc7YasKWGhgEQZyfxyTvoXHQ=
go.uber.org/atomic v1.7.0/go.mod h1:fEN4uk6kAWBTFdckzkM89CLk9XfWZrxpCo0nPH17wJc=
go.uber.org/atomic v1.9.0/go.mod h1:fEN4uk6kAWBTFdckzkM89CLk9XfWZrxpCo0nPH17wJc=
go.uber.org/atomic v1.11.0 h1:ZvwS0R+56ePWxUNi+Atn9dWONBPp/AUETXlHW0DxSjE=
go.uber.org/atomic v1.11.0/go.mod h1:LUxbIzbOniOlMKjJjyPfpl4v+PKK2cNJn91OQbhoJI0=
go.uber.org/automaxprocs v1.5.3/go.mod h1:eRbA25aqJrxAbsLO0xy5jVwPt7FQnRgjW+efnwa1WM0=
go.uber.org/g
---
[Medium] chunk lines 4261-4280 in go.sum:
google.golang.org/genproto v0.0.0-20240102182953-50ed04b92917/go.mod h1:pZqR+glSb11aJ+JQcczCvgf47+duRuzNSKqE8YAQnV0=
google.golang.org/genproto v0.0.0-20240116215550-a9fa1716bcac/go.mod h1:+Rvu7ElI+aLzyDQhpHMFMMltsD6m7nqpuWDd2CwJw3k=
google.golang.org/genproto v0.0.0-20240123012728-ef4313101c80/go.mod h1:cc8bqMqtv9gMOr0zHg2Vzff5ULhhL2IXP4sbcn32Dro=
google.golang.org/genproto v0.0.0-20240125205218-1f4bbc51befe/go.mod h1:cc8bqMqtv9gMOr0zHg2Vzff5ULhhL2IXP4sbcn32Dro=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 2061-2080 in go.sum:
github.com/golang/glog v1.0.0/go.mod h1:EWib/APOK0SL3dFbYqvxE3UYd8E6s1ouQ7iEp/0LWV4=
github.com/golang/glog v1.1.0/go.mod h1:pfYeQZ3JWZoXTV5sFc986z3HTpwQs9At6P4ImfuP3NQ=
github.com/golang/glog v1.1.2/go.mod h1:zR+okUeTbrL6EL3xHUDxZuEtGv04p5shwip1+mL/rLQ=
github.com/golang/glog v1.2.0/go.mod h1:6AhwSGph0fcJtXVM/PEHPqZlFeoLxhs7/t5UDAwmO+w=
github.com/golang/groupcache v0.0.0-20160516000752-02826c3e7903/go.mod h1:cIg4eruTrX1D+g88fzRXU5OdNfaM+9IcxsU14FzY7Hc=
github.com/golang/groupcache v0.0.0-20190
---
[Medium] chunk lines 4581-4600 in go.sum:
modernc.org/libc v1.55.3/go.mod h1:qFXepLhz+JjFThQ4kzwzOjA/y/artDeg+pcYnY+Q83w=
modernc.org/mathutil v1.2.2/go.mod h1:mZW8CKdRPY1v87qxC/wUdX5O1qDzXMP5TH3wjfpga6E=
modernc.org/mathutil v1.4.1/go.mod h1:mZW8CKdRPY1v87qxC/wUdX5O1qDzXMP5TH3wjfpga6E=
modernc.org/mathutil v1.5.0/go.mod h1:mZW8CKdRPY1v87qxC/wUdX5O1qDzXMP5TH3wjfpga6E=
modernc.org/mathutil v1.6.0 h1:fRe9+AmYlaej+64JsEEhoWuAYBkOtQiMEU7n/XgfYi4=
modernc.org/mathutil v1.6.0/go.mod h1:Ui5Q9q1TR2gFm0AQRqQUaBWFLAhQpCwNcuhBOSedWPo=
modernc.org/
---
[Medium] chunk lines 1681-1700 in go.sum:
github.com/chzyer/logex v1.2.1/go.mod h1:JLbx6lG2kDbNRFnfkgvh4eRJRPX1QCoOIWomwysCBrQ=
github.com/chzyer/readline v0.0.0-20180603132655-2972be24d48e/go.mod h1:nSuG5e5PlCu98SY8svDHJxuZscDgtXS6KTTbou5AhLI=
github.com/chzyer/readline v1.5.0/go.mod h1:x22KAscuvRqlLoK9CsoYsmxoXZMMFVyOl86cAH8qUic=
github.com/chzyer/readline v1.5.1/go.mod h1:Eh+b79XXUwfKfcPLepksvw2tcLE/Ct21YObkaSkeBlk=
github.com/chzyer/test v0.0.0-20180213035817-a1ea475d72b1/go.mod h1:Q3SI9o4m/ZMnBNeIyt5eFwwo7qiLfzFZmjNmxjkiQlU=
github
---
[Medium] chunk lines 2301-2320 in go.sum:
github.com/grafana/grafana/pkg/util/xorm v0.0.1/go.mod h1:eNfbB9f2jM8o9RfwqwjY8SYm5tvowJ8Ly+iE4P9rXII=
github.com/grafana/otel-profiling-go v0.5.1 h1:stVPKAFZSa7eGiqbYuG25VcqYksR6iWvF3YH66t4qL8=
github.com/grafana/otel-profiling-go v0.5.1/go.mod h1:ftN/t5A/4gQI19/8MoWurBEtC6gFw8Dns1sJZ9W4Tls=
github.com/grafana/prometheus-alertmanager v0.25.1-0.20240930132144-b5e64e81e8d3 h1:6D2gGAwyQBElSrp3E+9lSr7k8gLuP3Aiy20rweLWeBw=
github.com/grafana/prometheus-alertmanager v0.25.1-0.20240930132144-b5e64e81e
---
[Medium] chunk lines 2521-2540 in go.sum:
github.com/josharian/intern v1.0.0 h1:vlS4z54oSdjm0bgjRigI+G1HpF+tI+9rE5LLzOg8HmY=
github.com/josharian/intern v1.0.0/go.mod h1:5DoeVV0s6jJacbCEi61lwdGj/aVlrQvzHFFd8Hwg//Y=
github.com/jpillora/backoff v1.0.0 h1:uvFg412JmmHBHw7iwprIxkPMI+sGQ4kzOWsMeHnm2EA=
github.com/jpillora/backoff v1.0.0/go.mod h1:J/6gKK9jxlEcS3zixgDgUAsiuZ7yrSoa/FX5e0EB2j4=
github.com/json-iterator/go v1.1.6/go.mod h1:+SdeFBvtyEkXs7REEP0seUULqWtbJapLOCVDaaPEHmU=
github.com/json-iterator/go v1.1.7/go.mod h1:KdQUCv79m/52Kvf8AW2
---
[Medium] chunk lines 3581-3600 in go.sum:
golang.org/x/net v0.0.0-20220225172249-27dd8689420f/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=
golang.org/x/net v0.0.0-20220325170049-de3da57026de/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=
golang.org/x/net v0.0.0-20220412020605-290c469a71a5/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=
golang.org/x/net v0.0.0-20220425223048-2871e0cb64e4/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=
golang.org/x/net v0.0.0-20220520000938-2e3eb7b945c2/go.mod h1:CfG3xpIq0w
---
[Medium] chunk lines 1481-1500 in go.sum:
github.com/alecthomas/participle/v2 v2.0.0/go.mod h1:rAKZdJldHu8084ojcWevWAL8KmEU+AT+Olodb+WoN2Y=
github.com/alecthomas/participle/v2 v2.1.0/go.mod h1:Y1+hAs8DHPmc3YUFzqllV+eSQ9ljPTk0ZkPMtEdAx2c=
github.com/alecthomas/repr v0.2.0/go.mod h1:Fr0507jx4eOXV7AlPV6AVZLYrLIuIeSOWtW57eE/O/4=
github.com/alecthomas/template v0.0.0-20160405071501-a0175ee3bccc/go.mod h1:LOuyumcjzFXgccqObfd/Ljyb9UuFJ6TxHnclSeseNhc=
github.com/alecthomas/template v0.0.0-20190718012654-fb15b899a751/go.mod h1:LOuyumcjzFXgccqObf
---
[Medium] chunk lines 4161-4180 in go.sum:
google.golang.org/genproto v0.0.0-20210917145530-b395a37504d4/go.mod h1:eFjDcFEctNawg4eG61bRv87N7iHBWyVhJu7u1kqDUXY=
google.golang.org/genproto v0.0.0-20210924002016-3dee208752a0/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=
google.golang.org/genproto v0.0.0-20211008145708-270636b82663/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=
google.golang.org/genproto v0.0.0-20211028162531-8db9c33dc351/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 1821-1840 in go.sum:
github.com/emicklei/go-restful/v3 v3.8.0/go.mod h1:6n3XBCmQQb25CM2LCACGz8ukIrRry+4bhvbpWn3mrbc=
github.com/emicklei/go-restful/v3 v3.11.0 h1:rAQeMHw1c7zTmncogyy8VvRZwtkmkZ4FxERmMY4rD+g=
github.com/emicklei/go-restful/v3 v3.11.0/go.mod h1:6n3XBCmQQb25CM2LCACGz8ukIrRry+4bhvbpWn3mrbc=
github.com/emicklei/proto v1.10.0 h1:pDGyFRVV5RvV+nkBK9iy3q67FBy9Xa7vwrOTE+g5aGw=
github.com/emicklei/proto v1.10.0/go.mod h1:rn1FgRS/FANiZdD2djyH7TMA9jdRDcYQ9IEN9yvjX0A=
github.com/emirpasic/gods v1.18.1 h1:FXtiHYKDG
---
[Medium] chunk lines 1661-1680 in go.sum:
github.com/census-instrumentation/opencensus-proto v0.4.1/go.mod h1:4T9NM4+4Vw91VeyqjLS6ao50K5bOcLKN6Q42XnYaRYw=
github.com/centrifugal/centrifuge v0.33.3 h1:uyqBc27oM+qnC3NX5imvZxuk9+u2ze6QGWHDICZeoSc=
github.com/centrifugal/centrifuge v0.33.3/go.mod h1:GaOF4CiREY5x6lW7zYUz46Qrc6aUZ6J/AMV/kROc2+U=
github.com/centrifugal/protocol v0.13.4 h1:I0YxXtFNfn/ndDIZp5RkkqQcSSNH7DNPUbXKYtJXDzs=
github.com/centrifugal/protocol v0.13.4/go.mod h1:7V5vI30VcoxJe4UD87xi7bOsvI0bmEhvbQuMjrFM2L4=
github.com/cespar
---
[Medium] chunk lines 2181-2200 in go.sum:
github.com/google/s2a-go v0.1.8 h1:zZDs9gcbt9ZPLV0ndSyQk6Kacx2g/X+SKYovpnz3SMM=
github.com/google/s2a-go v0.1.8/go.mod h1:6iNWHTpQ+nfNRN5E00MSdfDwVesa8hhS32PhPO8deJA=
github.com/google/subcommands v1.2.0/go.mod h1:ZjhPrFU+Olkh9WazFPsl27BQ4UPiG37m3yTrtFlrHVk=
github.com/google/uuid v1.0.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=
github.com/google/uuid v1.1.1/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=
github.com/google/uuid v1.1.2/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOe
---
[Medium] chunk lines 2241-2260 in go.sum:
github.com/gorilla/websocket v0.0.0-20170926233335-4201258b820c/go.mod h1:E7qHFY5m1UJ88s3WnNqhKjPHQ0heANvMoAMk2YaljkQ=
github.com/gorilla/websocket v1.4.2/go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU/adAjf1fMHhE=
github.com/gorilla/websocket v1.5.0 h1:PPwGk2jz7EePpoHN/+ClbZu8SPxiqlu12wZP/3sWmnc=
github.com/gorilla/websocket v1.5.0/go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU/adAjf1fMHhE=
github.com/grafana/alerting v0.0.0-20241010165806-807ddf183724 h1:u+ZM5TLkdeEoSWXgYWxc4XRfPHhXpR63MyHXJxbBLrc=
gith
---
[Medium] chunk lines 3501-3520 in go.sum:
golang.org/x/mod v0.5.1/go.mod h1:5OXOZSfqPIIbmVBIIKWRFfZjPR0E5r58TLhUjH0a2Ro=
golang.org/x/mod v0.6.0-dev.0.20211013180041-c96bc1413d57/go.mod h1:3p9vT2HGsQu2K1YbXdKPJLVgG5VJdoTa1poYQBtP1AY=
golang.org/x/mod v0.6.0-dev.0.20220106191415-9b9b3d81d5e3/go.mod h1:3p9vT2HGsQu2K1YbXdKPJLVgG5VJdoTa1poYQBtP1AY=
golang.org/x/mod v0.6.0-dev.0.20220419223038-86c51ed26bb4/go.mod h1:jJ57K6gSWd91VN4djpZkiMVwK6gcyfeH4XE8wZrZaV4=
golang.org/x/mod v0.6.0/go.mod h1:4mET923SAdbXp2ki8ey+zGs1SLqsuM2Y0uvdZR/fUNI=
gol
---
[Medium] chunk lines 3881-3900 in go.sum:
golang.org/x/time v0.0.0-20200416051211-89c76fbcd5d1/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.0.0-20210723032227-1f47c861a9ac/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.0.0-20220922220347-f3bd1da661af/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.1.0/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/time v0.3.0/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
golang.org/x/tim
---
[Medium] chunk lines 4181-4200 in go.sum:
google.golang.org/genproto v0.0.0-20220429170224-98d788798c3e/go.mod h1:8w6bsBMX6yCPbAVTeqQHvzxW0EIFigd5lZyahWgyfDo=
google.golang.org/genproto v0.0.0-20220502173005-c8bf987b8c21/go.mod h1:RAyBrSAP7Fh3Nc84ghnVLDPuV51xc9agzmm4Ph6i0Q4=
google.golang.org/genproto v0.0.0-20220505152158-f39f71e6c8f3/go.mod h1:RAyBrSAP7Fh3Nc84ghnVLDPuV51xc9agzmm4Ph6i0Q4=
google.golang.org/genproto v0.0.0-20220518221133-4f43b3371335/go.mod h1:RAyBrSAP7Fh3Nc84ghnVLDPuV51xc9agzmm4Ph6i0Q4=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 4221-4240 in go.sum:
google.golang.org/genproto v0.0.0-20230110181048-76db0878b65f/go.mod h1:RGgjbofJ8xD9Sq1VVhDM1Vok1vRONV+rg+CjzG4SZKM=
google.golang.org/genproto v0.0.0-20230112194545-e10362b5ecf9/go.mod h1:RGgjbofJ8xD9Sq1VVhDM1Vok1vRONV+rg+CjzG4SZKM=
google.golang.org/genproto v0.0.0-20230113154510-dbe35b8444a5/go.mod h1:RGgjbofJ8xD9Sq1VVhDM1Vok1vRONV+rg+CjzG4SZKM=
google.golang.org/genproto v0.0.0-20230123190316-2c411cf9d197/go.mod h1:RGgjbofJ8xD9Sq1VVhDM1Vok1vRONV+rg+CjzG4SZKM=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 3301-3320 in go.sum:
go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.55.0 h1:ZIg3ZT/aQ7AfKqdwp7ECpOK6vHqquXXuyTjIO8ZdmPs=
go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.55.0/go.mod h1:DQAwmETtZV00skUwgD6+0U89g80NKsJE3DCKeLLPQMI=
go.opentelemetry.io/contrib/propagators/jaeger v1.29.0 h1:+YPiqF5rR6PqHBlmEFLPumbSP0gY0WmCGFayXRcCLvs=
go.opentelemetry.io/contrib/propagators/jaeger v1.29.0/go.mod h1:6PD7q7qquWSp3Z4HeM3e/2ipRubaY1rXZO8NIHVDZjs=
go.opentelemetry.io/contrib/samplers/jaegerr
---
[Medium] chunk lines 4421-4440 in go.sum:
google.golang.org/protobuf v1.21.0/go.mod h1:47Nbq4nVaFHyn7ilMalzfO3qCViNmqZ2kzikPIcrTAo=
google.golang.org/protobuf v1.22.0/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=
google.golang.org/protobuf v1.23.0/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=
google.golang.org/protobuf v1.23.1-0.20200526195155-81db48ad09cc/go.mod h1:EGpADcykh3NcUnDUJcl1+ZksZNG86OlYog2l/sGQquU=
google.golang.org/protobuf v1.24.0/go.mod h1:r/3tXBNzIEhYS9I1OUVjXDlt8tc493IdKGjtUeSXeh4=
google.golang.org/pr
---
[Medium] chunk lines 4401-4420 in go.sum:
google.golang.org/grpc v1.57.0/go.mod h1:Sd+9RMTACXwmub0zcNY2c4arhtrbBYD1AUHI/dt16Mo=
google.golang.org/grpc v1.58.2/go.mod h1:tgX3ZQDlNJGU96V6yHh1T/JeoBQ2TXdr43YbYSsCJk0=
google.golang.org/grpc v1.58.3/go.mod h1:tgX3ZQDlNJGU96V6yHh1T/JeoBQ2TXdr43YbYSsCJk0=
google.golang.org/grpc v1.59.0/go.mod h1:aUPDwccQo6OTjy7Hct4AfBPD1GptF4fyUjIkQ9YtF98=
google.golang.org/grpc v1.60.0/go.mod h1:OlCHIeLYqSSsLi6i49B5QGdzaMZK9+M7LXN2FKz4eGM=
google.golang.org/grpc v1.60.1/go.mod h1:OlCHIeLYqSSsLi6i49B5QGdzaMZK9
---
[Medium] chunk lines 2941-2960 in go.sum:
github.com/prometheus/client_golang v1.15.1/go.mod h1:e9yaBhRPU2pPNsZwE+JdQl0KEt1N9XgF6zxWmaC0xOk=
github.com/prometheus/client_golang v1.17.0/go.mod h1:VeL+gMmOAxkS2IqfCq0ZmHSL+LjWfWDUmp1mBz9JgUY=
github.com/prometheus/client_golang v1.18.0/go.mod h1:T+GXkCk5wSJyOqMIzVgvvjFDlkOQntgjkJWKrN5txjA=
github.com/prometheus/client_golang v1.19.0/go.mod h1:ZRM9uEAypZakd+q/x7+gmsvXdURP+DABIEIjnmDdp+k=
github.com/prometheus/client_golang v1.20.4 h1:Tgh3Yr67PaOv/uTqloMsCEdeuFTatm5zIq5+qNN23vI=
github.com/p
---
[Medium] chunk lines 3961-3980 in go.sum:
golang.org/x/tools v0.1.9/go.mod h1:nABZi5QlRsZVlzPpHl034qft6wpY4eDcsTt5AaioBiU=
golang.org/x/tools v0.1.10/go.mod h1:Uh6Zz+xoGYZom868N8YTex3t7RhtHDBrE8Gzo9bV56E=
golang.org/x/tools v0.1.12/go.mod h1:hNGJHUnrk76NpqgfD5Aqm5Crs+Hm0VOH/i9J2+nxYbc=
golang.org/x/tools v0.2.0/go.mod h1:y4OqIKeOV/fWJetJ8bXPU1sEVniLMIyDAZWeHdV+NTA=
golang.org/x/tools v0.3.0/go.mod h1:/rWhSS2+zyEVwoJf8YAX6L2f0ntZ7Kn/mGgAWcipA5k=
golang.org/x/tools v0.4.0/go.mod h1:UE5sM2OK9E/d67R0ANs2xJizIymRP5gJU295PvKXxjQ=
golang.org/x
---
[Medium] chunk lines 3981-4000 in go.sum:
golang.org/x/tools v0.20.0/go.mod h1:WvitBU7JJf6A4jOdg4S1tviW9bhUxkgeCui/0JHctQg=
golang.org/x/tools v0.24.0 h1:J1shsA93PJUEVaUSaay7UXAyE8aimq3GW0pjlolpa24=
golang.org/x/tools v0.24.0/go.mod h1:YhNqVBIfWHdzvTLs0d8LCuMhkKUgSUKldakyV7W/WDQ=
golang.org/x/xerrors v0.0.0-20190717185122-a985d3407aa7/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
golang.org/x/xerrors v0.0.0-20191011141410-1b5146add898/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
golang.org/x/xerrors v0.0.0-20191204190
---
[Medium] chunk lines 3841-3860 in go.sum:
golang.org/x/term v0.9.0/go.mod h1:M6DEAAIenWoTxdKrOltXcmDY3rSplQUkrvaDU5FcQyo=
golang.org/x/term v0.10.0/go.mod h1:lpqdcUyK/oCiQxvxVrppt5ggO2KCZ5QblwqPnfZ6d5o=
golang.org/x/term v0.11.0/go.mod h1:zC9APTIj3jG3FdV/Ons+XE1riIZXG4aZ4GTHiPZJPIU=
golang.org/x/term v0.12.0/go.mod h1:owVbMEjm3cBLCHdkQu9b1opXd4ETQWc3BhuQGKgXgvU=
golang.org/x/term v0.13.0/go.mod h1:LTmsnFJwVN6bCy1rVCoS+qHT1HhALEFxKncY3WNNh4U=
golang.org/x/term v0.14.0/go.mod h1:TySc+nGkYR6qt8km8wUhuFRTVSMIX3XPR58y2lC8vww=
golang.org/x/te
---
[Medium] chunk lines 2701-2720 in go.sum:
github.com/mitchellh/go-testing-interface v1.14.1/go.mod h1:gfgS7OtZj6MA4U1UrDRp04twqAjfvlZyCfX3sDjEym8=
github.com/mitchellh/go-wordwrap v1.0.0/go.mod h1:ZXFpozHsX6DPmq2I0TCekCxypsnAUbP2oI0UX1GXzOo=
github.com/mitchellh/go-wordwrap v1.0.1 h1:TLuKupo69TCn6TQSyGxwI1EblZZEsQ0vMlAFQflz0v0=
github.com/mitchellh/go-wordwrap v1.0.1/go.mod h1:R62XHJLzvMFRBbcrT7m7WgmE1eOyTSsCt+hzestvNj0=
github.com/mitchellh/gox v0.4.0/go.mod h1:Sd9lOJ0+aimLBi73mGofS1ycjY8lL3uZM3JPS42BGNg=
github.com/mitchellh/iochan v1
---
[Medium] chunk lines 3521-3540 in go.sum:
golang.org/x/net v0.0.0-20180826012351-8a410e7b638d/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20180906233101-161cd47e91fd/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20181023162649-9b4f9f5ad519/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20181108082009-03003ca0c849/go.mod h1:mL1N/T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
golang.org/x/net v0.0.0-20181114220301-adae6a3d119a/go.mod h1:mL1N/T3taQ
---
[Medium] chunk lines 3261-3280 in go.sum:
go.etcd.io/etcd/client/v3 v3.5.14 h1:CWfRs4FDaDoSz81giL7zPpZH2Z35tbOrAJkkjMqOupg=
go.etcd.io/etcd/client/v3 v3.5.14/go.mod h1:k3XfdV/VIHy/97rqWjoUzrj9tk7GgJGH9J8L4dNXmAk=
go.etcd.io/etcd/pkg/v3 v3.5.13 h1:st9bDWNsKkBNpP4PR1MvM/9NqUPfvYZx/YXegsYEH8M=
go.etcd.io/etcd/pkg/v3 v3.5.13/go.mod h1:N+4PLrp7agI/Viy+dUYpX7iRtSPvKq+w8Y14d1vX+m0=
go.etcd.io/etcd/raft/v3 v3.5.13 h1:7r/NKAOups1YnKcfro2RvGGo2PTuizF/xh26Z2CTAzA=
go.etcd.io/etcd/raft/v3 v3.5.13/go.mod h1:uUFibGLn2Ksm2URMxN1fICGhk8Wu96EfDQyuLhAcAm
---
[Medium] chunk lines 1841-1860 in go.sum:
github.com/envoyproxy/go-control-plane v0.11.1/go.mod h1:uhMcXKCQMEJHiAb0w+YGefQLaTEw+YhGluxZkrTmD0g=
github.com/envoyproxy/go-control-plane v0.12.0/go.mod h1:ZBTaoJ23lqITozF0M6G4/IragXCQKCnYbmlmtHvwRG0=
github.com/envoyproxy/go-control-plane v0.13.0 h1:HzkeUz1Knt+3bK+8LG1bxOO/jzWZmdxpwC51i202les=
github.com/envoyproxy/go-control-plane v0.13.0/go.mod h1:GRaKG3dwvFoTg4nj7aXdZnvMg4d7nvT/wl9WgVXn3Q8=
github.com/envoyproxy/protoc-gen-validate v0.1.0/go.mod h1:iSmxcyjqTsJpI2R4NaDN7+kN2VEUnK/pcBlmesAr
---
[Medium] chunk lines 4481-4500 in go.sum:
gopkg.in/yaml.v3 v3.0.0-20200313102051-9f266ea9e77c/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.0-20200615113413-eeeca48fe776/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307b/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gopkg.in/yaml.v3 v3.0.1 h1:fxVm/GzAzEWqLHuvctI91KS9hhNmmWOoWu0XTYJS7CA=
gopkg.in/yaml.v3 v3.0.1/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
gotest.tools v2.2.0+incompat
---
[Medium] chunk lines 2261-2280 in go.sum:
github.com/grafana/dskit v0.0.0-20240311184239-73feada6c0d7 h1:yd9yoNgEOtp8O0MbtqXoMVqr+ZbU4oZFE8a04z8WXFE=
github.com/grafana/dskit v0.0.0-20240311184239-73feada6c0d7/go.mod h1:RpTvZ9nkdXqyQro5DULQHJl9B6vwvEj95Dk6WIXqTLQ=
github.com/grafana/e2e v0.1.1 h1:/b6xcv5BtoBnx8cZnCiey9DbjEc8z7gXHO5edoeRYxc=
github.com/grafana/e2e v0.1.1/go.mod h1:RpNLgae5VT+BUHvPE+/zSypmOXKwEu4t+tnEMS1ATaE=
github.com/grafana/gofpdf v0.0.0-20231002120153-857cc45be447 h1:jxJJ5z0GxqhWFbQUsys3BHG8jnmniJ2Q74tXAG1NaDo=
githu
---
[Medium] chunk lines 3741-3760 in go.sum:
golang.org/x/sys v0.0.0-20200615200032-f1bc736245b1/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200625212154-ddb9806d33ae/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200803210538-64077c9b5642/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200905004654-be1d3432aa8f/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20200909081042-eff7692f9009/go.mod h1:h1NjWce9XR
---
[Medium] chunk lines 2721-2740 in go.sum:
github.com/mithrandie/go-file/v2 v2.1.0 h1:XA5Tl+73GXMDvgwSE3Sg0uC5FkLr3hnXs8SpUas0hyg=
github.com/mithrandie/go-file/v2 v2.1.0/go.mod h1:9YtTF3Xo59GqC1Pxw6KyGVcM/qubAMlxVsqI/u9r++c=
github.com/mithrandie/go-text v1.6.0 h1:8gOXTMPbMY8DJbKMTv8kHhADcJlDWXqS/YQH4SyWO6s=
github.com/mithrandie/go-text v1.6.0/go.mod h1:xCgj1xiNbI/d4xA9sLVvXkjh5B2tNx2ZT2/3rpmh8to=
github.com/mithrandie/ternary v1.1.1 h1:k/joD6UGVYxHixYmSR8EGgDFNONBMqyD373xT4QRdC4=
github.com/mithrandie/ternary v1.1.1/go.mod h1:0D9Ba3+0
---
[Medium] chunk lines 3161-3180 in go.sum:
github.com/teris-io/shortid v0.0.0-20171029131806-771a37caa5cf/go.mod h1:M8agBzgqHIhgj7wEn9/0hJUZcrvt9VY+Ln+S1I5Mha0=
github.com/thanos-io/objstore v0.0.0-20220809103346-8ef1f215e2bf h1:onQsPyHlq2yIWU+Nfl6yStuqnZuVQQN8FZ8sBb2wqtw=
github.com/thanos-io/objstore v0.0.0-20220809103346-8ef1f215e2bf/go.mod h1:v0NhuxxxUFUPatQcVNSCUkBEVezXzl7LSdaBOZygq98=
github.com/tidwall/pretty v0.0.0-20180105212114-65a9db5fad51/go.mod h1:XNkn88O1ChpSDQmQeStsy+sBenx6DDtFZJxhVysOjyk=
github.com/tmc/grpc-websocket-pro
---
[Medium] chunk lines 2221-2240 in go.sum:
github.com/googleapis/gax-go/v2 v2.12.3/go.mod h1:AKloxT6GtNbaLm8QTNSidHUVsHYcBHwWRvkNFJUQcS4=
github.com/googleapis/gax-go/v2 v2.13.0 h1:yitjD5f7jQHhyDsnhKEBU52NdvvdSeGzlAnDPT0hH1s=
github.com/googleapis/gax-go/v2 v2.13.0/go.mod h1:Z/fvTZXF8/uw7Xu5GuslPw+bplx6SS338j1Is2S+B7A=
github.com/googleapis/go-type-adapters v1.0.0/go.mod h1:zHW75FOG2aur7gAO2B+MLby+cLsWGBF62rFAi7WjWO4=
github.com/googleapis/google-cloud-go-testing v0.0.0-20200911160855-bcd43fbb19e8/go.mod h1:dvDLG8qkwmyD9a/MJJN3XJcT3xFxOK
---
[Medium] chunk lines 1601-1620 in go.sum:
github.com/beorn7/perks v1.0.0/go.mod h1:KWe93zE9D1o94FZ5RNwFwVgaQK1VOXiVxmqh+CedLV8=
github.com/beorn7/perks v1.0.1 h1:VlbKKnNfV8bJzeqoa4cOKqO6bYr3WgKZxO8Z16+hsOM=
github.com/beorn7/perks v1.0.1/go.mod h1:G2ZrVWU2WbWT9wwq4/hrbKbnv/1ERSJQ0ibhJ6rlkpw=
github.com/bgentry/speakeasy v0.1.0/go.mod h1:+zsyZBPWlz7T6j88CTgSN5bM796AkVf0kBD4zp0CCIs=
github.com/bitly/go-hostpool v0.0.0-20171023180738-a3a6125de932/go.mod h1:NOuUCSz6Q9T7+igc/hlvDOUdtWKryOrtFyIVABv/p7k=
github.com/bits-and-blooms/bitset v1.2.
---
[Medium] chunk lines 2341-2360 in go.sum:
github.com/hashicorp/consul/api v1.3.0/go.mod h1:MmDNSzIMUjNpY/mQ398R4bk2FnqQLoPndWW5VkKPlCE=
github.com/hashicorp/consul/api v1.10.1/go.mod h1:XjsvQN+RJGWI2TWy1/kqaE16HrR2J/FWgkYjdZQsX9M=
github.com/hashicorp/consul/api v1.12.0/go.mod h1:6pVBMo0ebnYdt2S3H87XhekM/HHrUoTD2XXb/VrZVy0=
github.com/hashicorp/consul/api v1.28.2 h1:mXfkRHrpHN4YY3RqL09nXU1eHKLNiuAN4kHvDQ16k/8=
github.com/hashicorp/consul/api v1.28.2/go.mod h1:KyzqzgMEya+IZPcD65YFoOVAgPpbfERu4I/tzG6/ueE=
github.com/hashicorp/consul/sdk v
---
[Medium] chunk lines 1941-1960 in go.sum:
github.com/go-logr/zapr v1.3.0 h1:XGdV8XW8zdwFiwOA2Dryh1gj2KRQyOOoNmBy4EplIcQ=
github.com/go-logr/zapr v1.3.0/go.mod h1:YKepepNBd1u/oyhd/yQmtjVXmm9uML4IXUgMOwR8/Gg=
github.com/go-openapi/analysis v0.21.5/go.mod h1:25YcZosX9Lwz2wBsrFrrsL8bmjjXdlyP6zsr2AMy29M=
github.com/go-openapi/analysis v0.22.0/go.mod h1:acDnkkCI2QxIo8sSIPgmp1wUlRohV7vfGtAIVae73b0=
github.com/go-openapi/analysis v0.22.2/go.mod h1:pDF4UbZsQTo/oNuRfAWWd4dAh4yuYf//LYorPTjrpvo=
github.com/go-openapi/analysis v0.23.0 h1:aGday7OWupf
---
[Medium] chunk lines 2621-2640 in go.sum:
github.com/mailru/easyjson v0.7.7/go.mod h1:xzfreul335JAWq5oZzymOObrkdz5UnU4kGfJJLY9Nlc=
github.com/matryer/is v1.4.0 h1:sosSmIWwkYITGrxZ25ULNDeKiMNzFSr4V/eqBQP0PeE=
github.com/matryer/is v1.4.0/go.mod h1:8I/i5uYgLzgsgEloJE1U6xx5HkBQpAZvepWuujKwMRU=
github.com/mattermost/xml-roundtrip-validator v0.1.0 h1:RXbVD2UAl7A7nOTR4u7E3ILa4IbtvKBHw64LDsmu9hU=
github.com/mattermost/xml-roundtrip-validator v0.1.0/go.mod h1:qccnGMcpgwcNaBnxqpJpWWUiPNr5H3O8eDgGV9gT5To=
github.com/mattetti/filebuffer v1.0.1 h1:
---
[Medium] chunk lines 2741-2760 in go.sum:
github.com/modern-go/reflect2 v1.0.2/go.mod h1:yWuevngMOJpCy52FWWMvUC8ws7m/LJsjYzDa0/r8luk=
github.com/modocache/gover v0.0.0-20171022184752-b58185e213c5/go.mod h1:caMODM3PzxT8aQXRPkAt8xlV/e7d7w8GM5g0fa5F0D8=
github.com/mohae/deepcopy v0.0.0-20170929034955-c48cc78d4826 h1:RWengNIwukTxcDr9M+97sNutRR1RKhG96O6jWumTTnw=
github.com/mohae/deepcopy v0.0.0-20170929034955-c48cc78d4826/go.mod h1:TaXosZuwdSHYgviHp1DAtfrULt5eUgsSMsZf+YrPgl8=
github.com/montanaflynn/stats v0.0.0-20171201202039-1bf9dbcd8cbe/g
---
[Medium] chunk lines 1861-1880 in go.sum:
github.com/fatih/color v1.10.0/go.mod h1:ELkj/draVOlAH/xkhN6mQ50Qd0MPOk5AAr3maGEBuJM=
github.com/fatih/color v1.12.0/go.mod h1:ELkj/draVOlAH/xkhN6mQ50Qd0MPOk5AAr3maGEBuJM=
github.com/fatih/color v1.13.0/go.mod h1:kLAiJbzzSOZDVNGyDpeOxJ47H46qBXwg5ILebYFFOfk=
github.com/fatih/color v1.14.1/go.mod h1:2oHN61fhTpgcxD3TSWCgKDiH1+x4OiDVVGH8WlgGZGg=
github.com/fatih/color v1.15.0/go.mod h1:0h5ZqXfHYED7Bhv2ZJamyIOUej9KtShiJESRwBDUSsw=
github.com/fatih/color v1.17.0 h1:GlRw1BRJxkpqUCBKzKOw098ed57fEsKeNjpT
---
[Medium] chunk lines 1521-1540 in go.sum:
github.com/armon/go-metrics v0.0.0-20180917152333-f0300d1749da/go.mod h1:Q73ZrmVTwzkszR9V5SSuryQ31EELlFMUz1kKyl939pY=
github.com/armon/go-metrics v0.3.9/go.mod h1:4O98XIr/9W0sxpJ8UaYkvjk10Iff7SnFrb4QAOwNTFc=
github.com/armon/go-metrics v0.3.10/go.mod h1:4O98XIr/9W0sxpJ8UaYkvjk10Iff7SnFrb4QAOwNTFc=
github.com/armon/go-metrics v0.4.1 h1:hR91U9KYmb6bLBYLQjyM+3j+rcd/UhE+G78SFnF8gJA=
github.com/armon/go-metrics v0.4.1/go.mod h1:E6amYzXo6aW1tqzoZGT755KkbgrJsSdpwZ+3JqfkOG4=
github.com/armon/go-radix v0
---
[Medium] chunk lines 1441-1460 in go.sum:
github.com/Masterminds/semver/v3 v3.2.0 h1:3MEsd0SM6jqZojhjLWWeBY+Kcjy9i6MQAeY7YgDP83g=
github.com/Masterminds/semver/v3 v3.2.0/go.mod h1:qvl/7zhW3nngYb5+80sSMF+FG2BjYrf8m9wsX0PNOMQ=
github.com/Masterminds/sprig/v3 v3.2.1/go.mod h1:UoaO7Yp8KlPnJIYWTFkMaqPUYKTfGFPhxNuwnnxkKlk=
github.com/Masterminds/sprig/v3 v3.2.3 h1:eL2fZNezLomi0uOLqjQoN6BfsDD+fyLtgbJMAj9n6YA=
github.com/Masterminds/sprig/v3 v3.2.3/go.mod h1:rXcFaZ2zZbLRJv/xSysmlgIM1u11eBaRMhvYXJNkGuM=
github.com/Masterminds/squirrel v1.5.4 h1:
---
[Medium] chunk lines 3201-3220 in go.sum:
github.com/x448/float16 v0.8.4/go.mod h1:14CWIYCyZA/cWjXOioeEpHeN/83MdbZDRQHoFcYsOfg=
github.com/xanzy/go-gitlab v0.15.0/go.mod h1:8zdQa/ri1dfn8eS3Ir1SyfvOKlw7WBJ8DVThkpGiXrs=
github.com/xdg-go/pbkdf2 v1.0.0/go.mod h1:jrpuAogTd400dnrH08LKmI/xc1MbPOebTwRqcT5RDeI=
github.com/xdg-go/scram v1.1.2/go.mod h1:RT/sEzTbU5y00aCK8UOx6R7YryM0iF1N2MOmC3kKLN4=
github.com/xdg-go/stringprep v1.0.4/go.mod h1:mPGuuIYwz7CmR2bT9j4GbQqutWS1zV24gijq1dTyGkM=
github.com/xdg/scram v0.0.0-20180814205039-7eeb5667e42c/go.m
---
[Medium] chunk lines 3241-3260 in go.sum:
go.einride.tech/aip v0.66.0/go.mod h1:qAhMsfT7plxBX+Oy7Huol6YUvZ0ZzdUz26yZsQwfl1M=
go.etcd.io/bbolt v1.3.3/go.mod h1:IbVyRI1SCnLcuJnV2u8VeU0CEYM7e686BmAb1XKL+uU=
go.etcd.io/bbolt v1.3.9 h1:8x7aARPEXiXbHmtUwAIv7eV2fQFHrLLavdiJ3uzJXoI=
go.etcd.io/bbolt v1.3.9/go.mod h1:zaO32+Ti0PK1ivdPtgMESzuzL2VPoIG1PCQNvOdo/dE=
go.etcd.io/etcd v0.0.0-20191023171146-3cf2f69b5738 h1:VcrIfasaLFkyjk6KNlXQSzO+B0fZcnECiDrKJsfxka0=
go.etcd.io/etcd v0.0.0-20191023171146-3cf2f69b5738/go.mod h1:dnLIgRNXwCJa5e+c6mIZCrds/GI
---
[Medium] chunk lines 1921-1940 in go.sum:
github.com/go-ldap/ldap/v3 v3.4.4 h1:qPjipEpt+qDa6SI/h1fzuGWoRUY+qqQ9sOZq67/PYUs=
github.com/go-ldap/ldap/v3 v3.4.4/go.mod h1:fe1MsuN5eJJ1FeLT/LEBVdWfNWKh459R7aXgXtJC+aI=
github.com/go-logfmt/logfmt v0.3.0/go.mod h1:Qt1PoO58o5twSAckw1HlFXLmHsOX5/0LbT9GBnD5lWE=
github.com/go-logfmt/logfmt v0.4.0/go.mod h1:3RMwSq7FuexP4Kalkev3ejPJsZTpXXBr9+V4qmtdjCk=
github.com/go-logfmt/logfmt v0.5.0/go.mod h1:wCYkCAKZfumFQihp8CzCvQ3paCTfi41vtzG1KdI/P7A=
github.com/go-logfmt/logfmt v0.5.1/go.mod h1:WYhtIu8zTZfxdn
---
[Medium] chunk lines 2481-2500 in go.sum:
github.com/jarcoal/httpmock v1.3.0/go.mod h1:3yb8rc4BI7TCBhFY8ng0gjuLKJNquuDNiPaZjnENuYg=
github.com/jarcoal/httpmock v1.3.1/go.mod h1:3yb8rc4BI7TCBhFY8ng0gjuLKJNquuDNiPaZjnENuYg=
github.com/jcmturner/aescts/v2 v2.0.0 h1:9YKLH6ey7H4eDBXW8khjYslgyqG2xZikXP0EQFKrle8=
github.com/jcmturner/aescts/v2 v2.0.0/go.mod h1:AiaICIRyfYg35RUkr8yESTqvSy7csK90qZ5xfvvsoNs=
github.com/jcmturner/dnsutils/v2 v2.0.0 h1:lltnkeZGL0wILNvrNiVCR6Ro5PGU/SeBvVO/8c/iPbo=
github.com/jcmturner/dnsutils/v2 v2.0.0/go.mod h1:b0T
---
[Medium] chunk lines 2081-2100 in go.sum:
github.com/golang/protobuf v1.2.0/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.1/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.2/go.mod h1:6lQm79b+lXiMfvg/cZm0SGofjICqVBUtrP5yJMmIC1U=
github.com/golang/protobuf v1.3.3/go.mod h1:vzj43D7+SQXF/4pzW/hwtAqwc6iTitCiVSaWz5lYuqw=
github.com/golang/protobuf v1.3.4/go.mod h1:vzj43D7+SQXF/4pzW/hwtAqwc6iTitCiVSaWz5lYuqw=
github.com/golang/protobuf v1.3.5/go.mod h1:6O5/vntMXwX
---
[Medium] chunk lines 2141-2160 in go.sum:
github.com/google/go-querystring v1.0.0/go.mod h1:odCYkC5MyYFN7vkCjXpyrEuKhc/BUO6wN/zVPAxq5ck=
github.com/google/go-querystring v1.1.0 h1:AnCroh3fv4ZBgVIf1Iwtovgjaw/GiKJo8M8yD/fhyJ8=
github.com/google/go-querystring v1.1.0/go.mod h1:Kcdr2DB4koayq7X8pmAG4sNG59So17icRSOU623lUBU=
github.com/google/gofuzz v1.0.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=
github.com/google/gofuzz v1.1.0/go.mod h1:dBl0BpW6vV/+mYPU4Po3pmUjxk6FQPldtuIdl/M65Eg=
github.com/google/gofuzz v1.2.0 h1:xRy4A+RhZaiKj
---
[Medium] chunk lines 4001-4020 in go.sum:
gonum.org/v1/gonum v0.15.1 h1:FNy7N6OUZVUaWG9pTiD+jlhdQ3lMP+/LcTpJ6+a8sQ0=
gonum.org/v1/gonum v0.15.1/go.mod h1:eZTZuRFrzu5pcyjN5wJhcIhnUdNijYxX1T2IcrOGY0o=
gonum.org/v1/netlib v0.0.0-20190313105609-8cb42192e0e0/go.mod h1:wa6Ws7BG/ESfp6dHfk7C6KdzKA7wR7u/rKwOGE66zvw=
gonum.org/v1/plot v0.0.0-20190515093506-e2840ee46a6b/go.mod h1:Wt8AAjI+ypCyYX3nZBvf6cAIx93T+c/OS2HFAYskSZc=
gonum.org/v1/plot v0.9.0/go.mod h1:3Pcqqmp6RHvJI72kgb8fThyUnav364FOsdDo2aGW5lY=
gonum.org/v1/plot v0.10.1/go.mod h1:VZW5OlhkL
---
[Medium] chunk lines 4361-4380 in go.sum:
google.golang.org/grpc v1.26.0/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=
google.golang.org/grpc v1.27.0/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=
google.golang.org/grpc v1.27.1/go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=
google.golang.org/grpc v1.28.0/go.mod h1:rpkK4SK4GF4Ach/+MFLZUBavHOvF2JJB5uozKKal+60=
google.golang.org/grpc v1.29.1/go.mod h1:itym6AZVZYACWQqET3MqgPpjcuV5QH3BxFS3IjizoKk=
google.golang.org/grpc v1.30.0/go.mod h1:N36X2cJ7JwdamYAgDz+s+rVMFjt3n
---
[Medium] chunk lines 2861-2880 in go.sum:
github.com/opentracing-contrib/go-observer v0.0.0-20170622124052-a52f23424492/go.mod h1:Ngi6UdF0k5OKD5t5wlmGhe/EDKPoUM3BXZSSfIuJbis=
github.com/opentracing-contrib/go-stdlib v1.0.0 h1:TBS7YuVotp8myLon4Pv7BtCBzOTo1DeZCld0Z63mW2w=
github.com/opentracing-contrib/go-stdlib v1.0.0/go.mod h1:qtI1ogk+2JhVPIXVc6q+NHziSmy2W5GbdQZFUHADCBU=
github.com/opentracing/basictracer-go v1.0.0/go.mod h1:QfBfYuafItcjQuMwinw9GhYKwFXS9KnPs5lxoYwgW74=
github.com/opentracing/opentracing-go v1.0.2/go.mod h1:UkNAQd3GIcIGf
---
[Medium] chunk lines 2541-2560 in go.sum:
github.com/julienschmidt/httprouter v1.2.0/go.mod h1:SYymIcj16QtmaHHD7aYtjjsJG7VTCxuUUipMqKk8s4w=
github.com/julienschmidt/httprouter v1.3.0/go.mod h1:JR6WtHb+2LUe8TCKY3cZOxFyyO8IZAc4RVcycCCAKdM=
github.com/jung-kurt/gofpdf v1.0.0/go.mod h1:7Id9E/uU8ce6rXgefFLlgrJj/GYY22cpxn+r32jIOes=
github.com/jung-kurt/gofpdf v1.0.3-0.20190309125859-24315acbbda5/go.mod h1:7Id9E/uU8ce6rXgefFLlgrJj/GYY22cpxn+r32jIOes=
github.com/kardianos/osext v0.0.0-20190222173326-2bc1f35cddc0/go.mod h1:1NbS8ALrpOvjt0rHPNLyCI
---
[Medium] chunk lines 2641-2660 in go.sum:
github.com/mattn/go-isatty v0.0.8/go.mod h1:Iq45c/XA43vh69/j3iqttzPXn0bhXyGjM0Hdxcsrc5s=
github.com/mattn/go-isatty v0.0.10/go.mod h1:qgIWMr58cqv1PHHyhnkY9lrL7etaEgOFcMEpPG5Rm84=
github.com/mattn/go-isatty v0.0.11/go.mod h1:PhnuNfih5lzO57/f3n+odYbM4JtupLOxQOAqxQCu2WE=
github.com/mattn/go-isatty v0.0.12/go.mod h1:cbi8OIDigv2wuxKPP5vlRcQ1OAZbq2CE4Kysco4FUpU=
github.com/mattn/go-isatty v0.0.14/go.mod h1:7GGIvUiUoEMVVmxf/4nioHXj79iQHKdU27kJ6hsGG94=
github.com/mattn/go-isatty v0.0.16/go.mod h1:kYGgaQ
---
[Medium] chunk lines 2901-2920 in go.sum:
github.com/pierrec/lz4 v1.0.2-0.20190131084431-473cd7ce01a1/go.mod h1:3/3N9NVKO0jef7pBehbT1qWhCMrIgbYNnFAZCqQ5LRc=
github.com/pierrec/lz4 v2.0.5+incompatible/go.mod h1:pdkljMzZIN41W+lC3N2tnIh5sFi+IEE17M5jbnwPHcY=
github.com/pierrec/lz4/v4 v4.1.15/go.mod h1:gZWDp/Ze/IJXGXf23ltt2EXimqmTUXEy0GFuRQyBid4=
github.com/pierrec/lz4/v4 v4.1.18/go.mod h1:gZWDp/Ze/IJXGXf23ltt2EXimqmTUXEy0GFuRQyBid4=
github.com/pierrec/lz4/v4 v4.1.21 h1:yOVMLb6qSIDP67pl/5F7RepeKYu/VmTyEXvuMI5d9mQ=
github.com/pierrec/lz4/v4 v
---
[Medium] chunk lines 2921-2940 in go.sum:
github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=
github.com/pmezard/go-difflib v1.0.1-0.20181226105442-5d4384ee4fb2 h1:Jamvg5psRIccs7FGNTlIRMkT8wgtp5eCXdBlqhYGL6U=
github.com/pmezard/go-difflib v1.0.1-0.20181226105442-5d4384ee4fb2/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=
github.com/posener/complete v1.1.1/go.mod h1:em0nMJCgc9GFtwrmVmEMR/ZL6WyhyjMBndrE9hABlRI=
github.com/posener/complete v1.2.3/go.mod h1:WZIdtGGp+qx0sLrYKtIRAruyNpv6hFCicSgv
---
[Medium] chunk lines 2441-2460 in go.sum:
github.com/huandu/xstrings v1.3.3 h1:/Gcsuc1x8JVbJ9/rlye4xZnVAbEkGauT8lbebqcQws4=
github.com/huandu/xstrings v1.3.3/go.mod h1:y5/lhBue+AyNmUVz9RLU9xbLR0o4KIIExikq4ovT0aE=
github.com/hudl/fargo v1.3.0/go.mod h1:y3CKSmjA+wD2gak7sUSXTAoopbhU08POFhmITJgmKTg=
github.com/hudl/fargo v1.4.0/go.mod h1:9Ai6uvFy5fQNq6VPKtg+Ceq1+eTY4nKUlR2JElEOcDo=
github.com/iancoleman/strcase v0.2.0/go.mod h1:iwCmte+B7n89clKwxIoIXy/HfoL7AsD47ZCWhYzw7ho=
github.com/iancoleman/strcase v0.3.0/go.mod h1:iwCmte+B7n89clKwxIoIXy
---
[Medium] chunk lines 3381-3400 in go.sum:
go.uber.org/zap v1.10.0/go.mod h1:vwi/ZaCAaUcBkycHslxD9B2zi4UTXhF60s6SWpuDF0Q=
go.uber.org/zap v1.13.0/go.mod h1:zwrFLgMcdUuIBviXEYEH1YKNaOBnKXsx2IPda5bBwHM=
go.uber.org/zap v1.17.0/go.mod h1:MXVU+bhUf/A7Xi2HNOnopQOrmycQ5Ih87HtOu4q5SSo=
go.uber.org/zap v1.18.1/go.mod h1:xg/QME4nWcxGxrpdeYfq7UvYrLh66cuVKdrbD1XF/NI=
go.uber.org/zap v1.19.1/go.mod h1:j3DNczoxDZroyBnOT1L/Q79cfUMGZxlv/9dzN7SM1rI=
go.uber.org/zap v1.27.0 h1:aJMhYGrd5QSmlpLMr2MftRKl7t8J8PTZPA732ud/XR8=
go.uber.org/zap v1.27.0/go.mod h1
---
[Medium] chunk lines 3181-3200 in go.sum:
github.com/unknwon/com v1.0.1/go.mod h1:tOOxU81rwgoCLoOVVPHb6T/wt8HZygqH5id+GNnlCXM=
github.com/unknwon/log v0.0.0-20150304194804-e617c87089d3/go.mod h1:1xEUf2abjfP92w2GZTV+GgaRxXErwRXcClbUwrNJffU=
github.com/unknwon/log v0.0.0-20200308114134-929b1006e34a h1:vcrhXnj9g9PIE+cmZgaPSwOyJ8MAQTRmsgGrB0x5rF4=
github.com/unknwon/log v0.0.0-20200308114134-929b1006e34a/go.mod h1:1xEUf2abjfP92w2GZTV+GgaRxXErwRXcClbUwrNJffU=
github.com/urfave/cli v1.20.0/go.mod h1:70zkFmudgCuE/ngEzBv17Jvp/497gISqfk5gWijbERA
---
[Medium] chunk lines 2961-2980 in go.sum:
github.com/prometheus/common v0.2.0/go.mod h1:TNfzLD0ON7rHzMJeJkieUDPYmFC7Snx/y86RQel1bk4=
github.com/prometheus/common v0.4.1/go.mod h1:TNfzLD0ON7rHzMJeJkieUDPYmFC7Snx/y86RQel1bk4=
github.com/prometheus/common v0.7.0/go.mod h1:DjGbpBbp5NYNiECxcL/VnbXCCaQpKd3tt26CguLLsqA=
github.com/prometheus/common v0.9.1/go.mod h1:yhUN8i9wzaXS3w1O07YhxHEBxD+W35wd8bs7vj7HSQ4=
github.com/prometheus/common v0.10.0/go.mod h1:Tlit/dnDKsSWFlCLTWaA1cyBgKHSMdTB80sz/V91rCo=
github.com/prometheus/common v0.18.0/go.mod 
---
[Medium] chunk lines 3281-3300 in go.sum:
go.opencensus.io v0.22.5/go.mod h1:5pWMHQbX5EPX2/62yrJeAkowc+lfs/XD7Uxpq3pI6kk=
go.opencensus.io v0.23.0/go.mod h1:XItmlyltB5F7CS4xOC1DcqMoFqwtC6OG2xF7mCv7P7E=
go.opencensus.io v0.24.0 h1:y73uSU6J157QMP2kn2r30vwW1A2W2WFwSCGnAVxeaD0=
go.opencensus.io v0.24.0/go.mod h1:vNK8G9p7aAivkbmorf4v+7Hgx+Zs0yY+0fOtgBfjQKo=
go.opentelemetry.io/collector/featuregate v1.5.0/go.mod h1:w7nUODKxEi3FLf1HslCiE6YWtMtOOrMnSwsDam8Mg9w=
go.opentelemetry.io/collector/pdata v1.5.0/go.mod h1:TYj8aKRWZyT/KuKQXKyqSEvK/GV+sl
---
[Medium] chunk lines 3941-3960 in go.sum:
golang.org/x/tools v0.0.0-20200729194436-6467de6f59a7/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=
golang.org/x/tools v0.0.0-20200804011535-6c149bb5ef0d/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=
golang.org/x/tools v0.0.0-20200825202427-b303f430e36d/go.mod h1:njjCfa9FT2d7l9Bc6FUM5FLjQPp3cFF28FI3qnDFljA=
golang.org/x/tools v0.0.0-20200904185747-39188db58858/go.mod h1:Cj7w3i3Rnn0Xh82ur9kSqwfTHTeVxaDqrfMjpcNT6bE=
golang.org/x/tools v0.0.0-20201110124207-079ba7bd75cd/go.mod h1:
---
[Medium] chunk lines 3561-3580 in go.sum:
golang.org/x/net v0.0.0-20201021035429-f5854403a974/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=
golang.org/x/net v0.0.0-20201031054903-ff519b6c9102/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=
golang.org/x/net v0.0.0-20201110031124-69a78807bb2b/go.mod h1:sp8m0HH+o8qH0wwXwYZr8TS3Oi6o0r6Gce1SSxlDquU=
golang.org/x/net v0.0.0-20201209123823-ac852fbbde11/go.mod h1:m0MpNAwzfU5UDzcl9v0D8zg8gWTRqZa9RBIspLL5mdg=
golang.org/x/net v0.0.0-20201224014010-6772e930b67b/go.mod h1:m0MpNAwzfU
---
[Medium] chunk lines 2401-2420 in go.sum:
github.com/hashicorp/go.net v0.0.1/go.mod h1:hjKkEWcCURg++eb33jQU7oqQcI9XDCnUzHA0oac0k90=
github.com/hashicorp/golang-lru v0.5.0/go.mod h1:/m3WP610KZHVQ1SGc6re/UDhFvYD7pJ4Ao+sR/qLZy8=
github.com/hashicorp/golang-lru v0.5.1/go.mod h1:/m3WP610KZHVQ1SGc6re/UDhFvYD7pJ4Ao+sR/qLZy8=
github.com/hashicorp/golang-lru v0.5.4/go.mod h1:iADmTwqILo4mZ8BN3D2Q6+9jd8WM5uGBxy+E8yxSoD4=
github.com/hashicorp/golang-lru v0.6.0/go.mod h1:iADmTwqILo4mZ8BN3D2Q6+9jd8WM5uGBxy+E8yxSoD4=
github.com/hashicorp/golang-lru v1
---
[Medium] chunk lines 2781-2800 in go.sum:
github.com/nsf/jsondiff v0.0.0-20230430225905-43f6cf3098c1/go.mod h1:mpRZBD8SJ55OIICQ3iWH0Yz3cjzA61JdqMLoWXeB2+8=
github.com/nxadm/tail v1.4.4/go.mod h1:kenIhsEOeOJmVchQTgglprH7qJGnHDVpk1VPCcaMI8A=
github.com/nxadm/tail v1.4.8 h1:nPr65rt6Y5JFSKQO7qToXr7pePgD6Gwiw05lkbyAQTE=
github.com/nxadm/tail v1.4.8/go.mod h1:+ncqLTQzXmGhMZNUePPaPqPvBxHAIsmXswZKocGu+AU=
github.com/oapi-codegen/oapi-codegen/v2 v2.3.0 h1:rICjNsHbPP1LttefanBPnwsSwl09SqhCO7Ee623qR84=
github.com/oapi-codegen/oapi-codegen/v2 v2.3.0
---
[Medium] chunk lines 4121-4140 in go.sum:
google.golang.org/genproto v0.0.0-20200331122359-1ee6d9798940/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=
google.golang.org/genproto v0.0.0-20200423170343-7949de9c1215/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=
google.golang.org/genproto v0.0.0-20200430143042-b979b6f78d84/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=
google.golang.org/genproto v0.0.0-20200511104702-f5ebc3bea380/go.mod h1:55QSHmfGQM9UVYDPBsyGGes0y52j32PQ3BqQfXhyH3c=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 1501-1520 in go.sum:
github.com/antlr4-go/antlr/v4 v4.13.1 h1:SqQKkuVZ+zWkMMNkjy5FZe5mr5WURWnlpmOuzYWrPrQ=
github.com/antlr4-go/antlr/v4 v4.13.1/go.mod h1:GKmUxMtwp6ZgGwZSva4eWPC5mS6vUAmOABFgjdkM7Nw=
github.com/apache/arrow/go/arrow v0.0.0-20210223225224-5bea62493d91/go.mod h1:c9sxoIT3YgLxH4UhLOCKaBlEojuMhVYpk4Ntv3opUTQ=
github.com/apache/arrow/go/v10 v10.0.1/go.mod h1:YvhnlEePVnBS4+0z3fhPfUy7W1Ikj0Ih0vcRo/gZ1M0=
github.com/apache/arrow/go/v11 v11.0.0/go.mod h1:Eg5OsL5H+e299f7u5ssuXsuHQVEGC4xei5aX110hRiI=
github.com
---
[Medium] chunk lines 3541-3560 in go.sum:
golang.org/x/net v0.0.0-20190813141303-74dc4d7220e7/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20190923162816-aa69164e4478/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20191112182307-2180aed22343/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20191209160850-c0dbc17a3553/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=
golang.org/x/net v0.0.0-20200114155413-6afb5195e5aa/go.mod h1:z5CRVTTTmA
---
[Medium] chunk lines 4041-4060 in go.sum:
google.golang.org/api v0.67.0/go.mod h1:ShHKP8E60yPsKNw/w8w+VYaj9H6buA5UqDp8dhbQZ6g=
google.golang.org/api v0.70.0/go.mod h1:Bs4ZM2HGifEvXwd50TtW70ovgJffJYw2oRCOFU/SkfA=
google.golang.org/api v0.71.0/go.mod h1:4PyU6e6JogV1f9eA4voyrTY2batOLdgZ5qZ5HOCc4j8=
google.golang.org/api v0.74.0/go.mod h1:ZpfMZOVRMywNyvJFeqL9HRWBgAuRfSjJFpe9QtRRyDs=
google.golang.org/api v0.75.0/go.mod h1:pU9QmyHLnzlpar1Mjt4IbapUCy8J+6HD6GeELN69ljA=
google.golang.org/api v0.77.0/go.mod h1:pU9QmyHLnzlpar1Mjt4IbapUCy8J+6HD6Ge
---
[Medium] chunk lines 1721-1740 in go.sum:
github.com/cockroachdb/datadriven v0.0.0-20190809214429-80d97fb3cbaa/go.mod h1:zn76sxSg3SzpJ0PPJaLDCu+Bu0Lg3sKTORVIj19EIF8=
github.com/codahale/hdrhistogram v0.0.0-20161010025455-3a0bb77429bd/go.mod h1:sE/e/2PUdi/liOCUjSTXgM1o87ZssimdTWN964YiIeI=
github.com/containerd/cgroups/v3 v3.0.1/go.mod h1:/vtwk1VXrtoa5AaZLkypuOJgA/6DyPMZHJPGQNtlHnw=
github.com/containerd/cgroups/v3 v3.0.3/go.mod h1:8HBe7V3aWGLFPd/k03swSIsGjZhHI2WzJmticMgVuz0=
github.com/containerd/containerd v1.2.7/go.mod h1:bC6axHOhabU15
---
[Medium] chunk lines 2501-2520 in go.sum:
github.com/jhump/gopoet v0.1.0/go.mod h1:me9yfT6IJSlOL3FCfrg+L6yzUEZ+5jW6WHt4Sk+UPUI=
github.com/jhump/goprotoc v0.5.0/go.mod h1:VrbvcYrQOrTi3i0Vf+m+oqQWk9l72mjkJCYo7UvLHRQ=
github.com/jhump/protoreflect v1.6.0/go.mod h1:eaTn3RZAmMBcV0fifFvlm6VHNz3wSkYyXYWUh7ymB74=
github.com/jhump/protoreflect v1.11.0/go.mod h1:U7aMIjN0NWq9swDP7xDdoMfRHb35uiuTd3Z9nFXJf5E=
github.com/jhump/protoreflect v1.15.1 h1:HUMERORf3I3ZdX05WaQ6MIpd/NJ434hTp5YiKgfCL6c=
github.com/jhump/protoreflect v1.15.1/go.mod h1:jD/2GMK
---
[Medium] chunk lines 3061-3080 in go.sum:
github.com/shadowspore/fossil-delta v0.0.0-20240102155221-e3a8590b820b h1:SCYeryKXBVdW38167VyumGakH+7E4Wxe6b/zxmQxwyM=
github.com/shadowspore/fossil-delta v0.0.0-20240102155221-e3a8590b820b/go.mod h1:daNLfX/GJKuZyN4HkMf0h8dVmTmgRbBSkd9bFQyGNIo=
github.com/shoenig/test v1.7.1/go.mod h1:UxJ6u/x2v/TNs/LoLxBNJRV9DiwBBKYxXSyczsBHFoI=
github.com/shopspring/decimal v0.0.0-20180709203117-cd690d0c9e24/go.mod h1:M+9NzErvs504Cn4c5DxATwIqPbtswREoFCre64PpcG4=
github.com/shopspring/decimal v1.2.0/go.mod h1:DK
---
[Medium] chunk lines 4381-4400 in go.sum:
google.golang.org/grpc v1.40.0/go.mod h1:ogyxbiOoUXAkP+4+xa6PZSE9DZgIHtSpzjDTB9KAK34=
google.golang.org/grpc v1.40.1/go.mod h1:ogyxbiOoUXAkP+4+xa6PZSE9DZgIHtSpzjDTB9KAK34=
google.golang.org/grpc v1.42.0/go.mod h1:k+4IHHFw41K8+bbowsex27ge2rCb65oeWqe4jJ590SU=
google.golang.org/grpc v1.44.0/go.mod h1:k+4IHHFw41K8+bbowsex27ge2rCb65oeWqe4jJ590SU=
google.golang.org/grpc v1.45.0/go.mod h1:lN7owxKUQEqMfSyQikvvk5tf/6zMPsrK+ONuO11+0rQ=
google.golang.org/grpc v1.46.0/go.mod h1:vN9eftEi1UMyUsIF80+uQXhHjbXYb
---
[Medium] chunk lines 1981-2000 in go.sum:
github.com/go-openapi/swag v0.22.9/go.mod h1:3/OXnFfnMAwBD099SwYRk7GD3xOrr1iL7d/XNLXVVwE=
github.com/go-openapi/swag v0.23.0 h1:vsEVJDUo2hPJ2tu0/Xc+4noaxyEffXNIs3cOULZ+GrE=
github.com/go-openapi/swag v0.23.0/go.mod h1:esZ8ITTYEsH1V2trKHjAN8Ai7xHb8RV+YSZ577vPjgQ=
github.com/go-openapi/validate v0.22.4/go.mod h1:qm6O8ZIcPVdSY5219468Jv7kBdGvkiZLPOmqnqTUZ2A=
github.com/go-openapi/validate v0.23.0/go.mod h1:EeiAZ5bmpSIOJV1WLfyYF9qp/B1ZgSaEpHTJHtN5cbE=
github.com/go-openapi/validate v0.24.0 h1:LdfDKwN
---
[Medium] chunk lines 2201-2220 in go.sum:
github.com/googleapis/enterprise-certificate-proxy v0.2.4/go.mod h1:AwSRAtLfXpU5Nm3pW+v7rGDHp09LsPtGY9MduiEsR9k=
github.com/googleapis/enterprise-certificate-proxy v0.2.5/go.mod h1:RxW0N9901Cko1VOCW3SXCpWP+mlIEkk2tP7jnHy9a3w=
github.com/googleapis/enterprise-certificate-proxy v0.3.2 h1:Vie5ybvEvT75RniqhfFxPRy3Bf7vr3h0cechB90XaQs=
github.com/googleapis/enterprise-certificate-proxy v0.3.2/go.mod h1:VLSiSSBs/ksPL8kq3OBOQ6WRI2QnaFynd1DCjZ62+V0=
github.com/googleapis/gax-go/v2 v2.0.4/go.mod h1:0Wqv26
---
[Medium] chunk lines 1581-1600 in go.sum:
github.com/aws/aws-sdk-go-v2/service/ssooidc v1.26.4 h1:yiwVzJW2ZxZTurVbYWA7QOrAaCYQR72t0wrSBfoesUE=
github.com/aws/aws-sdk-go-v2/service/ssooidc v1.26.4/go.mod h1:0oxfLkpz3rQ/CHlx5hB7H69YUpFiI1tql6Q6Ne+1bCw=
github.com/aws/aws-sdk-go-v2/service/sts v1.30.3 h1:ZsDKRLXGWHk8WdtyYMoGNO7bTudrvuKpDKgMVRlepGE=
github.com/aws/aws-sdk-go-v2/service/sts v1.30.3/go.mod h1:zwySh8fpFyXp9yOr/KVzxOl8SRqgf/IDw5aUt9UKFcQ=
github.com/aws/smithy-go v1.8.0/go.mod h1:SObp3lf9smib00L/v3U2eAKG8FyQ7iLrJnQiAmR5n+E=
git
---
[Medium] chunk lines 4601-4620 in go.sum:
modernc.org/sqlite v1.18.2/go.mod h1:kvrTLEWgxUcHa2GfHBQtanR1H9ht3hTJNtKpzH9k1u0=
modernc.org/sqlite v1.21.2/go.mod h1:cxbLkB5WS32DnQqeH4h4o1B0eMr8W/y8/RGuxQ3JsC0=
modernc.org/sqlite v1.33.1 h1:trb6Z3YYoeM9eDL1O8do81kP+0ejv+YzgyFo+Gwy0nM=
modernc.org/sqlite v1.33.1/go.mod h1:pXV2xHxhzXZsgT/RtTFAPY6JJDEvOTcTdwADQCCWD4k=
modernc.org/strutil v1.1.1/go.mod h1:DE+MQQ/hjKBZS2zNInV5hhcipt5rLPWkmpbGeW5mmdw=
modernc.org/strutil v1.1.3/go.mod h1:MEHNA7PdEnEwLvspRMtWTNnp2nnyvMfkimT1NKNAGbw=
modernc.org/str
---
[Medium] chunk lines 2361-2380 in go.sum:
github.com/hashicorp/go-hclog v0.16.2/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=
github.com/hashicorp/go-hclog v1.2.0/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=
github.com/hashicorp/go-hclog v1.5.0/go.mod h1:W4Qnvbt70Wk/zYJryRzDRU/4r0kIg0PVHBcfoyhpF5M=
github.com/hashicorp/go-hclog v1.6.3 h1:Qr2kF+eVWjTiYmU7Y31tYlP1h0q/X3Nl3tPGdaB11/k=
github.com/hashicorp/go-hclog v1.6.3/go.mod h1:W4Qnvbt70Wk/zYJryRzDRU/4r0kIg0PVHBcfoyhpF5M=
github.com/hashicorp/go-immutable-radix v1.0.0
---
[Medium] chunk lines 1641-1660 in go.sum:
github.com/bufbuild/connect-go v1.10.0 h1:QAJ3G9A1OYQW2Jbk3DeoJbkCxuKArrvZgDt47mjdTbg=
github.com/bufbuild/connect-go v1.10.0/go.mod h1:CAIePUgkDR5pAFaylSMtNK45ANQjp9JvpluG20rhpV8=
github.com/bufbuild/protocompile v0.4.0 h1:LbFKd2XowZvQ/kajzguUp2DC9UEIQhIq77fZZlaQsNA=
github.com/bufbuild/protocompile v0.4.0/go.mod h1:3v93+mbWn/v3xzN+31nwkJfrEpAUwp+BagBSZWx+TP8=
github.com/buger/jsonparser v1.1.1 h1:2PnMjfWD7wBILjqQbt530v576A/cAbQvEW9gGIpYMUs=
github.com/buger/jsonparser v1.1.1/go.mod h1:6RYKKt7H
---
[Medium] chunk lines 3121-3140 in go.sum:
github.com/spf13/viper v1.19.0 h1:RWq5SEjt8o25SROyN3z2OrDB9l7RPd3lwTWU8EcEdcI=
github.com/spf13/viper v1.19.0/go.mod h1:GQUN9bilAbhU/jgc1bKs99f/suXKeUMct8Adx5+Ntkg=
github.com/spkg/bom v0.0.0-20160624110644-59b7046e48ad/go.mod h1:qLr4V1qq6nMqFKkMo8ZTx3f+BZEkzsRUY10Xsm2mwU0=
github.com/spyzhov/ajson v0.9.0 h1:tF46gJGOenYVj+k9K1U1XpCxVWhmiyY5PsVCAs1+OJ0=
github.com/spyzhov/ajson v0.9.0/go.mod h1:a6oSw0MMb7Z5aD2tPoPO+jq11ETKgXUr2XktHdT8Wt8=
github.com/stoewer/go-strcase v1.3.0 h1:g0eASXYtp+yvN9fK8s
---
[Medium] chunk lines 2161-2180 in go.sum:
github.com/google/pprof v0.0.0-20200430221834-fc25d7d30c6d/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=
github.com/google/pprof v0.0.0-20200708004538-1a94d8640e99/go.mod h1:ZgVRPoUq/hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=
github.com/google/pprof v0.0.0-20201023163331-3e6fc7fc9c4c/go.mod h1:kpwsk12EmLew5upagYY7GY0pfYCcupk39gWOCRROcvE=
github.com/google/pprof v0.0.0-20201203190320-1bf35d6f28c2/go.mod h1:kpwsk12EmLew5upagYY7GY0pfYCcupk39gWOCRROcvE=
github.com/google/pprof v0.0.0-2020121800293
---
[Medium] chunk lines 2581-2600 in go.sum:
github.com/kr/text v0.2.0 h1:5Nx0Ya0ZqY2ygV366QzturHI13Jq95ApcVaJBhpS+AY=
github.com/kr/text v0.2.0/go.mod h1:eLer722TekiGuMkidMxC/pM04lWEeraHUUmBw8l2grE=
github.com/kshvakov/clickhouse v1.3.5/go.mod h1:DMzX7FxRymoNkVgizH0DWAL8Cur7wHLgx3MUnGwJqpE=
github.com/kylelemons/godebug v1.1.0 h1:RPNrshWIDI6G2gRW9EHilWtl7Z6Sb1BR0xunSBf0SNc=
github.com/kylelemons/godebug v1.1.0/go.mod h1:9/0rRGxNHcop5bhtWyNeEfOS8JIWk580+fNqagV/RAw=
github.com/lann/builder v0.0.0-20180802200727-47ae307949d0 h1:SOEGU9fKiNWd/
---
[Medium] chunk lines 4521-4540 in go.sum:
k8s.io/klog/v2 v2.130.1 h1:n9Xl7H1Xvksem4KFG4PYbdQCQxqc/tTUyrgXaOhHSzk=
k8s.io/klog/v2 v2.130.1/go.mod h1:3Jpz1GvMt720eyJH1ckRHK1EDfpxISzJ7I9OYgaDtPE=
k8s.io/kms v0.31.1 h1:cGLyV3cIwb0ovpP/jtyIe2mEuQ/MkbhmeBF2IYCA9Io=
k8s.io/kms v0.31.1/go.mod h1:OZKwl1fan3n3N5FFxnW5C4V3ygrah/3YXeJWS3O6+94=
k8s.io/kube-aggregator v0.31.1 h1:vrYBTTs3xMrpiEsmBjsLETZE9uuX67oQ8B3i1BFfMPw=
k8s.io/kube-aggregator v0.31.1/go.mod h1:+aW4NX50uneozN+BtoCxI4g7ND922p8Wy3tWKFDiWVk=
k8s.io/kube-openapi v0.0.0-20231010175941-2
---
[Medium] chunk lines 2321-2340 in go.sum:
github.com/grpc-ecosystem/go-grpc-middleware v1.3.0/go.mod h1:z0ButlSOZa5vEBq9m2m2hlwIgKw+rp3sdCBRoJY+30Y=
github.com/grpc-ecosystem/go-grpc-middleware v1.4.0 h1:UH//fgunKIs4JdUbpDl1VZCDaL56wXCB/5+wF6uHfaI=
github.com/grpc-ecosystem/go-grpc-middleware v1.4.0/go.mod h1:g5qyo/la0ALbONm6Vbp88Yd8NsDy6rZz+RcrMPxvld8=
github.com/grpc-ecosystem/go-grpc-middleware/providers/prometheus v1.0.1 h1:qnpSQwGEnkcRpTqNOIR6bJbR0gAorgP9CSALpRcKoAA=
github.com/grpc-ecosystem/go-grpc-middleware/providers/prometheus
---
[Medium] chunk lines 3001-3020 in go.sum:
github.com/protocolbuffers/txtpbfmt v0.0.0-20230328191034-3462fbc510c0 h1:sadMIsgmHpEOGbUs6VtHBXRR1OHevnj7hLx9ZcdNGW4=
github.com/protocolbuffers/txtpbfmt v0.0.0-20230328191034-3462fbc510c0/go.mod h1:jgxiZysxFPM+iWKwQwPR+y+Jvo54ARd4EisXxKYpB5c=
github.com/rcrowley/go-metrics v0.0.0-20181016184325-3113b8401b8a/go.mod h1:bCqnVzQkZxMG4s8nGwiZ5l3QUCyqpo9Y+/ZMZ9VjZe4=
github.com/redis/go-redis/v9 v9.1.0 h1:137FnGdk+EQdCbye1FW+qOEcY5S+SpY9T0NiuqvtfMY=
github.com/redis/go-redis/v9 v9.1.0/go.mod h1:urWj
---
[Medium] chunk lines 4541-4560 in go.sum:
modernc.org/cc/v3 v3.38.1/go.mod h1:vtL+3mdHx/wcj3iEGz84rQa8vEqR6XM84v5Lcvfph20=
modernc.org/cc/v3 v3.40.0/go.mod h1:/bTg4dnWkSXowUO6ssQKnOV0yMVxDYNIsIrzqTFDGH0=
modernc.org/cc/v4 v4.21.4 h1:3Be/Rdo1fpr8GrQ7IVw9OHtplU4gWbb+wNgeoBMmGLQ=
modernc.org/cc/v4 v4.21.4/go.mod h1:HM7VJTZbUCR3rV8EYBi9wxnJ0ZBRiGE5OeGXNA0IsLQ=
modernc.org/ccgo/v3 v3.0.0-20220428102840-41399a37e894/go.mod h1:eI31LL8EwEBKPpNpA4bU1/i+sKOwOrQy8D87zWUcRZc=
modernc.org/ccgo/v3 v3.0.0-20220430103911-bc99d88307be/go.mod h1:bwdAnOoa
---
[Medium] chunk lines 3081-3100 in go.sum:
github.com/sirupsen/logrus v1.9.3/go.mod h1:naHLuLoDiP4jHNo9R0sCBMtWGeIprob74mVsIT4qYEQ=
github.com/smartystreets/assertions v0.0.0-20180927180507-b2de0cb4f26d/go.mod h1:OnSkiWE9lh6wB0YB77sQom3nweQdgAjqCqsofrRNTgc=
github.com/smartystreets/assertions v0.0.0-20190116191733-b6c0e53d7304 h1:Jpy1PXuP99tXNrhbq2BaPz9B+jNAvH1JPQQpG/9GCXY=
github.com/smartystreets/assertions v0.0.0-20190116191733-b6c0e53d7304/go.mod h1:OnSkiWE9lh6wB0YB77sQom3nweQdgAjqCqsofrRNTgc=
github.com/smartystreets/goconvey v0.0.0
---
[Medium] chunk lines 2381-2400 in go.sum:
github.com/hashicorp/go-retryablehttp v0.7.4/go.mod h1:Jy/gPYAdjqffZ/yFGCFV2doI5wjtH1ewM9u8iYVjtX8=
github.com/hashicorp/go-retryablehttp v0.7.7 h1:C8hUCYzor8PIfXHa4UrZkU4VvK8o9ISHxT2Q8+VepXU=
github.com/hashicorp/go-retryablehttp v0.7.7/go.mod h1:pkQpWZeYWskR+D1tR2O5OcBFOxfA7DoAO6xtkuQnHTk=
github.com/hashicorp/go-rootcerts v1.0.0/go.mod h1:K6zTfqpRlCUIjkwsN4Z+hiSfzSTQa6eBIzfwKfwNnHU=
github.com/hashicorp/go-rootcerts v1.0.2 h1:jzhAVGtqPKbwpyCPELlgNWhE1znq+qwJtW5Oi2viEzc=
github.com/hashicorp/g
---
[Medium] chunk lines 2041-2060 in go.sum:
github.com/gogo/protobuf v1.3.2/go.mod h1:P1XiOD3dCwIKUDQYPy72D8LYyHL2YPYrpS2s69NZV8Q=
github.com/gogo/status v1.1.1 h1:DuHXlSFHNKqTQ+/ACf5Vs6r4X/dH2EgIzR9Vr+H65kg=
github.com/gogo/status v1.1.1/go.mod h1:jpG3dM5QPcqu19Hg8lkUhBFBa3TcLs1DG7+2Jqci7oU=
github.com/golang-jwt/jwt v3.2.1+incompatible/go.mod h1:8pz2t5EyA70fFQQSrl6XZXzqecmYZeUEB8OUGHkxJ+I=
github.com/golang-jwt/jwt/v4 v4.0.0/go.mod h1:/xlHOz8bRuivTWchD4jCa+NbatV+wEUSzwAxVc6locg=
github.com/golang-jwt/jwt/v4 v4.2.0/go.mod h1:/xlHOz8bRuiv
---
[Medium] chunk lines 2601-2620 in go.sum:
github.com/linkedin/goavro/v2 v2.10.0/go.mod h1:UgQUb2N/pmueQYH9bfqFioWxzYCZXSfF8Jw03O5sjqA=
github.com/linode/linodego v1.32.0 h1:OmZzB3iON6uu84VtLFf64uKmAQqJJarvmsVguroioPI=
github.com/linode/linodego v1.32.0/go.mod h1:y8GDP9uLVH4jTB9qyrgw79qfKdYJmNCGUOJmfuiOcmI=
github.com/lyft/protoc-gen-star v0.6.0/go.mod h1:TGAoBVkt8w7MPG72TrKIu85MIdXwDuzJYeZuUPFPNwA=
github.com/lyft/protoc-gen-star v0.6.1/go.mod h1:TGAoBVkt8w7MPG72TrKIu85MIdXwDuzJYeZuUPFPNwA=
github.com/lyft/protoc-gen-star/v2 v2.0.1/go.m
---
[Medium] chunk lines 4321-4340 in go.sum:
google.golang.org/genproto/googleapis/rpc v0.0.0-20230920183334-c177e329c48b/go.mod h1:+Bk1OCOj40wS2hwAMA+aCW9ypzm63QTBBHp6lQ3p+9M=
google.golang.org/genproto/googleapis/rpc v0.0.0-20230920204549-e6e6cdab5c13/go.mod h1:KSqppvjFjtoCI+KGd4PELB0qLNxdJHRGqRI09mB6pQA=
google.golang.org/genproto/googleapis/rpc v0.0.0-20231002182017-d307bd883b97/go.mod h1:v7nGkzlmW8P3n/bKmWBn2WpBjpOEx8Q6gMueudAmKfY=
google.golang.org/genproto/googleapis/rpc v0.0.0-20231012201019-e917dd12ba7a/go.mod h1:4cYg8o5yUbm77w8ZX
---
[Medium] chunk lines 2561-2580 in go.sum:
github.com/klauspost/cpuid/v2 v2.0.9/go.mod h1:FInQzS24/EEf25PyTYn52gqo7WaD8xa0213Md/qVLRg=
github.com/klauspost/cpuid/v2 v2.2.3/go.mod h1:RVVoqg1df56z8g3pUjL/3lE5UfnlrJX8tyFgg4nqhuY=
github.com/klauspost/cpuid/v2 v2.2.5/go.mod h1:Lcz8mBdAVJIBVzewtcLocK12l3Y+JytZYpaMropDUws=
github.com/klauspost/cpuid/v2 v2.2.8 h1:+StwCXwm9PdpiEkPyzBXIy+M9KUb4ODm0Zarf1kS5BM=
github.com/klauspost/cpuid/v2 v2.2.8/go.mod h1:Lcz8mBdAVJIBVzewtcLocK12l3Y+JytZYpaMropDUws=
github.com/kolo/xmlrpc v0.0.0-20220921171641-a4
---
[Medium] chunk lines 4241-4260 in go.sum:
google.golang.org/genproto v0.0.0-20230526161137-0005af68ea54/go.mod h1:zqTuNwFlFRsw5zIts5VnzLQxSRqh+CGOTVMlYbY0Eyk=
google.golang.org/genproto v0.0.0-20230526203410-71b5a4ffd15e/go.mod h1:zqTuNwFlFRsw5zIts5VnzLQxSRqh+CGOTVMlYbY0Eyk=
google.golang.org/genproto v0.0.0-20230530153820-e85fd2cbaebc/go.mod h1:xZnkP7mREFX5MORlOPEzLMr+90PPZQ2QWzrVTWfAq64=
google.golang.org/genproto v0.0.0-20230629202037-9506855d4529/go.mod h1:xZnkP7mREFX5MORlOPEzLMr+90PPZQ2QWzrVTWfAq64=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 3421-3440 in go.sum:
golang.org/x/crypto v0.3.0/go.mod h1:hebNnKkNXi2UzZN1eVRvBB7co0a+JxK6XbPiWVs/3J4=
golang.org/x/crypto v0.3.1-0.20221117191849-2c476679df9a/go.mod h1:hebNnKkNXi2UzZN1eVRvBB7co0a+JxK6XbPiWVs/3J4=
golang.org/x/crypto v0.6.0/go.mod h1:OFC/31mSvZgRz0V1QTNCzfAI1aIRzbiufJtkMIlEp58=
golang.org/x/crypto v0.7.0/go.mod h1:pYwdfH91IfpZVANVyUOhSIPZaFoJGxTFbZhFTx+dXZU=
golang.org/x/crypto v0.9.0/go.mod h1:yrmDGqONDYtNj3tH8X9dzUun2m2lzPa9ngI6/RUPGR0=
golang.org/x/crypto v0.10.0/go.mod h1:o4eNf7Ede1fv+hwOwZsTHl
---
[Medium] chunk lines 3681-3700 in go.sum:
golang.org/x/sync v0.3.0/go.mod h1:FU7BRWz2tNW+3quACPkgCx/L+uEAv1htQ0V83Z9Rj+Y=
golang.org/x/sync v0.4.0/go.mod h1:FU7BRWz2tNW+3quACPkgCx/L+uEAv1htQ0V83Z9Rj+Y=
golang.org/x/sync v0.5.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=
golang.org/x/sync v0.6.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=
golang.org/x/sync v0.7.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=
golang.org/x/sync v0.8.0 h1:3NFvSEYkUoMifnESzZl15y791HH1qU2xm6eCJU5ZPXQ=
golang.org/x/sync v0.8.0/go
---
[Medium] chunk lines 3041-3060 in go.sum:
github.com/ryanuber/columnize v2.1.2+incompatible/go.mod h1:sm1tb6uqfes/u+d4ooFouqFdy9/2g9QGwK3SQygK0Ts=
github.com/sagikazarmark/crypt v0.6.0/go.mod h1:U8+INwJo3nBv1m6A/8OBXAq7Jnpspk5AxSgDyEQcea8=
github.com/sagikazarmark/locafero v0.4.0 h1:HApY1R9zGo4DBgr7dqsTH/JJxLTTsOt7u6keLGt6kNQ=
github.com/sagikazarmark/locafero v0.4.0/go.mod h1:Pe1W6UlPYUk/+wc/6KFhbORCfqzgYEpgQ3O5fPuL3H4=
github.com/sagikazarmark/slog-shim v0.1.0 h1:diDBnUNK9N/354PgrxMywXnAwEr1QZcOr6gto+ugjYE=
github.com/sagikazarmark/sl
---
[Medium] chunk lines 1961-1980 in go.sum:
github.com/go-openapi/jsonreference v0.21.0/go.mod h1:LmZmgsrTkVg9LG4EaHeY8cBDslNPMo06cago5JNLkm4=
github.com/go-openapi/loads v0.21.3/go.mod h1:Y3aMR24iHbKHppOj91nQ/SHc0cuPbAr4ndY4a02xydc=
github.com/go-openapi/loads v0.21.5/go.mod h1:PxTsnFBoBe+z89riT+wYt3prmSBP6GDAQh2l9H1Flz8=
github.com/go-openapi/loads v0.22.0 h1:ECPGd4jX1U6NApCGG1We+uEozOAvXvJSF4nnwHZ8Aco=
github.com/go-openapi/loads v0.22.0/go.mod h1:yLsaTCS92mnSAZX5WWoxszLj0u+Ojl+Zs5Stn1oF+rs=
github.com/go-openapi/runtime v0.27.1/go.mod
---
[Medium] chunk lines 2661-2680 in go.sum:
github.com/mattn/go-sqlite3 v1.14.22/go.mod h1:Uh1q+B4BYcTPb+yiD3kU8Ct7aC0hY9fxUwlHK0RXw+Y=
github.com/matttproud/golang_protobuf_extensions v1.0.1/go.mod h1:D8He9yQNgCq6Z5Ld7szi9bcBfOoFv/3dc6xSMkL2PC0=
github.com/matttproud/golang_protobuf_extensions v1.0.4 h1:mmDVorXM7PCGKw94cs5zkfA9PSy5pEvNWRP0ET0TIVo=
github.com/matttproud/golang_protobuf_extensions v1.0.4/go.mod h1:BSXmuO+STAnVfrANrmjBb36TMTDstsz7MSK+HVaYKv4=
github.com/matttproud/golang_protobuf_extensions/v2 v2.0.0/go.mod h1:QUyp042oQthUo
---
[Medium] chunk lines 2981-3000 in go.sum:
github.com/prometheus/common/sigv4 v0.1.0 h1:qoVebwtwwEhS85Czm2dSROY5fTo2PAPEVdDeppTwGX4=
github.com/prometheus/common/sigv4 v0.1.0/go.mod h1:2Jkxxk9yYvCkE5G1sQT7GuEXm57JrvHu9k5YwTjsNtI=
github.com/prometheus/exporter-toolkit v0.11.0 h1:yNTsuZ0aNCNFQ3aFTD2uhPOvr4iD7fdBvKPAEGkNf+g=
github.com/prometheus/exporter-toolkit v0.11.0/go.mod h1:BVnENhnNecpwoTLiABx7mrPB/OLRIgN74qlQbV+FK1Q=
github.com/prometheus/procfs v0.0.0-20181005140218-185b4288413d/go.mod h1:c3At6R/oaqEKCNdg8wHV1ftS6bRYblBhIjjI8uT2IG
---
[Medium] chunk lines 4501-4520 in go.sum:
k8s.io/api v0.31.1 h1:Xe1hX/fPW3PXYYv8BlozYqw63ytA92snr96zMW9gWTU=
k8s.io/api v0.31.1/go.mod h1:sbN1g6eY6XVLeqNsZGLnI5FwVseTrZX7Fv3O26rhAaI=
k8s.io/apimachinery v0.29.3/go.mod h1:hx/S4V2PNW4OMg3WizRrHutyB5la0iCUbZym+W0EQIU=
k8s.io/apimachinery v0.31.1 h1:mhcUBbj7KUjaVhyXILglcVjuS4nYXiwC+KKFBgIVy7U=
k8s.io/apimachinery v0.31.1/go.mod h1:rsPdaZJfTfLsNJSQzNHQvYoTmxhoOEofxtOsF3rtsMo=
k8s.io/apiserver v0.31.1 h1:Sars5ejQDCRBY5f7R3QFHdqN3s61nhkpaX8/k1iEw1c=
k8s.io/apiserver v0.31.1/go.mod h1:lzDhpeToa
---
[Medium] chunk lines 3021-3040 in go.sum:
github.com/rogpeppe/go-internal v1.9.0/go.mod h1:WtVeX8xhTBvf0smdhujwtBcq4Qrzq/fJaraNFVN+nFs=
github.com/rogpeppe/go-internal v1.10.0/go.mod h1:UQnix2H7Ngw/k4C5ijL5+65zddjncjaFoBhdsK/akog=
github.com/rogpeppe/go-internal v1.11.0/go.mod h1:ddIwULY96R17DhadqLgMfk9H9tvdUzkipdSkR5nkCZA=
github.com/rogpeppe/go-internal v1.13.1 h1:KvO1DLK/DRN07sQ1LQKScxyZJuNnedQ5/wKSR38lUII=
github.com/rogpeppe/go-internal v1.13.1/go.mod h1:uMEvuHeurkdAXX61udpOXGD/AzZDWNMNyH2VO9fmH0o=
github.com/rs/cors v1.10.1/go.mod
---
[Medium] chunk lines 1781-1800 in go.sum:
github.com/digitalocean/godo v1.113.0/go.mod h1:Z2mTP848Vi3IXXl5YbPekUgr4j4tOePomA+OE1Ag98w=
github.com/distribution/reference v0.5.0 h1:/FUIFXtfc/x2gpa5/VGfiGLuOIdYa1t65IKK2OFGvA0=
github.com/distribution/reference v0.5.0/go.mod h1:BbU0aIcezP1/5jX/8MP0YiH4SdvB5Y4f/wlDRiLyi3E=
github.com/dlmiddlecote/sqlstats v1.0.2 h1:gSU11YN23D/iY50A2zVYwgXgy072khatTsIW6UPjUtI=
github.com/dlmiddlecote/sqlstats v1.0.2/go.mod h1:0CWaIh/Th+z2aI6Q9Jpfg/o21zmGxWhbByHgQSCUQvY=
github.com/dnaeon/go-vcr v1.1.0/go.mod 
---
[Medium] chunk lines 3921-3940 in go.sum:
golang.org/x/tools v0.0.0-20191216173652-a0e659d51361/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=
golang.org/x/tools v0.0.0-20191227053925-7b8e75db28f4/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=
golang.org/x/tools v0.0.0-20200103221440-774c71fcf114/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=
golang.org/x/tools v0.0.0-20200117161641-43d50277825c/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=
golang.org/x/tools v0.0.0-20200122220014-bf1340f18c4a/go.mod h1:
---
[Medium] chunk lines 3401-3420 in go.sum:
golang.org/x/crypto v0.0.0-20191011191535-87dc89f01550/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
golang.org/x/crypto v0.0.0-20200323165209-0ec3e9974c59/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
golang.org/x/crypto v0.0.0-20200414173820-0848c9571904/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
golang.org/x/crypto v0.0.0-20200622213623-75b288015ac9/go.mod h1:LzIPMQfyMNhhGPhUkYOs5KpL4U8rLKemX1yGLhDgUto=
golang.org/x/crypto v0.0.0-20200820211705-5c72a883971a/go.mo
---
[Medium] chunk lines 3721-3740 in go.sum:
golang.org/x/sys v0.0.0-20191112214154-59a1497f0cea/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20191120155948-bd437916bb0e/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20191204072324-ce4227a45e2e/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20191220142924-d4481acd189f/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20191228213918-04cbcbbfeed8/go.mod h1:h1NjWce9XR
---
[Medium] chunk lines 1881-1900 in go.sum:
github.com/frankban/quicktest v1.14.6/go.mod h1:4ptaffx2x8+WTWXmUCuVU6aPUX1/Mz7zb5vbUoiM6w0=
github.com/fsnotify/fsnotify v1.4.7/go.mod h1:jwhsz4b93w/PPRr/qN1Yymfu8t87LnFCMoQvtojpjFo=
github.com/fsnotify/fsnotify v1.4.9/go.mod h1:znqG4EE+3YCdAaPaxE2ZRY/06pZUdp0tY4IgpuI1SZQ=
github.com/fsnotify/fsnotify v1.5.4/go.mod h1:OVB6XrOHzAwXMpEM7uPOzcehqUV2UqJxmVXmkdnm1bU=
github.com/fsnotify/fsnotify v1.7.0 h1:8JEhPFa5W2WU7YfeZzPNqzMP6Lwt7L2715Ggo0nosvA=
github.com/fsnotify/fsnotify v1.7.0/go.mod h1:40Bi
---
[Medium] chunk lines 1421-1440 in go.sum:
github.com/BurntSushi/toml v1.4.0/go.mod h1:ukJfTF/6rtPPRCnwkur4qwRxa8vTRFBF0uk2lLoLwho=
github.com/BurntSushi/xgb v0.0.0-20160522181843-27f122750802/go.mod h1:IVnqGOEym/WlBOVXweHU+Q+/VP0lqqI8lqeDx9IjBqo=
github.com/Code-Hex/go-generics-cache v1.5.1 h1:6vhZGc5M7Y/YD8cIUcY8kcuQLB4cHR7U+0KMqAA0KcU=
github.com/Code-Hex/go-generics-cache v1.5.1/go.mod h1:qxcC9kRVrct9rHeiYpFWSoW1vxyillCVzX13KZG8dl4=
github.com/DATA-DOG/go-sqlmock v1.5.2 h1:OcvFkGmslmlZibjAjaHm3L//6LiuBgolP7OputlJIzU=
github.com/DATA-
---
[Medium] chunk lines 3821-3840 in go.sum:
golang.org/x/sys v0.14.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.15.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.16.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.17.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.18.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.19.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=
golang.org/x/sys v0.
---
[Medium] chunk lines 3861-3880 in go.sum:
golang.org/x/text v0.3.6/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
golang.org/x/text v0.3.7/go.mod h1:u+2+/6zg+i71rQMx5EYifcz6MCKuco9NR6JIITiCfzQ=
golang.org/x/text v0.3.8/go.mod h1:E6s5w1FMmriuDzIBO73fBruAKo1PCIq6d2Q6DHfQ8WQ=
golang.org/x/text v0.4.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=
golang.org/x/text v0.5.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=
golang.org/x/text v0.6.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=
golang.org/x/text v0
---
[Medium] chunk lines 3901-3920 in go.sum:
golang.org/x/tools v0.0.0-20190425222832-ad9eeb80039a/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=
golang.org/x/tools v0.0.0-20190506145303-2d16b83fe98c/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=
golang.org/x/tools v0.0.0-20190524140312-2c0ae7006135/go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=
golang.org/x/tools v0.0.0-20190606124116-d0a3d012864b/go.mod h1:/rFqwRUd4F7ZHNgwSSTFct+R/Kf4OFW1sUzUTQQTgfc=
golang.org/x/tools v0.0.0-20190621195816-6e04913cbbac/go.mod h1:
---
[Medium] chunk lines 4141-4160 in go.sum:
google.golang.org/genproto v0.0.0-20210303154014-9728d6b83eeb/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=
google.golang.org/genproto v0.0.0-20210310155132-4ce2db91004e/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=
google.golang.org/genproto v0.0.0-20210319143718-93e7006c17a6/go.mod h1:FWY/as6DDZQgahTzZj3fqbO1CbirC29ZNUFHwi0/+no=
google.golang.org/genproto v0.0.0-20210329143202-679c6ae281ee/go.mod h1:9lPAdzaEmUacj36I+k7YKbEc5CXzPIeORRgDAUOu28A=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 3461-3480 in go.sum:
golang.org/x/exp v0.0.0-20240119083558-1b970713d09a/go.mod h1:idGWGoKP1toJGkd5/ig9ZLuPcZBC3ewk7SzmH0uou08=
golang.org/x/exp v0.0.0-20240904232852-e7e105dedf7e h1:I88y4caeGeuDQxgdoFPUq097j7kNfw6uvuiNxUBfcBk=
golang.org/x/exp v0.0.0-20240904232852-e7e105dedf7e/go.mod h1:akd2r19cwCdwSwWeIdzYQGa/EZZyqcOdwWiwj5L5eKQ=
golang.org/x/image v0.0.0-20180708004352-c73c2afc3b81/go.mod h1:ux5Hcp/YLpHSI86hEcLt0YII63i6oz57MZXIpbrjZUs=
golang.org/x/image v0.0.0-20190227222117-0694c2d4d067/go.mod h1:kZ7UVZpmo3dzQ
---
[Medium] chunk lines 2281-2300 in go.sum:
github.com/grafana/grafana-plugin-sdk-go v0.114.0/go.mod h1:D7x3ah+1d4phNXpbnOaxa/osSaZlwh9/ZUnGGzegRbk=
github.com/grafana/grafana-plugin-sdk-go v0.255.0 h1:e9bmDTdpR6Ho9ru+UhyVoWguVSSGFgInRjOsl4AftBQ=
github.com/grafana/grafana-plugin-sdk-go v0.255.0/go.mod h1:sE25SkFQSj8DwX4qkF7w++6KL6mzOXo1ycDlk9GgFGw=
github.com/grafana/grafana/apps/playlist v0.0.0-20240917082838-e2bce38a7990 h1:uQMZE/z+Y+o/U0z/g8ckAHss7U7LswedilByA2535DU=
github.com/grafana/grafana/apps/playlist v0.0.0-20240917082838-e2bce
---
[Medium] chunk lines 1741-1760 in go.sum:
github.com/cpuguy83/go-md2man/v2 v2.0.4/go.mod h1:tgQtvFlXSQOSOSIRvRPT7W67SCa46tRHOmNcaadrF8o=
github.com/creack/pty v1.1.7/go.mod h1:lj5s0c3V2DBrqTV7llrYr5NG6My20zk30Fl46Y7DoTY=
github.com/creack/pty v1.1.9/go.mod h1:oKZEueFk5CKHvIhNR5MUki03XCEU+Q6VDXinZuGJ33E=
github.com/creack/pty v1.1.11/go.mod h1:oKZEueFk5CKHvIhNR5MUki03XCEU+Q6VDXinZuGJ33E=
github.com/cznic/b v0.0.0-20180115125044-35e9bbe41f07/go.mod h1:URriBxXwVq5ijiJ12C7iIZqlA69nTlI+LgI6/pwftG8=
github.com/cznic/fileutil v0.0.0-2018010821
---
[Medium] chunk lines 2841-2860 in go.sum:
github.com/onsi/gomega v1.27.8/go.mod h1:2J8vzI/s+2shY9XHRApDkdgPo1TKT7P2u6fXeJKFnNQ=
github.com/onsi/gomega v1.27.10/go.mod h1:RsS8tutOdbdgzbPtzzATp12yT7kM5I5aElG3evPbQ0M=
github.com/onsi/gomega v1.29.0/go.mod h1:9sxs+SwGrKI0+PWe4Fxa9tFQQBG5xSsSbMXOI8PPpoQ=
github.com/onsi/gomega v1.34.1 h1:EUMJIKUjM8sKjYbtxQI9A4z2o+rruxnzNvpknOXie6k=
github.com/onsi/gomega v1.34.1/go.mod h1:kU1QgUvBDLXBJq618Xvm2LUX6rSAfRaFRTcdOeDLwwY=
github.com/op/go-logging v0.0.0-20160315200505-970db520ece7/go.mod h1:HzydrM
---
[Medium] chunk lines 4461-4480 in go.sum:
gopkg.in/ini.v1 v1.67.0/go.mod h1:pNLf8WUiyNEtQjuu5G5vTm06TEv9tsIgeAvK8hOrP4k=
gopkg.in/mail.v2 v2.3.1 h1:WYFn/oANrAGP2C0dcV6/pbkPzv8yGzqTjPmTeO7qoXk=
gopkg.in/mail.v2 v2.3.1/go.mod h1:htwXN1Qh09vZJ1NVKxQqHPBaCBbzKhp5GzuJEA4VJWw=
gopkg.in/natefinch/lumberjack.v2 v2.2.1 h1:bBRl1b0OH9s/DuPhuXpNl+VtCaJXFZ5/uEFST95x9zc=
gopkg.in/natefinch/lumberjack.v2 v2.2.1/go.mod h1:YD8tP3GAjkrDg1eZH7EGmyESg/lsYskCTPBJVb9jqSc=
gopkg.in/resty.v1 v1.12.0/go.mod h1:mDo4pnntr5jdWRML875a/NmxYqAlA73dVijT2AXvQQo=
gopkg.
---
[Medium] chunk lines 1461-1480 in go.sum:
github.com/RoaringBitmap/roaring v0.9.1/go.mod h1:h1B7iIUOmnAeb5ytYMvnHJwxMc6LUrwBnzXWRuqTQUc=
github.com/RoaringBitmap/roaring v1.9.3 h1:t4EbC5qQwnisr5PrP9nt0IRhRTb9gMUgQF4t4S2OByM=
github.com/RoaringBitmap/roaring v1.9.3/go.mod h1:6AXUsoIEzDTFFQCe1RbGA6uFONMhvejWj5rqITANK90=
github.com/Shopify/sarama v1.19.0/go.mod h1:FVkBWblsNy7DGZRfXLU0O9RCGt5g3g3yEuWXgklEdEo=
github.com/Shopify/toxiproxy v2.1.4+incompatible/go.mod h1:OXgGpZ6Cli1/URJOF1DMxUHB2q5Ap20/P/eIdh4G0pI=
github.com/VividCortex/gohist
---
[Medium] chunk lines 1621-1640 in go.sum:
github.com/blevesearch/vellum v1.0.5/go.mod h1:atE0EH3fvk43zzS7t1YNdNC7DbmcC3uz+eMD5xZ2OyQ=
github.com/blevesearch/vellum v1.0.10 h1:HGPJDT2bTva12hrHepVT3rOyIKFFF4t7Gf6yMxyMIPI=
github.com/blevesearch/vellum v1.0.10/go.mod h1:ul1oT0FhSMDIExNjIxHqJoGpVrBpKCdgDQNxfqgJt7k=
github.com/blugelabs/bluge v0.1.9 h1:bPgXlcsWugrXNjzeoLdOnvfJpHsyODKpYaAndayl/SM=
github.com/blugelabs/bluge v0.1.9/go.mod h1:5d7LktUkQgvbh5Bmi6tPWtvo4+6uRTm6gAwP+5z6FqQ=
github.com/blugelabs/bluge_segment_api v0.2.0 h1:cCX1Y2y8v
---
[Medium] chunk lines 2101-2120 in go.sum:
github.com/golang/snappy v0.0.0-20170215233205-553a64147049/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/golang/snappy v0.0.0-20180518054509-2e65f85255db/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/golang/snappy v0.0.1/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/golang/snappy v0.0.3/go.mod h1:/XxbfmMg8lxefKM7IXC3fBNl/7bRcc72aCRzEWrmP2Q=
github.com/golang/snappy v0.0.4 h1:yAGX7huGHXlcLOEtBnF4w7FQwA26wojNCwOYAEhLjQM=
github.com/golan
---
[Medium] chunk lines 3661-3680 in go.sum:
golang.org/x/oauth2 v0.23.0 h1:PbgcYx2W7i4LvjJWEbf0ngHV6qJYr86PkAV3bXdLEbs=
golang.org/x/oauth2 v0.23.0/go.mod h1:XYTD2NtWslqkgxebSiOHnXEap4TF09sJSc7H1sXbhtI=
golang.org/x/sync v0.0.0-20180314180146-1d60e4601c6f/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync v0.0.0-20181108010431-42b317875d0f/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync v0.0.0-20181221193216-37e7f081c4d4/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=
golang.org/x/sync
---
[Medium] chunk lines 4061-4080 in go.sum:
google.golang.org/api v0.103.0/go.mod h1:hGtW6nK1AC+d9si/UBhw8Xli+QMOf6xyNAyJw4qU9w0=
google.golang.org/api v0.106.0/go.mod h1:2Ts0XTHNVWxypznxWOYUeI4g3WdP9Pk2Qk58+a/O9MY=
google.golang.org/api v0.107.0/go.mod h1:2Ts0XTHNVWxypznxWOYUeI4g3WdP9Pk2Qk58+a/O9MY=
google.golang.org/api v0.108.0/go.mod h1:2Ts0XTHNVWxypznxWOYUeI4g3WdP9Pk2Qk58+a/O9MY=
google.golang.org/api v0.110.0/go.mod h1:7FC4Vvx1Mooxh8C5HWjzZHcavuS2f6pmJpZx60ca7iI=
google.golang.org/api v0.111.0/go.mod h1:qtFHvU9mhgTJegR31csQ+rwxyUTHO
---
[Medium] chunk lines 1801-1820 in go.sum:
github.com/docopt/docopt-go v0.0.0-20180111231733-ee0de3bc6815/go.mod h1:WwZ+bS3ebgob9U8Nd0kOddGdZWjyMGR8Wziv+TBNwSE=
github.com/dolthub/maphash v0.1.0 h1:bsQ7JsF4FkkWyrP3oCnFJgrCUAFbFf3kOl4L/QxPDyQ=
github.com/dolthub/maphash v0.1.0/go.mod h1:gkg4Ch4CdCDu5h6PMriVLawB7koZ+5ijb9puGMV50a4=
github.com/dustin/go-humanize v0.0.0-20171111073723-bb3d318650d4/go.mod h1:HtrtbFcZ19U5GC7JDqmcUSB87Iq5E25KnS6fMYU6eOk=
github.com/dustin/go-humanize v1.0.0/go.mod h1:HtrtbFcZ19U5GC7JDqmcUSB87Iq5E25KnS6fMYU6eOk=
---
[Medium] chunk lines 3341-3360 in go.sum:
go.opentelemetry.io/otel/sdk v1.31.0/go.mod h1:TfRbMdhvxIIr/B2N2LQW2S5v9m3gOQ/08KsbbO5BPT0=
go.opentelemetry.io/otel/trace v1.17.0/go.mod h1:I/4vKTgFclIsXRVucpH25X0mpFSczM7aHeaz0ZBLWjY=
go.opentelemetry.io/otel/trace v1.19.0/go.mod h1:mfaSyvGyEJEI0nyV2I4qhNQnbBOUUmYZpYojqMnX2vo=
go.opentelemetry.io/otel/trace v1.21.0/go.mod h1:LGbsEB0f9LGjN+OZaQQ26sohbOmiMR+BaslueVtS/qQ=
go.opentelemetry.io/otel/trace v1.22.0/go.mod h1:RbbHXVqKES9QhzZq/fE5UnOSILqRt40a21sPw2He1xo=
go.opentelemetry.io/otel/trace v
---
[Medium] chunk lines 4101-4120 in go.sum:
google.golang.org/genproto v0.0.0-20190404172233-64821d5d2107/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=
google.golang.org/genproto v0.0.0-20190418145605-e7d98fc518a7/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=
google.golang.org/genproto v0.0.0-20190425155659-357c62f0e4bb/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=
google.golang.org/genproto v0.0.0-20190502173448-54afdca5d873/go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5/KpmUdxsrq26oE=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 2001-2020 in go.sum:
github.com/go-sql-driver/mysql v1.7.1/go.mod h1:OXbVy3sEdcQ2Doequ6Z5BW6fXNQTmx+9S1MCJN5yJMI=
github.com/go-stack/stack v1.8.0/go.mod h1:v0f6uXyyMGvRgIKkXu+yp6POWl0qKG85gN/melR3HDY=
github.com/go-stack/stack v1.8.1 h1:ntEHSVwIt7PNXNpgPmVfMrNhLtgjlmnZha2kOpuRiDw=
github.com/go-stack/stack v1.8.1/go.mod h1:dcoOX6HbPZSZptuspn9bctJ+N/CnF5gGygcUP3XYfe4=
github.com/go-task/slim-sprig v0.0.0-20210107165309-348f09dbbbc0/go.mod h1:fyg7847qk6SyHyPtNmDHnmrv/HOrqktSC+C9fM+CJOE=
github.com/go-task/slim-sprig 
---
[Medium] chunk lines 3221-3240 in go.sum:
github.com/yudai/golcs v0.0.0-20170316035057-ecda9a501e82 h1:BHyfKlQyqbsFN5p3IfnEUduWvb9is428/nNb5L3U01M=
github.com/yudai/golcs v0.0.0-20170316035057-ecda9a501e82/go.mod h1:lgjkn3NuSvDfVJdfcVVdX+jpBxNmX4rDAzaS45IcYoM=
github.com/yudai/pp v2.0.1+incompatible h1:Q4//iY4pNF6yPLZIigmvcl7k/bPgrcTPIFIcmawg5bI=
github.com/yudai/pp v2.0.1+incompatible/go.mod h1:PuxR/8QJ7cyCkFp/aUDS+JY727OFEZkTdatxwunjIkc=
github.com/yuin/goldmark v1.1.25/go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=
github.com
---
[Medium] chunk lines 2421-2440 in go.sum:
github.com/hashicorp/memberlist v0.5.0 h1:EtYPN8DpAURiapus508I4n9CzHs2W+8NZGbmmR/prTM=
github.com/hashicorp/memberlist v0.5.0/go.mod h1:yvyXLpo0QaGE59Y7hDTsTzDD25JYBZ4mHgHUZ8lrOI0=
github.com/hashicorp/nomad/api v0.0.0-20240418183417-ea5f2f6748c7 h1:pjE59CS2C9Bg+Xby0ROrnZSSBWtKwx3Sf9gqsrvIFSA=
github.com/hashicorp/nomad/api v0.0.0-20240418183417-ea5f2f6748c7/go.mod h1:svtxn6QnrQ69P23VvIWMR34tg3vmwLz4UdUzm1dSCgE=
github.com/hashicorp/serf v0.8.2/go.mod h1:6hOLApaqBFA1NXqRQAsxw9QxuDEvNxSQRwA/Jwenr
---
[Medium] chunk lines 3601-3620 in go.sum:
golang.org/x/net v0.9.0/go.mod h1:d48xBJpPfHeWQsugry2m+kC02ZBRGRgulfHnEXEuWns=
golang.org/x/net v0.10.0/go.mod h1:0qNGK6F8kojg2nk9dLZ2mShWaEBan6FAoqfSigmmuDg=
golang.org/x/net v0.11.0/go.mod h1:2L/ixqYpgIVXmeoSA/4Lu7BzTG4KIyPIryS4IsOd1oQ=
golang.org/x/net v0.12.0/go.mod h1:zEVYFnQC7m/vmpQFELhcD1EWkZlX69l4oqgmer6hfKA=
golang.org/x/net v0.14.0/go.mod h1:PpSgVXXLK0OxS0F31C1/tv6XNguvCrnXIDrFMspZIUI=
golang.org/x/net v0.15.0/go.mod h1:idbUs1IY1+zTqbi8yxTbhexhEEk5ur9LInksu6HrEpk=
golang.org/x/net v0.1
---
[Medium] chunk lines 3321-3340 in go.sum:
go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.31.0/go.mod h1:B5Ki776z/MBnVha1Nzwp5arlzBbE3+1jk+pGmaP5HME=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.25.0/go.mod h1:8GlBGcDk8KKi7n+2S4BT/CPZQYH3erLu0/k64r1MYgo=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.31.0 h1:FFeLy03iVTXP6ffeN2iXrxfGsZGCjVx0/4KlizjyBwU=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.31.0/go.mod h1:TMu73/k1CP8nBUpDLc71Wj/Kf7ZS9FK5b53VapRsP9o=
go.openteleme
---
[Medium] chunk lines 3761-3780 in go.sum:
golang.org/x/sys v0.0.0-20210330210617-4fbd30eecc44/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210403161142-5e06dd20ab57/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210423082822-04245dca01da/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210423185535-09eb48e85fd7/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20210510120138-977fb7262007/go.mod h1:oPkhp1MJrh
---
[Medium] chunk lines 4081-4100 in go.sum:
google.golang.org/api v0.164.0/go.mod h1:2OatzO7ZDQsoS7IFf3rvsE17/TldiU3F/zxFHeqUB5o=
google.golang.org/api v0.169.0/go.mod h1:gpNOiMA2tZ4mf5R9Iwf4rK/Dcz0fbdIgWYWVoxmsyLg=
google.golang.org/api v0.174.0/go.mod h1:aC7tB6j0HR1Nl0ni5ghpx6iLasmAX78Zkh/wgxAAjLg=
google.golang.org/api v0.191.0 h1:cJcF09Z+4HAB2t5qTQM1ZtfL/PemsLFkcFG67qq2afk=
google.golang.org/api v0.191.0/go.mod h1:tD5dsFGxFza0hnQveGfVk9QQYKcfp+VzgRqyXFxE0+E=
google.golang.org/appengine v1.1.0/go.mod h1:EbEs0AVv82hx2wNQdGPgUI5lhzA/G0D9
---
[Medium] chunk lines 4341-4360 in go.sum:
google.golang.org/genproto/googleapis/rpc v0.0.0-20240304161311-37d4d3c04a78/go.mod h1:UCOku4NytXMJuLQE5VuqA5lX3PcHCBo8pxNyvkf4xBs=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240311132316-a219d84964c2/go.mod h1:UCOku4NytXMJuLQE5VuqA5lX3PcHCBo8pxNyvkf4xBs=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240401170217-c3f982113cda/go.mod h1:WtryC6hu0hhx87FDGxWCDptyssuo68sk10vYjF+T9fY=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240415141817-7cd4c1c1f9ec/go.mod h1:WtryC6hu0hhx87FDG
---
[Medium] chunk lines 1701-1720 in go.sum:
github.com/cncf/udpa/go v0.0.0-20210930031921-04548b0d99d4/go.mod h1:6pvJx4me5XPnfI9Z40ddWsdw2W/uZgQLFXToKeRcDiI=
github.com/cncf/udpa/go v0.0.0-20220112060539-c52dc94e7fbe/go.mod h1:6pvJx4me5XPnfI9Z40ddWsdw2W/uZgQLFXToKeRcDiI=
github.com/cncf/xds/go v0.0.0-20210312221358-fbca930ec8ed/go.mod h1:eXthEFrGJvWHgFFCl3hGmgk+/aYT6PnTQLykKQRLhEs=
github.com/cncf/xds/go v0.0.0-20210805033703-aa0b78936158/go.mod h1:eXthEFrGJvWHgFFCl3hGmgk+/aYT6PnTQLykKQRLhEs=
github.com/cncf/xds/go v0.0.0-20210922020428-2
---
[Medium] chunk lines 2461-2480 in go.sum:
github.com/influxdata/influxdb1-client v0.0.0-20191209144304-8bf82d3c094d/go.mod h1:qj24IKcXYK6Iy9ceXlo3Tc+vtHo9lIhSX5JddghvEPo=
github.com/influxdata/influxdb1-client v0.0.0-20200827194710-b269163b24ab/go.mod h1:qj24IKcXYK6Iy9ceXlo3Tc+vtHo9lIhSX5JddghvEPo=
github.com/influxdata/line-protocol v0.0.0-20210922203350-b1ad95c89adf h1:7JTmneyiNEwVBOHSjoMxiWAqB992atOeepeFYegn5RU=
github.com/influxdata/line-protocol v0.0.0-20210922203350-b1ad95c89adf/go.mod h1:xaLFMmpvUxqXtVkUJfg9QmT88cDaCJ3ZKgdZ78oO8Q
---
[Medium] chunk lines 4021-4040 in go.sum:
google.golang.org/api v0.24.0/go.mod h1:lIXQywCXRcnZPGlsd8NbLnOjtAoL6em04bJ9+z0MncE=
google.golang.org/api v0.28.0/go.mod h1:lIXQywCXRcnZPGlsd8NbLnOjtAoL6em04bJ9+z0MncE=
google.golang.org/api v0.29.0/go.mod h1:Lcubydp8VUV7KeIHD9z2Bys/sm/vGKnG1UHuDBSrHWM=
google.golang.org/api v0.30.0/go.mod h1:QGmEvQ87FHZNiUVJkT14jQNYJ4ZJjdRF23ZXz5138Fc=
google.golang.org/api v0.35.0/go.mod h1:/XrVsuzM0rZmrsbjJutiuftIzeuTQcEeaYcSk/mQ1dg=
google.golang.org/api v0.36.0/go.mod h1:+z5ficQTmoYpPn8LCUNVpK5I7hwkpjbcgqA
---
[Medium] chunk lines 3141-3160 in go.sum:
github.com/stretchr/testify v1.3.0/go.mod h1:M5WIy9Dh21IEIfnGCwXGc5bZfKNJtfHm1UVUgZn+9EI=
github.com/stretchr/testify v1.4.0/go.mod h1:j7eGeouHqKxXV5pUuKE4zz7dFj8WfuZ+81PSLYec5m4=
github.com/stretchr/testify v1.5.1/go.mod h1:5W2xD1RspED5o8YsWQXVCued0rvSQ+mT+I5cxcmMvtA=
github.com/stretchr/testify v1.6.1/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/stretchr/testify v1.7.0/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=
github.com/stretchr/testify v1.7.1/go.mod h1:6Fq8o
---
[Medium] chunk lines 3781-3800 in go.sum:
golang.org/x/sys v0.0.0-20211019181941-9d821ace8654/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211025201205-69cdffdb9359/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211124211545-fe61309f8881/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211210111614-af8b64212486/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
golang.org/x/sys v0.0.0-20211216021012-1d35b9e2eb4e/go.mod h1:oPkhp1MJrh
---
[Medium] chunk lines 2801-2820 in go.sum:
github.com/onsi/ginkgo v1.7.0/go.mod h1:lLunBs/Ym6LB5Z9jYTR76FiuTmxDTDusOGeTQH+WWjE=
github.com/onsi/ginkgo v1.12.1/go.mod h1:zj2OWP4+oCPe1qIXoGWkgMRwljMUYCdkwsT2108oapk=
github.com/onsi/ginkgo v1.16.2/go.mod h1:CObGmKUOKaSC0RjmoAK7tKyn4Azo5P2IWuoMnvwxz1E=
github.com/onsi/ginkgo v1.16.4/go.mod h1:dX+/inL/fNMqNlz0e9LfyB9TswhZpCVdJM/Z6Vvnwo0=
github.com/onsi/ginkgo v1.16.5 h1:8xi0RTUf59SOSfEtZMvwTvXYMzG4gV23XVHOZiXNtnE=
github.com/onsi/ginkgo v1.16.5/go.mod h1:+E8gABHa3K6zRBolWtd+ROzc/U5bkGt0FwiG0
---
[Medium] chunk lines 4201-4220 in go.sum:
google.golang.org/genproto v0.0.0-20220915135415-7fd63a7952de/go.mod h1:0Nb8Qy+Sk5eDzHnzlStwW3itdNaWoZA5XeSG+R3JHSo=
google.golang.org/genproto v0.0.0-20220916172020-2692e8806bfa/go.mod h1:0Nb8Qy+Sk5eDzHnzlStwW3itdNaWoZA5XeSG+R3JHSo=
google.golang.org/genproto v0.0.0-20220919141832-68c03719ef51/go.mod h1:0Nb8Qy+Sk5eDzHnzlStwW3itdNaWoZA5XeSG+R3JHSo=
google.golang.org/genproto v0.0.0-20220920201722-2b89144ce006/go.mod h1:ht8XFiar2npT/g4vkk7O0WYS1sHOHbdujxbEp7CJWbw=
google.golang.org/genproto v0.0.
---
[Medium] chunk lines 3621-3640 in go.sum:
golang.org/x/oauth2 v0.0.0-20190402181905-9f3314589c9a/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=
golang.org/x/oauth2 v0.0.0-20190604053449-0f29369cfe45/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=
golang.org/x/oauth2 v0.0.0-20191202225959-858c2ad4c8b6/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=
golang.org/x/oauth2 v0.0.0-20200107190931-bf48bf16ab8d/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=
golang.org/x/oauth2 v0.0.0-20200902213428-5d25da1a8d43/go.mo
---
[Medium] chunk lines 4281-4300 in go.sum:
google.golang.org/genproto/googleapis/api v0.0.0-20230920204549-e6e6cdab5c13/go.mod h1:RdyHbowztCGQySiCvQPgWQWgWhGnouTdCflKoDBt32U=
google.golang.org/genproto/googleapis/api v0.0.0-20231002182017-d307bd883b97/go.mod h1:iargEX0SFPm3xcfMI0d1domjg0ZF4Aa0p2awqyxhvF0=
google.golang.org/genproto/googleapis/api v0.0.0-20231012201019-e917dd12ba7a/go.mod h1:SUBoKXbI1Efip18FClrQVGjWcyd0QZd8KkvdP34t7ww=
google.golang.org/genproto/googleapis/api v0.0.0-20231016165738-49dd2c1f3d0b/go.mod h1:IBQ646DjkDkvUIsVq
---
[Medium] chunk lines 2761-2780 in go.sum:
github.com/mxk/go-flowrate v0.0.0-20140419014527-cca7078d478f/go.mod h1:ZdcZmHo+o7JKHSa8/e818NopupXU1YMK5fe1lsApnBw=
github.com/nakagami/firebirdsql v0.0.0-20190310045651-3c02a58cfed8/go.mod h1:86wM1zFnC6/uDBfZGNwB65O+pR2OFi5q/YQaEUid1qA=
github.com/natefinch/wrap v0.2.0 h1:IXzc/pw5KqxJv55gV0lSOcKHYuEZPGbQrOOXr/bamRk=
github.com/natefinch/wrap v0.2.0/go.mod h1:6gMHlAl12DwYEfKP3TkuykYUfLSEAvHw67itm4/KAS8=
github.com/nats-io/jwt v0.3.0/go.mod h1:fRYCDE99xlTsqUzISS1Bi75UBJ6ljOJQOAAu5VglpSg=
github.
---
[Medium] chunk lines 3701-3720 in go.sum:
golang.org/x/sys v0.0.0-20190222072716-a9d3bda3a223/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
golang.org/x/sys v0.0.0-20190312061237-fead79001313/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190412213103-97732733099d/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190422165155-953cdadca894/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
golang.org/x/sys v0.0.0-20190426135247-a129542de9ae/go.mod h1:h1NjWce9XR
---
[Medium] chunk lines 4301-4320 in go.sum:
google.golang.org/genproto/googleapis/api v0.0.0-20241007155032-5fefd90f89a9/go.mod h1:wp2WsuBYj6j8wUdo3ToZsdxxixbvQNAHqVJrTgi5E5M=
google.golang.org/genproto/googleapis/bytestream v0.0.0-20230530153820-e85fd2cbaebc/go.mod h1:ylj+BE99M198VPbBh6A8d9n3w8fChvyLK3wwBOjXBFA=
google.golang.org/genproto/googleapis/bytestream v0.0.0-20230807174057-1744710a1577/go.mod h1:NjCQG/D8JandXxM57PZbAJL1DCNL6EypA0vPPwfsc7c=
google.golang.org/genproto/googleapis/bytestream v0.0.0-20231030173426-d783a09b4405/go.mod
---
[Medium] chunk lines 4441-4460 in go.sum:
gopkg.in/alexcesaro/quotedprintable.v3 v3.0.0-20150716171945-2caba252f4dc h1:2gGKlE2+asNV9m7xrywl36YYNnBG5ZQ0r/BOOxqPpmk=
gopkg.in/alexcesaro/quotedprintable.v3 v3.0.0-20150716171945-2caba252f4dc/go.mod h1:m7x9LTH6d71AHyAX77c9yqWCCa3UKHcVEj9y7hAtKDk=
gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/check.v1 v1.0.0-20180628173108-788fd7840127/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/check.v1 v1.0.0-20190902
---
[Medium] chunk lines 2021-2040 in go.sum:
github.com/gobwas/ws v1.2.1/go.mod h1:hRKAFb8wOxFROYNsT1bqfWnhX+b5MFeJM9r2ZSwg/KY=
github.com/goccy/go-json v0.9.11/go.mod h1:6MelG93GURQebXPDq3khkgXZkazVtN9CRI+MGFi0w8I=
github.com/goccy/go-json v0.10.2/go.mod h1:6MelG93GURQebXPDq3khkgXZkazVtN9CRI+MGFi0w8I=
github.com/goccy/go-json v0.10.3 h1:KZ5WoDbxAIgm2HNbYckL0se1fHD6rz5j4ywS6ebzDqA=
github.com/goccy/go-json v0.10.3/go.mod h1:oq7eo15ShAhp70Anwd5lgX2pLfOS3QCiwU/PULtXL6M=
github.com/goccy/go-yaml v1.9.5/go.mod h1:U/jl18uSupI5rdI2jmuCswEA2htH9e
---
[Medium] chunk lines 2821-2840 in go.sum:
github.com/onsi/ginkgo/v2 v2.13.0/go.mod h1:TE309ZR8s5FsKKpuB1YAQYBzCaAfUgatB/xlT/ETL/o=
github.com/onsi/ginkgo/v2 v2.19.0 h1:9Cnnf7UHo57Hy3k6/m5k3dRfGTMXGvxhHFvkDTCTpvA=
github.com/onsi/ginkgo/v2 v2.19.0/go.mod h1:rlwLi9PilAFJ8jCg9UE1QP6VBpd6/xj3SRC0d6TU0To=
github.com/onsi/gomega v1.4.3/go.mod h1:ex+gbHU/CVuBBDIJjb2X0qEXbFg53c61hWP/1CpauHY=
github.com/onsi/gomega v1.7.1/go.mod h1:XdKZgCCFLUoM/7CFJVPcG8C1xQ1AJ0vpAezJrB7JYyY=
github.com/onsi/gomega v1.10.1/go.mod h1:iN09h71vgCQne3DLsj+A5owkum+a2
---
[Medium] chunk lines 3441-3460 in go.sum:
golang.org/x/exp v0.0.0-20180807140117-3d87b88a115f/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
golang.org/x/exp v0.0.0-20190121172915-509febef88a4/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
golang.org/x/exp v0.0.0-20190125153040-c74c464bbbf2/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
golang.org/x/exp v0.0.0-20190306152737-a1d7652674e8/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
golang.org/x/exp v0.0.0-20190510132918-efd6b22b2522/go.mod h1:ZjyILWgesf
---
[Medium] chunk lines 1541-1560 in go.sum:
github.com/aws/aws-sdk-go v1.40.45/go.mod h1:585smgzpB/KqRA+K3y/NL/oYRqQvpNJYvLm+LY1U59Q=
github.com/aws/aws-sdk-go v1.50.29/go.mod h1:LF8svs817+Nz+DmiMQKTO3ubZ/6IaTpq3TjupRn3Eqk=
github.com/aws/aws-sdk-go v1.51.25/go.mod h1:LF8svs817+Nz+DmiMQKTO3ubZ/6IaTpq3TjupRn3Eqk=
github.com/aws/aws-sdk-go v1.55.5 h1:KKUZBfBoyqy5d3swXyiC7Q76ic40rYcbqH7qjh59kzU=
github.com/aws/aws-sdk-go v1.55.5/go.mod h1:eRwEWoyTWFMVYVQzKMNHWP5/RV4xIUGMQfXQHfHkpNU=
github.com/aws/aws-sdk-go-v2 v0.18.0/go.mod h1:JWVYvqSMppoM
---
[Medium] chunk lines 301-320 in go.work.sum:
github.com/CloudyKit/fastprinter v0.0.0-20200109182630-33d98a066a53 h1:sR+/8Yb4slttB4vD+b9btVEnWgL3Q00OBTzVT8B9C0c=
github.com/CloudyKit/fastprinter v0.0.0-20200109182630-33d98a066a53/go.mod h1:+3IMCy2vIlbG1XG/0ggNQv0SvxCAIpPM5b1nCz56Xno=
github.com/CloudyKit/jet/v6 v6.2.0 h1:EpcZ6SR9n28BUGtNJSvlBqf90IpjeFr36Tizxhn/oME=
github.com/CloudyKit/jet/v6 v6.2.0/go.mod h1:d3ypHeIRNo2+XyqnGA8s+aphtcVpjP5hPwP/Lzo7Ro4=
github.com/DataDog/datadog-go v3.2.0+incompatible h1:qSG2N4FghB1He/r2mFrWKCaL7dXCilEuNEe
---
[Medium] chunk lines 641-660 in go.work.sum:
github.com/hamba/avro/v2 v2.17.2/go.mod h1:Q9YK+qxAhtVrNqOhwlZTATLgLA8qxG2vtvkhK8fJ7Jo=
github.com/hashicorp/consul/api v1.15.3/go.mod h1:/g/qgcoBcEXALCNZgRRisyTW0nY86++L0KbeAMXYCeY=
github.com/hashicorp/consul/sdk v0.11.0/go.mod h1:yPkX5Q6CsxTFMjQQDJwzeNmUUF5NUGGbrDsv9wTb8cw=
github.com/hashicorp/consul/sdk v0.16.0 h1:SE9m0W6DEfgIVCJX7xU+iv/hUl4m/nxqMTnCdMxDpJ8=
github.com/hashicorp/go-hclog v0.14.1/go.mod h1:whpDNt7SSdeAju8AWKIWsul05p54N/39EeqMAyrmvFQ=
github.com/hashicorp/go-immutable-radix v
---
[Medium] chunk lines 681-700 in go.work.sum:
github.com/jstemmer/go-junit-report v0.9.1 h1:6QPYqodiu3GuPL+7mfx+NwDdp2eTkp9IfEUpgAwUN0o=
github.com/jsternberg/zap-logfmt v1.2.0 h1:1v+PK4/B48cy8cfQbxL4FmmNZrjnIMr2BsnyEmXqv2o=
github.com/jsternberg/zap-logfmt v1.2.0/go.mod h1:kz+1CUmCutPWABnNkOu9hOHKdT2q3TDYCcsFy9hpqb0=
github.com/juju/gnuflag v0.0.0-20171113085948-2ce1bb71843d h1:c93kUJDtVAXFEhsCh5jSxyOJmFHuzcihnslQiX8Urwo=
github.com/julienschmidt/httprouter v1.3.0 h1:U0609e9tgbseu3rBINet9P48AI/D3oJs4dN7jwJOQ1U=
github.com/jung-kurt/gofpdf 
---
[Medium] chunk lines 661-680 in go.work.sum:
github.com/iris-contrib/schema v0.0.6 h1:CPSBLyx2e91H2yJzPuhGuifVRnZBBJ3pCOMbOvPZaTw=
github.com/iris-contrib/schema v0.0.6/go.mod h1:iYszG0IOsuIsfzjymw1kMzTL8YQcCWlm65f3wX8J5iA=
github.com/jackc/fake v0.0.0-20150926172116-812a484cc733 h1:vr3AYkKovP8uR8AvSGGUK1IDqRa5lAAvEkZG1LKaCRc=
github.com/jackc/pgx v3.2.0+incompatible h1:0Vihzu20St42/UDsvZGdNE6jak7oi/UOeMzwMPHkgFY=
github.com/jackspirou/syscerts v0.0.0-20160531025014-b68f5469dff1 h1:9Xm8CKtMZIXgcopfdWk/qZ1rt0HjMgfMR9nxxSeK6vk=
github.com/ja
---
[Medium] chunk lines 581-600 in go.work.sum:
github.com/go-playground/locales v0.14.1 h1:EWaQ/wswjilfKLTECiXz7Rh+3BjFhfDFKv/oXslEjJA=
github.com/go-playground/locales v0.14.1/go.mod h1:hxrqLVvrK65+Rwrd5Fc6F2O76J/NuW9t0sjnWqG1slY=
github.com/go-playground/universal-translator v0.18.1 h1:Bcnm0ZwsGyWbCzImXv+pAJnYK9S473LQFuzCbDbfSFY=
github.com/go-playground/universal-translator v0.18.1/go.mod h1:xekY+UJKNuX9WP91TpwSH2VMlDf28Uj24BCp08ZFTUY=
github.com/go-playground/validator/v10 v10.14.1 h1:9c50NUPC30zyuKprjL3vNZ0m5oG+jU0zvx4AqHGnv4k=
github.c
---
[Medium] chunk lines 321-340 in go.work.sum:
github.com/Nvveen/Gotty v0.0.0-20120604004816-cd527374f1e5 h1:TngWCqHvy9oXAN6lEVMRuU21PR1EtLVZJmdB18Gu3Rw=
github.com/OneOfOne/xxhash v1.2.6 h1:U68crOE3y3MPttCMQGywZOLrTeF5HHJ3/vDBCJn9/bA=
github.com/OneOfOne/xxhash v1.2.6/go.mod h1:eZbhyaAYD41SGSSsnmcpxVoRiQ/MPUTjUdIIOT9Um7Q=
github.com/PuerkitoBio/goquery v1.8.1 h1:uQxhNlArOIdbrH1tr0UXwdVFgDcZDrZVdcpygAcwmWM=
github.com/PuerkitoBio/goquery v1.8.1/go.mod h1:Q8ICL1kNUJ2sXGoAhPGUdYDJvgQgHzJsnnd3H7Ho5jQ=
github.com/RaveNoX/go-jsoncommentstrip v1.0
---
[Medium] chunk lines 441-460 in go.work.sum:
github.com/cockroachdb/apd v1.1.0 h1:3LFP3629v+1aKXU5Q37mxmRxX/pIu1nijXydLShEq5I=
github.com/cockroachdb/cockroach-go v0.0.0-20181001143604-e0a95dfd547c h1:2zRrJWIt/f9c9HhNHAgrRgq0San5gRRUJTBXLkchal0=
github.com/cockroachdb/datadriven v0.0.0-20190809214429-80d97fb3cbaa h1:OaNxuTZr7kxeODyLWsRMC+OD03aFUH+mW6r2d+MWa5Y=
github.com/cockroachdb/errors v1.9.1 h1:yFVvsI0VxmRShfawbt/laCIDy/mtTqqnvoNgiy5bEV8=
github.com/cockroachdb/errors v1.9.1/go.mod h1:2sxOtL2WIc096WSZqZ5h8fa17rdDq9HZOZLBCor4mBk=
githu
---
[Medium] chunk lines 381-400 in go.work.sum:
github.com/aws/aws-sdk-go-v2/service/kms v1.35.3 h1:UPTdlTOwWUX49fVi7cymEN6hDqCwe3LNv1vi7TXUutk=
github.com/aws/aws-sdk-go-v2/service/kms v1.35.3/go.mod h1:gjDP16zn+WWalyaUqwCCioQ8gU8lzttCCc9jYsiQI/8=
github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.32.4 h1:NgRFYyFpiMD62y4VPXh4DosPFbZd4vdMVBWKk0VmWXc=
github.com/aws/aws-sdk-go-v2/service/secretsmanager v1.32.4/go.mod h1:TKKN7IQoM7uTnyuFm9bm9cw5P//ZYTl4m3htBWQ1G/c=
github.com/aws/aws-sdk-go-v2/service/sns v1.31.3 h1:eSTEdxkfle2G98FE+Xl3db/X
---
[Medium] chunk lines 541-560 in go.work.sum:
github.com/getsentry/sentry-go v0.12.0/go.mod h1:NSap0JBYWzHND8oMbyi0+XZhUalc1TBdRL1M71JZW2c=
github.com/gin-contrib/sse v0.1.0 h1:Y/yl/+YNO8GZSjAhjMsSuLt29uWRFHdHYUb5lYOV9qE=
github.com/gin-contrib/sse v0.1.0/go.mod h1:RHrZQHXnP2xjPF+u1gW/2HnVO7nvIa9PG3Gm+fLHvGI=
github.com/gin-gonic/gin v1.9.1 h1:4idEAncQnU5cB7BeOkPtxjfCSye0AAm1R0RVIqJ+Jmg=
github.com/gin-gonic/gin v1.9.1/go.mod h1:hPrL7YrpYKXt5YId3A/Tnip5kqbEAP+KLuI3SUcPTeU=
github.com/go-faster/city v1.0.1 h1:4WAxSZ3V2Ws4QRDrscLEDcibJY8uf41H
---
[Medium] chunk lines 341-360 in go.work.sum:
github.com/ajstarks/svgo v0.0.0-20211024235047-1546f124cd8b h1:slYM766cy2nI3BwyRiyQj/Ud48djTMtMebDqepE95rw=
github.com/alecthomas/assert/v2 v2.3.0 h1:mAsH2wmvjsuvyBvAmCtm7zFsBlb8mIHx5ySLVdDZXL0=
github.com/alecthomas/kingpin/v2 v2.4.0 h1:f48lwail6p8zpO1bC4TxtqACaGqHYA22qkHjHpqDjYY=
github.com/alecthomas/kong v0.8.0 h1:ryDCzutfIqJPnNn0omnrgHLbAggDQM2VWHikE1xqK7s=
github.com/alecthomas/kong v0.8.0/go.mod h1:n1iCIO2xS46oE8ZfYCNDqdR0b0wZNrXAIAqro/2132U=
github.com/alecthomas/participle/v2 v2.1.1 h1:
---
[Medium] chunk lines 561-580 in go.work.sum:
github.com/go-fonts/liberation v0.3.2/go.mod h1:N0QsDLVUQPy3UYg9XAc3Uh3UDMp2Z7M1o4+X98dXkmI=
github.com/go-fonts/stix v0.1.0 h1:UlZlgrvvmT/58o573ot7NFw0vZasZ5I6bcIft/oMdgg=
github.com/go-fonts/stix v0.2.2 h1:v9krocr13J1llaOHLEol1eaHsv8S43UuFX/1bFgEJJ4=
github.com/go-fonts/stix v0.2.2/go.mod h1:SUxggC9dxd/Q+rb5PkJuvfvTbOPtNc2Qaua00fIp9iU=
github.com/go-gl/glfw v0.0.0-20190409004039-e6da0acd62b1 h1:QbL/5oDUmRBzO9/Z7Seo6zf912W/a6Sr4Eu0G/3Jho0=
github.com/go-gl/glfw/v3.3/glfw v0.0.0-20200222043503-6
---
[Medium] chunk lines 401-420 in go.work.sum:
github.com/blevesearch/snowball v0.6.1 h1:cDYjn/NCH+wwt2UdehaLpr2e4BwLIjN4V/TdLsL+B5A=
github.com/blevesearch/snowball v0.6.1/go.mod h1:ZF0IBg5vgpeoUhnMza2v0A/z8m1cWPlwhke08LpNusg=
github.com/blevesearch/stempel v0.2.0 h1:CYzVPaScODMvgE9o+kf6D4RJ/VRomyi9uHF+PtB+Afc=
github.com/blevesearch/stempel v0.2.0/go.mod h1:wjeTHqQv+nQdbPuJ/YcvOjTInA2EIc6Ks1FoSUzSLvc=
github.com/blevesearch/vellum v1.0.7 h1:+vn8rfyCRHxKVRgDLeR0FAXej2+6mEb5Q15aQE/XESQ=
github.com/blevesearch/vellum v1.0.7/go.mod h1:doBZpmRh
---
[Medium] chunk lines 601-620 in go.work.sum:
github.com/golang/freetype v0.0.0-20170609003504-e2365dfdc4a0 h1:DACJavvAHhabrF08vX0COfcOBJRhZ8lUbR+ZWIs0Y5g=
github.com/golang/glog v1.2.1 h1:OptwRhECazUx5ix5TTWC3EZhsZEHWcYWY4FQHTIubm4=
github.com/golang/glog v1.2.2 h1:1+mZ9upx1Dh6FmUTFR1naJ77miKiXgALjWOZ3NVFPmY=
github.com/golang/glog v1.2.2/go.mod h1:6AhwSGph0fcJtXVM/PEHPqZlFeoLxhs7/t5UDAwmO+w=
github.com/gomarkdown/markdown v0.0.0-20230922112808-5421fefb8386 h1:EcQR3gusLHN46TAD+G+EbaaqJArt5vHhNpXAa12PQf4=
github.com/gomarkdown/markdown v0.0
---
[Medium] chunk lines 621-640 in go.work.sum:
github.com/gorilla/context v1.1.1 h1:AWwleXJkX/nhcU9bZSnZoi3h/qGYqQAGhq6zZe/aQW8=
github.com/gorilla/css v1.0.0 h1:BQqNyPTi50JCFMTw/b67hByjMVXZRwGha6wxVGkeihY=
github.com/gorilla/css v1.0.0/go.mod h1:Dn721qIggHpt4+EFCcTLTU/vk5ySda2ReITrtgBl60c=
github.com/gorilla/handlers v1.5.1 h1:9lRY6j8DEeeBT10CvO9hGW0gmky0BprnvDI5vfhUHH4=
github.com/gorilla/handlers v1.5.1/go.mod h1:t8XrUpc4KVXb7HGyJ4/cEnwQiaxrX/hz1Zv/4g96P1Q=
github.com/gorilla/mux v1.8.0/go.mod h1:DVbg23sWSpFRCP0SfiEN6jmj59UnW/n46BH5rLB71S
---
[Medium] chunk lines 281-300 in go.work.sum:
github.com/Azure/azure-sdk-for-go/sdk/messaging/azservicebus v1.7.1/go.mod h1:6QAMYBAbQeeKX+REFJMZ1nFWu9XLw/PPcjYpuc9RDFs=
github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/internal v1.1.2 h1:mLY+pNLjCUeKhgnAJWAKhEUQM+RJQo2H1fuGSw1Ky1E=
github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/internal/v2 v2.0.0 h1:PTFGRSlMKCQelWwxUyYVEUqseBJVemLyqWJjvMyt0do=
github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/managementgroups/armmanagementgroups v1.0.0 h1:pPvTJ1dY0sA35JOeFq6TsY2xj6Z85Yo23Pj4w
---
[Medium] chunk lines 521-540 in go.work.sum:
github.com/expr-lang/expr v1.16.2 h1:JvMnzUs3LeVHBvGFcXYmXo+Q6DPDmzrlcSBO6Wy3w4s=
github.com/expr-lang/expr v1.16.2/go.mod h1:uCkhfG+x7fcZ5A5sXHKuQ07jGZRl6J0FCAaf2k4PtVQ=
github.com/fatih/color v1.16.0/go.mod h1:fL2Sau1YI5c0pdGEVCbKQbLXB6edEj1ZgiY4NijnWvE=
github.com/fatih/structs v1.1.0 h1:Q7juDM0QtcnhCpeyLGQKyg4TOIghuNXrkL32pHAUMxo=
github.com/fatih/structs v1.1.0/go.mod h1:9NiDSp5zOcgEDl+j00MP/WkGVPOlPRLejGD8Ga6PJ7M=
github.com/felixge/fgprof v0.9.3 h1:VvyZxILNuCiUCSXtPtYmmtGvb65nqXh2QFWc0Wpf
---
[Medium] chunk lines 501-520 in go.work.sum:
github.com/docopt/docopt-go v0.0.0-20180111231733-ee0de3bc6815 h1:bWDMxwH3px2JBh6AyO7hdCn/PkvCZXii8TGj7sbtEbQ=
github.com/drone/drone-runtime v1.1.0 h1:IsKbwiLY6+ViNBzX0F8PERJVZZcEJm9rgxEh3uZP5IE=
github.com/drone/drone-runtime v1.1.0/go.mod h1:+osgwGADc/nyl40J0fdsf8Z09bgcBZXvXXnLOY48zYs=
github.com/drone/drone-yaml v1.2.3 h1:SWzLmzr8ARhbtw1WsVDENa8WFY2Pi9l0FVMfafVUWz8=
github.com/drone/drone-yaml v1.2.3/go.mod h1:QsqliFK8nG04AHFN9tTn9XJomRBQHD4wcejWW1uz/10=
github.com/drone/funcmap v0.0.0-20211
---
[Medium] chunk lines 421-440 in go.work.sum:
github.com/cenkalti/backoff v2.2.1+incompatible h1:tNowT99t7UNflLxfYYSlKYsBpXdEet03Pg2g16Swow4=
github.com/census-instrumentation/opencensus-proto v0.4.1 h1:iKLQ0xPNFxR/2hzXZMrBo8f1j86j5WHzznCCQxV/b8g=
github.com/cespare/xxhash v1.1.0 h1:a6HrQnmkObjyL+Gs60czilIUGqrzKutQD6XZog3p+ko=
github.com/chenzhuoyu/base64x v0.0.0-20230717121745-296ad89f973d h1:77cEq6EriyTZ0g/qfRdp61a3Uu/AWrgIq2s0ClJV1g0=
github.com/chenzhuoyu/base64x v0.0.0-20230717121745-296ad89f973d/go.mod h1:8EPpVsBuRksnlj1mLy4AWzRNQYxau
---
[Medium] chunk lines 701-720 in go.work.sum:
github.com/kelseyhightower/envconfig v1.4.0 h1:Im6hONhd3pLkfDFsbRgu68RDNkGF1r3dvMUtDTo2cv8=
github.com/kevinmbeaulieu/eq-go v1.0.0 h1:AQgYHURDOmnVJ62jnEk0W/7yFKEn+Lv8RHN6t7mB0Zo=
github.com/kevinmbeaulieu/eq-go v1.0.0/go.mod h1:G3S8ajA56gKBZm4UB9AOyoOS37JO3roToPzKNM8dtdM=
github.com/kisielk/errcheck v1.5.0 h1:e8esj/e4R+SAOwFwN+n3zr0nYeCyeweozKfO23MvHzY=
github.com/kisielk/gotool v1.0.0 h1:AV2c/EiW3KqPNT9ZKl07ehoAGi4C5/01Cfbblndcapg=
github.com/kisielk/sqlstruct v0.0.0-20201105191214-5f3e10d3ab46
---
[Medium] chunk lines 481-500 in go.work.sum:
github.com/cznic/strutil v0.0.0-20171016134553-529a34b1c186 h1:0rkFMAbn5KBKNpJyHQ6Prb95vIKanmAe62KxsrN+sqA=
github.com/cznic/zappy v0.0.0-20160723133515-2533cb5b45cc h1:YKKpTb2BrXN2GYyGaygIdis1vXbE7SSAG9axGWIMClg=
github.com/dave/astrid v0.0.0-20170323122508-8c2895878b14 h1:YI1gOOdmMk3xodBao7fehcvoZsEeOyy/cfhlpCSPgM4=
github.com/dave/brenda v1.1.0 h1:Sl1LlwXnbw7xMhq3y2x11McFu43AjDcwkllxxgZ3EZw=
github.com/dave/courtney v0.3.0 h1:8aR1os2ImdIQf3Zj4oro+lD/L4Srb5VwGefqZ/jzz7U=
github.com/dave/gopack
---
[Medium] chunk lines 741-760 in go.work.sum:
github.com/lyft/protoc-gen-validate v0.0.13 h1:KNt/RhmQTOLr7Aj8PsJ7mTronaFyx80mRTT9qF261dA=
github.com/mailgun/raymond/v2 v2.0.48 h1:5dmlB680ZkFG2RN/0lvTAghrSxIESeu9/2aeDqACtjw=
github.com/mailgun/raymond/v2 v2.0.48/go.mod h1:lsgvL50kgt1ylcFJYZiULi5fjPBkkhNfj4KA0W54Z18=
github.com/matryer/moq v0.3.3 h1:pScMH9VyrdT4S93yiLpVyU8rCDqGQr24uOyBxmktG5Q=
github.com/matryer/moq v0.3.3/go.mod h1:RJ75ZZZD71hejp39j4crZLsEDszGk6iH4v4YsWFKH4s=
github.com/matryer/moq v0.5.0 h1:h2PJUYjZSiyEahzVogDRmrgL9Bsx9xYAl
---
[Medium] chunk lines 721-740 in go.work.sum:
github.com/kshvakov/clickhouse v1.3.5 h1:PDTYk9VYgbjPAWry3AoDREeMgOVUFij6bh6IjlloHL0=
github.com/labstack/echo/v4 v4.11.4 h1:vDZmA+qNeh1pd/cCkEicDMrjtrnMGQ1QFI9gWN1zGq8=
github.com/labstack/echo/v4 v4.11.4/go.mod h1:noh7EvLwqDsmh/X/HWKPUl1AjzJrhyptRyEbQJfxen8=
github.com/labstack/gommon v0.4.2 h1:F8qTUNXgG1+6WQmqoUWnz8WiEU60mXVVw0P4ht1WRA0=
github.com/labstack/gommon v0.4.2/go.mod h1:QlUFxVM+SNXhDL/Z7YhocGIBYOiwB0mXm1+1bAPHPyU=
github.com/ledongthuc/pdf v0.0.0-20220302134840-0c2507a12d80 h1:6Yzf
---
[Medium] chunk lines 461-480 in go.work.sum:
github.com/coreos/pkg v0.0.0-20160727233714-3ac0863d7acf h1:CAKfRE2YtTUIjjh1bkBtyYFaUT/WmOqsJjgtihT0vMI=
github.com/couchbase/ghistogram v0.1.0 h1:b95QcQTCzjTUocDXp/uMgSNQi8oj1tGwnJ4bODWZnps=
github.com/couchbase/ghistogram v0.1.0/go.mod h1:s1Jhy76zqfEecpNWJfWUiKZookAFaiGOEoyzgHt9i7k=
github.com/couchbase/moss v0.2.0 h1:VCYrMzFwEryyhRSeI+/b3tRBSeTpi/8gn5Kf6dxqn+o=
github.com/couchbase/moss v0.2.0/go.mod h1:9MaHIaRuy9pvLPUJxB8sh8OrLfyDczECVL37grCIubs=
github.com/cpuguy83/go-md2man v1.0.10 h1:BSKM
---
[Medium] chunk lines 361-380 in go.work.sum:
github.com/antlr/antlr4/runtime/Go/antlr/v4 v4.0.0-20230512164433-5d1fd1a340c9 h1:goHVqTbFX3AIo0tzGr14pgfAW2ZfPChKO21Z9MGf/gk=
github.com/antlr/antlr4/runtime/Go/antlr/v4 v4.0.0-20230512164433-5d1fd1a340c9/go.mod h1:pSwJ0fSY5KhvocuWSx4fz3BA8OrA1bQn+K1Eli3BRwM=
github.com/apache/arrow/go/arrow v0.0.0-20211112161151-bc219186db40 h1:q4dksr6ICHXqG5hm0ZW5IHyeEJXoIJSOZeBLmWPNeIQ=
github.com/apache/arrow/go/arrow v0.0.0-20211112161151-bc219186db40/go.mod h1:Q7yQnSMnLvcXlZ8RV+jwz/6y1rQTqbX6C82SndT52Zs=
","TablesList (High), ReadQuery (High), Execute (Medium), lines 481-500 (Medium), TablesList (Medium), RunCommands (Medium), QueryFramesInto (Medium), NewInMemoryDB (Medium), lines 501-510 (Medium), lines 4621-4640 (Medium), lines 4641-4653 (Medium), lines 381-400 (Medium), lines 221-240 (Medium), lines 461-480 (Medium), lines 241-260 (Medium), lines 361-380 (Medium), lines 321-340 (Medium), lines 421-440 (Medium), lines 281-300 (Medium), lines 261-280 (Medium), lines 441-460 (Medium), lines 301-320 (Medium), lines 341-360 (Medium), lines 401-420 (Medium), lines 141-160 (Medium), lines 161-180 (Medium), lines 181-200 (Medium), lines 201-220 (Medium), lines 3101-3120 (Medium), lines 4561-4580 (Medium), lines 3641-3660 (Medium), lines 1561-1580 (Medium), lines 2681-2700 (Medium), lines 2121-2140 (Medium), lines 2881-2900 (Medium), lines 1901-1920 (Medium), lines 1761-1780 (Medium), lines 3481-3500 (Medium), lines 3801-3820 (Medium), lines 3361-3380 (Medium), lines 4261-4280 (Medium), lines 2061-2080 (Medium), lines 4581-4600 (Medium), lines 1681-1700 (Medium), lines 2301-2320 (Medium), lines 2521-2540 (Medium), lines 3581-3600 (Medium), lines 1481-1500 (Medium), lines 4161-4180 (Medium), lines 1821-1840 (Medium), lines 1661-1680 (Medium), lines 2181-2200 (Medium), lines 2241-2260 (Medium), lines 3501-3520 (Medium), lines 3881-3900 (Medium), lines 4181-4200 (Medium), lines 4221-4240 (Medium), lines 3301-3320 (Medium), lines 4421-4440 (Medium), lines 4401-4420 (Medium), lines 2941-2960 (Medium), lines 3961-3980 (Medium), lines 3981-4000 (Medium), lines 3841-3860 (Medium), lines 2701-2720 (Medium), lines 3521-3540 (Medium), lines 3261-3280 (Medium), lines 1841-1860 (Medium), lines 4481-4500 (Medium), lines 2261-2280 (Medium), lines 3741-3760 (Medium), lines 2721-2740 (Medium), lines 3161-3180 (Medium), lines 2221-2240 (Medium), lines 1601-1620 (Medium), lines 2341-2360 (Medium), lines 1941-1960 (Medium), lines 2621-2640 (Medium), lines 2741-2760 (Medium), lines 1861-1880 (Medium), lines 1521-1540 (Medium), lines 1441-1460 (Medium), lines 3201-3220 (Medium), lines 3241-3260 (Medium), lines 1921-1940 (Medium), lines 2481-2500 (Medium), lines 2081-2100 (Medium), lines 2141-2160 (Medium), lines 4001-4020 (Medium), lines 4361-4380 (Medium), lines 2861-2880 (Medium), lines 2541-2560 (Medium), lines 2641-2660 (Medium), lines 2901-2920 (Medium), lines 2921-2940 (Medium), lines 2441-2460 (Medium), lines 3381-3400 (Medium), lines 3181-3200 (Medium), lines 2961-2980 (Medium), lines 3281-3300 (Medium), lines 3941-3960 (Medium), lines 3561-3580 (Medium), lines 2401-2420 (Medium), lines 2781-2800 (Medium), lines 4121-4140 (Medium), lines 1501-1520 (Medium), lines 3541-3560 (Medium), lines 4041-4060 (Medium), lines 1721-1740 (Medium), lines 2501-2520 (Medium), lines 3061-3080 (Medium), lines 4381-4400 (Medium), lines 1981-2000 (Medium), lines 2201-2220 (Medium), lines 1581-1600 (Medium), lines 4601-4620 (Medium), lines 2361-2380 (Medium), lines 1641-1660 (Medium), lines 3121-3140 (Medium), lines 2161-2180 (Medium), lines 2581-2600 (Medium), lines 4521-4540 (Medium), lines 2321-2340 (Medium), lines 3001-3020 (Medium), lines 4541-4560 (Medium), lines 3081-3100 (Medium), lines 2381-2400 (Medium), lines 2041-2060 (Medium), lines 2601-2620 (Medium), lines 4321-4340 (Medium), lines 2561-2580 (Medium), lines 4241-4260 (Medium), lines 3421-3440 (Medium), lines 3681-3700 (Medium), lines 3041-3060 (Medium), lines 1961-1980 (Medium), lines 2661-2680 (Medium), lines 2981-3000 (Medium), lines 4501-4520 (Medium), lines 3021-3040 (Medium), lines 1781-1800 (Medium), lines 3921-3940 (Medium), lines 3401-3420 (Medium), lines 3721-3740 (Medium), lines 1881-1900 (Medium), lines 1421-1440 (Medium), lines 3821-3840 (Medium), lines 3861-3880 (Medium), lines 3901-3920 (Medium), lines 4141-4160 (Medium), lines 3461-3480 (Medium), lines 2281-2300 (Medium), lines 1741-1760 (Medium), lines 2841-2860 (Medium), lines 4461-4480 (Medium), lines 1461-1480 (Medium), lines 1621-1640 (Medium), lines 2101-2120 (Medium), lines 3661-3680 (Medium), lines 4061-4080 (Medium), lines 1801-1820 (Medium), lines 3341-3360 (Medium), lines 4101-4120 (Medium), lines 2001-2020 (Medium), lines 3221-3240 (Medium), lines 2421-2440 (Medium), lines 3601-3620 (Medium), lines 3321-3340 (Medium), lines 3761-3780 (Medium), lines 4081-4100 (Medium), lines 4341-4360 (Medium), lines 1701-1720 (Medium), lines 2461-2480 (Medium), lines 4021-4040 (Medium), lines 3141-3160 (Medium), lines 3781-3800 (Medium), lines 2801-2820 (Medium), lines 4201-4220 (Medium), lines 3621-3640 (Medium), lines 4281-4300 (Medium), lines 2761-2780 (Medium), lines 3701-3720 (Medium), lines 4301-4320 (Medium), lines 4441-4460 (Medium), lines 2021-2040 (Medium), lines 2821-2840 (Medium), lines 3441-3460 (Medium), lines 1541-1560 (Medium), lines 301-320 (Medium), lines 641-660 (Medium), lines 681-700 (Medium), lines 661-680 (Medium), lines 581-600 (Medium), lines 321-340 (Medium), lines 441-460 (Medium), lines 381-400 (Medium), lines 541-560 (Medium), lines 341-360 (Medium), lines 561-580 (Medium), lines 401-420 (Medium), lines 601-620 (Medium), lines 621-640 (Medium), lines 281-300 (Medium), lines 521-540 (Medium), lines 501-520 (Medium), lines 421-440 (Medium), lines 701-720 (Medium), lines 481-500 (Medium), lines 741-760 (Medium), lines 721-740 (Medium), lines 461-480 (Medium), lines 361-380 (Medium), lines 501-502 (Low), lines 4621-4638 (Low), enableSqlExpressions (Low)",partial,"NewInMemoryDB is Medium, RunCommands is Medium, not HC"
grafana,8,Frontend Asset Optimization,"The GetWebAssets function implements an incomplete double-checked locking pattern for caching web assets. The function first checks if the cache is populated using a read lock (RLock), and if the cache is empty, it acquires a write lock to populate it. However, it fails to re-check whether the cache was populated by another goroutine while waiting to acquire the write lock.",Medium,1,1,0,"function::GetWebAssets (pkg/api/webassets/webassets.go) [Critical, score=0.80]","[Critical] function GetWebAssets in pkg/api/webassets/webassets.go:
func GetWebAssets(ctx context.Context, cfg *setting.Cfg, license licensing.Licensing) (*dtos.EntryPointAssets, error) {
	entryPointAssetsCacheMu.RLock()
	ret := entryPointAssetsCache
	entryPointAssetsCacheMu.RUnlock()

	if cfg.Env != setting.Dev && ret != nil {
		return ret, nil
	}
	entryPointAssetsCacheMu.Lock()
	defer entryPointAssetsCacheMu.Unlock()

	var err error
	var result *dtos.EntryPointAssets

	cdn := """" // ""https://grafana-assets.grafana.net/grafana/10.3.0-64123/""
	if cdn != """" {
		result, err = readWebAssetsFromCDN(ctx, cdn)
	}

	if result == nil {
		result, err = readWebAssetsFromFile(filepath.Join(cfg.StaticRootPath, ""build"", ""assets-manifest.json""))
		if err == nil {
			cdn, _ = cfg.GetContentDeliveryURL(license.ContentDeliveryPrefix())
			if cdn != """" {
				result.SetConten",,GetWebAssets (Critical),match,'web' matches HC entity 'getwebassets'
grafana,8,Frontend Asset Optimization,"In addition to the missing double-check, the function has a critical flaw in its error handling: it unconditionally assigns the fetch result to the cache (line 69: entryPointAssetsCache = result) regardless of whether the fetch succeeded or failed. When an error occurs during asset fetching, result is nil, and this nil value overwrites any previously valid cache entry.",High,1,1,0,"function::GetWebAssets (pkg/api/webassets/webassets.go) [Critical, score=0.80]","[Critical] function GetWebAssets in pkg/api/webassets/webassets.go:
func GetWebAssets(ctx context.Context, cfg *setting.Cfg, license licensing.Licensing) (*dtos.EntryPointAssets, error) {
	entryPointAssetsCacheMu.RLock()
	ret := entryPointAssetsCache
	entryPointAssetsCacheMu.RUnlock()

	if cfg.Env != setting.Dev && ret != nil {
		return ret, nil
	}
	entryPointAssetsCacheMu.Lock()
	defer entryPointAssetsCacheMu.Unlock()

	var err error
	var result *dtos.EntryPointAssets

	cdn := """" // ""https://grafana-assets.grafana.net/grafana/10.3.0-64123/""
	if cdn != """" {
		result, err = readWebAssetsFromCDN(ctx, cdn)
	}

	if result == nil {
		result, err = readWebAssetsFromFile(filepath.Join(cfg.StaticRootPath, ""build"", ""assets-manifest.json""))
		if err == nil {
			cdn, _ = cfg.GetContentDeliveryURL(license.ContentDeliveryPrefix())
			if cdn != """" {
				result.SetConten",,GetWebAssets (Critical),match,'asset' matches HC entity 'getwebassets'
grafana,7,Database Performance Optimizations,The code uses Error log level for what appears to be debugging information. This will pollute error logs in production. Consider using Debug or Info level instead.,Low,12,2,10,"method::Run (pkg/services/cleanup/cleanup.go) [High, score=0.53] | method::CleanOrphanedAnnotationTags (pkg/services/annotations/annotationsimpl/xorm_store.go) [High, score=0.53]","[High] method Run in pkg/services/cleanup/cleanup.go:
func (srv *CleanUpService) Run(ctx context.Context) error {
	srv.cleanUpTmpFiles(ctx)

	ticker := time.NewTicker(time.Minute * 1)
	for {
		select {
		case <-ticker.C:
			srv.clean(ctx)
		case <-ctx.Done():
			return ctx.Err()
		}
	}
}
---
[High] method CleanOrphanedAnnotationTags in pkg/services/annotations/annotationsimpl/xorm_store.go:
func (r *xormRepositoryImpl) CleanOrphanedAnnotationTags(ctx context.Context) (int64, error) {
	return untilDoneOrCancelled(ctx, func() (int64, error) {
		cond := fmt.Sprintf(`NOT EXISTS (SELECT 1 FROM annotation a WHERE annotation_id = a.id) %s`, r.db.GetDialect().Limit(r.cfg.AnnotationCleanupJobBatchSize))
		ids, err := r.fetchIDs(ctx, ""annotation_tag"", cond)
		if err != nil {
			return 0, err
		}
		r.log.Error(""Tags to clean"", ""count"", len(ids), ""ids"", ids, ""cond"", cond, ""err"", err)

		x, y := r.deleteByIDs(ctx, ""annotation_tag"", ids)
		r.log.Error(""cleaned tags"", ""count"", len(ids), ""affected"", x, ""err"", y)
		return x, y
	})
}","[Medium] function TestAnnotationCleanUp in pkg/services/annotations/annotationsimpl/cleanup_test.go:
func TestAnnotationCleanUp(t *testing.T) {
	fakeSQL := db.InitTestDB(t)

	t.Cleanup(func() {
		err := fakeSQL.WithDbSession(context.Background(), func(session *db.Session) error {
			_, err := session.Exec(""DELETE FROM annotation"")
			return err
		})
		assert.NoError(t, err)
	})

	createTestAnnotations(t, fakeSQL, 21, 6)
	assertAnnotationCount(t, fakeSQL, """", 21)
	assertAnnotationTagCount(t, fakeSQL, 42)

	tests := []struct {
		name                     string
		cfg                      *setting.
---
[Medium] method CleanAnnotations in pkg/services/annotations/annotationsimpl/xorm_store.go:
func (r *xormRepositoryImpl) CleanAnnotations(ctx context.Context, cfg setting.AnnotationCleanupSettings, annotationType string) (int64, error) {
	var totalAffected int64
	if cfg.MaxAge > 0 {
		cutoffDate := timeNow().Add(-cfg.MaxAge).UnixNano() / int64(time.Millisecond)
		// Single-statement approaches, specifically ones using batched sub-queries, seem to deadlock with concurrent inserts on MySQL.
		// We have a bounded batch size, so work around this by first loading the IDs into memory and al
---
[Medium] method fetchIDs in pkg/services/annotations/annotationsimpl/xorm_store.go:
func (r *xormRepositoryImpl) fetchIDs(ctx context.Context, table, condition string) ([]int64, error) {
	sql := fmt.Sprintf(`SELECT id FROM %s`, table)
	if condition == """" {
		return nil, fmt.Errorf(""condition must be supplied; cannot fetch IDs from entire table"")
	}
	sql += fmt.Sprintf(` WHERE %s`, condition)
	ids := make([]int64, 0)
	err := r.db.WithDbSession(ctx, func(session *db.Session) error {
		return session.SQL(sql).Find(&ids)
	})
	return ids, err
}
---
[Medium] method deleteByIDs in pkg/services/annotations/annotationsimpl/xorm_store.go:
func (r *xormRepositoryImpl) deleteByIDs(ctx context.Context, table string, ids []int64) (int64, error) {
	if len(ids) == 0 {
		return 0, nil
	}

	sql := """"
	args := make([]any, 0)

	// SQLite has a parameter limit of 999.
	// If the batch size is bigger than that, and we're on SQLite, we have to put the IDs directly into the statement.
	const sqliteParameterLimit = 999
	if r.db.GetDBType() == migrator.SQLite && r.cfg.AnnotationCleanupJobBatchSize > sqliteParameterLimit {
		values := fmt.Sprint(
---
[Medium] function untilDoneOrCancelled in pkg/services/annotations/annotationsimpl/xorm_store.go:
func untilDoneOrCancelled(ctx context.Context, batchWork func() (int64, error)) (int64, error) {
	var totalAffected int64
	for {
		select {
		case <-ctx.Done():
			return totalAffected, ctx.Err()
		default:
			affected, err := batchWork()
			totalAffected += affected
			if err != nil {
				return totalAffected, err
			}

			if affected == 0 {
				return totalAffected, nil
			}
		}
	}
}
---
[Medium] function createTestAnnotations in pkg/services/annotations/annotationsimpl/cleanup_test.go:
func createTestAnnotations(t *testing.T, store db.DB, expectedCount int, oldAnnotations int) {
	t.Helper()

	cutoffDate := time.Now()

	newAnnotations := make([]*annotations.Item, 0, expectedCount)
	newAnnotationTags := make([]*annotationTag, 0, 2*expectedCount)
	for i := 0; i < expectedCount; i++ {
		a := &annotations.Item{
			ID:          int64(i + 1),
			DashboardID: 1,
			OrgID:       1,
			UserID:      1,
			PanelID:     1,
			Text:        """",
		}

		// mark every third as an API annotation
---
[Medium] function TestIntegrationOldAnnotationsAreDeletedFirst in pkg/services/annotations/annotationsimpl/cleanup_test.go:
func TestIntegrationOldAnnotationsAreDeletedFirst(t *testing.T) {
	if testing.Short() {
		t.Skip(""Skipping integration test"")
	}

	fakeSQL := db.InitTestDB(t)

	t.Cleanup(func() {
		err := fakeSQL.WithDbSession(context.Background(), func(session *db.Session) error {
			_, err := session.Exec(""DELETE FROM annotation"")
			return err
		})
		assert.NoError(t, err)
	})

	// create some test annotations
	a := annotations.Item{
		DashboardID: 1,
		OrgID:       1,
		UserID:      1,
		PanelID:     1,
		A
---
[Medium] function TestIntegrationAnnotationCleanUp in pkg/services/annotations/annotationsimpl/cleanup_test.go:
func TestIntegrationAnnotationCleanUp(t *testing.T) {
	if testing.Short() {
		t.Skip(""Skipping integration test"")
	}

	fakeSQL := db.InitTestDB(t)

	tests := []struct {
		name                    string
		createAnnotationsNum    int
		createOldAnnotationsNum int

		cfg                           *setting.Cfg
		alertAnnotationCount          int64
		annotationCleanupJobBatchSize int
		dashboardAnnotationCount      int64
		APIAnnotationCount            int64
		affectedAnnotations           int64
	}{

---
[Medium] function asAny in pkg/services/annotations/annotationsimpl/xorm_store.go:
func asAny(vs []int64) []any {
	r := make([]any, len(vs))
	for i, v := range vs {
		r[i] = v
	}
	return r
}
---
[Medium] method executeUntilDoneOrCancelled in pkg/services/annotations/annotationsimpl/xorm_store.go:
func (r *xormRepositoryImpl) executeUntilDoneOrCancelled(ctx context.Context, sql string) (int64, error) {
	var totalAffected int64
	for {
		select {
		case <-ctx.Done():
			return totalAffected, ctx.Err()
		default:
			var affected int64
			err := r.db.WithDbSession(ctx, func(session *db.Session) error {
				res, err := session.Exec(sql)
				if err != nil {
					return err
				}

				affected, err = res.RowsAffected()
				totalAffected += affected

				return err
			})
			if err != nil {
				re","Run (High), CleanOrphanedAnnotationTags (High), TestAnnotationCleanUp (Medium), CleanAnnotations (Medium), fetchIDs (Medium), deleteByIDs (Medium), untilDoneOrCancelled (Medium), createTestAnnotations (Medium), TestIntegrationOldAnnotationsAreDeletedFirst (Medium), TestIntegrationAnnotationCleanUp (Medium), asAny (Medium), executeUntilDoneOrCancelled (Medium)",partial,"HC entities exist (2) but no name match; golden idents: {'production', 'uses', 'Debug', 'logs', 'debugging', 'pollute', 'Info', 'appears', 'level', 'log', 'information'}"
grafana,6,Dual Storage Architecture,"The context is being created with d.Log instead of the log variable that was initialized with additional context values (name, kind, method). This means those values won't be propagated to the logging context.",Medium,41,0,39,,,"[Medium] function TestMode1_Get in pkg/apiserver/rest/dualwriter_mode1_test.go:
func TestMode1_Get(t *testing.T) {
	type testCase struct {
		setupLegacyFn  func(m *mock.Mock, name string)
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""get an object only in the legacy store"",
				input: ""foo"",
				setupLegacyFn: func(m *mock.Mock, name string) {
					m.On(""Get"", mock.Anything, name, mock.Anything).Return(exampleObj, nil)
				},
				setupStorageFn: func(m *mock.
---
[Medium] method Create in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Create(ctx context.Context, obj runtime.Object, createValidation rest.ValidateObjectFunc, options *metav1.CreateOptions) (runtime.Object, error) {
	var method = ""create""
	log := d.Log.WithValues(""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	created, err := d.Storage.Create(ctx, obj, createValidation, options)
	if err != nil {
		log.Error(err, ""unable to create object in storage"")
		d.recordLegacyDuration(true, mod
---
[Medium] method Update in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Update(ctx context.Context, name string, objInfo rest.UpdatedObjectInfo, createValidation rest.ValidateObjectFunc, updateValidation rest.ValidateObjectUpdateFunc, forceAllowCreate bool, options *metav1.UpdateOptions) (runtime.Object, bool, error) {
	var method = ""update""
	log := d.Log.WithValues(""name"", name, ""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, async, err := d.Storage.Update(ctx, name, objInfo, crea
---
[Medium] method DeleteCollection in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) DeleteCollection(ctx context.Context, deleteValidation rest.ValidateObjectFunc, options *metav1.DeleteOptions, listOptions *metainternalversion.ListOptions) (runtime.Object, error) {
	var method = ""delete-collection""
	log := d.Log.WithValues(""kind"", options.Kind, ""resourceVersion"", listOptions.ResourceVersion, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.DeleteCollection(ctx, deleteValidation, options, listOption
---
[Medium] method Delete in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Delete(ctx context.Context, name string, deleteValidation rest.ValidateObjectFunc, options *metav1.DeleteOptions) (runtime.Object, bool, error) {
	var method = ""delete""
	log := d.Log.WithValues(""name"", name, ""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, d.Log)

	startStorage := time.Now()
	res, async, err := d.Storage.Delete(ctx, name, deleteValidation, options)
	if err != nil {
		log.Error(err, ""unable to delete object in storage"")
		d.recordStora
---
[Medium] method Get in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Get(ctx context.Context, name string, options *metav1.GetOptions) (runtime.Object, error) {
	var method = ""get""
	log := d.Log.WithValues(""kind"", options.Kind, ""name"", name, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.Get(ctx, name, options)
	if err != nil {
		log.Error(err, ""unable to get object in storage"")
	}
	d.recordStorageDuration(err != nil, mode3Str, options.Kind, method, startStorage)

	return res, err
}
---
[Medium] method List in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) List(ctx context.Context, options *metainternalversion.ListOptions) (runtime.Object, error) {
	var method = ""list""
	log := d.Log.WithValues(""kind"", options.Kind, ""resourceVersion"", options.ResourceVersion, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.List(ctx, options)
	if err != nil {
		log.Error(err, ""unable to list object in storage"")
	}
	d.recordStorageDuration(err != nil, mode3Str, options.Kind, method, star
---
[Medium] function TestIntegrationPlaylist in pkg/tests/apis/playlist/playlist_test.go:
func TestIntegrationPlaylist(t *testing.T) {
	if testing.Short() {
		t.Skip(""skipping integration test"")
	}

	t.Run(""default setup"", func(t *testing.T) {
		h := doPlaylistTests(t, apis.NewK8sTestHelper(t, testinfra.GrafanaOpts{
			AppModeProduction:    true, // do not start extra port 6443
			DisableAnonymous:     true,
			EnableFeatureToggles: []string{},
		}))

		// The accepted verbs will change when dual write is enabled
		disco := h.GetGroupVersionInfoJSON(""playlist.grafana.app"")
		// fmt.P
---
[Medium] function TestMode3_Create in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Create(t *testing.T) {
	type testCase struct {
		input          runtime.Object
		setupLegacyFn  func(m *mock.Mock, input runtime.Object)
		setupStorageFn func(m *mock.Mock)
		name           string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""creating an object only in the unified store"",
				input: exampleObj,
				setupLegacyFn: func(m *mock.Mock, input runtime.Object) {
					m.On(""Create"", mock.Anything, input, mock.Anything, mock.Anything).Return(exampleObj,
---
[Medium] function TestMode3_Get in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Get(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""get an object only in unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, name string) {
					m.On(""Get"", mock.Anything, name, mock.Anything).Return(exampleObj, nil)
				},
			},
			{
				name:  ""error when getting an object in the unified store fails"",
			
---
[Medium] function TestMode3_List in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_List(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, options *metainternalversion.ListOptions)
		name           string
		options        *metainternalversion.ListOptions
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:    ""error when listing an object in the unified store is not implemented"",
				options: &metainternalversion.ListOptions{TypeMeta: metav1.TypeMeta{Kind: ""fail""}},
				setupStorageFn: func(m *mock.Mock, options *metainternalv
---
[Medium] function TestMode3_Delete in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Delete(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""deleting an object in the unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, name string) {
					m.On(""Delete"", mock.Anything, name, mock.Anything, mock.Anything).Return(exampleObj, false, nil)
				},
			},
			{
				name:  ""error when deleting an object
---
[Medium] function TestMode3_DeleteCollection in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_DeleteCollection(t *testing.T) {
	type testCase struct {
		input          *metav1.DeleteOptions
		setupStorageFn func(m *mock.Mock, input *metav1.DeleteOptions)
		name           string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""deleting a collection in the unified store"",
				input: &metav1.DeleteOptions{TypeMeta: metav1.TypeMeta{Kind: ""foo""}},
				setupStorageFn: func(m *mock.Mock, input *metav1.DeleteOptions) {
					m.On(""DeleteCollection"", mock.Anything, 
---
[Medium] function TestMode3_Update in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Update(t *testing.T) {
	type testCase struct {
		setupLegacyFn  func(m *mock.Mock, input string)
		setupStorageFn func(m *mock.Mock, input string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""update an object in unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, input string) {
					m.On(""Update"", mock.Anything, input, mock.Anything, mock.Anything, mock.Anything, mock.Anything, mock.Anything
---
[Medium] chunk lines 861-872 in go.work.sum:
modernc.org/ccorpus v1.11.6 h1:J16RXiiqiCgua6+ZvQot4yUuUy8zxgqbqEEUuGPlISk=
modernc.org/httpfs v1.0.6 h1:AAgIpFZRXuYnkjftxTAZwMIiwEqAfk8aVB2/oA6nAeM=
modernc.org/opt v0.1.3 h1:3XOZf2yznlhC+ibLltsDGzABUGVx8J6pnFMS3E4dcq4=
modernc.org/tcl v1.15.1 h1:mOQwiEK4p7HruMZcwKTZPw/aqtGM4aY00uzWhlKKYws=
modernc.org/z v1.7.0 h1:xkDw/KepgEjeizO2sNco+hqYkU12taxQFqPEmgm1GWE=
nhooyr.io/websocket v1.8.10 h1:mv4p+MnGrLDcPlBoWsvPP7XCzTYMXP9F9eIGoKbgx7Q=
nhooyr.io/websocket v1.8.10/go.mod h1:rN9OFWIUwuxg4fR5tELlYC04
---
[Medium] chunk lines 421-440 in go.work.sum:
github.com/hashicorp/go.net v0.0.1 h1:sNCoNyDEvN1xa+X0baata4RdcpKwcMS6DH+xwfqPgjw=
github.com/hashicorp/logutils v1.0.0 h1:dLEQVugN8vlakKOUE3ihGLTZJRB4j+M2cdTm/ORI65Y=
github.com/hashicorp/mdns v1.0.4 h1:sY0CMhFmjIPDMlTB+HfymFHCaYLhgifZ0QhjaYKD/UQ=
github.com/hexops/gotextdiff v1.0.3 h1:gitA9+qJrrTCsiCl7+kh75nPqQt1cx4ZkudSTLoUqJM=
github.com/hpcloud/tail v1.0.0 h1:nfCOvKYfkgYP8hkirhJocXT2+zOD8yUNjXaWfTlyFKI=
github.com/hudl/fargo v1.4.0 h1:ZDDILMbB37UlAVLlWcJ2Iz1XuahZZTDZfdCKeclfq2s=
github.com/
---
[Medium] chunk lines 581-600 in go.work.sum:
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.97.0 h1:vPQQQezde/dqG/UzWFVeWPUE5YUU3neybTWtF6dSSLM=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.97.0/go.mod h1:oC3rBafNReIB/XZDshYZjjFulwOF1Feu3ZmY7aYJ4P4=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkareceiver v0.97.0 h1:S6b9R3SexIKjaP6wB7+v20oX/7abc9vOsiazMA+j/gM=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkareceiver
---
[Medium] chunk lines 821-840 in go.work.sum:
go.uber.org/tools v0.0.0-20190618225709-2cfd321de3ee h1:0mgffUl7nfd+FpvXMVz4IDEaUSmT1ysygQC7qYo7sG4=
golang.org/x/arch v0.4.0 h1:A8WCeEWhLwPBKNbFi5Wv5UTCBx5zzubnXDlMOFAzFMc=
golang.org/x/arch v0.4.0/go.mod h1:5om86z9Hs0C8fWVUuoMHwpExlXzs5Tkyp9hOrfG7pp8=
golang.org/x/crypto v0.0.0-20190911031432-227b76d455e7/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
golang.org/x/crypto v0.23.0/go.mod h1:CKFgDieR+mRhux2Lsu27y0fO304Db0wZe70UKqHu0v8=
golang.org/x/image v0.6.0 h1:bR8b5okrPI3g/gyZakLZHeWx
---
[Medium] chunk lines 601-620 in go.work.sum:
github.com/paulmach/orb v0.10.0 h1:guVYVqzxHE/CQ1KpfGO077TR0ATHSNjp4s6XGLn3W9s=
github.com/paulmach/orb v0.10.0/go.mod h1:5mULz1xQfs3bmQm63QEJA6lNGujuRafwA5S/EnuLaLU=
github.com/pbnjay/memory v0.0.0-20210728143218-7b4eea64cf58 h1:onHthvaw9LFnH4t2DcNVpwGmV9E1BkGknEliJkfwQj0=
github.com/pborman/getopt v0.0.0-20170112200414-7148bc3a4c30 h1:BHT1/DKsYDGkUgQ2jmMaozVcdk+sVfz0+1ZJq4zkWgw=
github.com/pborman/uuid v1.2.0 h1:J7Q5mO4ysT1dv8hyrUGHb9+ooztCXu1D8MY8DZYsu3g=
github.com/pelletier/go-toml v1.9.5 h
---
[Medium] chunk lines 481-500 in go.work.sum:
github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51 h1:Z9n2FFNUXsshfwJMBgNA0RU6/i7WVaAegv3PtuIHPMs=
github.com/kelseyhightower/envconfig v1.4.0 h1:Im6hONhd3pLkfDFsbRgu68RDNkGF1r3dvMUtDTo2cv8=
github.com/kevinmbeaulieu/eq-go v1.0.0 h1:AQgYHURDOmnVJ62jnEk0W/7yFKEn+Lv8RHN6t7mB0Zo=
github.com/kevinmbeaulieu/eq-go v1.0.0/go.mod h1:G3S8ajA56gKBZm4UB9AOyoOS37JO3roToPzKNM8dtdM=
github.com/kisielk/errcheck v1.5.0 h1:e8esj/e4R+SAOwFwN+n3zr0nYeCyeweozKfO23MvHzY=
github.com/kisielk/gotool v
---
[Medium] chunk lines 701-720 in go.work.sum:
github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f h1:J9EGpcZtP0E/raorCMxlFGSTBrsSlaDGf3jU/qvAE2c=
github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f/go.mod h1:N2zxlSyiKSe5eX1tZViRH5QA0qijqEDrYZiPEAiq3wU=
github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415 h1:EzJWgHovont7NscjpAxXsDA8S8BMYve8Y5+7cuRE7R0=
github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415/go.mod h1:GwrjFmJcFw6At/Gs6z4yjiIwzuJ1/+UwLxMQDVQXShQ=
github.com/xeipuuv
---
[Medium] chunk lines 841-860 in go.work.sum:
google.golang.org/genproto/googleapis/bytestream v0.0.0-20240325203815-454cdb8f5daa h1:wBkzraZsSqhj1M4L/nMrljUU6XasJkgHvUsq8oRGwF0=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240318140521-94a12d6c2237/go.mod h1:WtryC6hu0hhx87FDGxWCDptyssuo68sk10vYjF+T9fY=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240513163218-0867130af1f8/go.mod h1:I7Y+G38R2bu5j1aLzfFmQfTcU/WnFuqDwLZAbvKTKpM=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240604185151-ef581f913117/go.mod h1:EfXuqaE1J41VCDicx
---
[Medium] chunk lines 441-460 in go.work.sum:
github.com/jackc/pgproto3/v2 v2.2.0 h1:r7JypeP2D3onoQTCxWdTpCtJ4D+qpKr0TxvoyMhZ5ns=
github.com/jackc/pgtype v1.10.0 h1:ILnBWrRMSXGczYvmkYD6PsYyVFUNLTnIUJHHDLmqk38=
github.com/jackc/pgx v3.2.0+incompatible h1:0Vihzu20St42/UDsvZGdNE6jak7oi/UOeMzwMPHkgFY=
github.com/jackc/pgx/v4 v4.15.0 h1:B7dTkXsdILD3MF987WGGCcg+tvLW6bZJdEcqVFeU//w=
github.com/jackc/puddle v1.2.1 h1:gI8os0wpRXFd4FiAY2dWiqRK037tjj3t7rKFeO4X5iw=
github.com/jackspirou/syscerts v0.0.0-20160531025014-b68f5469dff1 h1:9Xm8CKtMZIXgcopfdWk
---
[Medium] chunk lines 521-540 in go.work.sum:
github.com/minio/highwayhash v1.0.2 h1:Aak5U0nElisjDCfPSG79Tgzkn2gl66NxOMspRrKnA/g=
github.com/minio/md5-simd v1.1.2 h1:Gdi1DZK69+ZVMoNHRXJyNcxrMA4dSxoYHZSQbirFg34=
github.com/minio/md5-simd v1.1.2/go.mod h1:MzdKDxYpY2BT9XQFocsiZf/NKVtR7nkE4RoEpN+20RM=
github.com/minio/minio-go/v7 v7.0.63 h1:GbZ2oCvaUdgT5640WJOpyDhhDxvknAJU2/T3yurwcbQ=
github.com/minio/minio-go/v7 v7.0.63/go.mod h1:Q6X7Qjb7WMhvG65qKf4gUgA5XaiSox74kR1uAEjxRS4=
github.com/minio/sha256-simd v1.0.1 h1:6kaan5IFmwTNynnKKpDHe6FWHohJOHh
---
[Medium] chunk lines 761-780 in go.work.sum:
go.opentelemetry.io/collector/confmap/provider/httpsprovider v0.97.0/go.mod h1:R+cJ8wWzaJll+WCTUOM769zIk1vOb7NQARG9xWNbgUA=
go.opentelemetry.io/collector/confmap/provider/yamlprovider v0.97.0 h1:ntcR7AMHwFRROTMW1ifx0xVu+ltbPafS/1r/ssxe+hM=
go.opentelemetry.io/collector/confmap/provider/yamlprovider v0.97.0/go.mod h1:0THo600LMD0RGl7loqyaHgd/47Icgb64QOmqaj0j5dU=
go.opentelemetry.io/collector/connector v0.95.0 h1:HBfGg92Eyw5jkneu7jh3yed7w/dzi7v6SZ+CyqpNK7E=
go.opentelemetry.io/collector/connector v
---
[Medium] chunk lines 621-640 in go.work.sum:
github.com/prashantv/gostub v1.1.0 h1:BTyx3RfQjRHnUWaGF9oQos79AlQ5k8WNktv7VGvVH4g=
github.com/prometheus/common/assets v0.2.0 h1:0P5OrzoHrYBOSM1OigWL3mY8ZvV2N4zIE/5AahrSrfM=
github.com/prometheus/statsd_exporter v0.26.0 h1:SQl3M6suC6NWQYEzOvIv+EF6dAMYEqIuZy+o4H9F5Ig=
github.com/prometheus/statsd_exporter v0.26.0/go.mod h1:GXFLADOmBTVDrHc7b04nX8ooq3azG61pnECNqT7O5DM=
github.com/rcrowley/go-metrics v0.0.0-20201227073835-cf1acfcdf475 h1:N/ElC8H3+5XpJzTSTfLsJV/mx9Q9g7kxmchpfZyxgzM=
github.com/rcrowl
---
[Medium] chunk lines 741-760 in go.work.sum:
go.opentelemetry.io/collector/config/configopaque v1.4.0/go.mod h1:7Qzo69x7i+FaNELeA9jmZtVvfnR5lE6JYa5YEOCJPFQ=
go.opentelemetry.io/collector/config/configretry v0.97.0 h1:k7VwQ5H0oBLm6Fgm0ltfDDbmQVsiqSIY9ojijF0hiR0=
go.opentelemetry.io/collector/config/configretry v0.97.0/go.mod h1:s7A6ZGxK8bxqidFzwbr2pITzbsB2qf+aeHEDQDcanV8=
go.opentelemetry.io/collector/config/configtelemetry v0.97.0 h1:JS/WxK09A9m39D5OqsAWaoRe4tG7ESMnzDNIbZ5bD6c=
go.opentelemetry.io/collector/config/configtelemetry v0.97.0/g
---
[Medium] chunk lines 501-520 in go.work.sum:
github.com/ledongthuc/pdf v0.0.0-20220302134840-0c2507a12d80 h1:6Yzfa6GP0rIo/kULo2bwGEkFvCePZ3qHDDTC3/J9Swo=
github.com/leodido/go-urn v1.2.4 h1:XlAE/cm/ms7TE/VMVoduSpNBoyc2dOxHs5MZSwAN63Q=
github.com/leodido/go-urn v1.2.4/go.mod h1:7ZrI8mTSeBSHl/UaRyKQW1qZeMgak41ANeCNaVckg+4=
github.com/libsql/sqlite-antlr4-parser v0.0.0-20240327125255-dbf53b6cbf06 h1:JLvn7D+wXjH9g4Jsjo+VqmzTUpl/LX7vfr6VOfSWTdM=
github.com/libsql/sqlite-antlr4-parser v0.0.0-20240327125255-dbf53b6cbf06/go.mod h1:FUkZ5OHjlGPjnM2U
---
[Medium] chunk lines 801-820 in go.work.sum:
go.opentelemetry.io/otel/exporters/otlp/otlpmetric/otlpmetrichttp v1.23.1/go.mod h1:DTE9yAu6r08jU3xa68GiSeI7oRcSEQ2RpKbbQGO+dWM=
go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.26.0/go.mod h1:z46paqbJ9l7c9fIPCXTqTGwhQZ5XoTIsfeFYWboizjs=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.26.0/go.mod h1:wnJIG4fOqyynOnnQF/eQb4/16VlX2EJAHhHgqIqWfAo=
go.opentelemetry.io/otel/exporters/prometheus v0.37.0 h1:NQc0epfL0xItsmGgSXgfbH2C1fq2VLXkZoDFsfRNHpc=
go.opentelemetry.io/otel/expo
---
[Medium] chunk lines 721-740 in go.work.sum:
github.com/zenazn/goji v1.0.1/go.mod h1:7S9M489iMyHBNxwZnk9/EHS098H4/F6TATF2mIxtB1Q=
github.com/ziutek/mymysql v1.5.4 h1:GB0qdRGsTwQSBVYuVShFBKaXSnSnYYC2d9knnE1LHFs=
github.com/ziutek/mymysql v1.5.4/go.mod h1:LMSpPZ6DbqWFxNCHW77HeMg9I646SAhApZ/wKdgO/C0=
gitlab.com/nyarla/go-crypt v0.0.0-20160106005555-d9a5dc2b789b h1:7gd+rd8P3bqcn/96gOZa3F5dpJr/vEiDQYlNb/y2uNs=
go.einride.tech/aip v0.66.0 h1:XfV+NQX6L7EOYK11yoHHFtndeaWh3KbD9/cN/6iWEt8=
go.opentelemetry.io/collector v0.97.0 h1:qyOju13byHIKEK/Jehm
---
[Medium] chunk lines 461-480 in go.work.sum:
github.com/jon-whit/go-grpc-prometheus v1.4.0/go.mod h1:iTPm+Iuhh3IIqR0iGZ91JJEg5ax6YQEe1I0f6vtBuao=
github.com/jstemmer/go-junit-report v0.9.1 h1:6QPYqodiu3GuPL+7mfx+NwDdp2eTkp9IfEUpgAwUN0o=
github.com/jsternberg/zap-logfmt v1.2.0 h1:1v+PK4/B48cy8cfQbxL4FmmNZrjnIMr2BsnyEmXqv2o=
github.com/jsternberg/zap-logfmt v1.2.0/go.mod h1:kz+1CUmCutPWABnNkOu9hOHKdT2q3TDYCcsFy9hpqb0=
github.com/juju/gnuflag v0.0.0-20171113085948-2ce1bb71843d h1:c93kUJDtVAXFEhsCh5jSxyOJmFHuzcihnslQiX8Urwo=
github.com/juliens
---
[Medium] chunk lines 541-560 in go.work.sum:
github.com/nats-io/nats-server/v2 v2.5.0 h1:wsnVaaXH9VRSg+A2MVg5Q727/CqxnmPLGFQ3YZYKTQg=
github.com/nats-io/nats.go v1.31.0 h1:/WFBHEc/dOKBF6qf1TZhrdEfTmOZ5JzdJ+Y3m6Y/p7E=
github.com/nats-io/nats.go v1.31.0/go.mod h1:di3Bm5MLsoB4Bx61CBTsxuarI36WbhAwOm8QrW39+i8=
github.com/nats-io/nkeys v0.4.6 h1:IzVe95ru2CT6ta874rt9saQRkWfe2nFj1NtvYSLqMzY=
github.com/nats-io/nkeys v0.4.6/go.mod h1:4DxZNzenSVd1cYQoAa8948QY3QDjrHfcfVADymtkpts=
github.com/nats-io/nuid v1.0.1 h1:5iA8DT8V7q8WK2EScv2padNa/rTESc1KdnPw4
---
[Medium] chunk lines 661-680 in go.work.sum:
github.com/tdewolff/minify/v2 v2.12.9 h1:dvn5MtmuQ/DFMwqf5j8QhEVpPX6fi3WGImhv8RUB4zA=
github.com/tdewolff/minify/v2 v2.12.9/go.mod h1:qOqdlDfL+7v0/fyymB+OP497nIxJYSvX4MQWA8OoiXU=
github.com/tdewolff/parse/v2 v2.6.8 h1:mhNZXYCx//xG7Yq2e/kVLNZw4YfYmeHbhx+Zc0OvFMA=
github.com/tdewolff/parse/v2 v2.6.8/go.mod h1:XHDhaU6IBgsryfdnpzUXBlT6leW/l25yrFBTEb4eIyM=
github.com/tidwall/gjson v1.17.1 h1:wlYEnwqAHgzmhNUFfw7Xalt2JzQvsMx2Se4PcoFCT/U=
github.com/tidwall/gjson v1.17.1/go.mod h1:/wbyibRr2FHMks5tjHJ5F8
---
[Medium] chunk lines 401-420 in go.work.sum:
github.com/grafana/e2e v0.1.1/go.mod h1:RpNLgae5VT+BUHvPE+/zSypmOXKwEu4t+tnEMS1ATaE=
github.com/grafana/grafana-cloud-migration-snapshot v1.2.0 h1:FCUWASPPzGGbF2jTutR5i3rmoQdmnC4bypwJswdW3fI=
github.com/grafana/grafana-cloud-migration-snapshot v1.2.0/go.mod h1:bd6Cm06EK0MzRO5ahUpbDz1SxNOKu+fzladbaRPHZPY=
github.com/grafana/grafana/pkg/apimachinery v0.0.0-20240701135906-559738ce6ae1/go.mod h1:DkxMin+qOh1Fgkxfbt+CUfBqqsCQJMG9op8Os/irBPA=
github.com/grafana/grafana-azure-sdk-go/v2 v2.1.0 h1:lajVqTW
---
[Medium] chunk lines 561-580 in go.work.sum:
github.com/open-telemetry/opentelemetry-collector-contrib/internal/kafka v0.97.0 h1:+EA1iNRxeOqtU+9/+4hu8Tz7LhW2xmhFPd3w+ntpxiE=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/kafka v0.97.0/go.mod h1:pHbdUUE+6ZWpvaHyyHQiytt7t6IPVCvacnDPmKWVgu0=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/sharedcomponent v0.97.0 h1:sd7JEwe5e7VYel/6gFWTKFTsQz8PxzdpU8tWlL6Ymos=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/sharedcomponent v0.97.0/go.mo
---
[Medium] chunk lines 681-700 in go.work.sum:
github.com/valyala/fasttemplate v1.2.2/go.mod h1:KHLXt3tVN2HBp8eijSv/kGJopbvo7S+qRAEEKiv+SiQ=
github.com/vburenin/ifacemaker v1.2.1 h1:3Vq8B/bfBgjWTkv+jDg4dVL1KHt3k1K4lO7XRxYA2sk=
github.com/vertica/vertica-sql-go v1.3.3 h1:fL+FKEAEy5ONmsvya2WH5T8bhkvY27y/Ik3ReR2T+Qw=
github.com/vertica/vertica-sql-go v1.3.3/go.mod h1:jnn2GFuv+O2Jcjktb7zyc4Utlbu9YVqpHH/lx63+1M4=
github.com/vinzenz/yaml v0.0.0-20170920082545-91409cdd725d h1:3wDi6J5APMqaHBVPuVd7RmHD2gRTfqbdcVSpCNoUWtk=
github.com/vinzenz/yaml v0.0
---
[Medium] chunk lines 781-800 in go.work.sum:
go.opentelemetry.io/collector/receiver v0.97.0 h1:ozzE5MhIPtfnYA/UKB/NCcgxSmeLqdwErboi6B/IpLQ=
go.opentelemetry.io/collector/receiver v0.97.0/go.mod h1:1TCN9DRuB45+xKqlwv4BMQR6qXgaJeSSNezFTJhmDUo=
go.opentelemetry.io/collector/receiver/otlpreceiver v0.97.1-0.20240327165504-2b0decfcebeb h1:gaxwgzaHKnlx6dAjFexd4eiFD3l0ePwdueqdNystJDU=
go.opentelemetry.io/collector/receiver/otlpreceiver v0.97.1-0.20240327165504-2b0decfcebeb/go.mod h1:JL1oxtysJT2TN80p/nC9vrWkENh/If7kmMRio7yF9WE=
go.opentelemetry.io/
---
[Medium] chunk lines 641-660 in go.work.sum:
github.com/satori/go.uuid v1.2.0 h1:0uYX9dsZ2yD7q2RtLRtPSdGDWzjeM3TbMJP9utgA0ww=
github.com/schollz/closestmatch v2.1.0+incompatible h1:Uel2GXEpJqOWBrlyI+oY9LTiyyjYS17cCYRqP13/SHk=
github.com/schollz/closestmatch v2.1.0+incompatible/go.mod h1:RtP1ddjLong6gTkbtmuhtR2uUrrJOpYzYRvbcPAid+g=
github.com/segmentio/fasthash v0.0.0-20180216231524-a72b379d632e h1:uO75wNGioszjmIzcY/tvdDYKRLVvzggtAmmJkn9j4GQ=
github.com/segmentio/fasthash v0.0.0-20180216231524-a72b379d632e/go.mod h1:tm/wZFQ8e24NYaBGIlnO2WGC
---
[Medium] function newDualWriterMode3 in pkg/apiserver/rest/dualwriter_mode3.go:
func newDualWriterMode3(legacy LegacyStorage, storage Storage, dwm *dualWriterMetrics) *DualWriterMode3 {
	return &DualWriterMode3{Legacy: legacy, Storage: storage, Log: klog.NewKlogr().WithName(""DualWriterMode3"").WithValues(""mode"", mode3Str), dualWriterMetrics: dwm}
}","TestMode1_Get (Medium), Create (Medium), Update (Medium), DeleteCollection (Medium), Delete (Medium), Get (Medium), List (Medium), TestIntegrationPlaylist (Medium), TestMode3_Create (Medium), TestMode3_Get (Medium), TestMode3_List (Medium), TestMode3_Delete (Medium), TestMode3_DeleteCollection (Medium), TestMode3_Update (Medium), lines 861-872 (Medium), lines 421-440 (Medium), lines 581-600 (Medium), lines 821-840 (Medium), lines 601-620 (Medium), lines 481-500 (Medium), lines 701-720 (Medium), lines 841-860 (Medium), lines 441-460 (Medium), lines 521-540 (Medium), lines 761-780 (Medium), lines 621-640 (Medium), lines 741-760 (Medium), lines 501-520 (Medium), lines 801-820 (Medium), lines 721-740 (Medium), lines 461-480 (Medium), lines 541-560 (Medium), lines 661-680 (Medium), lines 401-420 (Medium), lines 561-580 (Medium), lines 681-700 (Medium), lines 781-800 (Medium), lines 641-660 (Medium), newDualWriterMode3 (Medium), lines 861-880 (Low), lines 881-888 (Low)",miss,"no HC entities for this PR, all Medium"
grafana,6,Dual Storage Architecture,Bug: calling recordLegacyDuration when storage operation fails should be recordStorageDuration.,High,41,0,39,,,"[Medium] function TestMode1_Get in pkg/apiserver/rest/dualwriter_mode1_test.go:
func TestMode1_Get(t *testing.T) {
	type testCase struct {
		setupLegacyFn  func(m *mock.Mock, name string)
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""get an object only in the legacy store"",
				input: ""foo"",
				setupLegacyFn: func(m *mock.Mock, name string) {
					m.On(""Get"", mock.Anything, name, mock.Anything).Return(exampleObj, nil)
				},
				setupStorageFn: func(m *mock.
---
[Medium] method Create in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Create(ctx context.Context, obj runtime.Object, createValidation rest.ValidateObjectFunc, options *metav1.CreateOptions) (runtime.Object, error) {
	var method = ""create""
	log := d.Log.WithValues(""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	created, err := d.Storage.Create(ctx, obj, createValidation, options)
	if err != nil {
		log.Error(err, ""unable to create object in storage"")
		d.recordLegacyDuration(true, mod
---
[Medium] method Update in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Update(ctx context.Context, name string, objInfo rest.UpdatedObjectInfo, createValidation rest.ValidateObjectFunc, updateValidation rest.ValidateObjectUpdateFunc, forceAllowCreate bool, options *metav1.UpdateOptions) (runtime.Object, bool, error) {
	var method = ""update""
	log := d.Log.WithValues(""name"", name, ""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, async, err := d.Storage.Update(ctx, name, objInfo, crea
---
[Medium] method DeleteCollection in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) DeleteCollection(ctx context.Context, deleteValidation rest.ValidateObjectFunc, options *metav1.DeleteOptions, listOptions *metainternalversion.ListOptions) (runtime.Object, error) {
	var method = ""delete-collection""
	log := d.Log.WithValues(""kind"", options.Kind, ""resourceVersion"", listOptions.ResourceVersion, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.DeleteCollection(ctx, deleteValidation, options, listOption
---
[Medium] method Delete in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Delete(ctx context.Context, name string, deleteValidation rest.ValidateObjectFunc, options *metav1.DeleteOptions) (runtime.Object, bool, error) {
	var method = ""delete""
	log := d.Log.WithValues(""name"", name, ""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, d.Log)

	startStorage := time.Now()
	res, async, err := d.Storage.Delete(ctx, name, deleteValidation, options)
	if err != nil {
		log.Error(err, ""unable to delete object in storage"")
		d.recordStora
---
[Medium] method Get in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Get(ctx context.Context, name string, options *metav1.GetOptions) (runtime.Object, error) {
	var method = ""get""
	log := d.Log.WithValues(""kind"", options.Kind, ""name"", name, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.Get(ctx, name, options)
	if err != nil {
		log.Error(err, ""unable to get object in storage"")
	}
	d.recordStorageDuration(err != nil, mode3Str, options.Kind, method, startStorage)

	return res, err
}
---
[Medium] method List in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) List(ctx context.Context, options *metainternalversion.ListOptions) (runtime.Object, error) {
	var method = ""list""
	log := d.Log.WithValues(""kind"", options.Kind, ""resourceVersion"", options.ResourceVersion, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.List(ctx, options)
	if err != nil {
		log.Error(err, ""unable to list object in storage"")
	}
	d.recordStorageDuration(err != nil, mode3Str, options.Kind, method, star
---
[Medium] function TestIntegrationPlaylist in pkg/tests/apis/playlist/playlist_test.go:
func TestIntegrationPlaylist(t *testing.T) {
	if testing.Short() {
		t.Skip(""skipping integration test"")
	}

	t.Run(""default setup"", func(t *testing.T) {
		h := doPlaylistTests(t, apis.NewK8sTestHelper(t, testinfra.GrafanaOpts{
			AppModeProduction:    true, // do not start extra port 6443
			DisableAnonymous:     true,
			EnableFeatureToggles: []string{},
		}))

		// The accepted verbs will change when dual write is enabled
		disco := h.GetGroupVersionInfoJSON(""playlist.grafana.app"")
		// fmt.P
---
[Medium] function TestMode3_Create in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Create(t *testing.T) {
	type testCase struct {
		input          runtime.Object
		setupLegacyFn  func(m *mock.Mock, input runtime.Object)
		setupStorageFn func(m *mock.Mock)
		name           string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""creating an object only in the unified store"",
				input: exampleObj,
				setupLegacyFn: func(m *mock.Mock, input runtime.Object) {
					m.On(""Create"", mock.Anything, input, mock.Anything, mock.Anything).Return(exampleObj,
---
[Medium] function TestMode3_Get in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Get(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""get an object only in unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, name string) {
					m.On(""Get"", mock.Anything, name, mock.Anything).Return(exampleObj, nil)
				},
			},
			{
				name:  ""error when getting an object in the unified store fails"",
			
---
[Medium] function TestMode3_List in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_List(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, options *metainternalversion.ListOptions)
		name           string
		options        *metainternalversion.ListOptions
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:    ""error when listing an object in the unified store is not implemented"",
				options: &metainternalversion.ListOptions{TypeMeta: metav1.TypeMeta{Kind: ""fail""}},
				setupStorageFn: func(m *mock.Mock, options *metainternalv
---
[Medium] function TestMode3_Delete in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Delete(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""deleting an object in the unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, name string) {
					m.On(""Delete"", mock.Anything, name, mock.Anything, mock.Anything).Return(exampleObj, false, nil)
				},
			},
			{
				name:  ""error when deleting an object
---
[Medium] function TestMode3_DeleteCollection in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_DeleteCollection(t *testing.T) {
	type testCase struct {
		input          *metav1.DeleteOptions
		setupStorageFn func(m *mock.Mock, input *metav1.DeleteOptions)
		name           string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""deleting a collection in the unified store"",
				input: &metav1.DeleteOptions{TypeMeta: metav1.TypeMeta{Kind: ""foo""}},
				setupStorageFn: func(m *mock.Mock, input *metav1.DeleteOptions) {
					m.On(""DeleteCollection"", mock.Anything, 
---
[Medium] function TestMode3_Update in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Update(t *testing.T) {
	type testCase struct {
		setupLegacyFn  func(m *mock.Mock, input string)
		setupStorageFn func(m *mock.Mock, input string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""update an object in unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, input string) {
					m.On(""Update"", mock.Anything, input, mock.Anything, mock.Anything, mock.Anything, mock.Anything, mock.Anything
---
[Medium] chunk lines 861-872 in go.work.sum:
modernc.org/ccorpus v1.11.6 h1:J16RXiiqiCgua6+ZvQot4yUuUy8zxgqbqEEUuGPlISk=
modernc.org/httpfs v1.0.6 h1:AAgIpFZRXuYnkjftxTAZwMIiwEqAfk8aVB2/oA6nAeM=
modernc.org/opt v0.1.3 h1:3XOZf2yznlhC+ibLltsDGzABUGVx8J6pnFMS3E4dcq4=
modernc.org/tcl v1.15.1 h1:mOQwiEK4p7HruMZcwKTZPw/aqtGM4aY00uzWhlKKYws=
modernc.org/z v1.7.0 h1:xkDw/KepgEjeizO2sNco+hqYkU12taxQFqPEmgm1GWE=
nhooyr.io/websocket v1.8.10 h1:mv4p+MnGrLDcPlBoWsvPP7XCzTYMXP9F9eIGoKbgx7Q=
nhooyr.io/websocket v1.8.10/go.mod h1:rN9OFWIUwuxg4fR5tELlYC04
---
[Medium] chunk lines 421-440 in go.work.sum:
github.com/hashicorp/go.net v0.0.1 h1:sNCoNyDEvN1xa+X0baata4RdcpKwcMS6DH+xwfqPgjw=
github.com/hashicorp/logutils v1.0.0 h1:dLEQVugN8vlakKOUE3ihGLTZJRB4j+M2cdTm/ORI65Y=
github.com/hashicorp/mdns v1.0.4 h1:sY0CMhFmjIPDMlTB+HfymFHCaYLhgifZ0QhjaYKD/UQ=
github.com/hexops/gotextdiff v1.0.3 h1:gitA9+qJrrTCsiCl7+kh75nPqQt1cx4ZkudSTLoUqJM=
github.com/hpcloud/tail v1.0.0 h1:nfCOvKYfkgYP8hkirhJocXT2+zOD8yUNjXaWfTlyFKI=
github.com/hudl/fargo v1.4.0 h1:ZDDILMbB37UlAVLlWcJ2Iz1XuahZZTDZfdCKeclfq2s=
github.com/
---
[Medium] chunk lines 581-600 in go.work.sum:
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.97.0 h1:vPQQQezde/dqG/UzWFVeWPUE5YUU3neybTWtF6dSSLM=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.97.0/go.mod h1:oC3rBafNReIB/XZDshYZjjFulwOF1Feu3ZmY7aYJ4P4=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkareceiver v0.97.0 h1:S6b9R3SexIKjaP6wB7+v20oX/7abc9vOsiazMA+j/gM=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkareceiver
---
[Medium] chunk lines 821-840 in go.work.sum:
go.uber.org/tools v0.0.0-20190618225709-2cfd321de3ee h1:0mgffUl7nfd+FpvXMVz4IDEaUSmT1ysygQC7qYo7sG4=
golang.org/x/arch v0.4.0 h1:A8WCeEWhLwPBKNbFi5Wv5UTCBx5zzubnXDlMOFAzFMc=
golang.org/x/arch v0.4.0/go.mod h1:5om86z9Hs0C8fWVUuoMHwpExlXzs5Tkyp9hOrfG7pp8=
golang.org/x/crypto v0.0.0-20190911031432-227b76d455e7/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
golang.org/x/crypto v0.23.0/go.mod h1:CKFgDieR+mRhux2Lsu27y0fO304Db0wZe70UKqHu0v8=
golang.org/x/image v0.6.0 h1:bR8b5okrPI3g/gyZakLZHeWx
---
[Medium] chunk lines 601-620 in go.work.sum:
github.com/paulmach/orb v0.10.0 h1:guVYVqzxHE/CQ1KpfGO077TR0ATHSNjp4s6XGLn3W9s=
github.com/paulmach/orb v0.10.0/go.mod h1:5mULz1xQfs3bmQm63QEJA6lNGujuRafwA5S/EnuLaLU=
github.com/pbnjay/memory v0.0.0-20210728143218-7b4eea64cf58 h1:onHthvaw9LFnH4t2DcNVpwGmV9E1BkGknEliJkfwQj0=
github.com/pborman/getopt v0.0.0-20170112200414-7148bc3a4c30 h1:BHT1/DKsYDGkUgQ2jmMaozVcdk+sVfz0+1ZJq4zkWgw=
github.com/pborman/uuid v1.2.0 h1:J7Q5mO4ysT1dv8hyrUGHb9+ooztCXu1D8MY8DZYsu3g=
github.com/pelletier/go-toml v1.9.5 h
---
[Medium] chunk lines 481-500 in go.work.sum:
github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51 h1:Z9n2FFNUXsshfwJMBgNA0RU6/i7WVaAegv3PtuIHPMs=
github.com/kelseyhightower/envconfig v1.4.0 h1:Im6hONhd3pLkfDFsbRgu68RDNkGF1r3dvMUtDTo2cv8=
github.com/kevinmbeaulieu/eq-go v1.0.0 h1:AQgYHURDOmnVJ62jnEk0W/7yFKEn+Lv8RHN6t7mB0Zo=
github.com/kevinmbeaulieu/eq-go v1.0.0/go.mod h1:G3S8ajA56gKBZm4UB9AOyoOS37JO3roToPzKNM8dtdM=
github.com/kisielk/errcheck v1.5.0 h1:e8esj/e4R+SAOwFwN+n3zr0nYeCyeweozKfO23MvHzY=
github.com/kisielk/gotool v
---
[Medium] chunk lines 701-720 in go.work.sum:
github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f h1:J9EGpcZtP0E/raorCMxlFGSTBrsSlaDGf3jU/qvAE2c=
github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f/go.mod h1:N2zxlSyiKSe5eX1tZViRH5QA0qijqEDrYZiPEAiq3wU=
github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415 h1:EzJWgHovont7NscjpAxXsDA8S8BMYve8Y5+7cuRE7R0=
github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415/go.mod h1:GwrjFmJcFw6At/Gs6z4yjiIwzuJ1/+UwLxMQDVQXShQ=
github.com/xeipuuv
---
[Medium] chunk lines 841-860 in go.work.sum:
google.golang.org/genproto/googleapis/bytestream v0.0.0-20240325203815-454cdb8f5daa h1:wBkzraZsSqhj1M4L/nMrljUU6XasJkgHvUsq8oRGwF0=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240318140521-94a12d6c2237/go.mod h1:WtryC6hu0hhx87FDGxWCDptyssuo68sk10vYjF+T9fY=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240513163218-0867130af1f8/go.mod h1:I7Y+G38R2bu5j1aLzfFmQfTcU/WnFuqDwLZAbvKTKpM=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240604185151-ef581f913117/go.mod h1:EfXuqaE1J41VCDicx
---
[Medium] chunk lines 441-460 in go.work.sum:
github.com/jackc/pgproto3/v2 v2.2.0 h1:r7JypeP2D3onoQTCxWdTpCtJ4D+qpKr0TxvoyMhZ5ns=
github.com/jackc/pgtype v1.10.0 h1:ILnBWrRMSXGczYvmkYD6PsYyVFUNLTnIUJHHDLmqk38=
github.com/jackc/pgx v3.2.0+incompatible h1:0Vihzu20St42/UDsvZGdNE6jak7oi/UOeMzwMPHkgFY=
github.com/jackc/pgx/v4 v4.15.0 h1:B7dTkXsdILD3MF987WGGCcg+tvLW6bZJdEcqVFeU//w=
github.com/jackc/puddle v1.2.1 h1:gI8os0wpRXFd4FiAY2dWiqRK037tjj3t7rKFeO4X5iw=
github.com/jackspirou/syscerts v0.0.0-20160531025014-b68f5469dff1 h1:9Xm8CKtMZIXgcopfdWk
---
[Medium] chunk lines 521-540 in go.work.sum:
github.com/minio/highwayhash v1.0.2 h1:Aak5U0nElisjDCfPSG79Tgzkn2gl66NxOMspRrKnA/g=
github.com/minio/md5-simd v1.1.2 h1:Gdi1DZK69+ZVMoNHRXJyNcxrMA4dSxoYHZSQbirFg34=
github.com/minio/md5-simd v1.1.2/go.mod h1:MzdKDxYpY2BT9XQFocsiZf/NKVtR7nkE4RoEpN+20RM=
github.com/minio/minio-go/v7 v7.0.63 h1:GbZ2oCvaUdgT5640WJOpyDhhDxvknAJU2/T3yurwcbQ=
github.com/minio/minio-go/v7 v7.0.63/go.mod h1:Q6X7Qjb7WMhvG65qKf4gUgA5XaiSox74kR1uAEjxRS4=
github.com/minio/sha256-simd v1.0.1 h1:6kaan5IFmwTNynnKKpDHe6FWHohJOHh
---
[Medium] chunk lines 761-780 in go.work.sum:
go.opentelemetry.io/collector/confmap/provider/httpsprovider v0.97.0/go.mod h1:R+cJ8wWzaJll+WCTUOM769zIk1vOb7NQARG9xWNbgUA=
go.opentelemetry.io/collector/confmap/provider/yamlprovider v0.97.0 h1:ntcR7AMHwFRROTMW1ifx0xVu+ltbPafS/1r/ssxe+hM=
go.opentelemetry.io/collector/confmap/provider/yamlprovider v0.97.0/go.mod h1:0THo600LMD0RGl7loqyaHgd/47Icgb64QOmqaj0j5dU=
go.opentelemetry.io/collector/connector v0.95.0 h1:HBfGg92Eyw5jkneu7jh3yed7w/dzi7v6SZ+CyqpNK7E=
go.opentelemetry.io/collector/connector v
---
[Medium] chunk lines 621-640 in go.work.sum:
github.com/prashantv/gostub v1.1.0 h1:BTyx3RfQjRHnUWaGF9oQos79AlQ5k8WNktv7VGvVH4g=
github.com/prometheus/common/assets v0.2.0 h1:0P5OrzoHrYBOSM1OigWL3mY8ZvV2N4zIE/5AahrSrfM=
github.com/prometheus/statsd_exporter v0.26.0 h1:SQl3M6suC6NWQYEzOvIv+EF6dAMYEqIuZy+o4H9F5Ig=
github.com/prometheus/statsd_exporter v0.26.0/go.mod h1:GXFLADOmBTVDrHc7b04nX8ooq3azG61pnECNqT7O5DM=
github.com/rcrowley/go-metrics v0.0.0-20201227073835-cf1acfcdf475 h1:N/ElC8H3+5XpJzTSTfLsJV/mx9Q9g7kxmchpfZyxgzM=
github.com/rcrowl
---
[Medium] chunk lines 741-760 in go.work.sum:
go.opentelemetry.io/collector/config/configopaque v1.4.0/go.mod h1:7Qzo69x7i+FaNELeA9jmZtVvfnR5lE6JYa5YEOCJPFQ=
go.opentelemetry.io/collector/config/configretry v0.97.0 h1:k7VwQ5H0oBLm6Fgm0ltfDDbmQVsiqSIY9ojijF0hiR0=
go.opentelemetry.io/collector/config/configretry v0.97.0/go.mod h1:s7A6ZGxK8bxqidFzwbr2pITzbsB2qf+aeHEDQDcanV8=
go.opentelemetry.io/collector/config/configtelemetry v0.97.0 h1:JS/WxK09A9m39D5OqsAWaoRe4tG7ESMnzDNIbZ5bD6c=
go.opentelemetry.io/collector/config/configtelemetry v0.97.0/g
---
[Medium] chunk lines 501-520 in go.work.sum:
github.com/ledongthuc/pdf v0.0.0-20220302134840-0c2507a12d80 h1:6Yzfa6GP0rIo/kULo2bwGEkFvCePZ3qHDDTC3/J9Swo=
github.com/leodido/go-urn v1.2.4 h1:XlAE/cm/ms7TE/VMVoduSpNBoyc2dOxHs5MZSwAN63Q=
github.com/leodido/go-urn v1.2.4/go.mod h1:7ZrI8mTSeBSHl/UaRyKQW1qZeMgak41ANeCNaVckg+4=
github.com/libsql/sqlite-antlr4-parser v0.0.0-20240327125255-dbf53b6cbf06 h1:JLvn7D+wXjH9g4Jsjo+VqmzTUpl/LX7vfr6VOfSWTdM=
github.com/libsql/sqlite-antlr4-parser v0.0.0-20240327125255-dbf53b6cbf06/go.mod h1:FUkZ5OHjlGPjnM2U
---
[Medium] chunk lines 801-820 in go.work.sum:
go.opentelemetry.io/otel/exporters/otlp/otlpmetric/otlpmetrichttp v1.23.1/go.mod h1:DTE9yAu6r08jU3xa68GiSeI7oRcSEQ2RpKbbQGO+dWM=
go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.26.0/go.mod h1:z46paqbJ9l7c9fIPCXTqTGwhQZ5XoTIsfeFYWboizjs=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.26.0/go.mod h1:wnJIG4fOqyynOnnQF/eQb4/16VlX2EJAHhHgqIqWfAo=
go.opentelemetry.io/otel/exporters/prometheus v0.37.0 h1:NQc0epfL0xItsmGgSXgfbH2C1fq2VLXkZoDFsfRNHpc=
go.opentelemetry.io/otel/expo
---
[Medium] chunk lines 721-740 in go.work.sum:
github.com/zenazn/goji v1.0.1/go.mod h1:7S9M489iMyHBNxwZnk9/EHS098H4/F6TATF2mIxtB1Q=
github.com/ziutek/mymysql v1.5.4 h1:GB0qdRGsTwQSBVYuVShFBKaXSnSnYYC2d9knnE1LHFs=
github.com/ziutek/mymysql v1.5.4/go.mod h1:LMSpPZ6DbqWFxNCHW77HeMg9I646SAhApZ/wKdgO/C0=
gitlab.com/nyarla/go-crypt v0.0.0-20160106005555-d9a5dc2b789b h1:7gd+rd8P3bqcn/96gOZa3F5dpJr/vEiDQYlNb/y2uNs=
go.einride.tech/aip v0.66.0 h1:XfV+NQX6L7EOYK11yoHHFtndeaWh3KbD9/cN/6iWEt8=
go.opentelemetry.io/collector v0.97.0 h1:qyOju13byHIKEK/Jehm
---
[Medium] chunk lines 461-480 in go.work.sum:
github.com/jon-whit/go-grpc-prometheus v1.4.0/go.mod h1:iTPm+Iuhh3IIqR0iGZ91JJEg5ax6YQEe1I0f6vtBuao=
github.com/jstemmer/go-junit-report v0.9.1 h1:6QPYqodiu3GuPL+7mfx+NwDdp2eTkp9IfEUpgAwUN0o=
github.com/jsternberg/zap-logfmt v1.2.0 h1:1v+PK4/B48cy8cfQbxL4FmmNZrjnIMr2BsnyEmXqv2o=
github.com/jsternberg/zap-logfmt v1.2.0/go.mod h1:kz+1CUmCutPWABnNkOu9hOHKdT2q3TDYCcsFy9hpqb0=
github.com/juju/gnuflag v0.0.0-20171113085948-2ce1bb71843d h1:c93kUJDtVAXFEhsCh5jSxyOJmFHuzcihnslQiX8Urwo=
github.com/juliens
---
[Medium] chunk lines 541-560 in go.work.sum:
github.com/nats-io/nats-server/v2 v2.5.0 h1:wsnVaaXH9VRSg+A2MVg5Q727/CqxnmPLGFQ3YZYKTQg=
github.com/nats-io/nats.go v1.31.0 h1:/WFBHEc/dOKBF6qf1TZhrdEfTmOZ5JzdJ+Y3m6Y/p7E=
github.com/nats-io/nats.go v1.31.0/go.mod h1:di3Bm5MLsoB4Bx61CBTsxuarI36WbhAwOm8QrW39+i8=
github.com/nats-io/nkeys v0.4.6 h1:IzVe95ru2CT6ta874rt9saQRkWfe2nFj1NtvYSLqMzY=
github.com/nats-io/nkeys v0.4.6/go.mod h1:4DxZNzenSVd1cYQoAa8948QY3QDjrHfcfVADymtkpts=
github.com/nats-io/nuid v1.0.1 h1:5iA8DT8V7q8WK2EScv2padNa/rTESc1KdnPw4
---
[Medium] chunk lines 661-680 in go.work.sum:
github.com/tdewolff/minify/v2 v2.12.9 h1:dvn5MtmuQ/DFMwqf5j8QhEVpPX6fi3WGImhv8RUB4zA=
github.com/tdewolff/minify/v2 v2.12.9/go.mod h1:qOqdlDfL+7v0/fyymB+OP497nIxJYSvX4MQWA8OoiXU=
github.com/tdewolff/parse/v2 v2.6.8 h1:mhNZXYCx//xG7Yq2e/kVLNZw4YfYmeHbhx+Zc0OvFMA=
github.com/tdewolff/parse/v2 v2.6.8/go.mod h1:XHDhaU6IBgsryfdnpzUXBlT6leW/l25yrFBTEb4eIyM=
github.com/tidwall/gjson v1.17.1 h1:wlYEnwqAHgzmhNUFfw7Xalt2JzQvsMx2Se4PcoFCT/U=
github.com/tidwall/gjson v1.17.1/go.mod h1:/wbyibRr2FHMks5tjHJ5F8
---
[Medium] chunk lines 401-420 in go.work.sum:
github.com/grafana/e2e v0.1.1/go.mod h1:RpNLgae5VT+BUHvPE+/zSypmOXKwEu4t+tnEMS1ATaE=
github.com/grafana/grafana-cloud-migration-snapshot v1.2.0 h1:FCUWASPPzGGbF2jTutR5i3rmoQdmnC4bypwJswdW3fI=
github.com/grafana/grafana-cloud-migration-snapshot v1.2.0/go.mod h1:bd6Cm06EK0MzRO5ahUpbDz1SxNOKu+fzladbaRPHZPY=
github.com/grafana/grafana/pkg/apimachinery v0.0.0-20240701135906-559738ce6ae1/go.mod h1:DkxMin+qOh1Fgkxfbt+CUfBqqsCQJMG9op8Os/irBPA=
github.com/grafana/grafana-azure-sdk-go/v2 v2.1.0 h1:lajVqTW
---
[Medium] chunk lines 561-580 in go.work.sum:
github.com/open-telemetry/opentelemetry-collector-contrib/internal/kafka v0.97.0 h1:+EA1iNRxeOqtU+9/+4hu8Tz7LhW2xmhFPd3w+ntpxiE=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/kafka v0.97.0/go.mod h1:pHbdUUE+6ZWpvaHyyHQiytt7t6IPVCvacnDPmKWVgu0=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/sharedcomponent v0.97.0 h1:sd7JEwe5e7VYel/6gFWTKFTsQz8PxzdpU8tWlL6Ymos=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/sharedcomponent v0.97.0/go.mo
---
[Medium] chunk lines 681-700 in go.work.sum:
github.com/valyala/fasttemplate v1.2.2/go.mod h1:KHLXt3tVN2HBp8eijSv/kGJopbvo7S+qRAEEKiv+SiQ=
github.com/vburenin/ifacemaker v1.2.1 h1:3Vq8B/bfBgjWTkv+jDg4dVL1KHt3k1K4lO7XRxYA2sk=
github.com/vertica/vertica-sql-go v1.3.3 h1:fL+FKEAEy5ONmsvya2WH5T8bhkvY27y/Ik3ReR2T+Qw=
github.com/vertica/vertica-sql-go v1.3.3/go.mod h1:jnn2GFuv+O2Jcjktb7zyc4Utlbu9YVqpHH/lx63+1M4=
github.com/vinzenz/yaml v0.0.0-20170920082545-91409cdd725d h1:3wDi6J5APMqaHBVPuVd7RmHD2gRTfqbdcVSpCNoUWtk=
github.com/vinzenz/yaml v0.0
---
[Medium] chunk lines 781-800 in go.work.sum:
go.opentelemetry.io/collector/receiver v0.97.0 h1:ozzE5MhIPtfnYA/UKB/NCcgxSmeLqdwErboi6B/IpLQ=
go.opentelemetry.io/collector/receiver v0.97.0/go.mod h1:1TCN9DRuB45+xKqlwv4BMQR6qXgaJeSSNezFTJhmDUo=
go.opentelemetry.io/collector/receiver/otlpreceiver v0.97.1-0.20240327165504-2b0decfcebeb h1:gaxwgzaHKnlx6dAjFexd4eiFD3l0ePwdueqdNystJDU=
go.opentelemetry.io/collector/receiver/otlpreceiver v0.97.1-0.20240327165504-2b0decfcebeb/go.mod h1:JL1oxtysJT2TN80p/nC9vrWkENh/If7kmMRio7yF9WE=
go.opentelemetry.io/
---
[Medium] chunk lines 641-660 in go.work.sum:
github.com/satori/go.uuid v1.2.0 h1:0uYX9dsZ2yD7q2RtLRtPSdGDWzjeM3TbMJP9utgA0ww=
github.com/schollz/closestmatch v2.1.0+incompatible h1:Uel2GXEpJqOWBrlyI+oY9LTiyyjYS17cCYRqP13/SHk=
github.com/schollz/closestmatch v2.1.0+incompatible/go.mod h1:RtP1ddjLong6gTkbtmuhtR2uUrrJOpYzYRvbcPAid+g=
github.com/segmentio/fasthash v0.0.0-20180216231524-a72b379d632e h1:uO75wNGioszjmIzcY/tvdDYKRLVvzggtAmmJkn9j4GQ=
github.com/segmentio/fasthash v0.0.0-20180216231524-a72b379d632e/go.mod h1:tm/wZFQ8e24NYaBGIlnO2WGC
---
[Medium] function newDualWriterMode3 in pkg/apiserver/rest/dualwriter_mode3.go:
func newDualWriterMode3(legacy LegacyStorage, storage Storage, dwm *dualWriterMetrics) *DualWriterMode3 {
	return &DualWriterMode3{Legacy: legacy, Storage: storage, Log: klog.NewKlogr().WithName(""DualWriterMode3"").WithValues(""mode"", mode3Str), dualWriterMetrics: dwm}
}","TestMode1_Get (Medium), Create (Medium), Update (Medium), DeleteCollection (Medium), Delete (Medium), Get (Medium), List (Medium), TestIntegrationPlaylist (Medium), TestMode3_Create (Medium), TestMode3_Get (Medium), TestMode3_List (Medium), TestMode3_Delete (Medium), TestMode3_DeleteCollection (Medium), TestMode3_Update (Medium), lines 861-872 (Medium), lines 421-440 (Medium), lines 581-600 (Medium), lines 821-840 (Medium), lines 601-620 (Medium), lines 481-500 (Medium), lines 701-720 (Medium), lines 841-860 (Medium), lines 441-460 (Medium), lines 521-540 (Medium), lines 761-780 (Medium), lines 621-640 (Medium), lines 741-760 (Medium), lines 501-520 (Medium), lines 801-820 (Medium), lines 721-740 (Medium), lines 461-480 (Medium), lines 541-560 (Medium), lines 661-680 (Medium), lines 401-420 (Medium), lines 561-580 (Medium), lines 681-700 (Medium), lines 781-800 (Medium), lines 641-660 (Medium), newDualWriterMode3 (Medium), lines 861-880 (Low), lines 881-888 (Low)",miss,no HC entities for this PR
grafana,6,Dual Storage Architecture,Inconsistency: using name instead of options.Kind for metrics recording differs from other methods.,Medium,41,0,39,,,"[Medium] function TestMode1_Get in pkg/apiserver/rest/dualwriter_mode1_test.go:
func TestMode1_Get(t *testing.T) {
	type testCase struct {
		setupLegacyFn  func(m *mock.Mock, name string)
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""get an object only in the legacy store"",
				input: ""foo"",
				setupLegacyFn: func(m *mock.Mock, name string) {
					m.On(""Get"", mock.Anything, name, mock.Anything).Return(exampleObj, nil)
				},
				setupStorageFn: func(m *mock.
---
[Medium] method Create in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Create(ctx context.Context, obj runtime.Object, createValidation rest.ValidateObjectFunc, options *metav1.CreateOptions) (runtime.Object, error) {
	var method = ""create""
	log := d.Log.WithValues(""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	created, err := d.Storage.Create(ctx, obj, createValidation, options)
	if err != nil {
		log.Error(err, ""unable to create object in storage"")
		d.recordLegacyDuration(true, mod
---
[Medium] method Update in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Update(ctx context.Context, name string, objInfo rest.UpdatedObjectInfo, createValidation rest.ValidateObjectFunc, updateValidation rest.ValidateObjectUpdateFunc, forceAllowCreate bool, options *metav1.UpdateOptions) (runtime.Object, bool, error) {
	var method = ""update""
	log := d.Log.WithValues(""name"", name, ""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, async, err := d.Storage.Update(ctx, name, objInfo, crea
---
[Medium] method DeleteCollection in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) DeleteCollection(ctx context.Context, deleteValidation rest.ValidateObjectFunc, options *metav1.DeleteOptions, listOptions *metainternalversion.ListOptions) (runtime.Object, error) {
	var method = ""delete-collection""
	log := d.Log.WithValues(""kind"", options.Kind, ""resourceVersion"", listOptions.ResourceVersion, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.DeleteCollection(ctx, deleteValidation, options, listOption
---
[Medium] method Delete in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Delete(ctx context.Context, name string, deleteValidation rest.ValidateObjectFunc, options *metav1.DeleteOptions) (runtime.Object, bool, error) {
	var method = ""delete""
	log := d.Log.WithValues(""name"", name, ""kind"", options.Kind, ""method"", method)
	ctx = klog.NewContext(ctx, d.Log)

	startStorage := time.Now()
	res, async, err := d.Storage.Delete(ctx, name, deleteValidation, options)
	if err != nil {
		log.Error(err, ""unable to delete object in storage"")
		d.recordStora
---
[Medium] method Get in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) Get(ctx context.Context, name string, options *metav1.GetOptions) (runtime.Object, error) {
	var method = ""get""
	log := d.Log.WithValues(""kind"", options.Kind, ""name"", name, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.Get(ctx, name, options)
	if err != nil {
		log.Error(err, ""unable to get object in storage"")
	}
	d.recordStorageDuration(err != nil, mode3Str, options.Kind, method, startStorage)

	return res, err
}
---
[Medium] method List in pkg/apiserver/rest/dualwriter_mode3.go:
func (d *DualWriterMode3) List(ctx context.Context, options *metainternalversion.ListOptions) (runtime.Object, error) {
	var method = ""list""
	log := d.Log.WithValues(""kind"", options.Kind, ""resourceVersion"", options.ResourceVersion, ""method"", method)
	ctx = klog.NewContext(ctx, log)

	startStorage := time.Now()
	res, err := d.Storage.List(ctx, options)
	if err != nil {
		log.Error(err, ""unable to list object in storage"")
	}
	d.recordStorageDuration(err != nil, mode3Str, options.Kind, method, star
---
[Medium] function TestIntegrationPlaylist in pkg/tests/apis/playlist/playlist_test.go:
func TestIntegrationPlaylist(t *testing.T) {
	if testing.Short() {
		t.Skip(""skipping integration test"")
	}

	t.Run(""default setup"", func(t *testing.T) {
		h := doPlaylistTests(t, apis.NewK8sTestHelper(t, testinfra.GrafanaOpts{
			AppModeProduction:    true, // do not start extra port 6443
			DisableAnonymous:     true,
			EnableFeatureToggles: []string{},
		}))

		// The accepted verbs will change when dual write is enabled
		disco := h.GetGroupVersionInfoJSON(""playlist.grafana.app"")
		// fmt.P
---
[Medium] function TestMode3_Create in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Create(t *testing.T) {
	type testCase struct {
		input          runtime.Object
		setupLegacyFn  func(m *mock.Mock, input runtime.Object)
		setupStorageFn func(m *mock.Mock)
		name           string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""creating an object only in the unified store"",
				input: exampleObj,
				setupLegacyFn: func(m *mock.Mock, input runtime.Object) {
					m.On(""Create"", mock.Anything, input, mock.Anything, mock.Anything).Return(exampleObj,
---
[Medium] function TestMode3_Get in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Get(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""get an object only in unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, name string) {
					m.On(""Get"", mock.Anything, name, mock.Anything).Return(exampleObj, nil)
				},
			},
			{
				name:  ""error when getting an object in the unified store fails"",
			
---
[Medium] function TestMode3_List in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_List(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, options *metainternalversion.ListOptions)
		name           string
		options        *metainternalversion.ListOptions
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:    ""error when listing an object in the unified store is not implemented"",
				options: &metainternalversion.ListOptions{TypeMeta: metav1.TypeMeta{Kind: ""fail""}},
				setupStorageFn: func(m *mock.Mock, options *metainternalv
---
[Medium] function TestMode3_Delete in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Delete(t *testing.T) {
	type testCase struct {
		setupStorageFn func(m *mock.Mock, name string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""deleting an object in the unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, name string) {
					m.On(""Delete"", mock.Anything, name, mock.Anything, mock.Anything).Return(exampleObj, false, nil)
				},
			},
			{
				name:  ""error when deleting an object
---
[Medium] function TestMode3_DeleteCollection in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_DeleteCollection(t *testing.T) {
	type testCase struct {
		input          *metav1.DeleteOptions
		setupStorageFn func(m *mock.Mock, input *metav1.DeleteOptions)
		name           string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""deleting a collection in the unified store"",
				input: &metav1.DeleteOptions{TypeMeta: metav1.TypeMeta{Kind: ""foo""}},
				setupStorageFn: func(m *mock.Mock, input *metav1.DeleteOptions) {
					m.On(""DeleteCollection"", mock.Anything, 
---
[Medium] function TestMode3_Update in pkg/apiserver/rest/dualwriter_mode3_test.go:
func TestMode3_Update(t *testing.T) {
	type testCase struct {
		setupLegacyFn  func(m *mock.Mock, input string)
		setupStorageFn func(m *mock.Mock, input string)
		name           string
		input          string
		wantErr        bool
	}
	tests :=
		[]testCase{
			{
				name:  ""update an object in unified store"",
				input: ""foo"",
				setupStorageFn: func(m *mock.Mock, input string) {
					m.On(""Update"", mock.Anything, input, mock.Anything, mock.Anything, mock.Anything, mock.Anything, mock.Anything
---
[Medium] chunk lines 861-872 in go.work.sum:
modernc.org/ccorpus v1.11.6 h1:J16RXiiqiCgua6+ZvQot4yUuUy8zxgqbqEEUuGPlISk=
modernc.org/httpfs v1.0.6 h1:AAgIpFZRXuYnkjftxTAZwMIiwEqAfk8aVB2/oA6nAeM=
modernc.org/opt v0.1.3 h1:3XOZf2yznlhC+ibLltsDGzABUGVx8J6pnFMS3E4dcq4=
modernc.org/tcl v1.15.1 h1:mOQwiEK4p7HruMZcwKTZPw/aqtGM4aY00uzWhlKKYws=
modernc.org/z v1.7.0 h1:xkDw/KepgEjeizO2sNco+hqYkU12taxQFqPEmgm1GWE=
nhooyr.io/websocket v1.8.10 h1:mv4p+MnGrLDcPlBoWsvPP7XCzTYMXP9F9eIGoKbgx7Q=
nhooyr.io/websocket v1.8.10/go.mod h1:rN9OFWIUwuxg4fR5tELlYC04
---
[Medium] chunk lines 421-440 in go.work.sum:
github.com/hashicorp/go.net v0.0.1 h1:sNCoNyDEvN1xa+X0baata4RdcpKwcMS6DH+xwfqPgjw=
github.com/hashicorp/logutils v1.0.0 h1:dLEQVugN8vlakKOUE3ihGLTZJRB4j+M2cdTm/ORI65Y=
github.com/hashicorp/mdns v1.0.4 h1:sY0CMhFmjIPDMlTB+HfymFHCaYLhgifZ0QhjaYKD/UQ=
github.com/hexops/gotextdiff v1.0.3 h1:gitA9+qJrrTCsiCl7+kh75nPqQt1cx4ZkudSTLoUqJM=
github.com/hpcloud/tail v1.0.0 h1:nfCOvKYfkgYP8hkirhJocXT2+zOD8yUNjXaWfTlyFKI=
github.com/hudl/fargo v1.4.0 h1:ZDDILMbB37UlAVLlWcJ2Iz1XuahZZTDZfdCKeclfq2s=
github.com/
---
[Medium] chunk lines 581-600 in go.work.sum:
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.97.0 h1:vPQQQezde/dqG/UzWFVeWPUE5YUU3neybTWtF6dSSLM=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.97.0/go.mod h1:oC3rBafNReIB/XZDshYZjjFulwOF1Feu3ZmY7aYJ4P4=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkareceiver v0.97.0 h1:S6b9R3SexIKjaP6wB7+v20oX/7abc9vOsiazMA+j/gM=
github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkareceiver
---
[Medium] chunk lines 821-840 in go.work.sum:
go.uber.org/tools v0.0.0-20190618225709-2cfd321de3ee h1:0mgffUl7nfd+FpvXMVz4IDEaUSmT1ysygQC7qYo7sG4=
golang.org/x/arch v0.4.0 h1:A8WCeEWhLwPBKNbFi5Wv5UTCBx5zzubnXDlMOFAzFMc=
golang.org/x/arch v0.4.0/go.mod h1:5om86z9Hs0C8fWVUuoMHwpExlXzs5Tkyp9hOrfG7pp8=
golang.org/x/crypto v0.0.0-20190911031432-227b76d455e7/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
golang.org/x/crypto v0.23.0/go.mod h1:CKFgDieR+mRhux2Lsu27y0fO304Db0wZe70UKqHu0v8=
golang.org/x/image v0.6.0 h1:bR8b5okrPI3g/gyZakLZHeWx
---
[Medium] chunk lines 601-620 in go.work.sum:
github.com/paulmach/orb v0.10.0 h1:guVYVqzxHE/CQ1KpfGO077TR0ATHSNjp4s6XGLn3W9s=
github.com/paulmach/orb v0.10.0/go.mod h1:5mULz1xQfs3bmQm63QEJA6lNGujuRafwA5S/EnuLaLU=
github.com/pbnjay/memory v0.0.0-20210728143218-7b4eea64cf58 h1:onHthvaw9LFnH4t2DcNVpwGmV9E1BkGknEliJkfwQj0=
github.com/pborman/getopt v0.0.0-20170112200414-7148bc3a4c30 h1:BHT1/DKsYDGkUgQ2jmMaozVcdk+sVfz0+1ZJq4zkWgw=
github.com/pborman/uuid v1.2.0 h1:J7Q5mO4ysT1dv8hyrUGHb9+ooztCXu1D8MY8DZYsu3g=
github.com/pelletier/go-toml v1.9.5 h
---
[Medium] chunk lines 481-500 in go.work.sum:
github.com/kballard/go-shellquote v0.0.0-20180428030007-95032a82bc51 h1:Z9n2FFNUXsshfwJMBgNA0RU6/i7WVaAegv3PtuIHPMs=
github.com/kelseyhightower/envconfig v1.4.0 h1:Im6hONhd3pLkfDFsbRgu68RDNkGF1r3dvMUtDTo2cv8=
github.com/kevinmbeaulieu/eq-go v1.0.0 h1:AQgYHURDOmnVJ62jnEk0W/7yFKEn+Lv8RHN6t7mB0Zo=
github.com/kevinmbeaulieu/eq-go v1.0.0/go.mod h1:G3S8ajA56gKBZm4UB9AOyoOS37JO3roToPzKNM8dtdM=
github.com/kisielk/errcheck v1.5.0 h1:e8esj/e4R+SAOwFwN+n3zr0nYeCyeweozKfO23MvHzY=
github.com/kisielk/gotool v
---
[Medium] chunk lines 701-720 in go.work.sum:
github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f h1:J9EGpcZtP0E/raorCMxlFGSTBrsSlaDGf3jU/qvAE2c=
github.com/xeipuuv/gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f/go.mod h1:N2zxlSyiKSe5eX1tZViRH5QA0qijqEDrYZiPEAiq3wU=
github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415 h1:EzJWgHovont7NscjpAxXsDA8S8BMYve8Y5+7cuRE7R0=
github.com/xeipuuv/gojsonreference v0.0.0-20180127040603-bd5ef7bd5415/go.mod h1:GwrjFmJcFw6At/Gs6z4yjiIwzuJ1/+UwLxMQDVQXShQ=
github.com/xeipuuv
---
[Medium] chunk lines 841-860 in go.work.sum:
google.golang.org/genproto/googleapis/bytestream v0.0.0-20240325203815-454cdb8f5daa h1:wBkzraZsSqhj1M4L/nMrljUU6XasJkgHvUsq8oRGwF0=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240318140521-94a12d6c2237/go.mod h1:WtryC6hu0hhx87FDGxWCDptyssuo68sk10vYjF+T9fY=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240513163218-0867130af1f8/go.mod h1:I7Y+G38R2bu5j1aLzfFmQfTcU/WnFuqDwLZAbvKTKpM=
google.golang.org/genproto/googleapis/rpc v0.0.0-20240604185151-ef581f913117/go.mod h1:EfXuqaE1J41VCDicx
---
[Medium] chunk lines 441-460 in go.work.sum:
github.com/jackc/pgproto3/v2 v2.2.0 h1:r7JypeP2D3onoQTCxWdTpCtJ4D+qpKr0TxvoyMhZ5ns=
github.com/jackc/pgtype v1.10.0 h1:ILnBWrRMSXGczYvmkYD6PsYyVFUNLTnIUJHHDLmqk38=
github.com/jackc/pgx v3.2.0+incompatible h1:0Vihzu20St42/UDsvZGdNE6jak7oi/UOeMzwMPHkgFY=
github.com/jackc/pgx/v4 v4.15.0 h1:B7dTkXsdILD3MF987WGGCcg+tvLW6bZJdEcqVFeU//w=
github.com/jackc/puddle v1.2.1 h1:gI8os0wpRXFd4FiAY2dWiqRK037tjj3t7rKFeO4X5iw=
github.com/jackspirou/syscerts v0.0.0-20160531025014-b68f5469dff1 h1:9Xm8CKtMZIXgcopfdWk
---
[Medium] chunk lines 521-540 in go.work.sum:
github.com/minio/highwayhash v1.0.2 h1:Aak5U0nElisjDCfPSG79Tgzkn2gl66NxOMspRrKnA/g=
github.com/minio/md5-simd v1.1.2 h1:Gdi1DZK69+ZVMoNHRXJyNcxrMA4dSxoYHZSQbirFg34=
github.com/minio/md5-simd v1.1.2/go.mod h1:MzdKDxYpY2BT9XQFocsiZf/NKVtR7nkE4RoEpN+20RM=
github.com/minio/minio-go/v7 v7.0.63 h1:GbZ2oCvaUdgT5640WJOpyDhhDxvknAJU2/T3yurwcbQ=
github.com/minio/minio-go/v7 v7.0.63/go.mod h1:Q6X7Qjb7WMhvG65qKf4gUgA5XaiSox74kR1uAEjxRS4=
github.com/minio/sha256-simd v1.0.1 h1:6kaan5IFmwTNynnKKpDHe6FWHohJOHh
---
[Medium] chunk lines 761-780 in go.work.sum:
go.opentelemetry.io/collector/confmap/provider/httpsprovider v0.97.0/go.mod h1:R+cJ8wWzaJll+WCTUOM769zIk1vOb7NQARG9xWNbgUA=
go.opentelemetry.io/collector/confmap/provider/yamlprovider v0.97.0 h1:ntcR7AMHwFRROTMW1ifx0xVu+ltbPafS/1r/ssxe+hM=
go.opentelemetry.io/collector/confmap/provider/yamlprovider v0.97.0/go.mod h1:0THo600LMD0RGl7loqyaHgd/47Icgb64QOmqaj0j5dU=
go.opentelemetry.io/collector/connector v0.95.0 h1:HBfGg92Eyw5jkneu7jh3yed7w/dzi7v6SZ+CyqpNK7E=
go.opentelemetry.io/collector/connector v
---
[Medium] chunk lines 621-640 in go.work.sum:
github.com/prashantv/gostub v1.1.0 h1:BTyx3RfQjRHnUWaGF9oQos79AlQ5k8WNktv7VGvVH4g=
github.com/prometheus/common/assets v0.2.0 h1:0P5OrzoHrYBOSM1OigWL3mY8ZvV2N4zIE/5AahrSrfM=
github.com/prometheus/statsd_exporter v0.26.0 h1:SQl3M6suC6NWQYEzOvIv+EF6dAMYEqIuZy+o4H9F5Ig=
github.com/prometheus/statsd_exporter v0.26.0/go.mod h1:GXFLADOmBTVDrHc7b04nX8ooq3azG61pnECNqT7O5DM=
github.com/rcrowley/go-metrics v0.0.0-20201227073835-cf1acfcdf475 h1:N/ElC8H3+5XpJzTSTfLsJV/mx9Q9g7kxmchpfZyxgzM=
github.com/rcrowl
---
[Medium] chunk lines 741-760 in go.work.sum:
go.opentelemetry.io/collector/config/configopaque v1.4.0/go.mod h1:7Qzo69x7i+FaNELeA9jmZtVvfnR5lE6JYa5YEOCJPFQ=
go.opentelemetry.io/collector/config/configretry v0.97.0 h1:k7VwQ5H0oBLm6Fgm0ltfDDbmQVsiqSIY9ojijF0hiR0=
go.opentelemetry.io/collector/config/configretry v0.97.0/go.mod h1:s7A6ZGxK8bxqidFzwbr2pITzbsB2qf+aeHEDQDcanV8=
go.opentelemetry.io/collector/config/configtelemetry v0.97.0 h1:JS/WxK09A9m39D5OqsAWaoRe4tG7ESMnzDNIbZ5bD6c=
go.opentelemetry.io/collector/config/configtelemetry v0.97.0/g
---
[Medium] chunk lines 501-520 in go.work.sum:
github.com/ledongthuc/pdf v0.0.0-20220302134840-0c2507a12d80 h1:6Yzfa6GP0rIo/kULo2bwGEkFvCePZ3qHDDTC3/J9Swo=
github.com/leodido/go-urn v1.2.4 h1:XlAE/cm/ms7TE/VMVoduSpNBoyc2dOxHs5MZSwAN63Q=
github.com/leodido/go-urn v1.2.4/go.mod h1:7ZrI8mTSeBSHl/UaRyKQW1qZeMgak41ANeCNaVckg+4=
github.com/libsql/sqlite-antlr4-parser v0.0.0-20240327125255-dbf53b6cbf06 h1:JLvn7D+wXjH9g4Jsjo+VqmzTUpl/LX7vfr6VOfSWTdM=
github.com/libsql/sqlite-antlr4-parser v0.0.0-20240327125255-dbf53b6cbf06/go.mod h1:FUkZ5OHjlGPjnM2U
---
[Medium] chunk lines 801-820 in go.work.sum:
go.opentelemetry.io/otel/exporters/otlp/otlpmetric/otlpmetrichttp v1.23.1/go.mod h1:DTE9yAu6r08jU3xa68GiSeI7oRcSEQ2RpKbbQGO+dWM=
go.opentelemetry.io/otel/exporters/otlp/otlptrace v1.26.0/go.mod h1:z46paqbJ9l7c9fIPCXTqTGwhQZ5XoTIsfeFYWboizjs=
go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc v1.26.0/go.mod h1:wnJIG4fOqyynOnnQF/eQb4/16VlX2EJAHhHgqIqWfAo=
go.opentelemetry.io/otel/exporters/prometheus v0.37.0 h1:NQc0epfL0xItsmGgSXgfbH2C1fq2VLXkZoDFsfRNHpc=
go.opentelemetry.io/otel/expo
---
[Medium] chunk lines 721-740 in go.work.sum:
github.com/zenazn/goji v1.0.1/go.mod h1:7S9M489iMyHBNxwZnk9/EHS098H4/F6TATF2mIxtB1Q=
github.com/ziutek/mymysql v1.5.4 h1:GB0qdRGsTwQSBVYuVShFBKaXSnSnYYC2d9knnE1LHFs=
github.com/ziutek/mymysql v1.5.4/go.mod h1:LMSpPZ6DbqWFxNCHW77HeMg9I646SAhApZ/wKdgO/C0=
gitlab.com/nyarla/go-crypt v0.0.0-20160106005555-d9a5dc2b789b h1:7gd+rd8P3bqcn/96gOZa3F5dpJr/vEiDQYlNb/y2uNs=
go.einride.tech/aip v0.66.0 h1:XfV+NQX6L7EOYK11yoHHFtndeaWh3KbD9/cN/6iWEt8=
go.opentelemetry.io/collector v0.97.0 h1:qyOju13byHIKEK/Jehm
---
[Medium] chunk lines 461-480 in go.work.sum:
github.com/jon-whit/go-grpc-prometheus v1.4.0/go.mod h1:iTPm+Iuhh3IIqR0iGZ91JJEg5ax6YQEe1I0f6vtBuao=
github.com/jstemmer/go-junit-report v0.9.1 h1:6QPYqodiu3GuPL+7mfx+NwDdp2eTkp9IfEUpgAwUN0o=
github.com/jsternberg/zap-logfmt v1.2.0 h1:1v+PK4/B48cy8cfQbxL4FmmNZrjnIMr2BsnyEmXqv2o=
github.com/jsternberg/zap-logfmt v1.2.0/go.mod h1:kz+1CUmCutPWABnNkOu9hOHKdT2q3TDYCcsFy9hpqb0=
github.com/juju/gnuflag v0.0.0-20171113085948-2ce1bb71843d h1:c93kUJDtVAXFEhsCh5jSxyOJmFHuzcihnslQiX8Urwo=
github.com/juliens
---
[Medium] chunk lines 541-560 in go.work.sum:
github.com/nats-io/nats-server/v2 v2.5.0 h1:wsnVaaXH9VRSg+A2MVg5Q727/CqxnmPLGFQ3YZYKTQg=
github.com/nats-io/nats.go v1.31.0 h1:/WFBHEc/dOKBF6qf1TZhrdEfTmOZ5JzdJ+Y3m6Y/p7E=
github.com/nats-io/nats.go v1.31.0/go.mod h1:di3Bm5MLsoB4Bx61CBTsxuarI36WbhAwOm8QrW39+i8=
github.com/nats-io/nkeys v0.4.6 h1:IzVe95ru2CT6ta874rt9saQRkWfe2nFj1NtvYSLqMzY=
github.com/nats-io/nkeys v0.4.6/go.mod h1:4DxZNzenSVd1cYQoAa8948QY3QDjrHfcfVADymtkpts=
github.com/nats-io/nuid v1.0.1 h1:5iA8DT8V7q8WK2EScv2padNa/rTESc1KdnPw4
---
[Medium] chunk lines 661-680 in go.work.sum:
github.com/tdewolff/minify/v2 v2.12.9 h1:dvn5MtmuQ/DFMwqf5j8QhEVpPX6fi3WGImhv8RUB4zA=
github.com/tdewolff/minify/v2 v2.12.9/go.mod h1:qOqdlDfL+7v0/fyymB+OP497nIxJYSvX4MQWA8OoiXU=
github.com/tdewolff/parse/v2 v2.6.8 h1:mhNZXYCx//xG7Yq2e/kVLNZw4YfYmeHbhx+Zc0OvFMA=
github.com/tdewolff/parse/v2 v2.6.8/go.mod h1:XHDhaU6IBgsryfdnpzUXBlT6leW/l25yrFBTEb4eIyM=
github.com/tidwall/gjson v1.17.1 h1:wlYEnwqAHgzmhNUFfw7Xalt2JzQvsMx2Se4PcoFCT/U=
github.com/tidwall/gjson v1.17.1/go.mod h1:/wbyibRr2FHMks5tjHJ5F8
---
[Medium] chunk lines 401-420 in go.work.sum:
github.com/grafana/e2e v0.1.1/go.mod h1:RpNLgae5VT+BUHvPE+/zSypmOXKwEu4t+tnEMS1ATaE=
github.com/grafana/grafana-cloud-migration-snapshot v1.2.0 h1:FCUWASPPzGGbF2jTutR5i3rmoQdmnC4bypwJswdW3fI=
github.com/grafana/grafana-cloud-migration-snapshot v1.2.0/go.mod h1:bd6Cm06EK0MzRO5ahUpbDz1SxNOKu+fzladbaRPHZPY=
github.com/grafana/grafana/pkg/apimachinery v0.0.0-20240701135906-559738ce6ae1/go.mod h1:DkxMin+qOh1Fgkxfbt+CUfBqqsCQJMG9op8Os/irBPA=
github.com/grafana/grafana-azure-sdk-go/v2 v2.1.0 h1:lajVqTW
---
[Medium] chunk lines 561-580 in go.work.sum:
github.com/open-telemetry/opentelemetry-collector-contrib/internal/kafka v0.97.0 h1:+EA1iNRxeOqtU+9/+4hu8Tz7LhW2xmhFPd3w+ntpxiE=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/kafka v0.97.0/go.mod h1:pHbdUUE+6ZWpvaHyyHQiytt7t6IPVCvacnDPmKWVgu0=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/sharedcomponent v0.97.0 h1:sd7JEwe5e7VYel/6gFWTKFTsQz8PxzdpU8tWlL6Ymos=
github.com/open-telemetry/opentelemetry-collector-contrib/internal/sharedcomponent v0.97.0/go.mo
---
[Medium] chunk lines 681-700 in go.work.sum:
github.com/valyala/fasttemplate v1.2.2/go.mod h1:KHLXt3tVN2HBp8eijSv/kGJopbvo7S+qRAEEKiv+SiQ=
github.com/vburenin/ifacemaker v1.2.1 h1:3Vq8B/bfBgjWTkv+jDg4dVL1KHt3k1K4lO7XRxYA2sk=
github.com/vertica/vertica-sql-go v1.3.3 h1:fL+FKEAEy5ONmsvya2WH5T8bhkvY27y/Ik3ReR2T+Qw=
github.com/vertica/vertica-sql-go v1.3.3/go.mod h1:jnn2GFuv+O2Jcjktb7zyc4Utlbu9YVqpHH/lx63+1M4=
github.com/vinzenz/yaml v0.0.0-20170920082545-91409cdd725d h1:3wDi6J5APMqaHBVPuVd7RmHD2gRTfqbdcVSpCNoUWtk=
github.com/vinzenz/yaml v0.0
---
[Medium] chunk lines 781-800 in go.work.sum:
go.opentelemetry.io/collector/receiver v0.97.0 h1:ozzE5MhIPtfnYA/UKB/NCcgxSmeLqdwErboi6B/IpLQ=
go.opentelemetry.io/collector/receiver v0.97.0/go.mod h1:1TCN9DRuB45+xKqlwv4BMQR6qXgaJeSSNezFTJhmDUo=
go.opentelemetry.io/collector/receiver/otlpreceiver v0.97.1-0.20240327165504-2b0decfcebeb h1:gaxwgzaHKnlx6dAjFexd4eiFD3l0ePwdueqdNystJDU=
go.opentelemetry.io/collector/receiver/otlpreceiver v0.97.1-0.20240327165504-2b0decfcebeb/go.mod h1:JL1oxtysJT2TN80p/nC9vrWkENh/If7kmMRio7yF9WE=
go.opentelemetry.io/
---
[Medium] chunk lines 641-660 in go.work.sum:
github.com/satori/go.uuid v1.2.0 h1:0uYX9dsZ2yD7q2RtLRtPSdGDWzjeM3TbMJP9utgA0ww=
github.com/schollz/closestmatch v2.1.0+incompatible h1:Uel2GXEpJqOWBrlyI+oY9LTiyyjYS17cCYRqP13/SHk=
github.com/schollz/closestmatch v2.1.0+incompatible/go.mod h1:RtP1ddjLong6gTkbtmuhtR2uUrrJOpYzYRvbcPAid+g=
github.com/segmentio/fasthash v0.0.0-20180216231524-a72b379d632e h1:uO75wNGioszjmIzcY/tvdDYKRLVvzggtAmmJkn9j4GQ=
github.com/segmentio/fasthash v0.0.0-20180216231524-a72b379d632e/go.mod h1:tm/wZFQ8e24NYaBGIlnO2WGC
---
[Medium] function newDualWriterMode3 in pkg/apiserver/rest/dualwriter_mode3.go:
func newDualWriterMode3(legacy LegacyStorage, storage Storage, dwm *dualWriterMetrics) *DualWriterMode3 {
	return &DualWriterMode3{Legacy: legacy, Storage: storage, Log: klog.NewKlogr().WithName(""DualWriterMode3"").WithValues(""mode"", mode3Str), dualWriterMetrics: dwm}
}","TestMode1_Get (Medium), Create (Medium), Update (Medium), DeleteCollection (Medium), Delete (Medium), Get (Medium), List (Medium), TestIntegrationPlaylist (Medium), TestMode3_Create (Medium), TestMode3_Get (Medium), TestMode3_List (Medium), TestMode3_Delete (Medium), TestMode3_DeleteCollection (Medium), TestMode3_Update (Medium), lines 861-872 (Medium), lines 421-440 (Medium), lines 581-600 (Medium), lines 821-840 (Medium), lines 601-620 (Medium), lines 481-500 (Medium), lines 701-720 (Medium), lines 841-860 (Medium), lines 441-460 (Medium), lines 521-540 (Medium), lines 761-780 (Medium), lines 621-640 (Medium), lines 741-760 (Medium), lines 501-520 (Medium), lines 801-820 (Medium), lines 721-740 (Medium), lines 461-480 (Medium), lines 541-560 (Medium), lines 661-680 (Medium), lines 401-420 (Medium), lines 561-580 (Medium), lines 681-700 (Medium), lines 781-800 (Medium), lines 641-660 (Medium), newDualWriterMode3 (Medium), lines 861-880 (Low), lines 881-888 (Low)",miss,no HC entities for this PR
grafana,5,Notification Rule Processing Engine,The rendered GrafanaRuleListItem is missing the required key prop for React list items. This can cause rendering issues when the list order changes.,Medium,66,17,43,"variable::skipToken (public/app/features/alerting/unified/hooks/useAbilities.ts) [Critical, score=0.88] | function::GrafanaGroupLoader (public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx) [Critical, score=0.77] | function::useAllAlertRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [Critical, score=0.74] | interface::GrafanaPromRuleDTOBase (public/app/types/unified-alerting-dto.ts) [High, score=0.70] | variable::moreButton (public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx) [High, score=0.66] | variable::moreButton (public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx) [High, score=0.66] | function::GrafanaRuleListItem (public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx) [High, score=0.64] | variable::AlertRuleMenu (public/app/features/alerting/unified/components/rule-viewer/AlertRuleMenu.tsx) [High, score=0.62] | function::useAllRulerRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.62] | function::useRulerRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.58] | interface::IsGrafanaPromRuleEditableResult (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.58] | interface::GrafanaRuleListItemProps (public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx) [High, score=0.58] | function::FilterViewResults (public/app/features/alerting/unified/rule-list/FilterView.tsx) [High, score=0.53] | function::useAllGrafanaPromRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.52] | type::SkipToken (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.52] | function::useGrafanaPromRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.52] | function::isProvisionedPromRule (public/app/features/alerting/unified/utils/rules.ts) [High, score=0.52]","[Critical] variable skipToken in public/app/features/alerting/unified/hooks/useAbilities.ts:
const skipToken = Symbol('ability-skip-token');
---
[Critical] function GrafanaGroupLoader in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx:
function GrafanaGroupLoader({
  groupIdentifier,
  namespaceName,
  expectedRulesCount = 3, // 3 is a random number. Usually we get the number of rules from Prometheus response
}: GrafanaGroupLoaderProps) {
  const { data: promResponse, isLoading: isPromResponseLoading } = useGetGrafanaGroupsQuery(
    {
      folderUid: groupIdentifier.namespace.uid,
      groupName: groupIdentifier.groupName,
      limitAlerts: 0,
    },
    { pollingInterval: RULE_LIST_POLL_INTERVAL_MS }
  );

  if (isPromResponseLoading) {
    return (
      <>
        {Array.from({ length: expectedRulesCount }).map((_, index) => (
          <AlertRuleListItemSkeleton key={index} />
        ))}
      </>
    );
  }

  if (!promResponse) {
    return (
      <Alert
        title={t(
          'alerting.group-loader.grou
---
[Critical] function useAllAlertRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useAllAlertRuleAbilities(rule: CombinedRule): Abilities<AlertRuleAction> {
  // This hook is being called a lot in different places
  // In some cases multiple times for ~80 rules (e.g. on the list page)
  // We need to investigate further if some of these calls are redundant
  // In the meantime, memoizing the result helps
  const groupIdentifierV2 = useMemo(() => groupIdentifier.fromCombinedRule(rule), [rule]);
  return useAllRulerRuleAbilities(rule.rulerRule, groupIdentifierV2);
}
---
[High] interface GrafanaPromRuleDTOBase in public/app/types/unified-alerting-dto.ts:
interface GrafanaPromRuleDTOBase extends PromRuleDTOBase {
  uid: string;
  folderUid: string;
  isPaused: boolean;
  queriedDatasourceUIDs?: string[];
  provenance?: string;
}
---
[High] variable moreButton in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const moreButton = ui.moreButton().get(ruleListItem);
---
[High] variable moreButton in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const moreButton = ui.moreButton().get(ruleListItem);
---
[High] function GrafanaRuleListItem in public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx:
function GrafanaRuleListItem({
  rule,
  groupIdentifier,
  namespaceName,
  operation,
  showLocation = true,
}: GrafanaRuleListItemProps) {
  const { name, uid, labels, provenance } = rule;

  const commonProps: RuleListItemCommonProps = {
    name,
    rulesSource: GrafanaRulesSource,
    group: groupIdentifier.groupName,
    namespace: namespaceName,
    href: createRelativeUrl(`/alerting/grafana/${uid}/view`),
    health: rule?.health,
    error: rule?.lastError,
    labels: labels,
    isProvisioned: Boolean(provenance),
    isPaused: rule?.isPaused,
    application: 'grafana' as const,
    actions: <RuleActionsButtons promRule={rule} groupIdentifier={groupIdentifier} compact />,
  };

  if (prometheusRuleType.grafana.alertingRule(rule)) {
    const promAlertingRule = rule && rule.ty
---
[High] variable AlertRuleMenu in public/app/features/alerting/unified/components/rule-viewer/AlertRuleMenu.tsx:
const AlertRuleMenu = ({
  promRule,
  rulerRule,
  identifier,
  groupIdentifier,
  handleSilence,
  handleDelete,
  handleDuplicateRule,
  onPauseChange,
  buttonSize,
  fill,
}: Props) => {
  // check all abilities and permissions using rulerRule
  const [rulerPauseAbility, rulerDeleteAbility, rulerDuplicateAbility, rulerSilenceAbility, rulerExportAbility] =
    useRulerRuleAbilities(rulerRule, groupIdentifier, [
      AlertRuleAction.Pause,
      AlertRuleAction.Delete,
      AlertRuleAction.Duplicate,
      AlertRuleAction.Silence,
      AlertRuleAction.ModifyExport,
    ]);

  // check all abilities and permissions using promRule
  const [
    grafanaPauseAbility,
    grafanaDeleteAbility,
    grafanaDuplicateAbility,
    grafanaSilenceAbility,
    grafanaExportAbility,
  ] = useGraf
---
[High] function useAllRulerRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useAllRulerRuleAbilities(
  rule: RulerRuleDTO | undefined,
  groupIdentifier: RuleGroupIdentifierV2
): Abilities<AlertRuleAction> {
  const rulesSourceName = getGroupOriginName(groupIdentifier);

  const { isEditable, isRemovable, isRulerAvailable = false, loading } = useIsRuleEditable(rulesSourceName, rule);
  const [_, exportAllowed] = useAlertingAbility(AlertingAction.ExportGrafanaManagedRules);
  const canSilence = useCanSilence(rule);

  const abilities = useMemo<Abilities<AlertRuleAction>>(() => {
    const isProvisioned = rule ? isProvisionedRule(rule) : false;
    // TODO: Add support for federated rules
    // const isFederated = isFederatedRuleGroup();
    const isFederated = false;
    const isGrafanaManagedAlertRule = rulerRuleType.grafana.rule(rule);
    const isPlug
---
[High] function useRulerRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useRulerRuleAbilities(
  rule: RulerRuleDTO | undefined,
  groupIdentifier: RuleGroupIdentifierV2,
  actions: AlertRuleAction[]
): Ability[] {
  const abilities = useAllRulerRuleAbilities(rule, groupIdentifier);

  return useMemo(() => {
    return actions.map((action) => abilities[action]);
  }, [abilities, actions]);
}
---
[High] interface IsGrafanaPromRuleEditableResult in public/app/features/alerting/unified/hooks/useAbilities.ts:
interface IsGrafanaPromRuleEditableResult {
  isEditable: boolean;
  isRemovable: boolean;
  loading: boolean;
}
---
[High] interface GrafanaRuleListItemProps in public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx:
interface GrafanaRuleListItemProps {
  rule: GrafanaPromRuleDTO;
  groupIdentifier: GrafanaRuleGroupIdentifier;
  namespaceName: string;
  operation?: RuleOperation;
  showLocation?: boolean;
}
---
[High] function FilterViewResults in public/app/features/alerting/unified/rule-list/FilterView.tsx:
function FilterViewResults({ filterState }: FilterViewProps) {
  const [transitionPending, startTransition] = useTransition();

  /* this hook returns a function that creates an AsyncIterable<RuleWithOrigin> which we will use to populate the front-end */
  const getFilteredRulesIterator = useFilteredRulesIteratorProvider();

  const iteration = useRef<{
    rulesBatchIterator: AsyncIterator<RuleWithOrigin[]>;
    abortController: AbortController;
  } | null>(null);

  const [rules, setRules] = useState<KeyedRuleWithOrigin[]>([]);
  const [doneSearching, setDoneSearching] = useState(false);

  // Lazy initialization of useRef
  // https://18.react.dev/reference/react/useRef#how-to-avoid-null-checks-when-initializing-use-ref-later
  const getRulesBatchIterator = useCallback(() => {
    if (!
---
[High] function useAllGrafanaPromRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useAllGrafanaPromRuleAbilities(rule: GrafanaPromRuleDTO | undefined): Abilities<AlertRuleAction> {
  // For GrafanaPromRuleDTO, we use useIsGrafanaPromRuleEditable instead
  const { isEditable, isRemovable, loading } = useIsGrafanaPromRuleEditable(rule); // duplicate
  const [_, exportAllowed] = useAlertingAbility(AlertingAction.ExportGrafanaManagedRules);

  const silenceSupported = useGrafanaRulesSilenceSupport();
  const canSilenceInFolder = useCanSilenceInFolder(rule?.folderUid);

  const abilities = useMemo<Abilities<AlertRuleAction>>(() => {
    const isProvisioned = rule ? isProvisionedPromRule(rule) : false;

    // Note: Grafana managed rules can't be federated - this is strictly a Mimir feature
    // See: https://grafana.com/docs/mimir/latest/references/architecture/com
---
[High] type SkipToken in public/app/features/alerting/unified/hooks/useAbilities.ts:
type SkipToken = typeof skipToken;
---
[High] function useGrafanaPromRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useGrafanaPromRuleAbilities(
  rule: GrafanaPromRuleDTO | SkipToken,
  actions: AlertRuleAction[]
): Ability[] {
  const abilities = useAllGrafanaPromRuleAbilities(rule === skipToken ? undefined : rule);

  return useMemo(() => {
    return actions.map((action) => abilities[action]);
  }, [abilities, actions]);
}
---
[High] function isProvisionedPromRule in public/app/features/alerting/unified/utils/rules.ts:
function isProvisionedPromRule(promRule: PromRuleDTO): boolean {
  return prometheusRuleType.grafana.rule(promRule) && Boolean(promRule.provenance);
}","[Medium] function useGrafanaGroupsGenerator in public/app/features/alerting/unified/rule-list/hooks/prometheusGroupsGenerator.ts:
function useGrafanaGroupsGenerator(hookOptions: UseGeneratorHookOptions = {}) {
  const dispatch = useDispatch();
  const [getGrafanaGroups] = useLazyGetGrafanaGroupsQuery();

  const getGroupsAndProvideCache = useCallback(
    async (fetchOptions: GrafanaFetchGroupsOptions) => {
      const response = await getGrafanaGroups({
        ...fetchOptions,
        limitAlerts: hookOptions.limitAlerts,
        ...fetchOptions.filter,
      }).unwrap();

      // This is not mandatory to preload ruler 
---
[Medium] interface MatchingResult in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx:
interface MatchingResult {
  matches: Map<RulerGrafanaRuleDTO, GrafanaPromRuleDTO>;
  /**
   * Rules that were already removed from the Ruler but the changes has not been yet propagated to Prometheus
   */
  promOnlyRules: GrafanaPromRuleDTO[];
}
---
[Medium] interface GrafanaRuleLoaderProps in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
interface GrafanaRuleLoaderProps {
  ruleIdentifier: GrafanaRuleIdentifier;
  groupIdentifier: GrafanaRuleGroupIdentifier;
  namespaceName: string;
}
---
[Medium] function GrafanaRuleLoader in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
function GrafanaRuleLoader({ ruleIdentifier, groupIdentifier, namespaceName }: GrafanaRuleLoaderProps) {
  const {
    data: rulerRuleGroup,
    error: rulerRuleGroupError,
    isLoading: isRulerRuleGroupLoading,
  } = useGetGrafanaRulerGroupQuery({
    folderUid: groupIdentifier.namespace.uid,
    groupName: groupIdentifier.groupName,
  });
  const {
    data: promRuleGroup,
    error: promRuleGroupError,
    isLoading: isPromRuleGroupLoading,
  } = useGetGrafanaGroupsQuery({
    folderUid: gro
---
[Medium] interface GrafanaRuleListItemProps in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
interface GrafanaRuleListItemProps {
  rule?: GrafanaPromRuleDTO;
  rulerRule: RulerGrafanaRuleDTO;
  groupIdentifier: GrafanaRuleGroupIdentifier;
  namespaceName: string;
  operation?: RuleOperation;
  showLocation?: boolean;
}
---
[Medium] function GrafanaRuleListItem in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
function GrafanaRuleListItem({
  rule,
  rulerRule,
  groupIdentifier,
  namespaceName,
  operation,
  showLocation = true,
}: GrafanaRuleListItemProps) {
  const returnTo = createReturnTo();

  const {
    grafana_alert: { uid, title, provenance, is_paused },
    annotations = {},
    labels = {},
  } = rulerRule;

  const commonProps: RuleListItemCommonProps = {
    name: title,
    rulesSource: GrafanaRulesSource,
    group: groupIdentifier.groupName,
    namespace: namespaceName,
    href: c
---
[Medium] interface Props in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
interface Props {
  rule: RulerRuleDTO;
  promRule?: Rule;
  groupIdentifier: RuleGroupIdentifierV2;
  /**
   * Should we show the buttons in a ""compact"" state?
   * i.e. without text and using smaller button sizes
   */
  compact?: boolean;
}
---
[Medium] function useIsGrafanaPromRuleEditable in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useIsGrafanaPromRuleEditable(rule?: GrafanaPromRuleDTO): IsGrafanaPromRuleEditableResult {
  const folderUID = rule?.folderUid;
  const { folder, loading } = useFolder(folderUID);

  return useMemo(() => {
    if (!rule || !folderUID) {
      return { isEditable: false, isRemovable: false, loading: false };
    }

    if (!folder) {
      // Loading or invalid folder UID
      return {
        isEditable: false,
        isRemovable: false,
        loading,
      };
    }

    // For Gra
---
[Medium] function RuleActionsButtons in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
function RuleActionsButtons({ compact, rule, promRule, groupIdentifier }: Props) {
  const redirectToListView = compact ? false : true;
  const [deleteModal, showDeleteModal] = useDeleteModal(redirectToListView);

  const [showSilenceDrawer, setShowSilenceDrawer] = useState<boolean>(false);

  const [redirectToClone, setRedirectToClone] = useState<
    { identifier: RuleIdentifier; isProvisioned: boolean } | undefined
  >(undefined);

  const isProvisioned = getIsProvisioned(rule, promRule);

  
---
[Medium] variable multiRuleGroup in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const multiRuleGroup = {
      ...grafanaRulerGroup,
      rules: [
        grafanaRulerGroup.rules[0],
        {
          ...grafanaRulerGroup.rules[0],
          grafana_alert: {
            ...grafanaRulerGroup.rules[0].grafana_alert,
            uid: 'second-rule-uid',
            title: 'Second Rule',
          },
        },
      ],
    };
---
[Medium] function useGrafanaPromRuleAbility in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useGrafanaPromRuleAbility(rule: GrafanaPromRuleDTO | SkipToken, action: AlertRuleAction): Ability {
  const abilities = useAllGrafanaPromRuleAbilities(rule === skipToken ? undefined : rule);

  return useMemo(() => {
    return abilities[action];
  }, [abilities, action]);
}
---
[Medium] variable groupIdentifier in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const groupIdentifier = getGroupIdentifier(grafanaRulerGroup);
---
[Medium] variable ui in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const ui = {
  ruleItem: (ruleName: string) => byRole('treeitem', { name: ruleName }),
  ruleStatus: (status: string) => byTitle(status),
  ruleLink: (ruleName: string) => byRole('link', { name: ruleName }),
  editButton: () => byRole('link', { name: 'Edit' }),
  moreButton: () => byRole('button', { name: 'More' }),
  // Menu items that appear when More button is clicked
  menuItems: {
    silence: () => byRole('menuitem', { name: /silence/i }),
    duplicate: () => byRole('menuitem', { name: /d
---
[Medium] type RuleProps in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
type RuleProps = RequireAtLeastOne<{
  rule?: RulerRuleDTO;
  promRule?: Rule;
}>;
---
[Medium] variable ruleListItem1 in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const ruleListItem1 = await ui.ruleItem(rule1.grafana_alert.title).find();
---
[Medium] variable ruleListItem2 in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const ruleListItem2 = await ui.ruleItem(rule2.grafana_alert.title).find();
---
[Medium] variable menuItems in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const menuItems = byRole('menuitem').getAll();
---
[Medium] type Props in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
type Props = RuleProps & {
  groupIdentifier: RuleGroupIdentifierV2;
  /**
   * Should we show the buttons in a ""compact"" state?
   * i.e. without text and using smaller button sizes
   */
  compact?: boolean;
};
---
[Medium] function getIsProvisioned in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
function getIsProvisioned(rule?: RulerRuleDTO, promRule?: Rule): boolean {
  if (rule) {
    return isProvisionedRule(rule);
  }

  if (promRule) {
    return isProvisionedPromRule(promRule);
  }

  return false;
}
---
[Medium] function getEditableIdentifier in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
function getEditableIdentifier(
  groupIdentifier: RuleGroupIdentifierV2,
  rule?: RulerRuleDTO,
  promRule?: Rule
): EditableRuleIdentifier | undefined {
  if (rule) {
    return ruleId.fromRulerRuleAndGroupIdentifierV2(groupIdentifier, rule);
  }

  if (prometheusRuleType.grafana.rule(promRule)) {
    return {
      ruleSourceName: 'grafana',
      uid: promRule.uid,
    } satisfies GrafanaRuleIdentifier;
  }

  logWarning('Unable to construct an editable rule identifier');

  // Returning und
---
[Medium] variable creatingIcon in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const creatingIcon = ui.ruleStatus('Creating').get(ruleListItem);
---
[Medium] variable promOnlyGroup in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const promOnlyGroup: GrafanaPromRuleGroupDTO = {
      ...rulerGroupToPromGroup(grafanaRulerGroup),
      name: 'prom-only-group',
    };
---
[Medium] variable promRule in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const promRule = await ui.ruleItem(rule1.name).find();
---
[Medium] variable deletingIcon in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const deletingIcon = ui.ruleStatus('Deleting').get(promRule);
---
[Medium] variable rulerRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const rulerRules = [
      mockGrafanaRulerRule({ uid: '1' }),
      mockGrafanaRulerRule({ uid: '2' }),
      mockGrafanaRulerRule({ uid: '3' }),
    ];
---
[Medium] variable promRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const promRules = rulerRules.map(rulerRuleToPromRule);
---
[Medium] variable { matches, promOnlyRules } in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const { matches, promOnlyRules } = matchRules(promRules, rulerRules);
---
[Medium] variable rulerRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const rulerRules = [mockGrafanaRulerRule({ uid: '1' }), mockGrafanaRulerRule({ uid: '2' })];
---
[Medium] variable matchingPromRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const matchingPromRules = rulerRules.map(rulerRuleToPromRule);
---
[Medium] variable unmatchedPromRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const unmatchedPromRules = [mockGrafanaPromAlertingRule({ uid: '3' }), mockGrafanaPromAlertingRule({ uid: '4' })];
---
[Medium] variable allPromRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const allPromRules = [...matchingPromRules, ...unmatchedPromRules];
---
[Medium] variable { matches, promOnlyRules } in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const { matches, promOnlyRules } = matchRules(allPromRules, rulerRules);
---
[Medium] variable rulerRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const rulerRules = [
      mockGrafanaRulerRule({ uid: '1' }),
      mockGrafanaRulerRule({ uid: '2' }),
      mockGrafanaRulerRule({ uid: '3' }),
    ];
---
[Medium] variable promRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const promRules = [rulerRuleToPromRule(rulerRules[1])];
---
[Medium] variable { matches, promOnlyRules } in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const { matches, promOnlyRules } = matchRules(promRules, rulerRules);
---
[Medium] variable { useGetGrafanaRulerGroupQuery } in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx:
const { useGetGrafanaRulerGroupQuery } = alertRuleApi;
---
[Medium] function matchRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx:
function matchRules(
  promRules: GrafanaPromRuleDTO[],
  rulerRules: RulerGrafanaRuleDTO[]
): Readonly<MatchingResult> {
  const promRulesMap = new Map(promRules.map((rule) => [rule.uid, rule]));

  const matchingResult = rulerRules.reduce<MatchingResult>(
    (acc, rulerRule) => {
      const { matches } = acc;
      const promRule = promRulesMap.get(rulerRule.grafana_alert.uid);
      if (promRule) {
        matches.set(rulerRule, promRule);
        promRulesMap.delete(rulerRule.grafana_alert
---
[Medium] variable { useGetGrafanaRulerGroupQuery } in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
const { useGetGrafanaRulerGroupQuery } = alertRuleApi;
---
[Medium] variable { useGetGrafanaGroupsQuery } in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
const { useGetGrafanaGroupsQuery } = prometheusApi;
---
[Medium] variable cloudRule in public/app/features/alerting/unified/components/rules/RuleDetails.test.tsx:
const cloudRule = getCloudRule({ name: 'Cloud' }, { rulesSource: mimirDs });
---
[Medium] variable mocks in public/app/features/alerting/unified/components/rules/RulesTable.test.tsx:
const mocks = {
  // Mock the hooks that are actually used by the components:
  // RuleActionsButtons uses: useAlertRuleAbility (singular)
  // AlertRuleMenu uses: useRulerRuleAbilities and useGrafanaPromRuleAbilities (plural)
  // We can also use useGrafanaPromRuleAbility (singular) for simpler mocking
  useRulerRuleAbility: jest.mocked(useRulerRuleAbility),
  useAlertRuleAbility: jest.mocked(useAlertRuleAbility),
  useGrafanaPromRuleAbility: jest.mocked(useGrafanaPromRuleAbility),
  useRulerRu
---
[Medium] variable [rule1] in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const [rule1] = grafanaRulerGroup.rules;
---
[Medium] object alerting in public/locales/en-US/grafana.json:
  ""alerting"": {
    ""active-timing-fields"": {
      ""am-active-timing-select-label-active-timings"": ""Active timings""
    },
    ""ad"": {
      ""close"": ""Close"",
      ""learn-more"": ""Learn more""
    },
    ""add-button"": {
      ""add-more"": ""Add more""
    },
    ""alert"": {
      ""alert-state"": ""Alert state"",
      ""annotations"": ""Annotations"",
      ""description-missing-series-evaluations"": ""The number of consecutive evaluation intervals a dimension must be missing before the alert instance becomes","skipToken (Critical), GrafanaGroupLoader (Critical), useAllAlertRuleAbilities (Critical), GrafanaPromRuleDTOBase (High), moreButton (High), moreButton (High), GrafanaRuleListItem (High), AlertRuleMenu (High), useAllRulerRuleAbilities (High), useRulerRuleAbilities (High), IsGrafanaPromRuleEditableResult (High), GrafanaRuleListItemProps (High), FilterViewResults (High), useAllGrafanaPromRuleAbilities (High), SkipToken (High), useGrafanaPromRuleAbilities (High), isProvisionedPromRule (High), useGrafanaGroupsGenerator (Medium), MatchingResult (Medium), GrafanaRuleLoaderProps (Medium), GrafanaRuleLoader (Medium), GrafanaRuleListItemProps (Medium), GrafanaRuleListItem (Medium), Props (Medium), useIsGrafanaPromRuleEditable (Medium), RuleActionsButtons (Medium), multiRuleGroup (Medium), useGrafanaPromRuleAbility (Medium), groupIdentifier (Medium), ui (Medium), RuleProps (Medium), ruleListItem1 (Medium), ruleListItem2 (Medium), menuItems (Medium), Props (Medium), getIsProvisioned (Medium), getEditableIdentifier (Medium), creatingIcon (Medium), promOnlyGroup (Medium), promRule (Medium), deletingIcon (Medium), rulerRules (Medium), promRules (Medium), { matches, promOnlyRules } (Medium), rulerRules (Medium), matchingPromRules (Medium), unmatchedPromRules (Medium), allPromRules (Medium), { matches, promOnlyRules } (Medium), rulerRules (Medium), promRules (Medium), { matches, promOnlyRules } (Medium), { useGetGrafanaRulerGroupQuery } (Medium), matchRules (Medium), { useGetGrafanaRulerGroupQuery } (Medium), { useGetGrafanaGroupsQuery } (Medium), cloudRule (Medium), mocks (Medium), [rule1] (Medium), alerting (Medium), { dataSource: mimirDs } (Low), [rule1, rule2] (Low), editButton1 (Low), editButton2 (Low), { user } (Low), menu (Low)",match,'GrafanaRuleListItem' matches HC entity 'grafanarulelistitemprops'
grafana,5,Notification Rule Processing Engine,"RuleActionsButtons is invoked with only promRule, but SilenceGrafanaRuleDrawer inside RuleActionsButtons still depends on a Grafana Ruler rule being present, so for Grafana rules coming from list views the 'Silence notifications' menu entry (now driven by Grafana Prom abilities) will toggle showSilenceDrawer without ever rendering the drawer. This means clicking 'Silence notifications' for these rules has no visible effect, even when abilities indicate silencing is allowed.",High,66,17,43,"variable::skipToken (public/app/features/alerting/unified/hooks/useAbilities.ts) [Critical, score=0.88] | function::GrafanaGroupLoader (public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx) [Critical, score=0.77] | function::useAllAlertRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [Critical, score=0.74] | interface::GrafanaPromRuleDTOBase (public/app/types/unified-alerting-dto.ts) [High, score=0.70] | variable::moreButton (public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx) [High, score=0.66] | variable::moreButton (public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx) [High, score=0.66] | function::GrafanaRuleListItem (public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx) [High, score=0.64] | variable::AlertRuleMenu (public/app/features/alerting/unified/components/rule-viewer/AlertRuleMenu.tsx) [High, score=0.62] | function::useAllRulerRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.62] | function::useRulerRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.58] | interface::IsGrafanaPromRuleEditableResult (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.58] | interface::GrafanaRuleListItemProps (public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx) [High, score=0.58] | function::FilterViewResults (public/app/features/alerting/unified/rule-list/FilterView.tsx) [High, score=0.53] | function::useAllGrafanaPromRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.52] | type::SkipToken (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.52] | function::useGrafanaPromRuleAbilities (public/app/features/alerting/unified/hooks/useAbilities.ts) [High, score=0.52] | function::isProvisionedPromRule (public/app/features/alerting/unified/utils/rules.ts) [High, score=0.52]","[Critical] variable skipToken in public/app/features/alerting/unified/hooks/useAbilities.ts:
const skipToken = Symbol('ability-skip-token');
---
[Critical] function GrafanaGroupLoader in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx:
function GrafanaGroupLoader({
  groupIdentifier,
  namespaceName,
  expectedRulesCount = 3, // 3 is a random number. Usually we get the number of rules from Prometheus response
}: GrafanaGroupLoaderProps) {
  const { data: promResponse, isLoading: isPromResponseLoading } = useGetGrafanaGroupsQuery(
    {
      folderUid: groupIdentifier.namespace.uid,
      groupName: groupIdentifier.groupName,
      limitAlerts: 0,
    },
    { pollingInterval: RULE_LIST_POLL_INTERVAL_MS }
  );

  if (isPromResponseLoading) {
    return (
      <>
        {Array.from({ length: expectedRulesCount }).map((_, index) => (
          <AlertRuleListItemSkeleton key={index} />
        ))}
      </>
    );
  }

  if (!promResponse) {
    return (
      <Alert
        title={t(
          'alerting.group-loader.grou
---
[Critical] function useAllAlertRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useAllAlertRuleAbilities(rule: CombinedRule): Abilities<AlertRuleAction> {
  // This hook is being called a lot in different places
  // In some cases multiple times for ~80 rules (e.g. on the list page)
  // We need to investigate further if some of these calls are redundant
  // In the meantime, memoizing the result helps
  const groupIdentifierV2 = useMemo(() => groupIdentifier.fromCombinedRule(rule), [rule]);
  return useAllRulerRuleAbilities(rule.rulerRule, groupIdentifierV2);
}
---
[High] interface GrafanaPromRuleDTOBase in public/app/types/unified-alerting-dto.ts:
interface GrafanaPromRuleDTOBase extends PromRuleDTOBase {
  uid: string;
  folderUid: string;
  isPaused: boolean;
  queriedDatasourceUIDs?: string[];
  provenance?: string;
}
---
[High] variable moreButton in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const moreButton = ui.moreButton().get(ruleListItem);
---
[High] variable moreButton in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const moreButton = ui.moreButton().get(ruleListItem);
---
[High] function GrafanaRuleListItem in public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx:
function GrafanaRuleListItem({
  rule,
  groupIdentifier,
  namespaceName,
  operation,
  showLocation = true,
}: GrafanaRuleListItemProps) {
  const { name, uid, labels, provenance } = rule;

  const commonProps: RuleListItemCommonProps = {
    name,
    rulesSource: GrafanaRulesSource,
    group: groupIdentifier.groupName,
    namespace: namespaceName,
    href: createRelativeUrl(`/alerting/grafana/${uid}/view`),
    health: rule?.health,
    error: rule?.lastError,
    labels: labels,
    isProvisioned: Boolean(provenance),
    isPaused: rule?.isPaused,
    application: 'grafana' as const,
    actions: <RuleActionsButtons promRule={rule} groupIdentifier={groupIdentifier} compact />,
  };

  if (prometheusRuleType.grafana.alertingRule(rule)) {
    const promAlertingRule = rule && rule.ty
---
[High] variable AlertRuleMenu in public/app/features/alerting/unified/components/rule-viewer/AlertRuleMenu.tsx:
const AlertRuleMenu = ({
  promRule,
  rulerRule,
  identifier,
  groupIdentifier,
  handleSilence,
  handleDelete,
  handleDuplicateRule,
  onPauseChange,
  buttonSize,
  fill,
}: Props) => {
  // check all abilities and permissions using rulerRule
  const [rulerPauseAbility, rulerDeleteAbility, rulerDuplicateAbility, rulerSilenceAbility, rulerExportAbility] =
    useRulerRuleAbilities(rulerRule, groupIdentifier, [
      AlertRuleAction.Pause,
      AlertRuleAction.Delete,
      AlertRuleAction.Duplicate,
      AlertRuleAction.Silence,
      AlertRuleAction.ModifyExport,
    ]);

  // check all abilities and permissions using promRule
  const [
    grafanaPauseAbility,
    grafanaDeleteAbility,
    grafanaDuplicateAbility,
    grafanaSilenceAbility,
    grafanaExportAbility,
  ] = useGraf
---
[High] function useAllRulerRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useAllRulerRuleAbilities(
  rule: RulerRuleDTO | undefined,
  groupIdentifier: RuleGroupIdentifierV2
): Abilities<AlertRuleAction> {
  const rulesSourceName = getGroupOriginName(groupIdentifier);

  const { isEditable, isRemovable, isRulerAvailable = false, loading } = useIsRuleEditable(rulesSourceName, rule);
  const [_, exportAllowed] = useAlertingAbility(AlertingAction.ExportGrafanaManagedRules);
  const canSilence = useCanSilence(rule);

  const abilities = useMemo<Abilities<AlertRuleAction>>(() => {
    const isProvisioned = rule ? isProvisionedRule(rule) : false;
    // TODO: Add support for federated rules
    // const isFederated = isFederatedRuleGroup();
    const isFederated = false;
    const isGrafanaManagedAlertRule = rulerRuleType.grafana.rule(rule);
    const isPlug
---
[High] function useRulerRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useRulerRuleAbilities(
  rule: RulerRuleDTO | undefined,
  groupIdentifier: RuleGroupIdentifierV2,
  actions: AlertRuleAction[]
): Ability[] {
  const abilities = useAllRulerRuleAbilities(rule, groupIdentifier);

  return useMemo(() => {
    return actions.map((action) => abilities[action]);
  }, [abilities, actions]);
}
---
[High] interface IsGrafanaPromRuleEditableResult in public/app/features/alerting/unified/hooks/useAbilities.ts:
interface IsGrafanaPromRuleEditableResult {
  isEditable: boolean;
  isRemovable: boolean;
  loading: boolean;
}
---
[High] interface GrafanaRuleListItemProps in public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx:
interface GrafanaRuleListItemProps {
  rule: GrafanaPromRuleDTO;
  groupIdentifier: GrafanaRuleGroupIdentifier;
  namespaceName: string;
  operation?: RuleOperation;
  showLocation?: boolean;
}
---
[High] function FilterViewResults in public/app/features/alerting/unified/rule-list/FilterView.tsx:
function FilterViewResults({ filterState }: FilterViewProps) {
  const [transitionPending, startTransition] = useTransition();

  /* this hook returns a function that creates an AsyncIterable<RuleWithOrigin> which we will use to populate the front-end */
  const getFilteredRulesIterator = useFilteredRulesIteratorProvider();

  const iteration = useRef<{
    rulesBatchIterator: AsyncIterator<RuleWithOrigin[]>;
    abortController: AbortController;
  } | null>(null);

  const [rules, setRules] = useState<KeyedRuleWithOrigin[]>([]);
  const [doneSearching, setDoneSearching] = useState(false);

  // Lazy initialization of useRef
  // https://18.react.dev/reference/react/useRef#how-to-avoid-null-checks-when-initializing-use-ref-later
  const getRulesBatchIterator = useCallback(() => {
    if (!
---
[High] function useAllGrafanaPromRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useAllGrafanaPromRuleAbilities(rule: GrafanaPromRuleDTO | undefined): Abilities<AlertRuleAction> {
  // For GrafanaPromRuleDTO, we use useIsGrafanaPromRuleEditable instead
  const { isEditable, isRemovable, loading } = useIsGrafanaPromRuleEditable(rule); // duplicate
  const [_, exportAllowed] = useAlertingAbility(AlertingAction.ExportGrafanaManagedRules);

  const silenceSupported = useGrafanaRulesSilenceSupport();
  const canSilenceInFolder = useCanSilenceInFolder(rule?.folderUid);

  const abilities = useMemo<Abilities<AlertRuleAction>>(() => {
    const isProvisioned = rule ? isProvisionedPromRule(rule) : false;

    // Note: Grafana managed rules can't be federated - this is strictly a Mimir feature
    // See: https://grafana.com/docs/mimir/latest/references/architecture/com
---
[High] type SkipToken in public/app/features/alerting/unified/hooks/useAbilities.ts:
type SkipToken = typeof skipToken;
---
[High] function useGrafanaPromRuleAbilities in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useGrafanaPromRuleAbilities(
  rule: GrafanaPromRuleDTO | SkipToken,
  actions: AlertRuleAction[]
): Ability[] {
  const abilities = useAllGrafanaPromRuleAbilities(rule === skipToken ? undefined : rule);

  return useMemo(() => {
    return actions.map((action) => abilities[action]);
  }, [abilities, actions]);
}
---
[High] function isProvisionedPromRule in public/app/features/alerting/unified/utils/rules.ts:
function isProvisionedPromRule(promRule: PromRuleDTO): boolean {
  return prometheusRuleType.grafana.rule(promRule) && Boolean(promRule.provenance);
}","[Medium] function useGrafanaGroupsGenerator in public/app/features/alerting/unified/rule-list/hooks/prometheusGroupsGenerator.ts:
function useGrafanaGroupsGenerator(hookOptions: UseGeneratorHookOptions = {}) {
  const dispatch = useDispatch();
  const [getGrafanaGroups] = useLazyGetGrafanaGroupsQuery();

  const getGroupsAndProvideCache = useCallback(
    async (fetchOptions: GrafanaFetchGroupsOptions) => {
      const response = await getGrafanaGroups({
        ...fetchOptions,
        limitAlerts: hookOptions.limitAlerts,
        ...fetchOptions.filter,
      }).unwrap();

      // This is not mandatory to preload ruler 
---
[Medium] interface MatchingResult in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx:
interface MatchingResult {
  matches: Map<RulerGrafanaRuleDTO, GrafanaPromRuleDTO>;
  /**
   * Rules that were already removed from the Ruler but the changes has not been yet propagated to Prometheus
   */
  promOnlyRules: GrafanaPromRuleDTO[];
}
---
[Medium] interface GrafanaRuleLoaderProps in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
interface GrafanaRuleLoaderProps {
  ruleIdentifier: GrafanaRuleIdentifier;
  groupIdentifier: GrafanaRuleGroupIdentifier;
  namespaceName: string;
}
---
[Medium] function GrafanaRuleLoader in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
function GrafanaRuleLoader({ ruleIdentifier, groupIdentifier, namespaceName }: GrafanaRuleLoaderProps) {
  const {
    data: rulerRuleGroup,
    error: rulerRuleGroupError,
    isLoading: isRulerRuleGroupLoading,
  } = useGetGrafanaRulerGroupQuery({
    folderUid: groupIdentifier.namespace.uid,
    groupName: groupIdentifier.groupName,
  });
  const {
    data: promRuleGroup,
    error: promRuleGroupError,
    isLoading: isPromRuleGroupLoading,
  } = useGetGrafanaGroupsQuery({
    folderUid: gro
---
[Medium] interface GrafanaRuleListItemProps in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
interface GrafanaRuleListItemProps {
  rule?: GrafanaPromRuleDTO;
  rulerRule: RulerGrafanaRuleDTO;
  groupIdentifier: GrafanaRuleGroupIdentifier;
  namespaceName: string;
  operation?: RuleOperation;
  showLocation?: boolean;
}
---
[Medium] function GrafanaRuleListItem in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
function GrafanaRuleListItem({
  rule,
  rulerRule,
  groupIdentifier,
  namespaceName,
  operation,
  showLocation = true,
}: GrafanaRuleListItemProps) {
  const returnTo = createReturnTo();

  const {
    grafana_alert: { uid, title, provenance, is_paused },
    annotations = {},
    labels = {},
  } = rulerRule;

  const commonProps: RuleListItemCommonProps = {
    name: title,
    rulesSource: GrafanaRulesSource,
    group: groupIdentifier.groupName,
    namespace: namespaceName,
    href: c
---
[Medium] interface Props in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
interface Props {
  rule: RulerRuleDTO;
  promRule?: Rule;
  groupIdentifier: RuleGroupIdentifierV2;
  /**
   * Should we show the buttons in a ""compact"" state?
   * i.e. without text and using smaller button sizes
   */
  compact?: boolean;
}
---
[Medium] function useIsGrafanaPromRuleEditable in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useIsGrafanaPromRuleEditable(rule?: GrafanaPromRuleDTO): IsGrafanaPromRuleEditableResult {
  const folderUID = rule?.folderUid;
  const { folder, loading } = useFolder(folderUID);

  return useMemo(() => {
    if (!rule || !folderUID) {
      return { isEditable: false, isRemovable: false, loading: false };
    }

    if (!folder) {
      // Loading or invalid folder UID
      return {
        isEditable: false,
        isRemovable: false,
        loading,
      };
    }

    // For Gra
---
[Medium] function RuleActionsButtons in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
function RuleActionsButtons({ compact, rule, promRule, groupIdentifier }: Props) {
  const redirectToListView = compact ? false : true;
  const [deleteModal, showDeleteModal] = useDeleteModal(redirectToListView);

  const [showSilenceDrawer, setShowSilenceDrawer] = useState<boolean>(false);

  const [redirectToClone, setRedirectToClone] = useState<
    { identifier: RuleIdentifier; isProvisioned: boolean } | undefined
  >(undefined);

  const isProvisioned = getIsProvisioned(rule, promRule);

  
---
[Medium] variable multiRuleGroup in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const multiRuleGroup = {
      ...grafanaRulerGroup,
      rules: [
        grafanaRulerGroup.rules[0],
        {
          ...grafanaRulerGroup.rules[0],
          grafana_alert: {
            ...grafanaRulerGroup.rules[0].grafana_alert,
            uid: 'second-rule-uid',
            title: 'Second Rule',
          },
        },
      ],
    };
---
[Medium] function useGrafanaPromRuleAbility in public/app/features/alerting/unified/hooks/useAbilities.ts:
function useGrafanaPromRuleAbility(rule: GrafanaPromRuleDTO | SkipToken, action: AlertRuleAction): Ability {
  const abilities = useAllGrafanaPromRuleAbilities(rule === skipToken ? undefined : rule);

  return useMemo(() => {
    return abilities[action];
  }, [abilities, action]);
}
---
[Medium] variable groupIdentifier in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const groupIdentifier = getGroupIdentifier(grafanaRulerGroup);
---
[Medium] variable ui in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const ui = {
  ruleItem: (ruleName: string) => byRole('treeitem', { name: ruleName }),
  ruleStatus: (status: string) => byTitle(status),
  ruleLink: (ruleName: string) => byRole('link', { name: ruleName }),
  editButton: () => byRole('link', { name: 'Edit' }),
  moreButton: () => byRole('button', { name: 'More' }),
  // Menu items that appear when More button is clicked
  menuItems: {
    silence: () => byRole('menuitem', { name: /silence/i }),
    duplicate: () => byRole('menuitem', { name: /d
---
[Medium] type RuleProps in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
type RuleProps = RequireAtLeastOne<{
  rule?: RulerRuleDTO;
  promRule?: Rule;
}>;
---
[Medium] variable ruleListItem1 in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const ruleListItem1 = await ui.ruleItem(rule1.grafana_alert.title).find();
---
[Medium] variable ruleListItem2 in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const ruleListItem2 = await ui.ruleItem(rule2.grafana_alert.title).find();
---
[Medium] variable menuItems in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const menuItems = byRole('menuitem').getAll();
---
[Medium] type Props in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
type Props = RuleProps & {
  groupIdentifier: RuleGroupIdentifierV2;
  /**
   * Should we show the buttons in a ""compact"" state?
   * i.e. without text and using smaller button sizes
   */
  compact?: boolean;
};
---
[Medium] function getIsProvisioned in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
function getIsProvisioned(rule?: RulerRuleDTO, promRule?: Rule): boolean {
  if (rule) {
    return isProvisionedRule(rule);
  }

  if (promRule) {
    return isProvisionedPromRule(promRule);
  }

  return false;
}
---
[Medium] function getEditableIdentifier in public/app/features/alerting/unified/rule-list/components/RuleActionsButtons.V2.tsx:
function getEditableIdentifier(
  groupIdentifier: RuleGroupIdentifierV2,
  rule?: RulerRuleDTO,
  promRule?: Rule
): EditableRuleIdentifier | undefined {
  if (rule) {
    return ruleId.fromRulerRuleAndGroupIdentifierV2(groupIdentifier, rule);
  }

  if (prometheusRuleType.grafana.rule(promRule)) {
    return {
      ruleSourceName: 'grafana',
      uid: promRule.uid,
    } satisfies GrafanaRuleIdentifier;
  }

  logWarning('Unable to construct an editable rule identifier');

  // Returning und
---
[Medium] variable creatingIcon in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const creatingIcon = ui.ruleStatus('Creating').get(ruleListItem);
---
[Medium] variable promOnlyGroup in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const promOnlyGroup: GrafanaPromRuleGroupDTO = {
      ...rulerGroupToPromGroup(grafanaRulerGroup),
      name: 'prom-only-group',
    };
---
[Medium] variable promRule in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const promRule = await ui.ruleItem(rule1.name).find();
---
[Medium] variable deletingIcon in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const deletingIcon = ui.ruleStatus('Deleting').get(promRule);
---
[Medium] variable rulerRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const rulerRules = [
      mockGrafanaRulerRule({ uid: '1' }),
      mockGrafanaRulerRule({ uid: '2' }),
      mockGrafanaRulerRule({ uid: '3' }),
    ];
---
[Medium] variable promRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const promRules = rulerRules.map(rulerRuleToPromRule);
---
[Medium] variable { matches, promOnlyRules } in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const { matches, promOnlyRules } = matchRules(promRules, rulerRules);
---
[Medium] variable rulerRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const rulerRules = [mockGrafanaRulerRule({ uid: '1' }), mockGrafanaRulerRule({ uid: '2' })];
---
[Medium] variable matchingPromRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const matchingPromRules = rulerRules.map(rulerRuleToPromRule);
---
[Medium] variable unmatchedPromRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const unmatchedPromRules = [mockGrafanaPromAlertingRule({ uid: '3' }), mockGrafanaPromAlertingRule({ uid: '4' })];
---
[Medium] variable allPromRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const allPromRules = [...matchingPromRules, ...unmatchedPromRules];
---
[Medium] variable { matches, promOnlyRules } in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const { matches, promOnlyRules } = matchRules(allPromRules, rulerRules);
---
[Medium] variable rulerRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const rulerRules = [
      mockGrafanaRulerRule({ uid: '1' }),
      mockGrafanaRulerRule({ uid: '2' }),
      mockGrafanaRulerRule({ uid: '3' }),
    ];
---
[Medium] variable promRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const promRules = [rulerRuleToPromRule(rulerRules[1])];
---
[Medium] variable { matches, promOnlyRules } in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const { matches, promOnlyRules } = matchRules(promRules, rulerRules);
---
[Medium] variable { useGetGrafanaRulerGroupQuery } in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx:
const { useGetGrafanaRulerGroupQuery } = alertRuleApi;
---
[Medium] function matchRules in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx:
function matchRules(
  promRules: GrafanaPromRuleDTO[],
  rulerRules: RulerGrafanaRuleDTO[]
): Readonly<MatchingResult> {
  const promRulesMap = new Map(promRules.map((rule) => [rule.uid, rule]));

  const matchingResult = rulerRules.reduce<MatchingResult>(
    (acc, rulerRule) => {
      const { matches } = acc;
      const promRule = promRulesMap.get(rulerRule.grafana_alert.uid);
      if (promRule) {
        matches.set(rulerRule, promRule);
        promRulesMap.delete(rulerRule.grafana_alert
---
[Medium] variable { useGetGrafanaRulerGroupQuery } in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
const { useGetGrafanaRulerGroupQuery } = alertRuleApi;
---
[Medium] variable { useGetGrafanaGroupsQuery } in public/app/features/alerting/unified/rule-list/GrafanaRuleLoader.tsx:
const { useGetGrafanaGroupsQuery } = prometheusApi;
---
[Medium] variable cloudRule in public/app/features/alerting/unified/components/rules/RuleDetails.test.tsx:
const cloudRule = getCloudRule({ name: 'Cloud' }, { rulesSource: mimirDs });
---
[Medium] variable mocks in public/app/features/alerting/unified/components/rules/RulesTable.test.tsx:
const mocks = {
  // Mock the hooks that are actually used by the components:
  // RuleActionsButtons uses: useAlertRuleAbility (singular)
  // AlertRuleMenu uses: useRulerRuleAbilities and useGrafanaPromRuleAbilities (plural)
  // We can also use useGrafanaPromRuleAbility (singular) for simpler mocking
  useRulerRuleAbility: jest.mocked(useRulerRuleAbility),
  useAlertRuleAbility: jest.mocked(useAlertRuleAbility),
  useGrafanaPromRuleAbility: jest.mocked(useGrafanaPromRuleAbility),
  useRulerRu
---
[Medium] variable [rule1] in public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.test.tsx:
const [rule1] = grafanaRulerGroup.rules;
---
[Medium] object alerting in public/locales/en-US/grafana.json:
  ""alerting"": {
    ""active-timing-fields"": {
      ""am-active-timing-select-label-active-timings"": ""Active timings""
    },
    ""ad"": {
      ""close"": ""Close"",
      ""learn-more"": ""Learn more""
    },
    ""add-button"": {
      ""add-more"": ""Add more""
    },
    ""alert"": {
      ""alert-state"": ""Alert state"",
      ""annotations"": ""Annotations"",
      ""description-missing-series-evaluations"": ""The number of consecutive evaluation intervals a dimension must be missing before the alert instance becomes","skipToken (Critical), GrafanaGroupLoader (Critical), useAllAlertRuleAbilities (Critical), GrafanaPromRuleDTOBase (High), moreButton (High), moreButton (High), GrafanaRuleListItem (High), AlertRuleMenu (High), useAllRulerRuleAbilities (High), useRulerRuleAbilities (High), IsGrafanaPromRuleEditableResult (High), GrafanaRuleListItemProps (High), FilterViewResults (High), useAllGrafanaPromRuleAbilities (High), SkipToken (High), useGrafanaPromRuleAbilities (High), isProvisionedPromRule (High), useGrafanaGroupsGenerator (Medium), MatchingResult (Medium), GrafanaRuleLoaderProps (Medium), GrafanaRuleLoader (Medium), GrafanaRuleListItemProps (Medium), GrafanaRuleListItem (Medium), Props (Medium), useIsGrafanaPromRuleEditable (Medium), RuleActionsButtons (Medium), multiRuleGroup (Medium), useGrafanaPromRuleAbility (Medium), groupIdentifier (Medium), ui (Medium), RuleProps (Medium), ruleListItem1 (Medium), ruleListItem2 (Medium), menuItems (Medium), Props (Medium), getIsProvisioned (Medium), getEditableIdentifier (Medium), creatingIcon (Medium), promOnlyGroup (Medium), promRule (Medium), deletingIcon (Medium), rulerRules (Medium), promRules (Medium), { matches, promOnlyRules } (Medium), rulerRules (Medium), matchingPromRules (Medium), unmatchedPromRules (Medium), allPromRules (Medium), { matches, promOnlyRules } (Medium), rulerRules (Medium), promRules (Medium), { matches, promOnlyRules } (Medium), { useGetGrafanaRulerGroupQuery } (Medium), matchRules (Medium), { useGetGrafanaRulerGroupQuery } (Medium), { useGetGrafanaGroupsQuery } (Medium), cloudRule (Medium), mocks (Medium), [rule1] (Medium), alerting (Medium), { dataSource: mimirDs } (Low), [rule1, rule2] (Low), editButton1 (Low), editButton2 (Low), { user } (Low), menu (Low)",match,'abilities' matches HC entity 'useallrulerruleabilities'
grafana,4,Advanced Query Processing Architecture,"The applyTemplateVariables method is called with request.filters as the third parameter, but this parameter is not used in the corresponding test setup.",Low,3,2,1,"function::runSplitQuery (public/app/plugins/datasource/loki/querySplitting.ts) [High, score=0.65] | function::runShardSplitQuery (public/app/plugins/datasource/loki/shardQuerySplitting.ts) [High, score=0.61]","[High] function runSplitQuery in public/app/plugins/datasource/loki/querySplitting.ts:
function runSplitQuery(
  datasource: LokiDatasource,
  request: DataQueryRequest<LokiQuery>,
  options: QuerySplittingOptions = {}
) {
  const queries = request.targets
    .filter((query) => !query.hide)
    .filter((query) => query.expr)
    .map((query) => datasource.applyTemplateVariables(query, request.scopedVars, request.filters));
  const [nonSplittingQueries, normalQueries] = partition(queries, (query) => !querySupportsSplitting(query));
  const [logQueries, metricQueries] = partition(normalQueries, (query) => isLogsQuery(query.expr));

  request.queryGroupId = uuidv4();
  const oneDayMs = 24 * 60 * 60 * 1000;
  const directionPartitionedLogQueries = groupBy(logQueries, (query) =>
    query.direction === LokiQueryDirection.Forward ? LokiQueryDirection.Forward : LokiQueryDirection.
---
[High] function runShardSplitQuery in public/app/plugins/datasource/loki/shardQuerySplitting.ts:
function runShardSplitQuery(datasource: LokiDatasource, request: DataQueryRequest<LokiQuery>) {
  const queries = request.targets
    .filter((query) => query.expr)
    .filter((query) => !query.hide)
    .map((query) => datasource.applyTemplateVariables(query, request.scopedVars, request.filters));

  return splitQueriesByStreamShard(datasource, request, queries);
}","[Medium] variable request in public/app/plugins/datasource/loki/shardQuerySplitting.test.ts:
const request = createRequest([{ expr: 'count_over_time({a=""b""}[$__auto])', refId: 'A', step: '$step' }]);","runSplitQuery (High), runShardSplitQuery (High), request (Medium)",miss,applyTemplateVariables not in HC entities (runSplitQuery and runShardSplitQuery are HC)
grafana,3,Plugins: Chore: Renamed instrumentation middleware to metrics middleware,"The ContextualLoggerMiddleware methods (QueryData, CallResource, CheckHealth, CollectMetrics) panic when a nil request is received. This occurs because they directly access req.PluginContext (via the instrumentContext function) without first checking if req is nil. This is a regression, as previous middleware layers gracefully handled nil requests.",High,46,4,42,"method::logRequest (pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go) [High, score=0.66] | function::instrumentContext (pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go) [High, score=0.60] | method::instrumentPluginRequest (pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go) [High, score=0.60] | function::CreateMiddlewares (pkg/services/pluginsintegration/pluginsintegration.go) [High, score=0.59]","[High] method logRequest in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) logRequest(ctx context.Context, fn func(ctx context.Context) error) error {
	status := statusOK
	start := time.Now()
	timeBeforePluginRequest := log.TimeSinceStart(ctx, start)

	err := fn(ctx)
	if err != nil {
		status = statusError
		if errors.Is(err, context.Canceled) {
			status = statusCancelled
		}
	}

	logParams := []any{
		""status"", status,
		""duration"", time.Since(start),
		""eventName"", ""grafana-data-egress"",
		""time_before_plugin_request"", timeBeforePluginRequest,
	}
	if status == statusError {
		logParams = append(logParams, ""error"", err)
	}
	m.logger.FromContext(ctx).Info(""Plugin Request Completed"", logParams...)
	return err
}
---
[High] function instrumentContext in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func instrumentContext(ctx context.Context, endpoint string, pCtx backend.PluginContext) context.Context {
	p := []any{""endpoint"", endpoint, ""pluginId"", pCtx.PluginID}
	if pCtx.DataSourceInstanceSettings != nil {
		p = append(p, ""dsName"", pCtx.DataSourceInstanceSettings.Name)
		p = append(p, ""dsUID"", pCtx.DataSourceInstanceSettings.UID)
	}
	if pCtx.User != nil {
		p = append(p, ""uname"", pCtx.User.Login)
	}
	return log.WithContextualAttributes(ctx, p)
}
---
[High] method instrumentPluginRequest in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) instrumentPluginRequest(ctx context.Context, pluginCtx backend.PluginContext, endpoint string, fn func(context.Context) error) error {
	target, err := m.pluginTarget(ctx, pluginCtx.PluginID)
	if err != nil {
		return err
	}

	status := statusOK
	start := time.Now()

	err = fn(ctx)
	if err != nil {
		status = statusError
		if errors.Is(err, context.Canceled) {
			status = statusCancelled
		}
	}

	elapsed := time.Since(start)

	pluginRequestDurationWithLabels := m.pluginRequestDuration.WithLabelValues(pluginCtx.PluginID, endpoint, target)
	pluginRequestCounterWithLabels := m.pluginRequestCounter.WithLabelValues(pluginCtx.PluginID, endpoint, status, target)
	pluginRequestDurationSecondsWithLabels := m.pluginRequestDurationSeconds.WithLabelValues(""grafana-backend"", 
---
[High] function CreateMiddlewares in pkg/services/pluginsintegration/pluginsintegration.go:
func CreateMiddlewares(cfg *setting.Cfg, oAuthTokenService oauthtoken.OAuthTokenService, tracer tracing.Tracer, cachingService caching.CachingService, features *featuremgmt.FeatureManager, promRegisterer prometheus.Registerer, registry registry.Service) []plugins.ClientMiddleware {
	skipCookiesNames := []string{cfg.LoginCookieName}
	middlewares := []plugins.ClientMiddleware{
		clientmiddleware.NewTracingMiddleware(tracer),
		clientmiddleware.NewMetricsMiddleware(promRegisterer, registry),
		clientmiddleware.NewContextualLoggerMiddleware(),
		clientmiddleware.NewLoggerMiddleware(cfg, log.New(""plugin.instrumentation"")),
		clientmiddleware.NewTracingHeaderMiddleware(),
		clientmiddleware.NewClearAuthHeadersMiddleware(),
		clientmiddleware.NewOAuthTokenMiddleware(oAuthTokenService),
		clientmi","[Medium] function NewContextualLoggerMiddleware in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func NewContextualLoggerMiddleware() plugins.ClientMiddleware {
	return plugins.ClientMiddlewareFunc(func(next plugins.Client) plugins.Client {
		return &ContextualLoggerMiddleware{
			next: next,
		}
	})
}
---
[Medium] function NewMetricsMiddleware in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func NewMetricsMiddleware(promRegisterer prometheus.Registerer, pluginRegistry registry.Service) plugins.ClientMiddleware {
	imw := newMetricsMiddleware(promRegisterer, pluginRegistry)
	return plugins.ClientMiddlewareFunc(func(next plugins.Client) plugins.Client {
		imw.next = next
		return imw
	})
}
---
[Medium] function NewInstrumentationMiddleware in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func NewInstrumentationMiddleware(promRegisterer prometheus.Registerer, pluginRegistry registry.Service) plugins.ClientMiddleware {
	imw := newInstrumentationMiddleware(promRegisterer, pluginRegistry)
	return plugins.ClientMiddlewareFunc(func(next plugins.Client) plugins.Client {
		imw.next = next
		return imw
	})
}
---
[Medium] method QueryData in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
	var requestSize float64
	for _, v := range req.Queries {
		requestSize += float64(len(v.JSON))
	}
	if err := m.instrumentPluginRequestSize(ctx, req.PluginContext, endpointQueryData, requestSize); err != nil {
		return nil, err
	}
	var resp *backend.QueryDataResponse
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointQueryData, func(ctx context.Co
---
[Medium] method CallResource in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) CallResource(ctx context.Context, req *backend.CallResourceRequest, sender backend.CallResourceResponseSender) error {
	if err := m.instrumentPluginRequestSize(ctx, req.PluginContext, endpointCallResource, float64(len(req.Body))); err != nil {
		return err
	}
	return m.instrumentPluginRequest(ctx, req.PluginContext, endpointCallResource, func(ctx context.Context) error {
		return m.next.CallResource(ctx, req, sender)
	})
}
---
[Medium] method CheckHealth in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) CheckHealth(ctx context.Context, req *backend.CheckHealthRequest) (*backend.CheckHealthResult, error) {
	var result *backend.CheckHealthResult
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointCheckHealth, func(ctx context.Context) (innerErr error) {
		result, innerErr = m.next.CheckHealth(ctx, req)
		return
	})
	return result, err
}
---
[Medium] method CollectMetrics in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) CollectMetrics(ctx context.Context, req *backend.CollectMetricsRequest) (*backend.CollectMetricsResult, error) {
	var result *backend.CollectMetricsResult
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointCollectMetrics, func(ctx context.Context) (innerErr error) {
		result, innerErr = m.next.CollectMetrics(ctx, req)
		return
	})
	return result, err
}
---
[Medium] method SubscribeStream in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) SubscribeStream(ctx context.Context, req *backend.SubscribeStreamRequest) (*backend.SubscribeStreamResponse, error) {
	return m.next.SubscribeStream(ctx, req)
}
---
[Medium] method PublishStream in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) PublishStream(ctx context.Context, req *backend.PublishStreamRequest) (*backend.PublishStreamResponse, error) {
	return m.next.PublishStream(ctx, req)
}
---
[Medium] method RunStream in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) RunStream(ctx context.Context, req *backend.RunStreamRequest, sender *backend.StreamSender) error {
	return m.next.RunStream(ctx, req, sender)
}
---
[Medium] function TestInstrumentationMiddleware in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware_test.go:
func TestInstrumentationMiddleware(t *testing.T) {
	const (
		pluginID = ""plugin-id""

		metricRequestTotal      = ""grafana_plugin_request_total""
		metricRequestDurationMs = ""grafana_plugin_request_duration_milliseconds""
		metricRequestDurationS  = ""grafana_plugin_request_duration_seconds""
		metricRequestSize       = ""grafana_plugin_request_size_bytes""
	)

	pCtx := backend.PluginContext{PluginID: pluginID}

	t.Run(""should instrument requests"", func(t *testing.T) {
		for _, tc := range []struct {

---
[Medium] function newMetricsMiddleware in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func newMetricsMiddleware(promRegisterer prometheus.Registerer, pluginRegistry registry.Service) *MetricsMiddleware {
	pluginRequestCounter := prometheus.NewCounterVec(prometheus.CounterOpts{
		Namespace: ""grafana"",
		Name:      ""plugin_request_total"",
		Help:      ""The total amount of plugin requests"",
	}, []string{""plugin_id"", ""endpoint"", ""status"", ""target""})
	pluginRequestDuration := prometheus.NewHistogramVec(prometheus.HistogramOpts{
		Namespace: ""grafana"",
		Name:      ""plugin_request_dura
---
[Medium] method CheckHealth in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) CheckHealth(ctx context.Context, req *backend.CheckHealthRequest) (*backend.CheckHealthResult, error) {
	if req == nil {
		return m.next.CheckHealth(ctx, req)
	}

	var resp *backend.CheckHealthResult
	err := m.logRequest(ctx, func(ctx context.Context) (innerErr error) {
		resp, innerErr = m.next.CheckHealth(ctx, req)
		return innerErr
	})

	return resp, err
}
---
[Medium] method QueryData in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
	if req == nil {
		return m.next.QueryData(ctx, req)
	}

	var resp *backend.QueryDataResponse
	err := m.logRequest(ctx, func(ctx context.Context) (innerErr error) {
		resp, innerErr = m.next.QueryData(ctx, req)
		return innerErr
	})

	return resp, err
}
---
[Medium] method CallResource in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) CallResource(ctx context.Context, req *backend.CallResourceRequest, sender backend.CallResourceResponseSender) error {
	if req == nil {
		return m.next.CallResource(ctx, req, sender)
	}

	err := m.logRequest(ctx, func(ctx context.Context) (innerErr error) {
		innerErr = m.next.CallResource(ctx, req, sender)
		return innerErr
	})

	return err
}
---
[Medium] method CollectMetrics in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) CollectMetrics(ctx context.Context, req *backend.CollectMetricsRequest) (*backend.CollectMetricsResult, error) {
	if req == nil {
		return m.next.CollectMetrics(ctx, req)
	}

	var resp *backend.CollectMetricsResult
	err := m.logRequest(ctx, func(ctx context.Context) (innerErr error) {
		resp, innerErr = m.next.CollectMetrics(ctx, req)
		return innerErr
	})

	return resp, err
}
---
[Medium] method pluginTarget in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) pluginTarget(ctx context.Context, pluginID string) (string, error) {
	p, exists := m.pluginRegistry.Plugin(ctx, pluginID)
	if !exists {
		return """", plugins.ErrPluginNotRegistered
	}
	return string(p.Target()), nil
}
---
[Medium] method instrumentPluginRequestSize in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) instrumentPluginRequestSize(ctx context.Context, pluginCtx backend.PluginContext, endpoint string, requestSize float64) error {
	target, err := m.pluginTarget(ctx, pluginCtx.PluginID)
	if err != nil {
		return err
	}
	m.pluginRequestSize.WithLabelValues(""grafana-backend"", pluginCtx.PluginID, endpoint, target).Observe(requestSize)
	return nil
}
---
[Medium] method FromContext in pkg/plugins/log/fake.go:
func (f *TestLogger) FromContext(_ context.Context) Logger {
	return NewTestLogger()
}
---
[Medium] method FromContext in pkg/plugins/log/logger.go:
func (d *grafanaInfraLogWrapper) FromContext(ctx context.Context) Logger {
	concreteInfraLogger, ok := d.l.FromContext(ctx).(*log.ConcreteLogger)
	if !ok {
		return d.New()
	}
	return &grafanaInfraLogWrapper{
		l: concreteInfraLogger,
	}
}
---
[Medium] method QueryData in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
	ctx = instrumentContext(ctx, endpointQueryData, req.PluginContext)
	return m.next.QueryData(ctx, req)
}
---
[Medium] method CallResource in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) CallResource(ctx context.Context, req *backend.CallResourceRequest, sender backend.CallResourceResponseSender) error {
	ctx = instrumentContext(ctx, endpointCallResource, req.PluginContext)
	return m.next.CallResource(ctx, req, sender)
}
---
[Medium] method CheckHealth in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) CheckHealth(ctx context.Context, req *backend.CheckHealthRequest) (*backend.CheckHealthResult, error) {
	ctx = instrumentContext(ctx, endpointCheckHealth, req.PluginContext)
	return m.next.CheckHealth(ctx, req)
}
---
[Medium] method CollectMetrics in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) CollectMetrics(ctx context.Context, req *backend.CollectMetricsRequest) (*backend.CollectMetricsResult, error) {
	ctx = instrumentContext(ctx, endpointCollectMetrics, req.PluginContext)
	return m.next.CollectMetrics(ctx, req)
}
---
[Medium] method SubscribeStream in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) SubscribeStream(ctx context.Context, req *backend.SubscribeStreamRequest) (*backend.SubscribeStreamResponse, error) {
	return m.next.SubscribeStream(ctx, req)
}
---
[Medium] method PublishStream in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) PublishStream(ctx context.Context, req *backend.PublishStreamRequest) (*backend.PublishStreamResponse, error) {
	return m.next.PublishStream(ctx, req)
}
---
[Medium] method RunStream in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) RunStream(ctx context.Context, req *backend.RunStreamRequest, sender *backend.StreamSender) error {
	return m.next.RunStream(ctx, req, sender)
}
---
[Medium] method QueryData in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
	var requestSize float64
	for _, v := range req.Queries {
		requestSize += float64(len(v.JSON))
	}
	if err := m.instrumentPluginRequestSize(ctx, req.PluginContext, endpointQueryData, requestSize); err != nil {
		return nil, err
	}
	var resp *backend.QueryDataResponse
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointQueryData, func(ctx context.Context) (
---
[Medium] method CallResource in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) CallResource(ctx context.Context, req *backend.CallResourceRequest, sender backend.CallResourceResponseSender) error {
	if err := m.instrumentPluginRequestSize(ctx, req.PluginContext, endpointCallResource, float64(len(req.Body))); err != nil {
		return err
	}
	return m.instrumentPluginRequest(ctx, req.PluginContext, endpointCallResource, func(ctx context.Context) error {
		return m.next.CallResource(ctx, req, sender)
	})
}
---
[Medium] method CheckHealth in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) CheckHealth(ctx context.Context, req *backend.CheckHealthRequest) (*backend.CheckHealthResult, error) {
	var result *backend.CheckHealthResult
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointCheckHealth, func(ctx context.Context) (innerErr error) {
		result, innerErr = m.next.CheckHealth(ctx, req)
		return
	})
	return result, err
}
---
[Medium] method CollectMetrics in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) CollectMetrics(ctx context.Context, req *backend.CollectMetricsRequest) (*backend.CollectMetricsResult, error) {
	var result *backend.CollectMetricsResult
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointCollectMetrics, func(ctx context.Context) (innerErr error) {
		result, innerErr = m.next.CollectMetrics(ctx, req)
		return
	})
	return result, err
}
---
[Medium] method SubscribeStream in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) SubscribeStream(ctx context.Context, req *backend.SubscribeStreamRequest) (*backend.SubscribeStreamResponse, error) {
	return m.next.SubscribeStream(ctx, req)
}
---
[Medium] method PublishStream in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) PublishStream(ctx context.Context, req *backend.PublishStreamRequest) (*backend.PublishStreamResponse, error) {
	return m.next.PublishStream(ctx, req)
}
---
[Medium] method RunStream in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) RunStream(ctx context.Context, req *backend.RunStreamRequest, sender *backend.StreamSender) error {
	return m.next.RunStream(ctx, req, sender)
}
---
[Medium] function TestInstrumentationMiddleware in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware_test.go:
func TestInstrumentationMiddleware(t *testing.T) {
	const (
		pluginID = ""plugin-id""

		metricRequestTotal      = ""grafana_plugin_request_total""
		metricRequestDurationMs = ""grafana_plugin_request_duration_milliseconds""
		metricRequestDurationS  = ""grafana_plugin_request_duration_seconds""
		metricRequestSize       = ""grafana_plugin_request_size_bytes""
	)

	pCtx := backend.PluginContext{PluginID: pluginID}

	t.Run(""should instrument requests"", func(t *testing.T) {
		for _, tc := range []struct {

---
[Medium] function checkHistogram in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware_test.go:
func checkHistogram(promRegistry *prometheus.Registry, expMetricName string, expLabels map[string]string) error {
	metrics, err := promRegistry.Gather()
	if err != nil {
		return fmt.Errorf(""gather: %w"", err)
	}
	var metricFamily *dto.MetricFamily
	for _, mf := range metrics {
		if *mf.Name == expMetricName {
			metricFamily = mf
			break
		}
	}
	if metricFamily == nil {
		return fmt.Errorf(""metric %q not found"", expMetricName)
	}
	var foundLabels int
	var metric *dto.Metric
	for _, m := range m
---
[Medium] function newInstrumentationMiddleware in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func newInstrumentationMiddleware(promRegisterer prometheus.Registerer, pluginRegistry registry.Service) *InstrumentationMiddleware {
	pluginRequestCounter := prometheus.NewCounterVec(prometheus.CounterOpts{
		Namespace: ""grafana"",
		Name:      ""plugin_request_total"",
		Help:      ""The total amount of plugin requests"",
	}, []string{""plugin_id"", ""endpoint"", ""status"", ""target""})
	pluginRequestDuration := prometheus.NewHistogramVec(prometheus.HistogramOpts{
		Namespace: ""grafana"",
		Name:      ""plu
---
[Medium] method pluginTarget in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) pluginTarget(ctx context.Context, pluginID string) (string, error) {
	p, exists := m.pluginRegistry.Plugin(ctx, pluginID)
	if !exists {
		return """", plugins.ErrPluginNotRegistered
	}
	return string(p.Target()), nil
}
---
[Medium] function instrumentContext in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func instrumentContext(ctx context.Context, endpoint string, pCtx backend.PluginContext) context.Context {
	p := []any{""endpoint"", endpoint, ""pluginId"", pCtx.PluginID}
	if pCtx.DataSourceInstanceSettings != nil {
		p = append(p, ""dsName"", pCtx.DataSourceInstanceSettings.Name)
		p = append(p, ""dsUID"", pCtx.DataSourceInstanceSettings.UID)
	}
	if pCtx.User != nil {
		p = append(p, ""uname"", pCtx.User.Login)
	}
	return log.WithContextualAttributes(ctx, p)
}
---
[Medium] method instrumentPluginRequestSize in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) instrumentPluginRequestSize(ctx context.Context, pluginCtx backend.PluginContext, endpoint string, requestSize float64) error {
	target, err := m.pluginTarget(ctx, pluginCtx.PluginID)
	if err != nil {
		return err
	}
	m.pluginRequestSize.WithLabelValues(""grafana-backend"", pluginCtx.PluginID, endpoint, target).Observe(requestSize)
	return nil
}
---
[Medium] method instrumentPluginRequest in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) instrumentPluginRequest(ctx context.Context, pluginCtx backend.PluginContext, endpoint string, fn func(context.Context) error) error {
	target, err := m.pluginTarget(ctx, pluginCtx.PluginID)
	if err != nil {
		return err
	}

	status := statusOK
	start := time.Now()

	ctx = instrumentContext(ctx, endpoint, pluginCtx)
	err = fn(ctx)
	if err != nil {
		status = statusError
		if errors.Is(err, context.Canceled) {
			status = statusCancelled
		}
	}

	elapsed := tim
---
[Medium] function checkHistogram in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware_test.go:
func checkHistogram(promRegistry *prometheus.Registry, expMetricName string, expLabels map[string]string) error {
	metrics, err := promRegistry.Gather()
	if err != nil {
		return fmt.Errorf(""gather: %w"", err)
	}
	var metricFamily *dto.MetricFamily
	for _, mf := range metrics {
		if *mf.Name == expMetricName {
			metricFamily = mf
			break
		}
	}
	if metricFamily == nil {
		return fmt.Errorf(""metric %q not found"", expMetricName)
	}
	var foundLabels int
	var metric *dto.Metric
	for _, m := range m","logRequest (High), instrumentContext (High), instrumentPluginRequest (High), CreateMiddlewares (High), NewContextualLoggerMiddleware (Medium), NewMetricsMiddleware (Medium), NewInstrumentationMiddleware (Medium), QueryData (Medium), CallResource (Medium), CheckHealth (Medium), CollectMetrics (Medium), SubscribeStream (Medium), PublishStream (Medium), RunStream (Medium), TestInstrumentationMiddleware (Medium), newMetricsMiddleware (Medium), CheckHealth (Medium), QueryData (Medium), CallResource (Medium), CollectMetrics (Medium), pluginTarget (Medium), instrumentPluginRequestSize (Medium), FromContext (Medium), FromContext (Medium), QueryData (Medium), CallResource (Medium), CheckHealth (Medium), CollectMetrics (Medium), SubscribeStream (Medium), PublishStream (Medium), RunStream (Medium), QueryData (Medium), CallResource (Medium), CheckHealth (Medium), CollectMetrics (Medium), SubscribeStream (Medium), PublishStream (Medium), RunStream (Medium), TestInstrumentationMiddleware (Medium), checkHistogram (Medium), newInstrumentationMiddleware (Medium), pluginTarget (Medium), instrumentContext (Medium), instrumentPluginRequestSize (Medium), instrumentPluginRequest (Medium), checkHistogram (Medium)",match,'req' matches HC entity 'instrumentpluginrequest'
grafana,3,Plugins: Chore: Renamed instrumentation middleware to metrics middleware,"The traceID is no longer logged for plugin requests. During a refactoring, the tracing import and the logic to extract and add traceID from the context to log parameters were removed from the LoggerMiddleware. The newly introduced ContextualLoggerMiddleware does not add this information, resulting in missing traceID in plugin request logs and impacting debugging and request tracing capabilities.",Low,46,4,42,"method::logRequest (pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go) [High, score=0.66] | function::instrumentContext (pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go) [High, score=0.60] | method::instrumentPluginRequest (pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go) [High, score=0.60] | function::CreateMiddlewares (pkg/services/pluginsintegration/pluginsintegration.go) [High, score=0.59]","[High] method logRequest in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) logRequest(ctx context.Context, fn func(ctx context.Context) error) error {
	status := statusOK
	start := time.Now()
	timeBeforePluginRequest := log.TimeSinceStart(ctx, start)

	err := fn(ctx)
	if err != nil {
		status = statusError
		if errors.Is(err, context.Canceled) {
			status = statusCancelled
		}
	}

	logParams := []any{
		""status"", status,
		""duration"", time.Since(start),
		""eventName"", ""grafana-data-egress"",
		""time_before_plugin_request"", timeBeforePluginRequest,
	}
	if status == statusError {
		logParams = append(logParams, ""error"", err)
	}
	m.logger.FromContext(ctx).Info(""Plugin Request Completed"", logParams...)
	return err
}
---
[High] function instrumentContext in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func instrumentContext(ctx context.Context, endpoint string, pCtx backend.PluginContext) context.Context {
	p := []any{""endpoint"", endpoint, ""pluginId"", pCtx.PluginID}
	if pCtx.DataSourceInstanceSettings != nil {
		p = append(p, ""dsName"", pCtx.DataSourceInstanceSettings.Name)
		p = append(p, ""dsUID"", pCtx.DataSourceInstanceSettings.UID)
	}
	if pCtx.User != nil {
		p = append(p, ""uname"", pCtx.User.Login)
	}
	return log.WithContextualAttributes(ctx, p)
}
---
[High] method instrumentPluginRequest in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) instrumentPluginRequest(ctx context.Context, pluginCtx backend.PluginContext, endpoint string, fn func(context.Context) error) error {
	target, err := m.pluginTarget(ctx, pluginCtx.PluginID)
	if err != nil {
		return err
	}

	status := statusOK
	start := time.Now()

	err = fn(ctx)
	if err != nil {
		status = statusError
		if errors.Is(err, context.Canceled) {
			status = statusCancelled
		}
	}

	elapsed := time.Since(start)

	pluginRequestDurationWithLabels := m.pluginRequestDuration.WithLabelValues(pluginCtx.PluginID, endpoint, target)
	pluginRequestCounterWithLabels := m.pluginRequestCounter.WithLabelValues(pluginCtx.PluginID, endpoint, status, target)
	pluginRequestDurationSecondsWithLabels := m.pluginRequestDurationSeconds.WithLabelValues(""grafana-backend"", 
---
[High] function CreateMiddlewares in pkg/services/pluginsintegration/pluginsintegration.go:
func CreateMiddlewares(cfg *setting.Cfg, oAuthTokenService oauthtoken.OAuthTokenService, tracer tracing.Tracer, cachingService caching.CachingService, features *featuremgmt.FeatureManager, promRegisterer prometheus.Registerer, registry registry.Service) []plugins.ClientMiddleware {
	skipCookiesNames := []string{cfg.LoginCookieName}
	middlewares := []plugins.ClientMiddleware{
		clientmiddleware.NewTracingMiddleware(tracer),
		clientmiddleware.NewMetricsMiddleware(promRegisterer, registry),
		clientmiddleware.NewContextualLoggerMiddleware(),
		clientmiddleware.NewLoggerMiddleware(cfg, log.New(""plugin.instrumentation"")),
		clientmiddleware.NewTracingHeaderMiddleware(),
		clientmiddleware.NewClearAuthHeadersMiddleware(),
		clientmiddleware.NewOAuthTokenMiddleware(oAuthTokenService),
		clientmi","[Medium] function NewContextualLoggerMiddleware in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func NewContextualLoggerMiddleware() plugins.ClientMiddleware {
	return plugins.ClientMiddlewareFunc(func(next plugins.Client) plugins.Client {
		return &ContextualLoggerMiddleware{
			next: next,
		}
	})
}
---
[Medium] function NewMetricsMiddleware in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func NewMetricsMiddleware(promRegisterer prometheus.Registerer, pluginRegistry registry.Service) plugins.ClientMiddleware {
	imw := newMetricsMiddleware(promRegisterer, pluginRegistry)
	return plugins.ClientMiddlewareFunc(func(next plugins.Client) plugins.Client {
		imw.next = next
		return imw
	})
}
---
[Medium] function NewInstrumentationMiddleware in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func NewInstrumentationMiddleware(promRegisterer prometheus.Registerer, pluginRegistry registry.Service) plugins.ClientMiddleware {
	imw := newInstrumentationMiddleware(promRegisterer, pluginRegistry)
	return plugins.ClientMiddlewareFunc(func(next plugins.Client) plugins.Client {
		imw.next = next
		return imw
	})
}
---
[Medium] method QueryData in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
	var requestSize float64
	for _, v := range req.Queries {
		requestSize += float64(len(v.JSON))
	}
	if err := m.instrumentPluginRequestSize(ctx, req.PluginContext, endpointQueryData, requestSize); err != nil {
		return nil, err
	}
	var resp *backend.QueryDataResponse
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointQueryData, func(ctx context.Co
---
[Medium] method CallResource in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) CallResource(ctx context.Context, req *backend.CallResourceRequest, sender backend.CallResourceResponseSender) error {
	if err := m.instrumentPluginRequestSize(ctx, req.PluginContext, endpointCallResource, float64(len(req.Body))); err != nil {
		return err
	}
	return m.instrumentPluginRequest(ctx, req.PluginContext, endpointCallResource, func(ctx context.Context) error {
		return m.next.CallResource(ctx, req, sender)
	})
}
---
[Medium] method CheckHealth in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) CheckHealth(ctx context.Context, req *backend.CheckHealthRequest) (*backend.CheckHealthResult, error) {
	var result *backend.CheckHealthResult
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointCheckHealth, func(ctx context.Context) (innerErr error) {
		result, innerErr = m.next.CheckHealth(ctx, req)
		return
	})
	return result, err
}
---
[Medium] method CollectMetrics in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) CollectMetrics(ctx context.Context, req *backend.CollectMetricsRequest) (*backend.CollectMetricsResult, error) {
	var result *backend.CollectMetricsResult
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointCollectMetrics, func(ctx context.Context) (innerErr error) {
		result, innerErr = m.next.CollectMetrics(ctx, req)
		return
	})
	return result, err
}
---
[Medium] method SubscribeStream in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) SubscribeStream(ctx context.Context, req *backend.SubscribeStreamRequest) (*backend.SubscribeStreamResponse, error) {
	return m.next.SubscribeStream(ctx, req)
}
---
[Medium] method PublishStream in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) PublishStream(ctx context.Context, req *backend.PublishStreamRequest) (*backend.PublishStreamResponse, error) {
	return m.next.PublishStream(ctx, req)
}
---
[Medium] method RunStream in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) RunStream(ctx context.Context, req *backend.RunStreamRequest, sender *backend.StreamSender) error {
	return m.next.RunStream(ctx, req, sender)
}
---
[Medium] function TestInstrumentationMiddleware in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware_test.go:
func TestInstrumentationMiddleware(t *testing.T) {
	const (
		pluginID = ""plugin-id""

		metricRequestTotal      = ""grafana_plugin_request_total""
		metricRequestDurationMs = ""grafana_plugin_request_duration_milliseconds""
		metricRequestDurationS  = ""grafana_plugin_request_duration_seconds""
		metricRequestSize       = ""grafana_plugin_request_size_bytes""
	)

	pCtx := backend.PluginContext{PluginID: pluginID}

	t.Run(""should instrument requests"", func(t *testing.T) {
		for _, tc := range []struct {

---
[Medium] function newMetricsMiddleware in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func newMetricsMiddleware(promRegisterer prometheus.Registerer, pluginRegistry registry.Service) *MetricsMiddleware {
	pluginRequestCounter := prometheus.NewCounterVec(prometheus.CounterOpts{
		Namespace: ""grafana"",
		Name:      ""plugin_request_total"",
		Help:      ""The total amount of plugin requests"",
	}, []string{""plugin_id"", ""endpoint"", ""status"", ""target""})
	pluginRequestDuration := prometheus.NewHistogramVec(prometheus.HistogramOpts{
		Namespace: ""grafana"",
		Name:      ""plugin_request_dura
---
[Medium] method CheckHealth in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) CheckHealth(ctx context.Context, req *backend.CheckHealthRequest) (*backend.CheckHealthResult, error) {
	if req == nil {
		return m.next.CheckHealth(ctx, req)
	}

	var resp *backend.CheckHealthResult
	err := m.logRequest(ctx, func(ctx context.Context) (innerErr error) {
		resp, innerErr = m.next.CheckHealth(ctx, req)
		return innerErr
	})

	return resp, err
}
---
[Medium] method QueryData in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
	if req == nil {
		return m.next.QueryData(ctx, req)
	}

	var resp *backend.QueryDataResponse
	err := m.logRequest(ctx, func(ctx context.Context) (innerErr error) {
		resp, innerErr = m.next.QueryData(ctx, req)
		return innerErr
	})

	return resp, err
}
---
[Medium] method CallResource in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) CallResource(ctx context.Context, req *backend.CallResourceRequest, sender backend.CallResourceResponseSender) error {
	if req == nil {
		return m.next.CallResource(ctx, req, sender)
	}

	err := m.logRequest(ctx, func(ctx context.Context) (innerErr error) {
		innerErr = m.next.CallResource(ctx, req, sender)
		return innerErr
	})

	return err
}
---
[Medium] method CollectMetrics in pkg/services/pluginsintegration/clientmiddleware/logger_middleware.go:
func (m *LoggerMiddleware) CollectMetrics(ctx context.Context, req *backend.CollectMetricsRequest) (*backend.CollectMetricsResult, error) {
	if req == nil {
		return m.next.CollectMetrics(ctx, req)
	}

	var resp *backend.CollectMetricsResult
	err := m.logRequest(ctx, func(ctx context.Context) (innerErr error) {
		resp, innerErr = m.next.CollectMetrics(ctx, req)
		return innerErr
	})

	return resp, err
}
---
[Medium] method pluginTarget in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) pluginTarget(ctx context.Context, pluginID string) (string, error) {
	p, exists := m.pluginRegistry.Plugin(ctx, pluginID)
	if !exists {
		return """", plugins.ErrPluginNotRegistered
	}
	return string(p.Target()), nil
}
---
[Medium] method instrumentPluginRequestSize in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) instrumentPluginRequestSize(ctx context.Context, pluginCtx backend.PluginContext, endpoint string, requestSize float64) error {
	target, err := m.pluginTarget(ctx, pluginCtx.PluginID)
	if err != nil {
		return err
	}
	m.pluginRequestSize.WithLabelValues(""grafana-backend"", pluginCtx.PluginID, endpoint, target).Observe(requestSize)
	return nil
}
---
[Medium] method FromContext in pkg/plugins/log/fake.go:
func (f *TestLogger) FromContext(_ context.Context) Logger {
	return NewTestLogger()
}
---
[Medium] method FromContext in pkg/plugins/log/logger.go:
func (d *grafanaInfraLogWrapper) FromContext(ctx context.Context) Logger {
	concreteInfraLogger, ok := d.l.FromContext(ctx).(*log.ConcreteLogger)
	if !ok {
		return d.New()
	}
	return &grafanaInfraLogWrapper{
		l: concreteInfraLogger,
	}
}
---
[Medium] method QueryData in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
	ctx = instrumentContext(ctx, endpointQueryData, req.PluginContext)
	return m.next.QueryData(ctx, req)
}
---
[Medium] method CallResource in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) CallResource(ctx context.Context, req *backend.CallResourceRequest, sender backend.CallResourceResponseSender) error {
	ctx = instrumentContext(ctx, endpointCallResource, req.PluginContext)
	return m.next.CallResource(ctx, req, sender)
}
---
[Medium] method CheckHealth in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) CheckHealth(ctx context.Context, req *backend.CheckHealthRequest) (*backend.CheckHealthResult, error) {
	ctx = instrumentContext(ctx, endpointCheckHealth, req.PluginContext)
	return m.next.CheckHealth(ctx, req)
}
---
[Medium] method CollectMetrics in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) CollectMetrics(ctx context.Context, req *backend.CollectMetricsRequest) (*backend.CollectMetricsResult, error) {
	ctx = instrumentContext(ctx, endpointCollectMetrics, req.PluginContext)
	return m.next.CollectMetrics(ctx, req)
}
---
[Medium] method SubscribeStream in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) SubscribeStream(ctx context.Context, req *backend.SubscribeStreamRequest) (*backend.SubscribeStreamResponse, error) {
	return m.next.SubscribeStream(ctx, req)
}
---
[Medium] method PublishStream in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) PublishStream(ctx context.Context, req *backend.PublishStreamRequest) (*backend.PublishStreamResponse, error) {
	return m.next.PublishStream(ctx, req)
}
---
[Medium] method RunStream in pkg/services/pluginsintegration/clientmiddleware/contextual_logger_middleware.go:
func (m *ContextualLoggerMiddleware) RunStream(ctx context.Context, req *backend.RunStreamRequest, sender *backend.StreamSender) error {
	return m.next.RunStream(ctx, req, sender)
}
---
[Medium] method QueryData in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) QueryData(ctx context.Context, req *backend.QueryDataRequest) (*backend.QueryDataResponse, error) {
	var requestSize float64
	for _, v := range req.Queries {
		requestSize += float64(len(v.JSON))
	}
	if err := m.instrumentPluginRequestSize(ctx, req.PluginContext, endpointQueryData, requestSize); err != nil {
		return nil, err
	}
	var resp *backend.QueryDataResponse
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointQueryData, func(ctx context.Context) (
---
[Medium] method CallResource in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) CallResource(ctx context.Context, req *backend.CallResourceRequest, sender backend.CallResourceResponseSender) error {
	if err := m.instrumentPluginRequestSize(ctx, req.PluginContext, endpointCallResource, float64(len(req.Body))); err != nil {
		return err
	}
	return m.instrumentPluginRequest(ctx, req.PluginContext, endpointCallResource, func(ctx context.Context) error {
		return m.next.CallResource(ctx, req, sender)
	})
}
---
[Medium] method CheckHealth in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) CheckHealth(ctx context.Context, req *backend.CheckHealthRequest) (*backend.CheckHealthResult, error) {
	var result *backend.CheckHealthResult
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointCheckHealth, func(ctx context.Context) (innerErr error) {
		result, innerErr = m.next.CheckHealth(ctx, req)
		return
	})
	return result, err
}
---
[Medium] method CollectMetrics in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) CollectMetrics(ctx context.Context, req *backend.CollectMetricsRequest) (*backend.CollectMetricsResult, error) {
	var result *backend.CollectMetricsResult
	err := m.instrumentPluginRequest(ctx, req.PluginContext, endpointCollectMetrics, func(ctx context.Context) (innerErr error) {
		result, innerErr = m.next.CollectMetrics(ctx, req)
		return
	})
	return result, err
}
---
[Medium] method SubscribeStream in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) SubscribeStream(ctx context.Context, req *backend.SubscribeStreamRequest) (*backend.SubscribeStreamResponse, error) {
	return m.next.SubscribeStream(ctx, req)
}
---
[Medium] method PublishStream in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) PublishStream(ctx context.Context, req *backend.PublishStreamRequest) (*backend.PublishStreamResponse, error) {
	return m.next.PublishStream(ctx, req)
}
---
[Medium] method RunStream in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware.go:
func (m *MetricsMiddleware) RunStream(ctx context.Context, req *backend.RunStreamRequest, sender *backend.StreamSender) error {
	return m.next.RunStream(ctx, req, sender)
}
---
[Medium] function TestInstrumentationMiddleware in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware_test.go:
func TestInstrumentationMiddleware(t *testing.T) {
	const (
		pluginID = ""plugin-id""

		metricRequestTotal      = ""grafana_plugin_request_total""
		metricRequestDurationMs = ""grafana_plugin_request_duration_milliseconds""
		metricRequestDurationS  = ""grafana_plugin_request_duration_seconds""
		metricRequestSize       = ""grafana_plugin_request_size_bytes""
	)

	pCtx := backend.PluginContext{PluginID: pluginID}

	t.Run(""should instrument requests"", func(t *testing.T) {
		for _, tc := range []struct {

---
[Medium] function checkHistogram in pkg/services/pluginsintegration/clientmiddleware/metrics_middleware_test.go:
func checkHistogram(promRegistry *prometheus.Registry, expMetricName string, expLabels map[string]string) error {
	metrics, err := promRegistry.Gather()
	if err != nil {
		return fmt.Errorf(""gather: %w"", err)
	}
	var metricFamily *dto.MetricFamily
	for _, mf := range metrics {
		if *mf.Name == expMetricName {
			metricFamily = mf
			break
		}
	}
	if metricFamily == nil {
		return fmt.Errorf(""metric %q not found"", expMetricName)
	}
	var foundLabels int
	var metric *dto.Metric
	for _, m := range m
---
[Medium] function newInstrumentationMiddleware in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func newInstrumentationMiddleware(promRegisterer prometheus.Registerer, pluginRegistry registry.Service) *InstrumentationMiddleware {
	pluginRequestCounter := prometheus.NewCounterVec(prometheus.CounterOpts{
		Namespace: ""grafana"",
		Name:      ""plugin_request_total"",
		Help:      ""The total amount of plugin requests"",
	}, []string{""plugin_id"", ""endpoint"", ""status"", ""target""})
	pluginRequestDuration := prometheus.NewHistogramVec(prometheus.HistogramOpts{
		Namespace: ""grafana"",
		Name:      ""plu
---
[Medium] method pluginTarget in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) pluginTarget(ctx context.Context, pluginID string) (string, error) {
	p, exists := m.pluginRegistry.Plugin(ctx, pluginID)
	if !exists {
		return """", plugins.ErrPluginNotRegistered
	}
	return string(p.Target()), nil
}
---
[Medium] function instrumentContext in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func instrumentContext(ctx context.Context, endpoint string, pCtx backend.PluginContext) context.Context {
	p := []any{""endpoint"", endpoint, ""pluginId"", pCtx.PluginID}
	if pCtx.DataSourceInstanceSettings != nil {
		p = append(p, ""dsName"", pCtx.DataSourceInstanceSettings.Name)
		p = append(p, ""dsUID"", pCtx.DataSourceInstanceSettings.UID)
	}
	if pCtx.User != nil {
		p = append(p, ""uname"", pCtx.User.Login)
	}
	return log.WithContextualAttributes(ctx, p)
}
---
[Medium] method instrumentPluginRequestSize in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) instrumentPluginRequestSize(ctx context.Context, pluginCtx backend.PluginContext, endpoint string, requestSize float64) error {
	target, err := m.pluginTarget(ctx, pluginCtx.PluginID)
	if err != nil {
		return err
	}
	m.pluginRequestSize.WithLabelValues(""grafana-backend"", pluginCtx.PluginID, endpoint, target).Observe(requestSize)
	return nil
}
---
[Medium] method instrumentPluginRequest in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware.go:
func (m *InstrumentationMiddleware) instrumentPluginRequest(ctx context.Context, pluginCtx backend.PluginContext, endpoint string, fn func(context.Context) error) error {
	target, err := m.pluginTarget(ctx, pluginCtx.PluginID)
	if err != nil {
		return err
	}

	status := statusOK
	start := time.Now()

	ctx = instrumentContext(ctx, endpoint, pluginCtx)
	err = fn(ctx)
	if err != nil {
		status = statusError
		if errors.Is(err, context.Canceled) {
			status = statusCancelled
		}
	}

	elapsed := tim
---
[Medium] function checkHistogram in pkg/services/pluginsintegration/clientmiddleware/instrumentation_middleware_test.go:
func checkHistogram(promRegistry *prometheus.Registry, expMetricName string, expLabels map[string]string) error {
	metrics, err := promRegistry.Gather()
	if err != nil {
		return fmt.Errorf(""gather: %w"", err)
	}
	var metricFamily *dto.MetricFamily
	for _, mf := range metrics {
		if *mf.Name == expMetricName {
			metricFamily = mf
			break
		}
	}
	if metricFamily == nil {
		return fmt.Errorf(""metric %q not found"", expMetricName)
	}
	var foundLabels int
	var metric *dto.Metric
	for _, m := range m","logRequest (High), instrumentContext (High), instrumentPluginRequest (High), CreateMiddlewares (High), NewContextualLoggerMiddleware (Medium), NewMetricsMiddleware (Medium), NewInstrumentationMiddleware (Medium), QueryData (Medium), CallResource (Medium), CheckHealth (Medium), CollectMetrics (Medium), SubscribeStream (Medium), PublishStream (Medium), RunStream (Medium), TestInstrumentationMiddleware (Medium), newMetricsMiddleware (Medium), CheckHealth (Medium), QueryData (Medium), CallResource (Medium), CollectMetrics (Medium), pluginTarget (Medium), instrumentPluginRequestSize (Medium), FromContext (Medium), FromContext (Medium), QueryData (Medium), CallResource (Medium), CheckHealth (Medium), CollectMetrics (Medium), SubscribeStream (Medium), PublishStream (Medium), RunStream (Medium), QueryData (Medium), CallResource (Medium), CheckHealth (Medium), CollectMetrics (Medium), SubscribeStream (Medium), PublishStream (Medium), RunStream (Medium), TestInstrumentationMiddleware (Medium), checkHistogram (Medium), newInstrumentationMiddleware (Medium), pluginTarget (Medium), instrumentContext (Medium), instrumentPluginRequestSize (Medium), instrumentPluginRequest (Medium), checkHistogram (Medium)",match,'context' matches HC entity 'instrumentcontext'
grafana,2,AuthZService: improve authz caching,"The Check operation exhibits asymmetric cache trust logic: cached permission grants are trusted and returned immediately, but cached denials from the same permission cache are ignored, leading to a fresh database lookup. This allows stale cached grants to provide access to revoked resources, posing a security risk. ",High,17,3,14,"function::setupService (pkg/services/authz/rbac/service_test.go) [High, score=0.68] | function::ProvideAuthZClient (pkg/services/authz/rbac.go) [High, score=0.59] | function::newRemoteRBACClient (pkg/services/authz/rbac.go) [High, score=0.58]","[High] function setupService in pkg/services/authz/rbac/service_test.go:
func setupService() *Service {
	cache := cache.NewLocalCache(cache.Config{Expiry: 5 * time.Minute, CleanupInterval: 5 * time.Minute})
	logger := log.New(""authz-rbac-service"")
	fStore := &fakeStore{}
	return &Service{
		logger:          logger,
		mapper:          newMapper(),
		tracer:          tracing.NewNoopTracerService(),
		metrics:         newMetrics(nil),
		idCache:         newCacheWrap[store.UserIdentifiers](cache, logger, longCacheTTL),
		permCache:       newCacheWrap[map[string]bool](cache, logger, shortCacheTTL),
		permDenialCache: newCacheWrap[bool](cache, logger, shortCacheTTL),
		teamCache:       newCacheWrap[[]int64](cache, logger, shortCacheTTL),
		basicRoleCache:  newCacheWrap[store.BasicRole](cache, logger, longCacheTTL),
		folderCache:     newCacheWrap[folderTree](cache, l
---
[High] function ProvideAuthZClient in pkg/services/authz/rbac.go:
func ProvideAuthZClient(
	cfg *setting.Cfg,
	features featuremgmt.FeatureToggles,
	grpcServer grpcserver.Provider,
	tracer tracing.Tracer,
	reg prometheus.Registerer,
	db db.DB,
	acService accesscontrol.Service,
	zanzanaClient zanzana.Client,
	restConfig apiserver.RestConfigProvider,
) (authlib.AccessClient, error) {
	authCfg, err := readAuthzClientSettings(cfg)
	if err != nil {
		return nil, err
	}

	if !features.IsEnabledGlobally(featuremgmt.FlagAuthZGRPCServer) && authCfg.mode == clientModeCloud {
		return nil, errors.New(""authZGRPCServer feature toggle is required for cloud and grpc mode"")
	}

	switch authCfg.mode {
	case clientModeCloud:
		rbacClient, err := newRemoteRBACClient(authCfg, tracer)
		if features.IsEnabledGlobally(featuremgmt.FlagZanzana) {
			return zanzana.WithShadowClie
---
[High] function newRemoteRBACClient in pkg/services/authz/rbac.go:
func newRemoteRBACClient(clientCfg *authzClientSettings, tracer trace.Tracer) (authlib.AccessClient, error) {
	tokenClient, err := authnlib.NewTokenExchangeClient(authnlib.TokenExchangeConfig{
		Token:            clientCfg.token,
		TokenExchangeURL: clientCfg.tokenExchangeURL,
	})
	if err != nil {
		return nil, fmt.Errorf(""failed to initialize token exchange client: %w"", err)
	}

	transportCreds := insecure.NewCredentials()
	if clientCfg.certFile != """" {
		transportCreds, err = credentials.NewClientTLSFromFile(clientCfg.certFile, """")
		if err != nil {
			return nil, fmt.Errorf(""failed to load TLS credentials: %w"", err)
		}
	}

	conn, err := grpc.NewClient(
		clientCfg.remoteAddress,
		grpc.WithTransportCredentials(transportCreds),
		grpc.WithPerRPCCredentials(
			NewGRPCTokenAuth(AuthzServ","[Medium] method getAnonymousPermissions in pkg/services/authz/rbac/service.go:
func (s *Service) getAnonymousPermissions(ctx context.Context, ns types.NamespaceInfo, action string, actionSets []string) (map[string]bool, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.getAnonymousPermissions"")
	defer span.End()

	anonPermKey := anonymousPermCacheKey(ns.Value, action)
	res, err, _ := s.sf.Do(anonPermKey+""_getAnonymousPermissions"", func() (interface{}, error) {
		permissions, err := s.permissionStore.GetUserPermissions(ctx, ns, store.PermissionsQuery{Actio
---
[Medium] method Set in pkg/services/authz/rbac.go:
func (lc *NoopCache) Set(ctx context.Context, key string, data []byte, exp time.Duration) error {
	return nil
}
---
[Medium] method Check in pkg/services/authz/rbac/service.go:
func (s *Service) Check(ctx context.Context, req *authzv1.CheckRequest) (*authzv1.CheckResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.Check"")
	defer span.End()
	ctxLogger := s.logger.FromContext(ctx)

	deny := &authzv1.CheckResponse{Allowed: false}

	checkReq, err := s.validateCheckRequest(ctx, req)
	if err != nil {
		ctxLogger.Error(""invalid request"", ""error"", err)
		s.metrics.requestCount.WithLabelValues(""true"", ""false"", req.GetVerb(), req.GetGroup(), req.GetReso
---
[Medium] function NewService in pkg/services/authz/rbac/service.go:
func NewService(
	sql legacysql.LegacyDatabaseProvider,
	folderStore store.FolderStore,
	identityStore legacy.LegacyIdentityStore,
	permissionStore store.PermissionStore,
	logger log.Logger,
	tracer tracing.Tracer,
	reg prometheus.Registerer,
	cache cache.Cache,
) *Service {
	return &Service{
		store:           store.NewStore(sql, tracer),
		folderStore:     folderStore,
		permissionStore: permissionStore,
		identityStore:   identityStore,
		logger:          logger,
		tracer:          tracer,
		
---
[Medium] method List in pkg/services/authz/rbac/service.go:
func (s *Service) List(ctx context.Context, req *authzv1.ListRequest) (*authzv1.ListResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.List"")
	defer span.End()
	ctxLogger := s.logger.FromContext(ctx)

	listReq, err := s.validateListRequest(ctx, req)
	if err != nil {
		ctxLogger.Error(""invalid request"", ""error"", err)
		s.metrics.requestCount.WithLabelValues(""true"", ""false"", req.GetVerb(), req.GetGroup(), req.GetResource()).Inc()
		return &authzv1.ListResponse{}, err
	}

---
[Medium] function TestService_getUserPermissions in pkg/services/authz/rbac/service_test.go:
func TestService_getUserPermissions(t *testing.T) {
	type testCase struct {
		name          string
		permissions   []accesscontrol.Permission
		cacheHit      bool
		expectedPerms map[string]bool
	}

	testCases := []testCase{
		{
			name: ""should return permissions from store if not in cache"",
			permissions: []accesscontrol.Permission{
				{Action: ""dashboards:read"", Scope: ""dashboards:uid:some_dashboard""},
			},
			cacheHit:      false,
			expectedPerms: map[string]bool{""dashboards:uid:some_das
---
[Medium] function userPermDenialCacheKey in pkg/services/authz/rbac/cache.go:
func userPermDenialCacheKey(namespace, userUID, action, name, parent string) string {
	return namespace + "".perm_"" + userUID + ""_"" + action + ""_"" + name + ""_"" + parent
}
---
[Medium] method getCachedIdentityPermissions in pkg/services/authz/rbac/service.go:
func (s *Service) getCachedIdentityPermissions(ctx context.Context, ns types.NamespaceInfo, idType types.IdentityType, userID, action string) (map[string]bool, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.getCachedIdentityPermissions"")
	defer span.End()

	switch idType {
	case types.TypeAnonymous:
		anonPermKey := anonymousPermCacheKey(ns.Value, action)
		if cached, ok := s.permCache.Get(ctx, anonPermKey); ok {
			return cached, nil
		}
		return nil, cache.ErrNotFound
	cas
---
[Medium] method getUserPermissions in pkg/services/authz/rbac/service.go:
func (s *Service) getUserPermissions(ctx context.Context, ns types.NamespaceInfo, userID, action string, actionSets []string) (map[string]bool, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.getUserPermissions"")
	defer span.End()

	userIdentifiers, err := s.GetUserIdentifiers(ctx, ns, userID)
	if err != nil {
		return nil, err
	}

	userPermKey := userPermCacheKey(ns.Value, userIdentifiers.UID, action)
	res, err, _ := s.sf.Do(userPermKey+""_getUserPermissions"", func() (interfa
---
[Medium] method Get in pkg/services/authz/rbac.go:
func (lc *NoopCache) Get(ctx context.Context, key string) ([]byte, error) {
	return nil, cache.ErrNotFound
}
---
[Medium] method Delete in pkg/services/authz/rbac.go:
func (lc *NoopCache) Delete(ctx context.Context, key string) error {
	return nil
}
---
[Medium] function TestService_CacheCheck in pkg/services/authz/rbac/service_test.go:
func TestService_CacheCheck(t *testing.T) {
	callingService := authn.NewAccessTokenAuthInfo(authn.Claims[authn.AccessTokenClaims]{
		Claims: jwt.Claims{
			Subject:  types.NewTypeID(types.TypeAccessPolicy, ""some-service""),
			Audience: []string{""authzservice""},
		},
		Rest: authn.AccessTokenClaims{Namespace: ""org-12""},
	})

	ctx := types.WithAuthInfo(context.Background(), callingService)
	userID := &store.UserIdentifiers{UID: ""test-uid"", ID: 1}

	t.Run(""Allow based on cached permissions"", func(t
---
[Medium] function TestService_CacheList in pkg/services/authz/rbac/service_test.go:
func TestService_CacheList(t *testing.T) {
	callingService := authn.NewAccessTokenAuthInfo(authn.Claims[authn.AccessTokenClaims]{
		Claims: jwt.Claims{
			Subject:  types.NewTypeID(types.TypeAccessPolicy, ""some-service""),
			Audience: []string{""authzservice""},
		},
		Rest: authn.AccessTokenClaims{Namespace: ""org-12""},
	})

	t.Run(""List based on cached permissions"", func(t *testing.T) {
		s := setupService()
		ctx := types.WithAuthInfo(context.Background(), callingService)
		userID := &store.User
---
[Medium] function newRBACClient in pkg/services/authz/rbac.go:
func newRBACClient(conn grpc.ClientConnInterface, tracer trace.Tracer) authlib.AccessClient {
	return authzlib.NewClient(
		conn,
		authzlib.WithCacheClientOption(cache.NewLocalCache(cache.Config{
			Expiry:          30 * time.Second,
			CleanupInterval: 2 * time.Minute,
		})),
		authzlib.WithTracerClientOption(tracer),
	)
}","setupService (High), ProvideAuthZClient (High), newRemoteRBACClient (High), getAnonymousPermissions (Medium), Set (Medium), Check (Medium), NewService (Medium), List (Medium), TestService_getUserPermissions (Medium), userPermDenialCacheKey (Medium), getCachedIdentityPermissions (Medium), getUserPermissions (Medium), Get (Medium), Delete (Medium), TestService_CacheCheck (Medium), TestService_CacheList (Medium), newRBACClient (Medium)",match,'provide' matches HC entity 'provideauthzclient'
grafana,2,AuthZService: improve authz caching,"The test comment says the cached permissions 'allow access', but the map stores false for dashboards:uid:dash1, so checkPermission will still treat this scope as not allowed.",Low,17,3,14,"function::setupService (pkg/services/authz/rbac/service_test.go) [High, score=0.68] | function::ProvideAuthZClient (pkg/services/authz/rbac.go) [High, score=0.59] | function::newRemoteRBACClient (pkg/services/authz/rbac.go) [High, score=0.58]","[High] function setupService in pkg/services/authz/rbac/service_test.go:
func setupService() *Service {
	cache := cache.NewLocalCache(cache.Config{Expiry: 5 * time.Minute, CleanupInterval: 5 * time.Minute})
	logger := log.New(""authz-rbac-service"")
	fStore := &fakeStore{}
	return &Service{
		logger:          logger,
		mapper:          newMapper(),
		tracer:          tracing.NewNoopTracerService(),
		metrics:         newMetrics(nil),
		idCache:         newCacheWrap[store.UserIdentifiers](cache, logger, longCacheTTL),
		permCache:       newCacheWrap[map[string]bool](cache, logger, shortCacheTTL),
		permDenialCache: newCacheWrap[bool](cache, logger, shortCacheTTL),
		teamCache:       newCacheWrap[[]int64](cache, logger, shortCacheTTL),
		basicRoleCache:  newCacheWrap[store.BasicRole](cache, logger, longCacheTTL),
		folderCache:     newCacheWrap[folderTree](cache, l
---
[High] function ProvideAuthZClient in pkg/services/authz/rbac.go:
func ProvideAuthZClient(
	cfg *setting.Cfg,
	features featuremgmt.FeatureToggles,
	grpcServer grpcserver.Provider,
	tracer tracing.Tracer,
	reg prometheus.Registerer,
	db db.DB,
	acService accesscontrol.Service,
	zanzanaClient zanzana.Client,
	restConfig apiserver.RestConfigProvider,
) (authlib.AccessClient, error) {
	authCfg, err := readAuthzClientSettings(cfg)
	if err != nil {
		return nil, err
	}

	if !features.IsEnabledGlobally(featuremgmt.FlagAuthZGRPCServer) && authCfg.mode == clientModeCloud {
		return nil, errors.New(""authZGRPCServer feature toggle is required for cloud and grpc mode"")
	}

	switch authCfg.mode {
	case clientModeCloud:
		rbacClient, err := newRemoteRBACClient(authCfg, tracer)
		if features.IsEnabledGlobally(featuremgmt.FlagZanzana) {
			return zanzana.WithShadowClie
---
[High] function newRemoteRBACClient in pkg/services/authz/rbac.go:
func newRemoteRBACClient(clientCfg *authzClientSettings, tracer trace.Tracer) (authlib.AccessClient, error) {
	tokenClient, err := authnlib.NewTokenExchangeClient(authnlib.TokenExchangeConfig{
		Token:            clientCfg.token,
		TokenExchangeURL: clientCfg.tokenExchangeURL,
	})
	if err != nil {
		return nil, fmt.Errorf(""failed to initialize token exchange client: %w"", err)
	}

	transportCreds := insecure.NewCredentials()
	if clientCfg.certFile != """" {
		transportCreds, err = credentials.NewClientTLSFromFile(clientCfg.certFile, """")
		if err != nil {
			return nil, fmt.Errorf(""failed to load TLS credentials: %w"", err)
		}
	}

	conn, err := grpc.NewClient(
		clientCfg.remoteAddress,
		grpc.WithTransportCredentials(transportCreds),
		grpc.WithPerRPCCredentials(
			NewGRPCTokenAuth(AuthzServ","[Medium] method getAnonymousPermissions in pkg/services/authz/rbac/service.go:
func (s *Service) getAnonymousPermissions(ctx context.Context, ns types.NamespaceInfo, action string, actionSets []string) (map[string]bool, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.getAnonymousPermissions"")
	defer span.End()

	anonPermKey := anonymousPermCacheKey(ns.Value, action)
	res, err, _ := s.sf.Do(anonPermKey+""_getAnonymousPermissions"", func() (interface{}, error) {
		permissions, err := s.permissionStore.GetUserPermissions(ctx, ns, store.PermissionsQuery{Actio
---
[Medium] method Set in pkg/services/authz/rbac.go:
func (lc *NoopCache) Set(ctx context.Context, key string, data []byte, exp time.Duration) error {
	return nil
}
---
[Medium] method Check in pkg/services/authz/rbac/service.go:
func (s *Service) Check(ctx context.Context, req *authzv1.CheckRequest) (*authzv1.CheckResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.Check"")
	defer span.End()
	ctxLogger := s.logger.FromContext(ctx)

	deny := &authzv1.CheckResponse{Allowed: false}

	checkReq, err := s.validateCheckRequest(ctx, req)
	if err != nil {
		ctxLogger.Error(""invalid request"", ""error"", err)
		s.metrics.requestCount.WithLabelValues(""true"", ""false"", req.GetVerb(), req.GetGroup(), req.GetReso
---
[Medium] function NewService in pkg/services/authz/rbac/service.go:
func NewService(
	sql legacysql.LegacyDatabaseProvider,
	folderStore store.FolderStore,
	identityStore legacy.LegacyIdentityStore,
	permissionStore store.PermissionStore,
	logger log.Logger,
	tracer tracing.Tracer,
	reg prometheus.Registerer,
	cache cache.Cache,
) *Service {
	return &Service{
		store:           store.NewStore(sql, tracer),
		folderStore:     folderStore,
		permissionStore: permissionStore,
		identityStore:   identityStore,
		logger:          logger,
		tracer:          tracer,
		
---
[Medium] method List in pkg/services/authz/rbac/service.go:
func (s *Service) List(ctx context.Context, req *authzv1.ListRequest) (*authzv1.ListResponse, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.List"")
	defer span.End()
	ctxLogger := s.logger.FromContext(ctx)

	listReq, err := s.validateListRequest(ctx, req)
	if err != nil {
		ctxLogger.Error(""invalid request"", ""error"", err)
		s.metrics.requestCount.WithLabelValues(""true"", ""false"", req.GetVerb(), req.GetGroup(), req.GetResource()).Inc()
		return &authzv1.ListResponse{}, err
	}

---
[Medium] function TestService_getUserPermissions in pkg/services/authz/rbac/service_test.go:
func TestService_getUserPermissions(t *testing.T) {
	type testCase struct {
		name          string
		permissions   []accesscontrol.Permission
		cacheHit      bool
		expectedPerms map[string]bool
	}

	testCases := []testCase{
		{
			name: ""should return permissions from store if not in cache"",
			permissions: []accesscontrol.Permission{
				{Action: ""dashboards:read"", Scope: ""dashboards:uid:some_dashboard""},
			},
			cacheHit:      false,
			expectedPerms: map[string]bool{""dashboards:uid:some_das
---
[Medium] function userPermDenialCacheKey in pkg/services/authz/rbac/cache.go:
func userPermDenialCacheKey(namespace, userUID, action, name, parent string) string {
	return namespace + "".perm_"" + userUID + ""_"" + action + ""_"" + name + ""_"" + parent
}
---
[Medium] method getCachedIdentityPermissions in pkg/services/authz/rbac/service.go:
func (s *Service) getCachedIdentityPermissions(ctx context.Context, ns types.NamespaceInfo, idType types.IdentityType, userID, action string) (map[string]bool, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.getCachedIdentityPermissions"")
	defer span.End()

	switch idType {
	case types.TypeAnonymous:
		anonPermKey := anonymousPermCacheKey(ns.Value, action)
		if cached, ok := s.permCache.Get(ctx, anonPermKey); ok {
			return cached, nil
		}
		return nil, cache.ErrNotFound
	cas
---
[Medium] method getUserPermissions in pkg/services/authz/rbac/service.go:
func (s *Service) getUserPermissions(ctx context.Context, ns types.NamespaceInfo, userID, action string, actionSets []string) (map[string]bool, error) {
	ctx, span := s.tracer.Start(ctx, ""authz_direct_db.service.getUserPermissions"")
	defer span.End()

	userIdentifiers, err := s.GetUserIdentifiers(ctx, ns, userID)
	if err != nil {
		return nil, err
	}

	userPermKey := userPermCacheKey(ns.Value, userIdentifiers.UID, action)
	res, err, _ := s.sf.Do(userPermKey+""_getUserPermissions"", func() (interfa
---
[Medium] method Get in pkg/services/authz/rbac.go:
func (lc *NoopCache) Get(ctx context.Context, key string) ([]byte, error) {
	return nil, cache.ErrNotFound
}
---
[Medium] method Delete in pkg/services/authz/rbac.go:
func (lc *NoopCache) Delete(ctx context.Context, key string) error {
	return nil
}
---
[Medium] function TestService_CacheCheck in pkg/services/authz/rbac/service_test.go:
func TestService_CacheCheck(t *testing.T) {
	callingService := authn.NewAccessTokenAuthInfo(authn.Claims[authn.AccessTokenClaims]{
		Claims: jwt.Claims{
			Subject:  types.NewTypeID(types.TypeAccessPolicy, ""some-service""),
			Audience: []string{""authzservice""},
		},
		Rest: authn.AccessTokenClaims{Namespace: ""org-12""},
	})

	ctx := types.WithAuthInfo(context.Background(), callingService)
	userID := &store.UserIdentifiers{UID: ""test-uid"", ID: 1}

	t.Run(""Allow based on cached permissions"", func(t
---
[Medium] function TestService_CacheList in pkg/services/authz/rbac/service_test.go:
func TestService_CacheList(t *testing.T) {
	callingService := authn.NewAccessTokenAuthInfo(authn.Claims[authn.AccessTokenClaims]{
		Claims: jwt.Claims{
			Subject:  types.NewTypeID(types.TypeAccessPolicy, ""some-service""),
			Audience: []string{""authzservice""},
		},
		Rest: authn.AccessTokenClaims{Namespace: ""org-12""},
	})

	t.Run(""List based on cached permissions"", func(t *testing.T) {
		s := setupService()
		ctx := types.WithAuthInfo(context.Background(), callingService)
		userID := &store.User
---
[Medium] function newRBACClient in pkg/services/authz/rbac.go:
func newRBACClient(conn grpc.ClientConnInterface, tracer trace.Tracer) authlib.AccessClient {
	return authzlib.NewClient(
		conn,
		authzlib.WithCacheClientOption(cache.NewLocalCache(cache.Config{
			Expiry:          30 * time.Second,
			CleanupInterval: 2 * time.Minute,
		})),
		authzlib.WithTracerClientOption(tracer),
	)
}","setupService (High), ProvideAuthZClient (High), newRemoteRBACClient (High), getAnonymousPermissions (Medium), Set (Medium), Check (Medium), NewService (Medium), List (Medium), TestService_getUserPermissions (Medium), userPermDenialCacheKey (Medium), getCachedIdentityPermissions (Medium), getUserPermissions (Medium), Get (Medium), Delete (Medium), TestService_CacheCheck (Medium), TestService_CacheList (Medium), newRBACClient (Medium)",match,'cached' matches entity 'getcachedidentitypermissions'
grafana,1,Anonymous: Add configurable device limit,Race condition: Multiple concurrent requests could pass the device count check simultaneously and create devices beyond the limit. Consider using a database transaction or lock.,High,17,10,7,"interface::GrafanaConfig (packages/grafana-data/src/types/config.ts) [Critical, score=1.00] | class::GrafanaBootConfig (packages/grafana-runtime/src/config.ts) [Critical, score=0.83] | function::ProvideAnonymousDeviceService (pkg/services/anonymous/anonimpl/impl.go) [Critical, score=0.71] | method::CreateOrUpdateDevice (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.69] | function::ProvideAnonDBStore (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.66] | method::TagDevice (pkg/services/anonymous/anonimpl/impl.go) [High, score=0.66] | method::getFrontendSettings (pkg/api/frontendsettings.go) [High, score=0.65] | function::readAuthSettings (pkg/setting/setting.go) [High, score=0.58] | field::anonymousDeviceLimit (packages/grafana-runtime/src/config.ts) [High, score=0.56] | method::ListDevices (pkg/services/anonymous/anonimpl/api/api.go) [High, score=0.53]","[Critical] interface GrafanaConfig in packages/grafana-data/src/types/config.ts:
interface GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled: boolean;
  datasources: { [str: string]: DataSourceInstanceSettings };
  panels: { [key: string]: PanelPluginMeta };
  auth: AuthSettings;
  minRefreshInterval: string;
  appSubUrl: string;
  windowTitlePrefix: string;
  buildInfo: BuildInfo;
  newPanelTitle: string;
  bootData: BootData;
  externalUserMngLinkUrl: string;
  externalUserMngLinkName: string;
  externalUserMngInfo: string;
  allowOrgCreate: boolean;
  disableLoginForm: boolean;
  defaultDatasource: string;
  alertingEnabled: boolean;
  alertingErrorOrTimeout: string;
  alertingNoDataOrNullValues: string;
  alertingMinInterval: number;
  authProxyEnabled: boolean;
  exploreEnabled: boolean;
  queryHistoryEnabled: boolean;
  helpEnabled: boolean
---
[Critical] class GrafanaBootConfig in packages/grafana-runtime/src/config.ts:
class GrafanaBootConfig implements GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled = true;
  datasources: { [str: string]: DataSourceInstanceSettings } = {};
  panels: { [key: string]: PanelPluginMeta } = {};
  apps: Record<string, AppPluginConfig> = {};
  auth: AuthSettings = {};
  minRefreshInterval = '';
  appUrl = '';
  appSubUrl = '';
  namespace = 'default';
  windowTitlePrefix = '';
  buildInfo: BuildInfo;
  newPanelTitle = '';
  bootData: BootData;
  externalUserMngLinkUrl = '';
  externalUserMngLinkName = '';
  externalUserMngInfo = '';
  allowOrgCreate = false;
  feedbackLinksEnabled = true;
  disableLoginForm = false;
  defaultDatasource = ''; // UID
  alertingEnabled = false;
  alertingErrorOrTimeout = '';
  alertingNoDataOrNullValues = '';
  alertingMi
---
[Critical] function ProvideAnonymousDeviceService in pkg/services/anonymous/anonimpl/impl.go:
func ProvideAnonymousDeviceService(usageStats usagestats.Service, authBroker authn.Service,
	sqlStore db.DB, cfg *setting.Cfg, orgService org.Service,
	serverLockService *serverlock.ServerLockService, accesscontrol accesscontrol.AccessControl, routeRegister routing.RouteRegister,
) *AnonDeviceService {
	a := &AnonDeviceService{
		log:        log.New(""anonymous-session-service""),
		localCache: localcache.New(29*time.Minute, 15*time.Minute),
		anonStore:  anonstore.ProvideAnonDBStore(sqlStore, cfg.AnonymousDeviceLimit),
		serverLock: serverLockService,
	}

	usageStats.RegisterMetricsFunc(a.usageStatFn)

	anonClient := &Anonymous{
		cfg:               cfg,
		log:               log.New(""authn.anonymous""),
		orgService:        orgService,
		anonDeviceService: a,
	}

	if anonClient.cfg.Anonymous
---
[High] method CreateOrUpdateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) CreateOrUpdateDevice(ctx context.Context, device *Device) error {
	var query string

	// if device limit is reached, only update devices
	if s.deviceLimit > 0 {
		count, err := s.CountDevices(ctx, time.Now().UTC().Add(-anonymousDeviceExpiration), time.Now().UTC().Add(time.Minute))
		if err != nil {
			return err
		}

		if count >= s.deviceLimit {
			return s.updateDevice(ctx, device)
		}
	}

	args := []any{device.DeviceID, device.ClientIP, device.UserAgent,
		device.CreatedAt.UTC(), device.UpdatedAt.UTC()}
	switch s.sqlStore.GetDBType() {
	case migrator.Postgres:
		query = `INSERT INTO anon_device (device_id, client_ip, user_agent, created_at, updated_at)
VALUES ($1, $2, $3, $4, $5)
ON CONFLICT (device_id) DO UPDATE SET
client_ip = $2,
user_agent = $3,
updated_at = $5
---
[High] function ProvideAnonDBStore in pkg/services/anonymous/anonimpl/anonstore/database.go:
func ProvideAnonDBStore(sqlStore db.DB, deviceLimit int64) *AnonDBStore {
	return &AnonDBStore{sqlStore: sqlStore, log: log.New(""anonstore""), deviceLimit: deviceLimit}
}
---
[High] method TagDevice in pkg/services/anonymous/anonimpl/impl.go:
func (a *AnonDeviceService) TagDevice(ctx context.Context, httpReq *http.Request, kind anonymous.DeviceKind) error {
	deviceID := httpReq.Header.Get(deviceIDHeader)
	if deviceID == """" {
		return nil
	}

	addr := web.RemoteAddr(httpReq)
	ip, err := network.GetIPFromAddress(addr)
	if err != nil {
		a.log.Debug(""Failed to parse ip from address"", ""addr"", addr)
		return nil
	}

	clientIPStr := ip.String()
	if len(ip) == 0 {
		clientIPStr = """"
	}

	taggedDevice := &anonstore.Device{
		DeviceID:  deviceID,
		ClientIP:  clientIPStr,
		UserAgent: httpReq.UserAgent(),
		CreatedAt: time.Now(),
		UpdatedAt: time.Now(),
	}

	err = a.tagDeviceUI(ctx, httpReq, taggedDevice)
	if err != nil {
		a.log.Debug(""Failed to tag device for UI"", ""error"", err)
		return err
	}

	return nil
}
---
[High] method getFrontendSettings in pkg/api/frontendsettings.go:
func (hs *HTTPServer) getFrontendSettings(c *contextmodel.ReqContext) (*dtos.FrontendSettingsDTO, error) {
	availablePlugins, err := hs.availablePlugins(c.Req.Context(), c.SignedInUser.GetOrgID())
	if err != nil {
		return nil, err
	}

	apps := make(map[string]*plugins.AppDTO, 0)
	for _, ap := range availablePlugins[plugins.TypeApp] {
		apps[ap.Plugin.ID] = newAppDTO(
			ap.Plugin,
			ap.Settings,
		)
	}

	dataSources, err := hs.getFSDataSources(c, availablePlugins)
	if err != nil {
		return nil, err
	}

	defaultDS := ""-- Grafana --""
	for n, ds := range dataSources {
		if ds.IsDefault {
			defaultDS = n
		}
	}

	panels := make(map[string]plugins.PanelDTO)
	for _, ap := range availablePlugins[plugins.TypePanel] {
		panel := ap.Plugin
		if panel.State == plugins.ReleaseStateAlpha && !hs.Cfg.
---
[High] function readAuthSettings in pkg/setting/setting.go:
func readAuthSettings(iniFile *ini.File, cfg *Cfg) (err error) {
	auth := iniFile.Section(""auth"")

	cfg.LoginCookieName = valueAsString(auth, ""login_cookie_name"", ""grafana_session"")
	const defaultMaxInactiveLifetime = ""7d""
	maxInactiveDurationVal := valueAsString(auth, ""login_maximum_inactive_lifetime_duration"", defaultMaxInactiveLifetime)
	cfg.LoginMaxInactiveLifetime, err = gtime.ParseDuration(maxInactiveDurationVal)
	if err != nil {
		return err
	}

	cfg.OAuthAllowInsecureEmailLookup = auth.Key(""oauth_allow_insecure_email_lookup"").MustBool(false)

	const defaultMaxLifetime = ""30d""
	maxLifetimeDurationVal := valueAsString(auth, ""login_maximum_lifetime_duration"", defaultMaxLifetime)
	cfg.LoginMaxLifetime, err = gtime.ParseDuration(maxLifetimeDurationVal)
	if err != nil {
		return err
	}


---
[High] field anonymousDeviceLimit in packages/grafana-runtime/src/config.ts:
anonymousDeviceLimit = undefined
---
[High] method ListDevices in pkg/services/anonymous/anonimpl/api/api.go:
func (api *AnonDeviceServiceAPI) ListDevices(c *contextmodel.ReqContext) response.Response {
	fromTime := time.Now().Add(-anonymousDeviceExpiration)
	toTime := time.Now()

	devices, err := api.store.ListDevices(c.Req.Context(), &fromTime, &toTime)
	if err != nil {
		return response.ErrOrFallback(http.StatusInternalServerError, ""Failed to list devices"", err)
	}

	// convert to response format
	resDevices := make([]*deviceDTO, 0, len(devices))
	for _, device := range devices {
		resDevices = append(resDevices, &deviceDTO{
			Device:     *device,
			LastSeenAt: util.GetAgeString(device.UpdatedAt),
			AvatarUrl:  dtos.GetGravatarUrl(device.DeviceID),
		})
	}

	return response.JSON(http.StatusOK, resDevices)
}","[Medium] function TestIntegrationAnonStore_DeleteDevicesOlderThan in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevicesOlderThan(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time
---
[Medium] function TestIntegrationAnonStore_DeleteDevice in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevice(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	from := time.Now().Add(-2 * keepFor)
	to := time.Now()

	count, err
---
[Medium] method Authenticate in pkg/services/anonymous/anonimpl/client.go:
func (a *Anonymous) Authenticate(ctx context.Context, r *authn.Request) (*authn.Identity, error) {
	o, err := a.orgService.GetByName(ctx, &org.GetOrgByNameQuery{Name: a.cfg.AnonymousOrgName})
	if err != nil {
		a.log.FromContext(ctx).Error(""Failed to find organization"", ""name"", a.cfg.AnonymousOrgName, ""error"", err)
		return nil, err
	}

	httpReqCopy := &http.Request{}
	if r.HTTPRequest != nil && r.HTTPRequest.Header != nil {
		// avoid r.HTTPRequest.Clone(context.Background()) as we do not requi
---
[Medium] function TestIntegrationDeviceService_tag in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationDeviceService_tag(t *testing.T) {
	type tagReq struct {
		httpReq *http.Request
		kind    anonymous.DeviceKind
	}
	testCases := []struct {
		name                string
		req                 []tagReq
		expectedAnonUICount int64
		expectedKey         string
		expectedDevice      *anonstore.Device
	}{
		{
			name: ""no requests"",
			req:  []tagReq{{httpReq: &http.Request{}, kind: anonymous.AnonDeviceUI}},
		},
		{
			name: ""missing info should not tag"",
			req: []tagReq{{httpReq:
---
[Medium] function TestIntegrationAnonDeviceService_localCacheSafety in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationAnonDeviceService_localCacheSafety(t *testing.T) {
	store := db.InitTestDB(t)
	anonService := ProvideAnonymousDeviceService(&usagestats.UsageStatsMock{},
		&authntest.FakeService{}, store, setting.NewCfg(), orgtest.NewOrgServiceFake(), nil, actest.FakeAccessControl{}, &routing.RouteRegisterImpl{})

	req := &http.Request{
		Header: http.Header{
			""User-Agent"":                            []string{""test""},
			""X-Forwarded-For"":                       []string{""10.30.30.2""},
			h
---
[Medium] function TestIntegrationBeyondDeviceLimit in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationBeyondDeviceLimit(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 1)

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time.Now().Add(-time.Hour)

	err = anonDBStore.CreateOrUpdateDevice(co
---
[Medium] method updateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) updateDevice(ctx context.Context, device *Device) error {
	const query = `UPDATE anon_device SET
client_ip = ?,
user_agent = ?,
updated_at = ?
WHERE device_id = ? AND updated_at BETWEEN ? AND ?`

	args := []interface{}{device.ClientIP, device.UserAgent, device.UpdatedAt.UTC(), device.DeviceID,
		device.UpdatedAt.UTC().Add(-anonymousDeviceExpiration), device.UpdatedAt.UTC().Add(time.Minute),
	}
	err := s.sqlStore.WithDbSession(ctx, func(dbSession *sqlstore.DBSession) error {","GrafanaConfig (Critical), GrafanaBootConfig (Critical), ProvideAnonymousDeviceService (Critical), CreateOrUpdateDevice (High), ProvideAnonDBStore (High), TagDevice (High), getFrontendSettings (High), readAuthSettings (High), anonymousDeviceLimit (High), ListDevices (High), TestIntegrationAnonStore_DeleteDevicesOlderThan (Medium), TestIntegrationAnonStore_DeleteDevice (Medium), Authenticate (Medium), TestIntegrationDeviceService_tag (Medium), TestIntegrationAnonDeviceService_localCacheSafety (Medium), TestIntegrationBeyondDeviceLimit (Medium), updateDevice (Medium)",match,'device' matches HC entity 'anonymousdevicelimit'
grafana,1,Anonymous: Add configurable device limit,"Anonymous authentication now fails entirely if anonDeviceService.TagDevice returns ErrDeviceLimitReached. Previously, device tagging was asynchronous and non-blocking. This change prevents anonymous users from authenticating when the device limit is reached.",Medium,17,10,7,"interface::GrafanaConfig (packages/grafana-data/src/types/config.ts) [Critical, score=1.00] | class::GrafanaBootConfig (packages/grafana-runtime/src/config.ts) [Critical, score=0.83] | function::ProvideAnonymousDeviceService (pkg/services/anonymous/anonimpl/impl.go) [Critical, score=0.71] | method::CreateOrUpdateDevice (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.69] | function::ProvideAnonDBStore (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.66] | method::TagDevice (pkg/services/anonymous/anonimpl/impl.go) [High, score=0.66] | method::getFrontendSettings (pkg/api/frontendsettings.go) [High, score=0.65] | function::readAuthSettings (pkg/setting/setting.go) [High, score=0.58] | field::anonymousDeviceLimit (packages/grafana-runtime/src/config.ts) [High, score=0.56] | method::ListDevices (pkg/services/anonymous/anonimpl/api/api.go) [High, score=0.53]","[Critical] interface GrafanaConfig in packages/grafana-data/src/types/config.ts:
interface GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled: boolean;
  datasources: { [str: string]: DataSourceInstanceSettings };
  panels: { [key: string]: PanelPluginMeta };
  auth: AuthSettings;
  minRefreshInterval: string;
  appSubUrl: string;
  windowTitlePrefix: string;
  buildInfo: BuildInfo;
  newPanelTitle: string;
  bootData: BootData;
  externalUserMngLinkUrl: string;
  externalUserMngLinkName: string;
  externalUserMngInfo: string;
  allowOrgCreate: boolean;
  disableLoginForm: boolean;
  defaultDatasource: string;
  alertingEnabled: boolean;
  alertingErrorOrTimeout: string;
  alertingNoDataOrNullValues: string;
  alertingMinInterval: number;
  authProxyEnabled: boolean;
  exploreEnabled: boolean;
  queryHistoryEnabled: boolean;
  helpEnabled: boolean
---
[Critical] class GrafanaBootConfig in packages/grafana-runtime/src/config.ts:
class GrafanaBootConfig implements GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled = true;
  datasources: { [str: string]: DataSourceInstanceSettings } = {};
  panels: { [key: string]: PanelPluginMeta } = {};
  apps: Record<string, AppPluginConfig> = {};
  auth: AuthSettings = {};
  minRefreshInterval = '';
  appUrl = '';
  appSubUrl = '';
  namespace = 'default';
  windowTitlePrefix = '';
  buildInfo: BuildInfo;
  newPanelTitle = '';
  bootData: BootData;
  externalUserMngLinkUrl = '';
  externalUserMngLinkName = '';
  externalUserMngInfo = '';
  allowOrgCreate = false;
  feedbackLinksEnabled = true;
  disableLoginForm = false;
  defaultDatasource = ''; // UID
  alertingEnabled = false;
  alertingErrorOrTimeout = '';
  alertingNoDataOrNullValues = '';
  alertingMi
---
[Critical] function ProvideAnonymousDeviceService in pkg/services/anonymous/anonimpl/impl.go:
func ProvideAnonymousDeviceService(usageStats usagestats.Service, authBroker authn.Service,
	sqlStore db.DB, cfg *setting.Cfg, orgService org.Service,
	serverLockService *serverlock.ServerLockService, accesscontrol accesscontrol.AccessControl, routeRegister routing.RouteRegister,
) *AnonDeviceService {
	a := &AnonDeviceService{
		log:        log.New(""anonymous-session-service""),
		localCache: localcache.New(29*time.Minute, 15*time.Minute),
		anonStore:  anonstore.ProvideAnonDBStore(sqlStore, cfg.AnonymousDeviceLimit),
		serverLock: serverLockService,
	}

	usageStats.RegisterMetricsFunc(a.usageStatFn)

	anonClient := &Anonymous{
		cfg:               cfg,
		log:               log.New(""authn.anonymous""),
		orgService:        orgService,
		anonDeviceService: a,
	}

	if anonClient.cfg.Anonymous
---
[High] method CreateOrUpdateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) CreateOrUpdateDevice(ctx context.Context, device *Device) error {
	var query string

	// if device limit is reached, only update devices
	if s.deviceLimit > 0 {
		count, err := s.CountDevices(ctx, time.Now().UTC().Add(-anonymousDeviceExpiration), time.Now().UTC().Add(time.Minute))
		if err != nil {
			return err
		}

		if count >= s.deviceLimit {
			return s.updateDevice(ctx, device)
		}
	}

	args := []any{device.DeviceID, device.ClientIP, device.UserAgent,
		device.CreatedAt.UTC(), device.UpdatedAt.UTC()}
	switch s.sqlStore.GetDBType() {
	case migrator.Postgres:
		query = `INSERT INTO anon_device (device_id, client_ip, user_agent, created_at, updated_at)
VALUES ($1, $2, $3, $4, $5)
ON CONFLICT (device_id) DO UPDATE SET
client_ip = $2,
user_agent = $3,
updated_at = $5
---
[High] function ProvideAnonDBStore in pkg/services/anonymous/anonimpl/anonstore/database.go:
func ProvideAnonDBStore(sqlStore db.DB, deviceLimit int64) *AnonDBStore {
	return &AnonDBStore{sqlStore: sqlStore, log: log.New(""anonstore""), deviceLimit: deviceLimit}
}
---
[High] method TagDevice in pkg/services/anonymous/anonimpl/impl.go:
func (a *AnonDeviceService) TagDevice(ctx context.Context, httpReq *http.Request, kind anonymous.DeviceKind) error {
	deviceID := httpReq.Header.Get(deviceIDHeader)
	if deviceID == """" {
		return nil
	}

	addr := web.RemoteAddr(httpReq)
	ip, err := network.GetIPFromAddress(addr)
	if err != nil {
		a.log.Debug(""Failed to parse ip from address"", ""addr"", addr)
		return nil
	}

	clientIPStr := ip.String()
	if len(ip) == 0 {
		clientIPStr = """"
	}

	taggedDevice := &anonstore.Device{
		DeviceID:  deviceID,
		ClientIP:  clientIPStr,
		UserAgent: httpReq.UserAgent(),
		CreatedAt: time.Now(),
		UpdatedAt: time.Now(),
	}

	err = a.tagDeviceUI(ctx, httpReq, taggedDevice)
	if err != nil {
		a.log.Debug(""Failed to tag device for UI"", ""error"", err)
		return err
	}

	return nil
}
---
[High] method getFrontendSettings in pkg/api/frontendsettings.go:
func (hs *HTTPServer) getFrontendSettings(c *contextmodel.ReqContext) (*dtos.FrontendSettingsDTO, error) {
	availablePlugins, err := hs.availablePlugins(c.Req.Context(), c.SignedInUser.GetOrgID())
	if err != nil {
		return nil, err
	}

	apps := make(map[string]*plugins.AppDTO, 0)
	for _, ap := range availablePlugins[plugins.TypeApp] {
		apps[ap.Plugin.ID] = newAppDTO(
			ap.Plugin,
			ap.Settings,
		)
	}

	dataSources, err := hs.getFSDataSources(c, availablePlugins)
	if err != nil {
		return nil, err
	}

	defaultDS := ""-- Grafana --""
	for n, ds := range dataSources {
		if ds.IsDefault {
			defaultDS = n
		}
	}

	panels := make(map[string]plugins.PanelDTO)
	for _, ap := range availablePlugins[plugins.TypePanel] {
		panel := ap.Plugin
		if panel.State == plugins.ReleaseStateAlpha && !hs.Cfg.
---
[High] function readAuthSettings in pkg/setting/setting.go:
func readAuthSettings(iniFile *ini.File, cfg *Cfg) (err error) {
	auth := iniFile.Section(""auth"")

	cfg.LoginCookieName = valueAsString(auth, ""login_cookie_name"", ""grafana_session"")
	const defaultMaxInactiveLifetime = ""7d""
	maxInactiveDurationVal := valueAsString(auth, ""login_maximum_inactive_lifetime_duration"", defaultMaxInactiveLifetime)
	cfg.LoginMaxInactiveLifetime, err = gtime.ParseDuration(maxInactiveDurationVal)
	if err != nil {
		return err
	}

	cfg.OAuthAllowInsecureEmailLookup = auth.Key(""oauth_allow_insecure_email_lookup"").MustBool(false)

	const defaultMaxLifetime = ""30d""
	maxLifetimeDurationVal := valueAsString(auth, ""login_maximum_lifetime_duration"", defaultMaxLifetime)
	cfg.LoginMaxLifetime, err = gtime.ParseDuration(maxLifetimeDurationVal)
	if err != nil {
		return err
	}


---
[High] field anonymousDeviceLimit in packages/grafana-runtime/src/config.ts:
anonymousDeviceLimit = undefined
---
[High] method ListDevices in pkg/services/anonymous/anonimpl/api/api.go:
func (api *AnonDeviceServiceAPI) ListDevices(c *contextmodel.ReqContext) response.Response {
	fromTime := time.Now().Add(-anonymousDeviceExpiration)
	toTime := time.Now()

	devices, err := api.store.ListDevices(c.Req.Context(), &fromTime, &toTime)
	if err != nil {
		return response.ErrOrFallback(http.StatusInternalServerError, ""Failed to list devices"", err)
	}

	// convert to response format
	resDevices := make([]*deviceDTO, 0, len(devices))
	for _, device := range devices {
		resDevices = append(resDevices, &deviceDTO{
			Device:     *device,
			LastSeenAt: util.GetAgeString(device.UpdatedAt),
			AvatarUrl:  dtos.GetGravatarUrl(device.DeviceID),
		})
	}

	return response.JSON(http.StatusOK, resDevices)
}","[Medium] function TestIntegrationAnonStore_DeleteDevicesOlderThan in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevicesOlderThan(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time
---
[Medium] function TestIntegrationAnonStore_DeleteDevice in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevice(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	from := time.Now().Add(-2 * keepFor)
	to := time.Now()

	count, err
---
[Medium] method Authenticate in pkg/services/anonymous/anonimpl/client.go:
func (a *Anonymous) Authenticate(ctx context.Context, r *authn.Request) (*authn.Identity, error) {
	o, err := a.orgService.GetByName(ctx, &org.GetOrgByNameQuery{Name: a.cfg.AnonymousOrgName})
	if err != nil {
		a.log.FromContext(ctx).Error(""Failed to find organization"", ""name"", a.cfg.AnonymousOrgName, ""error"", err)
		return nil, err
	}

	httpReqCopy := &http.Request{}
	if r.HTTPRequest != nil && r.HTTPRequest.Header != nil {
		// avoid r.HTTPRequest.Clone(context.Background()) as we do not requi
---
[Medium] function TestIntegrationDeviceService_tag in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationDeviceService_tag(t *testing.T) {
	type tagReq struct {
		httpReq *http.Request
		kind    anonymous.DeviceKind
	}
	testCases := []struct {
		name                string
		req                 []tagReq
		expectedAnonUICount int64
		expectedKey         string
		expectedDevice      *anonstore.Device
	}{
		{
			name: ""no requests"",
			req:  []tagReq{{httpReq: &http.Request{}, kind: anonymous.AnonDeviceUI}},
		},
		{
			name: ""missing info should not tag"",
			req: []tagReq{{httpReq:
---
[Medium] function TestIntegrationAnonDeviceService_localCacheSafety in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationAnonDeviceService_localCacheSafety(t *testing.T) {
	store := db.InitTestDB(t)
	anonService := ProvideAnonymousDeviceService(&usagestats.UsageStatsMock{},
		&authntest.FakeService{}, store, setting.NewCfg(), orgtest.NewOrgServiceFake(), nil, actest.FakeAccessControl{}, &routing.RouteRegisterImpl{})

	req := &http.Request{
		Header: http.Header{
			""User-Agent"":                            []string{""test""},
			""X-Forwarded-For"":                       []string{""10.30.30.2""},
			h
---
[Medium] function TestIntegrationBeyondDeviceLimit in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationBeyondDeviceLimit(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 1)

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time.Now().Add(-time.Hour)

	err = anonDBStore.CreateOrUpdateDevice(co
---
[Medium] method updateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) updateDevice(ctx context.Context, device *Device) error {
	const query = `UPDATE anon_device SET
client_ip = ?,
user_agent = ?,
updated_at = ?
WHERE device_id = ? AND updated_at BETWEEN ? AND ?`

	args := []interface{}{device.ClientIP, device.UserAgent, device.UpdatedAt.UTC(), device.DeviceID,
		device.UpdatedAt.UTC().Add(-anonymousDeviceExpiration), device.UpdatedAt.UTC().Add(time.Minute),
	}
	err := s.sqlStore.WithDbSession(ctx, func(dbSession *sqlstore.DBSession) error {","GrafanaConfig (Critical), GrafanaBootConfig (Critical), ProvideAnonymousDeviceService (Critical), CreateOrUpdateDevice (High), ProvideAnonDBStore (High), TagDevice (High), getFrontendSettings (High), readAuthSettings (High), anonymousDeviceLimit (High), ListDevices (High), TestIntegrationAnonStore_DeleteDevicesOlderThan (Medium), TestIntegrationAnonStore_DeleteDevice (Medium), Authenticate (Medium), TestIntegrationDeviceService_tag (Medium), TestIntegrationAnonDeviceService_localCacheSafety (Medium), TestIntegrationBeyondDeviceLimit (Medium), updateDevice (Medium)",match,'device' matches HC entity 'anonymousdevicelimit'
grafana,1,Anonymous: Add configurable device limit,"This call wonâ€™t compile: dbSession.Exec(args...) is given a []interface{} where the first element is the query, but Execâ€™s signature requires a first parameter of type string (not an interface{} splat).",Medium,17,10,7,"interface::GrafanaConfig (packages/grafana-data/src/types/config.ts) [Critical, score=1.00] | class::GrafanaBootConfig (packages/grafana-runtime/src/config.ts) [Critical, score=0.83] | function::ProvideAnonymousDeviceService (pkg/services/anonymous/anonimpl/impl.go) [Critical, score=0.71] | method::CreateOrUpdateDevice (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.69] | function::ProvideAnonDBStore (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.66] | method::TagDevice (pkg/services/anonymous/anonimpl/impl.go) [High, score=0.66] | method::getFrontendSettings (pkg/api/frontendsettings.go) [High, score=0.65] | function::readAuthSettings (pkg/setting/setting.go) [High, score=0.58] | field::anonymousDeviceLimit (packages/grafana-runtime/src/config.ts) [High, score=0.56] | method::ListDevices (pkg/services/anonymous/anonimpl/api/api.go) [High, score=0.53]","[Critical] interface GrafanaConfig in packages/grafana-data/src/types/config.ts:
interface GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled: boolean;
  datasources: { [str: string]: DataSourceInstanceSettings };
  panels: { [key: string]: PanelPluginMeta };
  auth: AuthSettings;
  minRefreshInterval: string;
  appSubUrl: string;
  windowTitlePrefix: string;
  buildInfo: BuildInfo;
  newPanelTitle: string;
  bootData: BootData;
  externalUserMngLinkUrl: string;
  externalUserMngLinkName: string;
  externalUserMngInfo: string;
  allowOrgCreate: boolean;
  disableLoginForm: boolean;
  defaultDatasource: string;
  alertingEnabled: boolean;
  alertingErrorOrTimeout: string;
  alertingNoDataOrNullValues: string;
  alertingMinInterval: number;
  authProxyEnabled: boolean;
  exploreEnabled: boolean;
  queryHistoryEnabled: boolean;
  helpEnabled: boolean
---
[Critical] class GrafanaBootConfig in packages/grafana-runtime/src/config.ts:
class GrafanaBootConfig implements GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled = true;
  datasources: { [str: string]: DataSourceInstanceSettings } = {};
  panels: { [key: string]: PanelPluginMeta } = {};
  apps: Record<string, AppPluginConfig> = {};
  auth: AuthSettings = {};
  minRefreshInterval = '';
  appUrl = '';
  appSubUrl = '';
  namespace = 'default';
  windowTitlePrefix = '';
  buildInfo: BuildInfo;
  newPanelTitle = '';
  bootData: BootData;
  externalUserMngLinkUrl = '';
  externalUserMngLinkName = '';
  externalUserMngInfo = '';
  allowOrgCreate = false;
  feedbackLinksEnabled = true;
  disableLoginForm = false;
  defaultDatasource = ''; // UID
  alertingEnabled = false;
  alertingErrorOrTimeout = '';
  alertingNoDataOrNullValues = '';
  alertingMi
---
[Critical] function ProvideAnonymousDeviceService in pkg/services/anonymous/anonimpl/impl.go:
func ProvideAnonymousDeviceService(usageStats usagestats.Service, authBroker authn.Service,
	sqlStore db.DB, cfg *setting.Cfg, orgService org.Service,
	serverLockService *serverlock.ServerLockService, accesscontrol accesscontrol.AccessControl, routeRegister routing.RouteRegister,
) *AnonDeviceService {
	a := &AnonDeviceService{
		log:        log.New(""anonymous-session-service""),
		localCache: localcache.New(29*time.Minute, 15*time.Minute),
		anonStore:  anonstore.ProvideAnonDBStore(sqlStore, cfg.AnonymousDeviceLimit),
		serverLock: serverLockService,
	}

	usageStats.RegisterMetricsFunc(a.usageStatFn)

	anonClient := &Anonymous{
		cfg:               cfg,
		log:               log.New(""authn.anonymous""),
		orgService:        orgService,
		anonDeviceService: a,
	}

	if anonClient.cfg.Anonymous
---
[High] method CreateOrUpdateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) CreateOrUpdateDevice(ctx context.Context, device *Device) error {
	var query string

	// if device limit is reached, only update devices
	if s.deviceLimit > 0 {
		count, err := s.CountDevices(ctx, time.Now().UTC().Add(-anonymousDeviceExpiration), time.Now().UTC().Add(time.Minute))
		if err != nil {
			return err
		}

		if count >= s.deviceLimit {
			return s.updateDevice(ctx, device)
		}
	}

	args := []any{device.DeviceID, device.ClientIP, device.UserAgent,
		device.CreatedAt.UTC(), device.UpdatedAt.UTC()}
	switch s.sqlStore.GetDBType() {
	case migrator.Postgres:
		query = `INSERT INTO anon_device (device_id, client_ip, user_agent, created_at, updated_at)
VALUES ($1, $2, $3, $4, $5)
ON CONFLICT (device_id) DO UPDATE SET
client_ip = $2,
user_agent = $3,
updated_at = $5
---
[High] function ProvideAnonDBStore in pkg/services/anonymous/anonimpl/anonstore/database.go:
func ProvideAnonDBStore(sqlStore db.DB, deviceLimit int64) *AnonDBStore {
	return &AnonDBStore{sqlStore: sqlStore, log: log.New(""anonstore""), deviceLimit: deviceLimit}
}
---
[High] method TagDevice in pkg/services/anonymous/anonimpl/impl.go:
func (a *AnonDeviceService) TagDevice(ctx context.Context, httpReq *http.Request, kind anonymous.DeviceKind) error {
	deviceID := httpReq.Header.Get(deviceIDHeader)
	if deviceID == """" {
		return nil
	}

	addr := web.RemoteAddr(httpReq)
	ip, err := network.GetIPFromAddress(addr)
	if err != nil {
		a.log.Debug(""Failed to parse ip from address"", ""addr"", addr)
		return nil
	}

	clientIPStr := ip.String()
	if len(ip) == 0 {
		clientIPStr = """"
	}

	taggedDevice := &anonstore.Device{
		DeviceID:  deviceID,
		ClientIP:  clientIPStr,
		UserAgent: httpReq.UserAgent(),
		CreatedAt: time.Now(),
		UpdatedAt: time.Now(),
	}

	err = a.tagDeviceUI(ctx, httpReq, taggedDevice)
	if err != nil {
		a.log.Debug(""Failed to tag device for UI"", ""error"", err)
		return err
	}

	return nil
}
---
[High] method getFrontendSettings in pkg/api/frontendsettings.go:
func (hs *HTTPServer) getFrontendSettings(c *contextmodel.ReqContext) (*dtos.FrontendSettingsDTO, error) {
	availablePlugins, err := hs.availablePlugins(c.Req.Context(), c.SignedInUser.GetOrgID())
	if err != nil {
		return nil, err
	}

	apps := make(map[string]*plugins.AppDTO, 0)
	for _, ap := range availablePlugins[plugins.TypeApp] {
		apps[ap.Plugin.ID] = newAppDTO(
			ap.Plugin,
			ap.Settings,
		)
	}

	dataSources, err := hs.getFSDataSources(c, availablePlugins)
	if err != nil {
		return nil, err
	}

	defaultDS := ""-- Grafana --""
	for n, ds := range dataSources {
		if ds.IsDefault {
			defaultDS = n
		}
	}

	panels := make(map[string]plugins.PanelDTO)
	for _, ap := range availablePlugins[plugins.TypePanel] {
		panel := ap.Plugin
		if panel.State == plugins.ReleaseStateAlpha && !hs.Cfg.
---
[High] function readAuthSettings in pkg/setting/setting.go:
func readAuthSettings(iniFile *ini.File, cfg *Cfg) (err error) {
	auth := iniFile.Section(""auth"")

	cfg.LoginCookieName = valueAsString(auth, ""login_cookie_name"", ""grafana_session"")
	const defaultMaxInactiveLifetime = ""7d""
	maxInactiveDurationVal := valueAsString(auth, ""login_maximum_inactive_lifetime_duration"", defaultMaxInactiveLifetime)
	cfg.LoginMaxInactiveLifetime, err = gtime.ParseDuration(maxInactiveDurationVal)
	if err != nil {
		return err
	}

	cfg.OAuthAllowInsecureEmailLookup = auth.Key(""oauth_allow_insecure_email_lookup"").MustBool(false)

	const defaultMaxLifetime = ""30d""
	maxLifetimeDurationVal := valueAsString(auth, ""login_maximum_lifetime_duration"", defaultMaxLifetime)
	cfg.LoginMaxLifetime, err = gtime.ParseDuration(maxLifetimeDurationVal)
	if err != nil {
		return err
	}


---
[High] field anonymousDeviceLimit in packages/grafana-runtime/src/config.ts:
anonymousDeviceLimit = undefined
---
[High] method ListDevices in pkg/services/anonymous/anonimpl/api/api.go:
func (api *AnonDeviceServiceAPI) ListDevices(c *contextmodel.ReqContext) response.Response {
	fromTime := time.Now().Add(-anonymousDeviceExpiration)
	toTime := time.Now()

	devices, err := api.store.ListDevices(c.Req.Context(), &fromTime, &toTime)
	if err != nil {
		return response.ErrOrFallback(http.StatusInternalServerError, ""Failed to list devices"", err)
	}

	// convert to response format
	resDevices := make([]*deviceDTO, 0, len(devices))
	for _, device := range devices {
		resDevices = append(resDevices, &deviceDTO{
			Device:     *device,
			LastSeenAt: util.GetAgeString(device.UpdatedAt),
			AvatarUrl:  dtos.GetGravatarUrl(device.DeviceID),
		})
	}

	return response.JSON(http.StatusOK, resDevices)
}","[Medium] function TestIntegrationAnonStore_DeleteDevicesOlderThan in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevicesOlderThan(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time
---
[Medium] function TestIntegrationAnonStore_DeleteDevice in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevice(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	from := time.Now().Add(-2 * keepFor)
	to := time.Now()

	count, err
---
[Medium] method Authenticate in pkg/services/anonymous/anonimpl/client.go:
func (a *Anonymous) Authenticate(ctx context.Context, r *authn.Request) (*authn.Identity, error) {
	o, err := a.orgService.GetByName(ctx, &org.GetOrgByNameQuery{Name: a.cfg.AnonymousOrgName})
	if err != nil {
		a.log.FromContext(ctx).Error(""Failed to find organization"", ""name"", a.cfg.AnonymousOrgName, ""error"", err)
		return nil, err
	}

	httpReqCopy := &http.Request{}
	if r.HTTPRequest != nil && r.HTTPRequest.Header != nil {
		// avoid r.HTTPRequest.Clone(context.Background()) as we do not requi
---
[Medium] function TestIntegrationDeviceService_tag in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationDeviceService_tag(t *testing.T) {
	type tagReq struct {
		httpReq *http.Request
		kind    anonymous.DeviceKind
	}
	testCases := []struct {
		name                string
		req                 []tagReq
		expectedAnonUICount int64
		expectedKey         string
		expectedDevice      *anonstore.Device
	}{
		{
			name: ""no requests"",
			req:  []tagReq{{httpReq: &http.Request{}, kind: anonymous.AnonDeviceUI}},
		},
		{
			name: ""missing info should not tag"",
			req: []tagReq{{httpReq:
---
[Medium] function TestIntegrationAnonDeviceService_localCacheSafety in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationAnonDeviceService_localCacheSafety(t *testing.T) {
	store := db.InitTestDB(t)
	anonService := ProvideAnonymousDeviceService(&usagestats.UsageStatsMock{},
		&authntest.FakeService{}, store, setting.NewCfg(), orgtest.NewOrgServiceFake(), nil, actest.FakeAccessControl{}, &routing.RouteRegisterImpl{})

	req := &http.Request{
		Header: http.Header{
			""User-Agent"":                            []string{""test""},
			""X-Forwarded-For"":                       []string{""10.30.30.2""},
			h
---
[Medium] function TestIntegrationBeyondDeviceLimit in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationBeyondDeviceLimit(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 1)

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time.Now().Add(-time.Hour)

	err = anonDBStore.CreateOrUpdateDevice(co
---
[Medium] method updateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) updateDevice(ctx context.Context, device *Device) error {
	const query = `UPDATE anon_device SET
client_ip = ?,
user_agent = ?,
updated_at = ?
WHERE device_id = ? AND updated_at BETWEEN ? AND ?`

	args := []interface{}{device.ClientIP, device.UserAgent, device.UpdatedAt.UTC(), device.DeviceID,
		device.UpdatedAt.UTC().Add(-anonymousDeviceExpiration), device.UpdatedAt.UTC().Add(time.Minute),
	}
	err := s.sqlStore.WithDbSession(ctx, func(dbSession *sqlstore.DBSession) error {","GrafanaConfig (Critical), GrafanaBootConfig (Critical), ProvideAnonymousDeviceService (Critical), CreateOrUpdateDevice (High), ProvideAnonDBStore (High), TagDevice (High), getFrontendSettings (High), readAuthSettings (High), anonymousDeviceLimit (High), ListDevices (High), TestIntegrationAnonStore_DeleteDevicesOlderThan (Medium), TestIntegrationAnonStore_DeleteDevice (Medium), Authenticate (Medium), TestIntegrationDeviceService_tag (Medium), TestIntegrationAnonDeviceService_localCacheSafety (Medium), TestIntegrationBeyondDeviceLimit (Medium), updateDevice (Medium)",partial,"HC entities exist (10) but no name match; golden idents: {'query', 'dbSession', 'compile', 'signature', 'args', 'interface', 'Exec', 'element', 'requires', 'splat', 'won', 'given'}"
grafana,1,Anonymous: Add configurable device limit,Returning ErrDeviceLimitReached when no rows were updated is misleading; the device might not exist.,Low,17,10,7,"interface::GrafanaConfig (packages/grafana-data/src/types/config.ts) [Critical, score=1.00] | class::GrafanaBootConfig (packages/grafana-runtime/src/config.ts) [Critical, score=0.83] | function::ProvideAnonymousDeviceService (pkg/services/anonymous/anonimpl/impl.go) [Critical, score=0.71] | method::CreateOrUpdateDevice (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.69] | function::ProvideAnonDBStore (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.66] | method::TagDevice (pkg/services/anonymous/anonimpl/impl.go) [High, score=0.66] | method::getFrontendSettings (pkg/api/frontendsettings.go) [High, score=0.65] | function::readAuthSettings (pkg/setting/setting.go) [High, score=0.58] | field::anonymousDeviceLimit (packages/grafana-runtime/src/config.ts) [High, score=0.56] | method::ListDevices (pkg/services/anonymous/anonimpl/api/api.go) [High, score=0.53]","[Critical] interface GrafanaConfig in packages/grafana-data/src/types/config.ts:
interface GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled: boolean;
  datasources: { [str: string]: DataSourceInstanceSettings };
  panels: { [key: string]: PanelPluginMeta };
  auth: AuthSettings;
  minRefreshInterval: string;
  appSubUrl: string;
  windowTitlePrefix: string;
  buildInfo: BuildInfo;
  newPanelTitle: string;
  bootData: BootData;
  externalUserMngLinkUrl: string;
  externalUserMngLinkName: string;
  externalUserMngInfo: string;
  allowOrgCreate: boolean;
  disableLoginForm: boolean;
  defaultDatasource: string;
  alertingEnabled: boolean;
  alertingErrorOrTimeout: string;
  alertingNoDataOrNullValues: string;
  alertingMinInterval: number;
  authProxyEnabled: boolean;
  exploreEnabled: boolean;
  queryHistoryEnabled: boolean;
  helpEnabled: boolean
---
[Critical] class GrafanaBootConfig in packages/grafana-runtime/src/config.ts:
class GrafanaBootConfig implements GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled = true;
  datasources: { [str: string]: DataSourceInstanceSettings } = {};
  panels: { [key: string]: PanelPluginMeta } = {};
  apps: Record<string, AppPluginConfig> = {};
  auth: AuthSettings = {};
  minRefreshInterval = '';
  appUrl = '';
  appSubUrl = '';
  namespace = 'default';
  windowTitlePrefix = '';
  buildInfo: BuildInfo;
  newPanelTitle = '';
  bootData: BootData;
  externalUserMngLinkUrl = '';
  externalUserMngLinkName = '';
  externalUserMngInfo = '';
  allowOrgCreate = false;
  feedbackLinksEnabled = true;
  disableLoginForm = false;
  defaultDatasource = ''; // UID
  alertingEnabled = false;
  alertingErrorOrTimeout = '';
  alertingNoDataOrNullValues = '';
  alertingMi
---
[Critical] function ProvideAnonymousDeviceService in pkg/services/anonymous/anonimpl/impl.go:
func ProvideAnonymousDeviceService(usageStats usagestats.Service, authBroker authn.Service,
	sqlStore db.DB, cfg *setting.Cfg, orgService org.Service,
	serverLockService *serverlock.ServerLockService, accesscontrol accesscontrol.AccessControl, routeRegister routing.RouteRegister,
) *AnonDeviceService {
	a := &AnonDeviceService{
		log:        log.New(""anonymous-session-service""),
		localCache: localcache.New(29*time.Minute, 15*time.Minute),
		anonStore:  anonstore.ProvideAnonDBStore(sqlStore, cfg.AnonymousDeviceLimit),
		serverLock: serverLockService,
	}

	usageStats.RegisterMetricsFunc(a.usageStatFn)

	anonClient := &Anonymous{
		cfg:               cfg,
		log:               log.New(""authn.anonymous""),
		orgService:        orgService,
		anonDeviceService: a,
	}

	if anonClient.cfg.Anonymous
---
[High] method CreateOrUpdateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) CreateOrUpdateDevice(ctx context.Context, device *Device) error {
	var query string

	// if device limit is reached, only update devices
	if s.deviceLimit > 0 {
		count, err := s.CountDevices(ctx, time.Now().UTC().Add(-anonymousDeviceExpiration), time.Now().UTC().Add(time.Minute))
		if err != nil {
			return err
		}

		if count >= s.deviceLimit {
			return s.updateDevice(ctx, device)
		}
	}

	args := []any{device.DeviceID, device.ClientIP, device.UserAgent,
		device.CreatedAt.UTC(), device.UpdatedAt.UTC()}
	switch s.sqlStore.GetDBType() {
	case migrator.Postgres:
		query = `INSERT INTO anon_device (device_id, client_ip, user_agent, created_at, updated_at)
VALUES ($1, $2, $3, $4, $5)
ON CONFLICT (device_id) DO UPDATE SET
client_ip = $2,
user_agent = $3,
updated_at = $5
---
[High] function ProvideAnonDBStore in pkg/services/anonymous/anonimpl/anonstore/database.go:
func ProvideAnonDBStore(sqlStore db.DB, deviceLimit int64) *AnonDBStore {
	return &AnonDBStore{sqlStore: sqlStore, log: log.New(""anonstore""), deviceLimit: deviceLimit}
}
---
[High] method TagDevice in pkg/services/anonymous/anonimpl/impl.go:
func (a *AnonDeviceService) TagDevice(ctx context.Context, httpReq *http.Request, kind anonymous.DeviceKind) error {
	deviceID := httpReq.Header.Get(deviceIDHeader)
	if deviceID == """" {
		return nil
	}

	addr := web.RemoteAddr(httpReq)
	ip, err := network.GetIPFromAddress(addr)
	if err != nil {
		a.log.Debug(""Failed to parse ip from address"", ""addr"", addr)
		return nil
	}

	clientIPStr := ip.String()
	if len(ip) == 0 {
		clientIPStr = """"
	}

	taggedDevice := &anonstore.Device{
		DeviceID:  deviceID,
		ClientIP:  clientIPStr,
		UserAgent: httpReq.UserAgent(),
		CreatedAt: time.Now(),
		UpdatedAt: time.Now(),
	}

	err = a.tagDeviceUI(ctx, httpReq, taggedDevice)
	if err != nil {
		a.log.Debug(""Failed to tag device for UI"", ""error"", err)
		return err
	}

	return nil
}
---
[High] method getFrontendSettings in pkg/api/frontendsettings.go:
func (hs *HTTPServer) getFrontendSettings(c *contextmodel.ReqContext) (*dtos.FrontendSettingsDTO, error) {
	availablePlugins, err := hs.availablePlugins(c.Req.Context(), c.SignedInUser.GetOrgID())
	if err != nil {
		return nil, err
	}

	apps := make(map[string]*plugins.AppDTO, 0)
	for _, ap := range availablePlugins[plugins.TypeApp] {
		apps[ap.Plugin.ID] = newAppDTO(
			ap.Plugin,
			ap.Settings,
		)
	}

	dataSources, err := hs.getFSDataSources(c, availablePlugins)
	if err != nil {
		return nil, err
	}

	defaultDS := ""-- Grafana --""
	for n, ds := range dataSources {
		if ds.IsDefault {
			defaultDS = n
		}
	}

	panels := make(map[string]plugins.PanelDTO)
	for _, ap := range availablePlugins[plugins.TypePanel] {
		panel := ap.Plugin
		if panel.State == plugins.ReleaseStateAlpha && !hs.Cfg.
---
[High] function readAuthSettings in pkg/setting/setting.go:
func readAuthSettings(iniFile *ini.File, cfg *Cfg) (err error) {
	auth := iniFile.Section(""auth"")

	cfg.LoginCookieName = valueAsString(auth, ""login_cookie_name"", ""grafana_session"")
	const defaultMaxInactiveLifetime = ""7d""
	maxInactiveDurationVal := valueAsString(auth, ""login_maximum_inactive_lifetime_duration"", defaultMaxInactiveLifetime)
	cfg.LoginMaxInactiveLifetime, err = gtime.ParseDuration(maxInactiveDurationVal)
	if err != nil {
		return err
	}

	cfg.OAuthAllowInsecureEmailLookup = auth.Key(""oauth_allow_insecure_email_lookup"").MustBool(false)

	const defaultMaxLifetime = ""30d""
	maxLifetimeDurationVal := valueAsString(auth, ""login_maximum_lifetime_duration"", defaultMaxLifetime)
	cfg.LoginMaxLifetime, err = gtime.ParseDuration(maxLifetimeDurationVal)
	if err != nil {
		return err
	}


---
[High] field anonymousDeviceLimit in packages/grafana-runtime/src/config.ts:
anonymousDeviceLimit = undefined
---
[High] method ListDevices in pkg/services/anonymous/anonimpl/api/api.go:
func (api *AnonDeviceServiceAPI) ListDevices(c *contextmodel.ReqContext) response.Response {
	fromTime := time.Now().Add(-anonymousDeviceExpiration)
	toTime := time.Now()

	devices, err := api.store.ListDevices(c.Req.Context(), &fromTime, &toTime)
	if err != nil {
		return response.ErrOrFallback(http.StatusInternalServerError, ""Failed to list devices"", err)
	}

	// convert to response format
	resDevices := make([]*deviceDTO, 0, len(devices))
	for _, device := range devices {
		resDevices = append(resDevices, &deviceDTO{
			Device:     *device,
			LastSeenAt: util.GetAgeString(device.UpdatedAt),
			AvatarUrl:  dtos.GetGravatarUrl(device.DeviceID),
		})
	}

	return response.JSON(http.StatusOK, resDevices)
}","[Medium] function TestIntegrationAnonStore_DeleteDevicesOlderThan in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevicesOlderThan(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time
---
[Medium] function TestIntegrationAnonStore_DeleteDevice in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevice(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	from := time.Now().Add(-2 * keepFor)
	to := time.Now()

	count, err
---
[Medium] method Authenticate in pkg/services/anonymous/anonimpl/client.go:
func (a *Anonymous) Authenticate(ctx context.Context, r *authn.Request) (*authn.Identity, error) {
	o, err := a.orgService.GetByName(ctx, &org.GetOrgByNameQuery{Name: a.cfg.AnonymousOrgName})
	if err != nil {
		a.log.FromContext(ctx).Error(""Failed to find organization"", ""name"", a.cfg.AnonymousOrgName, ""error"", err)
		return nil, err
	}

	httpReqCopy := &http.Request{}
	if r.HTTPRequest != nil && r.HTTPRequest.Header != nil {
		// avoid r.HTTPRequest.Clone(context.Background()) as we do not requi
---
[Medium] function TestIntegrationDeviceService_tag in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationDeviceService_tag(t *testing.T) {
	type tagReq struct {
		httpReq *http.Request
		kind    anonymous.DeviceKind
	}
	testCases := []struct {
		name                string
		req                 []tagReq
		expectedAnonUICount int64
		expectedKey         string
		expectedDevice      *anonstore.Device
	}{
		{
			name: ""no requests"",
			req:  []tagReq{{httpReq: &http.Request{}, kind: anonymous.AnonDeviceUI}},
		},
		{
			name: ""missing info should not tag"",
			req: []tagReq{{httpReq:
---
[Medium] function TestIntegrationAnonDeviceService_localCacheSafety in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationAnonDeviceService_localCacheSafety(t *testing.T) {
	store := db.InitTestDB(t)
	anonService := ProvideAnonymousDeviceService(&usagestats.UsageStatsMock{},
		&authntest.FakeService{}, store, setting.NewCfg(), orgtest.NewOrgServiceFake(), nil, actest.FakeAccessControl{}, &routing.RouteRegisterImpl{})

	req := &http.Request{
		Header: http.Header{
			""User-Agent"":                            []string{""test""},
			""X-Forwarded-For"":                       []string{""10.30.30.2""},
			h
---
[Medium] function TestIntegrationBeyondDeviceLimit in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationBeyondDeviceLimit(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 1)

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time.Now().Add(-time.Hour)

	err = anonDBStore.CreateOrUpdateDevice(co
---
[Medium] method updateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) updateDevice(ctx context.Context, device *Device) error {
	const query = `UPDATE anon_device SET
client_ip = ?,
user_agent = ?,
updated_at = ?
WHERE device_id = ? AND updated_at BETWEEN ? AND ?`

	args := []interface{}{device.ClientIP, device.UserAgent, device.UpdatedAt.UTC(), device.DeviceID,
		device.UpdatedAt.UTC().Add(-anonymousDeviceExpiration), device.UpdatedAt.UTC().Add(time.Minute),
	}
	err := s.sqlStore.WithDbSession(ctx, func(dbSession *sqlstore.DBSession) error {","GrafanaConfig (Critical), GrafanaBootConfig (Critical), ProvideAnonymousDeviceService (Critical), CreateOrUpdateDevice (High), ProvideAnonDBStore (High), TagDevice (High), getFrontendSettings (High), readAuthSettings (High), anonymousDeviceLimit (High), ListDevices (High), TestIntegrationAnonStore_DeleteDevicesOlderThan (Medium), TestIntegrationAnonStore_DeleteDevice (Medium), Authenticate (Medium), TestIntegrationDeviceService_tag (Medium), TestIntegrationAnonDeviceService_localCacheSafety (Medium), TestIntegrationBeyondDeviceLimit (Medium), updateDevice (Medium)",match,'updated' matches HC entity 'createorupdatedevice'
grafana,1,Anonymous: Add configurable device limit,Time window calculation inconsistency: Using device.UpdatedAt.UTC().Add(-anonymousDeviceExpiration) as the lower bound but device.UpdatedAt as the current time may not match the intended logic. Consider using time.Now().UTC() consistently.,Low,17,10,7,"interface::GrafanaConfig (packages/grafana-data/src/types/config.ts) [Critical, score=1.00] | class::GrafanaBootConfig (packages/grafana-runtime/src/config.ts) [Critical, score=0.83] | function::ProvideAnonymousDeviceService (pkg/services/anonymous/anonimpl/impl.go) [Critical, score=0.71] | method::CreateOrUpdateDevice (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.69] | function::ProvideAnonDBStore (pkg/services/anonymous/anonimpl/anonstore/database.go) [High, score=0.66] | method::TagDevice (pkg/services/anonymous/anonimpl/impl.go) [High, score=0.66] | method::getFrontendSettings (pkg/api/frontendsettings.go) [High, score=0.65] | function::readAuthSettings (pkg/setting/setting.go) [High, score=0.58] | field::anonymousDeviceLimit (packages/grafana-runtime/src/config.ts) [High, score=0.56] | method::ListDevices (pkg/services/anonymous/anonimpl/api/api.go) [High, score=0.53]","[Critical] interface GrafanaConfig in packages/grafana-data/src/types/config.ts:
interface GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled: boolean;
  datasources: { [str: string]: DataSourceInstanceSettings };
  panels: { [key: string]: PanelPluginMeta };
  auth: AuthSettings;
  minRefreshInterval: string;
  appSubUrl: string;
  windowTitlePrefix: string;
  buildInfo: BuildInfo;
  newPanelTitle: string;
  bootData: BootData;
  externalUserMngLinkUrl: string;
  externalUserMngLinkName: string;
  externalUserMngInfo: string;
  allowOrgCreate: boolean;
  disableLoginForm: boolean;
  defaultDatasource: string;
  alertingEnabled: boolean;
  alertingErrorOrTimeout: string;
  alertingNoDataOrNullValues: string;
  alertingMinInterval: number;
  authProxyEnabled: boolean;
  exploreEnabled: boolean;
  queryHistoryEnabled: boolean;
  helpEnabled: boolean
---
[Critical] class GrafanaBootConfig in packages/grafana-runtime/src/config.ts:
class GrafanaBootConfig implements GrafanaConfig {
  publicDashboardAccessToken?: string;
  snapshotEnabled = true;
  datasources: { [str: string]: DataSourceInstanceSettings } = {};
  panels: { [key: string]: PanelPluginMeta } = {};
  apps: Record<string, AppPluginConfig> = {};
  auth: AuthSettings = {};
  minRefreshInterval = '';
  appUrl = '';
  appSubUrl = '';
  namespace = 'default';
  windowTitlePrefix = '';
  buildInfo: BuildInfo;
  newPanelTitle = '';
  bootData: BootData;
  externalUserMngLinkUrl = '';
  externalUserMngLinkName = '';
  externalUserMngInfo = '';
  allowOrgCreate = false;
  feedbackLinksEnabled = true;
  disableLoginForm = false;
  defaultDatasource = ''; // UID
  alertingEnabled = false;
  alertingErrorOrTimeout = '';
  alertingNoDataOrNullValues = '';
  alertingMi
---
[Critical] function ProvideAnonymousDeviceService in pkg/services/anonymous/anonimpl/impl.go:
func ProvideAnonymousDeviceService(usageStats usagestats.Service, authBroker authn.Service,
	sqlStore db.DB, cfg *setting.Cfg, orgService org.Service,
	serverLockService *serverlock.ServerLockService, accesscontrol accesscontrol.AccessControl, routeRegister routing.RouteRegister,
) *AnonDeviceService {
	a := &AnonDeviceService{
		log:        log.New(""anonymous-session-service""),
		localCache: localcache.New(29*time.Minute, 15*time.Minute),
		anonStore:  anonstore.ProvideAnonDBStore(sqlStore, cfg.AnonymousDeviceLimit),
		serverLock: serverLockService,
	}

	usageStats.RegisterMetricsFunc(a.usageStatFn)

	anonClient := &Anonymous{
		cfg:               cfg,
		log:               log.New(""authn.anonymous""),
		orgService:        orgService,
		anonDeviceService: a,
	}

	if anonClient.cfg.Anonymous
---
[High] method CreateOrUpdateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) CreateOrUpdateDevice(ctx context.Context, device *Device) error {
	var query string

	// if device limit is reached, only update devices
	if s.deviceLimit > 0 {
		count, err := s.CountDevices(ctx, time.Now().UTC().Add(-anonymousDeviceExpiration), time.Now().UTC().Add(time.Minute))
		if err != nil {
			return err
		}

		if count >= s.deviceLimit {
			return s.updateDevice(ctx, device)
		}
	}

	args := []any{device.DeviceID, device.ClientIP, device.UserAgent,
		device.CreatedAt.UTC(), device.UpdatedAt.UTC()}
	switch s.sqlStore.GetDBType() {
	case migrator.Postgres:
		query = `INSERT INTO anon_device (device_id, client_ip, user_agent, created_at, updated_at)
VALUES ($1, $2, $3, $4, $5)
ON CONFLICT (device_id) DO UPDATE SET
client_ip = $2,
user_agent = $3,
updated_at = $5
---
[High] function ProvideAnonDBStore in pkg/services/anonymous/anonimpl/anonstore/database.go:
func ProvideAnonDBStore(sqlStore db.DB, deviceLimit int64) *AnonDBStore {
	return &AnonDBStore{sqlStore: sqlStore, log: log.New(""anonstore""), deviceLimit: deviceLimit}
}
---
[High] method TagDevice in pkg/services/anonymous/anonimpl/impl.go:
func (a *AnonDeviceService) TagDevice(ctx context.Context, httpReq *http.Request, kind anonymous.DeviceKind) error {
	deviceID := httpReq.Header.Get(deviceIDHeader)
	if deviceID == """" {
		return nil
	}

	addr := web.RemoteAddr(httpReq)
	ip, err := network.GetIPFromAddress(addr)
	if err != nil {
		a.log.Debug(""Failed to parse ip from address"", ""addr"", addr)
		return nil
	}

	clientIPStr := ip.String()
	if len(ip) == 0 {
		clientIPStr = """"
	}

	taggedDevice := &anonstore.Device{
		DeviceID:  deviceID,
		ClientIP:  clientIPStr,
		UserAgent: httpReq.UserAgent(),
		CreatedAt: time.Now(),
		UpdatedAt: time.Now(),
	}

	err = a.tagDeviceUI(ctx, httpReq, taggedDevice)
	if err != nil {
		a.log.Debug(""Failed to tag device for UI"", ""error"", err)
		return err
	}

	return nil
}
---
[High] method getFrontendSettings in pkg/api/frontendsettings.go:
func (hs *HTTPServer) getFrontendSettings(c *contextmodel.ReqContext) (*dtos.FrontendSettingsDTO, error) {
	availablePlugins, err := hs.availablePlugins(c.Req.Context(), c.SignedInUser.GetOrgID())
	if err != nil {
		return nil, err
	}

	apps := make(map[string]*plugins.AppDTO, 0)
	for _, ap := range availablePlugins[plugins.TypeApp] {
		apps[ap.Plugin.ID] = newAppDTO(
			ap.Plugin,
			ap.Settings,
		)
	}

	dataSources, err := hs.getFSDataSources(c, availablePlugins)
	if err != nil {
		return nil, err
	}

	defaultDS := ""-- Grafana --""
	for n, ds := range dataSources {
		if ds.IsDefault {
			defaultDS = n
		}
	}

	panels := make(map[string]plugins.PanelDTO)
	for _, ap := range availablePlugins[plugins.TypePanel] {
		panel := ap.Plugin
		if panel.State == plugins.ReleaseStateAlpha && !hs.Cfg.
---
[High] function readAuthSettings in pkg/setting/setting.go:
func readAuthSettings(iniFile *ini.File, cfg *Cfg) (err error) {
	auth := iniFile.Section(""auth"")

	cfg.LoginCookieName = valueAsString(auth, ""login_cookie_name"", ""grafana_session"")
	const defaultMaxInactiveLifetime = ""7d""
	maxInactiveDurationVal := valueAsString(auth, ""login_maximum_inactive_lifetime_duration"", defaultMaxInactiveLifetime)
	cfg.LoginMaxInactiveLifetime, err = gtime.ParseDuration(maxInactiveDurationVal)
	if err != nil {
		return err
	}

	cfg.OAuthAllowInsecureEmailLookup = auth.Key(""oauth_allow_insecure_email_lookup"").MustBool(false)

	const defaultMaxLifetime = ""30d""
	maxLifetimeDurationVal := valueAsString(auth, ""login_maximum_lifetime_duration"", defaultMaxLifetime)
	cfg.LoginMaxLifetime, err = gtime.ParseDuration(maxLifetimeDurationVal)
	if err != nil {
		return err
	}


---
[High] field anonymousDeviceLimit in packages/grafana-runtime/src/config.ts:
anonymousDeviceLimit = undefined
---
[High] method ListDevices in pkg/services/anonymous/anonimpl/api/api.go:
func (api *AnonDeviceServiceAPI) ListDevices(c *contextmodel.ReqContext) response.Response {
	fromTime := time.Now().Add(-anonymousDeviceExpiration)
	toTime := time.Now()

	devices, err := api.store.ListDevices(c.Req.Context(), &fromTime, &toTime)
	if err != nil {
		return response.ErrOrFallback(http.StatusInternalServerError, ""Failed to list devices"", err)
	}

	// convert to response format
	resDevices := make([]*deviceDTO, 0, len(devices))
	for _, device := range devices {
		resDevices = append(resDevices, &deviceDTO{
			Device:     *device,
			LastSeenAt: util.GetAgeString(device.UpdatedAt),
			AvatarUrl:  dtos.GetGravatarUrl(device.DeviceID),
		})
	}

	return response.JSON(http.StatusOK, resDevices)
}","[Medium] function TestIntegrationAnonStore_DeleteDevicesOlderThan in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevicesOlderThan(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time
---
[Medium] function TestIntegrationAnonStore_DeleteDevice in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationAnonStore_DeleteDevice(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 0)
	const keepFor = time.Hour * 24 * 61

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-keepFor).Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	from := time.Now().Add(-2 * keepFor)
	to := time.Now()

	count, err
---
[Medium] method Authenticate in pkg/services/anonymous/anonimpl/client.go:
func (a *Anonymous) Authenticate(ctx context.Context, r *authn.Request) (*authn.Identity, error) {
	o, err := a.orgService.GetByName(ctx, &org.GetOrgByNameQuery{Name: a.cfg.AnonymousOrgName})
	if err != nil {
		a.log.FromContext(ctx).Error(""Failed to find organization"", ""name"", a.cfg.AnonymousOrgName, ""error"", err)
		return nil, err
	}

	httpReqCopy := &http.Request{}
	if r.HTTPRequest != nil && r.HTTPRequest.Header != nil {
		// avoid r.HTTPRequest.Clone(context.Background()) as we do not requi
---
[Medium] function TestIntegrationDeviceService_tag in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationDeviceService_tag(t *testing.T) {
	type tagReq struct {
		httpReq *http.Request
		kind    anonymous.DeviceKind
	}
	testCases := []struct {
		name                string
		req                 []tagReq
		expectedAnonUICount int64
		expectedKey         string
		expectedDevice      *anonstore.Device
	}{
		{
			name: ""no requests"",
			req:  []tagReq{{httpReq: &http.Request{}, kind: anonymous.AnonDeviceUI}},
		},
		{
			name: ""missing info should not tag"",
			req: []tagReq{{httpReq:
---
[Medium] function TestIntegrationAnonDeviceService_localCacheSafety in pkg/services/anonymous/anonimpl/impl_test.go:
func TestIntegrationAnonDeviceService_localCacheSafety(t *testing.T) {
	store := db.InitTestDB(t)
	anonService := ProvideAnonymousDeviceService(&usagestats.UsageStatsMock{},
		&authntest.FakeService{}, store, setting.NewCfg(), orgtest.NewOrgServiceFake(), nil, actest.FakeAccessControl{}, &routing.RouteRegisterImpl{})

	req := &http.Request{
		Header: http.Header{
			""User-Agent"":                            []string{""test""},
			""X-Forwarded-For"":                       []string{""10.30.30.2""},
			h
---
[Medium] function TestIntegrationBeyondDeviceLimit in pkg/services/anonymous/anonimpl/anonstore/database_test.go:
func TestIntegrationBeyondDeviceLimit(t *testing.T) {
	store := db.InitTestDB(t)
	anonDBStore := ProvideAnonDBStore(store, 1)

	anonDevice := &Device{
		DeviceID:  ""32mdo31deeqwes"",
		ClientIP:  ""10.30.30.2"",
		UserAgent: ""test"",
		UpdatedAt: time.Now().Add(-time.Hour),
	}

	err := anonDBStore.CreateOrUpdateDevice(context.Background(), anonDevice)
	require.NoError(t, err)

	anonDevice.DeviceID = ""keep""
	anonDevice.UpdatedAt = time.Now().Add(-time.Hour)

	err = anonDBStore.CreateOrUpdateDevice(co
---
[Medium] method updateDevice in pkg/services/anonymous/anonimpl/anonstore/database.go:
func (s *AnonDBStore) updateDevice(ctx context.Context, device *Device) error {
	const query = `UPDATE anon_device SET
client_ip = ?,
user_agent = ?,
updated_at = ?
WHERE device_id = ? AND updated_at BETWEEN ? AND ?`

	args := []interface{}{device.ClientIP, device.UserAgent, device.UpdatedAt.UTC(), device.DeviceID,
		device.UpdatedAt.UTC().Add(-anonymousDeviceExpiration), device.UpdatedAt.UTC().Add(time.Minute),
	}
	err := s.sqlStore.WithDbSession(ctx, func(dbSession *sqlstore.DBSession) error {","GrafanaConfig (Critical), GrafanaBootConfig (Critical), ProvideAnonymousDeviceService (Critical), CreateOrUpdateDevice (High), ProvideAnonDBStore (High), TagDevice (High), getFrontendSettings (High), readAuthSettings (High), anonymousDeviceLimit (High), ListDevices (High), TestIntegrationAnonStore_DeleteDevicesOlderThan (Medium), TestIntegrationAnonStore_DeleteDevice (Medium), Authenticate (Medium), TestIntegrationDeviceService_tag (Medium), TestIntegrationAnonDeviceService_localCacheSafety (Medium), TestIntegrationBeyondDeviceLimit (Medium), updateDevice (Medium)",match,'device' matches HC entity 'anonymousdevicelimit'
sentry,22,feat(workflow_engine): Add in hook for producing occurrences from the stateful detector,"MetricAlertDetectorHandler inherits from StatefulDetectorHandler but only contains pass, failing to implement its required abstract methods: counter_names (property), get_dedupe_value(), get_group_key_values(), and build_occurrence_and_event_data(). This will cause a TypeError at runtime when the class is instantiated.",High,54,2,36,"function::Detector (src/sentry/workflow_engine/models/detector.py) [Critical, score=1.00] | function::process_detectors (src/sentry/workflow_engine/processors/detector.py) [Critical, score=0.70]","[Critical] function Detector in src/sentry/workflow_engine/models/detector.py:
@region_silo_model
class Detector(DefaultFieldsModel, OwnerModel):
    __relocation_scope__ = RelocationScope.Organization

    organization = FlexibleForeignKey(""sentry.Organization"")
    name = models.CharField(max_length=200)

    # The data sources that the detector is watching
    data_sources = models.ManyToManyField(
        ""workflow_engine.DataSource"", through=""workflow_engine.DataSourceDetector""
    )

    # The conditions that must be met for the detector to be considered 'active'
    # This will emit an event for the workflow to process
    workflow_condition_group = FlexibleForeignKey(
        ""workflow_engine.DataConditionGroup"",
        blank=True,
        null=True,
        unique=True,
        on_delete=models.SET_NULL,
    )
    type = models.CharField(max_length=200)

  
---
[Critical] function process_detectors in src/sentry/workflow_engine/processors/detector.py:
def process_detectors(
    data_packet: DataPacket, detectors: list[Detector]
) -> list[tuple[Detector, dict[DetectorGroupKey, DetectorEvaluationResult]]]:
    results = []

    for detector in detectors:
        handler = detector.detector_handler

        if not handler:
            continue

        detector_results = handler.evaluate(data_packet)

        for result in detector_results.values():
            if result.result is not None:
                create_issue_occurrence_from_result(result)

        if detector_results:
            results.append((detector, detector_results))

        # Now that we've processed all results for this detector, commit any state changes
        handler.commit_state_updates()

    return results","[Medium] class MetricAlertDetectorHandler in src/sentry/incidents/grouptype.py:
class MetricAlertDetectorHandler(StatefulDetectorHandler[QuerySubscriptionUpdate]):
    pass
---
[Medium] class StatefulDetectorHandler in src/sentry/workflow_engine/processors/detector.py:
class StatefulDetectorHandler(DetectorHandler[T], abc.ABC):
    def __init__(self, detector: Detector):
        super().__init__(detector)
        self.dedupe_updates: dict[DetectorGroupKey, int] = {}
        self.counter_updates: dict[DetectorGroupKey, dict[str, int | None]] = {}
        self.state_updates: dict[DetectorGroupKey, tuple[bool, DetectorPriorityLevel]] = {}

    @property
    @abc.abstractmethod
    def counter_names(self) -> list[str]:
        """"""
        The names of counters tha
---
[Medium] function TestProcessDetectors in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestProcessDetectors(BaseDetectorHandlerTest):
    def setUp(self):
        super().setUp()

    def build_data_packet(self, **kwargs):
        query_id = ""1234""
        return DataPacket[dict](
            query_id, {""query_id"": query_id, ""group_vals"": {""group_1"": 6}, **kwargs}
        )

    def test(self):
        detector = self.create_detector(type=self.handler_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [de
---
[Medium] function TestEvaluate in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestEvaluate(BaseDetectorHandlerTest):
    def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == {}
        occurrence, event_data = build_mock_occurrence_and_event(
            handler, ""val1"", 6, PriorityLevel.HIGH
        )
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == {
            ""val1"": DetectorEvaluationResult(
                group_key=""val1"",
        
---
[Medium] function TestEvaluateGroupKeyValue in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestEvaluateGroupKeyValue(BaseDetectorHandlerTest):
    def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            occurrence, event_data = build_mock_occurrence_and_event(
                handler, ""val1"", 6, PriorityLevel.HIGH
            )
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                Dete
---
[Medium] function evaluate in src/sentry/incidents/grouptype.py:
def evaluate(
        self, data_packet: DataPacket[QuerySubscriptionUpdate]
    ) -> list[DetectorEvaluationResult]:
        # TODO: Implement
        return []
---
[Medium] class TestProcessDetectors in tests/sentry/workflow_engine/processors/test_detector.py:
class TestProcessDetectors(BaseGroupTypeTest):
    def setUp(self):
        super().setUp()

        class NoHandlerGroupType(GroupType):
            type_id = 1
            slug = ""no_handler""
            description = ""no handler""
            category = GroupCategory.METRIC_ALERT.value

        class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, 
---
[Medium] function setUp in tests/sentry/workflow_engine/processors/test_detector.py:
def setUp(self):
        super().setUp()

        class NoHandlerGroupType(GroupType):
            type_id = 1
            slug = ""no_handler""
            description = ""no handler""
            category = GroupCategory.METRIC_ALERT.value

        class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]

        class H
---
[Medium] class MockDetectorHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]
---
[Medium] function evaluate in tests/sentry/workflow_engine/processors/test_detector.py:
def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]
---
[Medium] class MockDetectorStateHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorStateHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                group_keys = data_packet.packet.get(""group_keys"", [None])
                return [
                    DetectorEvaluationResult(
                        group_key,
                        True,
                        DetectorPriorityLevel.HIGH,
                    )
                    for group_key in group_keys
                
---
[Medium] function evaluate in tests/sentry/workflow_engine/processors/test_detector.py:
def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                group_keys = data_packet.packet.get(""group_keys"", [None])
                return [
                    DetectorEvaluationResult(
                        group_key,
                        True,
                        DetectorPriorityLevel.HIGH,
                    )
                    for group_key in group_keys
                ]
---
[Medium] function build_data_packet in tests/sentry/workflow_engine/processors/test_detector.py:
def build_data_packet(self, **kwargs):
        query_id = ""1234""
        return DataPacket[dict](query_id, {""query_id"": query_id, ""some"": ""data"", **kwargs})
---
[Medium] function test in tests/sentry/workflow_engine/processors/test_detector.py:
def test(self):
        detector = self.create_detector(type=self.handler_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [detector])
        assert results == [
            (
                detector,
                [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)],
            )
        ]
---
[Medium] function test_state_results in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [detector])
        result = DetectorEvaluationResult(
            None,
            True,
            DetectorPriorityLevel.HIGH,
        )
        assert results == [
            (
                detector,
                [result],
            )
        ]
---
[Medium] function test_state_results_multi_group in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results_multi_group(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet(group_keys=[""group_1"", ""group_2""])
        results = process_detectors(data_packet, [detector])
        result_1 = DetectorEvaluationResult(
            ""group_1"",
            True,
            DetectorPriorityLevel.HIGH,
        )
        result_2 = DetectorEvaluationResult(
            ""group_2"",
            True,
            Detector
---
[Medium] function test_state_results_multi_group_dupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results_multi_group_dupe(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet(group_keys=[""dupe"", ""dupe""])
        with mock.patch(""sentry.workflow_engine.processors.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert mock_logger.error.call_args[0][0] == ""Duplicate detector state group keys found""
        result = DetectorEvaluationResult(
   
---
[Medium] function test_no_issue_type in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_issue_type(self):
        detector = self.create_detector(type=""invalid slug"")
        data_packet = self.build_data_packet()
        with mock.patch(""sentry.workflow_engine.models.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert mock_logger.error.call_args[0][0] == ""No registered grouptype for detector""
        assert results == []
---
[Medium] function test_no_handler in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_handler(self):
        detector = self.create_detector(type=self.no_handler_type.slug)
        data_packet = self.build_data_packet()
        with mock.patch(""sentry.workflow_engine.models.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert (
                mock_logger.error.call_args[0][0]
                == ""Registered grouptype for detector has no detector_handler""
            )
        assert results == []
---
[Medium] class StatefulDetectorHandlerTestMixin in tests/sentry/workflow_engine/processors/test_detector.py:
class StatefulDetectorHandlerTestMixin(TestCase):
    __test__ = Abstract(__module__, __qualname__)

    def setUp(self):
        super().setUp()
        self.sm_comp_patcher = mock.patch.object(
            StatusChangeMessage, ""__eq__"", status_change_comparator
        )
        self.sm_comp_patcher.__enter__()

    def tearDown(self):
        super().tearDown()
        self.sm_comp_patcher.__exit__(None, None, None)

    def build_handler(self, detector: Detector | None = None) -> MockDetecto
---
[Medium] function setUp in tests/sentry/workflow_engine/processors/test_detector.py:
def setUp(self):
        super().setUp()
        self.sm_comp_patcher = mock.patch.object(
            StatusChangeMessage, ""__eq__"", status_change_comparator
        )
        self.sm_comp_patcher.__enter__()
---
[Medium] function build_handler in tests/sentry/workflow_engine/processors/test_detector.py:
def build_handler(self, detector: Detector | None = None) -> MockDetectorStateHandler:
        if detector is None:
            detector = self.create_detector(
                workflow_condition_group=self.create_data_condition_group()
            )
            self.create_data_condition(
                condition=""gt"",
                comparison=5,
                condition_result=DetectorPriorityLevel.HIGH,
                condition_group=detector.workflow_condition_group,
            )
     
---
[Medium] class TestEvaluate in tests/sentry/workflow_engine/processors/test_detector.py:
class TestEvaluate(StatefulDetectorHandlerTestMixin):
    def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == []
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""va
---
[Medium] function test in tests/sentry/workflow_engine/processors/test_detector.py:
def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == []
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
---
[Medium] function test_above_below_threshold in tests/sentry/workflow_engine/processors/test_detector.py:
def test_above_below_threshold(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1, ""group_vals"": {""val1"": 0}})) == []
        handler.commit_state_updates()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        ha
---
[Medium] function test_no_condition_group in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_condition_group(self):
        detector = self.create_detector()
        handler = MockDetectorStateHandler(detector)
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            assert (
                handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 100}})) == []
            )
            mock_metrics.incr.assert_called_once_with(
                ""workflow_engine.detector.skipping_invalid_condition_group""
         
---
[Medium] function test_results_on_change in tests/sentry/workflow_engine/processors/test_detector.py:
def test_results_on_change(self):
        handler = self.build_handler()
        result = handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 100}}))
        assert result == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
        handler.commit_state_updates()
---
[Medium] function test_dedupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_dedupe(self):
        handler = self.build_handler()
        result = handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 8}}))
        assert result == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
        handler.commit_state_updates()
        with
---
[Medium] class TestEvaluateGroupKeyValue in tests/sentry/workflow_engine/processors/test_detector.py:
class TestEvaluateGroupKeyValue(StatefulDetectorHandlerTestMixin):
    def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                DetectorPriorityLevel.HIGH,
            )
            assert (
                handler.evaluate_group_key_value(
                    expected_result.
---
[Medium] function test_dedupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                DetectorPriorityLevel.HIGH,
            )
            assert (
                handler.evaluate_group_key_value(
                    expected_result.group_key,
                    10,
                    DetectorStateDat
---
[Medium] function test_status_change in tests/sentry/workflow_engine/processors/test_detector.py:
def test_status_change(self):
        handler = self.build_handler()
        assert (
            handler.evaluate_group_key_value(
                ""group_key"",
                0,
                DetectorStateData(
                    ""group_key"",
                    False,
                    DetectorPriorityLevel.OK,
                    1,
                    {},
                ),
                dedupe_value=2,
            )
            is None
        )
        assert handler.evaluate_group
---
[Medium] class DetectorHandler in src/sentry/workflow_engine/processors/detector.py:
class DetectorHandler(abc.ABC, Generic[T]):
    def __init__(self, detector: Detector):
        self.detector = detector
        if detector.workflow_condition_group_id is not None:
            results = get_data_group_conditions_and_group(detector.workflow_condition_group_id)
            self.condition_group: DataConditionGroup | None = results[0]
            self.conditions: list[DataCondition] = results[1]
        else:
            self.condition_group = None
            self.conditions = []

---
[Medium] function evaluate in src/sentry/workflow_engine/processors/detector.py:
def evaluate(
        self, data_packet: DataPacket[T]
    ) -> dict[DetectorGroupKey, DetectorEvaluationResult]:
        """"""
        Evaluates a given data packet and returns a list of `DetectorEvaluationResult`.
        There will be one result for each group key result in the packet, unless the
        evaluation is skipped due to various rules.
        """"""
        dedupe_value = self.get_dedupe_value(data_packet)
        group_values = self.get_group_key_values(data_packet)
        all_state
---
[Medium] function evaluate in src/sentry/workflow_engine/processors/detector.py:
@abc.abstractmethod
    def evaluate(
        self, data_packet: DataPacket[T]
    ) -> dict[DetectorGroupKey, DetectorEvaluationResult]:
        pass
---
[Medium] class MockDetectorStateHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorStateHandler(StatefulDetectorHandler[dict]):
    counter_names = [""test1"", ""test2""]

    def get_dedupe_value(self, data_packet: DataPacket[dict]) -> int:
        return data_packet.packet.get(""dedupe"", 0)

    def get_group_key_values(self, data_packet: DataPacket[dict]) -> dict[str, int]:
        return data_packet.packet.get(""group_vals"", {})

    def build_occurrence_and_event_data(
        self, group_key: DetectorGroupKey, value: int, new_status: PriorityLevel
    ) -> tu
---
[Medium] function evaluate_group_key_value in src/sentry/workflow_engine/processors/detector.py:
def evaluate_group_key_value(
        self,
        group_key: DetectorGroupKey,
        value: int,
        state_data: DetectorStateData,
        dedupe_value: int,
    ) -> DetectorEvaluationResult | None:
        """"""
        Evaluates a value associated with a given `group_key` and returns a `DetectorEvaluationResult` with the results
        and any state changes that need to be made.

        Checks that we haven't already processed this datapacket for this group_key, and skips evaluation ","Detector (Critical), process_detectors (Critical), MetricAlertDetectorHandler (Medium), StatefulDetectorHandler (Medium), TestProcessDetectors (Medium), TestEvaluate (Medium), TestEvaluateGroupKeyValue (Medium), evaluate (Medium), TestProcessDetectors (Medium), setUp (Medium), MockDetectorHandler (Medium), evaluate (Medium), MockDetectorStateHandler (Medium), evaluate (Medium), build_data_packet (Medium), test (Medium), test_state_results (Medium), test_state_results_multi_group (Medium), test_state_results_multi_group_dupe (Medium), test_no_issue_type (Medium), test_no_handler (Medium), StatefulDetectorHandlerTestMixin (Medium), setUp (Medium), build_handler (Medium), TestEvaluate (Medium), test (Medium), test_above_below_threshold (Medium), test_no_condition_group (Medium), test_results_on_change (Medium), test_dedupe (Medium), TestEvaluateGroupKeyValue (Medium), test_dedupe (Medium), test_status_change (Medium), DetectorHandler (Medium), evaluate (Medium), evaluate (Medium), MockDetectorStateHandler (Medium), evaluate_group_key_value (Medium), build_occurrence_and_event_data (Low), build_occurrence_and_event_data (Low), BaseDetectorHandlerTest (Low), setUp (Low), MockDetectorHandler (Low), evaluate (Low), create_detector_and_conditions (Low), build_handler (Low), build_mock_occurrence_and_event (Low), TestCommitStateUpdateData (Low), TestGetStateData (Low), NoHandlerGroupType (Low), HandlerGroupType (Low), HandlerStateGroupType (Low), tearDown (Low), assert_updates (Low)",match,'MetricAlertDetectorHandler' matches HC entity 'detector'
sentry,22,feat(workflow_engine): Add in hook for producing occurrences from the stateful detector,"Docstring says this returns a list of DetectorEvaluationResult, but the method now returns a dict keyed by DetectorGroupKey. Consider updating the docstring to match the new return type.",Low,54,2,36,"function::Detector (src/sentry/workflow_engine/models/detector.py) [Critical, score=1.00] | function::process_detectors (src/sentry/workflow_engine/processors/detector.py) [Critical, score=0.70]","[Critical] function Detector in src/sentry/workflow_engine/models/detector.py:
@region_silo_model
class Detector(DefaultFieldsModel, OwnerModel):
    __relocation_scope__ = RelocationScope.Organization

    organization = FlexibleForeignKey(""sentry.Organization"")
    name = models.CharField(max_length=200)

    # The data sources that the detector is watching
    data_sources = models.ManyToManyField(
        ""workflow_engine.DataSource"", through=""workflow_engine.DataSourceDetector""
    )

    # The conditions that must be met for the detector to be considered 'active'
    # This will emit an event for the workflow to process
    workflow_condition_group = FlexibleForeignKey(
        ""workflow_engine.DataConditionGroup"",
        blank=True,
        null=True,
        unique=True,
        on_delete=models.SET_NULL,
    )
    type = models.CharField(max_length=200)

  
---
[Critical] function process_detectors in src/sentry/workflow_engine/processors/detector.py:
def process_detectors(
    data_packet: DataPacket, detectors: list[Detector]
) -> list[tuple[Detector, dict[DetectorGroupKey, DetectorEvaluationResult]]]:
    results = []

    for detector in detectors:
        handler = detector.detector_handler

        if not handler:
            continue

        detector_results = handler.evaluate(data_packet)

        for result in detector_results.values():
            if result.result is not None:
                create_issue_occurrence_from_result(result)

        if detector_results:
            results.append((detector, detector_results))

        # Now that we've processed all results for this detector, commit any state changes
        handler.commit_state_updates()

    return results","[Medium] class MetricAlertDetectorHandler in src/sentry/incidents/grouptype.py:
class MetricAlertDetectorHandler(StatefulDetectorHandler[QuerySubscriptionUpdate]):
    pass
---
[Medium] class StatefulDetectorHandler in src/sentry/workflow_engine/processors/detector.py:
class StatefulDetectorHandler(DetectorHandler[T], abc.ABC):
    def __init__(self, detector: Detector):
        super().__init__(detector)
        self.dedupe_updates: dict[DetectorGroupKey, int] = {}
        self.counter_updates: dict[DetectorGroupKey, dict[str, int | None]] = {}
        self.state_updates: dict[DetectorGroupKey, tuple[bool, DetectorPriorityLevel]] = {}

    @property
    @abc.abstractmethod
    def counter_names(self) -> list[str]:
        """"""
        The names of counters tha
---
[Medium] function TestProcessDetectors in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestProcessDetectors(BaseDetectorHandlerTest):
    def setUp(self):
        super().setUp()

    def build_data_packet(self, **kwargs):
        query_id = ""1234""
        return DataPacket[dict](
            query_id, {""query_id"": query_id, ""group_vals"": {""group_1"": 6}, **kwargs}
        )

    def test(self):
        detector = self.create_detector(type=self.handler_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [de
---
[Medium] function TestEvaluate in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestEvaluate(BaseDetectorHandlerTest):
    def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == {}
        occurrence, event_data = build_mock_occurrence_and_event(
            handler, ""val1"", 6, PriorityLevel.HIGH
        )
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == {
            ""val1"": DetectorEvaluationResult(
                group_key=""val1"",
        
---
[Medium] function TestEvaluateGroupKeyValue in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestEvaluateGroupKeyValue(BaseDetectorHandlerTest):
    def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            occurrence, event_data = build_mock_occurrence_and_event(
                handler, ""val1"", 6, PriorityLevel.HIGH
            )
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                Dete
---
[Medium] function evaluate in src/sentry/incidents/grouptype.py:
def evaluate(
        self, data_packet: DataPacket[QuerySubscriptionUpdate]
    ) -> list[DetectorEvaluationResult]:
        # TODO: Implement
        return []
---
[Medium] class TestProcessDetectors in tests/sentry/workflow_engine/processors/test_detector.py:
class TestProcessDetectors(BaseGroupTypeTest):
    def setUp(self):
        super().setUp()

        class NoHandlerGroupType(GroupType):
            type_id = 1
            slug = ""no_handler""
            description = ""no handler""
            category = GroupCategory.METRIC_ALERT.value

        class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, 
---
[Medium] function setUp in tests/sentry/workflow_engine/processors/test_detector.py:
def setUp(self):
        super().setUp()

        class NoHandlerGroupType(GroupType):
            type_id = 1
            slug = ""no_handler""
            description = ""no handler""
            category = GroupCategory.METRIC_ALERT.value

        class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]

        class H
---
[Medium] class MockDetectorHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]
---
[Medium] function evaluate in tests/sentry/workflow_engine/processors/test_detector.py:
def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]
---
[Medium] class MockDetectorStateHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorStateHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                group_keys = data_packet.packet.get(""group_keys"", [None])
                return [
                    DetectorEvaluationResult(
                        group_key,
                        True,
                        DetectorPriorityLevel.HIGH,
                    )
                    for group_key in group_keys
                
---
[Medium] function evaluate in tests/sentry/workflow_engine/processors/test_detector.py:
def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                group_keys = data_packet.packet.get(""group_keys"", [None])
                return [
                    DetectorEvaluationResult(
                        group_key,
                        True,
                        DetectorPriorityLevel.HIGH,
                    )
                    for group_key in group_keys
                ]
---
[Medium] function build_data_packet in tests/sentry/workflow_engine/processors/test_detector.py:
def build_data_packet(self, **kwargs):
        query_id = ""1234""
        return DataPacket[dict](query_id, {""query_id"": query_id, ""some"": ""data"", **kwargs})
---
[Medium] function test in tests/sentry/workflow_engine/processors/test_detector.py:
def test(self):
        detector = self.create_detector(type=self.handler_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [detector])
        assert results == [
            (
                detector,
                [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)],
            )
        ]
---
[Medium] function test_state_results in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [detector])
        result = DetectorEvaluationResult(
            None,
            True,
            DetectorPriorityLevel.HIGH,
        )
        assert results == [
            (
                detector,
                [result],
            )
        ]
---
[Medium] function test_state_results_multi_group in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results_multi_group(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet(group_keys=[""group_1"", ""group_2""])
        results = process_detectors(data_packet, [detector])
        result_1 = DetectorEvaluationResult(
            ""group_1"",
            True,
            DetectorPriorityLevel.HIGH,
        )
        result_2 = DetectorEvaluationResult(
            ""group_2"",
            True,
            Detector
---
[Medium] function test_state_results_multi_group_dupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results_multi_group_dupe(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet(group_keys=[""dupe"", ""dupe""])
        with mock.patch(""sentry.workflow_engine.processors.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert mock_logger.error.call_args[0][0] == ""Duplicate detector state group keys found""
        result = DetectorEvaluationResult(
   
---
[Medium] function test_no_issue_type in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_issue_type(self):
        detector = self.create_detector(type=""invalid slug"")
        data_packet = self.build_data_packet()
        with mock.patch(""sentry.workflow_engine.models.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert mock_logger.error.call_args[0][0] == ""No registered grouptype for detector""
        assert results == []
---
[Medium] function test_no_handler in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_handler(self):
        detector = self.create_detector(type=self.no_handler_type.slug)
        data_packet = self.build_data_packet()
        with mock.patch(""sentry.workflow_engine.models.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert (
                mock_logger.error.call_args[0][0]
                == ""Registered grouptype for detector has no detector_handler""
            )
        assert results == []
---
[Medium] class StatefulDetectorHandlerTestMixin in tests/sentry/workflow_engine/processors/test_detector.py:
class StatefulDetectorHandlerTestMixin(TestCase):
    __test__ = Abstract(__module__, __qualname__)

    def setUp(self):
        super().setUp()
        self.sm_comp_patcher = mock.patch.object(
            StatusChangeMessage, ""__eq__"", status_change_comparator
        )
        self.sm_comp_patcher.__enter__()

    def tearDown(self):
        super().tearDown()
        self.sm_comp_patcher.__exit__(None, None, None)

    def build_handler(self, detector: Detector | None = None) -> MockDetecto
---
[Medium] function setUp in tests/sentry/workflow_engine/processors/test_detector.py:
def setUp(self):
        super().setUp()
        self.sm_comp_patcher = mock.patch.object(
            StatusChangeMessage, ""__eq__"", status_change_comparator
        )
        self.sm_comp_patcher.__enter__()
---
[Medium] function build_handler in tests/sentry/workflow_engine/processors/test_detector.py:
def build_handler(self, detector: Detector | None = None) -> MockDetectorStateHandler:
        if detector is None:
            detector = self.create_detector(
                workflow_condition_group=self.create_data_condition_group()
            )
            self.create_data_condition(
                condition=""gt"",
                comparison=5,
                condition_result=DetectorPriorityLevel.HIGH,
                condition_group=detector.workflow_condition_group,
            )
     
---
[Medium] class TestEvaluate in tests/sentry/workflow_engine/processors/test_detector.py:
class TestEvaluate(StatefulDetectorHandlerTestMixin):
    def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == []
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""va
---
[Medium] function test in tests/sentry/workflow_engine/processors/test_detector.py:
def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == []
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
---
[Medium] function test_above_below_threshold in tests/sentry/workflow_engine/processors/test_detector.py:
def test_above_below_threshold(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1, ""group_vals"": {""val1"": 0}})) == []
        handler.commit_state_updates()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        ha
---
[Medium] function test_no_condition_group in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_condition_group(self):
        detector = self.create_detector()
        handler = MockDetectorStateHandler(detector)
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            assert (
                handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 100}})) == []
            )
            mock_metrics.incr.assert_called_once_with(
                ""workflow_engine.detector.skipping_invalid_condition_group""
         
---
[Medium] function test_results_on_change in tests/sentry/workflow_engine/processors/test_detector.py:
def test_results_on_change(self):
        handler = self.build_handler()
        result = handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 100}}))
        assert result == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
        handler.commit_state_updates()
---
[Medium] function test_dedupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_dedupe(self):
        handler = self.build_handler()
        result = handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 8}}))
        assert result == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
        handler.commit_state_updates()
        with
---
[Medium] class TestEvaluateGroupKeyValue in tests/sentry/workflow_engine/processors/test_detector.py:
class TestEvaluateGroupKeyValue(StatefulDetectorHandlerTestMixin):
    def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                DetectorPriorityLevel.HIGH,
            )
            assert (
                handler.evaluate_group_key_value(
                    expected_result.
---
[Medium] function test_dedupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                DetectorPriorityLevel.HIGH,
            )
            assert (
                handler.evaluate_group_key_value(
                    expected_result.group_key,
                    10,
                    DetectorStateDat
---
[Medium] function test_status_change in tests/sentry/workflow_engine/processors/test_detector.py:
def test_status_change(self):
        handler = self.build_handler()
        assert (
            handler.evaluate_group_key_value(
                ""group_key"",
                0,
                DetectorStateData(
                    ""group_key"",
                    False,
                    DetectorPriorityLevel.OK,
                    1,
                    {},
                ),
                dedupe_value=2,
            )
            is None
        )
        assert handler.evaluate_group
---
[Medium] class DetectorHandler in src/sentry/workflow_engine/processors/detector.py:
class DetectorHandler(abc.ABC, Generic[T]):
    def __init__(self, detector: Detector):
        self.detector = detector
        if detector.workflow_condition_group_id is not None:
            results = get_data_group_conditions_and_group(detector.workflow_condition_group_id)
            self.condition_group: DataConditionGroup | None = results[0]
            self.conditions: list[DataCondition] = results[1]
        else:
            self.condition_group = None
            self.conditions = []

---
[Medium] function evaluate in src/sentry/workflow_engine/processors/detector.py:
def evaluate(
        self, data_packet: DataPacket[T]
    ) -> dict[DetectorGroupKey, DetectorEvaluationResult]:
        """"""
        Evaluates a given data packet and returns a list of `DetectorEvaluationResult`.
        There will be one result for each group key result in the packet, unless the
        evaluation is skipped due to various rules.
        """"""
        dedupe_value = self.get_dedupe_value(data_packet)
        group_values = self.get_group_key_values(data_packet)
        all_state
---
[Medium] function evaluate in src/sentry/workflow_engine/processors/detector.py:
@abc.abstractmethod
    def evaluate(
        self, data_packet: DataPacket[T]
    ) -> dict[DetectorGroupKey, DetectorEvaluationResult]:
        pass
---
[Medium] class MockDetectorStateHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorStateHandler(StatefulDetectorHandler[dict]):
    counter_names = [""test1"", ""test2""]

    def get_dedupe_value(self, data_packet: DataPacket[dict]) -> int:
        return data_packet.packet.get(""dedupe"", 0)

    def get_group_key_values(self, data_packet: DataPacket[dict]) -> dict[str, int]:
        return data_packet.packet.get(""group_vals"", {})

    def build_occurrence_and_event_data(
        self, group_key: DetectorGroupKey, value: int, new_status: PriorityLevel
    ) -> tu
---
[Medium] function evaluate_group_key_value in src/sentry/workflow_engine/processors/detector.py:
def evaluate_group_key_value(
        self,
        group_key: DetectorGroupKey,
        value: int,
        state_data: DetectorStateData,
        dedupe_value: int,
    ) -> DetectorEvaluationResult | None:
        """"""
        Evaluates a value associated with a given `group_key` and returns a `DetectorEvaluationResult` with the results
        and any state changes that need to be made.

        Checks that we haven't already processed this datapacket for this group_key, and skips evaluation ","Detector (Critical), process_detectors (Critical), MetricAlertDetectorHandler (Medium), StatefulDetectorHandler (Medium), TestProcessDetectors (Medium), TestEvaluate (Medium), TestEvaluateGroupKeyValue (Medium), evaluate (Medium), TestProcessDetectors (Medium), setUp (Medium), MockDetectorHandler (Medium), evaluate (Medium), MockDetectorStateHandler (Medium), evaluate (Medium), build_data_packet (Medium), test (Medium), test_state_results (Medium), test_state_results_multi_group (Medium), test_state_results_multi_group_dupe (Medium), test_no_issue_type (Medium), test_no_handler (Medium), StatefulDetectorHandlerTestMixin (Medium), setUp (Medium), build_handler (Medium), TestEvaluate (Medium), test (Medium), test_above_below_threshold (Medium), test_no_condition_group (Medium), test_results_on_change (Medium), test_dedupe (Medium), TestEvaluateGroupKeyValue (Medium), test_dedupe (Medium), test_status_change (Medium), DetectorHandler (Medium), evaluate (Medium), evaluate (Medium), MockDetectorStateHandler (Medium), evaluate_group_key_value (Medium), build_occurrence_and_event_data (Low), build_occurrence_and_event_data (Low), BaseDetectorHandlerTest (Low), setUp (Low), MockDetectorHandler (Low), evaluate (Low), create_detector_and_conditions (Low), build_handler (Low), build_mock_occurrence_and_event (Low), TestCommitStateUpdateData (Low), TestGetStateData (Low), NoHandlerGroupType (Low), HandlerGroupType (Low), HandlerStateGroupType (Low), tearDown (Low), assert_updates (Low)",match,'DetectorGroupKey' matches HC entity 'detector'
sentry,10,feat(workflow_engine): Add in hook for producing occurrences from the stateful detector,"MetricAlertDetectorHandler inherits from StatefulDetectorHandler but only contains pass, failing to implement its required abstract methods: counter_names (property), get_dedupe_value(), get_group_key_values(), and build_occurrence_and_event_data(). This will cause a TypeError at runtime when the class is instantiated.",High,54,2,36,"function::Detector (src/sentry/workflow_engine/models/detector.py) [Critical, score=1.00] | function::process_detectors (src/sentry/workflow_engine/processors/detector.py) [Critical, score=0.70]","[Critical] function Detector in src/sentry/workflow_engine/models/detector.py:
@region_silo_model
class Detector(DefaultFieldsModel, OwnerModel):
    __relocation_scope__ = RelocationScope.Organization

    organization = FlexibleForeignKey(""sentry.Organization"")
    name = models.CharField(max_length=200)

    # The data sources that the detector is watching
    data_sources = models.ManyToManyField(
        ""workflow_engine.DataSource"", through=""workflow_engine.DataSourceDetector""
    )

    # The conditions that must be met for the detector to be considered 'active'
    # This will emit an event for the workflow to process
    workflow_condition_group = FlexibleForeignKey(
        ""workflow_engine.DataConditionGroup"",
        blank=True,
        null=True,
        unique=True,
        on_delete=models.SET_NULL,
    )
    type = models.CharField(max_length=200)

  
---
[Critical] function process_detectors in src/sentry/workflow_engine/processors/detector.py:
def process_detectors(
    data_packet: DataPacket, detectors: list[Detector]
) -> list[tuple[Detector, dict[DetectorGroupKey, DetectorEvaluationResult]]]:
    results = []

    for detector in detectors:
        handler = detector.detector_handler

        if not handler:
            continue

        detector_results = handler.evaluate(data_packet)

        for result in detector_results.values():
            if result.result is not None:
                create_issue_occurrence_from_result(result)

        if detector_results:
            results.append((detector, detector_results))

        # Now that we've processed all results for this detector, commit any state changes
        handler.commit_state_updates()

    return results","[Medium] class MetricAlertDetectorHandler in src/sentry/incidents/grouptype.py:
class MetricAlertDetectorHandler(StatefulDetectorHandler[QuerySubscriptionUpdate]):
    pass
---
[Medium] class StatefulDetectorHandler in src/sentry/workflow_engine/processors/detector.py:
class StatefulDetectorHandler(DetectorHandler[T], abc.ABC):
    def __init__(self, detector: Detector):
        super().__init__(detector)
        self.dedupe_updates: dict[DetectorGroupKey, int] = {}
        self.counter_updates: dict[DetectorGroupKey, dict[str, int | None]] = {}
        self.state_updates: dict[DetectorGroupKey, tuple[bool, DetectorPriorityLevel]] = {}

    @property
    @abc.abstractmethod
    def counter_names(self) -> list[str]:
        """"""
        The names of counters tha
---
[Medium] function TestProcessDetectors in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestProcessDetectors(BaseDetectorHandlerTest):
    def setUp(self):
        super().setUp()

    def build_data_packet(self, **kwargs):
        query_id = ""1234""
        return DataPacket[dict](
            query_id, {""query_id"": query_id, ""group_vals"": {""group_1"": 6}, **kwargs}
        )

    def test(self):
        detector = self.create_detector(type=self.handler_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [de
---
[Medium] function TestEvaluate in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestEvaluate(BaseDetectorHandlerTest):
    def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == {}
        occurrence, event_data = build_mock_occurrence_and_event(
            handler, ""val1"", 6, PriorityLevel.HIGH
        )
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == {
            ""val1"": DetectorEvaluationResult(
                group_key=""val1"",
        
---
[Medium] function TestEvaluateGroupKeyValue in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestEvaluateGroupKeyValue(BaseDetectorHandlerTest):
    def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            occurrence, event_data = build_mock_occurrence_and_event(
                handler, ""val1"", 6, PriorityLevel.HIGH
            )
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                Dete
---
[Medium] function evaluate in src/sentry/incidents/grouptype.py:
def evaluate(
        self, data_packet: DataPacket[QuerySubscriptionUpdate]
    ) -> list[DetectorEvaluationResult]:
        # TODO: Implement
        return []
---
[Medium] class TestProcessDetectors in tests/sentry/workflow_engine/processors/test_detector.py:
class TestProcessDetectors(BaseGroupTypeTest):
    def setUp(self):
        super().setUp()

        class NoHandlerGroupType(GroupType):
            type_id = 1
            slug = ""no_handler""
            description = ""no handler""
            category = GroupCategory.METRIC_ALERT.value

        class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, 
---
[Medium] function setUp in tests/sentry/workflow_engine/processors/test_detector.py:
def setUp(self):
        super().setUp()

        class NoHandlerGroupType(GroupType):
            type_id = 1
            slug = ""no_handler""
            description = ""no handler""
            category = GroupCategory.METRIC_ALERT.value

        class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]

        class H
---
[Medium] class MockDetectorHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]
---
[Medium] function evaluate in tests/sentry/workflow_engine/processors/test_detector.py:
def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]
---
[Medium] class MockDetectorStateHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorStateHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                group_keys = data_packet.packet.get(""group_keys"", [None])
                return [
                    DetectorEvaluationResult(
                        group_key,
                        True,
                        DetectorPriorityLevel.HIGH,
                    )
                    for group_key in group_keys
                
---
[Medium] function evaluate in tests/sentry/workflow_engine/processors/test_detector.py:
def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                group_keys = data_packet.packet.get(""group_keys"", [None])
                return [
                    DetectorEvaluationResult(
                        group_key,
                        True,
                        DetectorPriorityLevel.HIGH,
                    )
                    for group_key in group_keys
                ]
---
[Medium] function build_data_packet in tests/sentry/workflow_engine/processors/test_detector.py:
def build_data_packet(self, **kwargs):
        query_id = ""1234""
        return DataPacket[dict](query_id, {""query_id"": query_id, ""some"": ""data"", **kwargs})
---
[Medium] function test in tests/sentry/workflow_engine/processors/test_detector.py:
def test(self):
        detector = self.create_detector(type=self.handler_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [detector])
        assert results == [
            (
                detector,
                [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)],
            )
        ]
---
[Medium] function test_state_results in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [detector])
        result = DetectorEvaluationResult(
            None,
            True,
            DetectorPriorityLevel.HIGH,
        )
        assert results == [
            (
                detector,
                [result],
            )
        ]
---
[Medium] function test_state_results_multi_group in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results_multi_group(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet(group_keys=[""group_1"", ""group_2""])
        results = process_detectors(data_packet, [detector])
        result_1 = DetectorEvaluationResult(
            ""group_1"",
            True,
            DetectorPriorityLevel.HIGH,
        )
        result_2 = DetectorEvaluationResult(
            ""group_2"",
            True,
            Detector
---
[Medium] function test_state_results_multi_group_dupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results_multi_group_dupe(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet(group_keys=[""dupe"", ""dupe""])
        with mock.patch(""sentry.workflow_engine.processors.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert mock_logger.error.call_args[0][0] == ""Duplicate detector state group keys found""
        result = DetectorEvaluationResult(
   
---
[Medium] function test_no_issue_type in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_issue_type(self):
        detector = self.create_detector(type=""invalid slug"")
        data_packet = self.build_data_packet()
        with mock.patch(""sentry.workflow_engine.models.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert mock_logger.error.call_args[0][0] == ""No registered grouptype for detector""
        assert results == []
---
[Medium] function test_no_handler in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_handler(self):
        detector = self.create_detector(type=self.no_handler_type.slug)
        data_packet = self.build_data_packet()
        with mock.patch(""sentry.workflow_engine.models.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert (
                mock_logger.error.call_args[0][0]
                == ""Registered grouptype for detector has no detector_handler""
            )
        assert results == []
---
[Medium] class StatefulDetectorHandlerTestMixin in tests/sentry/workflow_engine/processors/test_detector.py:
class StatefulDetectorHandlerTestMixin(TestCase):
    __test__ = Abstract(__module__, __qualname__)

    def setUp(self):
        super().setUp()
        self.sm_comp_patcher = mock.patch.object(
            StatusChangeMessage, ""__eq__"", status_change_comparator
        )
        self.sm_comp_patcher.__enter__()

    def tearDown(self):
        super().tearDown()
        self.sm_comp_patcher.__exit__(None, None, None)

    def build_handler(self, detector: Detector | None = None) -> MockDetecto
---
[Medium] function setUp in tests/sentry/workflow_engine/processors/test_detector.py:
def setUp(self):
        super().setUp()
        self.sm_comp_patcher = mock.patch.object(
            StatusChangeMessage, ""__eq__"", status_change_comparator
        )
        self.sm_comp_patcher.__enter__()
---
[Medium] function build_handler in tests/sentry/workflow_engine/processors/test_detector.py:
def build_handler(self, detector: Detector | None = None) -> MockDetectorStateHandler:
        if detector is None:
            detector = self.create_detector(
                workflow_condition_group=self.create_data_condition_group()
            )
            self.create_data_condition(
                condition=""gt"",
                comparison=5,
                condition_result=DetectorPriorityLevel.HIGH,
                condition_group=detector.workflow_condition_group,
            )
     
---
[Medium] class TestEvaluate in tests/sentry/workflow_engine/processors/test_detector.py:
class TestEvaluate(StatefulDetectorHandlerTestMixin):
    def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == []
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""va
---
[Medium] function test in tests/sentry/workflow_engine/processors/test_detector.py:
def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == []
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
---
[Medium] function test_above_below_threshold in tests/sentry/workflow_engine/processors/test_detector.py:
def test_above_below_threshold(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1, ""group_vals"": {""val1"": 0}})) == []
        handler.commit_state_updates()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        ha
---
[Medium] function test_no_condition_group in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_condition_group(self):
        detector = self.create_detector()
        handler = MockDetectorStateHandler(detector)
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            assert (
                handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 100}})) == []
            )
            mock_metrics.incr.assert_called_once_with(
                ""workflow_engine.detector.skipping_invalid_condition_group""
         
---
[Medium] function test_results_on_change in tests/sentry/workflow_engine/processors/test_detector.py:
def test_results_on_change(self):
        handler = self.build_handler()
        result = handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 100}}))
        assert result == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
        handler.commit_state_updates()
---
[Medium] function test_dedupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_dedupe(self):
        handler = self.build_handler()
        result = handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 8}}))
        assert result == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
        handler.commit_state_updates()
        with
---
[Medium] class TestEvaluateGroupKeyValue in tests/sentry/workflow_engine/processors/test_detector.py:
class TestEvaluateGroupKeyValue(StatefulDetectorHandlerTestMixin):
    def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                DetectorPriorityLevel.HIGH,
            )
            assert (
                handler.evaluate_group_key_value(
                    expected_result.
---
[Medium] function test_dedupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                DetectorPriorityLevel.HIGH,
            )
            assert (
                handler.evaluate_group_key_value(
                    expected_result.group_key,
                    10,
                    DetectorStateDat
---
[Medium] function test_status_change in tests/sentry/workflow_engine/processors/test_detector.py:
def test_status_change(self):
        handler = self.build_handler()
        assert (
            handler.evaluate_group_key_value(
                ""group_key"",
                0,
                DetectorStateData(
                    ""group_key"",
                    False,
                    DetectorPriorityLevel.OK,
                    1,
                    {},
                ),
                dedupe_value=2,
            )
            is None
        )
        assert handler.evaluate_group
---
[Medium] class DetectorHandler in src/sentry/workflow_engine/processors/detector.py:
class DetectorHandler(abc.ABC, Generic[T]):
    def __init__(self, detector: Detector):
        self.detector = detector
        if detector.workflow_condition_group_id is not None:
            results = get_data_group_conditions_and_group(detector.workflow_condition_group_id)
            self.condition_group: DataConditionGroup | None = results[0]
            self.conditions: list[DataCondition] = results[1]
        else:
            self.condition_group = None
            self.conditions = []

---
[Medium] function evaluate in src/sentry/workflow_engine/processors/detector.py:
@abc.abstractmethod
    def evaluate(
        self, data_packet: DataPacket[T]
    ) -> dict[DetectorGroupKey, DetectorEvaluationResult]:
        pass
---
[Medium] function evaluate in src/sentry/workflow_engine/processors/detector.py:
def evaluate(
        self, data_packet: DataPacket[T]
    ) -> dict[DetectorGroupKey, DetectorEvaluationResult]:
        """"""
        Evaluates a given data packet and returns a list of `DetectorEvaluationResult`.
        There will be one result for each group key result in the packet, unless the
        evaluation is skipped due to various rules.
        """"""
        dedupe_value = self.get_dedupe_value(data_packet)
        group_values = self.get_group_key_values(data_packet)
        all_state
---
[Medium] class MockDetectorStateHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorStateHandler(StatefulDetectorHandler[dict]):
    counter_names = [""test1"", ""test2""]

    def get_dedupe_value(self, data_packet: DataPacket[dict]) -> int:
        return data_packet.packet.get(""dedupe"", 0)

    def get_group_key_values(self, data_packet: DataPacket[dict]) -> dict[str, int]:
        return data_packet.packet.get(""group_vals"", {})

    def build_occurrence_and_event_data(
        self, group_key: DetectorGroupKey, value: int, new_status: PriorityLevel
    ) -> tu
---
[Medium] function evaluate_group_key_value in src/sentry/workflow_engine/processors/detector.py:
def evaluate_group_key_value(
        self,
        group_key: DetectorGroupKey,
        value: int,
        state_data: DetectorStateData,
        dedupe_value: int,
    ) -> DetectorEvaluationResult | None:
        """"""
        Evaluates a value associated with a given `group_key` and returns a `DetectorEvaluationResult` with the results
        and any state changes that need to be made.

        Checks that we haven't already processed this datapacket for this group_key, and skips evaluation ","Detector (Critical), process_detectors (Critical), MetricAlertDetectorHandler (Medium), StatefulDetectorHandler (Medium), TestProcessDetectors (Medium), TestEvaluate (Medium), TestEvaluateGroupKeyValue (Medium), evaluate (Medium), TestProcessDetectors (Medium), setUp (Medium), MockDetectorHandler (Medium), evaluate (Medium), MockDetectorStateHandler (Medium), evaluate (Medium), build_data_packet (Medium), test (Medium), test_state_results (Medium), test_state_results_multi_group (Medium), test_state_results_multi_group_dupe (Medium), test_no_issue_type (Medium), test_no_handler (Medium), StatefulDetectorHandlerTestMixin (Medium), setUp (Medium), build_handler (Medium), TestEvaluate (Medium), test (Medium), test_above_below_threshold (Medium), test_no_condition_group (Medium), test_results_on_change (Medium), test_dedupe (Medium), TestEvaluateGroupKeyValue (Medium), test_dedupe (Medium), test_status_change (Medium), DetectorHandler (Medium), evaluate (Medium), evaluate (Medium), MockDetectorStateHandler (Medium), evaluate_group_key_value (Medium), build_occurrence_and_event_data (Low), build_occurrence_and_event_data (Low), BaseDetectorHandlerTest (Low), setUp (Low), MockDetectorHandler (Low), evaluate (Low), create_detector_and_conditions (Low), build_handler (Low), build_mock_occurrence_and_event (Low), TestCommitStateUpdateData (Low), TestGetStateData (Low), NoHandlerGroupType (Low), HandlerGroupType (Low), HandlerStateGroupType (Low), tearDown (Low), assert_updates (Low)",match,'MetricAlertDetectorHandler' matches HC entity 'detector'
sentry,10,feat(workflow_engine): Add in hook for producing occurrences from the stateful detector,"Docstring says this returns a list of DetectorEvaluationResult, but the method now returns a dict keyed by DetectorGroupKey. Consider updating the docstring to match the new return type.",Low,54,2,36,"function::Detector (src/sentry/workflow_engine/models/detector.py) [Critical, score=1.00] | function::process_detectors (src/sentry/workflow_engine/processors/detector.py) [Critical, score=0.70]","[Critical] function Detector in src/sentry/workflow_engine/models/detector.py:
@region_silo_model
class Detector(DefaultFieldsModel, OwnerModel):
    __relocation_scope__ = RelocationScope.Organization

    organization = FlexibleForeignKey(""sentry.Organization"")
    name = models.CharField(max_length=200)

    # The data sources that the detector is watching
    data_sources = models.ManyToManyField(
        ""workflow_engine.DataSource"", through=""workflow_engine.DataSourceDetector""
    )

    # The conditions that must be met for the detector to be considered 'active'
    # This will emit an event for the workflow to process
    workflow_condition_group = FlexibleForeignKey(
        ""workflow_engine.DataConditionGroup"",
        blank=True,
        null=True,
        unique=True,
        on_delete=models.SET_NULL,
    )
    type = models.CharField(max_length=200)

  
---
[Critical] function process_detectors in src/sentry/workflow_engine/processors/detector.py:
def process_detectors(
    data_packet: DataPacket, detectors: list[Detector]
) -> list[tuple[Detector, dict[DetectorGroupKey, DetectorEvaluationResult]]]:
    results = []

    for detector in detectors:
        handler = detector.detector_handler

        if not handler:
            continue

        detector_results = handler.evaluate(data_packet)

        for result in detector_results.values():
            if result.result is not None:
                create_issue_occurrence_from_result(result)

        if detector_results:
            results.append((detector, detector_results))

        # Now that we've processed all results for this detector, commit any state changes
        handler.commit_state_updates()

    return results","[Medium] class MetricAlertDetectorHandler in src/sentry/incidents/grouptype.py:
class MetricAlertDetectorHandler(StatefulDetectorHandler[QuerySubscriptionUpdate]):
    pass
---
[Medium] class StatefulDetectorHandler in src/sentry/workflow_engine/processors/detector.py:
class StatefulDetectorHandler(DetectorHandler[T], abc.ABC):
    def __init__(self, detector: Detector):
        super().__init__(detector)
        self.dedupe_updates: dict[DetectorGroupKey, int] = {}
        self.counter_updates: dict[DetectorGroupKey, dict[str, int | None]] = {}
        self.state_updates: dict[DetectorGroupKey, tuple[bool, DetectorPriorityLevel]] = {}

    @property
    @abc.abstractmethod
    def counter_names(self) -> list[str]:
        """"""
        The names of counters tha
---
[Medium] function TestProcessDetectors in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestProcessDetectors(BaseDetectorHandlerTest):
    def setUp(self):
        super().setUp()

    def build_data_packet(self, **kwargs):
        query_id = ""1234""
        return DataPacket[dict](
            query_id, {""query_id"": query_id, ""group_vals"": {""group_1"": 6}, **kwargs}
        )

    def test(self):
        detector = self.create_detector(type=self.handler_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [de
---
[Medium] function TestEvaluate in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestEvaluate(BaseDetectorHandlerTest):
    def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == {}
        occurrence, event_data = build_mock_occurrence_and_event(
            handler, ""val1"", 6, PriorityLevel.HIGH
        )
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == {
            ""val1"": DetectorEvaluationResult(
                group_key=""val1"",
        
---
[Medium] function TestEvaluateGroupKeyValue in tests/sentry/workflow_engine/processors/test_detector.py:
@freeze_time()
class TestEvaluateGroupKeyValue(BaseDetectorHandlerTest):
    def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            occurrence, event_data = build_mock_occurrence_and_event(
                handler, ""val1"", 6, PriorityLevel.HIGH
            )
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                Dete
---
[Medium] function evaluate in src/sentry/incidents/grouptype.py:
def evaluate(
        self, data_packet: DataPacket[QuerySubscriptionUpdate]
    ) -> list[DetectorEvaluationResult]:
        # TODO: Implement
        return []
---
[Medium] class TestProcessDetectors in tests/sentry/workflow_engine/processors/test_detector.py:
class TestProcessDetectors(BaseGroupTypeTest):
    def setUp(self):
        super().setUp()

        class NoHandlerGroupType(GroupType):
            type_id = 1
            slug = ""no_handler""
            description = ""no handler""
            category = GroupCategory.METRIC_ALERT.value

        class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, 
---
[Medium] function setUp in tests/sentry/workflow_engine/processors/test_detector.py:
def setUp(self):
        super().setUp()

        class NoHandlerGroupType(GroupType):
            type_id = 1
            slug = ""no_handler""
            description = ""no handler""
            category = GroupCategory.METRIC_ALERT.value

        class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]

        class H
---
[Medium] class MockDetectorHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]
---
[Medium] function evaluate in tests/sentry/workflow_engine/processors/test_detector.py:
def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                return [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)]
---
[Medium] class MockDetectorStateHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorStateHandler(DetectorHandler[dict]):
            def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                group_keys = data_packet.packet.get(""group_keys"", [None])
                return [
                    DetectorEvaluationResult(
                        group_key,
                        True,
                        DetectorPriorityLevel.HIGH,
                    )
                    for group_key in group_keys
                
---
[Medium] function evaluate in tests/sentry/workflow_engine/processors/test_detector.py:
def evaluate(self, data_packet: DataPacket[dict]) -> list[DetectorEvaluationResult]:
                group_keys = data_packet.packet.get(""group_keys"", [None])
                return [
                    DetectorEvaluationResult(
                        group_key,
                        True,
                        DetectorPriorityLevel.HIGH,
                    )
                    for group_key in group_keys
                ]
---
[Medium] function build_data_packet in tests/sentry/workflow_engine/processors/test_detector.py:
def build_data_packet(self, **kwargs):
        query_id = ""1234""
        return DataPacket[dict](query_id, {""query_id"": query_id, ""some"": ""data"", **kwargs})
---
[Medium] function test in tests/sentry/workflow_engine/processors/test_detector.py:
def test(self):
        detector = self.create_detector(type=self.handler_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [detector])
        assert results == [
            (
                detector,
                [DetectorEvaluationResult(None, True, DetectorPriorityLevel.HIGH)],
            )
        ]
---
[Medium] function test_state_results in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet()
        results = process_detectors(data_packet, [detector])
        result = DetectorEvaluationResult(
            None,
            True,
            DetectorPriorityLevel.HIGH,
        )
        assert results == [
            (
                detector,
                [result],
            )
        ]
---
[Medium] function test_state_results_multi_group in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results_multi_group(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet(group_keys=[""group_1"", ""group_2""])
        results = process_detectors(data_packet, [detector])
        result_1 = DetectorEvaluationResult(
            ""group_1"",
            True,
            DetectorPriorityLevel.HIGH,
        )
        result_2 = DetectorEvaluationResult(
            ""group_2"",
            True,
            Detector
---
[Medium] function test_state_results_multi_group_dupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_state_results_multi_group_dupe(self):
        detector = self.create_detector(type=self.handler_state_type.slug)
        data_packet = self.build_data_packet(group_keys=[""dupe"", ""dupe""])
        with mock.patch(""sentry.workflow_engine.processors.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert mock_logger.error.call_args[0][0] == ""Duplicate detector state group keys found""
        result = DetectorEvaluationResult(
   
---
[Medium] function test_no_issue_type in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_issue_type(self):
        detector = self.create_detector(type=""invalid slug"")
        data_packet = self.build_data_packet()
        with mock.patch(""sentry.workflow_engine.models.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert mock_logger.error.call_args[0][0] == ""No registered grouptype for detector""
        assert results == []
---
[Medium] function test_no_handler in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_handler(self):
        detector = self.create_detector(type=self.no_handler_type.slug)
        data_packet = self.build_data_packet()
        with mock.patch(""sentry.workflow_engine.models.detector.logger"") as mock_logger:
            results = process_detectors(data_packet, [detector])
            assert (
                mock_logger.error.call_args[0][0]
                == ""Registered grouptype for detector has no detector_handler""
            )
        assert results == []
---
[Medium] class StatefulDetectorHandlerTestMixin in tests/sentry/workflow_engine/processors/test_detector.py:
class StatefulDetectorHandlerTestMixin(TestCase):
    __test__ = Abstract(__module__, __qualname__)

    def setUp(self):
        super().setUp()
        self.sm_comp_patcher = mock.patch.object(
            StatusChangeMessage, ""__eq__"", status_change_comparator
        )
        self.sm_comp_patcher.__enter__()

    def tearDown(self):
        super().tearDown()
        self.sm_comp_patcher.__exit__(None, None, None)

    def build_handler(self, detector: Detector | None = None) -> MockDetecto
---
[Medium] function setUp in tests/sentry/workflow_engine/processors/test_detector.py:
def setUp(self):
        super().setUp()
        self.sm_comp_patcher = mock.patch.object(
            StatusChangeMessage, ""__eq__"", status_change_comparator
        )
        self.sm_comp_patcher.__enter__()
---
[Medium] function build_handler in tests/sentry/workflow_engine/processors/test_detector.py:
def build_handler(self, detector: Detector | None = None) -> MockDetectorStateHandler:
        if detector is None:
            detector = self.create_detector(
                workflow_condition_group=self.create_data_condition_group()
            )
            self.create_data_condition(
                condition=""gt"",
                comparison=5,
                condition_result=DetectorPriorityLevel.HIGH,
                condition_group=detector.workflow_condition_group,
            )
     
---
[Medium] class TestEvaluate in tests/sentry/workflow_engine/processors/test_detector.py:
class TestEvaluate(StatefulDetectorHandlerTestMixin):
    def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == []
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""va
---
[Medium] function test in tests/sentry/workflow_engine/processors/test_detector.py:
def test(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1})) == []
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
---
[Medium] function test_above_below_threshold in tests/sentry/workflow_engine/processors/test_detector.py:
def test_above_below_threshold(self):
        handler = self.build_handler()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 1, ""group_vals"": {""val1"": 0}})) == []
        handler.commit_state_updates()
        assert handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 6}})) == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        ha
---
[Medium] function test_no_condition_group in tests/sentry/workflow_engine/processors/test_detector.py:
def test_no_condition_group(self):
        detector = self.create_detector()
        handler = MockDetectorStateHandler(detector)
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            assert (
                handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 100}})) == []
            )
            mock_metrics.incr.assert_called_once_with(
                ""workflow_engine.detector.skipping_invalid_condition_group""
         
---
[Medium] function test_results_on_change in tests/sentry/workflow_engine/processors/test_detector.py:
def test_results_on_change(self):
        handler = self.build_handler()
        result = handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 100}}))
        assert result == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
        handler.commit_state_updates()
---
[Medium] function test_dedupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_dedupe(self):
        handler = self.build_handler()
        result = handler.evaluate(DataPacket(""1"", {""dedupe"": 2, ""group_vals"": {""val1"": 8}}))
        assert result == [
            DetectorEvaluationResult(
                group_key=""val1"",
                is_active=True,
                priority=DetectorPriorityLevel.HIGH,
            )
        ]
        self.assert_updates(handler, ""val1"", 2, {}, True, DetectorPriorityLevel.HIGH)
        handler.commit_state_updates()
        with
---
[Medium] class TestEvaluateGroupKeyValue in tests/sentry/workflow_engine/processors/test_detector.py:
class TestEvaluateGroupKeyValue(StatefulDetectorHandlerTestMixin):
    def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                DetectorPriorityLevel.HIGH,
            )
            assert (
                handler.evaluate_group_key_value(
                    expected_result.
---
[Medium] function test_dedupe in tests/sentry/workflow_engine/processors/test_detector.py:
def test_dedupe(self):
        handler = self.build_handler()
        with mock.patch(""sentry.workflow_engine.processors.detector.metrics"") as mock_metrics:
            expected_result = DetectorEvaluationResult(
                ""group_key"",
                True,
                DetectorPriorityLevel.HIGH,
            )
            assert (
                handler.evaluate_group_key_value(
                    expected_result.group_key,
                    10,
                    DetectorStateDat
---
[Medium] function test_status_change in tests/sentry/workflow_engine/processors/test_detector.py:
def test_status_change(self):
        handler = self.build_handler()
        assert (
            handler.evaluate_group_key_value(
                ""group_key"",
                0,
                DetectorStateData(
                    ""group_key"",
                    False,
                    DetectorPriorityLevel.OK,
                    1,
                    {},
                ),
                dedupe_value=2,
            )
            is None
        )
        assert handler.evaluate_group
---
[Medium] class DetectorHandler in src/sentry/workflow_engine/processors/detector.py:
class DetectorHandler(abc.ABC, Generic[T]):
    def __init__(self, detector: Detector):
        self.detector = detector
        if detector.workflow_condition_group_id is not None:
            results = get_data_group_conditions_and_group(detector.workflow_condition_group_id)
            self.condition_group: DataConditionGroup | None = results[0]
            self.conditions: list[DataCondition] = results[1]
        else:
            self.condition_group = None
            self.conditions = []

---
[Medium] function evaluate in src/sentry/workflow_engine/processors/detector.py:
@abc.abstractmethod
    def evaluate(
        self, data_packet: DataPacket[T]
    ) -> dict[DetectorGroupKey, DetectorEvaluationResult]:
        pass
---
[Medium] function evaluate in src/sentry/workflow_engine/processors/detector.py:
def evaluate(
        self, data_packet: DataPacket[T]
    ) -> dict[DetectorGroupKey, DetectorEvaluationResult]:
        """"""
        Evaluates a given data packet and returns a list of `DetectorEvaluationResult`.
        There will be one result for each group key result in the packet, unless the
        evaluation is skipped due to various rules.
        """"""
        dedupe_value = self.get_dedupe_value(data_packet)
        group_values = self.get_group_key_values(data_packet)
        all_state
---
[Medium] class MockDetectorStateHandler in tests/sentry/workflow_engine/processors/test_detector.py:
class MockDetectorStateHandler(StatefulDetectorHandler[dict]):
    counter_names = [""test1"", ""test2""]

    def get_dedupe_value(self, data_packet: DataPacket[dict]) -> int:
        return data_packet.packet.get(""dedupe"", 0)

    def get_group_key_values(self, data_packet: DataPacket[dict]) -> dict[str, int]:
        return data_packet.packet.get(""group_vals"", {})

    def build_occurrence_and_event_data(
        self, group_key: DetectorGroupKey, value: int, new_status: PriorityLevel
    ) -> tu
---
[Medium] function evaluate_group_key_value in src/sentry/workflow_engine/processors/detector.py:
def evaluate_group_key_value(
        self,
        group_key: DetectorGroupKey,
        value: int,
        state_data: DetectorStateData,
        dedupe_value: int,
    ) -> DetectorEvaluationResult | None:
        """"""
        Evaluates a value associated with a given `group_key` and returns a `DetectorEvaluationResult` with the results
        and any state changes that need to be made.

        Checks that we haven't already processed this datapacket for this group_key, and skips evaluation ","Detector (Critical), process_detectors (Critical), MetricAlertDetectorHandler (Medium), StatefulDetectorHandler (Medium), TestProcessDetectors (Medium), TestEvaluate (Medium), TestEvaluateGroupKeyValue (Medium), evaluate (Medium), TestProcessDetectors (Medium), setUp (Medium), MockDetectorHandler (Medium), evaluate (Medium), MockDetectorStateHandler (Medium), evaluate (Medium), build_data_packet (Medium), test (Medium), test_state_results (Medium), test_state_results_multi_group (Medium), test_state_results_multi_group_dupe (Medium), test_no_issue_type (Medium), test_no_handler (Medium), StatefulDetectorHandlerTestMixin (Medium), setUp (Medium), build_handler (Medium), TestEvaluate (Medium), test (Medium), test_above_below_threshold (Medium), test_no_condition_group (Medium), test_results_on_change (Medium), test_dedupe (Medium), TestEvaluateGroupKeyValue (Medium), test_dedupe (Medium), test_status_change (Medium), DetectorHandler (Medium), evaluate (Medium), evaluate (Medium), MockDetectorStateHandler (Medium), evaluate_group_key_value (Medium), build_occurrence_and_event_data (Low), build_occurrence_and_event_data (Low), BaseDetectorHandlerTest (Low), setUp (Low), MockDetectorHandler (Low), evaluate (Low), create_detector_and_conditions (Low), build_handler (Low), build_mock_occurrence_and_event (Low), TestCommitStateUpdateData (Low), TestGetStateData (Low), NoHandlerGroupType (Low), HandlerGroupType (Low), HandlerStateGroupType (Low), tearDown (Low), assert_updates (Low)",match,'DetectorGroupKey' matches HC entity 'detector'
sentry,9,feat(uptime): Add ability to use queues to manage parallelism,The queue.shutdown() method with 'immediate=False' parameter may not exist in the standard Python queue module. This could cause AttributeError at runtime. Verify the correct API or implement a custom shutdown mechanism.,High,87,35,35,"function::result_processor (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.96] | class::ResultsStrategyFactory (src/sentry/remote_subscriptions/consumers/result_consumer.py) [Critical, score=0.83] | function::WorkItem (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [Critical, score=0.83] | function::decoder (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.80] | function::identifier (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.75] | function::add_offset (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | function::complete_offset (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | class::FixedQueuePool (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | class::SimpleQueueProcessingStrategy (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | function::grouping_fn (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.65] | function::create_message (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.64] | class::OffsetTracker (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.63] | function::get_committable_offsets (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.63] | function::_get_partition_lock (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::mark_committed (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::get_queue_for_group (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::__init__ (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::get_stats (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::shutdown (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::topic_for_codec (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.56] | function::join (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.55] | function::subscription_model (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::get_subscription_id (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::handle_result (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | class::MockResultProcessor (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::result_processor_cls (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::build_payload_grouping_key (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | class::OrderedQueueWorker (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::submit (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::wait_until_empty (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::create_thread_queue_parallel_worker (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::commit_offsets (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::create_with_partitions (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::__init__ (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::shutdown (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50]","[Critical] function result_processor in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def result_processor(identifier: str, item: str):
            with self.process_lock:
                self.processed_items.append((identifier, item))
                self.items_processed += 1
                if self.items_processed >= self.expected_items:
                    self.process_complete_event.set()
---
[Critical] class ResultsStrategyFactory in src/sentry/remote_subscriptions/consumers/result_consumer.py:
class ResultsStrategyFactory(ProcessingStrategyFactory[KafkaPayload], Generic[T, U]):
    parallel_executor: ThreadPoolExecutor | None = None

    batched_parallel = False
    """"""
    Does the consumer process unrelated messages in parallel?
    """"""

    max_batch_size = 500
    """"""
    How many messages will be batched at once when in parallel mode.
    """"""

    max_batch_time = 10
    """"""
    The maximum time in seconds to accumulate a bach of check-ins.
    """"""

    parallel = False
    """"""
    Does the consumer process all messages in parallel.
    """"""

    thread_queue_parallel = False
    """"""
    Does the consumer use thread-queue-parallel processing?
    """"""

    multiprocessing_pool: MultiprocessingPool | None = None
    queue_pool: FixedQueuePool | None = None
    input_block_size
---
[Critical] function WorkItem in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
@dataclass
class WorkItem(Generic[T]):
    """"""Work item that includes the original message for offset tracking.""""""

    partition: Partition
    offset: int
    result: T
    message: Message[KafkaPayload | FilteredPayload]
---
[Critical] function decoder in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def decoder(payload: KafkaPayload | FilteredPayload) -> dict | None:
            if isinstance(payload, FilteredPayload):
                return None
            return {""subscription_id"": payload.value.decode(), ""data"": ""test""}
---
[Critical] function identifier in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def identifier(self):
                return ""test""
---
[High] function add_offset in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def add_offset(self, partition: Partition, offset: int) -> None:
        """"""Record that we've started processing an offset.""""""
        with self._get_partition_lock(partition):
            self.all_offsets[partition].add(offset)
            self.outstanding[partition].add(offset)
---
[High] function complete_offset in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def complete_offset(self, partition: Partition, offset: int) -> None:
        """"""Mark an offset as completed.""""""
        with self._get_partition_lock(partition):
            self.outstanding[partition].discard(offset)
---
[High] class FixedQueuePool in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class FixedQueuePool(Generic[T]):
    """"""
    Fixed pool of queues that guarantees order within groups.

    Key properties:
    - Each group is consistently assigned to the same queue
    - Each queue has exactly one worker thread
    - Items within a queue are processed in FIFO order
    - No dynamic reassignment that could break ordering
    - Tracks offset completion for safe commits
    """"""

    def __init__(
        self,
        result_processor: Callable[[str, T], None],
        identifier: str,
        num_queues: int = 20,
    ) -> None:
        self.result_processor = result_processor
        self.identifier = identifier
        self.num_queues = num_queues
        self.offset_tracker = OffsetTracker()
        self.queues: list[queue.Queue[WorkItem[T]]] = []
        self.workers
---
[High] class SimpleQueueProcessingStrategy in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class SimpleQueueProcessingStrategy(ProcessingStrategy[KafkaPayload], Generic[T]):
    """"""
    Processing strategy that uses a fixed pool of queues.

    Guarantees:
    - Items for the same group are processed in order
    - No item is lost or processed out of order
    - Natural backpressure when queues fill up
    - Only commits offsets after successful processing
    """"""

    def __init__(
        self,
        queue_pool: FixedQueuePool[T],
        decoder: Callable[[KafkaPayload | FilteredPayload], T | None],
        grouping_fn: Callable[[T], str],
        commit_function: Callable[[dict[Partition, int]], None],
    ) -> None:
        self.queue_pool = queue_pool
        self.decoder = decoder
        self.grouping_fn = grouping_fn
        self.commit_function = commit_function
    
---
[High] function grouping_fn in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def grouping_fn(result: dict) -> str:
            return result[""subscription_id""]
---
[High] function create_message in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def create_message(self, subscription_id: str, partition: int, offset: int) -> Message:
        """"""Helper to create a test message.""""""
        payload = KafkaPayload(
            key=None,
            value=subscription_id.encode(),
            headers=[],
        )
        return Message(
            BrokerValue(
                payload,
                Partition(Topic(""test""), partition),
                offset,
                datetime.now(),
            )
        )
---
[High] class OffsetTracker in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class OffsetTracker:
    """"""
    Tracks outstanding offsets and determines which offsets are safe to commit.

    - Tracks offsets per partition
    - Only commits offsets when all prior offsets are processed
    - Thread-safe for concurrent access with per-partition locks
    """"""

    def __init__(self) -> None:
        self.all_offsets: dict[Partition, set[int]] = defaultdict(set)
        self.outstanding: dict[Partition, set[int]] = defaultdict(set)
        self.last_committed: dict[Partition, int] = {}
        self.partition_locks: dict[Partition, threading.Lock] = {}

    def _get_partition_lock(self, partition: Partition) -> threading.Lock:
        """"""Get or create a lock for a partition.""""""
        lock = self.partition_locks.get(partition)
        if lock:
            return lock
 
---
[High] function get_committable_offsets in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_committable_offsets(self) -> dict[Partition, int]:
        """"""
        Get the highest offset per partition that can be safely committed.

        For each partition, finds the highest contiguous offset that has been processed.
        """"""
        committable = {}
        for partition in list(self.all_offsets.keys()):
            with self._get_partition_lock(partition):
                all_offsets = self.all_offsets[partition]
                if not all_offsets:
                    continue

                outstanding = self.outstanding[partition]
                last_committed = self.last_committed.get(partition, -1)

                min_offset = min(all_offsets)
                max_offset = max(all_offsets)

                start = max(last_committed + 1, min_offset)

        
---
[High] function _get_partition_lock in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def _get_partition_lock(self, partition: Partition) -> threading.Lock:
        """"""Get or create a lock for a partition.""""""
        lock = self.partition_locks.get(partition)
        if lock:
            return lock
        return self.partition_locks.setdefault(partition, threading.Lock())
---
[High] function mark_committed in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def mark_committed(self, partition: Partition, offset: int) -> None:
        """"""Update the last committed offset for a partition.""""""
        with self._get_partition_lock(partition):
            self.last_committed[partition] = offset
            # Remove all offsets <= committed offset
            self.all_offsets[partition] = {o for o in self.all_offsets[partition] if o > offset}
---
[High] function get_queue_for_group in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_queue_for_group(self, group_key: str) -> int:
        """"""
        Get queue index for a group using consistent hashing.
        """"""
        return hash(group_key) % self.num_queues
---
[High] function __init__ in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def __init__(self) -> None:
        self.all_offsets: dict[Partition, set[int]] = defaultdict(set)
        self.outstanding: dict[Partition, set[int]] = defaultdict(set)
        self.last_committed: dict[Partition, int] = {}
        self.partition_locks: dict[Partition, threading.Lock] = {}
---
[High] function get_stats in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_stats(self) -> dict[str, Any]:
        """"""Get statistics about queue depths.""""""
        queue_depths = [q.qsize() for q in self.queues]
        return {
            ""queue_depths"": queue_depths,
            ""total_items"": sum(queue_depths),
        }
---
[High] function shutdown in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def shutdown(self) -> None:
        """"""Gracefully shutdown all workers.""""""
        for worker in self.workers:
            worker.shutdown = True

        for q in self.queues:
            try:
                q.shutdown(immediate=False)
            except Exception:
                logger.exception(""Error shutting down queue"")

        for worker in self.workers:
            worker.join(timeout=5.0)
---
[High] function topic_for_codec in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def topic_for_codec(self):
                return Topic(""test"")
---
[High] function join in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def join(self, timeout: float | None = None) -> None:
        self.close()
---
[High] function subscription_model in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def subscription_model(self):
                return mock.Mock()
---
[High] function get_subscription_id in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def get_subscription_id(self, result):
                return result.get(""subscription_id"", ""unknown"")
---
[High] function handle_result in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def handle_result(self, subscription, result):
                pass
---
[High] class MockResultProcessor in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
class MockResultProcessor(ResultProcessor):
            @property
            def subscription_model(self):
                return mock.Mock()

            def get_subscription_id(self, result):
                return result.get(""subscription_id"", ""unknown"")

            def handle_result(self, subscription, result):
                pass
---
[High] function result_processor_cls in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def result_processor_cls(self):
                return MockResultProcessor
---
[High] function build_payload_grouping_key in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def build_payload_grouping_key(self, result):
                return result.get(""subscription_id"", ""unknown"")
---
[High] class OrderedQueueWorker in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class OrderedQueueWorker(threading.Thread, Generic[T]):
    """"""Worker thread that processes items from a queue in order.""""""

    def __init__(
        self,
        worker_id: int,
        work_queue: queue.Queue[WorkItem[T]],
        result_processor: Callable[[str, T], None],
        identifier: str,
        offset_tracker: OffsetTracker,
    ) -> None:
        super().__init__(daemon=True)
        self.worker_id = worker_id
        self.work_queue = work_queue
        self.result_processor = result_processor
        self.identifier = identifier
        self.offset_tracker = offset_tracker
        self.shutdown = False

    def run(self) -> None:
        """"""Process items from the queue in order.""""""
        while not self.shutdown:
            try:
                work_item = self.work_qu
---
[High] function submit in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def submit(self, group_key: str, work_item: WorkItem[T]) -> None:
        """"""
        Submit a work item to the appropriate queue.
        """"""
        queue_index = self.get_queue_for_group(group_key)
        work_queue = self.queues[queue_index]

        self.offset_tracker.add_offset(work_item.partition, work_item.offset)
        work_queue.put(work_item)
---
[High] function wait_until_empty in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def wait_until_empty(self, timeout: float = 5.0) -> bool:
        """"""Wait until all queues are empty. Returns True if successful, False if timeout.""""""
        start_time = time.time()
        while time.time() - start_time < timeout:
            if self.get_stats()[""total_items""] == 0:
                return True
            time.sleep(0.01)
        return False
---
[High] function create_thread_queue_parallel_worker in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def create_thread_queue_parallel_worker(
        self, commit: Commit
    ) -> ProcessingStrategy[KafkaPayload]:
        assert self.queue_pool is not None

        def commit_offsets(offsets: dict[Partition, int]):
            # We add + 1 here because the committed offset should represent the next offset to read from
            commit_data = {partition: offset + 1 for partition, offset in offsets.items()}
            commit(commit_data)

        return SimpleQueueProcessingStrategy(
            queue_pool=self.queue_pool,
            decoder=partial(self.decode_payload, self.topic_for_codec),
            grouping_fn=self.build_payload_grouping_key,
            commit_function=commit_offsets,
        )
---
[High] function commit_offsets in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def commit_offsets(offsets: dict[Partition, int]):
            # We add + 1 here because the committed offset should represent the next offset to read from
            commit_data = {partition: offset + 1 for partition, offset in offsets.items()}
            commit(commit_data)
---
[High] function create_with_partitions in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def create_with_partitions(
        self,
        commit: Commit,
        partitions: Mapping[Partition, int],
    ) -> ProcessingStrategy[KafkaPayload]:
        if self.batched_parallel:
            return self.create_thread_parallel_worker(commit)
        if self.parallel:
            return self.create_multiprocess_worker(commit)
        if self.thread_queue_parallel:
            return self.create_thread_queue_parallel_worker(commit)
        else:
            return self.create_serial_worker(commit)
---
[High] function __init__ in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def __init__(
        self,
        mode: Literal[""batched-parallel"", ""parallel"", ""serial"", ""thread-queue-parallel""] = ""serial"",
        max_batch_size: int | None = None,
        max_batch_time: int | None = None,
        max_workers: int | None = None,
        num_processes: int | None = None,
        input_block_size: int | None = None,
        output_block_size: int | None = None,
    ) -> None:
        self.mode = mode
        metric_tags = {""identifier"": self.identifier, ""mode"": self.mode}
        self.result_processor = self.result_processor_cls()
        if mode == ""batched-parallel"":
            self.batched_parallel = True
            self.parallel_executor = ThreadPoolExecutor(max_workers=max_workers)
            if max_workers is None:
                metric_tags[""workers""] = ""
---
[High] function shutdown in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def shutdown(self) -> None:
        if self.parallel_executor:
            self.parallel_executor.shutdown()
        if self.queue_pool:
            self.queue_pool.shutdown()
            self.queue_pool = None","[Medium] function setUp in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def setUp(self):
        self.tracker = OffsetTracker()
        self.partition1 = Partition(Topic(""test""), 0)
        self.partition2 = Partition(Topic(""test""), 1)
---
[Medium] function track_commits in tests/sentry/uptime/consumers/test_results_consumer.py:
def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)
---
[Medium] function tracked_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def tracked_commit(
                        offsets: Mapping[Partition, int], force: bool = False
                    ) -> None:
                        nonlocal commit_count
                        commit_count += 1
                        commits_made.append(dict(offsets))
                        return commit(offsets, force)
---
[Medium] function run in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def run(self) -> None:
        """"""Process items from the queue in order.""""""
        while not self.shutdown:
            try:
                work_item = self.work_queue.get()
            except queue.ShutDown:
                break

            try:
                with sentry_sdk.start_transaction(
                    op=""queue_worker.process"",
                    name=f""monitors.{self.identifier}.worker_{self.worker_id}"",
                ):
                    self.result_processor(self.ident
---
[Medium] function poll in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def poll(self) -> None:
        stats = self.queue_pool.get_stats()
        metrics.gauge(
            ""remote_subscriptions.queue_pool.total_queued"",
            stats[""total_items""],
            tags={""identifier"": self.queue_pool.identifier},
        )
---
[Medium] function close in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def close(self) -> None:
        self.shutdown_event.set()
        self.commit_thread.join(timeout=5.0)
        self.queue_pool.shutdown()
---
[Medium] function terminate in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def terminate(self) -> None:
        self.shutdown_event.set()
        self.queue_pool.shutdown()
---
[Medium] function tearDown in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def tearDown(self):
        self.pool.shutdown()
---
[Medium] class MockFactory in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
class MockFactory(ResultsStrategyFactory):
            @property
            def topic_for_codec(self):
                return Topic(""test"")

            @property
            def result_processor_cls(self):
                return MockResultProcessor

            def build_payload_grouping_key(self, result):
                return result.get(""subscription_id"", ""unknown"")

            @property
            def identifier(self):
                return ""test""
---
[Medium] function track_calls in tests/sentry/uptime/consumers/test_results_consumer.py:
def track_calls(identifier, result):
                processed_guids.append(result[""guid""])
---
[Medium] function create_with_partitions_tracking in tests/sentry/uptime/consumers/test_results_consumer.py:
def create_with_partitions_tracking(commit, partitions):
                    def tracked_commit(
                        offsets: Mapping[Partition, int], force: bool = False
                    ) -> None:
                        nonlocal commit_count
                        commit_count += 1
                        commits_made.append(dict(offsets))
                        return commit(offsets, force)

                    return original_create_with_partitions(tracked_commit, partitions)
---
[Medium] function test_simple_tracking in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_simple_tracking(self):
        """"""Test basic offset tracking and committing.""""""
        self.tracker.add_offset(self.partition1, 100)
        self.tracker.add_offset(self.partition1, 101)
        self.tracker.add_offset(self.partition1, 102)

        committable = self.tracker.get_committable_offsets()
        assert committable == {}

        self.tracker.complete_offset(self.partition1, 100)
        committable = self.tracker.get_committable_offsets()
        assert committable == {se
---
[Medium] function test_multiple_partitions in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_multiple_partitions(self):
        """"""Test tracking across multiple partitions.""""""
        self.tracker.add_offset(self.partition1, 100)
        self.tracker.add_offset(self.partition1, 101)
        self.tracker.add_offset(self.partition2, 200)
        self.tracker.add_offset(self.partition2, 201)

        self.tracker.complete_offset(self.partition1, 100)
        self.tracker.complete_offset(self.partition2, 200)
        self.tracker.complete_offset(self.partition2, 201)

        commi
---
[Medium] function test_consistent_group_assignment in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_consistent_group_assignment(self):
        """"""Test that groups are consistently assigned to the same queue.""""""
        group_key = ""group1""
        queue_index1 = self.pool.get_queue_for_group(group_key)
        queue_index2 = self.pool.get_queue_for_group(group_key)
        queue_index3 = self.pool.get_queue_for_group(group_key)

        assert queue_index1 == queue_index2 == queue_index3
---
[Medium] function test_different_groups_distributed in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_different_groups_distributed(self):
        """"""Test that different groups are distributed across queues.""""""
        queue_indices = set()
        for i in range(20):
            group_key = f""group{i}""
            queue_index = self.pool.get_queue_for_group(group_key)
            queue_indices.add(queue_index)

        assert len(queue_indices) == 3
---
[Medium] function test_ordered_processing_within_group in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_ordered_processing_within_group(self):
        """"""Test that items within a group are processed in order.""""""
        partition = Partition(Topic(""test""), 0)
        group_key = ""ordered_group""

        self.expected_items = 5
        self.process_complete_event.clear()

        for i in range(5):
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{i}"",
                message=Message(
                    BrokerVa
---
[Medium] function test_concurrent_processing_across_groups in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_concurrent_processing_across_groups(self):
        """"""Test that different groups are processed concurrently.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 6
        self.process_complete_event.clear()

        for i in range(6):
            group_key = f""group_{i % 3}""
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{group_key}_{i}"",
                message=Message(
       
---
[Medium] function test_stats_reporting in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_stats_reporting(self):
        """"""Test queue statistics reporting.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 10
        self.process_complete_event.clear()

        for i in range(10):
            group_key = f""group_{i % 4}""
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{i}"",
                message=Message(
                    BrokerValue(
                        Ka
---
[Medium] function test_message_processing in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_message_processing(self):
        """"""Test basic message processing.""""""
        partition = 0
        message = self.create_message(""sub1"", partition, 100)

        self.expected_items = 1
        self.process_complete_event.clear()

        self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        assert len(self.processed_results) == 1
        assert self.processed_results[0][""subscription_id""] == ""sub1""
---
[Medium] function test_offset_committing in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_offset_committing(self):
        """"""Test that offsets are committed after processing.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 5
        self.process_complete_event.clear()
        self.commit_event.clear()
        for i in range(5):
            message = self.create_message(""sub1"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        ass
---
[Medium] function test_preserves_order_within_group in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_preserves_order_within_group(self):
        """"""Test that messages for the same subscription are processed in order.""""""
        self.expected_items = 5
        self.process_complete_event.clear()

        for i in range(5):
            message = self.create_message(""sub1"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        assert len(self.processed_results) == 5
---
[Medium] function test_concurrent_processing_different_groups in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_concurrent_processing_different_groups(self):
        """"""Test that different subscriptions are processed concurrently.""""""
        self.expected_items = 4
        self.process_complete_event.clear()

        for i in range(4):
            message = self.create_message(f""sub{i % 2}"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""

        assert len(self.processed_results) == 4
---
[Medium] function test_handles_invalid_messages in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_handles_invalid_messages(self):
        """"""Test that invalid messages don't block offset commits.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 1
        self.process_complete_event.clear()
        self.commit_event.clear()

        invalid_message = Message(
            BrokerValue(
                FilteredPayload(),
                partition,
                100,
                datetime.now(),
            )
        )

        self.strategy.submit(i
---
[Medium] function test_offset_gaps_block_commits in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_offset_gaps_block_commits(self):
        """"""Test that gaps in offsets prevent committing past the gap.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 3  # First batch
        self.process_complete_event.clear()
        self.commit_event.clear()

        self.strategy.submit(self.create_message(""sub1"", 0, 100))
        self.strategy.submit(self.create_message(""sub1"", 0, 102))
        self.strategy.submit(self.create_message(""sub1"", 0, 103))

        ass
---
[Medium] function test_factory_creates_thread_queue_parallel_strategy in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_factory_creates_thread_queue_parallel_strategy(self):
        """"""Test that the factory properly creates thread-queue-parallel strategy.""""""
        from sentry.remote_subscriptions.consumers.result_consumer import (
            ResultProcessor,
            ResultsStrategyFactory,
        )

        class MockResultProcessor(ResultProcessor):
            @property
            def subscription_model(self):
                return mock.Mock()

            def get_subscription_id(self, result
---
[Medium] function test_thread_queue_parallel in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel(self) -> None:
        """"""
        Validates that the consumer in thread-queue-parallel mode processes messages correctly
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        with mock.patch.object(type(factory.result_processor), ""__call__"") as mock_processor_call:
            subscription
---
[Medium] function test_thread_queue_parallel_preserves_order in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_preserves_order(self) -> None:
        """"""
        Test that thread-queue-parallel mode preserves order within subscriptions.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=3,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        with mock.patch.object(type(factory.result_processor), ""__call__"") as mock_processor_call:
            processe
---
[Medium] function test_thread_queue_parallel_concurrent_subscriptions in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_concurrent_subscriptions(self) -> None:
        """"""
        Test that different subscriptions are processed concurrently in thread-queue-parallel mode.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
        commit = mock.Mock()
        consumer = factory.create_with_partitions(commit, {self.partition: 0})

        subscription_2 = self.create_uptime_subscription(
           
---
[Medium] function test_thread_queue_parallel_offset_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_offset_commit(self) -> None:
        """"""
        Test that offsets are committed after successful processing in thread-queue-parallel mode.
        """"""
        committed_offsets: dict[Partition, int] = {}

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
---
[Medium] function test_thread_queue_parallel_error_handling in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_error_handling(self) -> None:
        """"""
        Test that errors in processing don't block offset commits for other messages.
        """"""
        committed_offsets: dict[Partition, int] = {}

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )

        te
---
[Medium] function test_thread_queue_parallel_offset_gaps in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_offset_gaps(self) -> None:
        """"""
        Test that offset gaps prevent committing past the gap.
        """"""
        all_commits = []

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            all_commits.append(dict(offsets))

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=1,
        )

        test_partition = Partition(Topic(""test""), 1)
        con
---
[Medium] function test_thread_queue_parallel_graceful_shutdown in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_graceful_shutdown(self) -> None:
        """"""
        Test that the thread-queue-parallel consumer shuts down gracefully.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=3,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        for i in range(5):
            result = self.create_uptime_result(
                self.subscription.subscription_id
---
[Medium] function test_thread_queue_parallel_kafka_offset_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_kafka_offset_commit(self) -> None:
        """"""
        Test that offsets are actually committed to Kafka consumer group.
        """"""
        subscription = self.create_uptime_subscription(
            subscription_id=uuid.uuid4().hex, interval_seconds=300, region_slugs=[""default""]
        )
        self.create_project_uptime_subscription(
            uptime_subscription=subscription,
            owner=self.user,
        )

        test_id = uuid.uuid4().hex[:8]
   
---
[Medium] class ProcessResultSerialTest in tests/sentry/uptime/consumers/test_results_consumer.py:
class ProcessResultSerialTest(ProcessResultTest):
    strategy_processing_mode = ""serial""

    def test_parallel(self) -> None:
        """"""
        Validates that the consumer in parallel mode correctly groups check-ins
        into groups by their monitor slug / environment
        """"""

        factory = UptimeResultsStrategyFactory(
            mode=""batched-parallel"",
            max_batch_size=3,
            max_workers=1,
        )
        consumer = factory.create_with_partitions(mock.Mock
---
[Medium] function uptime_options in src/sentry/consumers/__init__.py:
def uptime_options() -> list[click.Option]:
    """"""Return a list of uptime-results options.""""""
    options = [
        click.Option(
            [""--mode"", ""mode""],
            type=click.Choice([""serial"", ""parallel"", ""batched-parallel"", ""thread-queue-parallel""]),
            default=""serial"",
            help=""The mode to process results in. Parallel uses multithreading."",
        ),
        click.Option(
            [""--max-batch-size"", ""max_batch_size""],
            type=int,
            defa","result_processor (Critical), ResultsStrategyFactory (Critical), WorkItem (Critical), decoder (Critical), identifier (Critical), add_offset (High), complete_offset (High), FixedQueuePool (High), SimpleQueueProcessingStrategy (High), grouping_fn (High), create_message (High), OffsetTracker (High), get_committable_offsets (High), _get_partition_lock (High), mark_committed (High), get_queue_for_group (High), __init__ (High), get_stats (High), shutdown (High), topic_for_codec (High), join (High), subscription_model (High), get_subscription_id (High), handle_result (High), MockResultProcessor (High), result_processor_cls (High), build_payload_grouping_key (High), OrderedQueueWorker (High), submit (High), wait_until_empty (High), create_thread_queue_parallel_worker (High), commit_offsets (High), create_with_partitions (High), __init__ (High), shutdown (High), setUp (Medium), track_commits (Medium), tracked_commit (Medium), run (Medium), poll (Medium), close (Medium), terminate (Medium), tearDown (Medium), MockFactory (Medium), track_calls (Medium), create_with_partitions_tracking (Medium), test_simple_tracking (Medium), test_multiple_partitions (Medium), test_consistent_group_assignment (Medium), test_different_groups_distributed (Medium), test_ordered_processing_within_group (Medium), test_concurrent_processing_across_groups (Medium), test_stats_reporting (Medium), test_message_processing (Medium), test_offset_committing (Medium), test_preserves_order_within_group (Medium), test_concurrent_processing_different_groups (Medium), test_handles_invalid_messages (Medium), test_offset_gaps_block_commits (Medium), test_factory_creates_thread_queue_parallel_strategy (Medium), test_thread_queue_parallel (Medium), test_thread_queue_parallel_preserves_order (Medium), test_thread_queue_parallel_concurrent_subscriptions (Medium), test_thread_queue_parallel_offset_commit (Medium), test_thread_queue_parallel_error_handling (Medium), test_thread_queue_parallel_offset_gaps (Medium), test_thread_queue_parallel_graceful_shutdown (Medium), test_thread_queue_parallel_kafka_offset_commit (Medium), ProcessResultSerialTest (Medium), uptime_options (Medium), __init__ (Low), __init__ (Low), __init__ (Low), _commit_loop (Low), submit (Low), TestOffsetTracker (Low), TestFixedQueuePool (Low), setUp (Low), TestSimpleQueueProcessingStrategy (Low), setUp (Low), result_processor (Low), commit_function (Low), tearDown (Low), TestThreadQueueParallelIntegration (Low), track_commits (Low), track_commits (Low), ProcessResultThreadQueueParallelKafkaTest (Low)",match,'shutdown' matches HC entity 'shutdown'
sentry,9,feat(uptime): Add ability to use queues to manage parallelism,The magic number 50 for max_wait is used repeatedly throughout the tests. Consider extracting this as a named constant to improve maintainability.,Low,87,35,35,"function::result_processor (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.96] | class::ResultsStrategyFactory (src/sentry/remote_subscriptions/consumers/result_consumer.py) [Critical, score=0.83] | function::WorkItem (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [Critical, score=0.83] | function::decoder (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.80] | function::identifier (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.75] | function::add_offset (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | function::complete_offset (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | class::FixedQueuePool (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | class::SimpleQueueProcessingStrategy (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | function::grouping_fn (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.65] | function::create_message (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.64] | class::OffsetTracker (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.63] | function::get_committable_offsets (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.63] | function::_get_partition_lock (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::mark_committed (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::get_queue_for_group (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::__init__ (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::get_stats (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::shutdown (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::topic_for_codec (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.56] | function::join (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.55] | function::subscription_model (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::get_subscription_id (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::handle_result (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | class::MockResultProcessor (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::result_processor_cls (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::build_payload_grouping_key (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | class::OrderedQueueWorker (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::submit (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::wait_until_empty (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::create_thread_queue_parallel_worker (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::commit_offsets (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::create_with_partitions (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::__init__ (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::shutdown (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50]","[Critical] function result_processor in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def result_processor(identifier: str, item: str):
            with self.process_lock:
                self.processed_items.append((identifier, item))
                self.items_processed += 1
                if self.items_processed >= self.expected_items:
                    self.process_complete_event.set()
---
[Critical] class ResultsStrategyFactory in src/sentry/remote_subscriptions/consumers/result_consumer.py:
class ResultsStrategyFactory(ProcessingStrategyFactory[KafkaPayload], Generic[T, U]):
    parallel_executor: ThreadPoolExecutor | None = None

    batched_parallel = False
    """"""
    Does the consumer process unrelated messages in parallel?
    """"""

    max_batch_size = 500
    """"""
    How many messages will be batched at once when in parallel mode.
    """"""

    max_batch_time = 10
    """"""
    The maximum time in seconds to accumulate a bach of check-ins.
    """"""

    parallel = False
    """"""
    Does the consumer process all messages in parallel.
    """"""

    thread_queue_parallel = False
    """"""
    Does the consumer use thread-queue-parallel processing?
    """"""

    multiprocessing_pool: MultiprocessingPool | None = None
    queue_pool: FixedQueuePool | None = None
    input_block_size
---
[Critical] function WorkItem in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
@dataclass
class WorkItem(Generic[T]):
    """"""Work item that includes the original message for offset tracking.""""""

    partition: Partition
    offset: int
    result: T
    message: Message[KafkaPayload | FilteredPayload]
---
[Critical] function decoder in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def decoder(payload: KafkaPayload | FilteredPayload) -> dict | None:
            if isinstance(payload, FilteredPayload):
                return None
            return {""subscription_id"": payload.value.decode(), ""data"": ""test""}
---
[Critical] function identifier in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def identifier(self):
                return ""test""
---
[High] function add_offset in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def add_offset(self, partition: Partition, offset: int) -> None:
        """"""Record that we've started processing an offset.""""""
        with self._get_partition_lock(partition):
            self.all_offsets[partition].add(offset)
            self.outstanding[partition].add(offset)
---
[High] function complete_offset in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def complete_offset(self, partition: Partition, offset: int) -> None:
        """"""Mark an offset as completed.""""""
        with self._get_partition_lock(partition):
            self.outstanding[partition].discard(offset)
---
[High] class FixedQueuePool in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class FixedQueuePool(Generic[T]):
    """"""
    Fixed pool of queues that guarantees order within groups.

    Key properties:
    - Each group is consistently assigned to the same queue
    - Each queue has exactly one worker thread
    - Items within a queue are processed in FIFO order
    - No dynamic reassignment that could break ordering
    - Tracks offset completion for safe commits
    """"""

    def __init__(
        self,
        result_processor: Callable[[str, T], None],
        identifier: str,
        num_queues: int = 20,
    ) -> None:
        self.result_processor = result_processor
        self.identifier = identifier
        self.num_queues = num_queues
        self.offset_tracker = OffsetTracker()
        self.queues: list[queue.Queue[WorkItem[T]]] = []
        self.workers
---
[High] class SimpleQueueProcessingStrategy in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class SimpleQueueProcessingStrategy(ProcessingStrategy[KafkaPayload], Generic[T]):
    """"""
    Processing strategy that uses a fixed pool of queues.

    Guarantees:
    - Items for the same group are processed in order
    - No item is lost or processed out of order
    - Natural backpressure when queues fill up
    - Only commits offsets after successful processing
    """"""

    def __init__(
        self,
        queue_pool: FixedQueuePool[T],
        decoder: Callable[[KafkaPayload | FilteredPayload], T | None],
        grouping_fn: Callable[[T], str],
        commit_function: Callable[[dict[Partition, int]], None],
    ) -> None:
        self.queue_pool = queue_pool
        self.decoder = decoder
        self.grouping_fn = grouping_fn
        self.commit_function = commit_function
    
---
[High] function grouping_fn in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def grouping_fn(result: dict) -> str:
            return result[""subscription_id""]
---
[High] function create_message in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def create_message(self, subscription_id: str, partition: int, offset: int) -> Message:
        """"""Helper to create a test message.""""""
        payload = KafkaPayload(
            key=None,
            value=subscription_id.encode(),
            headers=[],
        )
        return Message(
            BrokerValue(
                payload,
                Partition(Topic(""test""), partition),
                offset,
                datetime.now(),
            )
        )
---
[High] class OffsetTracker in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class OffsetTracker:
    """"""
    Tracks outstanding offsets and determines which offsets are safe to commit.

    - Tracks offsets per partition
    - Only commits offsets when all prior offsets are processed
    - Thread-safe for concurrent access with per-partition locks
    """"""

    def __init__(self) -> None:
        self.all_offsets: dict[Partition, set[int]] = defaultdict(set)
        self.outstanding: dict[Partition, set[int]] = defaultdict(set)
        self.last_committed: dict[Partition, int] = {}
        self.partition_locks: dict[Partition, threading.Lock] = {}

    def _get_partition_lock(self, partition: Partition) -> threading.Lock:
        """"""Get or create a lock for a partition.""""""
        lock = self.partition_locks.get(partition)
        if lock:
            return lock
 
---
[High] function get_committable_offsets in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_committable_offsets(self) -> dict[Partition, int]:
        """"""
        Get the highest offset per partition that can be safely committed.

        For each partition, finds the highest contiguous offset that has been processed.
        """"""
        committable = {}
        for partition in list(self.all_offsets.keys()):
            with self._get_partition_lock(partition):
                all_offsets = self.all_offsets[partition]
                if not all_offsets:
                    continue

                outstanding = self.outstanding[partition]
                last_committed = self.last_committed.get(partition, -1)

                min_offset = min(all_offsets)
                max_offset = max(all_offsets)

                start = max(last_committed + 1, min_offset)

        
---
[High] function _get_partition_lock in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def _get_partition_lock(self, partition: Partition) -> threading.Lock:
        """"""Get or create a lock for a partition.""""""
        lock = self.partition_locks.get(partition)
        if lock:
            return lock
        return self.partition_locks.setdefault(partition, threading.Lock())
---
[High] function mark_committed in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def mark_committed(self, partition: Partition, offset: int) -> None:
        """"""Update the last committed offset for a partition.""""""
        with self._get_partition_lock(partition):
            self.last_committed[partition] = offset
            # Remove all offsets <= committed offset
            self.all_offsets[partition] = {o for o in self.all_offsets[partition] if o > offset}
---
[High] function get_queue_for_group in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_queue_for_group(self, group_key: str) -> int:
        """"""
        Get queue index for a group using consistent hashing.
        """"""
        return hash(group_key) % self.num_queues
---
[High] function __init__ in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def __init__(self) -> None:
        self.all_offsets: dict[Partition, set[int]] = defaultdict(set)
        self.outstanding: dict[Partition, set[int]] = defaultdict(set)
        self.last_committed: dict[Partition, int] = {}
        self.partition_locks: dict[Partition, threading.Lock] = {}
---
[High] function get_stats in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_stats(self) -> dict[str, Any]:
        """"""Get statistics about queue depths.""""""
        queue_depths = [q.qsize() for q in self.queues]
        return {
            ""queue_depths"": queue_depths,
            ""total_items"": sum(queue_depths),
        }
---
[High] function shutdown in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def shutdown(self) -> None:
        """"""Gracefully shutdown all workers.""""""
        for worker in self.workers:
            worker.shutdown = True

        for q in self.queues:
            try:
                q.shutdown(immediate=False)
            except Exception:
                logger.exception(""Error shutting down queue"")

        for worker in self.workers:
            worker.join(timeout=5.0)
---
[High] function topic_for_codec in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def topic_for_codec(self):
                return Topic(""test"")
---
[High] function join in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def join(self, timeout: float | None = None) -> None:
        self.close()
---
[High] function subscription_model in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def subscription_model(self):
                return mock.Mock()
---
[High] function get_subscription_id in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def get_subscription_id(self, result):
                return result.get(""subscription_id"", ""unknown"")
---
[High] function handle_result in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def handle_result(self, subscription, result):
                pass
---
[High] class MockResultProcessor in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
class MockResultProcessor(ResultProcessor):
            @property
            def subscription_model(self):
                return mock.Mock()

            def get_subscription_id(self, result):
                return result.get(""subscription_id"", ""unknown"")

            def handle_result(self, subscription, result):
                pass
---
[High] function result_processor_cls in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def result_processor_cls(self):
                return MockResultProcessor
---
[High] function build_payload_grouping_key in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def build_payload_grouping_key(self, result):
                return result.get(""subscription_id"", ""unknown"")
---
[High] class OrderedQueueWorker in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class OrderedQueueWorker(threading.Thread, Generic[T]):
    """"""Worker thread that processes items from a queue in order.""""""

    def __init__(
        self,
        worker_id: int,
        work_queue: queue.Queue[WorkItem[T]],
        result_processor: Callable[[str, T], None],
        identifier: str,
        offset_tracker: OffsetTracker,
    ) -> None:
        super().__init__(daemon=True)
        self.worker_id = worker_id
        self.work_queue = work_queue
        self.result_processor = result_processor
        self.identifier = identifier
        self.offset_tracker = offset_tracker
        self.shutdown = False

    def run(self) -> None:
        """"""Process items from the queue in order.""""""
        while not self.shutdown:
            try:
                work_item = self.work_qu
---
[High] function submit in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def submit(self, group_key: str, work_item: WorkItem[T]) -> None:
        """"""
        Submit a work item to the appropriate queue.
        """"""
        queue_index = self.get_queue_for_group(group_key)
        work_queue = self.queues[queue_index]

        self.offset_tracker.add_offset(work_item.partition, work_item.offset)
        work_queue.put(work_item)
---
[High] function wait_until_empty in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def wait_until_empty(self, timeout: float = 5.0) -> bool:
        """"""Wait until all queues are empty. Returns True if successful, False if timeout.""""""
        start_time = time.time()
        while time.time() - start_time < timeout:
            if self.get_stats()[""total_items""] == 0:
                return True
            time.sleep(0.01)
        return False
---
[High] function create_thread_queue_parallel_worker in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def create_thread_queue_parallel_worker(
        self, commit: Commit
    ) -> ProcessingStrategy[KafkaPayload]:
        assert self.queue_pool is not None

        def commit_offsets(offsets: dict[Partition, int]):
            # We add + 1 here because the committed offset should represent the next offset to read from
            commit_data = {partition: offset + 1 for partition, offset in offsets.items()}
            commit(commit_data)

        return SimpleQueueProcessingStrategy(
            queue_pool=self.queue_pool,
            decoder=partial(self.decode_payload, self.topic_for_codec),
            grouping_fn=self.build_payload_grouping_key,
            commit_function=commit_offsets,
        )
---
[High] function commit_offsets in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def commit_offsets(offsets: dict[Partition, int]):
            # We add + 1 here because the committed offset should represent the next offset to read from
            commit_data = {partition: offset + 1 for partition, offset in offsets.items()}
            commit(commit_data)
---
[High] function create_with_partitions in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def create_with_partitions(
        self,
        commit: Commit,
        partitions: Mapping[Partition, int],
    ) -> ProcessingStrategy[KafkaPayload]:
        if self.batched_parallel:
            return self.create_thread_parallel_worker(commit)
        if self.parallel:
            return self.create_multiprocess_worker(commit)
        if self.thread_queue_parallel:
            return self.create_thread_queue_parallel_worker(commit)
        else:
            return self.create_serial_worker(commit)
---
[High] function __init__ in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def __init__(
        self,
        mode: Literal[""batched-parallel"", ""parallel"", ""serial"", ""thread-queue-parallel""] = ""serial"",
        max_batch_size: int | None = None,
        max_batch_time: int | None = None,
        max_workers: int | None = None,
        num_processes: int | None = None,
        input_block_size: int | None = None,
        output_block_size: int | None = None,
    ) -> None:
        self.mode = mode
        metric_tags = {""identifier"": self.identifier, ""mode"": self.mode}
        self.result_processor = self.result_processor_cls()
        if mode == ""batched-parallel"":
            self.batched_parallel = True
            self.parallel_executor = ThreadPoolExecutor(max_workers=max_workers)
            if max_workers is None:
                metric_tags[""workers""] = ""
---
[High] function shutdown in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def shutdown(self) -> None:
        if self.parallel_executor:
            self.parallel_executor.shutdown()
        if self.queue_pool:
            self.queue_pool.shutdown()
            self.queue_pool = None","[Medium] function setUp in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def setUp(self):
        self.tracker = OffsetTracker()
        self.partition1 = Partition(Topic(""test""), 0)
        self.partition2 = Partition(Topic(""test""), 1)
---
[Medium] function track_commits in tests/sentry/uptime/consumers/test_results_consumer.py:
def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)
---
[Medium] function tracked_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def tracked_commit(
                        offsets: Mapping[Partition, int], force: bool = False
                    ) -> None:
                        nonlocal commit_count
                        commit_count += 1
                        commits_made.append(dict(offsets))
                        return commit(offsets, force)
---
[Medium] function run in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def run(self) -> None:
        """"""Process items from the queue in order.""""""
        while not self.shutdown:
            try:
                work_item = self.work_queue.get()
            except queue.ShutDown:
                break

            try:
                with sentry_sdk.start_transaction(
                    op=""queue_worker.process"",
                    name=f""monitors.{self.identifier}.worker_{self.worker_id}"",
                ):
                    self.result_processor(self.ident
---
[Medium] function poll in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def poll(self) -> None:
        stats = self.queue_pool.get_stats()
        metrics.gauge(
            ""remote_subscriptions.queue_pool.total_queued"",
            stats[""total_items""],
            tags={""identifier"": self.queue_pool.identifier},
        )
---
[Medium] function close in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def close(self) -> None:
        self.shutdown_event.set()
        self.commit_thread.join(timeout=5.0)
        self.queue_pool.shutdown()
---
[Medium] function terminate in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def terminate(self) -> None:
        self.shutdown_event.set()
        self.queue_pool.shutdown()
---
[Medium] function tearDown in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def tearDown(self):
        self.pool.shutdown()
---
[Medium] class MockFactory in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
class MockFactory(ResultsStrategyFactory):
            @property
            def topic_for_codec(self):
                return Topic(""test"")

            @property
            def result_processor_cls(self):
                return MockResultProcessor

            def build_payload_grouping_key(self, result):
                return result.get(""subscription_id"", ""unknown"")

            @property
            def identifier(self):
                return ""test""
---
[Medium] function track_calls in tests/sentry/uptime/consumers/test_results_consumer.py:
def track_calls(identifier, result):
                processed_guids.append(result[""guid""])
---
[Medium] function create_with_partitions_tracking in tests/sentry/uptime/consumers/test_results_consumer.py:
def create_with_partitions_tracking(commit, partitions):
                    def tracked_commit(
                        offsets: Mapping[Partition, int], force: bool = False
                    ) -> None:
                        nonlocal commit_count
                        commit_count += 1
                        commits_made.append(dict(offsets))
                        return commit(offsets, force)

                    return original_create_with_partitions(tracked_commit, partitions)
---
[Medium] function test_simple_tracking in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_simple_tracking(self):
        """"""Test basic offset tracking and committing.""""""
        self.tracker.add_offset(self.partition1, 100)
        self.tracker.add_offset(self.partition1, 101)
        self.tracker.add_offset(self.partition1, 102)

        committable = self.tracker.get_committable_offsets()
        assert committable == {}

        self.tracker.complete_offset(self.partition1, 100)
        committable = self.tracker.get_committable_offsets()
        assert committable == {se
---
[Medium] function test_multiple_partitions in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_multiple_partitions(self):
        """"""Test tracking across multiple partitions.""""""
        self.tracker.add_offset(self.partition1, 100)
        self.tracker.add_offset(self.partition1, 101)
        self.tracker.add_offset(self.partition2, 200)
        self.tracker.add_offset(self.partition2, 201)

        self.tracker.complete_offset(self.partition1, 100)
        self.tracker.complete_offset(self.partition2, 200)
        self.tracker.complete_offset(self.partition2, 201)

        commi
---
[Medium] function test_consistent_group_assignment in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_consistent_group_assignment(self):
        """"""Test that groups are consistently assigned to the same queue.""""""
        group_key = ""group1""
        queue_index1 = self.pool.get_queue_for_group(group_key)
        queue_index2 = self.pool.get_queue_for_group(group_key)
        queue_index3 = self.pool.get_queue_for_group(group_key)

        assert queue_index1 == queue_index2 == queue_index3
---
[Medium] function test_different_groups_distributed in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_different_groups_distributed(self):
        """"""Test that different groups are distributed across queues.""""""
        queue_indices = set()
        for i in range(20):
            group_key = f""group{i}""
            queue_index = self.pool.get_queue_for_group(group_key)
            queue_indices.add(queue_index)

        assert len(queue_indices) == 3
---
[Medium] function test_ordered_processing_within_group in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_ordered_processing_within_group(self):
        """"""Test that items within a group are processed in order.""""""
        partition = Partition(Topic(""test""), 0)
        group_key = ""ordered_group""

        self.expected_items = 5
        self.process_complete_event.clear()

        for i in range(5):
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{i}"",
                message=Message(
                    BrokerVa
---
[Medium] function test_concurrent_processing_across_groups in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_concurrent_processing_across_groups(self):
        """"""Test that different groups are processed concurrently.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 6
        self.process_complete_event.clear()

        for i in range(6):
            group_key = f""group_{i % 3}""
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{group_key}_{i}"",
                message=Message(
       
---
[Medium] function test_stats_reporting in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_stats_reporting(self):
        """"""Test queue statistics reporting.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 10
        self.process_complete_event.clear()

        for i in range(10):
            group_key = f""group_{i % 4}""
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{i}"",
                message=Message(
                    BrokerValue(
                        Ka
---
[Medium] function test_message_processing in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_message_processing(self):
        """"""Test basic message processing.""""""
        partition = 0
        message = self.create_message(""sub1"", partition, 100)

        self.expected_items = 1
        self.process_complete_event.clear()

        self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        assert len(self.processed_results) == 1
        assert self.processed_results[0][""subscription_id""] == ""sub1""
---
[Medium] function test_offset_committing in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_offset_committing(self):
        """"""Test that offsets are committed after processing.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 5
        self.process_complete_event.clear()
        self.commit_event.clear()
        for i in range(5):
            message = self.create_message(""sub1"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        ass
---
[Medium] function test_preserves_order_within_group in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_preserves_order_within_group(self):
        """"""Test that messages for the same subscription are processed in order.""""""
        self.expected_items = 5
        self.process_complete_event.clear()

        for i in range(5):
            message = self.create_message(""sub1"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        assert len(self.processed_results) == 5
---
[Medium] function test_concurrent_processing_different_groups in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_concurrent_processing_different_groups(self):
        """"""Test that different subscriptions are processed concurrently.""""""
        self.expected_items = 4
        self.process_complete_event.clear()

        for i in range(4):
            message = self.create_message(f""sub{i % 2}"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""

        assert len(self.processed_results) == 4
---
[Medium] function test_handles_invalid_messages in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_handles_invalid_messages(self):
        """"""Test that invalid messages don't block offset commits.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 1
        self.process_complete_event.clear()
        self.commit_event.clear()

        invalid_message = Message(
            BrokerValue(
                FilteredPayload(),
                partition,
                100,
                datetime.now(),
            )
        )

        self.strategy.submit(i
---
[Medium] function test_offset_gaps_block_commits in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_offset_gaps_block_commits(self):
        """"""Test that gaps in offsets prevent committing past the gap.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 3  # First batch
        self.process_complete_event.clear()
        self.commit_event.clear()

        self.strategy.submit(self.create_message(""sub1"", 0, 100))
        self.strategy.submit(self.create_message(""sub1"", 0, 102))
        self.strategy.submit(self.create_message(""sub1"", 0, 103))

        ass
---
[Medium] function test_factory_creates_thread_queue_parallel_strategy in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_factory_creates_thread_queue_parallel_strategy(self):
        """"""Test that the factory properly creates thread-queue-parallel strategy.""""""
        from sentry.remote_subscriptions.consumers.result_consumer import (
            ResultProcessor,
            ResultsStrategyFactory,
        )

        class MockResultProcessor(ResultProcessor):
            @property
            def subscription_model(self):
                return mock.Mock()

            def get_subscription_id(self, result
---
[Medium] function test_thread_queue_parallel in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel(self) -> None:
        """"""
        Validates that the consumer in thread-queue-parallel mode processes messages correctly
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        with mock.patch.object(type(factory.result_processor), ""__call__"") as mock_processor_call:
            subscription
---
[Medium] function test_thread_queue_parallel_preserves_order in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_preserves_order(self) -> None:
        """"""
        Test that thread-queue-parallel mode preserves order within subscriptions.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=3,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        with mock.patch.object(type(factory.result_processor), ""__call__"") as mock_processor_call:
            processe
---
[Medium] function test_thread_queue_parallel_concurrent_subscriptions in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_concurrent_subscriptions(self) -> None:
        """"""
        Test that different subscriptions are processed concurrently in thread-queue-parallel mode.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
        commit = mock.Mock()
        consumer = factory.create_with_partitions(commit, {self.partition: 0})

        subscription_2 = self.create_uptime_subscription(
           
---
[Medium] function test_thread_queue_parallel_offset_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_offset_commit(self) -> None:
        """"""
        Test that offsets are committed after successful processing in thread-queue-parallel mode.
        """"""
        committed_offsets: dict[Partition, int] = {}

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
---
[Medium] function test_thread_queue_parallel_error_handling in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_error_handling(self) -> None:
        """"""
        Test that errors in processing don't block offset commits for other messages.
        """"""
        committed_offsets: dict[Partition, int] = {}

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )

        te
---
[Medium] function test_thread_queue_parallel_offset_gaps in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_offset_gaps(self) -> None:
        """"""
        Test that offset gaps prevent committing past the gap.
        """"""
        all_commits = []

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            all_commits.append(dict(offsets))

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=1,
        )

        test_partition = Partition(Topic(""test""), 1)
        con
---
[Medium] function test_thread_queue_parallel_graceful_shutdown in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_graceful_shutdown(self) -> None:
        """"""
        Test that the thread-queue-parallel consumer shuts down gracefully.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=3,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        for i in range(5):
            result = self.create_uptime_result(
                self.subscription.subscription_id
---
[Medium] function test_thread_queue_parallel_kafka_offset_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_kafka_offset_commit(self) -> None:
        """"""
        Test that offsets are actually committed to Kafka consumer group.
        """"""
        subscription = self.create_uptime_subscription(
            subscription_id=uuid.uuid4().hex, interval_seconds=300, region_slugs=[""default""]
        )
        self.create_project_uptime_subscription(
            uptime_subscription=subscription,
            owner=self.user,
        )

        test_id = uuid.uuid4().hex[:8]
   
---
[Medium] class ProcessResultSerialTest in tests/sentry/uptime/consumers/test_results_consumer.py:
class ProcessResultSerialTest(ProcessResultTest):
    strategy_processing_mode = ""serial""

    def test_parallel(self) -> None:
        """"""
        Validates that the consumer in parallel mode correctly groups check-ins
        into groups by their monitor slug / environment
        """"""

        factory = UptimeResultsStrategyFactory(
            mode=""batched-parallel"",
            max_batch_size=3,
            max_workers=1,
        )
        consumer = factory.create_with_partitions(mock.Mock
---
[Medium] function uptime_options in src/sentry/consumers/__init__.py:
def uptime_options() -> list[click.Option]:
    """"""Return a list of uptime-results options.""""""
    options = [
        click.Option(
            [""--mode"", ""mode""],
            type=click.Choice([""serial"", ""parallel"", ""batched-parallel"", ""thread-queue-parallel""]),
            default=""serial"",
            help=""The mode to process results in. Parallel uses multithreading."",
        ),
        click.Option(
            [""--max-batch-size"", ""max_batch_size""],
            type=int,
            defa","result_processor (Critical), ResultsStrategyFactory (Critical), WorkItem (Critical), decoder (Critical), identifier (Critical), add_offset (High), complete_offset (High), FixedQueuePool (High), SimpleQueueProcessingStrategy (High), grouping_fn (High), create_message (High), OffsetTracker (High), get_committable_offsets (High), _get_partition_lock (High), mark_committed (High), get_queue_for_group (High), __init__ (High), get_stats (High), shutdown (High), topic_for_codec (High), join (High), subscription_model (High), get_subscription_id (High), handle_result (High), MockResultProcessor (High), result_processor_cls (High), build_payload_grouping_key (High), OrderedQueueWorker (High), submit (High), wait_until_empty (High), create_thread_queue_parallel_worker (High), commit_offsets (High), create_with_partitions (High), __init__ (High), shutdown (High), setUp (Medium), track_commits (Medium), tracked_commit (Medium), run (Medium), poll (Medium), close (Medium), terminate (Medium), tearDown (Medium), MockFactory (Medium), track_calls (Medium), create_with_partitions_tracking (Medium), test_simple_tracking (Medium), test_multiple_partitions (Medium), test_consistent_group_assignment (Medium), test_different_groups_distributed (Medium), test_ordered_processing_within_group (Medium), test_concurrent_processing_across_groups (Medium), test_stats_reporting (Medium), test_message_processing (Medium), test_offset_committing (Medium), test_preserves_order_within_group (Medium), test_concurrent_processing_different_groups (Medium), test_handles_invalid_messages (Medium), test_offset_gaps_block_commits (Medium), test_factory_creates_thread_queue_parallel_strategy (Medium), test_thread_queue_parallel (Medium), test_thread_queue_parallel_preserves_order (Medium), test_thread_queue_parallel_concurrent_subscriptions (Medium), test_thread_queue_parallel_offset_commit (Medium), test_thread_queue_parallel_error_handling (Medium), test_thread_queue_parallel_offset_gaps (Medium), test_thread_queue_parallel_graceful_shutdown (Medium), test_thread_queue_parallel_kafka_offset_commit (Medium), ProcessResultSerialTest (Medium), uptime_options (Medium), __init__ (Low), __init__ (Low), __init__ (Low), _commit_loop (Low), submit (Low), TestOffsetTracker (Low), TestFixedQueuePool (Low), setUp (Low), TestSimpleQueueProcessingStrategy (Low), setUp (Low), result_processor (Low), commit_function (Low), tearDown (Low), TestThreadQueueParallelIntegration (Low), track_commits (Low), track_commits (Low), ProcessResultThreadQueueParallelKafkaTest (Low)",partial,test infrastructure is HC but magic number is a code style issue
sentry,9,feat(uptime): Add ability to use queues to manage parallelism,The test test_thread_queue_parallel_error_handling has a docstring that doesn't match the test implementation.,Low,87,35,35,"function::result_processor (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.96] | class::ResultsStrategyFactory (src/sentry/remote_subscriptions/consumers/result_consumer.py) [Critical, score=0.83] | function::WorkItem (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [Critical, score=0.83] | function::decoder (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.80] | function::identifier (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [Critical, score=0.75] | function::add_offset (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | function::complete_offset (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | class::FixedQueuePool (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | class::SimpleQueueProcessingStrategy (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.67] | function::grouping_fn (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.65] | function::create_message (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.64] | class::OffsetTracker (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.63] | function::get_committable_offsets (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.63] | function::_get_partition_lock (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::mark_committed (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::get_queue_for_group (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.61] | function::__init__ (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::get_stats (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::shutdown (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.58] | function::topic_for_codec (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.56] | function::join (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.55] | function::subscription_model (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::get_subscription_id (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::handle_result (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | class::MockResultProcessor (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::result_processor_cls (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | function::build_payload_grouping_key (tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py) [High, score=0.54] | class::OrderedQueueWorker (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::submit (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::wait_until_empty (src/sentry/remote_subscriptions/consumers/queue_consumer.py) [High, score=0.50] | function::create_thread_queue_parallel_worker (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::commit_offsets (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::create_with_partitions (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::__init__ (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50] | function::shutdown (src/sentry/remote_subscriptions/consumers/result_consumer.py) [High, score=0.50]","[Critical] function result_processor in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def result_processor(identifier: str, item: str):
            with self.process_lock:
                self.processed_items.append((identifier, item))
                self.items_processed += 1
                if self.items_processed >= self.expected_items:
                    self.process_complete_event.set()
---
[Critical] class ResultsStrategyFactory in src/sentry/remote_subscriptions/consumers/result_consumer.py:
class ResultsStrategyFactory(ProcessingStrategyFactory[KafkaPayload], Generic[T, U]):
    parallel_executor: ThreadPoolExecutor | None = None

    batched_parallel = False
    """"""
    Does the consumer process unrelated messages in parallel?
    """"""

    max_batch_size = 500
    """"""
    How many messages will be batched at once when in parallel mode.
    """"""

    max_batch_time = 10
    """"""
    The maximum time in seconds to accumulate a bach of check-ins.
    """"""

    parallel = False
    """"""
    Does the consumer process all messages in parallel.
    """"""

    thread_queue_parallel = False
    """"""
    Does the consumer use thread-queue-parallel processing?
    """"""

    multiprocessing_pool: MultiprocessingPool | None = None
    queue_pool: FixedQueuePool | None = None
    input_block_size
---
[Critical] function WorkItem in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
@dataclass
class WorkItem(Generic[T]):
    """"""Work item that includes the original message for offset tracking.""""""

    partition: Partition
    offset: int
    result: T
    message: Message[KafkaPayload | FilteredPayload]
---
[Critical] function decoder in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def decoder(payload: KafkaPayload | FilteredPayload) -> dict | None:
            if isinstance(payload, FilteredPayload):
                return None
            return {""subscription_id"": payload.value.decode(), ""data"": ""test""}
---
[Critical] function identifier in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def identifier(self):
                return ""test""
---
[High] function add_offset in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def add_offset(self, partition: Partition, offset: int) -> None:
        """"""Record that we've started processing an offset.""""""
        with self._get_partition_lock(partition):
            self.all_offsets[partition].add(offset)
            self.outstanding[partition].add(offset)
---
[High] function complete_offset in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def complete_offset(self, partition: Partition, offset: int) -> None:
        """"""Mark an offset as completed.""""""
        with self._get_partition_lock(partition):
            self.outstanding[partition].discard(offset)
---
[High] class FixedQueuePool in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class FixedQueuePool(Generic[T]):
    """"""
    Fixed pool of queues that guarantees order within groups.

    Key properties:
    - Each group is consistently assigned to the same queue
    - Each queue has exactly one worker thread
    - Items within a queue are processed in FIFO order
    - No dynamic reassignment that could break ordering
    - Tracks offset completion for safe commits
    """"""

    def __init__(
        self,
        result_processor: Callable[[str, T], None],
        identifier: str,
        num_queues: int = 20,
    ) -> None:
        self.result_processor = result_processor
        self.identifier = identifier
        self.num_queues = num_queues
        self.offset_tracker = OffsetTracker()
        self.queues: list[queue.Queue[WorkItem[T]]] = []
        self.workers
---
[High] class SimpleQueueProcessingStrategy in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class SimpleQueueProcessingStrategy(ProcessingStrategy[KafkaPayload], Generic[T]):
    """"""
    Processing strategy that uses a fixed pool of queues.

    Guarantees:
    - Items for the same group are processed in order
    - No item is lost or processed out of order
    - Natural backpressure when queues fill up
    - Only commits offsets after successful processing
    """"""

    def __init__(
        self,
        queue_pool: FixedQueuePool[T],
        decoder: Callable[[KafkaPayload | FilteredPayload], T | None],
        grouping_fn: Callable[[T], str],
        commit_function: Callable[[dict[Partition, int]], None],
    ) -> None:
        self.queue_pool = queue_pool
        self.decoder = decoder
        self.grouping_fn = grouping_fn
        self.commit_function = commit_function
    
---
[High] function grouping_fn in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def grouping_fn(result: dict) -> str:
            return result[""subscription_id""]
---
[High] function create_message in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def create_message(self, subscription_id: str, partition: int, offset: int) -> Message:
        """"""Helper to create a test message.""""""
        payload = KafkaPayload(
            key=None,
            value=subscription_id.encode(),
            headers=[],
        )
        return Message(
            BrokerValue(
                payload,
                Partition(Topic(""test""), partition),
                offset,
                datetime.now(),
            )
        )
---
[High] class OffsetTracker in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class OffsetTracker:
    """"""
    Tracks outstanding offsets and determines which offsets are safe to commit.

    - Tracks offsets per partition
    - Only commits offsets when all prior offsets are processed
    - Thread-safe for concurrent access with per-partition locks
    """"""

    def __init__(self) -> None:
        self.all_offsets: dict[Partition, set[int]] = defaultdict(set)
        self.outstanding: dict[Partition, set[int]] = defaultdict(set)
        self.last_committed: dict[Partition, int] = {}
        self.partition_locks: dict[Partition, threading.Lock] = {}

    def _get_partition_lock(self, partition: Partition) -> threading.Lock:
        """"""Get or create a lock for a partition.""""""
        lock = self.partition_locks.get(partition)
        if lock:
            return lock
 
---
[High] function get_committable_offsets in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_committable_offsets(self) -> dict[Partition, int]:
        """"""
        Get the highest offset per partition that can be safely committed.

        For each partition, finds the highest contiguous offset that has been processed.
        """"""
        committable = {}
        for partition in list(self.all_offsets.keys()):
            with self._get_partition_lock(partition):
                all_offsets = self.all_offsets[partition]
                if not all_offsets:
                    continue

                outstanding = self.outstanding[partition]
                last_committed = self.last_committed.get(partition, -1)

                min_offset = min(all_offsets)
                max_offset = max(all_offsets)

                start = max(last_committed + 1, min_offset)

        
---
[High] function _get_partition_lock in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def _get_partition_lock(self, partition: Partition) -> threading.Lock:
        """"""Get or create a lock for a partition.""""""
        lock = self.partition_locks.get(partition)
        if lock:
            return lock
        return self.partition_locks.setdefault(partition, threading.Lock())
---
[High] function mark_committed in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def mark_committed(self, partition: Partition, offset: int) -> None:
        """"""Update the last committed offset for a partition.""""""
        with self._get_partition_lock(partition):
            self.last_committed[partition] = offset
            # Remove all offsets <= committed offset
            self.all_offsets[partition] = {o for o in self.all_offsets[partition] if o > offset}
---
[High] function get_queue_for_group in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_queue_for_group(self, group_key: str) -> int:
        """"""
        Get queue index for a group using consistent hashing.
        """"""
        return hash(group_key) % self.num_queues
---
[High] function __init__ in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def __init__(self) -> None:
        self.all_offsets: dict[Partition, set[int]] = defaultdict(set)
        self.outstanding: dict[Partition, set[int]] = defaultdict(set)
        self.last_committed: dict[Partition, int] = {}
        self.partition_locks: dict[Partition, threading.Lock] = {}
---
[High] function get_stats in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def get_stats(self) -> dict[str, Any]:
        """"""Get statistics about queue depths.""""""
        queue_depths = [q.qsize() for q in self.queues]
        return {
            ""queue_depths"": queue_depths,
            ""total_items"": sum(queue_depths),
        }
---
[High] function shutdown in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def shutdown(self) -> None:
        """"""Gracefully shutdown all workers.""""""
        for worker in self.workers:
            worker.shutdown = True

        for q in self.queues:
            try:
                q.shutdown(immediate=False)
            except Exception:
                logger.exception(""Error shutting down queue"")

        for worker in self.workers:
            worker.join(timeout=5.0)
---
[High] function topic_for_codec in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def topic_for_codec(self):
                return Topic(""test"")
---
[High] function join in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def join(self, timeout: float | None = None) -> None:
        self.close()
---
[High] function subscription_model in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def subscription_model(self):
                return mock.Mock()
---
[High] function get_subscription_id in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def get_subscription_id(self, result):
                return result.get(""subscription_id"", ""unknown"")
---
[High] function handle_result in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def handle_result(self, subscription, result):
                pass
---
[High] class MockResultProcessor in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
class MockResultProcessor(ResultProcessor):
            @property
            def subscription_model(self):
                return mock.Mock()

            def get_subscription_id(self, result):
                return result.get(""subscription_id"", ""unknown"")

            def handle_result(self, subscription, result):
                pass
---
[High] function result_processor_cls in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
@property
            def result_processor_cls(self):
                return MockResultProcessor
---
[High] function build_payload_grouping_key in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def build_payload_grouping_key(self, result):
                return result.get(""subscription_id"", ""unknown"")
---
[High] class OrderedQueueWorker in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
class OrderedQueueWorker(threading.Thread, Generic[T]):
    """"""Worker thread that processes items from a queue in order.""""""

    def __init__(
        self,
        worker_id: int,
        work_queue: queue.Queue[WorkItem[T]],
        result_processor: Callable[[str, T], None],
        identifier: str,
        offset_tracker: OffsetTracker,
    ) -> None:
        super().__init__(daemon=True)
        self.worker_id = worker_id
        self.work_queue = work_queue
        self.result_processor = result_processor
        self.identifier = identifier
        self.offset_tracker = offset_tracker
        self.shutdown = False

    def run(self) -> None:
        """"""Process items from the queue in order.""""""
        while not self.shutdown:
            try:
                work_item = self.work_qu
---
[High] function submit in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def submit(self, group_key: str, work_item: WorkItem[T]) -> None:
        """"""
        Submit a work item to the appropriate queue.
        """"""
        queue_index = self.get_queue_for_group(group_key)
        work_queue = self.queues[queue_index]

        self.offset_tracker.add_offset(work_item.partition, work_item.offset)
        work_queue.put(work_item)
---
[High] function wait_until_empty in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def wait_until_empty(self, timeout: float = 5.0) -> bool:
        """"""Wait until all queues are empty. Returns True if successful, False if timeout.""""""
        start_time = time.time()
        while time.time() - start_time < timeout:
            if self.get_stats()[""total_items""] == 0:
                return True
            time.sleep(0.01)
        return False
---
[High] function create_thread_queue_parallel_worker in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def create_thread_queue_parallel_worker(
        self, commit: Commit
    ) -> ProcessingStrategy[KafkaPayload]:
        assert self.queue_pool is not None

        def commit_offsets(offsets: dict[Partition, int]):
            # We add + 1 here because the committed offset should represent the next offset to read from
            commit_data = {partition: offset + 1 for partition, offset in offsets.items()}
            commit(commit_data)

        return SimpleQueueProcessingStrategy(
            queue_pool=self.queue_pool,
            decoder=partial(self.decode_payload, self.topic_for_codec),
            grouping_fn=self.build_payload_grouping_key,
            commit_function=commit_offsets,
        )
---
[High] function commit_offsets in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def commit_offsets(offsets: dict[Partition, int]):
            # We add + 1 here because the committed offset should represent the next offset to read from
            commit_data = {partition: offset + 1 for partition, offset in offsets.items()}
            commit(commit_data)
---
[High] function create_with_partitions in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def create_with_partitions(
        self,
        commit: Commit,
        partitions: Mapping[Partition, int],
    ) -> ProcessingStrategy[KafkaPayload]:
        if self.batched_parallel:
            return self.create_thread_parallel_worker(commit)
        if self.parallel:
            return self.create_multiprocess_worker(commit)
        if self.thread_queue_parallel:
            return self.create_thread_queue_parallel_worker(commit)
        else:
            return self.create_serial_worker(commit)
---
[High] function __init__ in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def __init__(
        self,
        mode: Literal[""batched-parallel"", ""parallel"", ""serial"", ""thread-queue-parallel""] = ""serial"",
        max_batch_size: int | None = None,
        max_batch_time: int | None = None,
        max_workers: int | None = None,
        num_processes: int | None = None,
        input_block_size: int | None = None,
        output_block_size: int | None = None,
    ) -> None:
        self.mode = mode
        metric_tags = {""identifier"": self.identifier, ""mode"": self.mode}
        self.result_processor = self.result_processor_cls()
        if mode == ""batched-parallel"":
            self.batched_parallel = True
            self.parallel_executor = ThreadPoolExecutor(max_workers=max_workers)
            if max_workers is None:
                metric_tags[""workers""] = ""
---
[High] function shutdown in src/sentry/remote_subscriptions/consumers/result_consumer.py:
def shutdown(self) -> None:
        if self.parallel_executor:
            self.parallel_executor.shutdown()
        if self.queue_pool:
            self.queue_pool.shutdown()
            self.queue_pool = None","[Medium] function setUp in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def setUp(self):
        self.tracker = OffsetTracker()
        self.partition1 = Partition(Topic(""test""), 0)
        self.partition2 = Partition(Topic(""test""), 1)
---
[Medium] function track_commits in tests/sentry/uptime/consumers/test_results_consumer.py:
def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)
---
[Medium] function tracked_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def tracked_commit(
                        offsets: Mapping[Partition, int], force: bool = False
                    ) -> None:
                        nonlocal commit_count
                        commit_count += 1
                        commits_made.append(dict(offsets))
                        return commit(offsets, force)
---
[Medium] function run in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def run(self) -> None:
        """"""Process items from the queue in order.""""""
        while not self.shutdown:
            try:
                work_item = self.work_queue.get()
            except queue.ShutDown:
                break

            try:
                with sentry_sdk.start_transaction(
                    op=""queue_worker.process"",
                    name=f""monitors.{self.identifier}.worker_{self.worker_id}"",
                ):
                    self.result_processor(self.ident
---
[Medium] function poll in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def poll(self) -> None:
        stats = self.queue_pool.get_stats()
        metrics.gauge(
            ""remote_subscriptions.queue_pool.total_queued"",
            stats[""total_items""],
            tags={""identifier"": self.queue_pool.identifier},
        )
---
[Medium] function close in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def close(self) -> None:
        self.shutdown_event.set()
        self.commit_thread.join(timeout=5.0)
        self.queue_pool.shutdown()
---
[Medium] function terminate in src/sentry/remote_subscriptions/consumers/queue_consumer.py:
def terminate(self) -> None:
        self.shutdown_event.set()
        self.queue_pool.shutdown()
---
[Medium] function tearDown in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def tearDown(self):
        self.pool.shutdown()
---
[Medium] class MockFactory in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
class MockFactory(ResultsStrategyFactory):
            @property
            def topic_for_codec(self):
                return Topic(""test"")

            @property
            def result_processor_cls(self):
                return MockResultProcessor

            def build_payload_grouping_key(self, result):
                return result.get(""subscription_id"", ""unknown"")

            @property
            def identifier(self):
                return ""test""
---
[Medium] function track_calls in tests/sentry/uptime/consumers/test_results_consumer.py:
def track_calls(identifier, result):
                processed_guids.append(result[""guid""])
---
[Medium] function create_with_partitions_tracking in tests/sentry/uptime/consumers/test_results_consumer.py:
def create_with_partitions_tracking(commit, partitions):
                    def tracked_commit(
                        offsets: Mapping[Partition, int], force: bool = False
                    ) -> None:
                        nonlocal commit_count
                        commit_count += 1
                        commits_made.append(dict(offsets))
                        return commit(offsets, force)

                    return original_create_with_partitions(tracked_commit, partitions)
---
[Medium] function test_simple_tracking in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_simple_tracking(self):
        """"""Test basic offset tracking and committing.""""""
        self.tracker.add_offset(self.partition1, 100)
        self.tracker.add_offset(self.partition1, 101)
        self.tracker.add_offset(self.partition1, 102)

        committable = self.tracker.get_committable_offsets()
        assert committable == {}

        self.tracker.complete_offset(self.partition1, 100)
        committable = self.tracker.get_committable_offsets()
        assert committable == {se
---
[Medium] function test_multiple_partitions in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_multiple_partitions(self):
        """"""Test tracking across multiple partitions.""""""
        self.tracker.add_offset(self.partition1, 100)
        self.tracker.add_offset(self.partition1, 101)
        self.tracker.add_offset(self.partition2, 200)
        self.tracker.add_offset(self.partition2, 201)

        self.tracker.complete_offset(self.partition1, 100)
        self.tracker.complete_offset(self.partition2, 200)
        self.tracker.complete_offset(self.partition2, 201)

        commi
---
[Medium] function test_consistent_group_assignment in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_consistent_group_assignment(self):
        """"""Test that groups are consistently assigned to the same queue.""""""
        group_key = ""group1""
        queue_index1 = self.pool.get_queue_for_group(group_key)
        queue_index2 = self.pool.get_queue_for_group(group_key)
        queue_index3 = self.pool.get_queue_for_group(group_key)

        assert queue_index1 == queue_index2 == queue_index3
---
[Medium] function test_different_groups_distributed in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_different_groups_distributed(self):
        """"""Test that different groups are distributed across queues.""""""
        queue_indices = set()
        for i in range(20):
            group_key = f""group{i}""
            queue_index = self.pool.get_queue_for_group(group_key)
            queue_indices.add(queue_index)

        assert len(queue_indices) == 3
---
[Medium] function test_ordered_processing_within_group in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_ordered_processing_within_group(self):
        """"""Test that items within a group are processed in order.""""""
        partition = Partition(Topic(""test""), 0)
        group_key = ""ordered_group""

        self.expected_items = 5
        self.process_complete_event.clear()

        for i in range(5):
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{i}"",
                message=Message(
                    BrokerVa
---
[Medium] function test_concurrent_processing_across_groups in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_concurrent_processing_across_groups(self):
        """"""Test that different groups are processed concurrently.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 6
        self.process_complete_event.clear()

        for i in range(6):
            group_key = f""group_{i % 3}""
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{group_key}_{i}"",
                message=Message(
       
---
[Medium] function test_stats_reporting in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_stats_reporting(self):
        """"""Test queue statistics reporting.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 10
        self.process_complete_event.clear()

        for i in range(10):
            group_key = f""group_{i % 4}""
            work_item = WorkItem(
                partition=partition,
                offset=i,
                result=f""item_{i}"",
                message=Message(
                    BrokerValue(
                        Ka
---
[Medium] function test_message_processing in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_message_processing(self):
        """"""Test basic message processing.""""""
        partition = 0
        message = self.create_message(""sub1"", partition, 100)

        self.expected_items = 1
        self.process_complete_event.clear()

        self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        assert len(self.processed_results) == 1
        assert self.processed_results[0][""subscription_id""] == ""sub1""
---
[Medium] function test_offset_committing in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_offset_committing(self):
        """"""Test that offsets are committed after processing.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 5
        self.process_complete_event.clear()
        self.commit_event.clear()
        for i in range(5):
            message = self.create_message(""sub1"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        ass
---
[Medium] function test_preserves_order_within_group in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_preserves_order_within_group(self):
        """"""Test that messages for the same subscription are processed in order.""""""
        self.expected_items = 5
        self.process_complete_event.clear()

        for i in range(5):
            message = self.create_message(""sub1"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""
        assert len(self.processed_results) == 5
---
[Medium] function test_concurrent_processing_different_groups in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_concurrent_processing_different_groups(self):
        """"""Test that different subscriptions are processed concurrently.""""""
        self.expected_items = 4
        self.process_complete_event.clear()

        for i in range(4):
            message = self.create_message(f""sub{i % 2}"", 0, 100 + i)
            self.strategy.submit(message)

        assert self.process_complete_event.wait(timeout=5.0), ""Processing did not complete in time""

        assert len(self.processed_results) == 4
---
[Medium] function test_handles_invalid_messages in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_handles_invalid_messages(self):
        """"""Test that invalid messages don't block offset commits.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 1
        self.process_complete_event.clear()
        self.commit_event.clear()

        invalid_message = Message(
            BrokerValue(
                FilteredPayload(),
                partition,
                100,
                datetime.now(),
            )
        )

        self.strategy.submit(i
---
[Medium] function test_offset_gaps_block_commits in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_offset_gaps_block_commits(self):
        """"""Test that gaps in offsets prevent committing past the gap.""""""
        partition = Partition(Topic(""test""), 0)

        self.expected_items = 3  # First batch
        self.process_complete_event.clear()
        self.commit_event.clear()

        self.strategy.submit(self.create_message(""sub1"", 0, 100))
        self.strategy.submit(self.create_message(""sub1"", 0, 102))
        self.strategy.submit(self.create_message(""sub1"", 0, 103))

        ass
---
[Medium] function test_factory_creates_thread_queue_parallel_strategy in tests/sentry/remote_subscriptions/consumers/test_queue_consumer.py:
def test_factory_creates_thread_queue_parallel_strategy(self):
        """"""Test that the factory properly creates thread-queue-parallel strategy.""""""
        from sentry.remote_subscriptions.consumers.result_consumer import (
            ResultProcessor,
            ResultsStrategyFactory,
        )

        class MockResultProcessor(ResultProcessor):
            @property
            def subscription_model(self):
                return mock.Mock()

            def get_subscription_id(self, result
---
[Medium] function test_thread_queue_parallel in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel(self) -> None:
        """"""
        Validates that the consumer in thread-queue-parallel mode processes messages correctly
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        with mock.patch.object(type(factory.result_processor), ""__call__"") as mock_processor_call:
            subscription
---
[Medium] function test_thread_queue_parallel_preserves_order in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_preserves_order(self) -> None:
        """"""
        Test that thread-queue-parallel mode preserves order within subscriptions.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=3,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        with mock.patch.object(type(factory.result_processor), ""__call__"") as mock_processor_call:
            processe
---
[Medium] function test_thread_queue_parallel_concurrent_subscriptions in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_concurrent_subscriptions(self) -> None:
        """"""
        Test that different subscriptions are processed concurrently in thread-queue-parallel mode.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
        commit = mock.Mock()
        consumer = factory.create_with_partitions(commit, {self.partition: 0})

        subscription_2 = self.create_uptime_subscription(
           
---
[Medium] function test_thread_queue_parallel_offset_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_offset_commit(self) -> None:
        """"""
        Test that offsets are committed after successful processing in thread-queue-parallel mode.
        """"""
        committed_offsets: dict[Partition, int] = {}

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )
---
[Medium] function test_thread_queue_parallel_error_handling in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_error_handling(self) -> None:
        """"""
        Test that errors in processing don't block offset commits for other messages.
        """"""
        committed_offsets: dict[Partition, int] = {}

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            committed_offsets.update(offsets)

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=2,
        )

        te
---
[Medium] function test_thread_queue_parallel_offset_gaps in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_offset_gaps(self) -> None:
        """"""
        Test that offset gaps prevent committing past the gap.
        """"""
        all_commits = []

        def track_commits(offsets: Mapping[Partition, int], force: bool = False) -> None:
            all_commits.append(dict(offsets))

        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=1,
        )

        test_partition = Partition(Topic(""test""), 1)
        con
---
[Medium] function test_thread_queue_parallel_graceful_shutdown in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_graceful_shutdown(self) -> None:
        """"""
        Test that the thread-queue-parallel consumer shuts down gracefully.
        """"""
        factory = UptimeResultsStrategyFactory(
            mode=""thread-queue-parallel"",
            max_workers=3,
        )
        consumer = factory.create_with_partitions(mock.Mock(), {self.partition: 0})

        for i in range(5):
            result = self.create_uptime_result(
                self.subscription.subscription_id
---
[Medium] function test_thread_queue_parallel_kafka_offset_commit in tests/sentry/uptime/consumers/test_results_consumer.py:
def test_thread_queue_parallel_kafka_offset_commit(self) -> None:
        """"""
        Test that offsets are actually committed to Kafka consumer group.
        """"""
        subscription = self.create_uptime_subscription(
            subscription_id=uuid.uuid4().hex, interval_seconds=300, region_slugs=[""default""]
        )
        self.create_project_uptime_subscription(
            uptime_subscription=subscription,
            owner=self.user,
        )

        test_id = uuid.uuid4().hex[:8]
   
---
[Medium] class ProcessResultSerialTest in tests/sentry/uptime/consumers/test_results_consumer.py:
class ProcessResultSerialTest(ProcessResultTest):
    strategy_processing_mode = ""serial""

    def test_parallel(self) -> None:
        """"""
        Validates that the consumer in parallel mode correctly groups check-ins
        into groups by their monitor slug / environment
        """"""

        factory = UptimeResultsStrategyFactory(
            mode=""batched-parallel"",
            max_batch_size=3,
            max_workers=1,
        )
        consumer = factory.create_with_partitions(mock.Mock
---
[Medium] function uptime_options in src/sentry/consumers/__init__.py:
def uptime_options() -> list[click.Option]:
    """"""Return a list of uptime-results options.""""""
    options = [
        click.Option(
            [""--mode"", ""mode""],
            type=click.Choice([""serial"", ""parallel"", ""batched-parallel"", ""thread-queue-parallel""]),
            default=""serial"",
            help=""The mode to process results in. Parallel uses multithreading."",
        ),
        click.Option(
            [""--max-batch-size"", ""max_batch_size""],
            type=int,
            defa","result_processor (Critical), ResultsStrategyFactory (Critical), WorkItem (Critical), decoder (Critical), identifier (Critical), add_offset (High), complete_offset (High), FixedQueuePool (High), SimpleQueueProcessingStrategy (High), grouping_fn (High), create_message (High), OffsetTracker (High), get_committable_offsets (High), _get_partition_lock (High), mark_committed (High), get_queue_for_group (High), __init__ (High), get_stats (High), shutdown (High), topic_for_codec (High), join (High), subscription_model (High), get_subscription_id (High), handle_result (High), MockResultProcessor (High), result_processor_cls (High), build_payload_grouping_key (High), OrderedQueueWorker (High), submit (High), wait_until_empty (High), create_thread_queue_parallel_worker (High), commit_offsets (High), create_with_partitions (High), __init__ (High), shutdown (High), setUp (Medium), track_commits (Medium), tracked_commit (Medium), run (Medium), poll (Medium), close (Medium), terminate (Medium), tearDown (Medium), MockFactory (Medium), track_calls (Medium), create_with_partitions_tracking (Medium), test_simple_tracking (Medium), test_multiple_partitions (Medium), test_consistent_group_assignment (Medium), test_different_groups_distributed (Medium), test_ordered_processing_within_group (Medium), test_concurrent_processing_across_groups (Medium), test_stats_reporting (Medium), test_message_processing (Medium), test_offset_committing (Medium), test_preserves_order_within_group (Medium), test_concurrent_processing_different_groups (Medium), test_handles_invalid_messages (Medium), test_offset_gaps_block_commits (Medium), test_factory_creates_thread_queue_parallel_strategy (Medium), test_thread_queue_parallel (Medium), test_thread_queue_parallel_preserves_order (Medium), test_thread_queue_parallel_concurrent_subscriptions (Medium), test_thread_queue_parallel_offset_commit (Medium), test_thread_queue_parallel_error_handling (Medium), test_thread_queue_parallel_offset_gaps (Medium), test_thread_queue_parallel_graceful_shutdown (Medium), test_thread_queue_parallel_kafka_offset_commit (Medium), ProcessResultSerialTest (Medium), uptime_options (Medium), __init__ (Low), __init__ (Low), __init__ (Low), _commit_loop (Low), submit (Low), TestOffsetTracker (Low), TestFixedQueuePool (Low), setUp (Low), TestSimpleQueueProcessingStrategy (Low), setUp (Low), result_processor (Low), commit_function (Low), tearDown (Low), TestThreadQueueParallelIntegration (Low), track_commits (Low), track_commits (Low), ProcessResultThreadQueueParallelKafkaTest (Low)",partial,test function is in HC area but docstring mismatch is style issue
sentry,8,ref(crons): Reorganize incident creation / issue occurrence logic,The function modifies the config variable to include display values but then returns the original monitor.config instead of the modified version.,High,11,1,8,"function::mark_failed (src/sentry/monitors/logic/mark_failed.py) [Critical, score=0.74]","[Critical] function mark_failed in src/sentry/monitors/logic/mark_failed.py:
def mark_failed(
    failed_checkin: MonitorCheckIn,
    ts: datetime,
    received: datetime | None = None,
) -> bool:
    """"""
    Given a failing check-in, mark the monitor environment as failed and trigger
    side effects for creating monitor incidents and issues.

    The provided `ts` is the reference time for when the next check-in time is
    calculated from. This typically would be the failed check-in's `date_added`
    or completion time. Though for the missed and timedout tasks this may be
    computed based on the tasks reference time.
    """"""
    monitor_env = failed_checkin.monitor_environment

    if monitor_env is None:
        return False

    failure_issue_threshold = monitor_env.monitor.config.get(""failure_issue_threshold"", 1)
    if not failure_issue_threshold:
       ","[Medium] function get_failure_reason in src/sentry/monitors/logic/incident_occurrence.py:
def get_failure_reason(failed_checkins: Sequence[SimpleCheckIn]):
    """"""
    Builds a humam readible string from a list of failed check-ins.

    ""3 missed check-ins detected""
    ""2 missed check-ins, 1 timeout check-in and 1 error check-in were detected""
    ""A failed check-in was detected""
    """"""

    status_counts = Counter(
        checkin[""status""]
        for checkin in failed_checkins
        if checkin[""status""] in HUMAN_FAILURE_STATUS_MAP.keys()
    )

    if sum(status_counts.values(
---
[Medium] function get_monitor_environment_context in src/sentry/monitors/logic/incident_occurrence.py:
def get_monitor_environment_context(monitor_environment: MonitorEnvironment):
    config = monitor_environment.monitor.config.copy()
    if ""schedule_type"" in config:
        config[""schedule_type""] = monitor_environment.monitor.get_schedule_type_display()

    return {
        ""id"": str(monitor_environment.monitor.guid),
        ""slug"": str(monitor_environment.monitor.slug),
        ""name"": monitor_environment.monitor.name,
        ""config"": monitor_environment.monitor.config,
        ""status"":
---
[Medium] function try_incident_threshold in src/sentry/monitors/logic/incidents.py:
def try_incident_threshold(
    failed_checkin: MonitorCheckIn,
    failure_issue_threshold: int,
    received: datetime | None,
) -> bool:
    from sentry.signals import monitor_environment_failed

    monitor_env = failed_checkin.monitor_environment

    if monitor_env is None:
        return False

    # check to see if we need to update the status
    if monitor_env.status in [MonitorStatus.OK, MonitorStatus.ACTIVE]:
        if failure_issue_threshold == 1:
            previous_checkins: lis
---
[Medium] class SimpleCheckIn in src/sentry/monitors/logic/mark_failed.py:
class SimpleCheckIn(TypedDict):
    id: int
    date_added: datetime
    status: int
---
[Medium] function mark_failed_threshold in src/sentry/monitors/logic/mark_failed.py:
def mark_failed_threshold(
    failed_checkin: MonitorCheckIn,
    failure_issue_threshold: int,
    received: datetime | None,
) -> bool:
    from sentry.signals import monitor_environment_failed

    monitor_env = failed_checkin.monitor_environment

    if monitor_env is None:
        return False

    # check to see if we need to update the status
    if monitor_env.status in [MonitorStatus.OK, MonitorStatus.ACTIVE]:
        if failure_issue_threshold == 1:
            previous_checkins: list
---
[Medium] function create_issue_platform_occurrence in src/sentry/monitors/logic/mark_failed.py:
def create_issue_platform_occurrence(
    failed_checkins: Sequence[SimpleCheckIn],
    failed_checkin: MonitorCheckIn,
    incident: MonitorIncident,
    received: datetime | None,
) -> None:
    from sentry.issues.issue_occurrence import IssueEvidence, IssueOccurrence
    from sentry.issues.producer import PayloadType, produce_occurrence_to_kafka

    monitor_env = failed_checkin.monitor_environment

    if monitor_env is None:
        return

    current_timestamp = datetime.now(timezone.utc)
---
[Medium] function get_failure_reason in src/sentry/monitors/logic/mark_failed.py:
def get_failure_reason(failed_checkins: Sequence[SimpleCheckIn]):
    """"""
    Builds a humam readible string from a list of failed check-ins.

    ""3 missed check-ins detected""
    ""2 missed check-ins, 1 timeout check-in and 1 error check-in were detected""
    ""A failed check-in was detected""
    """"""

    status_counts = Counter(
        checkin[""status""]
        for checkin in failed_checkins
        if checkin[""status""] in HUMAN_FAILURE_STATUS_MAP.keys()
    )

    if sum(status_counts.values(
---
[Medium] function get_monitor_environment_context in src/sentry/monitors/logic/mark_failed.py:
def get_monitor_environment_context(monitor_environment: MonitorEnvironment):
    config = monitor_environment.monitor.config.copy()
    if ""schedule_type"" in config:
        config[""schedule_type""] = monitor_environment.monitor.get_schedule_type_display()

    return {
        ""id"": str(monitor_environment.monitor.guid),
        ""slug"": str(monitor_environment.monitor.slug),
        ""name"": monitor_environment.monitor.name,
        ""config"": monitor_environment.monitor.config,
        ""status"":","mark_failed (Critical), get_failure_reason (Medium), get_monitor_environment_context (Medium), try_incident_threshold (Medium), SimpleCheckIn (Medium), mark_failed_threshold (Medium), create_issue_platform_occurrence (Medium), get_failure_reason (Medium), get_monitor_environment_context (Medium), create_incident_occurrence (Low), SimpleCheckIn (Low)",match,'monitor' matches entity 'get_monitor_environment_context'
sentry,8,ref(crons): Reorganize incident creation / issue occurrence logic,The code fetches MonitorCheckIn objects by ID when the required data already exists in previous_checkins. This creates an unnecessary database query.,Low,11,1,8,"function::mark_failed (src/sentry/monitors/logic/mark_failed.py) [Critical, score=0.74]","[Critical] function mark_failed in src/sentry/monitors/logic/mark_failed.py:
def mark_failed(
    failed_checkin: MonitorCheckIn,
    ts: datetime,
    received: datetime | None = None,
) -> bool:
    """"""
    Given a failing check-in, mark the monitor environment as failed and trigger
    side effects for creating monitor incidents and issues.

    The provided `ts` is the reference time for when the next check-in time is
    calculated from. This typically would be the failed check-in's `date_added`
    or completion time. Though for the missed and timedout tasks this may be
    computed based on the tasks reference time.
    """"""
    monitor_env = failed_checkin.monitor_environment

    if monitor_env is None:
        return False

    failure_issue_threshold = monitor_env.monitor.config.get(""failure_issue_threshold"", 1)
    if not failure_issue_threshold:
       ","[Medium] function get_failure_reason in src/sentry/monitors/logic/incident_occurrence.py:
def get_failure_reason(failed_checkins: Sequence[SimpleCheckIn]):
    """"""
    Builds a humam readible string from a list of failed check-ins.

    ""3 missed check-ins detected""
    ""2 missed check-ins, 1 timeout check-in and 1 error check-in were detected""
    ""A failed check-in was detected""
    """"""

    status_counts = Counter(
        checkin[""status""]
        for checkin in failed_checkins
        if checkin[""status""] in HUMAN_FAILURE_STATUS_MAP.keys()
    )

    if sum(status_counts.values(
---
[Medium] function get_monitor_environment_context in src/sentry/monitors/logic/incident_occurrence.py:
def get_monitor_environment_context(monitor_environment: MonitorEnvironment):
    config = monitor_environment.monitor.config.copy()
    if ""schedule_type"" in config:
        config[""schedule_type""] = monitor_environment.monitor.get_schedule_type_display()

    return {
        ""id"": str(monitor_environment.monitor.guid),
        ""slug"": str(monitor_environment.monitor.slug),
        ""name"": monitor_environment.monitor.name,
        ""config"": monitor_environment.monitor.config,
        ""status"":
---
[Medium] function try_incident_threshold in src/sentry/monitors/logic/incidents.py:
def try_incident_threshold(
    failed_checkin: MonitorCheckIn,
    failure_issue_threshold: int,
    received: datetime | None,
) -> bool:
    from sentry.signals import monitor_environment_failed

    monitor_env = failed_checkin.monitor_environment

    if monitor_env is None:
        return False

    # check to see if we need to update the status
    if monitor_env.status in [MonitorStatus.OK, MonitorStatus.ACTIVE]:
        if failure_issue_threshold == 1:
            previous_checkins: lis
---
[Medium] class SimpleCheckIn in src/sentry/monitors/logic/mark_failed.py:
class SimpleCheckIn(TypedDict):
    id: int
    date_added: datetime
    status: int
---
[Medium] function mark_failed_threshold in src/sentry/monitors/logic/mark_failed.py:
def mark_failed_threshold(
    failed_checkin: MonitorCheckIn,
    failure_issue_threshold: int,
    received: datetime | None,
) -> bool:
    from sentry.signals import monitor_environment_failed

    monitor_env = failed_checkin.monitor_environment

    if monitor_env is None:
        return False

    # check to see if we need to update the status
    if monitor_env.status in [MonitorStatus.OK, MonitorStatus.ACTIVE]:
        if failure_issue_threshold == 1:
            previous_checkins: list
---
[Medium] function create_issue_platform_occurrence in src/sentry/monitors/logic/mark_failed.py:
def create_issue_platform_occurrence(
    failed_checkins: Sequence[SimpleCheckIn],
    failed_checkin: MonitorCheckIn,
    incident: MonitorIncident,
    received: datetime | None,
) -> None:
    from sentry.issues.issue_occurrence import IssueEvidence, IssueOccurrence
    from sentry.issues.producer import PayloadType, produce_occurrence_to_kafka

    monitor_env = failed_checkin.monitor_environment

    if monitor_env is None:
        return

    current_timestamp = datetime.now(timezone.utc)
---
[Medium] function get_failure_reason in src/sentry/monitors/logic/mark_failed.py:
def get_failure_reason(failed_checkins: Sequence[SimpleCheckIn]):
    """"""
    Builds a humam readible string from a list of failed check-ins.

    ""3 missed check-ins detected""
    ""2 missed check-ins, 1 timeout check-in and 1 error check-in were detected""
    ""A failed check-in was detected""
    """"""

    status_counts = Counter(
        checkin[""status""]
        for checkin in failed_checkins
        if checkin[""status""] in HUMAN_FAILURE_STATUS_MAP.keys()
    )

    if sum(status_counts.values(
---
[Medium] function get_monitor_environment_context in src/sentry/monitors/logic/mark_failed.py:
def get_monitor_environment_context(monitor_environment: MonitorEnvironment):
    config = monitor_environment.monitor.config.copy()
    if ""schedule_type"" in config:
        config[""schedule_type""] = monitor_environment.monitor.get_schedule_type_display()

    return {
        ""id"": str(monitor_environment.monitor.guid),
        ""slug"": str(monitor_environment.monitor.slug),
        ""name"": monitor_environment.monitor.name,
        ""config"": monitor_environment.monitor.config,
        ""status"":","mark_failed (Critical), get_failure_reason (Medium), get_monitor_environment_context (Medium), try_incident_threshold (Medium), SimpleCheckIn (Medium), mark_failed_threshold (Medium), create_issue_platform_occurrence (Medium), get_failure_reason (Medium), get_monitor_environment_context (Medium), create_incident_occurrence (Low), SimpleCheckIn (Low)",partial,"HC entities exist (1) but no name match; golden idents: {'creates', 'query', 'database', 'previous_checkins', 'fetches', 'exists', 'objects', 'unnecessary', 'MonitorCheckIn'}"
sentry,7,feat(ecosystem): Implement cross-system issue synchronization,Shared mutable default in dataclass timestamp,Medium,21,10,10,"function::AssignmentSource (src/sentry/integrations/services/assignment_source.py) [Critical, score=0.89] | class::IssueSyncIntegration (src/sentry/integrations/mixins/issues.py) [Critical, score=0.83] | function::deassign (src/sentry/models/groupassignee.py) [Critical, score=0.78] | function::sync_group_assignee_inbound (src/sentry/integrations/utils/sync.py) [Critical, score=0.75] | class::IssueBasicIntegration (src/sentry/integrations/mixins/issues.py) [High, score=0.66] | function::sync_group_assignee_outbound (src/sentry/integrations/utils/sync.py) [High, score=0.64] | class::GroupAssigneeManager (src/sentry/models/groupassignee.py) [High, score=0.61] | function::assign (src/sentry/models/groupassignee.py) [High, score=0.61] | function::should_sync (src/sentry/integrations/mixins/issues.py) [High, score=0.60] | function::sync_status_outbound (src/sentry/integrations/mixins/issues.py) [High, score=0.56]","[Critical] function AssignmentSource in src/sentry/integrations/services/assignment_source.py:
@dataclass(frozen=True)
class AssignmentSource:
    source_name: str
    integration_id: int
    queued: datetime = timezone.now()

    @classmethod
    def from_integration(cls, integration: Integration | RpcIntegration) -> AssignmentSource:
        return AssignmentSource(
            source_name=integration.name,
            integration_id=integration.id,
        )

    def to_dict(self) -> dict[str, Any]:
        return asdict(self)

    @classmethod
    def from_dict(cls, input_dict: dict[str, Any]) -> AssignmentSource | None:
        try:
            return cls(**input_dict)
        except (ValueError, TypeError):
            return None
---
[Critical] class IssueSyncIntegration in src/sentry/integrations/mixins/issues.py:
class IssueSyncIntegration(IssueBasicIntegration, ABC):
    comment_key: ClassVar[str | None] = None
    outbound_status_key: ClassVar[str | None] = None
    inbound_status_key: ClassVar[str | None] = None
    outbound_assignee_key: ClassVar[str | None] = None
    inbound_assignee_key: ClassVar[str | None] = None

    def should_sync(self, attribute: str, sync_source: AssignmentSource | None = None) -> bool:
        key = getattr(self, f""{attribute}_key"", None)
        if key is None or self.org_integration is None:
            return False

        # Check that the assignment source isn't this same integration in order to
        # prevent sync-cycles from occurring. This should still allow other
        # integrations to propagate changes outward.
        if sync_source and sync_source.i
---
[Critical] function deassign in src/sentry/models/groupassignee.py:
def deassign(
        self,
        group: Group,
        acting_user: User | RpcUser | None = None,
        assigned_to: Team | RpcUser | None = None,
        extra: dict[str, str] | None = None,
        assignment_source: AssignmentSource | None = None,
    ) -> None:
        from sentry.integrations.utils import sync_group_assignee_outbound
        from sentry.models.activity import Activity
        from sentry.models.projectownership import ProjectOwnership

        try:
            previous_groupassignee = self.get(group=group)
        except GroupAssignee.DoesNotExist:
            previous_groupassignee = None

        affected = self.filter(group=group)[:1].count()
        self.filter(group=group).delete()

        if affected > 0:
            Activity.objects.create_group_activity(
---
[Critical] function sync_group_assignee_inbound in src/sentry/integrations/utils/sync.py:
@region_silo_function
def sync_group_assignee_inbound(
    integration: RpcIntegration,
    email: str | None,
    external_issue_key: str,
    assign: bool = True,
) -> Sequence[Group]:
    """"""
    Given an integration, user email address and an external issue key,
    assign linked groups to matching users. Checks project membership.
    Returns a list of groups that were successfully assigned.
    """"""

    logger = logging.getLogger(f""sentry.integrations.{integration.provider}"")

    orgs_with_sync_enabled = where_should_sync(integration, ""inbound_assignee"")
    affected_groups = Group.objects.get_groups_by_external_issue(
        integration,
        orgs_with_sync_enabled,
        external_issue_key,
    )
    log_context = {
        ""integration_id"": integration.id,
        ""email"": 
---
[High] class IssueBasicIntegration in src/sentry/integrations/mixins/issues.py:
class IssueBasicIntegration(IntegrationInstallation, ABC):
    def should_sync(self, attribute, sync_source: AssignmentSource | None = None):
        return False

    def get_group_title(self, group, event, **kwargs):
        return get_notification_group_title(group, event, **kwargs)

    @abstractmethod
    def get_issue_url(self, key: str) -> str:
        """"""
        Given the key of the external_issue return the external issue link.
        """"""
        raise NotImplementedError

    def get_group_body(self, group, event, **kwargs):
        result = []
        for interface in event.interfaces.values():
            output = safe_execute(interface.to_string, event)
            if output:
                result.append(output)
        return ""\n\n"".join(result)

    def get_feedback_issue
---
[High] function sync_group_assignee_outbound in src/sentry/integrations/utils/sync.py:
def sync_group_assignee_outbound(
    group: Group,
    user_id: int | None,
    assign: bool = True,
    assignment_source: AssignmentSource | None = None,
) -> None:
    from sentry.models.grouplink import GroupLink

    external_issue_ids = GroupLink.objects.filter(
        project_id=group.project_id, group_id=group.id, linked_type=GroupLink.LinkedType.issue
    ).values_list(""linked_id"", flat=True)

    for external_issue_id in external_issue_ids:
        sync_assignee_outbound.apply_async(
            kwargs={
                ""external_issue_id"": external_issue_id,
                ""user_id"": user_id,
                ""assign"": assign,
                ""assignment_source_dict"": assignment_source.to_dict()
                if assignment_source
                else None,
            }
    
---
[High] class GroupAssigneeManager in src/sentry/models/groupassignee.py:
class GroupAssigneeManager(BaseManager[""GroupAssignee""]):
    def get_assigned_to_data(
        self, assigned_to: Team | RpcUser, assignee_type: str, extra: dict[str, str] | None = None
    ) -> dict[str, Any]:
        data = {
            ""assignee"": str(assigned_to.id),
            ""assigneeEmail"": getattr(assigned_to, ""email"", None),
            ""assigneeType"": assignee_type,
        }
        if extra:
            data.update(extra)

        return data

    def get_assignee_data(self, assigned_to: Team | RpcUser) -> tuple[str, str, str]:
        from sentry.models.team import Team
        from sentry.users.models.user import User
        from sentry.users.services.user import RpcUser

        if isinstance(assigned_to, (User, RpcUser)):
            assignee_type = ""user""
            
---
[High] function assign in src/sentry/models/groupassignee.py:
def assign(
        self,
        group: Group,
        assigned_to: Team | RpcUser,
        acting_user: User | None = None,
        create_only: bool = False,
        extra: dict[str, str] | None = None,
        force_autoassign: bool = False,
        assignment_source: AssignmentSource | None = None,
    ):
        from sentry.integrations.utils import sync_group_assignee_outbound
        from sentry.models.activity import Activity
        from sentry.models.groupsubscription import GroupSubscription

        GroupSubscription.objects.subscribe_actor(
            group=group, actor=assigned_to, reason=GroupSubscriptionReason.assigned
        )

        assigned_to_id = assigned_to.id
        assignee_type, assignee_type_attr, other_type = self.get_assignee_data(assigned_to)

        now
---
[High] function should_sync in src/sentry/integrations/mixins/issues.py:
def should_sync(self, attribute, sync_source: AssignmentSource | None = None):
        return False
---
[High] function sync_status_outbound in src/sentry/integrations/mixins/issues.py:
@abstractmethod
    def sync_status_outbound(
        self,
        external_issue,
        is_resolved,
        project_id,
        assignment_source: AssignmentSource | None = None,
        **kwargs,
    ):
        """"""
        Propagate a sentry issue's status to a linked issue's status.
        """"""
        raise NotImplementedError","[Medium] function test_assignee_sync_outbound_unassign in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_unassign(self, mock_sync_assignee_outbound):
        group = self.group

        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_status_outbound"": True,
                    ""sy
---
[Medium] function test_assignee_sync_outbound_assign in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_assign(self, mock_sync_assignee_outbound):
        group = self.group
        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_status_outbound"": True,
                    ""sync_
---
[Medium] function should_sync in src/sentry/integrations/mixins/issues.py:
def should_sync(self, attribute: str, sync_source: AssignmentSource | None = None) -> bool:
        key = getattr(self, f""{attribute}_key"", None)
        if key is None or self.org_integration is None:
            return False

        # Check that the assignment source isn't this same integration in order to
        # prevent sync-cycles from occurring. This should still allow other
        # integrations to propagate changes outward.
        if sync_source and sync_source.integration_id == sel
---
[Medium] class GroupAssigneeTestCase in tests/sentry/models/test_groupassignee.py:
class GroupAssigneeTestCase(TestCase):
    def test_constraints(self):
        # Can't both be assigned
        with pytest.raises(AssertionError):
            GroupAssignee.objects.create(
                group=self.group, project=self.group.project, user_id=self.user.id, team=self.team
            )

        # Can't have nobody assigned
        with pytest.raises(AssertionError):
            GroupAssignee.objects.create(
                group=self.group, project=self.group.project, user_id=Non
---
[Medium] function test_from_dict_empty_array in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_empty_array(self):
        data: dict[str, Any] = {}
        result = AssignmentSource.from_dict(data)
        assert result is None
---
[Medium] function test_from_dict_inalid_data in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_inalid_data(self):
        data = {
            ""foo"": ""bar"",
        }

        result = AssignmentSource.from_dict(data)
        assert result is None
---
[Medium] function test_from_dict_valid_data in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_valid_data(self):
        data = {""source_name"": ""foo-source"", ""integration_id"": 123}

        result = AssignmentSource.from_dict(data)
        assert result is not None
        assert result.source_name == ""foo-source""
        assert result.integration_id == 123
---
[Medium] function test_to_dict in tests/sentry/integrations/services/test_assignment_source.py:
def test_to_dict(self):
        source = AssignmentSource(
            source_name=""foo-source"",
            integration_id=123,
        )

        result = source.to_dict()
        assert result.get(""queued"") is not None
        assert result.get(""source_name"") == ""foo-source""
        assert result.get(""integration_id"") == 123
---
[Medium] function test_assignee_sync_outbound_assign_with_matching_source_integration in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_assign_with_matching_source_integration(
        self, mock_sync_assignee_outbound
    ):
        group = self.group
        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_sta
---
[Medium] function sync_assignee_outbound in src/sentry/integrations/tasks/sync_assignee_outbound.py:
@instrumented_task(
    name=""sentry.integrations.tasks.sync_assignee_outbound"",
    queue=""integrations"",
    default_retry_delay=60 * 5,
    max_retries=5,
    silo_mode=SiloMode.REGION,
)
@retry(
    exclude=(
        ExternalIssue.DoesNotExist,
        Integration.DoesNotExist,
        User.DoesNotExist,
        Organization.DoesNotExist,
    )
)
def sync_assignee_outbound(
    external_issue_id: int,
    user_id: int | None,
    assign: bool,
    assignment_source_dict: dict[str, Any] | Non","AssignmentSource (Critical), IssueSyncIntegration (Critical), deassign (Critical), sync_group_assignee_inbound (Critical), IssueBasicIntegration (High), sync_group_assignee_outbound (High), GroupAssigneeManager (High), assign (High), should_sync (High), sync_status_outbound (High), test_assignee_sync_outbound_unassign (Medium), test_assignee_sync_outbound_assign (Medium), should_sync (Medium), GroupAssigneeTestCase (Medium), test_from_dict_empty_array (Medium), test_from_dict_inalid_data (Medium), test_from_dict_valid_data (Medium), test_to_dict (Medium), test_assignee_sync_outbound_assign_with_matching_source_integration (Medium), sync_assignee_outbound (Medium), TestAssignmentSource (Low)",partial,"HC entities exist (10) but no name match; golden idents: {'Shared', 'timestamp', 'mutable', 'dataclass', 'default'}"
sentry,7,feat(ecosystem): Implement cross-system issue synchronization,The method name has a typo: test_from_dict_inalid_data should be test_from_dict_invalid_data.,Low,21,10,10,"function::AssignmentSource (src/sentry/integrations/services/assignment_source.py) [Critical, score=0.89] | class::IssueSyncIntegration (src/sentry/integrations/mixins/issues.py) [Critical, score=0.83] | function::deassign (src/sentry/models/groupassignee.py) [Critical, score=0.78] | function::sync_group_assignee_inbound (src/sentry/integrations/utils/sync.py) [Critical, score=0.75] | class::IssueBasicIntegration (src/sentry/integrations/mixins/issues.py) [High, score=0.66] | function::sync_group_assignee_outbound (src/sentry/integrations/utils/sync.py) [High, score=0.64] | class::GroupAssigneeManager (src/sentry/models/groupassignee.py) [High, score=0.61] | function::assign (src/sentry/models/groupassignee.py) [High, score=0.61] | function::should_sync (src/sentry/integrations/mixins/issues.py) [High, score=0.60] | function::sync_status_outbound (src/sentry/integrations/mixins/issues.py) [High, score=0.56]","[Critical] function AssignmentSource in src/sentry/integrations/services/assignment_source.py:
@dataclass(frozen=True)
class AssignmentSource:
    source_name: str
    integration_id: int
    queued: datetime = timezone.now()

    @classmethod
    def from_integration(cls, integration: Integration | RpcIntegration) -> AssignmentSource:
        return AssignmentSource(
            source_name=integration.name,
            integration_id=integration.id,
        )

    def to_dict(self) -> dict[str, Any]:
        return asdict(self)

    @classmethod
    def from_dict(cls, input_dict: dict[str, Any]) -> AssignmentSource | None:
        try:
            return cls(**input_dict)
        except (ValueError, TypeError):
            return None
---
[Critical] class IssueSyncIntegration in src/sentry/integrations/mixins/issues.py:
class IssueSyncIntegration(IssueBasicIntegration, ABC):
    comment_key: ClassVar[str | None] = None
    outbound_status_key: ClassVar[str | None] = None
    inbound_status_key: ClassVar[str | None] = None
    outbound_assignee_key: ClassVar[str | None] = None
    inbound_assignee_key: ClassVar[str | None] = None

    def should_sync(self, attribute: str, sync_source: AssignmentSource | None = None) -> bool:
        key = getattr(self, f""{attribute}_key"", None)
        if key is None or self.org_integration is None:
            return False

        # Check that the assignment source isn't this same integration in order to
        # prevent sync-cycles from occurring. This should still allow other
        # integrations to propagate changes outward.
        if sync_source and sync_source.i
---
[Critical] function deassign in src/sentry/models/groupassignee.py:
def deassign(
        self,
        group: Group,
        acting_user: User | RpcUser | None = None,
        assigned_to: Team | RpcUser | None = None,
        extra: dict[str, str] | None = None,
        assignment_source: AssignmentSource | None = None,
    ) -> None:
        from sentry.integrations.utils import sync_group_assignee_outbound
        from sentry.models.activity import Activity
        from sentry.models.projectownership import ProjectOwnership

        try:
            previous_groupassignee = self.get(group=group)
        except GroupAssignee.DoesNotExist:
            previous_groupassignee = None

        affected = self.filter(group=group)[:1].count()
        self.filter(group=group).delete()

        if affected > 0:
            Activity.objects.create_group_activity(
---
[Critical] function sync_group_assignee_inbound in src/sentry/integrations/utils/sync.py:
@region_silo_function
def sync_group_assignee_inbound(
    integration: RpcIntegration,
    email: str | None,
    external_issue_key: str,
    assign: bool = True,
) -> Sequence[Group]:
    """"""
    Given an integration, user email address and an external issue key,
    assign linked groups to matching users. Checks project membership.
    Returns a list of groups that were successfully assigned.
    """"""

    logger = logging.getLogger(f""sentry.integrations.{integration.provider}"")

    orgs_with_sync_enabled = where_should_sync(integration, ""inbound_assignee"")
    affected_groups = Group.objects.get_groups_by_external_issue(
        integration,
        orgs_with_sync_enabled,
        external_issue_key,
    )
    log_context = {
        ""integration_id"": integration.id,
        ""email"": 
---
[High] class IssueBasicIntegration in src/sentry/integrations/mixins/issues.py:
class IssueBasicIntegration(IntegrationInstallation, ABC):
    def should_sync(self, attribute, sync_source: AssignmentSource | None = None):
        return False

    def get_group_title(self, group, event, **kwargs):
        return get_notification_group_title(group, event, **kwargs)

    @abstractmethod
    def get_issue_url(self, key: str) -> str:
        """"""
        Given the key of the external_issue return the external issue link.
        """"""
        raise NotImplementedError

    def get_group_body(self, group, event, **kwargs):
        result = []
        for interface in event.interfaces.values():
            output = safe_execute(interface.to_string, event)
            if output:
                result.append(output)
        return ""\n\n"".join(result)

    def get_feedback_issue
---
[High] function sync_group_assignee_outbound in src/sentry/integrations/utils/sync.py:
def sync_group_assignee_outbound(
    group: Group,
    user_id: int | None,
    assign: bool = True,
    assignment_source: AssignmentSource | None = None,
) -> None:
    from sentry.models.grouplink import GroupLink

    external_issue_ids = GroupLink.objects.filter(
        project_id=group.project_id, group_id=group.id, linked_type=GroupLink.LinkedType.issue
    ).values_list(""linked_id"", flat=True)

    for external_issue_id in external_issue_ids:
        sync_assignee_outbound.apply_async(
            kwargs={
                ""external_issue_id"": external_issue_id,
                ""user_id"": user_id,
                ""assign"": assign,
                ""assignment_source_dict"": assignment_source.to_dict()
                if assignment_source
                else None,
            }
    
---
[High] class GroupAssigneeManager in src/sentry/models/groupassignee.py:
class GroupAssigneeManager(BaseManager[""GroupAssignee""]):
    def get_assigned_to_data(
        self, assigned_to: Team | RpcUser, assignee_type: str, extra: dict[str, str] | None = None
    ) -> dict[str, Any]:
        data = {
            ""assignee"": str(assigned_to.id),
            ""assigneeEmail"": getattr(assigned_to, ""email"", None),
            ""assigneeType"": assignee_type,
        }
        if extra:
            data.update(extra)

        return data

    def get_assignee_data(self, assigned_to: Team | RpcUser) -> tuple[str, str, str]:
        from sentry.models.team import Team
        from sentry.users.models.user import User
        from sentry.users.services.user import RpcUser

        if isinstance(assigned_to, (User, RpcUser)):
            assignee_type = ""user""
            
---
[High] function assign in src/sentry/models/groupassignee.py:
def assign(
        self,
        group: Group,
        assigned_to: Team | RpcUser,
        acting_user: User | None = None,
        create_only: bool = False,
        extra: dict[str, str] | None = None,
        force_autoassign: bool = False,
        assignment_source: AssignmentSource | None = None,
    ):
        from sentry.integrations.utils import sync_group_assignee_outbound
        from sentry.models.activity import Activity
        from sentry.models.groupsubscription import GroupSubscription

        GroupSubscription.objects.subscribe_actor(
            group=group, actor=assigned_to, reason=GroupSubscriptionReason.assigned
        )

        assigned_to_id = assigned_to.id
        assignee_type, assignee_type_attr, other_type = self.get_assignee_data(assigned_to)

        now
---
[High] function should_sync in src/sentry/integrations/mixins/issues.py:
def should_sync(self, attribute, sync_source: AssignmentSource | None = None):
        return False
---
[High] function sync_status_outbound in src/sentry/integrations/mixins/issues.py:
@abstractmethod
    def sync_status_outbound(
        self,
        external_issue,
        is_resolved,
        project_id,
        assignment_source: AssignmentSource | None = None,
        **kwargs,
    ):
        """"""
        Propagate a sentry issue's status to a linked issue's status.
        """"""
        raise NotImplementedError","[Medium] function test_assignee_sync_outbound_unassign in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_unassign(self, mock_sync_assignee_outbound):
        group = self.group

        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_status_outbound"": True,
                    ""sy
---
[Medium] function test_assignee_sync_outbound_assign in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_assign(self, mock_sync_assignee_outbound):
        group = self.group
        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_status_outbound"": True,
                    ""sync_
---
[Medium] function should_sync in src/sentry/integrations/mixins/issues.py:
def should_sync(self, attribute: str, sync_source: AssignmentSource | None = None) -> bool:
        key = getattr(self, f""{attribute}_key"", None)
        if key is None or self.org_integration is None:
            return False

        # Check that the assignment source isn't this same integration in order to
        # prevent sync-cycles from occurring. This should still allow other
        # integrations to propagate changes outward.
        if sync_source and sync_source.integration_id == sel
---
[Medium] class GroupAssigneeTestCase in tests/sentry/models/test_groupassignee.py:
class GroupAssigneeTestCase(TestCase):
    def test_constraints(self):
        # Can't both be assigned
        with pytest.raises(AssertionError):
            GroupAssignee.objects.create(
                group=self.group, project=self.group.project, user_id=self.user.id, team=self.team
            )

        # Can't have nobody assigned
        with pytest.raises(AssertionError):
            GroupAssignee.objects.create(
                group=self.group, project=self.group.project, user_id=Non
---
[Medium] function test_from_dict_empty_array in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_empty_array(self):
        data: dict[str, Any] = {}
        result = AssignmentSource.from_dict(data)
        assert result is None
---
[Medium] function test_from_dict_inalid_data in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_inalid_data(self):
        data = {
            ""foo"": ""bar"",
        }

        result = AssignmentSource.from_dict(data)
        assert result is None
---
[Medium] function test_from_dict_valid_data in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_valid_data(self):
        data = {""source_name"": ""foo-source"", ""integration_id"": 123}

        result = AssignmentSource.from_dict(data)
        assert result is not None
        assert result.source_name == ""foo-source""
        assert result.integration_id == 123
---
[Medium] function test_to_dict in tests/sentry/integrations/services/test_assignment_source.py:
def test_to_dict(self):
        source = AssignmentSource(
            source_name=""foo-source"",
            integration_id=123,
        )

        result = source.to_dict()
        assert result.get(""queued"") is not None
        assert result.get(""source_name"") == ""foo-source""
        assert result.get(""integration_id"") == 123
---
[Medium] function test_assignee_sync_outbound_assign_with_matching_source_integration in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_assign_with_matching_source_integration(
        self, mock_sync_assignee_outbound
    ):
        group = self.group
        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_sta
---
[Medium] function sync_assignee_outbound in src/sentry/integrations/tasks/sync_assignee_outbound.py:
@instrumented_task(
    name=""sentry.integrations.tasks.sync_assignee_outbound"",
    queue=""integrations"",
    default_retry_delay=60 * 5,
    max_retries=5,
    silo_mode=SiloMode.REGION,
)
@retry(
    exclude=(
        ExternalIssue.DoesNotExist,
        Integration.DoesNotExist,
        User.DoesNotExist,
        Organization.DoesNotExist,
    )
)
def sync_assignee_outbound(
    external_issue_id: int,
    user_id: int | None,
    assign: bool,
    assignment_source_dict: dict[str, Any] | Non","AssignmentSource (Critical), IssueSyncIntegration (Critical), deassign (Critical), sync_group_assignee_inbound (Critical), IssueBasicIntegration (High), sync_group_assignee_outbound (High), GroupAssigneeManager (High), assign (High), should_sync (High), sync_status_outbound (High), test_assignee_sync_outbound_unassign (Medium), test_assignee_sync_outbound_assign (Medium), should_sync (Medium), GroupAssigneeTestCase (Medium), test_from_dict_empty_array (Medium), test_from_dict_inalid_data (Medium), test_from_dict_valid_data (Medium), test_to_dict (Medium), test_assignee_sync_outbound_assign_with_matching_source_integration (Medium), sync_assignee_outbound (Medium), TestAssignmentSource (Low)",partial,test is in the assignment source area (HC) but typo is a naming issue
sentry,7,feat(ecosystem): Implement cross-system issue synchronization,Method name says 'empty_array' but tests empty dict - consider renaming to 'test_from_dict_empty_dict' for clarity.,Low,21,10,10,"function::AssignmentSource (src/sentry/integrations/services/assignment_source.py) [Critical, score=0.89] | class::IssueSyncIntegration (src/sentry/integrations/mixins/issues.py) [Critical, score=0.83] | function::deassign (src/sentry/models/groupassignee.py) [Critical, score=0.78] | function::sync_group_assignee_inbound (src/sentry/integrations/utils/sync.py) [Critical, score=0.75] | class::IssueBasicIntegration (src/sentry/integrations/mixins/issues.py) [High, score=0.66] | function::sync_group_assignee_outbound (src/sentry/integrations/utils/sync.py) [High, score=0.64] | class::GroupAssigneeManager (src/sentry/models/groupassignee.py) [High, score=0.61] | function::assign (src/sentry/models/groupassignee.py) [High, score=0.61] | function::should_sync (src/sentry/integrations/mixins/issues.py) [High, score=0.60] | function::sync_status_outbound (src/sentry/integrations/mixins/issues.py) [High, score=0.56]","[Critical] function AssignmentSource in src/sentry/integrations/services/assignment_source.py:
@dataclass(frozen=True)
class AssignmentSource:
    source_name: str
    integration_id: int
    queued: datetime = timezone.now()

    @classmethod
    def from_integration(cls, integration: Integration | RpcIntegration) -> AssignmentSource:
        return AssignmentSource(
            source_name=integration.name,
            integration_id=integration.id,
        )

    def to_dict(self) -> dict[str, Any]:
        return asdict(self)

    @classmethod
    def from_dict(cls, input_dict: dict[str, Any]) -> AssignmentSource | None:
        try:
            return cls(**input_dict)
        except (ValueError, TypeError):
            return None
---
[Critical] class IssueSyncIntegration in src/sentry/integrations/mixins/issues.py:
class IssueSyncIntegration(IssueBasicIntegration, ABC):
    comment_key: ClassVar[str | None] = None
    outbound_status_key: ClassVar[str | None] = None
    inbound_status_key: ClassVar[str | None] = None
    outbound_assignee_key: ClassVar[str | None] = None
    inbound_assignee_key: ClassVar[str | None] = None

    def should_sync(self, attribute: str, sync_source: AssignmentSource | None = None) -> bool:
        key = getattr(self, f""{attribute}_key"", None)
        if key is None or self.org_integration is None:
            return False

        # Check that the assignment source isn't this same integration in order to
        # prevent sync-cycles from occurring. This should still allow other
        # integrations to propagate changes outward.
        if sync_source and sync_source.i
---
[Critical] function deassign in src/sentry/models/groupassignee.py:
def deassign(
        self,
        group: Group,
        acting_user: User | RpcUser | None = None,
        assigned_to: Team | RpcUser | None = None,
        extra: dict[str, str] | None = None,
        assignment_source: AssignmentSource | None = None,
    ) -> None:
        from sentry.integrations.utils import sync_group_assignee_outbound
        from sentry.models.activity import Activity
        from sentry.models.projectownership import ProjectOwnership

        try:
            previous_groupassignee = self.get(group=group)
        except GroupAssignee.DoesNotExist:
            previous_groupassignee = None

        affected = self.filter(group=group)[:1].count()
        self.filter(group=group).delete()

        if affected > 0:
            Activity.objects.create_group_activity(
---
[Critical] function sync_group_assignee_inbound in src/sentry/integrations/utils/sync.py:
@region_silo_function
def sync_group_assignee_inbound(
    integration: RpcIntegration,
    email: str | None,
    external_issue_key: str,
    assign: bool = True,
) -> Sequence[Group]:
    """"""
    Given an integration, user email address and an external issue key,
    assign linked groups to matching users. Checks project membership.
    Returns a list of groups that were successfully assigned.
    """"""

    logger = logging.getLogger(f""sentry.integrations.{integration.provider}"")

    orgs_with_sync_enabled = where_should_sync(integration, ""inbound_assignee"")
    affected_groups = Group.objects.get_groups_by_external_issue(
        integration,
        orgs_with_sync_enabled,
        external_issue_key,
    )
    log_context = {
        ""integration_id"": integration.id,
        ""email"": 
---
[High] class IssueBasicIntegration in src/sentry/integrations/mixins/issues.py:
class IssueBasicIntegration(IntegrationInstallation, ABC):
    def should_sync(self, attribute, sync_source: AssignmentSource | None = None):
        return False

    def get_group_title(self, group, event, **kwargs):
        return get_notification_group_title(group, event, **kwargs)

    @abstractmethod
    def get_issue_url(self, key: str) -> str:
        """"""
        Given the key of the external_issue return the external issue link.
        """"""
        raise NotImplementedError

    def get_group_body(self, group, event, **kwargs):
        result = []
        for interface in event.interfaces.values():
            output = safe_execute(interface.to_string, event)
            if output:
                result.append(output)
        return ""\n\n"".join(result)

    def get_feedback_issue
---
[High] function sync_group_assignee_outbound in src/sentry/integrations/utils/sync.py:
def sync_group_assignee_outbound(
    group: Group,
    user_id: int | None,
    assign: bool = True,
    assignment_source: AssignmentSource | None = None,
) -> None:
    from sentry.models.grouplink import GroupLink

    external_issue_ids = GroupLink.objects.filter(
        project_id=group.project_id, group_id=group.id, linked_type=GroupLink.LinkedType.issue
    ).values_list(""linked_id"", flat=True)

    for external_issue_id in external_issue_ids:
        sync_assignee_outbound.apply_async(
            kwargs={
                ""external_issue_id"": external_issue_id,
                ""user_id"": user_id,
                ""assign"": assign,
                ""assignment_source_dict"": assignment_source.to_dict()
                if assignment_source
                else None,
            }
    
---
[High] class GroupAssigneeManager in src/sentry/models/groupassignee.py:
class GroupAssigneeManager(BaseManager[""GroupAssignee""]):
    def get_assigned_to_data(
        self, assigned_to: Team | RpcUser, assignee_type: str, extra: dict[str, str] | None = None
    ) -> dict[str, Any]:
        data = {
            ""assignee"": str(assigned_to.id),
            ""assigneeEmail"": getattr(assigned_to, ""email"", None),
            ""assigneeType"": assignee_type,
        }
        if extra:
            data.update(extra)

        return data

    def get_assignee_data(self, assigned_to: Team | RpcUser) -> tuple[str, str, str]:
        from sentry.models.team import Team
        from sentry.users.models.user import User
        from sentry.users.services.user import RpcUser

        if isinstance(assigned_to, (User, RpcUser)):
            assignee_type = ""user""
            
---
[High] function assign in src/sentry/models/groupassignee.py:
def assign(
        self,
        group: Group,
        assigned_to: Team | RpcUser,
        acting_user: User | None = None,
        create_only: bool = False,
        extra: dict[str, str] | None = None,
        force_autoassign: bool = False,
        assignment_source: AssignmentSource | None = None,
    ):
        from sentry.integrations.utils import sync_group_assignee_outbound
        from sentry.models.activity import Activity
        from sentry.models.groupsubscription import GroupSubscription

        GroupSubscription.objects.subscribe_actor(
            group=group, actor=assigned_to, reason=GroupSubscriptionReason.assigned
        )

        assigned_to_id = assigned_to.id
        assignee_type, assignee_type_attr, other_type = self.get_assignee_data(assigned_to)

        now
---
[High] function should_sync in src/sentry/integrations/mixins/issues.py:
def should_sync(self, attribute, sync_source: AssignmentSource | None = None):
        return False
---
[High] function sync_status_outbound in src/sentry/integrations/mixins/issues.py:
@abstractmethod
    def sync_status_outbound(
        self,
        external_issue,
        is_resolved,
        project_id,
        assignment_source: AssignmentSource | None = None,
        **kwargs,
    ):
        """"""
        Propagate a sentry issue's status to a linked issue's status.
        """"""
        raise NotImplementedError","[Medium] function test_assignee_sync_outbound_unassign in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_unassign(self, mock_sync_assignee_outbound):
        group = self.group

        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_status_outbound"": True,
                    ""sy
---
[Medium] function test_assignee_sync_outbound_assign in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_assign(self, mock_sync_assignee_outbound):
        group = self.group
        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_status_outbound"": True,
                    ""sync_
---
[Medium] function should_sync in src/sentry/integrations/mixins/issues.py:
def should_sync(self, attribute: str, sync_source: AssignmentSource | None = None) -> bool:
        key = getattr(self, f""{attribute}_key"", None)
        if key is None or self.org_integration is None:
            return False

        # Check that the assignment source isn't this same integration in order to
        # prevent sync-cycles from occurring. This should still allow other
        # integrations to propagate changes outward.
        if sync_source and sync_source.integration_id == sel
---
[Medium] class GroupAssigneeTestCase in tests/sentry/models/test_groupassignee.py:
class GroupAssigneeTestCase(TestCase):
    def test_constraints(self):
        # Can't both be assigned
        with pytest.raises(AssertionError):
            GroupAssignee.objects.create(
                group=self.group, project=self.group.project, user_id=self.user.id, team=self.team
            )

        # Can't have nobody assigned
        with pytest.raises(AssertionError):
            GroupAssignee.objects.create(
                group=self.group, project=self.group.project, user_id=Non
---
[Medium] function test_from_dict_empty_array in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_empty_array(self):
        data: dict[str, Any] = {}
        result = AssignmentSource.from_dict(data)
        assert result is None
---
[Medium] function test_from_dict_inalid_data in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_inalid_data(self):
        data = {
            ""foo"": ""bar"",
        }

        result = AssignmentSource.from_dict(data)
        assert result is None
---
[Medium] function test_from_dict_valid_data in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_valid_data(self):
        data = {""source_name"": ""foo-source"", ""integration_id"": 123}

        result = AssignmentSource.from_dict(data)
        assert result is not None
        assert result.source_name == ""foo-source""
        assert result.integration_id == 123
---
[Medium] function test_to_dict in tests/sentry/integrations/services/test_assignment_source.py:
def test_to_dict(self):
        source = AssignmentSource(
            source_name=""foo-source"",
            integration_id=123,
        )

        result = source.to_dict()
        assert result.get(""queued"") is not None
        assert result.get(""source_name"") == ""foo-source""
        assert result.get(""integration_id"") == 123
---
[Medium] function test_assignee_sync_outbound_assign_with_matching_source_integration in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_assign_with_matching_source_integration(
        self, mock_sync_assignee_outbound
    ):
        group = self.group
        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_sta
---
[Medium] function sync_assignee_outbound in src/sentry/integrations/tasks/sync_assignee_outbound.py:
@instrumented_task(
    name=""sentry.integrations.tasks.sync_assignee_outbound"",
    queue=""integrations"",
    default_retry_delay=60 * 5,
    max_retries=5,
    silo_mode=SiloMode.REGION,
)
@retry(
    exclude=(
        ExternalIssue.DoesNotExist,
        Integration.DoesNotExist,
        User.DoesNotExist,
        Organization.DoesNotExist,
    )
)
def sync_assignee_outbound(
    external_issue_id: int,
    user_id: int | None,
    assign: bool,
    assignment_source_dict: dict[str, Any] | Non","AssignmentSource (Critical), IssueSyncIntegration (Critical), deassign (Critical), sync_group_assignee_inbound (Critical), IssueBasicIntegration (High), sync_group_assignee_outbound (High), GroupAssigneeManager (High), assign (High), should_sync (High), sync_status_outbound (High), test_assignee_sync_outbound_unassign (Medium), test_assignee_sync_outbound_assign (Medium), should_sync (Medium), GroupAssigneeTestCase (Medium), test_from_dict_empty_array (Medium), test_from_dict_inalid_data (Medium), test_from_dict_valid_data (Medium), test_to_dict (Medium), test_assignee_sync_outbound_assign_with_matching_source_integration (Medium), sync_assignee_outbound (Medium), TestAssignmentSource (Low)",partial,test is in HC area but name mismatch is style
sentry,7,feat(ecosystem): Implement cross-system issue synchronization,"to_dict() returns a datetime for queued; if this dict is passed in task kwargs (e.g., via apply_async), JSON serialization may fail depending on the serializer, which can cause enqueue errors.",Medium,21,10,10,"function::AssignmentSource (src/sentry/integrations/services/assignment_source.py) [Critical, score=0.89] | class::IssueSyncIntegration (src/sentry/integrations/mixins/issues.py) [Critical, score=0.83] | function::deassign (src/sentry/models/groupassignee.py) [Critical, score=0.78] | function::sync_group_assignee_inbound (src/sentry/integrations/utils/sync.py) [Critical, score=0.75] | class::IssueBasicIntegration (src/sentry/integrations/mixins/issues.py) [High, score=0.66] | function::sync_group_assignee_outbound (src/sentry/integrations/utils/sync.py) [High, score=0.64] | class::GroupAssigneeManager (src/sentry/models/groupassignee.py) [High, score=0.61] | function::assign (src/sentry/models/groupassignee.py) [High, score=0.61] | function::should_sync (src/sentry/integrations/mixins/issues.py) [High, score=0.60] | function::sync_status_outbound (src/sentry/integrations/mixins/issues.py) [High, score=0.56]","[Critical] function AssignmentSource in src/sentry/integrations/services/assignment_source.py:
@dataclass(frozen=True)
class AssignmentSource:
    source_name: str
    integration_id: int
    queued: datetime = timezone.now()

    @classmethod
    def from_integration(cls, integration: Integration | RpcIntegration) -> AssignmentSource:
        return AssignmentSource(
            source_name=integration.name,
            integration_id=integration.id,
        )

    def to_dict(self) -> dict[str, Any]:
        return asdict(self)

    @classmethod
    def from_dict(cls, input_dict: dict[str, Any]) -> AssignmentSource | None:
        try:
            return cls(**input_dict)
        except (ValueError, TypeError):
            return None
---
[Critical] class IssueSyncIntegration in src/sentry/integrations/mixins/issues.py:
class IssueSyncIntegration(IssueBasicIntegration, ABC):
    comment_key: ClassVar[str | None] = None
    outbound_status_key: ClassVar[str | None] = None
    inbound_status_key: ClassVar[str | None] = None
    outbound_assignee_key: ClassVar[str | None] = None
    inbound_assignee_key: ClassVar[str | None] = None

    def should_sync(self, attribute: str, sync_source: AssignmentSource | None = None) -> bool:
        key = getattr(self, f""{attribute}_key"", None)
        if key is None or self.org_integration is None:
            return False

        # Check that the assignment source isn't this same integration in order to
        # prevent sync-cycles from occurring. This should still allow other
        # integrations to propagate changes outward.
        if sync_source and sync_source.i
---
[Critical] function deassign in src/sentry/models/groupassignee.py:
def deassign(
        self,
        group: Group,
        acting_user: User | RpcUser | None = None,
        assigned_to: Team | RpcUser | None = None,
        extra: dict[str, str] | None = None,
        assignment_source: AssignmentSource | None = None,
    ) -> None:
        from sentry.integrations.utils import sync_group_assignee_outbound
        from sentry.models.activity import Activity
        from sentry.models.projectownership import ProjectOwnership

        try:
            previous_groupassignee = self.get(group=group)
        except GroupAssignee.DoesNotExist:
            previous_groupassignee = None

        affected = self.filter(group=group)[:1].count()
        self.filter(group=group).delete()

        if affected > 0:
            Activity.objects.create_group_activity(
---
[Critical] function sync_group_assignee_inbound in src/sentry/integrations/utils/sync.py:
@region_silo_function
def sync_group_assignee_inbound(
    integration: RpcIntegration,
    email: str | None,
    external_issue_key: str,
    assign: bool = True,
) -> Sequence[Group]:
    """"""
    Given an integration, user email address and an external issue key,
    assign linked groups to matching users. Checks project membership.
    Returns a list of groups that were successfully assigned.
    """"""

    logger = logging.getLogger(f""sentry.integrations.{integration.provider}"")

    orgs_with_sync_enabled = where_should_sync(integration, ""inbound_assignee"")
    affected_groups = Group.objects.get_groups_by_external_issue(
        integration,
        orgs_with_sync_enabled,
        external_issue_key,
    )
    log_context = {
        ""integration_id"": integration.id,
        ""email"": 
---
[High] class IssueBasicIntegration in src/sentry/integrations/mixins/issues.py:
class IssueBasicIntegration(IntegrationInstallation, ABC):
    def should_sync(self, attribute, sync_source: AssignmentSource | None = None):
        return False

    def get_group_title(self, group, event, **kwargs):
        return get_notification_group_title(group, event, **kwargs)

    @abstractmethod
    def get_issue_url(self, key: str) -> str:
        """"""
        Given the key of the external_issue return the external issue link.
        """"""
        raise NotImplementedError

    def get_group_body(self, group, event, **kwargs):
        result = []
        for interface in event.interfaces.values():
            output = safe_execute(interface.to_string, event)
            if output:
                result.append(output)
        return ""\n\n"".join(result)

    def get_feedback_issue
---
[High] function sync_group_assignee_outbound in src/sentry/integrations/utils/sync.py:
def sync_group_assignee_outbound(
    group: Group,
    user_id: int | None,
    assign: bool = True,
    assignment_source: AssignmentSource | None = None,
) -> None:
    from sentry.models.grouplink import GroupLink

    external_issue_ids = GroupLink.objects.filter(
        project_id=group.project_id, group_id=group.id, linked_type=GroupLink.LinkedType.issue
    ).values_list(""linked_id"", flat=True)

    for external_issue_id in external_issue_ids:
        sync_assignee_outbound.apply_async(
            kwargs={
                ""external_issue_id"": external_issue_id,
                ""user_id"": user_id,
                ""assign"": assign,
                ""assignment_source_dict"": assignment_source.to_dict()
                if assignment_source
                else None,
            }
    
---
[High] class GroupAssigneeManager in src/sentry/models/groupassignee.py:
class GroupAssigneeManager(BaseManager[""GroupAssignee""]):
    def get_assigned_to_data(
        self, assigned_to: Team | RpcUser, assignee_type: str, extra: dict[str, str] | None = None
    ) -> dict[str, Any]:
        data = {
            ""assignee"": str(assigned_to.id),
            ""assigneeEmail"": getattr(assigned_to, ""email"", None),
            ""assigneeType"": assignee_type,
        }
        if extra:
            data.update(extra)

        return data

    def get_assignee_data(self, assigned_to: Team | RpcUser) -> tuple[str, str, str]:
        from sentry.models.team import Team
        from sentry.users.models.user import User
        from sentry.users.services.user import RpcUser

        if isinstance(assigned_to, (User, RpcUser)):
            assignee_type = ""user""
            
---
[High] function assign in src/sentry/models/groupassignee.py:
def assign(
        self,
        group: Group,
        assigned_to: Team | RpcUser,
        acting_user: User | None = None,
        create_only: bool = False,
        extra: dict[str, str] | None = None,
        force_autoassign: bool = False,
        assignment_source: AssignmentSource | None = None,
    ):
        from sentry.integrations.utils import sync_group_assignee_outbound
        from sentry.models.activity import Activity
        from sentry.models.groupsubscription import GroupSubscription

        GroupSubscription.objects.subscribe_actor(
            group=group, actor=assigned_to, reason=GroupSubscriptionReason.assigned
        )

        assigned_to_id = assigned_to.id
        assignee_type, assignee_type_attr, other_type = self.get_assignee_data(assigned_to)

        now
---
[High] function should_sync in src/sentry/integrations/mixins/issues.py:
def should_sync(self, attribute, sync_source: AssignmentSource | None = None):
        return False
---
[High] function sync_status_outbound in src/sentry/integrations/mixins/issues.py:
@abstractmethod
    def sync_status_outbound(
        self,
        external_issue,
        is_resolved,
        project_id,
        assignment_source: AssignmentSource | None = None,
        **kwargs,
    ):
        """"""
        Propagate a sentry issue's status to a linked issue's status.
        """"""
        raise NotImplementedError","[Medium] function test_assignee_sync_outbound_unassign in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_unassign(self, mock_sync_assignee_outbound):
        group = self.group

        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_status_outbound"": True,
                    ""sy
---
[Medium] function test_assignee_sync_outbound_assign in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_assign(self, mock_sync_assignee_outbound):
        group = self.group
        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_status_outbound"": True,
                    ""sync_
---
[Medium] function should_sync in src/sentry/integrations/mixins/issues.py:
def should_sync(self, attribute: str, sync_source: AssignmentSource | None = None) -> bool:
        key = getattr(self, f""{attribute}_key"", None)
        if key is None or self.org_integration is None:
            return False

        # Check that the assignment source isn't this same integration in order to
        # prevent sync-cycles from occurring. This should still allow other
        # integrations to propagate changes outward.
        if sync_source and sync_source.integration_id == sel
---
[Medium] class GroupAssigneeTestCase in tests/sentry/models/test_groupassignee.py:
class GroupAssigneeTestCase(TestCase):
    def test_constraints(self):
        # Can't both be assigned
        with pytest.raises(AssertionError):
            GroupAssignee.objects.create(
                group=self.group, project=self.group.project, user_id=self.user.id, team=self.team
            )

        # Can't have nobody assigned
        with pytest.raises(AssertionError):
            GroupAssignee.objects.create(
                group=self.group, project=self.group.project, user_id=Non
---
[Medium] function test_from_dict_empty_array in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_empty_array(self):
        data: dict[str, Any] = {}
        result = AssignmentSource.from_dict(data)
        assert result is None
---
[Medium] function test_from_dict_inalid_data in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_inalid_data(self):
        data = {
            ""foo"": ""bar"",
        }

        result = AssignmentSource.from_dict(data)
        assert result is None
---
[Medium] function test_from_dict_valid_data in tests/sentry/integrations/services/test_assignment_source.py:
def test_from_dict_valid_data(self):
        data = {""source_name"": ""foo-source"", ""integration_id"": 123}

        result = AssignmentSource.from_dict(data)
        assert result is not None
        assert result.source_name == ""foo-source""
        assert result.integration_id == 123
---
[Medium] function test_to_dict in tests/sentry/integrations/services/test_assignment_source.py:
def test_to_dict(self):
        source = AssignmentSource(
            source_name=""foo-source"",
            integration_id=123,
        )

        result = source.to_dict()
        assert result.get(""queued"") is not None
        assert result.get(""source_name"") == ""foo-source""
        assert result.get(""integration_id"") == 123
---
[Medium] function test_assignee_sync_outbound_assign_with_matching_source_integration in tests/sentry/models/test_groupassignee.py:
@mock.patch.object(ExampleIntegration, ""sync_assignee_outbound"")
    def test_assignee_sync_outbound_assign_with_matching_source_integration(
        self, mock_sync_assignee_outbound
    ):
        group = self.group
        integration = self.create_integration(
            organization=group.organization,
            external_id=""123456"",
            provider=""example"",
            oi_params={
                ""config"": {
                    ""sync_comments"": True,
                    ""sync_sta
---
[Medium] function sync_assignee_outbound in src/sentry/integrations/tasks/sync_assignee_outbound.py:
@instrumented_task(
    name=""sentry.integrations.tasks.sync_assignee_outbound"",
    queue=""integrations"",
    default_retry_delay=60 * 5,
    max_retries=5,
    silo_mode=SiloMode.REGION,
)
@retry(
    exclude=(
        ExternalIssue.DoesNotExist,
        Integration.DoesNotExist,
        User.DoesNotExist,
        Organization.DoesNotExist,
    )
)
def sync_assignee_outbound(
    external_issue_id: int,
    user_id: int | None,
    assign: bool,
    assignment_source_dict: dict[str, Any] | Non","AssignmentSource (Critical), IssueSyncIntegration (Critical), deassign (Critical), sync_group_assignee_inbound (Critical), IssueBasicIntegration (High), sync_group_assignee_outbound (High), GroupAssigneeManager (High), assign (High), should_sync (High), sync_status_outbound (High), test_assignee_sync_outbound_unassign (Medium), test_assignee_sync_outbound_assign (Medium), should_sync (Medium), GroupAssigneeTestCase (Medium), test_from_dict_empty_array (Medium), test_from_dict_inalid_data (Medium), test_from_dict_valid_data (Medium), test_to_dict (Medium), test_assignee_sync_outbound_assign_with_matching_source_integration (Medium), sync_assignee_outbound (Medium), TestAssignmentSource (Low)",match,'dict' matches entity 'test_from_dict_valid_data'
sentry,6,Span Buffer Multiprocess Enhancement with Health Monitoring,Inconsistent metric tagging with 'shard' and 'shards',Medium,20,2,15,"class::SpanFlusher (src/sentry/spans/consumers/process/flusher.py) [High, score=0.63] | function::main (src/sentry/spans/consumers/process/flusher.py) [High, score=0.51]","[High] class SpanFlusher in src/sentry/spans/consumers/process/flusher.py:
class SpanFlusher(ProcessingStrategy[FilteredPayload | int]):
    """"""
    A background multiprocessing manager that polls Redis for new segments to flush and to produce to Kafka.
    Creates one process per shard for parallel processing.

    This is a processing step to be embedded into the consumer that writes to
    Redis. It takes and fowards integer messages that represent recently
    processed timestamps (from the producer timestamp of the incoming span
    message), which are then used as a clock to determine whether segments have expired.

    :param topic: The topic to send segments to.
    :param produce_to_pipe: For unit-testing, produce to this multiprocessing Pipe instead of creating a kafka consumer.
    """"""

    def __init__(
        self,
        buffer: SpansBuffer,
     
---
[High] function main in src/sentry/spans/consumers/process/flusher.py:
@staticmethod
    def main(
        buffer: SpansBuffer,
        shards: list[int],
        stopped,
        current_drift,
        backpressure_since,
        healthy_since,
        produce_to_pipe: Callable[[KafkaPayload], None] | None,
    ) -> None:
        shard_tag = "","".join(map(str, shards))
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""flusher"")
        sentry_sdk.set_tag(""sentry_spans_buffer_shards"", shard_tag)

        try:
            producer_futures = []

            if produce_to_pipe is not None:
                produce = produce_to_pipe
                producer = None
            else:
                cluster_name = get_topic_definition(Topic.BUFFERED_SEGMENTS)[""cluster""]

                producer_config = get_kafka_producer_cluster_options(cluster_name)
   ","[Medium] function _create_process_for_shards in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shards(self, process_index: int, shards: list[int]):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.process_healthy_since[process_index].value = int(time.time())

        # Create a buffer for these specific shards
        shard_buffer = SpansBuffer(shards)

        make_process: Callable[..., multiprocessing.context.SpawnPr
---
[Medium] function join in src/sentry/spans/consumers/process/flusher.py:
def join(self, timeout: float | None = None):
        # set stopped flag first so we can ""flush"" the background threads while
        # next_step is also shutting down. we can do two things at once!
        self.stopped.value = True
        deadline = time.time() + timeout if timeout else None

        self.next_step.join(timeout)

        # Wait for all processes to finish
        for process_index, process in self.processes.items():
            if deadline is not None:
                remainin
---
[Medium] class ProcessSpansStrategyFactory in src/sentry/spans/consumers/process/factory.py:
class ProcessSpansStrategyFactory(ProcessingStrategyFactory[KafkaPayload]):
    """"""
    1. Process spans and push them to redis
    2. Commit offsets for processed spans
    3. Reduce the messages to find the latest timestamp to process
    4. Fetch all segments are two minutes or older and expire the keys so they
       aren't reprocessed
    5. Produce segments to buffered-segments topic
    """"""

    def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        
---
[Medium] function _create_processes in src/sentry/spans/consumers/process/flusher.py:
def _create_processes(self):
        # Create processes based on shard mapping
        for process_index, shards in self.process_to_shards_map.items():
            self._create_process_for_shards(process_index, shards)
---
[Medium] function _ensure_processes_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_processes_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")

        for process_index, process in self.processes.items():
            if not process:
                continue

            shards = self.process_to_shards_map[process_index]

            cause = None
            if not process.is_alive():
                exitcode = getattr(process, ""exitcode"", ""unknown"")
                cause = f""no_process_{exitcode}""
      
---
[Medium] function submit in src/sentry/spans/consumers/process/flusher.py:
def submit(self, message: Message[FilteredPayload | int]) -> None:
        # Note that submit is not actually a hot path. Their message payloads
        # are mapped from *batches* of spans, and there are a handful of spans
        # per second at most. If anything, self.poll() might even be called
        # more often than submit()

        self._ensure_processes_alive()

        for buffer in self.buffers.values():
            buffer.record_stored_segments()

        # We pause insertion into 
---
[Medium] function __init__ in src/sentry/spans/consumers/process/factory.py:
def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        num_processes: int,
        input_block_size: int | None,
        output_block_size: int | None,
        flusher_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        super().__init__()

        # config
        self.max_batch_size = max_batch_size
        self.max_batch_time = max_batch_time
        self.input_block_size = input_block_size
 
---
[Medium] function create_with_partitions in src/sentry/spans/consumers/process/factory.py:
def create_with_partitions(
        self,
        commit: Commit,
        partitions: Mapping[Partition, int],
    ) -> ProcessingStrategy[KafkaPayload]:
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""consumer"")

        committer = CommitOffsets(commit)

        buffer = SpansBuffer(assigned_shards=[p.index for p in partitions])

        # patch onto self just for testing
        flusher: ProcessingStrategy[FilteredPayload | int]
        flusher = self._flusher = SpanFlusher(
    
---
[Medium] function _create_process_for_shard in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shard(self, shard: int):
        # Find which process this shard belongs to and restart that process
        for process_index, shards in self.process_to_shards_map.items():
            if shard in shards:
                self._create_process_for_shards(process_index, shards)
                break
---
[Medium] function _create_process in src/sentry/spans/consumers/process/flusher.py:
def _create_process(self):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.healthy_since.value = int(time.time())

        make_process: Callable[..., multiprocessing.context.SpawnProcess | threading.Thread]
        if self.produce_to_pipe is None:
            target = run_with_initialized_sentry(
                SpanFlusher.main,
                # 
---
[Medium] function _ensure_process_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_process_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")
        if not self.process.is_alive():
            exitcode = getattr(self.process, ""exitcode"", ""unknown"")
            cause = f""no_process_{exitcode}""
        elif int(time.time()) - self.healthy_since.value > max_unhealthy_seconds:
            cause = ""hang""
        else:
            return  # healthy

        metrics.incr(""spans.buffer.flusher_unhealthy"", tags={""
---
[Medium] heading RIGHT: Use prefetch_related in CLAUDE.md:
# RIGHT: Use prefetch_related
organizations.prefetch_related('projects')
---
[Medium] function __init__ in src/sentry/spans/consumers/process/flusher.py:
def __init__(
        self,
        buffer: SpansBuffer,
        next_step: ProcessingStrategy[FilteredPayload | int],
        max_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        self.next_step = next_step
        self.max_processes = max_processes or len(buffer.assigned_shards)

        self.mp_context = mp_context = multiprocessing.get_context(""spawn"")
        self.stopped = mp_context.Value(""i"", 0)
        self.redis_was_full
---
[Medium] function test_basic in tests/sentry/spans/consumers/process/test_consumer.py:
@pytest.mark.django_db(transaction=True)
def test_basic(monkeypatch):
    # Flush very aggressively to make test pass instantly
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    topic = Topic(""test"")
    messages: list[KafkaPayload] = []

    fac = ProcessSpansStrategyFactory(
        max_batch_size=10,
        max_batch_time=10,
        num_processes=1,
        input_block_size=None,
        output_block_size=None,
        produce_to_pipe=messages.append,
    )

    commits = []

    d
---
[Medium] function test_backpressure in tests/sentry/spans/consumers/process/test_flusher.py:
@override_options({**DEFAULT_OPTIONS, ""spans.buffer.max-flush-segments"": 1})
def test_backpressure(monkeypatch):
    # Flush very aggressively to make join() faster
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    messages = []

    def append(msg):
        messages.append(msg)
        sleep(1.0)

    buffer = SpansBuffer(assigned_shards=list(range(1)))
    flusher = SpanFlusher(
        buffer,
        next_step=Noop(),
        produce_to_pipe=append,
    )

    now = time.time()

   ","SpanFlusher (High), main (High), _create_process_for_shards (Medium), join (Medium), ProcessSpansStrategyFactory (Medium), _create_processes (Medium), _ensure_processes_alive (Medium), submit (Medium), __init__ (Medium), create_with_partitions (Medium), _create_process_for_shard (Medium), _create_process (Medium), _ensure_process_alive (Medium), RIGHT: Use prefetch_related (Medium), __init__ (Medium), test_basic (Medium), test_backpressure (Medium), WRONG: Use hasattr() for unions (Low), RIGHT: Use isinstance() (Low), test_flusher_processes_limit (Low)",match,'shards' matches entity '_create_process_for_shards'
sentry,6,Span Buffer Multiprocess Enhancement with Health Monitoring,Fixed sleep in tests can be flaky; wait on condition instead,Low,20,2,15,"class::SpanFlusher (src/sentry/spans/consumers/process/flusher.py) [High, score=0.63] | function::main (src/sentry/spans/consumers/process/flusher.py) [High, score=0.51]","[High] class SpanFlusher in src/sentry/spans/consumers/process/flusher.py:
class SpanFlusher(ProcessingStrategy[FilteredPayload | int]):
    """"""
    A background multiprocessing manager that polls Redis for new segments to flush and to produce to Kafka.
    Creates one process per shard for parallel processing.

    This is a processing step to be embedded into the consumer that writes to
    Redis. It takes and fowards integer messages that represent recently
    processed timestamps (from the producer timestamp of the incoming span
    message), which are then used as a clock to determine whether segments have expired.

    :param topic: The topic to send segments to.
    :param produce_to_pipe: For unit-testing, produce to this multiprocessing Pipe instead of creating a kafka consumer.
    """"""

    def __init__(
        self,
        buffer: SpansBuffer,
     
---
[High] function main in src/sentry/spans/consumers/process/flusher.py:
@staticmethod
    def main(
        buffer: SpansBuffer,
        shards: list[int],
        stopped,
        current_drift,
        backpressure_since,
        healthy_since,
        produce_to_pipe: Callable[[KafkaPayload], None] | None,
    ) -> None:
        shard_tag = "","".join(map(str, shards))
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""flusher"")
        sentry_sdk.set_tag(""sentry_spans_buffer_shards"", shard_tag)

        try:
            producer_futures = []

            if produce_to_pipe is not None:
                produce = produce_to_pipe
                producer = None
            else:
                cluster_name = get_topic_definition(Topic.BUFFERED_SEGMENTS)[""cluster""]

                producer_config = get_kafka_producer_cluster_options(cluster_name)
   ","[Medium] function _create_process_for_shards in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shards(self, process_index: int, shards: list[int]):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.process_healthy_since[process_index].value = int(time.time())

        # Create a buffer for these specific shards
        shard_buffer = SpansBuffer(shards)

        make_process: Callable[..., multiprocessing.context.SpawnPr
---
[Medium] function join in src/sentry/spans/consumers/process/flusher.py:
def join(self, timeout: float | None = None):
        # set stopped flag first so we can ""flush"" the background threads while
        # next_step is also shutting down. we can do two things at once!
        self.stopped.value = True
        deadline = time.time() + timeout if timeout else None

        self.next_step.join(timeout)

        # Wait for all processes to finish
        for process_index, process in self.processes.items():
            if deadline is not None:
                remainin
---
[Medium] class ProcessSpansStrategyFactory in src/sentry/spans/consumers/process/factory.py:
class ProcessSpansStrategyFactory(ProcessingStrategyFactory[KafkaPayload]):
    """"""
    1. Process spans and push them to redis
    2. Commit offsets for processed spans
    3. Reduce the messages to find the latest timestamp to process
    4. Fetch all segments are two minutes or older and expire the keys so they
       aren't reprocessed
    5. Produce segments to buffered-segments topic
    """"""

    def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        
---
[Medium] function _create_processes in src/sentry/spans/consumers/process/flusher.py:
def _create_processes(self):
        # Create processes based on shard mapping
        for process_index, shards in self.process_to_shards_map.items():
            self._create_process_for_shards(process_index, shards)
---
[Medium] function _ensure_processes_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_processes_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")

        for process_index, process in self.processes.items():
            if not process:
                continue

            shards = self.process_to_shards_map[process_index]

            cause = None
            if not process.is_alive():
                exitcode = getattr(process, ""exitcode"", ""unknown"")
                cause = f""no_process_{exitcode}""
      
---
[Medium] function submit in src/sentry/spans/consumers/process/flusher.py:
def submit(self, message: Message[FilteredPayload | int]) -> None:
        # Note that submit is not actually a hot path. Their message payloads
        # are mapped from *batches* of spans, and there are a handful of spans
        # per second at most. If anything, self.poll() might even be called
        # more often than submit()

        self._ensure_processes_alive()

        for buffer in self.buffers.values():
            buffer.record_stored_segments()

        # We pause insertion into 
---
[Medium] function __init__ in src/sentry/spans/consumers/process/factory.py:
def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        num_processes: int,
        input_block_size: int | None,
        output_block_size: int | None,
        flusher_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        super().__init__()

        # config
        self.max_batch_size = max_batch_size
        self.max_batch_time = max_batch_time
        self.input_block_size = input_block_size
 
---
[Medium] function create_with_partitions in src/sentry/spans/consumers/process/factory.py:
def create_with_partitions(
        self,
        commit: Commit,
        partitions: Mapping[Partition, int],
    ) -> ProcessingStrategy[KafkaPayload]:
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""consumer"")

        committer = CommitOffsets(commit)

        buffer = SpansBuffer(assigned_shards=[p.index for p in partitions])

        # patch onto self just for testing
        flusher: ProcessingStrategy[FilteredPayload | int]
        flusher = self._flusher = SpanFlusher(
    
---
[Medium] function _create_process_for_shard in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shard(self, shard: int):
        # Find which process this shard belongs to and restart that process
        for process_index, shards in self.process_to_shards_map.items():
            if shard in shards:
                self._create_process_for_shards(process_index, shards)
                break
---
[Medium] function _create_process in src/sentry/spans/consumers/process/flusher.py:
def _create_process(self):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.healthy_since.value = int(time.time())

        make_process: Callable[..., multiprocessing.context.SpawnProcess | threading.Thread]
        if self.produce_to_pipe is None:
            target = run_with_initialized_sentry(
                SpanFlusher.main,
                # 
---
[Medium] function _ensure_process_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_process_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")
        if not self.process.is_alive():
            exitcode = getattr(self.process, ""exitcode"", ""unknown"")
            cause = f""no_process_{exitcode}""
        elif int(time.time()) - self.healthy_since.value > max_unhealthy_seconds:
            cause = ""hang""
        else:
            return  # healthy

        metrics.incr(""spans.buffer.flusher_unhealthy"", tags={""
---
[Medium] heading RIGHT: Use prefetch_related in CLAUDE.md:
# RIGHT: Use prefetch_related
organizations.prefetch_related('projects')
---
[Medium] function __init__ in src/sentry/spans/consumers/process/flusher.py:
def __init__(
        self,
        buffer: SpansBuffer,
        next_step: ProcessingStrategy[FilteredPayload | int],
        max_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        self.next_step = next_step
        self.max_processes = max_processes or len(buffer.assigned_shards)

        self.mp_context = mp_context = multiprocessing.get_context(""spawn"")
        self.stopped = mp_context.Value(""i"", 0)
        self.redis_was_full
---
[Medium] function test_basic in tests/sentry/spans/consumers/process/test_consumer.py:
@pytest.mark.django_db(transaction=True)
def test_basic(monkeypatch):
    # Flush very aggressively to make test pass instantly
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    topic = Topic(""test"")
    messages: list[KafkaPayload] = []

    fac = ProcessSpansStrategyFactory(
        max_batch_size=10,
        max_batch_time=10,
        num_processes=1,
        input_block_size=None,
        output_block_size=None,
        produce_to_pipe=messages.append,
    )

    commits = []

    d
---
[Medium] function test_backpressure in tests/sentry/spans/consumers/process/test_flusher.py:
@override_options({**DEFAULT_OPTIONS, ""spans.buffer.max-flush-segments"": 1})
def test_backpressure(monkeypatch):
    # Flush very aggressively to make join() faster
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    messages = []

    def append(msg):
        messages.append(msg)
        sleep(1.0)

    buffer = SpansBuffer(assigned_shards=list(range(1)))
    flusher = SpanFlusher(
        buffer,
        next_step=Noop(),
        produce_to_pipe=append,
    )

    now = time.time()

   ","SpanFlusher (High), main (High), _create_process_for_shards (Medium), join (Medium), ProcessSpansStrategyFactory (Medium), _create_processes (Medium), _ensure_processes_alive (Medium), submit (Medium), __init__ (Medium), create_with_partitions (Medium), _create_process_for_shard (Medium), _create_process (Medium), _ensure_process_alive (Medium), RIGHT: Use prefetch_related (Medium), __init__ (Medium), test_basic (Medium), test_backpressure (Medium), WRONG: Use hasattr() for unions (Low), RIGHT: Use isinstance() (Low), test_flusher_processes_limit (Low)",miss,"test flakiness issue, SpanFlusher is HC but test timing not captured"
sentry,6,Span Buffer Multiprocess Enhancement with Health Monitoring,"Because flusher processes are created via multiprocessing.get_context('spawn').Process, they are instances of multiprocessing.context.SpawnProcess, which on POSIX is not a subclass of multiprocessing.Process, so this isinstance check will always be false and hung processes won't be killed here.",High,20,2,15,"class::SpanFlusher (src/sentry/spans/consumers/process/flusher.py) [High, score=0.63] | function::main (src/sentry/spans/consumers/process/flusher.py) [High, score=0.51]","[High] class SpanFlusher in src/sentry/spans/consumers/process/flusher.py:
class SpanFlusher(ProcessingStrategy[FilteredPayload | int]):
    """"""
    A background multiprocessing manager that polls Redis for new segments to flush and to produce to Kafka.
    Creates one process per shard for parallel processing.

    This is a processing step to be embedded into the consumer that writes to
    Redis. It takes and fowards integer messages that represent recently
    processed timestamps (from the producer timestamp of the incoming span
    message), which are then used as a clock to determine whether segments have expired.

    :param topic: The topic to send segments to.
    :param produce_to_pipe: For unit-testing, produce to this multiprocessing Pipe instead of creating a kafka consumer.
    """"""

    def __init__(
        self,
        buffer: SpansBuffer,
     
---
[High] function main in src/sentry/spans/consumers/process/flusher.py:
@staticmethod
    def main(
        buffer: SpansBuffer,
        shards: list[int],
        stopped,
        current_drift,
        backpressure_since,
        healthy_since,
        produce_to_pipe: Callable[[KafkaPayload], None] | None,
    ) -> None:
        shard_tag = "","".join(map(str, shards))
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""flusher"")
        sentry_sdk.set_tag(""sentry_spans_buffer_shards"", shard_tag)

        try:
            producer_futures = []

            if produce_to_pipe is not None:
                produce = produce_to_pipe
                producer = None
            else:
                cluster_name = get_topic_definition(Topic.BUFFERED_SEGMENTS)[""cluster""]

                producer_config = get_kafka_producer_cluster_options(cluster_name)
   ","[Medium] function _create_process_for_shards in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shards(self, process_index: int, shards: list[int]):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.process_healthy_since[process_index].value = int(time.time())

        # Create a buffer for these specific shards
        shard_buffer = SpansBuffer(shards)

        make_process: Callable[..., multiprocessing.context.SpawnPr
---
[Medium] function join in src/sentry/spans/consumers/process/flusher.py:
def join(self, timeout: float | None = None):
        # set stopped flag first so we can ""flush"" the background threads while
        # next_step is also shutting down. we can do two things at once!
        self.stopped.value = True
        deadline = time.time() + timeout if timeout else None

        self.next_step.join(timeout)

        # Wait for all processes to finish
        for process_index, process in self.processes.items():
            if deadline is not None:
                remainin
---
[Medium] class ProcessSpansStrategyFactory in src/sentry/spans/consumers/process/factory.py:
class ProcessSpansStrategyFactory(ProcessingStrategyFactory[KafkaPayload]):
    """"""
    1. Process spans and push them to redis
    2. Commit offsets for processed spans
    3. Reduce the messages to find the latest timestamp to process
    4. Fetch all segments are two minutes or older and expire the keys so they
       aren't reprocessed
    5. Produce segments to buffered-segments topic
    """"""

    def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        
---
[Medium] function _create_processes in src/sentry/spans/consumers/process/flusher.py:
def _create_processes(self):
        # Create processes based on shard mapping
        for process_index, shards in self.process_to_shards_map.items():
            self._create_process_for_shards(process_index, shards)
---
[Medium] function _ensure_processes_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_processes_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")

        for process_index, process in self.processes.items():
            if not process:
                continue

            shards = self.process_to_shards_map[process_index]

            cause = None
            if not process.is_alive():
                exitcode = getattr(process, ""exitcode"", ""unknown"")
                cause = f""no_process_{exitcode}""
      
---
[Medium] function submit in src/sentry/spans/consumers/process/flusher.py:
def submit(self, message: Message[FilteredPayload | int]) -> None:
        # Note that submit is not actually a hot path. Their message payloads
        # are mapped from *batches* of spans, and there are a handful of spans
        # per second at most. If anything, self.poll() might even be called
        # more often than submit()

        self._ensure_processes_alive()

        for buffer in self.buffers.values():
            buffer.record_stored_segments()

        # We pause insertion into 
---
[Medium] function __init__ in src/sentry/spans/consumers/process/factory.py:
def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        num_processes: int,
        input_block_size: int | None,
        output_block_size: int | None,
        flusher_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        super().__init__()

        # config
        self.max_batch_size = max_batch_size
        self.max_batch_time = max_batch_time
        self.input_block_size = input_block_size
 
---
[Medium] function create_with_partitions in src/sentry/spans/consumers/process/factory.py:
def create_with_partitions(
        self,
        commit: Commit,
        partitions: Mapping[Partition, int],
    ) -> ProcessingStrategy[KafkaPayload]:
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""consumer"")

        committer = CommitOffsets(commit)

        buffer = SpansBuffer(assigned_shards=[p.index for p in partitions])

        # patch onto self just for testing
        flusher: ProcessingStrategy[FilteredPayload | int]
        flusher = self._flusher = SpanFlusher(
    
---
[Medium] function _create_process_for_shard in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shard(self, shard: int):
        # Find which process this shard belongs to and restart that process
        for process_index, shards in self.process_to_shards_map.items():
            if shard in shards:
                self._create_process_for_shards(process_index, shards)
                break
---
[Medium] function _create_process in src/sentry/spans/consumers/process/flusher.py:
def _create_process(self):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.healthy_since.value = int(time.time())

        make_process: Callable[..., multiprocessing.context.SpawnProcess | threading.Thread]
        if self.produce_to_pipe is None:
            target = run_with_initialized_sentry(
                SpanFlusher.main,
                # 
---
[Medium] function _ensure_process_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_process_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")
        if not self.process.is_alive():
            exitcode = getattr(self.process, ""exitcode"", ""unknown"")
            cause = f""no_process_{exitcode}""
        elif int(time.time()) - self.healthy_since.value > max_unhealthy_seconds:
            cause = ""hang""
        else:
            return  # healthy

        metrics.incr(""spans.buffer.flusher_unhealthy"", tags={""
---
[Medium] heading RIGHT: Use prefetch_related in CLAUDE.md:
# RIGHT: Use prefetch_related
organizations.prefetch_related('projects')
---
[Medium] function __init__ in src/sentry/spans/consumers/process/flusher.py:
def __init__(
        self,
        buffer: SpansBuffer,
        next_step: ProcessingStrategy[FilteredPayload | int],
        max_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        self.next_step = next_step
        self.max_processes = max_processes or len(buffer.assigned_shards)

        self.mp_context = mp_context = multiprocessing.get_context(""spawn"")
        self.stopped = mp_context.Value(""i"", 0)
        self.redis_was_full
---
[Medium] function test_basic in tests/sentry/spans/consumers/process/test_consumer.py:
@pytest.mark.django_db(transaction=True)
def test_basic(monkeypatch):
    # Flush very aggressively to make test pass instantly
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    topic = Topic(""test"")
    messages: list[KafkaPayload] = []

    fac = ProcessSpansStrategyFactory(
        max_batch_size=10,
        max_batch_time=10,
        num_processes=1,
        input_block_size=None,
        output_block_size=None,
        produce_to_pipe=messages.append,
    )

    commits = []

    d
---
[Medium] function test_backpressure in tests/sentry/spans/consumers/process/test_flusher.py:
@override_options({**DEFAULT_OPTIONS, ""spans.buffer.max-flush-segments"": 1})
def test_backpressure(monkeypatch):
    # Flush very aggressively to make join() faster
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    messages = []

    def append(msg):
        messages.append(msg)
        sleep(1.0)

    buffer = SpansBuffer(assigned_shards=list(range(1)))
    flusher = SpanFlusher(
        buffer,
        next_step=Noop(),
        produce_to_pipe=append,
    )

    now = time.time()

   ","SpanFlusher (High), main (High), _create_process_for_shards (Medium), join (Medium), ProcessSpansStrategyFactory (Medium), _create_processes (Medium), _ensure_processes_alive (Medium), submit (Medium), __init__ (Medium), create_with_partitions (Medium), _create_process_for_shard (Medium), _create_process (Medium), _ensure_process_alive (Medium), RIGHT: Use prefetch_related (Medium), __init__ (Medium), test_basic (Medium), test_backpressure (Medium), WRONG: Use hasattr() for unions (Low), RIGHT: Use isinstance() (Low), test_flusher_processes_limit (Low)",match,'flusher' matches HC entity 'spanflusher'
sentry,6,Span Buffer Multiprocess Enhancement with Health Monitoring,Sleep in test_consumer.py wonâ€™t actually wait because time.sleep was monkeypatched above; consider restoring sleep or using a different sync to ensure the flusher has time to process.,Medium,20,2,15,"class::SpanFlusher (src/sentry/spans/consumers/process/flusher.py) [High, score=0.63] | function::main (src/sentry/spans/consumers/process/flusher.py) [High, score=0.51]","[High] class SpanFlusher in src/sentry/spans/consumers/process/flusher.py:
class SpanFlusher(ProcessingStrategy[FilteredPayload | int]):
    """"""
    A background multiprocessing manager that polls Redis for new segments to flush and to produce to Kafka.
    Creates one process per shard for parallel processing.

    This is a processing step to be embedded into the consumer that writes to
    Redis. It takes and fowards integer messages that represent recently
    processed timestamps (from the producer timestamp of the incoming span
    message), which are then used as a clock to determine whether segments have expired.

    :param topic: The topic to send segments to.
    :param produce_to_pipe: For unit-testing, produce to this multiprocessing Pipe instead of creating a kafka consumer.
    """"""

    def __init__(
        self,
        buffer: SpansBuffer,
     
---
[High] function main in src/sentry/spans/consumers/process/flusher.py:
@staticmethod
    def main(
        buffer: SpansBuffer,
        shards: list[int],
        stopped,
        current_drift,
        backpressure_since,
        healthy_since,
        produce_to_pipe: Callable[[KafkaPayload], None] | None,
    ) -> None:
        shard_tag = "","".join(map(str, shards))
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""flusher"")
        sentry_sdk.set_tag(""sentry_spans_buffer_shards"", shard_tag)

        try:
            producer_futures = []

            if produce_to_pipe is not None:
                produce = produce_to_pipe
                producer = None
            else:
                cluster_name = get_topic_definition(Topic.BUFFERED_SEGMENTS)[""cluster""]

                producer_config = get_kafka_producer_cluster_options(cluster_name)
   ","[Medium] function _create_process_for_shards in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shards(self, process_index: int, shards: list[int]):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.process_healthy_since[process_index].value = int(time.time())

        # Create a buffer for these specific shards
        shard_buffer = SpansBuffer(shards)

        make_process: Callable[..., multiprocessing.context.SpawnPr
---
[Medium] function join in src/sentry/spans/consumers/process/flusher.py:
def join(self, timeout: float | None = None):
        # set stopped flag first so we can ""flush"" the background threads while
        # next_step is also shutting down. we can do two things at once!
        self.stopped.value = True
        deadline = time.time() + timeout if timeout else None

        self.next_step.join(timeout)

        # Wait for all processes to finish
        for process_index, process in self.processes.items():
            if deadline is not None:
                remainin
---
[Medium] class ProcessSpansStrategyFactory in src/sentry/spans/consumers/process/factory.py:
class ProcessSpansStrategyFactory(ProcessingStrategyFactory[KafkaPayload]):
    """"""
    1. Process spans and push them to redis
    2. Commit offsets for processed spans
    3. Reduce the messages to find the latest timestamp to process
    4. Fetch all segments are two minutes or older and expire the keys so they
       aren't reprocessed
    5. Produce segments to buffered-segments topic
    """"""

    def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        
---
[Medium] function _create_processes in src/sentry/spans/consumers/process/flusher.py:
def _create_processes(self):
        # Create processes based on shard mapping
        for process_index, shards in self.process_to_shards_map.items():
            self._create_process_for_shards(process_index, shards)
---
[Medium] function _ensure_processes_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_processes_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")

        for process_index, process in self.processes.items():
            if not process:
                continue

            shards = self.process_to_shards_map[process_index]

            cause = None
            if not process.is_alive():
                exitcode = getattr(process, ""exitcode"", ""unknown"")
                cause = f""no_process_{exitcode}""
      
---
[Medium] function submit in src/sentry/spans/consumers/process/flusher.py:
def submit(self, message: Message[FilteredPayload | int]) -> None:
        # Note that submit is not actually a hot path. Their message payloads
        # are mapped from *batches* of spans, and there are a handful of spans
        # per second at most. If anything, self.poll() might even be called
        # more often than submit()

        self._ensure_processes_alive()

        for buffer in self.buffers.values():
            buffer.record_stored_segments()

        # We pause insertion into 
---
[Medium] function __init__ in src/sentry/spans/consumers/process/factory.py:
def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        num_processes: int,
        input_block_size: int | None,
        output_block_size: int | None,
        flusher_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        super().__init__()

        # config
        self.max_batch_size = max_batch_size
        self.max_batch_time = max_batch_time
        self.input_block_size = input_block_size
 
---
[Medium] function create_with_partitions in src/sentry/spans/consumers/process/factory.py:
def create_with_partitions(
        self,
        commit: Commit,
        partitions: Mapping[Partition, int],
    ) -> ProcessingStrategy[KafkaPayload]:
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""consumer"")

        committer = CommitOffsets(commit)

        buffer = SpansBuffer(assigned_shards=[p.index for p in partitions])

        # patch onto self just for testing
        flusher: ProcessingStrategy[FilteredPayload | int]
        flusher = self._flusher = SpanFlusher(
    
---
[Medium] function _create_process_for_shard in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shard(self, shard: int):
        # Find which process this shard belongs to and restart that process
        for process_index, shards in self.process_to_shards_map.items():
            if shard in shards:
                self._create_process_for_shards(process_index, shards)
                break
---
[Medium] function _create_process in src/sentry/spans/consumers/process/flusher.py:
def _create_process(self):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.healthy_since.value = int(time.time())

        make_process: Callable[..., multiprocessing.context.SpawnProcess | threading.Thread]
        if self.produce_to_pipe is None:
            target = run_with_initialized_sentry(
                SpanFlusher.main,
                # 
---
[Medium] function _ensure_process_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_process_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")
        if not self.process.is_alive():
            exitcode = getattr(self.process, ""exitcode"", ""unknown"")
            cause = f""no_process_{exitcode}""
        elif int(time.time()) - self.healthy_since.value > max_unhealthy_seconds:
            cause = ""hang""
        else:
            return  # healthy

        metrics.incr(""spans.buffer.flusher_unhealthy"", tags={""
---
[Medium] heading RIGHT: Use prefetch_related in CLAUDE.md:
# RIGHT: Use prefetch_related
organizations.prefetch_related('projects')
---
[Medium] function __init__ in src/sentry/spans/consumers/process/flusher.py:
def __init__(
        self,
        buffer: SpansBuffer,
        next_step: ProcessingStrategy[FilteredPayload | int],
        max_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        self.next_step = next_step
        self.max_processes = max_processes or len(buffer.assigned_shards)

        self.mp_context = mp_context = multiprocessing.get_context(""spawn"")
        self.stopped = mp_context.Value(""i"", 0)
        self.redis_was_full
---
[Medium] function test_basic in tests/sentry/spans/consumers/process/test_consumer.py:
@pytest.mark.django_db(transaction=True)
def test_basic(monkeypatch):
    # Flush very aggressively to make test pass instantly
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    topic = Topic(""test"")
    messages: list[KafkaPayload] = []

    fac = ProcessSpansStrategyFactory(
        max_batch_size=10,
        max_batch_time=10,
        num_processes=1,
        input_block_size=None,
        output_block_size=None,
        produce_to_pipe=messages.append,
    )

    commits = []

    d
---
[Medium] function test_backpressure in tests/sentry/spans/consumers/process/test_flusher.py:
@override_options({**DEFAULT_OPTIONS, ""spans.buffer.max-flush-segments"": 1})
def test_backpressure(monkeypatch):
    # Flush very aggressively to make join() faster
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    messages = []

    def append(msg):
        messages.append(msg)
        sleep(1.0)

    buffer = SpansBuffer(assigned_shards=list(range(1)))
    flusher = SpanFlusher(
        buffer,
        next_step=Noop(),
        produce_to_pipe=append,
    )

    now = time.time()

   ","SpanFlusher (High), main (High), _create_process_for_shards (Medium), join (Medium), ProcessSpansStrategyFactory (Medium), _create_processes (Medium), _ensure_processes_alive (Medium), submit (Medium), __init__ (Medium), create_with_partitions (Medium), _create_process_for_shard (Medium), _create_process (Medium), _ensure_process_alive (Medium), RIGHT: Use prefetch_related (Medium), __init__ (Medium), test_basic (Medium), test_backpressure (Medium), WRONG: Use hasattr() for unions (Low), RIGHT: Use isinstance() (Low), test_flusher_processes_limit (Low)",miss,"test-specific mock issue, not in SpanFlusher HC entities"
sentry,6,Span Buffer Multiprocess Enhancement with Health Monitoring,"Breaking out of the loop when the deadline has elapsed can skip terminating remaining flusher processes, potentially leaving them running after shutdown; consider ensuring termination is attempted even if the deadline is exceeded.",Medium,20,2,15,"class::SpanFlusher (src/sentry/spans/consumers/process/flusher.py) [High, score=0.63] | function::main (src/sentry/spans/consumers/process/flusher.py) [High, score=0.51]","[High] class SpanFlusher in src/sentry/spans/consumers/process/flusher.py:
class SpanFlusher(ProcessingStrategy[FilteredPayload | int]):
    """"""
    A background multiprocessing manager that polls Redis for new segments to flush and to produce to Kafka.
    Creates one process per shard for parallel processing.

    This is a processing step to be embedded into the consumer that writes to
    Redis. It takes and fowards integer messages that represent recently
    processed timestamps (from the producer timestamp of the incoming span
    message), which are then used as a clock to determine whether segments have expired.

    :param topic: The topic to send segments to.
    :param produce_to_pipe: For unit-testing, produce to this multiprocessing Pipe instead of creating a kafka consumer.
    """"""

    def __init__(
        self,
        buffer: SpansBuffer,
     
---
[High] function main in src/sentry/spans/consumers/process/flusher.py:
@staticmethod
    def main(
        buffer: SpansBuffer,
        shards: list[int],
        stopped,
        current_drift,
        backpressure_since,
        healthy_since,
        produce_to_pipe: Callable[[KafkaPayload], None] | None,
    ) -> None:
        shard_tag = "","".join(map(str, shards))
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""flusher"")
        sentry_sdk.set_tag(""sentry_spans_buffer_shards"", shard_tag)

        try:
            producer_futures = []

            if produce_to_pipe is not None:
                produce = produce_to_pipe
                producer = None
            else:
                cluster_name = get_topic_definition(Topic.BUFFERED_SEGMENTS)[""cluster""]

                producer_config = get_kafka_producer_cluster_options(cluster_name)
   ","[Medium] function _create_process_for_shards in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shards(self, process_index: int, shards: list[int]):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.process_healthy_since[process_index].value = int(time.time())

        # Create a buffer for these specific shards
        shard_buffer = SpansBuffer(shards)

        make_process: Callable[..., multiprocessing.context.SpawnPr
---
[Medium] function join in src/sentry/spans/consumers/process/flusher.py:
def join(self, timeout: float | None = None):
        # set stopped flag first so we can ""flush"" the background threads while
        # next_step is also shutting down. we can do two things at once!
        self.stopped.value = True
        deadline = time.time() + timeout if timeout else None

        self.next_step.join(timeout)

        # Wait for all processes to finish
        for process_index, process in self.processes.items():
            if deadline is not None:
                remainin
---
[Medium] class ProcessSpansStrategyFactory in src/sentry/spans/consumers/process/factory.py:
class ProcessSpansStrategyFactory(ProcessingStrategyFactory[KafkaPayload]):
    """"""
    1. Process spans and push them to redis
    2. Commit offsets for processed spans
    3. Reduce the messages to find the latest timestamp to process
    4. Fetch all segments are two minutes or older and expire the keys so they
       aren't reprocessed
    5. Produce segments to buffered-segments topic
    """"""

    def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        
---
[Medium] function _create_processes in src/sentry/spans/consumers/process/flusher.py:
def _create_processes(self):
        # Create processes based on shard mapping
        for process_index, shards in self.process_to_shards_map.items():
            self._create_process_for_shards(process_index, shards)
---
[Medium] function _ensure_processes_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_processes_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")

        for process_index, process in self.processes.items():
            if not process:
                continue

            shards = self.process_to_shards_map[process_index]

            cause = None
            if not process.is_alive():
                exitcode = getattr(process, ""exitcode"", ""unknown"")
                cause = f""no_process_{exitcode}""
      
---
[Medium] function submit in src/sentry/spans/consumers/process/flusher.py:
def submit(self, message: Message[FilteredPayload | int]) -> None:
        # Note that submit is not actually a hot path. Their message payloads
        # are mapped from *batches* of spans, and there are a handful of spans
        # per second at most. If anything, self.poll() might even be called
        # more often than submit()

        self._ensure_processes_alive()

        for buffer in self.buffers.values():
            buffer.record_stored_segments()

        # We pause insertion into 
---
[Medium] function __init__ in src/sentry/spans/consumers/process/factory.py:
def __init__(
        self,
        max_batch_size: int,
        max_batch_time: int,
        num_processes: int,
        input_block_size: int | None,
        output_block_size: int | None,
        flusher_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        super().__init__()

        # config
        self.max_batch_size = max_batch_size
        self.max_batch_time = max_batch_time
        self.input_block_size = input_block_size
 
---
[Medium] function create_with_partitions in src/sentry/spans/consumers/process/factory.py:
def create_with_partitions(
        self,
        commit: Commit,
        partitions: Mapping[Partition, int],
    ) -> ProcessingStrategy[KafkaPayload]:
        sentry_sdk.set_tag(""sentry_spans_buffer_component"", ""consumer"")

        committer = CommitOffsets(commit)

        buffer = SpansBuffer(assigned_shards=[p.index for p in partitions])

        # patch onto self just for testing
        flusher: ProcessingStrategy[FilteredPayload | int]
        flusher = self._flusher = SpanFlusher(
    
---
[Medium] function _create_process_for_shard in src/sentry/spans/consumers/process/flusher.py:
def _create_process_for_shard(self, shard: int):
        # Find which process this shard belongs to and restart that process
        for process_index, shards in self.process_to_shards_map.items():
            if shard in shards:
                self._create_process_for_shards(process_index, shards)
                break
---
[Medium] function _create_process in src/sentry/spans/consumers/process/flusher.py:
def _create_process(self):
        # Optimistically reset healthy_since to avoid a race between the
        # starting process and the next flush cycle. Keep back pressure across
        # the restart, however.
        self.healthy_since.value = int(time.time())

        make_process: Callable[..., multiprocessing.context.SpawnProcess | threading.Thread]
        if self.produce_to_pipe is None:
            target = run_with_initialized_sentry(
                SpanFlusher.main,
                # 
---
[Medium] function _ensure_process_alive in src/sentry/spans/consumers/process/flusher.py:
def _ensure_process_alive(self) -> None:
        max_unhealthy_seconds = options.get(""spans.buffer.flusher.max-unhealthy-seconds"")
        if not self.process.is_alive():
            exitcode = getattr(self.process, ""exitcode"", ""unknown"")
            cause = f""no_process_{exitcode}""
        elif int(time.time()) - self.healthy_since.value > max_unhealthy_seconds:
            cause = ""hang""
        else:
            return  # healthy

        metrics.incr(""spans.buffer.flusher_unhealthy"", tags={""
---
[Medium] heading RIGHT: Use prefetch_related in CLAUDE.md:
# RIGHT: Use prefetch_related
organizations.prefetch_related('projects')
---
[Medium] function __init__ in src/sentry/spans/consumers/process/flusher.py:
def __init__(
        self,
        buffer: SpansBuffer,
        next_step: ProcessingStrategy[FilteredPayload | int],
        max_processes: int | None = None,
        produce_to_pipe: Callable[[KafkaPayload], None] | None = None,
    ):
        self.next_step = next_step
        self.max_processes = max_processes or len(buffer.assigned_shards)

        self.mp_context = mp_context = multiprocessing.get_context(""spawn"")
        self.stopped = mp_context.Value(""i"", 0)
        self.redis_was_full
---
[Medium] function test_basic in tests/sentry/spans/consumers/process/test_consumer.py:
@pytest.mark.django_db(transaction=True)
def test_basic(monkeypatch):
    # Flush very aggressively to make test pass instantly
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    topic = Topic(""test"")
    messages: list[KafkaPayload] = []

    fac = ProcessSpansStrategyFactory(
        max_batch_size=10,
        max_batch_time=10,
        num_processes=1,
        input_block_size=None,
        output_block_size=None,
        produce_to_pipe=messages.append,
    )

    commits = []

    d
---
[Medium] function test_backpressure in tests/sentry/spans/consumers/process/test_flusher.py:
@override_options({**DEFAULT_OPTIONS, ""spans.buffer.max-flush-segments"": 1})
def test_backpressure(monkeypatch):
    # Flush very aggressively to make join() faster
    monkeypatch.setattr(""time.sleep"", lambda _: None)

    messages = []

    def append(msg):
        messages.append(msg)
        sleep(1.0)

    buffer = SpansBuffer(assigned_shards=list(range(1)))
    flusher = SpanFlusher(
        buffer,
        next_step=Noop(),
        produce_to_pipe=append,
    )

    now = time.time()

   ","SpanFlusher (High), main (High), _create_process_for_shards (Medium), join (Medium), ProcessSpansStrategyFactory (Medium), _create_processes (Medium), _ensure_processes_alive (Medium), submit (Medium), __init__ (Medium), create_with_partitions (Medium), _create_process_for_shard (Medium), _create_process (Medium), _ensure_process_alive (Medium), RIGHT: Use prefetch_related (Medium), __init__ (Medium), test_basic (Medium), test_backpressure (Medium), WRONG: Use hasattr() for unions (Low), RIGHT: Use isinstance() (Low), test_flusher_processes_limit (Low)",match,'remaining' matches HC entity 'main'
sentry,5,Replays Self-Serve Bulk Delete System,Breaking changes in error response format,Medium,4,2,2,"class::MatchedRow (src/sentry/replays/usecases/delete.py) [High, score=0.64] | function::_make_recording_filenames (src/sentry/replays/usecases/delete.py) [High, score=0.50]","[High] class MatchedRow in src/sentry/replays/usecases/delete.py:
class MatchedRow(TypedDict):
    retention_days: int
    replay_id: str
    max_segment_id: int | None
    platform: str
---
[High] function _make_recording_filenames in src/sentry/replays/usecases/delete.py:
def _make_recording_filenames(project_id: int, row: MatchedRow) -> list[str]:
    # Null segment_ids can cause this to fail. If no segments were ingested then we can skip
    # deleting the segements.
    if row[""max_segment_id""] is None:
        return []

    # We assume every segment between 0 and the max_segment_id exists. Its a waste of time to
    # delete a non-existent segment but its not so significant that we'd want to query ClickHouse
    # to verify it exists.
    replay_id = row[""replay_id""]
    retention_days = row[""retention_days""]
    platform = row[""platform""]

    filenames = []
    for segment_id in range(row[""max_segment_id""] + 1):
        segment = RecordingSegmentStorageMeta(project_id, replay_id, segment_id, retention_days)
        filenames.append(make_recording_fil","[Medium] function test_run_bulk_replay_delete_job_completion in tests/sentry/replays/tasks/test_delete_replays_bulk.py:
@patch(""sentry.replays.tasks.fetch_rows_matching_pattern"")
    @patch(""sentry.replays.tasks.delete_matched_rows"")
    def test_run_bulk_replay_delete_job_completion(self, mock_delete_matched_rows, mock_fetch_rows):
        """"""Test the completion of the bulk deletion job""""""
        # Mock the fetch_rows_matching_pattern to return no more rows
        mock_fetch_rows.return_value = {
            ""rows"": [
                {
                    ""retention_days"": 90,
                    ""replay_id"": 
---
[Medium] class TestDeleteReplaysBulk in tests/sentry/replays/tasks/test_delete_replays_bulk.py:
class TestDeleteReplaysBulk(APITestCase, ReplaysSnubaTestCase):
    def setUp(self):
        super().setUp()
        self.project = self.create_project(name=""test_project"")
        self.range_start = datetime.datetime.now(tz=datetime.UTC) - datetime.timedelta(days=1)
        self.range_end = datetime.datetime.now(tz=datetime.UTC)
        self.query = """"
        self.environments = [""prod""]

        # Create a deletion job
        self.job = ReplayDeletionJobModel.objects.create(
            orga","MatchedRow (High), _make_recording_filenames (High), test_run_bulk_replay_delete_job_completion (Medium), TestDeleteReplaysBulk (Medium)",miss,error response format not in MatchedRow/delete HC entities
sentry,5,Replays Self-Serve Bulk Delete System,Detector validator uses wrong key when updating type,Medium,4,2,2,"class::MatchedRow (src/sentry/replays/usecases/delete.py) [High, score=0.64] | function::_make_recording_filenames (src/sentry/replays/usecases/delete.py) [High, score=0.50]","[High] class MatchedRow in src/sentry/replays/usecases/delete.py:
class MatchedRow(TypedDict):
    retention_days: int
    replay_id: str
    max_segment_id: int | None
    platform: str
---
[High] function _make_recording_filenames in src/sentry/replays/usecases/delete.py:
def _make_recording_filenames(project_id: int, row: MatchedRow) -> list[str]:
    # Null segment_ids can cause this to fail. If no segments were ingested then we can skip
    # deleting the segements.
    if row[""max_segment_id""] is None:
        return []

    # We assume every segment between 0 and the max_segment_id exists. Its a waste of time to
    # delete a non-existent segment but its not so significant that we'd want to query ClickHouse
    # to verify it exists.
    replay_id = row[""replay_id""]
    retention_days = row[""retention_days""]
    platform = row[""platform""]

    filenames = []
    for segment_id in range(row[""max_segment_id""] + 1):
        segment = RecordingSegmentStorageMeta(project_id, replay_id, segment_id, retention_days)
        filenames.append(make_recording_fil","[Medium] function test_run_bulk_replay_delete_job_completion in tests/sentry/replays/tasks/test_delete_replays_bulk.py:
@patch(""sentry.replays.tasks.fetch_rows_matching_pattern"")
    @patch(""sentry.replays.tasks.delete_matched_rows"")
    def test_run_bulk_replay_delete_job_completion(self, mock_delete_matched_rows, mock_fetch_rows):
        """"""Test the completion of the bulk deletion job""""""
        # Mock the fetch_rows_matching_pattern to return no more rows
        mock_fetch_rows.return_value = {
            ""rows"": [
                {
                    ""retention_days"": 90,
                    ""replay_id"": 
---
[Medium] class TestDeleteReplaysBulk in tests/sentry/replays/tasks/test_delete_replays_bulk.py:
class TestDeleteReplaysBulk(APITestCase, ReplaysSnubaTestCase):
    def setUp(self):
        super().setUp()
        self.project = self.create_project(name=""test_project"")
        self.range_start = datetime.datetime.now(tz=datetime.UTC) - datetime.timedelta(days=1)
        self.range_end = datetime.datetime.now(tz=datetime.UTC)
        self.query = """"
        self.environments = [""prod""]

        # Create a deletion job
        self.job = ReplayDeletionJobModel.objects.create(
            orga","MatchedRow (High), _make_recording_filenames (High), test_run_bulk_replay_delete_job_completion (Medium), TestDeleteReplaysBulk (Medium)",miss,detector validator not in replay delete HC entities
sentry,5,Replays Self-Serve Bulk Delete System,"Using zip(error_ids, events.values()) assumes the get_multi result preserves the input order; dict value order is not guaranteed to match error_ids, so event data can be paired with the wrong ID (missing nodes also shift alignment).",Low,4,2,2,"class::MatchedRow (src/sentry/replays/usecases/delete.py) [High, score=0.64] | function::_make_recording_filenames (src/sentry/replays/usecases/delete.py) [High, score=0.50]","[High] class MatchedRow in src/sentry/replays/usecases/delete.py:
class MatchedRow(TypedDict):
    retention_days: int
    replay_id: str
    max_segment_id: int | None
    platform: str
---
[High] function _make_recording_filenames in src/sentry/replays/usecases/delete.py:
def _make_recording_filenames(project_id: int, row: MatchedRow) -> list[str]:
    # Null segment_ids can cause this to fail. If no segments were ingested then we can skip
    # deleting the segements.
    if row[""max_segment_id""] is None:
        return []

    # We assume every segment between 0 and the max_segment_id exists. Its a waste of time to
    # delete a non-existent segment but its not so significant that we'd want to query ClickHouse
    # to verify it exists.
    replay_id = row[""replay_id""]
    retention_days = row[""retention_days""]
    platform = row[""platform""]

    filenames = []
    for segment_id in range(row[""max_segment_id""] + 1):
        segment = RecordingSegmentStorageMeta(project_id, replay_id, segment_id, retention_days)
        filenames.append(make_recording_fil","[Medium] function test_run_bulk_replay_delete_job_completion in tests/sentry/replays/tasks/test_delete_replays_bulk.py:
@patch(""sentry.replays.tasks.fetch_rows_matching_pattern"")
    @patch(""sentry.replays.tasks.delete_matched_rows"")
    def test_run_bulk_replay_delete_job_completion(self, mock_delete_matched_rows, mock_fetch_rows):
        """"""Test the completion of the bulk deletion job""""""
        # Mock the fetch_rows_matching_pattern to return no more rows
        mock_fetch_rows.return_value = {
            ""rows"": [
                {
                    ""retention_days"": 90,
                    ""replay_id"": 
---
[Medium] class TestDeleteReplaysBulk in tests/sentry/replays/tasks/test_delete_replays_bulk.py:
class TestDeleteReplaysBulk(APITestCase, ReplaysSnubaTestCase):
    def setUp(self):
        super().setUp()
        self.project = self.create_project(name=""test_project"")
        self.range_start = datetime.datetime.now(tz=datetime.UTC) - datetime.timedelta(days=1)
        self.range_end = datetime.datetime.now(tz=datetime.UTC)
        self.query = """"
        self.environments = [""prod""]

        # Create a deletion job
        self.job = ReplayDeletionJobModel.objects.create(
            orga","MatchedRow (High), _make_recording_filenames (High), test_run_bulk_replay_delete_job_completion (Medium), TestDeleteReplaysBulk (Medium)",miss,dict ordering not related to replay delete HC entities
sentry,4,GitHub OAuth Security Enhancement,Null reference if github_authenticated_user state is missing,Medium,11,3,8,"function::error (src/sentry/integrations/github/integration.py) [High, score=0.70] | class::GitHubIntegrationProvider (src/sentry/integrations/github/integration.py) [High, score=0.69] | class::GitHubInstallation (src/sentry/integrations/github/integration.py) [High, score=0.52]","[High] function error in src/sentry/integrations/github/integration.py:
def error(
    request,
    org,
    error_short=""Invalid installation request."",
    error_long=ERR_INTEGRATION_INVALID_INSTALLATION_REQUEST,
):
    return render_to_response(
        ""sentry/integrations/github-integration-failed.html"",
        context={
            ""error"": error_long,
            ""payload"": {
                ""success"": False,
                ""data"": {""error"": _(error_short)},
            },
            ""document_origin"": get_document_origin(org),
        },
        request=request,
    )
---
[High] class GitHubIntegrationProvider in src/sentry/integrations/github/integration.py:
class GitHubIntegrationProvider(IntegrationProvider):
    key = ""github""
    name = ""GitHub""
    metadata = metadata
    integration_cls = GitHubIntegration
    features = frozenset(
        [
            IntegrationFeatures.COMMITS,
            IntegrationFeatures.ISSUE_BASIC,
            IntegrationFeatures.STACKTRACE_LINK,
            IntegrationFeatures.CODEOWNERS,
        ]
    )

    setup_dialog_config = {""width"": 1030, ""height"": 1000}

    def get_client(self) -> GitHubClientMixin:
        # XXX: This is very awkward behaviour as we're not passing the client an Integration
        # object it expects. Instead we're passing the Installation object and hoping the client
        # doesn't try to invoke any bad fields/attributes on it.
        return GitHubAppsClient(integration=self.i
---
[High] class GitHubInstallation in src/sentry/integrations/github/integration.py:
class GitHubInstallation(PipelineView):
    def get_app_url(self) -> str:
        name = options.get(""github-app.name"")
        return f""https://github.com/apps/{slugify(name)}""

    def dispatch(self, request: Request, pipeline: Pipeline) -> HttpResponse:
        installation_id = request.GET.get(
            ""installation_id"", pipeline.fetch_state(""installation_id"")
        )
        if installation_id is None:
            return self.redirect(self.get_app_url())

        pipeline.bind_state(""installation_id"", installation_id)
        self.determine_active_organization(request)

        integration_pending_deletion_exists = False
        if self.active_organization:
            # We want to wait until the scheduled deletions finish or else the
            # post install to migrate repos ","[Medium] function GitHubIntegrationTest in tests/sentry/integrations/github/test_integration.py:
@control_silo_test
class GitHubIntegrationTest(IntegrationTestCase):
    provider = GitHubIntegrationProvider
    base_url = ""https://api.github.com""

    def setUp(self):
        super().setUp()

        self.installation_id = ""install_1""
        self.user_id = ""user_1""
        self.app_id = ""app_1""
        self.access_token = ""xxxxx-xxxxxxxxx-xxxxxxxxxx-xxxxxxxxxxxx""
        self.expires_at = ""3000-01-01T00:00:00Z""

        self._stub_github()
        plugins.register(GitHubPlugin)

    def te
---
[Medium] class PipelineAdvancerView in src/sentry/web/frontend/pipeline_advancer.py:
class PipelineAdvancerView(BaseView):
    """"""Gets the current pipeline from the request and executes the current step.""""""

    auth_required = False

    csrf_protect = False

    def handle(self, request: Request, provider_id: str) -> HttpResponseBase:
        pipeline = None

        for pipeline_cls in PIPELINE_CLASSES:
            pipeline = pipeline_cls.get_for_request(request=request)
            if pipeline:
                break

        # GitHub apps may be installed directly from GitHu
---
[Medium] function dispatch in src/sentry/integrations/github/integration.py:
def dispatch(self, request: Request, pipeline) -> HttpResponse:
        self.determine_active_organization(request)

        ghip = GitHubIdentityProvider()
        github_client_id = ghip.get_oauth_client_id()
        github_client_secret = ghip.get_oauth_client_secret()

        installation_id = request.GET.get(""installation_id"")
        if installation_id:
            pipeline.bind_state(""installation_id"", installation_id)

        if not request.GET.get(""state""):
            state = pipelin
---
[Medium] function get_document_origin in src/sentry/integrations/github/integration.py:
def get_document_origin(org) -> str:
    if org and features.has(""organizations:customer-domains"", org.organization):
        return f'""{generate_organization_url(org.organization.slug)}""'
    return ""document.origin""
---
[Medium] class OAuthLoginView in src/sentry/integrations/github/integration.py:
class OAuthLoginView(PipelineView):
    def dispatch(self, request: Request, pipeline) -> HttpResponse:
        self.determine_active_organization(request)

        ghip = GitHubIdentityProvider()
        github_client_id = ghip.get_oauth_client_id()
        github_client_secret = ghip.get_oauth_client_secret()

        installation_id = request.GET.get(""installation_id"")
        if installation_id:
            pipeline.bind_state(""installation_id"", installation_id)

        if not request.GET.g
---
[Medium] function get_pipeline_views in src/sentry/integrations/github/integration.py:
def get_pipeline_views(self) -> Sequence[PipelineView]:
        return [OAuthLoginView(), GitHubInstallation()]
---
[Medium] function handle in src/sentry/web/frontend/pipeline_advancer.py:
def handle(self, request: Request, provider_id: str) -> HttpResponseBase:
        pipeline = None

        for pipeline_cls in PIPELINE_CLASSES:
            pipeline = pipeline_cls.get_for_request(request=request)
            if pipeline:
                break

        # GitHub apps may be installed directly from GitHub, in which case
        # they will redirect here *without* being in the pipeline. If that happens
        # redirect to the integration install org picker.
        if (
         
---
[Medium] function dispatch in src/sentry/integrations/github/integration.py:
def dispatch(self, request: Request, pipeline: Pipeline) -> HttpResponse:
        installation_id = request.GET.get(
            ""installation_id"", pipeline.fetch_state(""installation_id"")
        )
        if installation_id is None:
            return self.redirect(self.get_app_url())

        pipeline.bind_state(""installation_id"", installation_id)
        self.determine_active_organization(request)

        integration_pending_deletion_exists = False
        if self.active_organization:
      ","error (High), GitHubIntegrationProvider (High), GitHubInstallation (High), GitHubIntegrationTest (Medium), PipelineAdvancerView (Medium), dispatch (Medium), get_document_origin (Medium), OAuthLoginView (Medium), get_pipeline_views (Medium), handle (Medium), dispatch (Medium)",partial,"HC entities exist (3) but no name match; golden idents: {'state', 'reference', 'github_authenticated_user'}"
sentry,4,GitHub OAuth Security Enhancement,OAuth state uses pipeline.signature (static) instead of a per-request random value,Medium,11,3,8,"function::error (src/sentry/integrations/github/integration.py) [High, score=0.70] | class::GitHubIntegrationProvider (src/sentry/integrations/github/integration.py) [High, score=0.69] | class::GitHubInstallation (src/sentry/integrations/github/integration.py) [High, score=0.52]","[High] function error in src/sentry/integrations/github/integration.py:
def error(
    request,
    org,
    error_short=""Invalid installation request."",
    error_long=ERR_INTEGRATION_INVALID_INSTALLATION_REQUEST,
):
    return render_to_response(
        ""sentry/integrations/github-integration-failed.html"",
        context={
            ""error"": error_long,
            ""payload"": {
                ""success"": False,
                ""data"": {""error"": _(error_short)},
            },
            ""document_origin"": get_document_origin(org),
        },
        request=request,
    )
---
[High] class GitHubIntegrationProvider in src/sentry/integrations/github/integration.py:
class GitHubIntegrationProvider(IntegrationProvider):
    key = ""github""
    name = ""GitHub""
    metadata = metadata
    integration_cls = GitHubIntegration
    features = frozenset(
        [
            IntegrationFeatures.COMMITS,
            IntegrationFeatures.ISSUE_BASIC,
            IntegrationFeatures.STACKTRACE_LINK,
            IntegrationFeatures.CODEOWNERS,
        ]
    )

    setup_dialog_config = {""width"": 1030, ""height"": 1000}

    def get_client(self) -> GitHubClientMixin:
        # XXX: This is very awkward behaviour as we're not passing the client an Integration
        # object it expects. Instead we're passing the Installation object and hoping the client
        # doesn't try to invoke any bad fields/attributes on it.
        return GitHubAppsClient(integration=self.i
---
[High] class GitHubInstallation in src/sentry/integrations/github/integration.py:
class GitHubInstallation(PipelineView):
    def get_app_url(self) -> str:
        name = options.get(""github-app.name"")
        return f""https://github.com/apps/{slugify(name)}""

    def dispatch(self, request: Request, pipeline: Pipeline) -> HttpResponse:
        installation_id = request.GET.get(
            ""installation_id"", pipeline.fetch_state(""installation_id"")
        )
        if installation_id is None:
            return self.redirect(self.get_app_url())

        pipeline.bind_state(""installation_id"", installation_id)
        self.determine_active_organization(request)

        integration_pending_deletion_exists = False
        if self.active_organization:
            # We want to wait until the scheduled deletions finish or else the
            # post install to migrate repos ","[Medium] function GitHubIntegrationTest in tests/sentry/integrations/github/test_integration.py:
@control_silo_test
class GitHubIntegrationTest(IntegrationTestCase):
    provider = GitHubIntegrationProvider
    base_url = ""https://api.github.com""

    def setUp(self):
        super().setUp()

        self.installation_id = ""install_1""
        self.user_id = ""user_1""
        self.app_id = ""app_1""
        self.access_token = ""xxxxx-xxxxxxxxx-xxxxxxxxxx-xxxxxxxxxxxx""
        self.expires_at = ""3000-01-01T00:00:00Z""

        self._stub_github()
        plugins.register(GitHubPlugin)

    def te
---
[Medium] class PipelineAdvancerView in src/sentry/web/frontend/pipeline_advancer.py:
class PipelineAdvancerView(BaseView):
    """"""Gets the current pipeline from the request and executes the current step.""""""

    auth_required = False

    csrf_protect = False

    def handle(self, request: Request, provider_id: str) -> HttpResponseBase:
        pipeline = None

        for pipeline_cls in PIPELINE_CLASSES:
            pipeline = pipeline_cls.get_for_request(request=request)
            if pipeline:
                break

        # GitHub apps may be installed directly from GitHu
---
[Medium] function dispatch in src/sentry/integrations/github/integration.py:
def dispatch(self, request: Request, pipeline) -> HttpResponse:
        self.determine_active_organization(request)

        ghip = GitHubIdentityProvider()
        github_client_id = ghip.get_oauth_client_id()
        github_client_secret = ghip.get_oauth_client_secret()

        installation_id = request.GET.get(""installation_id"")
        if installation_id:
            pipeline.bind_state(""installation_id"", installation_id)

        if not request.GET.get(""state""):
            state = pipelin
---
[Medium] function get_document_origin in src/sentry/integrations/github/integration.py:
def get_document_origin(org) -> str:
    if org and features.has(""organizations:customer-domains"", org.organization):
        return f'""{generate_organization_url(org.organization.slug)}""'
    return ""document.origin""
---
[Medium] class OAuthLoginView in src/sentry/integrations/github/integration.py:
class OAuthLoginView(PipelineView):
    def dispatch(self, request: Request, pipeline) -> HttpResponse:
        self.determine_active_organization(request)

        ghip = GitHubIdentityProvider()
        github_client_id = ghip.get_oauth_client_id()
        github_client_secret = ghip.get_oauth_client_secret()

        installation_id = request.GET.get(""installation_id"")
        if installation_id:
            pipeline.bind_state(""installation_id"", installation_id)

        if not request.GET.g
---
[Medium] function get_pipeline_views in src/sentry/integrations/github/integration.py:
def get_pipeline_views(self) -> Sequence[PipelineView]:
        return [OAuthLoginView(), GitHubInstallation()]
---
[Medium] function handle in src/sentry/web/frontend/pipeline_advancer.py:
def handle(self, request: Request, provider_id: str) -> HttpResponseBase:
        pipeline = None

        for pipeline_cls in PIPELINE_CLASSES:
            pipeline = pipeline_cls.get_for_request(request=request)
            if pipeline:
                break

        # GitHub apps may be installed directly from GitHub, in which case
        # they will redirect here *without* being in the pipeline. If that happens
        # redirect to the integration install org picker.
        if (
         
---
[Medium] function dispatch in src/sentry/integrations/github/integration.py:
def dispatch(self, request: Request, pipeline: Pipeline) -> HttpResponse:
        installation_id = request.GET.get(
            ""installation_id"", pipeline.fetch_state(""installation_id"")
        )
        if installation_id is None:
            return self.redirect(self.get_app_url())

        pipeline.bind_state(""installation_id"", installation_id)
        self.determine_active_organization(request)

        integration_pending_deletion_exists = False
        if self.active_organization:
      ","error (High), GitHubIntegrationProvider (High), GitHubInstallation (High), GitHubIntegrationTest (Medium), PipelineAdvancerView (Medium), dispatch (Medium), get_document_origin (Medium), OAuthLoginView (Medium), get_pipeline_views (Medium), handle (Medium), dispatch (Medium)",match,'OAuth' matches entity 'oauthloginview'
sentry,4,GitHub OAuth Security Enhancement,The code attempts to access integration.metadata[sender][login] without checking for the existence of the sender key. This causes a KeyError for integrations where the sender metadata was not set during creation,High,11,3,8,"function::error (src/sentry/integrations/github/integration.py) [High, score=0.70] | class::GitHubIntegrationProvider (src/sentry/integrations/github/integration.py) [High, score=0.69] | class::GitHubInstallation (src/sentry/integrations/github/integration.py) [High, score=0.52]","[High] function error in src/sentry/integrations/github/integration.py:
def error(
    request,
    org,
    error_short=""Invalid installation request."",
    error_long=ERR_INTEGRATION_INVALID_INSTALLATION_REQUEST,
):
    return render_to_response(
        ""sentry/integrations/github-integration-failed.html"",
        context={
            ""error"": error_long,
            ""payload"": {
                ""success"": False,
                ""data"": {""error"": _(error_short)},
            },
            ""document_origin"": get_document_origin(org),
        },
        request=request,
    )
---
[High] class GitHubIntegrationProvider in src/sentry/integrations/github/integration.py:
class GitHubIntegrationProvider(IntegrationProvider):
    key = ""github""
    name = ""GitHub""
    metadata = metadata
    integration_cls = GitHubIntegration
    features = frozenset(
        [
            IntegrationFeatures.COMMITS,
            IntegrationFeatures.ISSUE_BASIC,
            IntegrationFeatures.STACKTRACE_LINK,
            IntegrationFeatures.CODEOWNERS,
        ]
    )

    setup_dialog_config = {""width"": 1030, ""height"": 1000}

    def get_client(self) -> GitHubClientMixin:
        # XXX: This is very awkward behaviour as we're not passing the client an Integration
        # object it expects. Instead we're passing the Installation object and hoping the client
        # doesn't try to invoke any bad fields/attributes on it.
        return GitHubAppsClient(integration=self.i
---
[High] class GitHubInstallation in src/sentry/integrations/github/integration.py:
class GitHubInstallation(PipelineView):
    def get_app_url(self) -> str:
        name = options.get(""github-app.name"")
        return f""https://github.com/apps/{slugify(name)}""

    def dispatch(self, request: Request, pipeline: Pipeline) -> HttpResponse:
        installation_id = request.GET.get(
            ""installation_id"", pipeline.fetch_state(""installation_id"")
        )
        if installation_id is None:
            return self.redirect(self.get_app_url())

        pipeline.bind_state(""installation_id"", installation_id)
        self.determine_active_organization(request)

        integration_pending_deletion_exists = False
        if self.active_organization:
            # We want to wait until the scheduled deletions finish or else the
            # post install to migrate repos ","[Medium] function GitHubIntegrationTest in tests/sentry/integrations/github/test_integration.py:
@control_silo_test
class GitHubIntegrationTest(IntegrationTestCase):
    provider = GitHubIntegrationProvider
    base_url = ""https://api.github.com""

    def setUp(self):
        super().setUp()

        self.installation_id = ""install_1""
        self.user_id = ""user_1""
        self.app_id = ""app_1""
        self.access_token = ""xxxxx-xxxxxxxxx-xxxxxxxxxx-xxxxxxxxxxxx""
        self.expires_at = ""3000-01-01T00:00:00Z""

        self._stub_github()
        plugins.register(GitHubPlugin)

    def te
---
[Medium] class PipelineAdvancerView in src/sentry/web/frontend/pipeline_advancer.py:
class PipelineAdvancerView(BaseView):
    """"""Gets the current pipeline from the request and executes the current step.""""""

    auth_required = False

    csrf_protect = False

    def handle(self, request: Request, provider_id: str) -> HttpResponseBase:
        pipeline = None

        for pipeline_cls in PIPELINE_CLASSES:
            pipeline = pipeline_cls.get_for_request(request=request)
            if pipeline:
                break

        # GitHub apps may be installed directly from GitHu
---
[Medium] function dispatch in src/sentry/integrations/github/integration.py:
def dispatch(self, request: Request, pipeline) -> HttpResponse:
        self.determine_active_organization(request)

        ghip = GitHubIdentityProvider()
        github_client_id = ghip.get_oauth_client_id()
        github_client_secret = ghip.get_oauth_client_secret()

        installation_id = request.GET.get(""installation_id"")
        if installation_id:
            pipeline.bind_state(""installation_id"", installation_id)

        if not request.GET.get(""state""):
            state = pipelin
---
[Medium] function get_document_origin in src/sentry/integrations/github/integration.py:
def get_document_origin(org) -> str:
    if org and features.has(""organizations:customer-domains"", org.organization):
        return f'""{generate_organization_url(org.organization.slug)}""'
    return ""document.origin""
---
[Medium] class OAuthLoginView in src/sentry/integrations/github/integration.py:
class OAuthLoginView(PipelineView):
    def dispatch(self, request: Request, pipeline) -> HttpResponse:
        self.determine_active_organization(request)

        ghip = GitHubIdentityProvider()
        github_client_id = ghip.get_oauth_client_id()
        github_client_secret = ghip.get_oauth_client_secret()

        installation_id = request.GET.get(""installation_id"")
        if installation_id:
            pipeline.bind_state(""installation_id"", installation_id)

        if not request.GET.g
---
[Medium] function get_pipeline_views in src/sentry/integrations/github/integration.py:
def get_pipeline_views(self) -> Sequence[PipelineView]:
        return [OAuthLoginView(), GitHubInstallation()]
---
[Medium] function handle in src/sentry/web/frontend/pipeline_advancer.py:
def handle(self, request: Request, provider_id: str) -> HttpResponseBase:
        pipeline = None

        for pipeline_cls in PIPELINE_CLASSES:
            pipeline = pipeline_cls.get_for_request(request=request)
            if pipeline:
                break

        # GitHub apps may be installed directly from GitHub, in which case
        # they will redirect here *without* being in the pipeline. If that happens
        # redirect to the integration install org picker.
        if (
         
---
[Medium] function dispatch in src/sentry/integrations/github/integration.py:
def dispatch(self, request: Request, pipeline: Pipeline) -> HttpResponse:
        installation_id = request.GET.get(
            ""installation_id"", pipeline.fetch_state(""installation_id"")
        )
        if installation_id is None:
            return self.redirect(self.get_app_url())

        pipeline.bind_state(""installation_id"", installation_id)
        self.determine_active_organization(request)

        integration_pending_deletion_exists = False
        if self.active_organization:
      ","error (High), GitHubIntegrationProvider (High), GitHubInstallation (High), GitHubIntegrationTest (Medium), PipelineAdvancerView (Medium), dispatch (Medium), get_document_origin (Medium), OAuthLoginView (Medium), get_pipeline_views (Medium), handle (Medium), dispatch (Medium)",match,'KeyError' matches HC entity 'error'
sentry,3,feat(upsampling) - Support upsampled error count with performance optimizations,sample_rate = 0.0 is falsy and skipped,Low,7,5,1,"function::transform_query_columns_for_error_upsampling (src/sentry/api/helpers/error_upsampling.py) [High, score=0.64] | function::OrganizationEventsStatsEndpoint (src/sentry/api/endpoints/organization_events_stats.py) [High, score=0.62] | class::DiscoverDatasetConfig (src/sentry/search/events/datasets/discover.py) [High, score=0.61] | function::is_errors_query_for_error_upsampled_projects (src/sentry/api/helpers/error_upsampling.py) [High, score=0.56] | function::function_converter (src/sentry/search/events/datasets/discover.py) [High, score=0.50]","[High] function transform_query_columns_for_error_upsampling in src/sentry/api/helpers/error_upsampling.py:
def transform_query_columns_for_error_upsampling(
    query_columns: Sequence[str],
) -> list[str]:
    """"""
    Transform aggregation functions to use sum(sample_weight) instead of count()
    for error upsampling. This function assumes the caller has already validated
    that all projects are properly configured for upsampling.
    
    Note: We rely on the database schema to ensure sample_weight exists for all
    events in allowlisted projects, so no additional null checks are needed here.
    """"""
    transformed_columns = []
    for column in query_columns:
        column_lower = column.lower().strip()

        if column_lower == ""count()"":
            # Transform to upsampled count - assumes sample_weight column exists
            # for all events in allowlisted projects per our data
---
[High] function OrganizationEventsStatsEndpoint in src/sentry/api/endpoints/organization_events_stats.py:
@region_silo_endpoint
class OrganizationEventsStatsEndpoint(OrganizationEventsV2EndpointBase):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }

    def get_features(
        self, organization: Organization, request: Request
    ) -> Mapping[str, bool | None]:
        feature_names = [
            ""organizations:performance-chart-interpolation"",
            ""organizations:performance-use-metrics"",
            ""organizations:dashboards-mep"",
            ""organizations:mep-rollout-flag"",
            ""organizations:use-metrics-layer"",
            ""organizations:starfish-view"",
            ""organizations:on-demand-metrics-extraction"",
            ""organizations:on-demand-metrics-extraction-widgets"",
        ]
        batch_features = features.batch_has(
            f
---
[High] class DiscoverDatasetConfig in src/sentry/search/events/datasets/discover.py:
class DiscoverDatasetConfig(DatasetConfig):
    custom_threshold_columns = {
        ""apdex()"",
        ""count_miserable(user)"",
        ""user_misery()"",
    }
    non_nullable_keys = {""event.type""}
    nullable_context_keys = {""thread.id""}
    use_entity_prefix_for_fields: bool = False

    def __init__(self, builder: BaseQueryBuilder):
        self.builder = builder
        self.total_count: int | None = None
        self.total_sum_transaction_duration: float | None = None

    @property
    def search_filter_converter(
        self,
    ) -> Mapping[str, Callable[[SearchFilter], WhereType | None]]:
        return {
            ""environment"": self.builder._environment_filter_converter,
            ""message"": self._message_filter_converter,
            PROJECT_ALIAS: self._project_slug_fi
---
[High] function is_errors_query_for_error_upsampled_projects in src/sentry/api/helpers/error_upsampling.py:
def is_errors_query_for_error_upsampled_projects(
    snuba_params: SnubaParams,
    organization: Organization,
    dataset: ModuleType,
    request: Request,
) -> bool:
    """"""
    Determine if this query should use error upsampling transformations.
    Only applies when ALL projects are allowlisted and we're querying error events.
    
    Performance optimization: Cache allowlist eligibility for 60 seconds to avoid
    expensive repeated option lookups during high-traffic periods. This is safe
    because allowlist changes are infrequent and eventual consistency is acceptable.
    """"""
    cache_key = f""error_upsampling_eligible:{organization.id}:{hash(tuple(sorted(snuba_params.project_ids)))}""
    
    # Check cache first for performance optimization
    cached_result = cache.get(cache
---
[High] function function_converter in src/sentry/search/events/datasets/discover.py:
@property
    def function_converter(self) -> Mapping[str, SnQLFunction]:
        function_converter = {
            function.name: function
            for function in [
                SnQLFunction(
                    ""failure_count"",
                    snql_aggregate=lambda _, alias: Function(
                        ""countIf"",
                        [
                            Function(
                                ""notIn"",
                                [
                                    self.builder.column(""transaction.status""),
                                    [
                                        SPAN_STATUS_NAME_TO_CODE[status]
                                        for status in NON_FAILURE_STATUS
                                    ],
                        ","[Medium] function _are_all_projects_error_upsampled in src/sentry/api/helpers/error_upsampling.py:
def _are_all_projects_error_upsampled(
    project_ids: Sequence[int], organization: Organization
) -> bool:
    """"""
    Check if ALL projects in the query are allowlisted for error upsampling.
    Only returns True if all projects pass the allowlist condition.
    
    NOTE: This function reads the allowlist configuration fresh each time,
    which means it can return different results between calls if the 
    configuration changes during request processing. This is intentional
    to ensure w","transform_query_columns_for_error_upsampling (High), OrganizationEventsStatsEndpoint (High), DiscoverDatasetConfig (High), is_errors_query_for_error_upsampled_projects (High), function_converter (High), _are_all_projects_error_upsampled (Medium), invalidate_upsampling_cache (Low)",partial,"HC entities exist (5) but no name match; golden idents: {'skipped', 'falsy', 'sample_rate'}"
sentry,3,feat(upsampling) - Support upsampled error count with performance optimizations,"Using Pythonâ€™s built-in hash() to build cache keys is non-deterministic across processes (hash randomization), so keys wonâ€™t match across workers and invalidate_upsampling_cache may fail to delete them. Use a deterministic serialization of project_ids for the cache key.",Low,7,5,1,"function::transform_query_columns_for_error_upsampling (src/sentry/api/helpers/error_upsampling.py) [High, score=0.64] | function::OrganizationEventsStatsEndpoint (src/sentry/api/endpoints/organization_events_stats.py) [High, score=0.62] | class::DiscoverDatasetConfig (src/sentry/search/events/datasets/discover.py) [High, score=0.61] | function::is_errors_query_for_error_upsampled_projects (src/sentry/api/helpers/error_upsampling.py) [High, score=0.56] | function::function_converter (src/sentry/search/events/datasets/discover.py) [High, score=0.50]","[High] function transform_query_columns_for_error_upsampling in src/sentry/api/helpers/error_upsampling.py:
def transform_query_columns_for_error_upsampling(
    query_columns: Sequence[str],
) -> list[str]:
    """"""
    Transform aggregation functions to use sum(sample_weight) instead of count()
    for error upsampling. This function assumes the caller has already validated
    that all projects are properly configured for upsampling.
    
    Note: We rely on the database schema to ensure sample_weight exists for all
    events in allowlisted projects, so no additional null checks are needed here.
    """"""
    transformed_columns = []
    for column in query_columns:
        column_lower = column.lower().strip()

        if column_lower == ""count()"":
            # Transform to upsampled count - assumes sample_weight column exists
            # for all events in allowlisted projects per our data
---
[High] function OrganizationEventsStatsEndpoint in src/sentry/api/endpoints/organization_events_stats.py:
@region_silo_endpoint
class OrganizationEventsStatsEndpoint(OrganizationEventsV2EndpointBase):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }

    def get_features(
        self, organization: Organization, request: Request
    ) -> Mapping[str, bool | None]:
        feature_names = [
            ""organizations:performance-chart-interpolation"",
            ""organizations:performance-use-metrics"",
            ""organizations:dashboards-mep"",
            ""organizations:mep-rollout-flag"",
            ""organizations:use-metrics-layer"",
            ""organizations:starfish-view"",
            ""organizations:on-demand-metrics-extraction"",
            ""organizations:on-demand-metrics-extraction-widgets"",
        ]
        batch_features = features.batch_has(
            f
---
[High] class DiscoverDatasetConfig in src/sentry/search/events/datasets/discover.py:
class DiscoverDatasetConfig(DatasetConfig):
    custom_threshold_columns = {
        ""apdex()"",
        ""count_miserable(user)"",
        ""user_misery()"",
    }
    non_nullable_keys = {""event.type""}
    nullable_context_keys = {""thread.id""}
    use_entity_prefix_for_fields: bool = False

    def __init__(self, builder: BaseQueryBuilder):
        self.builder = builder
        self.total_count: int | None = None
        self.total_sum_transaction_duration: float | None = None

    @property
    def search_filter_converter(
        self,
    ) -> Mapping[str, Callable[[SearchFilter], WhereType | None]]:
        return {
            ""environment"": self.builder._environment_filter_converter,
            ""message"": self._message_filter_converter,
            PROJECT_ALIAS: self._project_slug_fi
---
[High] function is_errors_query_for_error_upsampled_projects in src/sentry/api/helpers/error_upsampling.py:
def is_errors_query_for_error_upsampled_projects(
    snuba_params: SnubaParams,
    organization: Organization,
    dataset: ModuleType,
    request: Request,
) -> bool:
    """"""
    Determine if this query should use error upsampling transformations.
    Only applies when ALL projects are allowlisted and we're querying error events.
    
    Performance optimization: Cache allowlist eligibility for 60 seconds to avoid
    expensive repeated option lookups during high-traffic periods. This is safe
    because allowlist changes are infrequent and eventual consistency is acceptable.
    """"""
    cache_key = f""error_upsampling_eligible:{organization.id}:{hash(tuple(sorted(snuba_params.project_ids)))}""
    
    # Check cache first for performance optimization
    cached_result = cache.get(cache
---
[High] function function_converter in src/sentry/search/events/datasets/discover.py:
@property
    def function_converter(self) -> Mapping[str, SnQLFunction]:
        function_converter = {
            function.name: function
            for function in [
                SnQLFunction(
                    ""failure_count"",
                    snql_aggregate=lambda _, alias: Function(
                        ""countIf"",
                        [
                            Function(
                                ""notIn"",
                                [
                                    self.builder.column(""transaction.status""),
                                    [
                                        SPAN_STATUS_NAME_TO_CODE[status]
                                        for status in NON_FAILURE_STATUS
                                    ],
                        ","[Medium] function _are_all_projects_error_upsampled in src/sentry/api/helpers/error_upsampling.py:
def _are_all_projects_error_upsampled(
    project_ids: Sequence[int], organization: Organization
) -> bool:
    """"""
    Check if ALL projects in the query are allowlisted for error upsampling.
    Only returns True if all projects pass the allowlist condition.
    
    NOTE: This function reads the allowlist configuration fresh each time,
    which means it can return different results between calls if the 
    configuration changes during request processing. This is intentional
    to ensure w","transform_query_columns_for_error_upsampling (High), OrganizationEventsStatsEndpoint (High), DiscoverDatasetConfig (High), is_errors_query_for_error_upsampled_projects (High), function_converter (High), _are_all_projects_error_upsampled (Medium), invalidate_upsampling_cache (Low)",match,'cache' matches entity 'invalidate_upsampling_cache'
sentry,3,feat(upsampling) - Support upsampled error count with performance optimizations,"The upsampling eligibility check passes the outer dataset instead of the actual dataset used by scoped_dataset. In paths where the query ultimately runs against discover (e.g., dashboard split) while the original dataset is metrics, upsampling may be skipped even when all projects are allowlisted.",Medium,7,5,1,"function::transform_query_columns_for_error_upsampling (src/sentry/api/helpers/error_upsampling.py) [High, score=0.64] | function::OrganizationEventsStatsEndpoint (src/sentry/api/endpoints/organization_events_stats.py) [High, score=0.62] | class::DiscoverDatasetConfig (src/sentry/search/events/datasets/discover.py) [High, score=0.61] | function::is_errors_query_for_error_upsampled_projects (src/sentry/api/helpers/error_upsampling.py) [High, score=0.56] | function::function_converter (src/sentry/search/events/datasets/discover.py) [High, score=0.50]","[High] function transform_query_columns_for_error_upsampling in src/sentry/api/helpers/error_upsampling.py:
def transform_query_columns_for_error_upsampling(
    query_columns: Sequence[str],
) -> list[str]:
    """"""
    Transform aggregation functions to use sum(sample_weight) instead of count()
    for error upsampling. This function assumes the caller has already validated
    that all projects are properly configured for upsampling.
    
    Note: We rely on the database schema to ensure sample_weight exists for all
    events in allowlisted projects, so no additional null checks are needed here.
    """"""
    transformed_columns = []
    for column in query_columns:
        column_lower = column.lower().strip()

        if column_lower == ""count()"":
            # Transform to upsampled count - assumes sample_weight column exists
            # for all events in allowlisted projects per our data
---
[High] function OrganizationEventsStatsEndpoint in src/sentry/api/endpoints/organization_events_stats.py:
@region_silo_endpoint
class OrganizationEventsStatsEndpoint(OrganizationEventsV2EndpointBase):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }

    def get_features(
        self, organization: Organization, request: Request
    ) -> Mapping[str, bool | None]:
        feature_names = [
            ""organizations:performance-chart-interpolation"",
            ""organizations:performance-use-metrics"",
            ""organizations:dashboards-mep"",
            ""organizations:mep-rollout-flag"",
            ""organizations:use-metrics-layer"",
            ""organizations:starfish-view"",
            ""organizations:on-demand-metrics-extraction"",
            ""organizations:on-demand-metrics-extraction-widgets"",
        ]
        batch_features = features.batch_has(
            f
---
[High] class DiscoverDatasetConfig in src/sentry/search/events/datasets/discover.py:
class DiscoverDatasetConfig(DatasetConfig):
    custom_threshold_columns = {
        ""apdex()"",
        ""count_miserable(user)"",
        ""user_misery()"",
    }
    non_nullable_keys = {""event.type""}
    nullable_context_keys = {""thread.id""}
    use_entity_prefix_for_fields: bool = False

    def __init__(self, builder: BaseQueryBuilder):
        self.builder = builder
        self.total_count: int | None = None
        self.total_sum_transaction_duration: float | None = None

    @property
    def search_filter_converter(
        self,
    ) -> Mapping[str, Callable[[SearchFilter], WhereType | None]]:
        return {
            ""environment"": self.builder._environment_filter_converter,
            ""message"": self._message_filter_converter,
            PROJECT_ALIAS: self._project_slug_fi
---
[High] function is_errors_query_for_error_upsampled_projects in src/sentry/api/helpers/error_upsampling.py:
def is_errors_query_for_error_upsampled_projects(
    snuba_params: SnubaParams,
    organization: Organization,
    dataset: ModuleType,
    request: Request,
) -> bool:
    """"""
    Determine if this query should use error upsampling transformations.
    Only applies when ALL projects are allowlisted and we're querying error events.
    
    Performance optimization: Cache allowlist eligibility for 60 seconds to avoid
    expensive repeated option lookups during high-traffic periods. This is safe
    because allowlist changes are infrequent and eventual consistency is acceptable.
    """"""
    cache_key = f""error_upsampling_eligible:{organization.id}:{hash(tuple(sorted(snuba_params.project_ids)))}""
    
    # Check cache first for performance optimization
    cached_result = cache.get(cache
---
[High] function function_converter in src/sentry/search/events/datasets/discover.py:
@property
    def function_converter(self) -> Mapping[str, SnQLFunction]:
        function_converter = {
            function.name: function
            for function in [
                SnQLFunction(
                    ""failure_count"",
                    snql_aggregate=lambda _, alias: Function(
                        ""countIf"",
                        [
                            Function(
                                ""notIn"",
                                [
                                    self.builder.column(""transaction.status""),
                                    [
                                        SPAN_STATUS_NAME_TO_CODE[status]
                                        for status in NON_FAILURE_STATUS
                                    ],
                        ","[Medium] function _are_all_projects_error_upsampled in src/sentry/api/helpers/error_upsampling.py:
def _are_all_projects_error_upsampled(
    project_ids: Sequence[int], organization: Organization
) -> bool:
    """"""
    Check if ALL projects in the query are allowlisted for error upsampling.
    Only returns True if all projects pass the allowlist condition.
    
    NOTE: This function reads the allowlist configuration fresh each time,
    which means it can return different results between calls if the 
    configuration changes during request processing. This is intentional
    to ensure w","transform_query_columns_for_error_upsampling (High), OrganizationEventsStatsEndpoint (High), DiscoverDatasetConfig (High), is_errors_query_for_error_upsampled_projects (High), function_converter (High), _are_all_projects_error_upsampled (Medium), invalidate_upsampling_cache (Low)",match,'projects' matches HC entity 'is_errors_query_for_error_upsampled_projects'
sentry,2,Optimize spans buffer insertion with eviction during insert,OptimizedCursorPaginator negative-offset branch slices QuerySet with a negative start index,Critical,10,2,1,"function::get_result (src/sentry/api/paginator.py) [Critical, score=0.73] | class::BasePaginator (src/sentry/api/paginator.py) [High, score=0.61]","[Critical] function get_result in src/sentry/api/paginator.py:
def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None, max_hits=None):
        # cursors are:
        #   (identifier(integer), row offset, is_prev)
        if cursor is None:
            cursor = Cursor(0, 0, 0)

        limit = min(limit, self.max_limit)

        if cursor.value:
            cursor_value = self.value_from_cursor(cursor)
        else:
            cursor_value = 0

        queryset = self.build_queryset(cursor_value, cursor.is_prev)

        # TODO(dcramer): this does not yet work correctly for ``is_prev`` when
        # the key is not unique

        # max_hits can be limited to speed up the query
        if max_hits is None:
            max_hits = MAX_HITS_LIMIT
        if count_hits:
            hits = self.count_hits(max_hits)
        elif know
---
[High] class BasePaginator in src/sentry/api/paginator.py:
class BasePaginator:
    def __init__(
        self, queryset, order_by=None, max_limit=MAX_LIMIT, on_results=None, post_query_filter=None
    ):

        if order_by:
            if order_by.startswith(""-""):
                self.key, self.desc = order_by[1:], True
            else:
                self.key, self.desc = order_by, False
        else:
            self.key = None
            self.desc = False
        self.queryset = queryset
        self.max_limit = max_limit
        self.on_results = on_results
        self.post_query_filter = post_query_filter

    def _is_asc(self, is_prev):
        return (self.desc and is_prev) or not (self.desc or is_prev)

    def build_queryset(self, value, is_prev):
        queryset = self.queryset

        # ""asc"" controls whether or not we need to ","[Medium] function OrganizationAuditLogsEndpoint in src/sentry/api/endpoints/organization_auditlogs.py:
@control_silo_endpoint
class OrganizationAuditLogsEndpoint(ControlSiloOrganizationEndpoint):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }
    owner = ApiOwner.ENTERPRISE
    permission_classes = (OrganizationAuditPermission,)

    def get(
        self,
        request: Request,
        organization_context: RpcUserOrganizationContext,
        organization: RpcOrganization,
    ) -> Response:
        queryset = AuditLogEntry.objects.filter(organization_id=organizati","get_result (Critical), BasePaginator (High), OrganizationAuditLogsEndpoint (Medium), OptimizedCursorPaginator (Low), __init__ (Low), get_item_key (Low), value_from_cursor (Low), get_result (Low), Cursor (Low), __init__ (Low)",match,'OptimizedCursorPaginator' matches entity 'optimizedcursorpaginator'
sentry,2,Optimize spans buffer insertion with eviction during insert,BasePaginator negative-offset branch slices QuerySet with a negative start index,High,10,2,1,"function::get_result (src/sentry/api/paginator.py) [Critical, score=0.73] | class::BasePaginator (src/sentry/api/paginator.py) [High, score=0.61]","[Critical] function get_result in src/sentry/api/paginator.py:
def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None, max_hits=None):
        # cursors are:
        #   (identifier(integer), row offset, is_prev)
        if cursor is None:
            cursor = Cursor(0, 0, 0)

        limit = min(limit, self.max_limit)

        if cursor.value:
            cursor_value = self.value_from_cursor(cursor)
        else:
            cursor_value = 0

        queryset = self.build_queryset(cursor_value, cursor.is_prev)

        # TODO(dcramer): this does not yet work correctly for ``is_prev`` when
        # the key is not unique

        # max_hits can be limited to speed up the query
        if max_hits is None:
            max_hits = MAX_HITS_LIMIT
        if count_hits:
            hits = self.count_hits(max_hits)
        elif know
---
[High] class BasePaginator in src/sentry/api/paginator.py:
class BasePaginator:
    def __init__(
        self, queryset, order_by=None, max_limit=MAX_LIMIT, on_results=None, post_query_filter=None
    ):

        if order_by:
            if order_by.startswith(""-""):
                self.key, self.desc = order_by[1:], True
            else:
                self.key, self.desc = order_by, False
        else:
            self.key = None
            self.desc = False
        self.queryset = queryset
        self.max_limit = max_limit
        self.on_results = on_results
        self.post_query_filter = post_query_filter

    def _is_asc(self, is_prev):
        return (self.desc and is_prev) or not (self.desc or is_prev)

    def build_queryset(self, value, is_prev):
        queryset = self.queryset

        # ""asc"" controls whether or not we need to ","[Medium] function OrganizationAuditLogsEndpoint in src/sentry/api/endpoints/organization_auditlogs.py:
@control_silo_endpoint
class OrganizationAuditLogsEndpoint(ControlSiloOrganizationEndpoint):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }
    owner = ApiOwner.ENTERPRISE
    permission_classes = (OrganizationAuditPermission,)

    def get(
        self,
        request: Request,
        organization_context: RpcUserOrganizationContext,
        organization: RpcOrganization,
    ) -> Response:
        queryset = AuditLogEntry.objects.filter(organization_id=organizati","get_result (Critical), BasePaginator (High), OrganizationAuditLogsEndpoint (Medium), OptimizedCursorPaginator (Low), __init__ (Low), get_item_key (Low), value_from_cursor (Low), get_result (Low), Cursor (Low), __init__ (Low)",match,'BasePaginator' matches HC entity 'basepaginator'
sentry,2,Optimize spans buffer insertion with eviction during insert,"OptimizedCursorPaginator.get_item_key uses floor/ceil on a datetime key (order_by='-datetime'), causing TypeError.",High,10,2,1,"function::get_result (src/sentry/api/paginator.py) [Critical, score=0.73] | class::BasePaginator (src/sentry/api/paginator.py) [High, score=0.61]","[Critical] function get_result in src/sentry/api/paginator.py:
def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None, max_hits=None):
        # cursors are:
        #   (identifier(integer), row offset, is_prev)
        if cursor is None:
            cursor = Cursor(0, 0, 0)

        limit = min(limit, self.max_limit)

        if cursor.value:
            cursor_value = self.value_from_cursor(cursor)
        else:
            cursor_value = 0

        queryset = self.build_queryset(cursor_value, cursor.is_prev)

        # TODO(dcramer): this does not yet work correctly for ``is_prev`` when
        # the key is not unique

        # max_hits can be limited to speed up the query
        if max_hits is None:
            max_hits = MAX_HITS_LIMIT
        if count_hits:
            hits = self.count_hits(max_hits)
        elif know
---
[High] class BasePaginator in src/sentry/api/paginator.py:
class BasePaginator:
    def __init__(
        self, queryset, order_by=None, max_limit=MAX_LIMIT, on_results=None, post_query_filter=None
    ):

        if order_by:
            if order_by.startswith(""-""):
                self.key, self.desc = order_by[1:], True
            else:
                self.key, self.desc = order_by, False
        else:
            self.key = None
            self.desc = False
        self.queryset = queryset
        self.max_limit = max_limit
        self.on_results = on_results
        self.post_query_filter = post_query_filter

    def _is_asc(self, is_prev):
        return (self.desc and is_prev) or not (self.desc or is_prev)

    def build_queryset(self, value, is_prev):
        queryset = self.queryset

        # ""asc"" controls whether or not we need to ","[Medium] function OrganizationAuditLogsEndpoint in src/sentry/api/endpoints/organization_auditlogs.py:
@control_silo_endpoint
class OrganizationAuditLogsEndpoint(ControlSiloOrganizationEndpoint):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }
    owner = ApiOwner.ENTERPRISE
    permission_classes = (OrganizationAuditPermission,)

    def get(
        self,
        request: Request,
        organization_context: RpcUserOrganizationContext,
        organization: RpcOrganization,
    ) -> Response:
        queryset = AuditLogEntry.objects.filter(organization_id=organizati","get_result (Critical), BasePaginator (High), OrganizationAuditLogsEndpoint (Medium), OptimizedCursorPaginator (Low), __init__ (Low), get_item_key (Low), value_from_cursor (Low), get_result (Low), Cursor (Low), __init__ (Low)",match,'get_item_key' matches entity 'get_item_key'
sentry,1,Enhanced Pagination Performance for High-Volume Audit Logs,Importing non-existent OptimizedCursorPaginator,Low,10,2,1,"function::get_result (src/sentry/api/paginator.py) [Critical, score=0.73] | class::BasePaginator (src/sentry/api/paginator.py) [High, score=0.61]","[Critical] function get_result in src/sentry/api/paginator.py:
def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None, max_hits=None):
        # cursors are:
        #   (identifier(integer), row offset, is_prev)
        if cursor is None:
            cursor = Cursor(0, 0, 0)

        limit = min(limit, self.max_limit)

        if cursor.value:
            cursor_value = self.value_from_cursor(cursor)
        else:
            cursor_value = 0

        queryset = self.build_queryset(cursor_value, cursor.is_prev)

        # TODO(dcramer): this does not yet work correctly for ``is_prev`` when
        # the key is not unique

        # max_hits can be limited to speed up the query
        if max_hits is None:
            max_hits = MAX_HITS_LIMIT
        if count_hits:
            hits = self.count_hits(max_hits)
        elif know
---
[High] class BasePaginator in src/sentry/api/paginator.py:
class BasePaginator:
    def __init__(
        self, queryset, order_by=None, max_limit=MAX_LIMIT, on_results=None, post_query_filter=None
    ):

        if order_by:
            if order_by.startswith(""-""):
                self.key, self.desc = order_by[1:], True
            else:
                self.key, self.desc = order_by, False
        else:
            self.key = None
            self.desc = False
        self.queryset = queryset
        self.max_limit = max_limit
        self.on_results = on_results
        self.post_query_filter = post_query_filter

    def _is_asc(self, is_prev):
        return (self.desc and is_prev) or not (self.desc or is_prev)

    def build_queryset(self, value, is_prev):
        queryset = self.queryset

        # ""asc"" controls whether or not we need to ","[Medium] function OrganizationAuditLogsEndpoint in src/sentry/api/endpoints/organization_auditlogs.py:
@control_silo_endpoint
class OrganizationAuditLogsEndpoint(ControlSiloOrganizationEndpoint):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }
    owner = ApiOwner.ENTERPRISE
    permission_classes = (OrganizationAuditPermission,)

    def get(
        self,
        request: Request,
        organization_context: RpcUserOrganizationContext,
        organization: RpcOrganization,
    ) -> Response:
        queryset = AuditLogEntry.objects.filter(organization_id=organizati","get_result (Critical), BasePaginator (High), OrganizationAuditLogsEndpoint (Medium), OptimizedCursorPaginator (Low), __init__ (Low), get_item_key (Low), value_from_cursor (Low), get_result (Low), Cursor (Low), __init__ (Low)",match,"OptimizedCursorPaginator is in ALL entities (Low), get_result is Critical"
sentry,1,Enhanced Pagination Performance for High-Volume Audit Logs,Django querysets do not support negative slicing,High,10,2,1,"function::get_result (src/sentry/api/paginator.py) [Critical, score=0.73] | class::BasePaginator (src/sentry/api/paginator.py) [High, score=0.61]","[Critical] function get_result in src/sentry/api/paginator.py:
def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None, max_hits=None):
        # cursors are:
        #   (identifier(integer), row offset, is_prev)
        if cursor is None:
            cursor = Cursor(0, 0, 0)

        limit = min(limit, self.max_limit)

        if cursor.value:
            cursor_value = self.value_from_cursor(cursor)
        else:
            cursor_value = 0

        queryset = self.build_queryset(cursor_value, cursor.is_prev)

        # TODO(dcramer): this does not yet work correctly for ``is_prev`` when
        # the key is not unique

        # max_hits can be limited to speed up the query
        if max_hits is None:
            max_hits = MAX_HITS_LIMIT
        if count_hits:
            hits = self.count_hits(max_hits)
        elif know
---
[High] class BasePaginator in src/sentry/api/paginator.py:
class BasePaginator:
    def __init__(
        self, queryset, order_by=None, max_limit=MAX_LIMIT, on_results=None, post_query_filter=None
    ):

        if order_by:
            if order_by.startswith(""-""):
                self.key, self.desc = order_by[1:], True
            else:
                self.key, self.desc = order_by, False
        else:
            self.key = None
            self.desc = False
        self.queryset = queryset
        self.max_limit = max_limit
        self.on_results = on_results
        self.post_query_filter = post_query_filter

    def _is_asc(self, is_prev):
        return (self.desc and is_prev) or not (self.desc or is_prev)

    def build_queryset(self, value, is_prev):
        queryset = self.queryset

        # ""asc"" controls whether or not we need to ","[Medium] function OrganizationAuditLogsEndpoint in src/sentry/api/endpoints/organization_auditlogs.py:
@control_silo_endpoint
class OrganizationAuditLogsEndpoint(ControlSiloOrganizationEndpoint):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }
    owner = ApiOwner.ENTERPRISE
    permission_classes = (OrganizationAuditPermission,)

    def get(
        self,
        request: Request,
        organization_context: RpcUserOrganizationContext,
        organization: RpcOrganization,
    ) -> Response:
        queryset = AuditLogEntry.objects.filter(organization_id=organizati","get_result (Critical), BasePaginator (High), OrganizationAuditLogsEndpoint (Medium), OptimizedCursorPaginator (Low), __init__ (Low), get_item_key (Low), value_from_cursor (Low), get_result (Low), Cursor (Low), __init__ (Low)",partial,"HC entities exist (2) but no name match; golden idents: {'querysets', 'Django', 'negative', 'support', 'slicing'}"
sentry,1,Enhanced Pagination Performance for High-Volume Audit Logs,"When requests are authenticated with API keys or org auth tokens (which have user_id=None), organization_context.member is None. Line 71 attempts to access organization_context.member.has_global_access without checking if member is None, causing an AttributeError crash when optimized_pagination=true is used, even though the request passed all permission checks with valid org:write scope.",High,10,2,1,"function::get_result (src/sentry/api/paginator.py) [Critical, score=0.73] | class::BasePaginator (src/sentry/api/paginator.py) [High, score=0.61]","[Critical] function get_result in src/sentry/api/paginator.py:
def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None, max_hits=None):
        # cursors are:
        #   (identifier(integer), row offset, is_prev)
        if cursor is None:
            cursor = Cursor(0, 0, 0)

        limit = min(limit, self.max_limit)

        if cursor.value:
            cursor_value = self.value_from_cursor(cursor)
        else:
            cursor_value = 0

        queryset = self.build_queryset(cursor_value, cursor.is_prev)

        # TODO(dcramer): this does not yet work correctly for ``is_prev`` when
        # the key is not unique

        # max_hits can be limited to speed up the query
        if max_hits is None:
            max_hits = MAX_HITS_LIMIT
        if count_hits:
            hits = self.count_hits(max_hits)
        elif know
---
[High] class BasePaginator in src/sentry/api/paginator.py:
class BasePaginator:
    def __init__(
        self, queryset, order_by=None, max_limit=MAX_LIMIT, on_results=None, post_query_filter=None
    ):

        if order_by:
            if order_by.startswith(""-""):
                self.key, self.desc = order_by[1:], True
            else:
                self.key, self.desc = order_by, False
        else:
            self.key = None
            self.desc = False
        self.queryset = queryset
        self.max_limit = max_limit
        self.on_results = on_results
        self.post_query_filter = post_query_filter

    def _is_asc(self, is_prev):
        return (self.desc and is_prev) or not (self.desc or is_prev)

    def build_queryset(self, value, is_prev):
        queryset = self.queryset

        # ""asc"" controls whether or not we need to ","[Medium] function OrganizationAuditLogsEndpoint in src/sentry/api/endpoints/organization_auditlogs.py:
@control_silo_endpoint
class OrganizationAuditLogsEndpoint(ControlSiloOrganizationEndpoint):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }
    owner = ApiOwner.ENTERPRISE
    permission_classes = (OrganizationAuditPermission,)

    def get(
        self,
        request: Request,
        organization_context: RpcUserOrganizationContext,
        organization: RpcOrganization,
    ) -> Response:
        queryset = AuditLogEntry.objects.filter(organization_id=organizati","get_result (Critical), BasePaginator (High), OrganizationAuditLogsEndpoint (Medium), OptimizedCursorPaginator (Low), __init__ (Low), get_item_key (Low), value_from_cursor (Low), get_result (Low), Cursor (Low), __init__ (Low)",partial,auth issue is in a different module from paginator HC entities
sentry,1,Enhanced Pagination Performance for High-Volume Audit Logs,"get_item_key assumes a numeric key, but the paginator is used with order_by=-datetime in the audit logs endpoint; calling math.floor/ceil on a datetime will raise a TypeError.",High,10,2,1,"function::get_result (src/sentry/api/paginator.py) [Critical, score=0.73] | class::BasePaginator (src/sentry/api/paginator.py) [High, score=0.61]","[Critical] function get_result in src/sentry/api/paginator.py:
def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None, max_hits=None):
        # cursors are:
        #   (identifier(integer), row offset, is_prev)
        if cursor is None:
            cursor = Cursor(0, 0, 0)

        limit = min(limit, self.max_limit)

        if cursor.value:
            cursor_value = self.value_from_cursor(cursor)
        else:
            cursor_value = 0

        queryset = self.build_queryset(cursor_value, cursor.is_prev)

        # TODO(dcramer): this does not yet work correctly for ``is_prev`` when
        # the key is not unique

        # max_hits can be limited to speed up the query
        if max_hits is None:
            max_hits = MAX_HITS_LIMIT
        if count_hits:
            hits = self.count_hits(max_hits)
        elif know
---
[High] class BasePaginator in src/sentry/api/paginator.py:
class BasePaginator:
    def __init__(
        self, queryset, order_by=None, max_limit=MAX_LIMIT, on_results=None, post_query_filter=None
    ):

        if order_by:
            if order_by.startswith(""-""):
                self.key, self.desc = order_by[1:], True
            else:
                self.key, self.desc = order_by, False
        else:
            self.key = None
            self.desc = False
        self.queryset = queryset
        self.max_limit = max_limit
        self.on_results = on_results
        self.post_query_filter = post_query_filter

    def _is_asc(self, is_prev):
        return (self.desc and is_prev) or not (self.desc or is_prev)

    def build_queryset(self, value, is_prev):
        queryset = self.queryset

        # ""asc"" controls whether or not we need to ","[Medium] function OrganizationAuditLogsEndpoint in src/sentry/api/endpoints/organization_auditlogs.py:
@control_silo_endpoint
class OrganizationAuditLogsEndpoint(ControlSiloOrganizationEndpoint):
    publish_status = {
        ""GET"": ApiPublishStatus.EXPERIMENTAL,
    }
    owner = ApiOwner.ENTERPRISE
    permission_classes = (OrganizationAuditPermission,)

    def get(
        self,
        request: Request,
        organization_context: RpcUserOrganizationContext,
        organization: RpcOrganization,
    ) -> Response:
        queryset = AuditLogEntry.objects.filter(organization_id=organizati","get_result (Critical), BasePaginator (High), OrganizationAuditLogsEndpoint (Medium), OptimizedCursorPaginator (Low), __init__ (Low), get_item_key (Low), value_from_cursor (Low), get_result (Low), Cursor (Low), __init__ (Low)",match,'paginator' matches HC entity 'basepaginator'
cal_dot_com,11,feat: add calendar cache status and actions (#22532),"The updateManyByCredentialId call uses an empty data object, which prevents Prisma's @updatedAt decorator from updating the updatedAt timestamp. This results in inaccurate cache status tracking, as the timestamp isn't updated when the cache is refreshed. To fix this, explicitly set the updatedAt field.",Medium,71,16,41,"class::SelectedCalendarRepository (packages/lib/server/repository/selectedCalendar.ts) [Critical, score=1.00] | class::UserRepository (packages/lib/server/repository/user.ts) [Critical, score=1.00] | interface::ICalendarCacheRepository (packages/features/calendar-cache/calendar-cache.repository.interface.ts) [Critical, score=0.87] | class::CalendarCacheRepository (packages/features/calendar-cache/calendar-cache.repository.ts) [Critical, score=0.85] | type::UserWithCalendars (packages/lib/getConnectedDestinationCalendars.ts) [Critical, score=0.80] | method::findMany (packages/lib/server/repository/selectedCalendar.ts) [Critical, score=0.80] | method::fetchAvailabilityAndSetCache (packages/app-store/googlecalendar/lib/CalendarService.ts) [Critical, score=0.73] | class::CalendarCacheRepositoryMock (packages/features/calendar-cache/calendar-cache.repository.mock.ts) [High, score=0.69] | variable::connectedCalendarsHandler (packages/trpc/server/routers/viewer/calendars/connectedCalendars.handler.ts) [High, score=0.68] | method::findUnlockedUserForSession (packages/lib/server/repository/user.ts) [High, score=0.65] | method::getCacheStatusByCredentialIds (packages/features/calendar-cache/calendar-cache.repository.mock.ts) [High, score=0.63] | method::updateManyByCredentialId (packages/lib/server/repository/selectedCalendar.ts) [High, score=0.63] | variable::calendarsRouter (packages/trpc/server/routers/viewer/calendars/_router.tsx) [High, score=0.59] | method::getCacheStatusByCredentialIds (packages/features/calendar-cache/calendar-cache.repository.ts) [High, score=0.53] | type::DeleteCacheOptions (packages/trpc/server/routers/viewer/calendars/deleteCache.handler.ts) [High, score=0.53] | variable::deleteCacheHandler (packages/trpc/server/routers/viewer/calendars/deleteCache.handler.ts) [High, score=0.53]","[Critical] class SelectedCalendarRepository in packages/lib/server/repository/selectedCalendar.ts:
class SelectedCalendarRepository {
  private static async findConflicting(data: {
    userId: number;
    integration: string;
    externalId: string;
    eventTypeId?: number | null;
  }) {
    // Because userId_integration_externalId_eventTypeId is a unique constraint but with eventTypeId being nullable,
    // it allows for multiple entries with the same (userId, integration, externalId) with eventTypeId=null in DB.
    // We restrict it at app level by ensuring that an entry doesn't exist already before creating a new one
    return await SelectedCalendarRepository.findFirst({
      where: {
        userId: data.userId,
        integration: data.integration,
        externalId: data.externalId,
        eventTypeId: data.eventTypeId || null,
      },
    });
  }

  static async findById
---
[Critical] class UserRepository in packages/lib/server/repository/user.ts:
class UserRepository {
  constructor(private prismaClient: PrismaClient) {}

  async findTeamsByUserId({ userId }: { userId: UserType[""id""] }) {
    const teamMemberships = await this.prismaClient.membership.findMany({
      where: {
        userId: userId,
      },
      include: {
        team: {
          select: teamSelect,
        },
      },
    });

    const acceptedTeamMemberships = teamMemberships.filter((membership) => membership.accepted);
    const pendingTeamMemberships = teamMemberships.filter((membership) => !membership.accepted);

    return {
      teams: acceptedTeamMemberships.map((membership) => membership.team),
      memberships: teamMemberships,
      acceptedTeamMemberships,
      pendingTeamMemberships,
    };
  }

  async findOrganizations({ userId }: { userId: U
---
[Critical] interface ICalendarCacheRepository in packages/features/calendar-cache/calendar-cache.repository.interface.ts:
interface ICalendarCacheRepository {
  watchCalendar(args: { calendarId: string; eventTypeIds: SelectedCalendarEventTypeIds }): Promise<any>;
  unwatchCalendar(args: { calendarId: string; eventTypeIds: SelectedCalendarEventTypeIds }): Promise<any>;
  upsertCachedAvailability({
    credentialId,
    userId,
    args,
    value,
  }: {
    credentialId: number;
    userId: number | null;
    args: FreeBusyArgs;
    value: Prisma.JsonNullValueInput | Prisma.InputJsonValue;
  }): Promise<void>;
  getCachedAvailability({
    credentialId,
    userId,
    args,
  }: {
    credentialId: number;
    userId: number | null;
    args: FreeBusyArgs;
  }): Promise<CalendarCache | null>;
  getCacheStatusByCredentialIds(
    credentialIds: number[]
  ): Promise<{ credentialId: number; updatedAt: Date | n
---
[Critical] class CalendarCacheRepository in packages/features/calendar-cache/calendar-cache.repository.ts:
class CalendarCacheRepository implements ICalendarCacheRepository {
  calendar: Calendar | null;
  constructor(calendar: Calendar | null = null) {
    this.calendar = calendar;
  }
  async watchCalendar(args: { calendarId: string; eventTypeIds: SelectedCalendarEventTypeIds }) {
    assertCalendarHasDbCredential(this.calendar);
    const { calendarId, eventTypeIds } = args;
    if (typeof this.calendar?.watchCalendar !== ""function"") {
      log.info(
        '[handleWatchCalendar] Skipping watching calendar due to calendar not having ""watchCalendar"" method'
      );
      return;
    }
    await this.calendar?.watchCalendar({ calendarId, eventTypeIds });
  }

  async unwatchCalendar(args: { calendarId: string; eventTypeIds: SelectedCalendarEventTypeIds }) {
    assertCalendarHasDbCredential
---
[Critical] type UserWithCalendars in packages/lib/getConnectedDestinationCalendars.ts:
type UserWithCalendars = Pick<User, ""id"" | ""email""> & {
  allSelectedCalendars: Pick<
    SelectedCalendar,
    ""externalId"" | ""integration"" | ""eventTypeId"" | ""updatedAt"" | ""googleChannelId""
  >[];
  userLevelSelectedCalendars: Pick<
    SelectedCalendar,
    ""externalId"" | ""integration"" | ""eventTypeId"" | ""updatedAt"" | ""googleChannelId""
  >[];
  destinationCalendar: DestinationCalendar | null;
};
---
[Critical] method findMany in packages/lib/server/repository/selectedCalendar.ts:
static async findMany({ where, select, orderBy }: FindManyArgs) {
    return await prisma.selectedCalendar.findMany({ where, select, orderBy });
  }
---
[Critical] method fetchAvailabilityAndSetCache in packages/app-store/googlecalendar/lib/CalendarService.ts:
async fetchAvailabilityAndSetCache(selectedCalendars: IntegrationCalendar[]) {
    this.log.debug(""fetchAvailabilityAndSetCache"", safeStringify({ selectedCalendars }));
    const selectedCalendarsPerEventType = new Map<
      SelectedCalendarEventTypeIds[number],
      IntegrationCalendar[]
    >();

    // TODO: Should be done outside of CalendarService as it is applicable to all Apps' CalendarServices
    selectedCalendars.reduce((acc, selectedCalendar) => {
      const eventTypeId = selectedCalendar.eventTypeId ?? null;
      const mapValue = selectedCalendarsPerEventType.get(eventTypeId);
      if (mapValue) {
        mapValue.push(selectedCalendar);
      } else {
        acc.set(eventTypeId, [selectedCalendar]);
      }
      return acc;
    }, selectedCalendarsPerEventType);

    fo
---
[High] class CalendarCacheRepositoryMock in packages/features/calendar-cache/calendar-cache.repository.mock.ts:
class CalendarCacheRepositoryMock implements ICalendarCacheRepository {
  async watchCalendar() {
    log.info(`Skipping watchCalendar due to calendar-cache being disabled`);
  }
  async upsertCachedAvailability() {
    log.info(`Skipping upsertCachedAvailability due to calendar-cache being disabled`);
  }
  async getCachedAvailability() {
    log.info(`Skipping getCachedAvailability due to calendar-cache being disabled`);
    return null;
  }

  async unwatchCalendar() {
    log.info(`Skipping unwatchCalendar due to calendar-cache being disabled`);
  }

  async deleteManyByCredential() {
    log.info(`Skipping deleteManyByCredential due to calendar-cache being disabled`);
  }

  async getCacheStatusByCredentialIds() {
    log.info(`Skipping getCacheStatusByCredentialIds due to calendar-ca
---
[High] variable connectedCalendarsHandler in packages/trpc/server/routers/viewer/calendars/connectedCalendars.handler.ts:
const connectedCalendarsHandler = async ({ ctx, input }: ConnectedCalendarsOptions) => {
  const { user } = ctx;
  const onboarding = input?.onboarding || false;

  const { connectedCalendars, destinationCalendar } =
    await getConnectedDestinationCalendarsAndEnsureDefaultsInDb({
      user,
      onboarding,
      eventTypeId: input?.eventTypeId ?? null,
      prisma,
    });

  const credentialIds = connectedCalendars.map((cal) => cal.credentialId);
  const cacheRepository = new CalendarCacheRepository();
  const cacheStatuses = await cacheRepository.getCacheStatusByCredentialIds(credentialIds);

  const cacheStatusMap = new Map(cacheStatuses.map((cache) => [cache.credentialId, cache.updatedAt]));

  const enrichedConnectedCalendars = connectedCalendars.map((calendar) => ({
    ...cale
---
[High] method findUnlockedUserForSession in packages/lib/server/repository/user.ts:
async findUnlockedUserForSession({ userId }: { userId: number }) {
    const user = await this.prismaClient.user.findUnique({
      where: {
        id: userId,
        // Locked users can't login
        locked: false,
      },
      select: {
        id: true,
        username: true,
        name: true,
        email: true,
        emailVerified: true,
        bio: true,
        avatarUrl: true,
        timeZone: true,
        weekStart: true,
        startTime: true,
        endTime: true,
        defaultScheduleId: true,
        bufferTime: true,
        theme: true,
        appTheme: true,
        createdDate: true,
        hideBranding: true,
        twoFactorEnabled: true,
        disableImpersonation: true,
        identityProvider: true,
        identityProviderId: true,
        b
---
[High] method getCacheStatusByCredentialIds in packages/features/calendar-cache/calendar-cache.repository.mock.ts:
async getCacheStatusByCredentialIds() {
    log.info(`Skipping getCacheStatusByCredentialIds due to calendar-cache being disabled`);
    return [];
  }
---
[High] method updateManyByCredentialId in packages/lib/server/repository/selectedCalendar.ts:
static async updateManyByCredentialId(credentialId: number, data: Prisma.SelectedCalendarUpdateInput) {
    return await prisma.selectedCalendar.updateMany({
      where: { credentialId },
      data,
    });
  }
---
[High] variable calendarsRouter in packages/trpc/server/routers/viewer/calendars/_router.tsx:
const calendarsRouter = router({
  connectedCalendars: authedProcedure.input(ZConnectedCalendarsInputSchema).query(async ({ ctx, input }) => {
    const { connectedCalendarsHandler } = await import(""./connectedCalendars.handler"");

    return connectedCalendarsHandler({ ctx, input });
  }),

  setDestinationCalendar: authedProcedure
    .input(ZSetDestinationCalendarInputSchema)
    .mutation(async ({ ctx, input }) => {
      const { setDestinationCalendarHandler } = await import(""./setDestinationCalendar.handler"");

      return setDestinationCalendarHandler({ ctx, input });
    }),

  deleteCache: authedProcedure
    .input(z.object({ credentialId: z.number() }))
    .mutation(async ({ ctx, input }) => {
      const { deleteCacheHandler } = await import(""./deleteCache.handler"");
      re
---
[High] method getCacheStatusByCredentialIds in packages/features/calendar-cache/calendar-cache.repository.ts:
async getCacheStatusByCredentialIds(credentialIds: number[]) {
    const cacheStatuses = await prisma.calendarCache.groupBy({
      by: [""credentialId""],
      where: {
        credentialId: { in: credentialIds },
      },
      _max: {
        updatedAt: true,
      },
    });

    return cacheStatuses.map((cache) => ({
      credentialId: cache.credentialId,
      updatedAt: cache._max.updatedAt,
    }));
  }
---
[High] type DeleteCacheOptions in packages/trpc/server/routers/viewer/calendars/deleteCache.handler.ts:
type DeleteCacheOptions = {
  ctx: {
    user: NonNullable<TrpcSessionUser>;
  };
  input: {
    credentialId: number;
  };
};
---
[High] variable deleteCacheHandler in packages/trpc/server/routers/viewer/calendars/deleteCache.handler.ts:
const deleteCacheHandler = async ({ ctx, input }: DeleteCacheOptions) => {
  const { user } = ctx;
  const { credentialId } = input;

  const credential = await prisma.credential.findFirst({
    where: {
      id: credentialId,
      userId: user.id,
    },
  });

  if (!credential) {
    throw new Error(""Credential not found or access denied"");
  }

  await prisma.calendarCache.deleteMany({
    where: { credentialId },
  });

  return { success: true };
};","[Medium] interface CredentialActionsDropdownProps in packages/features/apps/components/CredentialActionsDropdown.tsx:
interface CredentialActionsDropdownProps {
  credentialId: number;
  integrationType: string;
  cacheUpdatedAt?: Date | null;
  onSuccess?: () => void;
  delegationCredentialId?: string | null;
  disableConnectionModification?: boolean;
}
---
[Medium] function CredentialActionsDropdown in packages/features/apps/components/CredentialActionsDropdown.tsx:
function CredentialActionsDropdown({
  credentialId,
  integrationType,
  cacheUpdatedAt,
  onSuccess,
  delegationCredentialId,
  disableConnectionModification,
}: CredentialActionsDropdownProps) {
  const { t } = useLocale();
  const [dropdownOpen, setDropdownOpen] = useState(false);
  const [deleteModalOpen, setDeleteModalOpen] = useState(false);
  const [disconnectModalOpen, setDisconnectModalOpen] = useState(false);

  const deleteCacheMutation = trpc.viewer.calendars.deleteCache.useMutatio
---
[Medium] variable ConnectedCalendarList in packages/platform/atoms/selected-calendars/wrappers/SelectedCalendarsSettingsWebWrapper.tsx:
const ConnectedCalendarList = ({
  fromOnboarding = false,
  scope,
  items,
  disableConnectionModification,
  eventTypeId,
  onChanged,
  destinationCalendarId,
  isDisabled,
}: {
  fromOnboarding?: boolean;
  scope: SelectedCalendarSettingsScope;
  items: RouterOutputs[""viewer""][""calendars""][""connectedCalendars""][""connectedCalendars""];
  disableConnectionModification?: boolean;
  eventTypeId: number | null;
  onChanged?: () => unknown | Promise<unknown>;
  destinationCalendarId?: string;
  is
---
[Medium] chunk lines 2201-2220 in packages/prisma/schema.prisma:

enum BillingPeriod {
  MONTHLY
  ANNUALLY
}

model OrganizationOnboarding {
  // TODO: Use uuid for id
  id String @id @default(uuid())

  // User who started the onboarding. It is different from orgOwnerEmail in case Cal.com admin is doing the onboarding for someone else.
  createdBy   User     @relation(""CreatedOrganizationOnboardings"", fields: [createdById], references: [id], onDelete: Cascade)
  createdById Int
  createdAt   DateTime @default(now())

  // We keep the email only here and don
---
[Medium] chunk lines 2241-2260 in packages/prisma/schema.prisma:

  // Set when payment intent is there.
  stripeCustomerId         String? @unique
  // TODO: Can we make it required
  stripeSubscriptionId     String?
  stripeSubscriptionItemId String?

  /// @zod.custom(imports.orgOnboardingInvitedMembersSchema)
  invitedMembers Json @default(""[]"")

  /// @zod.custom(imports.orgOnboardingTeamsSchema)
  teams Json @default(""[]"")

  // Completion status
  isComplete Boolean @default(false)

  @@index([orgOwnerEmail])
  @@index([stripeCustomerId])
}

---
[Medium] chunk lines 2401-2406 in packages/prisma/schema.prisma:

  @@unique([roleId, resource, action])
  @@index([roleId])
  // TODO: come back to this with indexs.
  @@index([action])
}
---
[Medium] chunk lines 2261-2280 in packages/prisma/schema.prisma:
enum IncompleteBookingActionType {
  SALESFORCE
}

model App_RoutingForms_IncompleteBookingActions {
  id           Int                         @id @default(autoincrement())
  form         App_RoutingForms_Form       @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId       String
  actionType   IncompleteBookingActionType
  data         Json
  enabled      Boolean                     @default(true)
  credentialId Int?
}

model InternalNotePreset {
  id                 Int 
---
[Medium] chunk lines 1721-1740 in packages/prisma/schema.prisma:
  userId       Int?
  credential   Credential? @relation(fields: [credentialId], references: [id], onDelete: Cascade)

  @@id([credentialId, key])
  @@unique([credentialId, key])
  @@index([userId, key])
}

enum RedirectType {
  UserEventType @map(""user-event-type"")
  TeamEventType @map(""team-event-type"")
  User          @map(""user"")
  Team          @map(""team"")
}

model TempOrgRedirect {
  id        Int          @id @default(autoincrement())
  // Better would be to have fromOrgId and toOrgId as
---
[Medium] chunk lines 1741-1760 in packages/prisma/schema.prisma:
  fromOrgId Int
  type      RedirectType
  // It doesn't have any query params
  toUrl     String
  enabled   Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@unique([from, type, fromOrgId])
}

model Avatar {
  // e.g. NULL(0), organization ID or team logo
  teamId    Int    @default(0)
  // Avatar, NULL(0) if team logo
  userId    Int    @default(0)
  // base64 string
  data      String
  // different every time to pop the cache.
  ob
---
[Medium] chunk lines 2181-2200 in packages/prisma/schema.prisma:
  CRITICAL
}

model Watchlist {
  id          String            @id @unique @default(cuid())
  type        WatchlistType
  // The identifier of the Watchlisted entity (email or domain)
  value       String
  description String?
  createdAt   DateTime          @default(now())
  createdBy   User              @relation(""CreatedWatchlists"", onDelete: Cascade, fields: [createdById], references: [id])
  createdById Int
  updatedAt   DateTime          @updatedAt
  updatedBy   User?             @relatio
---
[Medium] object scripts in apps/web/package.json:
  ""scripts"": {
    ""analyze"": ""ANALYZE=true next build"",
    ""analyze:server"": ""BUNDLE_ANALYZE=server next build"",
    ""analyze:browser"": ""BUNDLE_ANALYZE=browser next build"",
    ""clean"": ""rm -rf .turbo && rm -rf node_modules && rm -rf .next"",
    ""dev"": ""yarn copy-static && next dev --turbopack"",
    ""dev:cron"": ""npx tsx cron-tester.ts"",
    ""dev-https"": ""NODE_TLS_REJECT_UNAUTHORIZED=0 next dev --experimental-https"",
    ""dx"": ""yarn dev"",
    ""test-codegen"": ""yarn playwright codegen http://loca
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: CalendarAuth;
  private log: typeof logger;
  private credential: CredentialForCalendarServiceWithEmail;

  constructor(credential: CredentialForCalendarServiceWithEmail) {
    this.integrationName = ""google_calendar"";
    this.credential = credential;
    this.auth = new CalendarAuth(credential);
    this.log = log.getSubLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  public getCrede
---
[Medium] chunk lines 2161-2180 in packages/prisma/schema.prisma:
  createdBy      Int
  updatedAt      DateTime                     @updatedAt
  updatedBy      Int?
  creator        User                         @relation(""CreatedEventTypeTranslations"", fields: [createdBy], references: [id])
  updater        User?                        @relation(""UpdatedEventTypeTranslations"", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@unique([eventTypeId, field, targetLocale])
  @@index([eventTypeId, field, targetLocale])
}

enum WatchlistType {
  EMAIL
 
---
[Medium] chunk lines 1861-1880 in packages/prisma/schema.prisma:
  createdAt DateTime @default(now())
  expiresAt DateTime

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int
}

model DSyncData {
  id               Int                     @id @default(autoincrement())
  directoryId      String                  @unique
  tenant           String
  organ
---
[Medium] chunk lines 1941-1960 in packages/prisma/schema.prisma:
  REVIEW_NEEDED
}

model ManagedOrganization {
  managedOrganizationId Int  @unique
  managedOrganization   Team @relation(""ManagedOrganization"", fields: [managedOrganizationId], references: [id], onDelete: Cascade)

  managerOrganizationId Int
  managerOrganization   Team @relation(""ManagerOrganization"", fields: [managerOrganizationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([managerOrganizationId, managedOrganizationId])
  @@index([managerOrganiz
---
[Medium] chunk lines 2141-2160 in packages/prisma/schema.prisma:
  /// @zod.custom(imports.serviceAccountKeySchema)
  defaultServiceAccountKey Json
  createdAt                DateTime               @default(now())
  updatedAt                DateTime               @updatedAt
  enabled                  Boolean                @default(false)
  delegationCredentials    DelegationCredential[]
  domainWideDelegations    DomainWideDelegation[]

  @@unique([slug])
}

model EventTypeTranslation {
  uid            String                       @id @default(cuid())
  eve
---
[Medium] chunk lines 1901-1920 in packages/prisma/schema.prisma:
  verificationTokens VerificationToken[]
  eventTypes         EventType[]

  @@unique([email])
  @@unique([userId, email])
  @@index([userId])
}

// Needed to store tasks that need to be processed by a background worker or Tasker
model Task {
  id                  String    @id @unique @default(uuid())
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  // The time at which the task should be executed
  scheduledAt         DateTime  @default(now())
  // T
---
[Medium] chunk lines 2281-2300 in packages/prisma/schema.prisma:

  createdAt           DateTime              @default(now())
  BookingInternalNote BookingInternalNote[]

  @@unique([teamId, name])
  @@index([teamId])
}

enum FilterSegmentScope {
  USER
  TEAM
}

model FilterSegment {
  id               Int                           @id @default(autoincrement())
  name             String
  // Identifies which data table this segment belongs to (e.g. ""organization_members"", ""team_members"", ""bookings"", etc.)
  tableIdentifier  String
  scope            FilterSe
---
[Medium] chunk lines 2021-2040 in packages/prisma/schema.prisma:
  isLocked         Boolean           @default(false)

  @@unique([teamId, slug])
  @@index([teamId])
}

model AttributeToUser {
  id String @id @default(uuid())

  // This is the membership of the organization
  member Membership @relation(fields: [memberId], references: [id], onDelete: Cascade)

  // This is the membership id of the organization
  memberId Int

  attributeOption   AttributeOption @relation(fields: [attributeOptionId], references: [id], onDelete: Cascade)
  attributeOptionId Str
---
[Medium] chunk lines 2061-2080 in packages/prisma/schema.prisma:
  RR_REASSIGNED
  REROUTED
  SALESFORCE_ASSIGNMENT
}

model AssignmentReason {
  id           Int                  @id @unique @default(autoincrement())
  createdAt    DateTime             @default(now())
  bookingId    Int
  booking      Booking              @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  reasonEnum   AssignmentReasonEnum
  reasonString String

  @@index([bookingId])
}

enum EventTypeAutoTranslatedField {
  DESCRIPTION
  TITLE
}
---
[Medium] chunk lines 2361-2380 in packages/prisma/schema.prisma:
}

model WorkflowOptOutContact {
  id        Int                 @id @default(autoincrement())
  type      WorkflowContactType
  value     String
  optedOut  Boolean
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  @@unique([type, value])
}

enum RoleType {
  SYSTEM
  CUSTOM
}

model Role {
  id          String           @id @default(cuid())
---
[Medium] chunk lines 1921-1940 in packages/prisma/schema.prisma:
  payload             String
  // The number of times the task has been attempted
  attempts            Int       @default(0)
  // The maximum number of times the task can be attempted
  maxAttempts         Int       @default(3)
  lastError           String?
  lastFailedAttemptAt DateTime?
  referenceUid        String?

  // unique index on referenceUid,type to avoid duplicate tasks
  @@unique([referenceUid, type])
  // for finding succeeded tasks
  @@index([succeededAt])
  // for finding tasks 
---
[Medium] chunk lines 2381-2400 in packages/prisma/schema.prisma:
  name        String
  color       String?
  description String?
  teamId      Int? // null for global roles
  team        Team?            @relation(fields: [teamId], references: [id], onDelete: Cascade)
  permissions RolePermission[]
  memberships Membership[]
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  type        RoleType         @default(CUSTOM)

  @@unique([name, teamId])
  @@index([teamId])
}

model RolePermission {
  id        String   @id @
---
[Medium] chunk lines 2221-2240 in packages/prisma/schema.prisma:
  updatedAt DateTime @updatedAt
  // TODO: updatedBy to be added when we support marking updatedBy using webhook too, as webhook also updates it

  // Set after organization payment is done and the organization is created
  organizationId Int?  @unique
  organization   Team? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  billingPeriod BillingPeriod
  pricePerSeat  Float
  seats         Int

  isPlatform Boolean @default(false)

  // Organization info
  name          
---
[Medium] chunk lines 1881-1900 in packages/prisma/schema.prisma:
}

model DSyncTeamGroupMapping {
  id             Int       @id @default(autoincrement())
  organizationId Int
  teamId         Int
  team           Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  directoryId    String
  directory      DSyncData @relation(fields: [directoryId], references: [directoryId], onDelete: Cascade)
  groupName      String

  @@unique([teamId, groupName])
}

model SecondaryEmail {
  id                 Int                 @id @default(autoincre
---
[Medium] chunk lines 2121-2140 in packages/prisma/schema.prisma:
  domain              String
  selectedCalendars   SelectedCalendar[]
  destinationCalendar DestinationCalendar[]
  bookingReferences   BookingReference[]
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt

  // Should be fair to assume that one domain can be only on one workspace platform at a time. So, one can't have two different workspace platforms for the same domain
  // Because we don't know which domain the organization migh
---
[Medium] chunk lines 2001-2020 in packages/prisma/schema.prisma:
  id String @id @default(uuid())

  // This is organization
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)

  // This is organizationId
  teamId Int

  type AttributeType

  name    String
  slug    String
  enabled Boolean @default(true)

  usersCanEditRelation Boolean @default(false)

  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  options          AttributeOption[]
  isWeightsEnabled Boolean           @defaul
---
[Medium] chunk lines 1781-1800 in packages/prisma/schema.prisma:
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([uuid])
  @@index([userId])
  @@index([toUserId])
  @@index([start, end])
}

model OutOfOfficeReason {
  id      Int     @id @default(autoincrement())
  emoji   String
  reason  String  @unique
  enabled Boolean @default(true)
  userId  Int?
  user    User?   @relation(fields: [userId], references: [id], onDelete: Cascade)

  entries OutOfOfficeEntry[]
}

---
[Medium] chunk lines 2341-2360 in packages/prisma/schema.prisma:

  notePreset   InternalNotePreset? @relation(fields: [notePresetId], references: [id], onDelete: Cascade)
  notePresetId Int?
  text         String?

  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId Int

  createdBy   User @relation(fields: [createdById], references: [id])
  createdById Int

  createdAt DateTime @default(now())

  @@unique([bookingId, notePresetId])
  @@index([bookingId])
}

enum WorkflowContactType {
  PHONE
  EMAIL
---
[Medium] chunk lines 1841-1860 in packages/prisma/schema.prisma:
}

model AccessToken {
  id Int @id @default(autoincrement())

  secret    String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int
}

model RefreshToken {
  id Int @id @default(autoincrement())

  secret    String   @
---
[Medium] chunk lines 2101-2120 in packages/prisma/schema.prisma:
  updatedAt           DateTime              @updatedAt
  credentials         Credential[]

  // Should be fair to assume that one domain can be only on one workspace platform at a time. So, one can't have two different workspace platforms for the same domain
  // Because we don't know which domain the organization might have, we couldn't make ""domain"" unique here as that would prevent an actual owner of the domain to be unable to use that domain if it is used by someone else.
  @@unique([organiz
---
[Medium] chunk lines 2301-2320 in packages/prisma/schema.prisma:
  activeFilters    Json?
  sorting          Json?
  columnVisibility Json?
  columnSizing     Json?
  perPage          Int
  searchTerm       String?                       @db.Text
  createdAt        DateTime                      @default(now())
  updatedAt        DateTime                      @updatedAt
  // Creator of the segment
  user             User                          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId           Int
  // Team scope - optional, o
---
[Medium] chunk lines 1961-1980 in packages/prisma/schema.prisma:
  subscriptionId String?
  priceId        String?
  plan           String  @default(""none"")

  billingCycleStart Int?
  billingCycleEnd   Int?
  overdue           Boolean? @default(false)

  // note(Lauris): in case of a platform managed organization's billing record this field points to the manager organization's billing record.
  managerBillingId Int?
  managerBilling   PlatformBilling?  @relation(""PlatformManagedBilling"", fields: [managerBillingId], references: [id])
  // note(Lauris): in cas
---
[Medium] chunk lines 2041-2060 in packages/prisma/schema.prisma:
  // We don't intentionally delete assignments on deletion of a user/directory sync
  createdAt        DateTime   @default(now())
  createdById      Int?
  createdBy        User?      @relation(""createdBy"", fields: [createdById], references: [id], onDelete: SetNull)
  createdByDSyncId String?
  createdByDSync   DSyncData? @relation(""createdByDSync"", fields: [createdByDSyncId], references: [directoryId], onDelete: SetNull)

  updatedAt        DateTime?  @updatedAt
  updatedBy        User?      @r
---
[Medium] chunk lines 1701-1720 in packages/prisma/schema.prisma:
  userName       String?
  userUsername   String?
  ratingFeedback String?
  rating         Int?
  noShowHost     Boolean?
  isTeamBooking  Boolean
  timeStatus     String? // this is the addition on top of BookingDenormalized
}

model CalendarCache {
  // To be made required in a followup
  id String? @default(uuid())

  // The key would be the unique URL that is requested by the user
  key          String
  value        Json
  expiresAt    DateTime
  // Provide an initial value for legacy rows
---
[Medium] chunk lines 1821-1840 in packages/prisma/schema.prisma:
  bookingRescheduleRedirectUri String?
  areEmailsEnabled             Boolean @default(false)
  areDefaultEventTypesEnabled  Boolean @default(true)
  areCalendarEventsEnabled     Boolean @default(true)

  createdAt DateTime @default(now())
}

model PlatformAuthorizationToken {
  id String @id @default(cuid())

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDe
---
[Medium] chunk lines 1801-1820 in packages/prisma/schema.prisma:
// Platform
model PlatformOAuthClient {
  id             String   @id @default(cuid())
  name           String
  secret         String
  permissions    Int
  users          User[]
  logo           String?
  redirectUris   String[]
  organizationId Int
  organization   Team     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  teams          Team[]   @relation(""CreatedByOAuthClient"")

  accessTokens        AccessToken[]
  refreshToken        RefreshToken[]
  authorization
---
[Medium] chunk lines 2081-2100 in packages/prisma/schema.prisma:

model DelegationCredential {
  id                  String                @id @default(uuid())
  workspacePlatform   WorkspacePlatform     @relation(fields: [workspacePlatformId], references: [id], onDelete: Cascade)
  workspacePlatformId Int
  // Provides possibility to have different service accounts for different organizations if the need arises, but normally they should be the same
  /// @zod.custom(imports.serviceAccountKeySchema)
  serviceAccountKey   Json
  enabled             Boolean    
---
[Medium] chunk lines 1761-1780 in packages/prisma/schema.prisma:

  isBanner Boolean @default(false)

  @@unique([teamId, userId, isBanner])
  @@map(name: ""avatars"")
}

model OutOfOfficeEntry {
  id       Int                @id @default(autoincrement())
  uuid     String             @unique
  start    DateTime
  end      DateTime
  notes    String?
  userId   Int
  user     User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  toUserId Int?
  toUser   User?              @relation(name: ""toUser"", fields: [toUserId], references: 
---
[Medium] chunk lines 1981-2000 in packages/prisma/schema.prisma:
  SINGLE_SELECT
  MULTI_SELECT
}

model AttributeOption {
  id            String            @id @default(uuid())
  attribute     Attribute         @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  attributeId   String
  value         String
  slug          String
  isGroup       Boolean           @default(false)
  // It is a list of AttributeOptions ids that are contained in the group option
  // You could think of a person having the group option to actually have all the o
---
[Medium] chunk lines 2321-2340 in packages/prisma/schema.prisma:
}

model UserFilterSegmentPreference {
  id              Int      @id @default(autoincrement())
  userId          Int
  tableIdentifier String
  segmentId       Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user    User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  segment FilterSegment @relation(fields: [segmentId], references: [id], onDelete: Cascade)

  @@unique([userId, tableIdentifier])
  @@index([userId])
  @@index([se","SelectedCalendarRepository (Critical), UserRepository (Critical), ICalendarCacheRepository (Critical), CalendarCacheRepository (Critical), UserWithCalendars (Critical), findMany (Critical), fetchAvailabilityAndSetCache (Critical), CalendarCacheRepositoryMock (High), connectedCalendarsHandler (High), findUnlockedUserForSession (High), getCacheStatusByCredentialIds (High), updateManyByCredentialId (High), calendarsRouter (High), getCacheStatusByCredentialIds (High), DeleteCacheOptions (High), deleteCacheHandler (High), CredentialActionsDropdownProps (Medium), CredentialActionsDropdown (Medium), ConnectedCalendarList (Medium), lines 2201-2220 (Medium), lines 2241-2260 (Medium), lines 2401-2406 (Medium), lines 2261-2280 (Medium), lines 1721-1740 (Medium), lines 1741-1760 (Medium), lines 2181-2200 (Medium), scripts (Medium), GoogleCalendarService (Medium), lines 2161-2180 (Medium), lines 1861-1880 (Medium), lines 1941-1960 (Medium), lines 2141-2160 (Medium), lines 1901-1920 (Medium), lines 2281-2300 (Medium), lines 2021-2040 (Medium), lines 2061-2080 (Medium), lines 2361-2380 (Medium), lines 1921-1940 (Medium), lines 2381-2400 (Medium), lines 2221-2240 (Medium), lines 1881-1900 (Medium), lines 2121-2140 (Medium), lines 2001-2020 (Medium), lines 1781-1800 (Medium), lines 2341-2360 (Medium), lines 1841-1860 (Medium), lines 2101-2120 (Medium), lines 2301-2320 (Medium), lines 1961-1980 (Medium), lines 2041-2060 (Medium), lines 1701-1720 (Medium), lines 1821-1840 (Medium), lines 1801-1820 (Medium), lines 2081-2100 (Medium), lines 1761-1780 (Medium), lines 1981-2000 (Medium), lines 2321-2340 (Medium), cache_status (Low), cache_last_updated (Low), delete_cached_data (Low), cache_deleted_successfully (Low), error_deleting_cache (Low), confirm_delete_cache (Low), yes_delete_cache (Low), lines 1-9 (Low), lines 2401-2408 (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-79 (Low), SelectedCalendarsSettingsWebWrapper (Low)",match,'cache' matches HC entity 'calendarcacherepository'
cal_dot_com,11,feat: add calendar cache status and actions (#22532),logic: macOS-specific sed syntax with empty string after -i flag will fail on Linux systems,Low,71,16,41,"class::SelectedCalendarRepository (packages/lib/server/repository/selectedCalendar.ts) [Critical, score=1.00] | class::UserRepository (packages/lib/server/repository/user.ts) [Critical, score=1.00] | interface::ICalendarCacheRepository (packages/features/calendar-cache/calendar-cache.repository.interface.ts) [Critical, score=0.87] | class::CalendarCacheRepository (packages/features/calendar-cache/calendar-cache.repository.ts) [Critical, score=0.85] | type::UserWithCalendars (packages/lib/getConnectedDestinationCalendars.ts) [Critical, score=0.80] | method::findMany (packages/lib/server/repository/selectedCalendar.ts) [Critical, score=0.80] | method::fetchAvailabilityAndSetCache (packages/app-store/googlecalendar/lib/CalendarService.ts) [Critical, score=0.73] | class::CalendarCacheRepositoryMock (packages/features/calendar-cache/calendar-cache.repository.mock.ts) [High, score=0.69] | variable::connectedCalendarsHandler (packages/trpc/server/routers/viewer/calendars/connectedCalendars.handler.ts) [High, score=0.68] | method::findUnlockedUserForSession (packages/lib/server/repository/user.ts) [High, score=0.65] | method::getCacheStatusByCredentialIds (packages/features/calendar-cache/calendar-cache.repository.mock.ts) [High, score=0.63] | method::updateManyByCredentialId (packages/lib/server/repository/selectedCalendar.ts) [High, score=0.63] | variable::calendarsRouter (packages/trpc/server/routers/viewer/calendars/_router.tsx) [High, score=0.59] | method::getCacheStatusByCredentialIds (packages/features/calendar-cache/calendar-cache.repository.ts) [High, score=0.53] | type::DeleteCacheOptions (packages/trpc/server/routers/viewer/calendars/deleteCache.handler.ts) [High, score=0.53] | variable::deleteCacheHandler (packages/trpc/server/routers/viewer/calendars/deleteCache.handler.ts) [High, score=0.53]","[Critical] class SelectedCalendarRepository in packages/lib/server/repository/selectedCalendar.ts:
class SelectedCalendarRepository {
  private static async findConflicting(data: {
    userId: number;
    integration: string;
    externalId: string;
    eventTypeId?: number | null;
  }) {
    // Because userId_integration_externalId_eventTypeId is a unique constraint but with eventTypeId being nullable,
    // it allows for multiple entries with the same (userId, integration, externalId) with eventTypeId=null in DB.
    // We restrict it at app level by ensuring that an entry doesn't exist already before creating a new one
    return await SelectedCalendarRepository.findFirst({
      where: {
        userId: data.userId,
        integration: data.integration,
        externalId: data.externalId,
        eventTypeId: data.eventTypeId || null,
      },
    });
  }

  static async findById
---
[Critical] class UserRepository in packages/lib/server/repository/user.ts:
class UserRepository {
  constructor(private prismaClient: PrismaClient) {}

  async findTeamsByUserId({ userId }: { userId: UserType[""id""] }) {
    const teamMemberships = await this.prismaClient.membership.findMany({
      where: {
        userId: userId,
      },
      include: {
        team: {
          select: teamSelect,
        },
      },
    });

    const acceptedTeamMemberships = teamMemberships.filter((membership) => membership.accepted);
    const pendingTeamMemberships = teamMemberships.filter((membership) => !membership.accepted);

    return {
      teams: acceptedTeamMemberships.map((membership) => membership.team),
      memberships: teamMemberships,
      acceptedTeamMemberships,
      pendingTeamMemberships,
    };
  }

  async findOrganizations({ userId }: { userId: U
---
[Critical] interface ICalendarCacheRepository in packages/features/calendar-cache/calendar-cache.repository.interface.ts:
interface ICalendarCacheRepository {
  watchCalendar(args: { calendarId: string; eventTypeIds: SelectedCalendarEventTypeIds }): Promise<any>;
  unwatchCalendar(args: { calendarId: string; eventTypeIds: SelectedCalendarEventTypeIds }): Promise<any>;
  upsertCachedAvailability({
    credentialId,
    userId,
    args,
    value,
  }: {
    credentialId: number;
    userId: number | null;
    args: FreeBusyArgs;
    value: Prisma.JsonNullValueInput | Prisma.InputJsonValue;
  }): Promise<void>;
  getCachedAvailability({
    credentialId,
    userId,
    args,
  }: {
    credentialId: number;
    userId: number | null;
    args: FreeBusyArgs;
  }): Promise<CalendarCache | null>;
  getCacheStatusByCredentialIds(
    credentialIds: number[]
  ): Promise<{ credentialId: number; updatedAt: Date | n
---
[Critical] class CalendarCacheRepository in packages/features/calendar-cache/calendar-cache.repository.ts:
class CalendarCacheRepository implements ICalendarCacheRepository {
  calendar: Calendar | null;
  constructor(calendar: Calendar | null = null) {
    this.calendar = calendar;
  }
  async watchCalendar(args: { calendarId: string; eventTypeIds: SelectedCalendarEventTypeIds }) {
    assertCalendarHasDbCredential(this.calendar);
    const { calendarId, eventTypeIds } = args;
    if (typeof this.calendar?.watchCalendar !== ""function"") {
      log.info(
        '[handleWatchCalendar] Skipping watching calendar due to calendar not having ""watchCalendar"" method'
      );
      return;
    }
    await this.calendar?.watchCalendar({ calendarId, eventTypeIds });
  }

  async unwatchCalendar(args: { calendarId: string; eventTypeIds: SelectedCalendarEventTypeIds }) {
    assertCalendarHasDbCredential
---
[Critical] type UserWithCalendars in packages/lib/getConnectedDestinationCalendars.ts:
type UserWithCalendars = Pick<User, ""id"" | ""email""> & {
  allSelectedCalendars: Pick<
    SelectedCalendar,
    ""externalId"" | ""integration"" | ""eventTypeId"" | ""updatedAt"" | ""googleChannelId""
  >[];
  userLevelSelectedCalendars: Pick<
    SelectedCalendar,
    ""externalId"" | ""integration"" | ""eventTypeId"" | ""updatedAt"" | ""googleChannelId""
  >[];
  destinationCalendar: DestinationCalendar | null;
};
---
[Critical] method findMany in packages/lib/server/repository/selectedCalendar.ts:
static async findMany({ where, select, orderBy }: FindManyArgs) {
    return await prisma.selectedCalendar.findMany({ where, select, orderBy });
  }
---
[Critical] method fetchAvailabilityAndSetCache in packages/app-store/googlecalendar/lib/CalendarService.ts:
async fetchAvailabilityAndSetCache(selectedCalendars: IntegrationCalendar[]) {
    this.log.debug(""fetchAvailabilityAndSetCache"", safeStringify({ selectedCalendars }));
    const selectedCalendarsPerEventType = new Map<
      SelectedCalendarEventTypeIds[number],
      IntegrationCalendar[]
    >();

    // TODO: Should be done outside of CalendarService as it is applicable to all Apps' CalendarServices
    selectedCalendars.reduce((acc, selectedCalendar) => {
      const eventTypeId = selectedCalendar.eventTypeId ?? null;
      const mapValue = selectedCalendarsPerEventType.get(eventTypeId);
      if (mapValue) {
        mapValue.push(selectedCalendar);
      } else {
        acc.set(eventTypeId, [selectedCalendar]);
      }
      return acc;
    }, selectedCalendarsPerEventType);

    fo
---
[High] class CalendarCacheRepositoryMock in packages/features/calendar-cache/calendar-cache.repository.mock.ts:
class CalendarCacheRepositoryMock implements ICalendarCacheRepository {
  async watchCalendar() {
    log.info(`Skipping watchCalendar due to calendar-cache being disabled`);
  }
  async upsertCachedAvailability() {
    log.info(`Skipping upsertCachedAvailability due to calendar-cache being disabled`);
  }
  async getCachedAvailability() {
    log.info(`Skipping getCachedAvailability due to calendar-cache being disabled`);
    return null;
  }

  async unwatchCalendar() {
    log.info(`Skipping unwatchCalendar due to calendar-cache being disabled`);
  }

  async deleteManyByCredential() {
    log.info(`Skipping deleteManyByCredential due to calendar-cache being disabled`);
  }

  async getCacheStatusByCredentialIds() {
    log.info(`Skipping getCacheStatusByCredentialIds due to calendar-ca
---
[High] variable connectedCalendarsHandler in packages/trpc/server/routers/viewer/calendars/connectedCalendars.handler.ts:
const connectedCalendarsHandler = async ({ ctx, input }: ConnectedCalendarsOptions) => {
  const { user } = ctx;
  const onboarding = input?.onboarding || false;

  const { connectedCalendars, destinationCalendar } =
    await getConnectedDestinationCalendarsAndEnsureDefaultsInDb({
      user,
      onboarding,
      eventTypeId: input?.eventTypeId ?? null,
      prisma,
    });

  const credentialIds = connectedCalendars.map((cal) => cal.credentialId);
  const cacheRepository = new CalendarCacheRepository();
  const cacheStatuses = await cacheRepository.getCacheStatusByCredentialIds(credentialIds);

  const cacheStatusMap = new Map(cacheStatuses.map((cache) => [cache.credentialId, cache.updatedAt]));

  const enrichedConnectedCalendars = connectedCalendars.map((calendar) => ({
    ...cale
---
[High] method findUnlockedUserForSession in packages/lib/server/repository/user.ts:
async findUnlockedUserForSession({ userId }: { userId: number }) {
    const user = await this.prismaClient.user.findUnique({
      where: {
        id: userId,
        // Locked users can't login
        locked: false,
      },
      select: {
        id: true,
        username: true,
        name: true,
        email: true,
        emailVerified: true,
        bio: true,
        avatarUrl: true,
        timeZone: true,
        weekStart: true,
        startTime: true,
        endTime: true,
        defaultScheduleId: true,
        bufferTime: true,
        theme: true,
        appTheme: true,
        createdDate: true,
        hideBranding: true,
        twoFactorEnabled: true,
        disableImpersonation: true,
        identityProvider: true,
        identityProviderId: true,
        b
---
[High] method getCacheStatusByCredentialIds in packages/features/calendar-cache/calendar-cache.repository.mock.ts:
async getCacheStatusByCredentialIds() {
    log.info(`Skipping getCacheStatusByCredentialIds due to calendar-cache being disabled`);
    return [];
  }
---
[High] method updateManyByCredentialId in packages/lib/server/repository/selectedCalendar.ts:
static async updateManyByCredentialId(credentialId: number, data: Prisma.SelectedCalendarUpdateInput) {
    return await prisma.selectedCalendar.updateMany({
      where: { credentialId },
      data,
    });
  }
---
[High] variable calendarsRouter in packages/trpc/server/routers/viewer/calendars/_router.tsx:
const calendarsRouter = router({
  connectedCalendars: authedProcedure.input(ZConnectedCalendarsInputSchema).query(async ({ ctx, input }) => {
    const { connectedCalendarsHandler } = await import(""./connectedCalendars.handler"");

    return connectedCalendarsHandler({ ctx, input });
  }),

  setDestinationCalendar: authedProcedure
    .input(ZSetDestinationCalendarInputSchema)
    .mutation(async ({ ctx, input }) => {
      const { setDestinationCalendarHandler } = await import(""./setDestinationCalendar.handler"");

      return setDestinationCalendarHandler({ ctx, input });
    }),

  deleteCache: authedProcedure
    .input(z.object({ credentialId: z.number() }))
    .mutation(async ({ ctx, input }) => {
      const { deleteCacheHandler } = await import(""./deleteCache.handler"");
      re
---
[High] method getCacheStatusByCredentialIds in packages/features/calendar-cache/calendar-cache.repository.ts:
async getCacheStatusByCredentialIds(credentialIds: number[]) {
    const cacheStatuses = await prisma.calendarCache.groupBy({
      by: [""credentialId""],
      where: {
        credentialId: { in: credentialIds },
      },
      _max: {
        updatedAt: true,
      },
    });

    return cacheStatuses.map((cache) => ({
      credentialId: cache.credentialId,
      updatedAt: cache._max.updatedAt,
    }));
  }
---
[High] type DeleteCacheOptions in packages/trpc/server/routers/viewer/calendars/deleteCache.handler.ts:
type DeleteCacheOptions = {
  ctx: {
    user: NonNullable<TrpcSessionUser>;
  };
  input: {
    credentialId: number;
  };
};
---
[High] variable deleteCacheHandler in packages/trpc/server/routers/viewer/calendars/deleteCache.handler.ts:
const deleteCacheHandler = async ({ ctx, input }: DeleteCacheOptions) => {
  const { user } = ctx;
  const { credentialId } = input;

  const credential = await prisma.credential.findFirst({
    where: {
      id: credentialId,
      userId: user.id,
    },
  });

  if (!credential) {
    throw new Error(""Credential not found or access denied"");
  }

  await prisma.calendarCache.deleteMany({
    where: { credentialId },
  });

  return { success: true };
};","[Medium] interface CredentialActionsDropdownProps in packages/features/apps/components/CredentialActionsDropdown.tsx:
interface CredentialActionsDropdownProps {
  credentialId: number;
  integrationType: string;
  cacheUpdatedAt?: Date | null;
  onSuccess?: () => void;
  delegationCredentialId?: string | null;
  disableConnectionModification?: boolean;
}
---
[Medium] function CredentialActionsDropdown in packages/features/apps/components/CredentialActionsDropdown.tsx:
function CredentialActionsDropdown({
  credentialId,
  integrationType,
  cacheUpdatedAt,
  onSuccess,
  delegationCredentialId,
  disableConnectionModification,
}: CredentialActionsDropdownProps) {
  const { t } = useLocale();
  const [dropdownOpen, setDropdownOpen] = useState(false);
  const [deleteModalOpen, setDeleteModalOpen] = useState(false);
  const [disconnectModalOpen, setDisconnectModalOpen] = useState(false);

  const deleteCacheMutation = trpc.viewer.calendars.deleteCache.useMutatio
---
[Medium] variable ConnectedCalendarList in packages/platform/atoms/selected-calendars/wrappers/SelectedCalendarsSettingsWebWrapper.tsx:
const ConnectedCalendarList = ({
  fromOnboarding = false,
  scope,
  items,
  disableConnectionModification,
  eventTypeId,
  onChanged,
  destinationCalendarId,
  isDisabled,
}: {
  fromOnboarding?: boolean;
  scope: SelectedCalendarSettingsScope;
  items: RouterOutputs[""viewer""][""calendars""][""connectedCalendars""][""connectedCalendars""];
  disableConnectionModification?: boolean;
  eventTypeId: number | null;
  onChanged?: () => unknown | Promise<unknown>;
  destinationCalendarId?: string;
  is
---
[Medium] chunk lines 2201-2220 in packages/prisma/schema.prisma:

enum BillingPeriod {
  MONTHLY
  ANNUALLY
}

model OrganizationOnboarding {
  // TODO: Use uuid for id
  id String @id @default(uuid())

  // User who started the onboarding. It is different from orgOwnerEmail in case Cal.com admin is doing the onboarding for someone else.
  createdBy   User     @relation(""CreatedOrganizationOnboardings"", fields: [createdById], references: [id], onDelete: Cascade)
  createdById Int
  createdAt   DateTime @default(now())

  // We keep the email only here and don
---
[Medium] chunk lines 2241-2260 in packages/prisma/schema.prisma:

  // Set when payment intent is there.
  stripeCustomerId         String? @unique
  // TODO: Can we make it required
  stripeSubscriptionId     String?
  stripeSubscriptionItemId String?

  /// @zod.custom(imports.orgOnboardingInvitedMembersSchema)
  invitedMembers Json @default(""[]"")

  /// @zod.custom(imports.orgOnboardingTeamsSchema)
  teams Json @default(""[]"")

  // Completion status
  isComplete Boolean @default(false)

  @@index([orgOwnerEmail])
  @@index([stripeCustomerId])
}

---
[Medium] chunk lines 2401-2406 in packages/prisma/schema.prisma:

  @@unique([roleId, resource, action])
  @@index([roleId])
  // TODO: come back to this with indexs.
  @@index([action])
}
---
[Medium] chunk lines 2261-2280 in packages/prisma/schema.prisma:
enum IncompleteBookingActionType {
  SALESFORCE
}

model App_RoutingForms_IncompleteBookingActions {
  id           Int                         @id @default(autoincrement())
  form         App_RoutingForms_Form       @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId       String
  actionType   IncompleteBookingActionType
  data         Json
  enabled      Boolean                     @default(true)
  credentialId Int?
}

model InternalNotePreset {
  id                 Int 
---
[Medium] chunk lines 1721-1740 in packages/prisma/schema.prisma:
  userId       Int?
  credential   Credential? @relation(fields: [credentialId], references: [id], onDelete: Cascade)

  @@id([credentialId, key])
  @@unique([credentialId, key])
  @@index([userId, key])
}

enum RedirectType {
  UserEventType @map(""user-event-type"")
  TeamEventType @map(""team-event-type"")
  User          @map(""user"")
  Team          @map(""team"")
}

model TempOrgRedirect {
  id        Int          @id @default(autoincrement())
  // Better would be to have fromOrgId and toOrgId as
---
[Medium] chunk lines 1741-1760 in packages/prisma/schema.prisma:
  fromOrgId Int
  type      RedirectType
  // It doesn't have any query params
  toUrl     String
  enabled   Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@unique([from, type, fromOrgId])
}

model Avatar {
  // e.g. NULL(0), organization ID or team logo
  teamId    Int    @default(0)
  // Avatar, NULL(0) if team logo
  userId    Int    @default(0)
  // base64 string
  data      String
  // different every time to pop the cache.
  ob
---
[Medium] chunk lines 2181-2200 in packages/prisma/schema.prisma:
  CRITICAL
}

model Watchlist {
  id          String            @id @unique @default(cuid())
  type        WatchlistType
  // The identifier of the Watchlisted entity (email or domain)
  value       String
  description String?
  createdAt   DateTime          @default(now())
  createdBy   User              @relation(""CreatedWatchlists"", onDelete: Cascade, fields: [createdById], references: [id])
  createdById Int
  updatedAt   DateTime          @updatedAt
  updatedBy   User?             @relatio
---
[Medium] object scripts in apps/web/package.json:
  ""scripts"": {
    ""analyze"": ""ANALYZE=true next build"",
    ""analyze:server"": ""BUNDLE_ANALYZE=server next build"",
    ""analyze:browser"": ""BUNDLE_ANALYZE=browser next build"",
    ""clean"": ""rm -rf .turbo && rm -rf node_modules && rm -rf .next"",
    ""dev"": ""yarn copy-static && next dev --turbopack"",
    ""dev:cron"": ""npx tsx cron-tester.ts"",
    ""dev-https"": ""NODE_TLS_REJECT_UNAUTHORIZED=0 next dev --experimental-https"",
    ""dx"": ""yarn dev"",
    ""test-codegen"": ""yarn playwright codegen http://loca
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: CalendarAuth;
  private log: typeof logger;
  private credential: CredentialForCalendarServiceWithEmail;

  constructor(credential: CredentialForCalendarServiceWithEmail) {
    this.integrationName = ""google_calendar"";
    this.credential = credential;
    this.auth = new CalendarAuth(credential);
    this.log = log.getSubLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  public getCrede
---
[Medium] chunk lines 2161-2180 in packages/prisma/schema.prisma:
  createdBy      Int
  updatedAt      DateTime                     @updatedAt
  updatedBy      Int?
  creator        User                         @relation(""CreatedEventTypeTranslations"", fields: [createdBy], references: [id])
  updater        User?                        @relation(""UpdatedEventTypeTranslations"", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@unique([eventTypeId, field, targetLocale])
  @@index([eventTypeId, field, targetLocale])
}

enum WatchlistType {
  EMAIL
 
---
[Medium] chunk lines 1861-1880 in packages/prisma/schema.prisma:
  createdAt DateTime @default(now())
  expiresAt DateTime

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int
}

model DSyncData {
  id               Int                     @id @default(autoincrement())
  directoryId      String                  @unique
  tenant           String
  organ
---
[Medium] chunk lines 1941-1960 in packages/prisma/schema.prisma:
  REVIEW_NEEDED
}

model ManagedOrganization {
  managedOrganizationId Int  @unique
  managedOrganization   Team @relation(""ManagedOrganization"", fields: [managedOrganizationId], references: [id], onDelete: Cascade)

  managerOrganizationId Int
  managerOrganization   Team @relation(""ManagerOrganization"", fields: [managerOrganizationId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([managerOrganizationId, managedOrganizationId])
  @@index([managerOrganiz
---
[Medium] chunk lines 2141-2160 in packages/prisma/schema.prisma:
  /// @zod.custom(imports.serviceAccountKeySchema)
  defaultServiceAccountKey Json
  createdAt                DateTime               @default(now())
  updatedAt                DateTime               @updatedAt
  enabled                  Boolean                @default(false)
  delegationCredentials    DelegationCredential[]
  domainWideDelegations    DomainWideDelegation[]

  @@unique([slug])
}

model EventTypeTranslation {
  uid            String                       @id @default(cuid())
  eve
---
[Medium] chunk lines 1901-1920 in packages/prisma/schema.prisma:
  verificationTokens VerificationToken[]
  eventTypes         EventType[]

  @@unique([email])
  @@unique([userId, email])
  @@index([userId])
}

// Needed to store tasks that need to be processed by a background worker or Tasker
model Task {
  id                  String    @id @unique @default(uuid())
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  // The time at which the task should be executed
  scheduledAt         DateTime  @default(now())
  // T
---
[Medium] chunk lines 2281-2300 in packages/prisma/schema.prisma:

  createdAt           DateTime              @default(now())
  BookingInternalNote BookingInternalNote[]

  @@unique([teamId, name])
  @@index([teamId])
}

enum FilterSegmentScope {
  USER
  TEAM
}

model FilterSegment {
  id               Int                           @id @default(autoincrement())
  name             String
  // Identifies which data table this segment belongs to (e.g. ""organization_members"", ""team_members"", ""bookings"", etc.)
  tableIdentifier  String
  scope            FilterSe
---
[Medium] chunk lines 2021-2040 in packages/prisma/schema.prisma:
  isLocked         Boolean           @default(false)

  @@unique([teamId, slug])
  @@index([teamId])
}

model AttributeToUser {
  id String @id @default(uuid())

  // This is the membership of the organization
  member Membership @relation(fields: [memberId], references: [id], onDelete: Cascade)

  // This is the membership id of the organization
  memberId Int

  attributeOption   AttributeOption @relation(fields: [attributeOptionId], references: [id], onDelete: Cascade)
  attributeOptionId Str
---
[Medium] chunk lines 2061-2080 in packages/prisma/schema.prisma:
  RR_REASSIGNED
  REROUTED
  SALESFORCE_ASSIGNMENT
}

model AssignmentReason {
  id           Int                  @id @unique @default(autoincrement())
  createdAt    DateTime             @default(now())
  bookingId    Int
  booking      Booking              @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  reasonEnum   AssignmentReasonEnum
  reasonString String

  @@index([bookingId])
}

enum EventTypeAutoTranslatedField {
  DESCRIPTION
  TITLE
}
---
[Medium] chunk lines 2361-2380 in packages/prisma/schema.prisma:
}

model WorkflowOptOutContact {
  id        Int                 @id @default(autoincrement())
  type      WorkflowContactType
  value     String
  optedOut  Boolean
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  @@unique([type, value])
}

enum RoleType {
  SYSTEM
  CUSTOM
}

model Role {
  id          String           @id @default(cuid())
---
[Medium] chunk lines 1921-1940 in packages/prisma/schema.prisma:
  payload             String
  // The number of times the task has been attempted
  attempts            Int       @default(0)
  // The maximum number of times the task can be attempted
  maxAttempts         Int       @default(3)
  lastError           String?
  lastFailedAttemptAt DateTime?
  referenceUid        String?

  // unique index on referenceUid,type to avoid duplicate tasks
  @@unique([referenceUid, type])
  // for finding succeeded tasks
  @@index([succeededAt])
  // for finding tasks 
---
[Medium] chunk lines 2381-2400 in packages/prisma/schema.prisma:
  name        String
  color       String?
  description String?
  teamId      Int? // null for global roles
  team        Team?            @relation(fields: [teamId], references: [id], onDelete: Cascade)
  permissions RolePermission[]
  memberships Membership[]
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  type        RoleType         @default(CUSTOM)

  @@unique([name, teamId])
  @@index([teamId])
}

model RolePermission {
  id        String   @id @
---
[Medium] chunk lines 2221-2240 in packages/prisma/schema.prisma:
  updatedAt DateTime @updatedAt
  // TODO: updatedBy to be added when we support marking updatedBy using webhook too, as webhook also updates it

  // Set after organization payment is done and the organization is created
  organizationId Int?  @unique
  organization   Team? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  billingPeriod BillingPeriod
  pricePerSeat  Float
  seats         Int

  isPlatform Boolean @default(false)

  // Organization info
  name          
---
[Medium] chunk lines 1881-1900 in packages/prisma/schema.prisma:
}

model DSyncTeamGroupMapping {
  id             Int       @id @default(autoincrement())
  organizationId Int
  teamId         Int
  team           Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  directoryId    String
  directory      DSyncData @relation(fields: [directoryId], references: [directoryId], onDelete: Cascade)
  groupName      String

  @@unique([teamId, groupName])
}

model SecondaryEmail {
  id                 Int                 @id @default(autoincre
---
[Medium] chunk lines 2121-2140 in packages/prisma/schema.prisma:
  domain              String
  selectedCalendars   SelectedCalendar[]
  destinationCalendar DestinationCalendar[]
  bookingReferences   BookingReference[]
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt

  // Should be fair to assume that one domain can be only on one workspace platform at a time. So, one can't have two different workspace platforms for the same domain
  // Because we don't know which domain the organization migh
---
[Medium] chunk lines 2001-2020 in packages/prisma/schema.prisma:
  id String @id @default(uuid())

  // This is organization
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)

  // This is organizationId
  teamId Int

  type AttributeType

  name    String
  slug    String
  enabled Boolean @default(true)

  usersCanEditRelation Boolean @default(false)

  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  options          AttributeOption[]
  isWeightsEnabled Boolean           @defaul
---
[Medium] chunk lines 1781-1800 in packages/prisma/schema.prisma:
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([uuid])
  @@index([userId])
  @@index([toUserId])
  @@index([start, end])
}

model OutOfOfficeReason {
  id      Int     @id @default(autoincrement())
  emoji   String
  reason  String  @unique
  enabled Boolean @default(true)
  userId  Int?
  user    User?   @relation(fields: [userId], references: [id], onDelete: Cascade)

  entries OutOfOfficeEntry[]
}

---
[Medium] chunk lines 2341-2360 in packages/prisma/schema.prisma:

  notePreset   InternalNotePreset? @relation(fields: [notePresetId], references: [id], onDelete: Cascade)
  notePresetId Int?
  text         String?

  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId Int

  createdBy   User @relation(fields: [createdById], references: [id])
  createdById Int

  createdAt DateTime @default(now())

  @@unique([bookingId, notePresetId])
  @@index([bookingId])
}

enum WorkflowContactType {
  PHONE
  EMAIL
---
[Medium] chunk lines 1841-1860 in packages/prisma/schema.prisma:
}

model AccessToken {
  id Int @id @default(autoincrement())

  secret    String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int
}

model RefreshToken {
  id Int @id @default(autoincrement())

  secret    String   @
---
[Medium] chunk lines 2101-2120 in packages/prisma/schema.prisma:
  updatedAt           DateTime              @updatedAt
  credentials         Credential[]

  // Should be fair to assume that one domain can be only on one workspace platform at a time. So, one can't have two different workspace platforms for the same domain
  // Because we don't know which domain the organization might have, we couldn't make ""domain"" unique here as that would prevent an actual owner of the domain to be unable to use that domain if it is used by someone else.
  @@unique([organiz
---
[Medium] chunk lines 2301-2320 in packages/prisma/schema.prisma:
  activeFilters    Json?
  sorting          Json?
  columnVisibility Json?
  columnSizing     Json?
  perPage          Int
  searchTerm       String?                       @db.Text
  createdAt        DateTime                      @default(now())
  updatedAt        DateTime                      @updatedAt
  // Creator of the segment
  user             User                          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId           Int
  // Team scope - optional, o
---
[Medium] chunk lines 1961-1980 in packages/prisma/schema.prisma:
  subscriptionId String?
  priceId        String?
  plan           String  @default(""none"")

  billingCycleStart Int?
  billingCycleEnd   Int?
  overdue           Boolean? @default(false)

  // note(Lauris): in case of a platform managed organization's billing record this field points to the manager organization's billing record.
  managerBillingId Int?
  managerBilling   PlatformBilling?  @relation(""PlatformManagedBilling"", fields: [managerBillingId], references: [id])
  // note(Lauris): in cas
---
[Medium] chunk lines 2041-2060 in packages/prisma/schema.prisma:
  // We don't intentionally delete assignments on deletion of a user/directory sync
  createdAt        DateTime   @default(now())
  createdById      Int?
  createdBy        User?      @relation(""createdBy"", fields: [createdById], references: [id], onDelete: SetNull)
  createdByDSyncId String?
  createdByDSync   DSyncData? @relation(""createdByDSync"", fields: [createdByDSyncId], references: [directoryId], onDelete: SetNull)

  updatedAt        DateTime?  @updatedAt
  updatedBy        User?      @r
---
[Medium] chunk lines 1701-1720 in packages/prisma/schema.prisma:
  userName       String?
  userUsername   String?
  ratingFeedback String?
  rating         Int?
  noShowHost     Boolean?
  isTeamBooking  Boolean
  timeStatus     String? // this is the addition on top of BookingDenormalized
}

model CalendarCache {
  // To be made required in a followup
  id String? @default(uuid())

  // The key would be the unique URL that is requested by the user
  key          String
  value        Json
  expiresAt    DateTime
  // Provide an initial value for legacy rows
---
[Medium] chunk lines 1821-1840 in packages/prisma/schema.prisma:
  bookingRescheduleRedirectUri String?
  areEmailsEnabled             Boolean @default(false)
  areDefaultEventTypesEnabled  Boolean @default(true)
  areCalendarEventsEnabled     Boolean @default(true)

  createdAt DateTime @default(now())
}

model PlatformAuthorizationToken {
  id String @id @default(cuid())

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDe
---
[Medium] chunk lines 1801-1820 in packages/prisma/schema.prisma:
// Platform
model PlatformOAuthClient {
  id             String   @id @default(cuid())
  name           String
  secret         String
  permissions    Int
  users          User[]
  logo           String?
  redirectUris   String[]
  organizationId Int
  organization   Team     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  teams          Team[]   @relation(""CreatedByOAuthClient"")

  accessTokens        AccessToken[]
  refreshToken        RefreshToken[]
  authorization
---
[Medium] chunk lines 2081-2100 in packages/prisma/schema.prisma:

model DelegationCredential {
  id                  String                @id @default(uuid())
  workspacePlatform   WorkspacePlatform     @relation(fields: [workspacePlatformId], references: [id], onDelete: Cascade)
  workspacePlatformId Int
  // Provides possibility to have different service accounts for different organizations if the need arises, but normally they should be the same
  /// @zod.custom(imports.serviceAccountKeySchema)
  serviceAccountKey   Json
  enabled             Boolean    
---
[Medium] chunk lines 1761-1780 in packages/prisma/schema.prisma:

  isBanner Boolean @default(false)

  @@unique([teamId, userId, isBanner])
  @@map(name: ""avatars"")
}

model OutOfOfficeEntry {
  id       Int                @id @default(autoincrement())
  uuid     String             @unique
  start    DateTime
  end      DateTime
  notes    String?
  userId   Int
  user     User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  toUserId Int?
  toUser   User?              @relation(name: ""toUser"", fields: [toUserId], references: 
---
[Medium] chunk lines 1981-2000 in packages/prisma/schema.prisma:
  SINGLE_SELECT
  MULTI_SELECT
}

model AttributeOption {
  id            String            @id @default(uuid())
  attribute     Attribute         @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  attributeId   String
  value         String
  slug          String
  isGroup       Boolean           @default(false)
  // It is a list of AttributeOptions ids that are contained in the group option
  // You could think of a person having the group option to actually have all the o
---
[Medium] chunk lines 2321-2340 in packages/prisma/schema.prisma:
}

model UserFilterSegmentPreference {
  id              Int      @id @default(autoincrement())
  userId          Int
  tableIdentifier String
  segmentId       Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user    User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  segment FilterSegment @relation(fields: [segmentId], references: [id], onDelete: Cascade)

  @@unique([userId, tableIdentifier])
  @@index([userId])
  @@index([se","SelectedCalendarRepository (Critical), UserRepository (Critical), ICalendarCacheRepository (Critical), CalendarCacheRepository (Critical), UserWithCalendars (Critical), findMany (Critical), fetchAvailabilityAndSetCache (Critical), CalendarCacheRepositoryMock (High), connectedCalendarsHandler (High), findUnlockedUserForSession (High), getCacheStatusByCredentialIds (High), updateManyByCredentialId (High), calendarsRouter (High), getCacheStatusByCredentialIds (High), DeleteCacheOptions (High), deleteCacheHandler (High), CredentialActionsDropdownProps (Medium), CredentialActionsDropdown (Medium), ConnectedCalendarList (Medium), lines 2201-2220 (Medium), lines 2241-2260 (Medium), lines 2401-2406 (Medium), lines 2261-2280 (Medium), lines 1721-1740 (Medium), lines 1741-1760 (Medium), lines 2181-2200 (Medium), scripts (Medium), GoogleCalendarService (Medium), lines 2161-2180 (Medium), lines 1861-1880 (Medium), lines 1941-1960 (Medium), lines 2141-2160 (Medium), lines 1901-1920 (Medium), lines 2281-2300 (Medium), lines 2021-2040 (Medium), lines 2061-2080 (Medium), lines 2361-2380 (Medium), lines 1921-1940 (Medium), lines 2381-2400 (Medium), lines 2221-2240 (Medium), lines 1881-1900 (Medium), lines 2121-2140 (Medium), lines 2001-2020 (Medium), lines 1781-1800 (Medium), lines 2341-2360 (Medium), lines 1841-1860 (Medium), lines 2101-2120 (Medium), lines 2301-2320 (Medium), lines 1961-1980 (Medium), lines 2041-2060 (Medium), lines 1701-1720 (Medium), lines 1821-1840 (Medium), lines 1801-1820 (Medium), lines 2081-2100 (Medium), lines 1761-1780 (Medium), lines 1981-2000 (Medium), lines 2321-2340 (Medium), cache_status (Low), cache_last_updated (Low), delete_cached_data (Low), cache_deleted_successfully (Low), error_deleting_cache (Low), confirm_delete_cache (Low), yes_delete_cache (Low), lines 1-9 (Low), lines 2401-2408 (Low), lines 1-20 (Low), lines 21-40 (Low), lines 41-60 (Low), lines 61-79 (Low), SelectedCalendarsSettingsWebWrapper (Low)",miss,"shell script portability issue, not in TypeScript/Prisma HC entities"
cal_dot_com,10,Add guest management functionality to existing bookings,Case sensitivity bypass in email blacklist,High,27,11,9,"variable::bookingsRouter (packages/trpc/server/routers/viewer/bookings/_router.tsx) [Critical, score=0.72] | function::BookingListItem (apps/web/components/booking/BookingListItem.tsx) [Critical, score=0.71] | interface::IAddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.65] | variable::ZAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.63] | variable::addGuestsHandler (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.59] | variable::AddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.53] | variable::sendAddGuestsEmails (packages/emails/email-manager.ts) [High, score=0.53] | variable::AttendeeAddGuestsEmail (packages/emails/src/templates/AttendeeAddGuestsEmail.tsx) [High, score=0.53] | variable::OrganizerAddGuestsEmail (packages/emails/src/templates/OrganizerAddGuestsEmail.tsx) [High, score=0.53] | type::AddGuestsOptions (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.53] | type::TAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.53]","[Critical] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings/_router.tsx:
const bookingsRouter = router({
  get: authedProcedure.input(ZGetInputSchema).query(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.get) {
      UNSTABLE_HANDLER_CACHE.get = await import(""./get.handler"").then((mod) => mod.getHandler);
    }

    // Unreachable code but required for type safety
    if (!UNSTABLE_HANDLER_CACHE.get) {
      throw new Error(""Failed to load handler"");
    }

    return UNSTABLE_HANDLER_CACHE.get({
      ctx,
      input,
    });
  }),

  requestReschedule: authedProcedure.input(ZRequestRescheduleInputSchema).mutation(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.requestReschedule) {
      UNSTABLE_HANDLER_CACHE.requestReschedule = await import(""./requestReschedule.handler"").then(
        (mod) => mod.requestRescheduleHandler
      );
 
---
[Critical] function BookingListItem in apps/web/components/booking/BookingListItem.tsx:
function BookingListItem(booking: BookingItemProps) {
  const bookerUrl = useBookerUrl();
  const { userId, userTimeZone, userTimeFormat, userEmail } = booking.loggedInUser;

  const {
    t,
    i18n: { language },
  } = useLocale();
  const utils = trpc.useUtils();
  const [chargeCardDialogIsOpen, setChargeCardDialogIsOpen] = useState(false);
  const [viewRecordingsDialogIsOpen, setViewRecordingsDialogIsOpen] = useState<boolean>(false);
  const cardCharged = booking?.payment[0]?.success;
  const mutation = trpc.viewer.bookings.confirm.useMutation({
    onSuccess: () => {
      showToast(t(""booking_confirmation_success""), ""success"");
      utils.viewer.bookings.invalidate();
    },
    onError: () => {
      showToast(t(""booking_confirmation_failed""), ""error"");
      utils.viewer.bookings
---
[High] interface IAddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
interface IAddGuestsDialog {
  isOpenDialog: boolean;
  setIsOpenDialog: Dispatch<SetStateAction<boolean>>;
  bookingId: number;
}
---
[High] variable ZAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
const ZAddGuestsInputSchema = z.object({
  bookingId: z.number(),
  guests: z.array(z.string().email()),
});
---
[High] variable addGuestsHandler in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
const addGuestsHandler = async ({ ctx, input }: AddGuestsOptions) => {
  const { user } = ctx;
  const { bookingId, guests } = input;

  const booking = await prisma.booking.findFirst({
    where: {
      id: bookingId,
    },
    include: {
      attendees: true,
      eventType: true,
      destinationCalendar: true,
      references: true,
      user: {
        include: {
          destinationCalendar: true,
          credentials: true,
        },
      },
    },
  });

  if (!booking) throw new TRPCError({ code: ""NOT_FOUND"", message: ""booking_not_found"" });

  const isTeamAdminOrOwner =
    (await isTeamAdmin(user.id, booking.eventType?.teamId ?? 0)) &&
    (await isTeamOwner(user.id, booking.eventType?.teamId ?? 0));

  const isOrganizer = booking.userId === user.id;

  const isAttend
---
[High] variable AddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
const AddGuestsDialog = (props: IAddGuestsDialog) => {
  const { t } = useLocale();
  const ZAddGuestsInputSchema = z.array(z.string().email()).refine((emails) => {
    const uniqueEmails = new Set(emails);
    return uniqueEmails.size === emails.length;
  });
  const { isOpenDialog, setIsOpenDialog, bookingId } = props;
  const utils = trpc.useUtils();
  const [multiEmailValue, setMultiEmailValue] = useState<string[]>([""""]);
  const [isInvalidEmail, setIsInvalidEmail] = useState(false);

  const addGuestsMutation = trpc.viewer.bookings.addGuests.useMutation({
    onSuccess: async () => {
      showToast(t(""guests_added""), ""success"");
      setIsOpenDialog(false);
      setMultiEmailValue([""""]);
      utils.viewer.bookings.invalidate();
    },
    onError: (err) => {
      const message = 
---
[High] variable sendAddGuestsEmails in packages/emails/email-manager.ts:
const sendAddGuestsEmails = async (calEvent: CalendarEvent, newGuests: string[]) => {
  const calendarEvent = formatCalEvent(calEvent);

  const emailsToSend: Promise<unknown>[] = [];
  emailsToSend.push(sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent })));

  if (calendarEvent.team?.members) {
    for (const teamMember of calendarEvent.team.members) {
      emailsToSend.push(
        sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent, teamMember }))
      );
    }
  }

  emailsToSend.push(
    ...calendarEvent.attendees.map((attendee) => {
      if (newGuests.includes(attendee.email)) {
        return sendEmail(() => new AttendeeScheduledEmail(calendarEvent, attendee));
      } else {
        return sendEmail(() => new AttendeeAddGuestsEmail(calend
---
[High] variable AttendeeAddGuestsEmail in packages/emails/src/templates/AttendeeAddGuestsEmail.tsx:
const AttendeeAddGuestsEmail = (props: React.ComponentProps<typeof AttendeeScheduledEmail>) => (
  <AttendeeScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    {...props}
  />
);
---
[High] variable OrganizerAddGuestsEmail in packages/emails/src/templates/OrganizerAddGuestsEmail.tsx:
const OrganizerAddGuestsEmail = (props: React.ComponentProps<typeof OrganizerScheduledEmail>) => (
  <OrganizerScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    callToAction={null}
    {...props}
  />
);
---
[High] type AddGuestsOptions in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
type AddGuestsOptions = {
  ctx: {
    user: NonNullable<TrpcSessionUser>;
  };
  input: TAddGuestsInputSchema;
};
---
[High] type TAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
type TAddGuestsInputSchema = z.infer<typeof ZAddGuestsInputSchema>;","[Medium] interface MultiEmailProps in packages/ui/form/MultiEmail.tsx:
interface MultiEmailProps {
  value: string[];
  readOnly: boolean;
  label: string;
  setValue: (value: string[]) => void;
  placeholder?: string;
}
---
[Medium] function MultiEmail in packages/ui/form/MultiEmail.tsx:
function MultiEmail({ value, readOnly, label, setValue, placeholder }: MultiEmailProps) {
  const { t } = useLocale();
  value = value || [];
  const inputClassName =
    ""dark:placeholder:text-muted focus:border-emphasis border-subtle block w-full rounded-md border-default text-sm focus:ring-black disabled:bg-emphasis disabled:hover:cursor-not-allowed dark:selection:bg-green-500 disabled:dark:text-subtle bg-default"";
  return (
    <>
      {value.length ? (
        <div>
          <label htmlF
---
[Medium] export MultiEmail in packages/ui/form/MultiEmail.tsx:
export default MultiEmail;
---
[Medium] export MultiEmail in packages/ui/form/MultiEmailLazy.tsx:
export default MultiEmail;
---
[Medium] class AttendeeAddGuestsEmail in packages/emails/templates/attendee-add-guests-email.ts:
class AttendeeAddGuestsEmail extends AttendeeScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: 
---
[Medium] method getNodeMailerPayload in packages/emails/templates/attendee-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: `${this.attendee.name} <${this.attendee.email}>`,
      from: `$
---
[Medium] class OrganizerAddGuestsEmail in packages/emails/templates/organizer-add-guests-email.ts:
class OrganizerAddGuestsEmail extends OrganizerScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
  
---
[Medium] method getNodeMailerPayload in packages/emails/templates/organizer-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST""
---
[Medium] type BookingsRouterHandlerCache in packages/trpc/server/routers/viewer/bookings/_router.tsx:
type BookingsRouterHandlerCache = {
  get?: typeof import(""./get.handler"").getHandler;
  requestReschedule?: typeof import(""./requestReschedule.handler"").requestRescheduleHandler;
  editLocation?: typeof import(""./editLocation.handler"").editLocationHandler;
  addGuests?: typeof import(""./addGuests.handler"").addGuestsHandler;
  confirm?: typeof import(""./confirm.handler"").confirmHandler;
  getBookingAttendees?: typeof import(""./getBookingAttendees.handler"").getBookingAttendeesHandler;
  find?: ty","bookingsRouter (Critical), BookingListItem (Critical), IAddGuestsDialog (High), ZAddGuestsInputSchema (High), addGuestsHandler (High), AddGuestsDialog (High), sendAddGuestsEmails (High), AttendeeAddGuestsEmail (High), OrganizerAddGuestsEmail (High), AddGuestsOptions (High), TAddGuestsInputSchema (High), MultiEmailProps (Medium), MultiEmail (Medium), MultiEmail (Medium), MultiEmail (Medium), AttendeeAddGuestsEmail (Medium), getNodeMailerPayload (Medium), OrganizerAddGuestsEmail (Medium), getNodeMailerPayload (Medium), BookingsRouterHandlerCache (Medium), new_guests_added (Low), guests_added_event_type_subject (Low), guests_added (Low), unable_to_add_guests (Low), emails_must_be_unique_valid (Low), add_emails (Low), MultiEmail (Low)",match,'email' matches HC entity 'attendeeaddguestsemail'
cal_dot_com,10,Add guest management functionality to existing bookings,"The logic for checking team admin/owner permissions is incorrect. This condition uses AND (&&) which requires both isTeamAdmin AND isTeamOwner to be true, but it should use OR (||) since a user needs to be either an admin OR an owner to have permission.",Critical,27,11,9,"variable::bookingsRouter (packages/trpc/server/routers/viewer/bookings/_router.tsx) [Critical, score=0.72] | function::BookingListItem (apps/web/components/booking/BookingListItem.tsx) [Critical, score=0.71] | interface::IAddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.65] | variable::ZAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.63] | variable::addGuestsHandler (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.59] | variable::AddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.53] | variable::sendAddGuestsEmails (packages/emails/email-manager.ts) [High, score=0.53] | variable::AttendeeAddGuestsEmail (packages/emails/src/templates/AttendeeAddGuestsEmail.tsx) [High, score=0.53] | variable::OrganizerAddGuestsEmail (packages/emails/src/templates/OrganizerAddGuestsEmail.tsx) [High, score=0.53] | type::AddGuestsOptions (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.53] | type::TAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.53]","[Critical] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings/_router.tsx:
const bookingsRouter = router({
  get: authedProcedure.input(ZGetInputSchema).query(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.get) {
      UNSTABLE_HANDLER_CACHE.get = await import(""./get.handler"").then((mod) => mod.getHandler);
    }

    // Unreachable code but required for type safety
    if (!UNSTABLE_HANDLER_CACHE.get) {
      throw new Error(""Failed to load handler"");
    }

    return UNSTABLE_HANDLER_CACHE.get({
      ctx,
      input,
    });
  }),

  requestReschedule: authedProcedure.input(ZRequestRescheduleInputSchema).mutation(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.requestReschedule) {
      UNSTABLE_HANDLER_CACHE.requestReschedule = await import(""./requestReschedule.handler"").then(
        (mod) => mod.requestRescheduleHandler
      );
 
---
[Critical] function BookingListItem in apps/web/components/booking/BookingListItem.tsx:
function BookingListItem(booking: BookingItemProps) {
  const bookerUrl = useBookerUrl();
  const { userId, userTimeZone, userTimeFormat, userEmail } = booking.loggedInUser;

  const {
    t,
    i18n: { language },
  } = useLocale();
  const utils = trpc.useUtils();
  const [chargeCardDialogIsOpen, setChargeCardDialogIsOpen] = useState(false);
  const [viewRecordingsDialogIsOpen, setViewRecordingsDialogIsOpen] = useState<boolean>(false);
  const cardCharged = booking?.payment[0]?.success;
  const mutation = trpc.viewer.bookings.confirm.useMutation({
    onSuccess: () => {
      showToast(t(""booking_confirmation_success""), ""success"");
      utils.viewer.bookings.invalidate();
    },
    onError: () => {
      showToast(t(""booking_confirmation_failed""), ""error"");
      utils.viewer.bookings
---
[High] interface IAddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
interface IAddGuestsDialog {
  isOpenDialog: boolean;
  setIsOpenDialog: Dispatch<SetStateAction<boolean>>;
  bookingId: number;
}
---
[High] variable ZAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
const ZAddGuestsInputSchema = z.object({
  bookingId: z.number(),
  guests: z.array(z.string().email()),
});
---
[High] variable addGuestsHandler in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
const addGuestsHandler = async ({ ctx, input }: AddGuestsOptions) => {
  const { user } = ctx;
  const { bookingId, guests } = input;

  const booking = await prisma.booking.findFirst({
    where: {
      id: bookingId,
    },
    include: {
      attendees: true,
      eventType: true,
      destinationCalendar: true,
      references: true,
      user: {
        include: {
          destinationCalendar: true,
          credentials: true,
        },
      },
    },
  });

  if (!booking) throw new TRPCError({ code: ""NOT_FOUND"", message: ""booking_not_found"" });

  const isTeamAdminOrOwner =
    (await isTeamAdmin(user.id, booking.eventType?.teamId ?? 0)) &&
    (await isTeamOwner(user.id, booking.eventType?.teamId ?? 0));

  const isOrganizer = booking.userId === user.id;

  const isAttend
---
[High] variable AddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
const AddGuestsDialog = (props: IAddGuestsDialog) => {
  const { t } = useLocale();
  const ZAddGuestsInputSchema = z.array(z.string().email()).refine((emails) => {
    const uniqueEmails = new Set(emails);
    return uniqueEmails.size === emails.length;
  });
  const { isOpenDialog, setIsOpenDialog, bookingId } = props;
  const utils = trpc.useUtils();
  const [multiEmailValue, setMultiEmailValue] = useState<string[]>([""""]);
  const [isInvalidEmail, setIsInvalidEmail] = useState(false);

  const addGuestsMutation = trpc.viewer.bookings.addGuests.useMutation({
    onSuccess: async () => {
      showToast(t(""guests_added""), ""success"");
      setIsOpenDialog(false);
      setMultiEmailValue([""""]);
      utils.viewer.bookings.invalidate();
    },
    onError: (err) => {
      const message = 
---
[High] variable sendAddGuestsEmails in packages/emails/email-manager.ts:
const sendAddGuestsEmails = async (calEvent: CalendarEvent, newGuests: string[]) => {
  const calendarEvent = formatCalEvent(calEvent);

  const emailsToSend: Promise<unknown>[] = [];
  emailsToSend.push(sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent })));

  if (calendarEvent.team?.members) {
    for (const teamMember of calendarEvent.team.members) {
      emailsToSend.push(
        sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent, teamMember }))
      );
    }
  }

  emailsToSend.push(
    ...calendarEvent.attendees.map((attendee) => {
      if (newGuests.includes(attendee.email)) {
        return sendEmail(() => new AttendeeScheduledEmail(calendarEvent, attendee));
      } else {
        return sendEmail(() => new AttendeeAddGuestsEmail(calend
---
[High] variable AttendeeAddGuestsEmail in packages/emails/src/templates/AttendeeAddGuestsEmail.tsx:
const AttendeeAddGuestsEmail = (props: React.ComponentProps<typeof AttendeeScheduledEmail>) => (
  <AttendeeScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    {...props}
  />
);
---
[High] variable OrganizerAddGuestsEmail in packages/emails/src/templates/OrganizerAddGuestsEmail.tsx:
const OrganizerAddGuestsEmail = (props: React.ComponentProps<typeof OrganizerScheduledEmail>) => (
  <OrganizerScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    callToAction={null}
    {...props}
  />
);
---
[High] type AddGuestsOptions in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
type AddGuestsOptions = {
  ctx: {
    user: NonNullable<TrpcSessionUser>;
  };
  input: TAddGuestsInputSchema;
};
---
[High] type TAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
type TAddGuestsInputSchema = z.infer<typeof ZAddGuestsInputSchema>;","[Medium] interface MultiEmailProps in packages/ui/form/MultiEmail.tsx:
interface MultiEmailProps {
  value: string[];
  readOnly: boolean;
  label: string;
  setValue: (value: string[]) => void;
  placeholder?: string;
}
---
[Medium] function MultiEmail in packages/ui/form/MultiEmail.tsx:
function MultiEmail({ value, readOnly, label, setValue, placeholder }: MultiEmailProps) {
  const { t } = useLocale();
  value = value || [];
  const inputClassName =
    ""dark:placeholder:text-muted focus:border-emphasis border-subtle block w-full rounded-md border-default text-sm focus:ring-black disabled:bg-emphasis disabled:hover:cursor-not-allowed dark:selection:bg-green-500 disabled:dark:text-subtle bg-default"";
  return (
    <>
      {value.length ? (
        <div>
          <label htmlF
---
[Medium] export MultiEmail in packages/ui/form/MultiEmail.tsx:
export default MultiEmail;
---
[Medium] export MultiEmail in packages/ui/form/MultiEmailLazy.tsx:
export default MultiEmail;
---
[Medium] class AttendeeAddGuestsEmail in packages/emails/templates/attendee-add-guests-email.ts:
class AttendeeAddGuestsEmail extends AttendeeScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: 
---
[Medium] method getNodeMailerPayload in packages/emails/templates/attendee-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: `${this.attendee.name} <${this.attendee.email}>`,
      from: `$
---
[Medium] class OrganizerAddGuestsEmail in packages/emails/templates/organizer-add-guests-email.ts:
class OrganizerAddGuestsEmail extends OrganizerScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
  
---
[Medium] method getNodeMailerPayload in packages/emails/templates/organizer-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST""
---
[Medium] type BookingsRouterHandlerCache in packages/trpc/server/routers/viewer/bookings/_router.tsx:
type BookingsRouterHandlerCache = {
  get?: typeof import(""./get.handler"").getHandler;
  requestReschedule?: typeof import(""./requestReschedule.handler"").requestRescheduleHandler;
  editLocation?: typeof import(""./editLocation.handler"").editLocationHandler;
  addGuests?: typeof import(""./addGuests.handler"").addGuestsHandler;
  confirm?: typeof import(""./confirm.handler"").confirmHandler;
  getBookingAttendees?: typeof import(""./getBookingAttendees.handler"").getBookingAttendeesHandler;
  find?: ty","bookingsRouter (Critical), BookingListItem (Critical), IAddGuestsDialog (High), ZAddGuestsInputSchema (High), addGuestsHandler (High), AddGuestsDialog (High), sendAddGuestsEmails (High), AttendeeAddGuestsEmail (High), OrganizerAddGuestsEmail (High), AddGuestsOptions (High), TAddGuestsInputSchema (High), MultiEmailProps (Medium), MultiEmail (Medium), MultiEmail (Medium), MultiEmail (Medium), AttendeeAddGuestsEmail (Medium), getNodeMailerPayload (Medium), OrganizerAddGuestsEmail (Medium), getNodeMailerPayload (Medium), BookingsRouterHandlerCache (Medium), new_guests_added (Low), guests_added_event_type_subject (Low), guests_added (Low), unable_to_add_guests (Low), emails_must_be_unique_valid (Low), add_emails (Low), MultiEmail (Low)",partial,"HC entities exist (11) but no name match; golden idents: {'admin', 'uses', 'needs', 'either', 'owner', 'condition', 'checking', 'permissions', 'requires', 'isTeamOwner', 'isTeamAdmin', 'user', 'permission', 'team'}"
cal_dot_com,10,Add guest management functionality to existing bookings,"This calls the email sender with the original guests, so existing attendees included in the input will be treated as new when sending notifications, leading to incorrect emails.",Medium,27,11,9,"variable::bookingsRouter (packages/trpc/server/routers/viewer/bookings/_router.tsx) [Critical, score=0.72] | function::BookingListItem (apps/web/components/booking/BookingListItem.tsx) [Critical, score=0.71] | interface::IAddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.65] | variable::ZAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.63] | variable::addGuestsHandler (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.59] | variable::AddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.53] | variable::sendAddGuestsEmails (packages/emails/email-manager.ts) [High, score=0.53] | variable::AttendeeAddGuestsEmail (packages/emails/src/templates/AttendeeAddGuestsEmail.tsx) [High, score=0.53] | variable::OrganizerAddGuestsEmail (packages/emails/src/templates/OrganizerAddGuestsEmail.tsx) [High, score=0.53] | type::AddGuestsOptions (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.53] | type::TAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.53]","[Critical] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings/_router.tsx:
const bookingsRouter = router({
  get: authedProcedure.input(ZGetInputSchema).query(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.get) {
      UNSTABLE_HANDLER_CACHE.get = await import(""./get.handler"").then((mod) => mod.getHandler);
    }

    // Unreachable code but required for type safety
    if (!UNSTABLE_HANDLER_CACHE.get) {
      throw new Error(""Failed to load handler"");
    }

    return UNSTABLE_HANDLER_CACHE.get({
      ctx,
      input,
    });
  }),

  requestReschedule: authedProcedure.input(ZRequestRescheduleInputSchema).mutation(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.requestReschedule) {
      UNSTABLE_HANDLER_CACHE.requestReschedule = await import(""./requestReschedule.handler"").then(
        (mod) => mod.requestRescheduleHandler
      );
 
---
[Critical] function BookingListItem in apps/web/components/booking/BookingListItem.tsx:
function BookingListItem(booking: BookingItemProps) {
  const bookerUrl = useBookerUrl();
  const { userId, userTimeZone, userTimeFormat, userEmail } = booking.loggedInUser;

  const {
    t,
    i18n: { language },
  } = useLocale();
  const utils = trpc.useUtils();
  const [chargeCardDialogIsOpen, setChargeCardDialogIsOpen] = useState(false);
  const [viewRecordingsDialogIsOpen, setViewRecordingsDialogIsOpen] = useState<boolean>(false);
  const cardCharged = booking?.payment[0]?.success;
  const mutation = trpc.viewer.bookings.confirm.useMutation({
    onSuccess: () => {
      showToast(t(""booking_confirmation_success""), ""success"");
      utils.viewer.bookings.invalidate();
    },
    onError: () => {
      showToast(t(""booking_confirmation_failed""), ""error"");
      utils.viewer.bookings
---
[High] interface IAddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
interface IAddGuestsDialog {
  isOpenDialog: boolean;
  setIsOpenDialog: Dispatch<SetStateAction<boolean>>;
  bookingId: number;
}
---
[High] variable ZAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
const ZAddGuestsInputSchema = z.object({
  bookingId: z.number(),
  guests: z.array(z.string().email()),
});
---
[High] variable addGuestsHandler in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
const addGuestsHandler = async ({ ctx, input }: AddGuestsOptions) => {
  const { user } = ctx;
  const { bookingId, guests } = input;

  const booking = await prisma.booking.findFirst({
    where: {
      id: bookingId,
    },
    include: {
      attendees: true,
      eventType: true,
      destinationCalendar: true,
      references: true,
      user: {
        include: {
          destinationCalendar: true,
          credentials: true,
        },
      },
    },
  });

  if (!booking) throw new TRPCError({ code: ""NOT_FOUND"", message: ""booking_not_found"" });

  const isTeamAdminOrOwner =
    (await isTeamAdmin(user.id, booking.eventType?.teamId ?? 0)) &&
    (await isTeamOwner(user.id, booking.eventType?.teamId ?? 0));

  const isOrganizer = booking.userId === user.id;

  const isAttend
---
[High] variable AddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
const AddGuestsDialog = (props: IAddGuestsDialog) => {
  const { t } = useLocale();
  const ZAddGuestsInputSchema = z.array(z.string().email()).refine((emails) => {
    const uniqueEmails = new Set(emails);
    return uniqueEmails.size === emails.length;
  });
  const { isOpenDialog, setIsOpenDialog, bookingId } = props;
  const utils = trpc.useUtils();
  const [multiEmailValue, setMultiEmailValue] = useState<string[]>([""""]);
  const [isInvalidEmail, setIsInvalidEmail] = useState(false);

  const addGuestsMutation = trpc.viewer.bookings.addGuests.useMutation({
    onSuccess: async () => {
      showToast(t(""guests_added""), ""success"");
      setIsOpenDialog(false);
      setMultiEmailValue([""""]);
      utils.viewer.bookings.invalidate();
    },
    onError: (err) => {
      const message = 
---
[High] variable sendAddGuestsEmails in packages/emails/email-manager.ts:
const sendAddGuestsEmails = async (calEvent: CalendarEvent, newGuests: string[]) => {
  const calendarEvent = formatCalEvent(calEvent);

  const emailsToSend: Promise<unknown>[] = [];
  emailsToSend.push(sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent })));

  if (calendarEvent.team?.members) {
    for (const teamMember of calendarEvent.team.members) {
      emailsToSend.push(
        sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent, teamMember }))
      );
    }
  }

  emailsToSend.push(
    ...calendarEvent.attendees.map((attendee) => {
      if (newGuests.includes(attendee.email)) {
        return sendEmail(() => new AttendeeScheduledEmail(calendarEvent, attendee));
      } else {
        return sendEmail(() => new AttendeeAddGuestsEmail(calend
---
[High] variable AttendeeAddGuestsEmail in packages/emails/src/templates/AttendeeAddGuestsEmail.tsx:
const AttendeeAddGuestsEmail = (props: React.ComponentProps<typeof AttendeeScheduledEmail>) => (
  <AttendeeScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    {...props}
  />
);
---
[High] variable OrganizerAddGuestsEmail in packages/emails/src/templates/OrganizerAddGuestsEmail.tsx:
const OrganizerAddGuestsEmail = (props: React.ComponentProps<typeof OrganizerScheduledEmail>) => (
  <OrganizerScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    callToAction={null}
    {...props}
  />
);
---
[High] type AddGuestsOptions in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
type AddGuestsOptions = {
  ctx: {
    user: NonNullable<TrpcSessionUser>;
  };
  input: TAddGuestsInputSchema;
};
---
[High] type TAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
type TAddGuestsInputSchema = z.infer<typeof ZAddGuestsInputSchema>;","[Medium] interface MultiEmailProps in packages/ui/form/MultiEmail.tsx:
interface MultiEmailProps {
  value: string[];
  readOnly: boolean;
  label: string;
  setValue: (value: string[]) => void;
  placeholder?: string;
}
---
[Medium] function MultiEmail in packages/ui/form/MultiEmail.tsx:
function MultiEmail({ value, readOnly, label, setValue, placeholder }: MultiEmailProps) {
  const { t } = useLocale();
  value = value || [];
  const inputClassName =
    ""dark:placeholder:text-muted focus:border-emphasis border-subtle block w-full rounded-md border-default text-sm focus:ring-black disabled:bg-emphasis disabled:hover:cursor-not-allowed dark:selection:bg-green-500 disabled:dark:text-subtle bg-default"";
  return (
    <>
      {value.length ? (
        <div>
          <label htmlF
---
[Medium] export MultiEmail in packages/ui/form/MultiEmail.tsx:
export default MultiEmail;
---
[Medium] export MultiEmail in packages/ui/form/MultiEmailLazy.tsx:
export default MultiEmail;
---
[Medium] class AttendeeAddGuestsEmail in packages/emails/templates/attendee-add-guests-email.ts:
class AttendeeAddGuestsEmail extends AttendeeScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: 
---
[Medium] method getNodeMailerPayload in packages/emails/templates/attendee-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: `${this.attendee.name} <${this.attendee.email}>`,
      from: `$
---
[Medium] class OrganizerAddGuestsEmail in packages/emails/templates/organizer-add-guests-email.ts:
class OrganizerAddGuestsEmail extends OrganizerScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
  
---
[Medium] method getNodeMailerPayload in packages/emails/templates/organizer-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST""
---
[Medium] type BookingsRouterHandlerCache in packages/trpc/server/routers/viewer/bookings/_router.tsx:
type BookingsRouterHandlerCache = {
  get?: typeof import(""./get.handler"").getHandler;
  requestReschedule?: typeof import(""./requestReschedule.handler"").requestRescheduleHandler;
  editLocation?: typeof import(""./editLocation.handler"").editLocationHandler;
  addGuests?: typeof import(""./addGuests.handler"").addGuestsHandler;
  confirm?: typeof import(""./confirm.handler"").confirmHandler;
  getBookingAttendees?: typeof import(""./getBookingAttendees.handler"").getBookingAttendeesHandler;
  find?: ty","bookingsRouter (Critical), BookingListItem (Critical), IAddGuestsDialog (High), ZAddGuestsInputSchema (High), addGuestsHandler (High), AddGuestsDialog (High), sendAddGuestsEmails (High), AttendeeAddGuestsEmail (High), OrganizerAddGuestsEmail (High), AddGuestsOptions (High), TAddGuestsInputSchema (High), MultiEmailProps (Medium), MultiEmail (Medium), MultiEmail (Medium), MultiEmail (Medium), AttendeeAddGuestsEmail (Medium), getNodeMailerPayload (Medium), OrganizerAddGuestsEmail (Medium), getNodeMailerPayload (Medium), BookingsRouterHandlerCache (Medium), new_guests_added (Low), guests_added_event_type_subject (Low), guests_added (Low), unable_to_add_guests (Low), emails_must_be_unique_valid (Low), add_emails (Low), MultiEmail (Low)",match,'guests' matches HC entity 'addguestsdialog'
cal_dot_com,10,Add guest management functionality to existing bookings,uniqueGuests filters out existing attendees and blacklisted emails but does not deduplicate duplicates within the input; createMany can insert duplicate attendee rows if the client submits repeated emails.,Medium,27,11,9,"variable::bookingsRouter (packages/trpc/server/routers/viewer/bookings/_router.tsx) [Critical, score=0.72] | function::BookingListItem (apps/web/components/booking/BookingListItem.tsx) [Critical, score=0.71] | interface::IAddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.65] | variable::ZAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.63] | variable::addGuestsHandler (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.59] | variable::AddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.53] | variable::sendAddGuestsEmails (packages/emails/email-manager.ts) [High, score=0.53] | variable::AttendeeAddGuestsEmail (packages/emails/src/templates/AttendeeAddGuestsEmail.tsx) [High, score=0.53] | variable::OrganizerAddGuestsEmail (packages/emails/src/templates/OrganizerAddGuestsEmail.tsx) [High, score=0.53] | type::AddGuestsOptions (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.53] | type::TAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.53]","[Critical] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings/_router.tsx:
const bookingsRouter = router({
  get: authedProcedure.input(ZGetInputSchema).query(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.get) {
      UNSTABLE_HANDLER_CACHE.get = await import(""./get.handler"").then((mod) => mod.getHandler);
    }

    // Unreachable code but required for type safety
    if (!UNSTABLE_HANDLER_CACHE.get) {
      throw new Error(""Failed to load handler"");
    }

    return UNSTABLE_HANDLER_CACHE.get({
      ctx,
      input,
    });
  }),

  requestReschedule: authedProcedure.input(ZRequestRescheduleInputSchema).mutation(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.requestReschedule) {
      UNSTABLE_HANDLER_CACHE.requestReschedule = await import(""./requestReschedule.handler"").then(
        (mod) => mod.requestRescheduleHandler
      );
 
---
[Critical] function BookingListItem in apps/web/components/booking/BookingListItem.tsx:
function BookingListItem(booking: BookingItemProps) {
  const bookerUrl = useBookerUrl();
  const { userId, userTimeZone, userTimeFormat, userEmail } = booking.loggedInUser;

  const {
    t,
    i18n: { language },
  } = useLocale();
  const utils = trpc.useUtils();
  const [chargeCardDialogIsOpen, setChargeCardDialogIsOpen] = useState(false);
  const [viewRecordingsDialogIsOpen, setViewRecordingsDialogIsOpen] = useState<boolean>(false);
  const cardCharged = booking?.payment[0]?.success;
  const mutation = trpc.viewer.bookings.confirm.useMutation({
    onSuccess: () => {
      showToast(t(""booking_confirmation_success""), ""success"");
      utils.viewer.bookings.invalidate();
    },
    onError: () => {
      showToast(t(""booking_confirmation_failed""), ""error"");
      utils.viewer.bookings
---
[High] interface IAddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
interface IAddGuestsDialog {
  isOpenDialog: boolean;
  setIsOpenDialog: Dispatch<SetStateAction<boolean>>;
  bookingId: number;
}
---
[High] variable ZAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
const ZAddGuestsInputSchema = z.object({
  bookingId: z.number(),
  guests: z.array(z.string().email()),
});
---
[High] variable addGuestsHandler in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
const addGuestsHandler = async ({ ctx, input }: AddGuestsOptions) => {
  const { user } = ctx;
  const { bookingId, guests } = input;

  const booking = await prisma.booking.findFirst({
    where: {
      id: bookingId,
    },
    include: {
      attendees: true,
      eventType: true,
      destinationCalendar: true,
      references: true,
      user: {
        include: {
          destinationCalendar: true,
          credentials: true,
        },
      },
    },
  });

  if (!booking) throw new TRPCError({ code: ""NOT_FOUND"", message: ""booking_not_found"" });

  const isTeamAdminOrOwner =
    (await isTeamAdmin(user.id, booking.eventType?.teamId ?? 0)) &&
    (await isTeamOwner(user.id, booking.eventType?.teamId ?? 0));

  const isOrganizer = booking.userId === user.id;

  const isAttend
---
[High] variable AddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
const AddGuestsDialog = (props: IAddGuestsDialog) => {
  const { t } = useLocale();
  const ZAddGuestsInputSchema = z.array(z.string().email()).refine((emails) => {
    const uniqueEmails = new Set(emails);
    return uniqueEmails.size === emails.length;
  });
  const { isOpenDialog, setIsOpenDialog, bookingId } = props;
  const utils = trpc.useUtils();
  const [multiEmailValue, setMultiEmailValue] = useState<string[]>([""""]);
  const [isInvalidEmail, setIsInvalidEmail] = useState(false);

  const addGuestsMutation = trpc.viewer.bookings.addGuests.useMutation({
    onSuccess: async () => {
      showToast(t(""guests_added""), ""success"");
      setIsOpenDialog(false);
      setMultiEmailValue([""""]);
      utils.viewer.bookings.invalidate();
    },
    onError: (err) => {
      const message = 
---
[High] variable sendAddGuestsEmails in packages/emails/email-manager.ts:
const sendAddGuestsEmails = async (calEvent: CalendarEvent, newGuests: string[]) => {
  const calendarEvent = formatCalEvent(calEvent);

  const emailsToSend: Promise<unknown>[] = [];
  emailsToSend.push(sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent })));

  if (calendarEvent.team?.members) {
    for (const teamMember of calendarEvent.team.members) {
      emailsToSend.push(
        sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent, teamMember }))
      );
    }
  }

  emailsToSend.push(
    ...calendarEvent.attendees.map((attendee) => {
      if (newGuests.includes(attendee.email)) {
        return sendEmail(() => new AttendeeScheduledEmail(calendarEvent, attendee));
      } else {
        return sendEmail(() => new AttendeeAddGuestsEmail(calend
---
[High] variable AttendeeAddGuestsEmail in packages/emails/src/templates/AttendeeAddGuestsEmail.tsx:
const AttendeeAddGuestsEmail = (props: React.ComponentProps<typeof AttendeeScheduledEmail>) => (
  <AttendeeScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    {...props}
  />
);
---
[High] variable OrganizerAddGuestsEmail in packages/emails/src/templates/OrganizerAddGuestsEmail.tsx:
const OrganizerAddGuestsEmail = (props: React.ComponentProps<typeof OrganizerScheduledEmail>) => (
  <OrganizerScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    callToAction={null}
    {...props}
  />
);
---
[High] type AddGuestsOptions in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
type AddGuestsOptions = {
  ctx: {
    user: NonNullable<TrpcSessionUser>;
  };
  input: TAddGuestsInputSchema;
};
---
[High] type TAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
type TAddGuestsInputSchema = z.infer<typeof ZAddGuestsInputSchema>;","[Medium] interface MultiEmailProps in packages/ui/form/MultiEmail.tsx:
interface MultiEmailProps {
  value: string[];
  readOnly: boolean;
  label: string;
  setValue: (value: string[]) => void;
  placeholder?: string;
}
---
[Medium] function MultiEmail in packages/ui/form/MultiEmail.tsx:
function MultiEmail({ value, readOnly, label, setValue, placeholder }: MultiEmailProps) {
  const { t } = useLocale();
  value = value || [];
  const inputClassName =
    ""dark:placeholder:text-muted focus:border-emphasis border-subtle block w-full rounded-md border-default text-sm focus:ring-black disabled:bg-emphasis disabled:hover:cursor-not-allowed dark:selection:bg-green-500 disabled:dark:text-subtle bg-default"";
  return (
    <>
      {value.length ? (
        <div>
          <label htmlF
---
[Medium] export MultiEmail in packages/ui/form/MultiEmail.tsx:
export default MultiEmail;
---
[Medium] export MultiEmail in packages/ui/form/MultiEmailLazy.tsx:
export default MultiEmail;
---
[Medium] class AttendeeAddGuestsEmail in packages/emails/templates/attendee-add-guests-email.ts:
class AttendeeAddGuestsEmail extends AttendeeScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: 
---
[Medium] method getNodeMailerPayload in packages/emails/templates/attendee-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: `${this.attendee.name} <${this.attendee.email}>`,
      from: `$
---
[Medium] class OrganizerAddGuestsEmail in packages/emails/templates/organizer-add-guests-email.ts:
class OrganizerAddGuestsEmail extends OrganizerScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
  
---
[Medium] method getNodeMailerPayload in packages/emails/templates/organizer-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST""
---
[Medium] type BookingsRouterHandlerCache in packages/trpc/server/routers/viewer/bookings/_router.tsx:
type BookingsRouterHandlerCache = {
  get?: typeof import(""./get.handler"").getHandler;
  requestReschedule?: typeof import(""./requestReschedule.handler"").requestRescheduleHandler;
  editLocation?: typeof import(""./editLocation.handler"").editLocationHandler;
  addGuests?: typeof import(""./addGuests.handler"").addGuestsHandler;
  confirm?: typeof import(""./confirm.handler"").confirmHandler;
  getBookingAttendees?: typeof import(""./getBookingAttendees.handler"").getBookingAttendeesHandler;
  find?: ty","bookingsRouter (Critical), BookingListItem (Critical), IAddGuestsDialog (High), ZAddGuestsInputSchema (High), addGuestsHandler (High), AddGuestsDialog (High), sendAddGuestsEmails (High), AttendeeAddGuestsEmail (High), OrganizerAddGuestsEmail (High), AddGuestsOptions (High), TAddGuestsInputSchema (High), MultiEmailProps (Medium), MultiEmail (Medium), MultiEmail (Medium), MultiEmail (Medium), AttendeeAddGuestsEmail (Medium), getNodeMailerPayload (Medium), OrganizerAddGuestsEmail (Medium), getNodeMailerPayload (Medium), BookingsRouterHandlerCache (Medium), new_guests_added (Low), guests_added_event_type_subject (Low), guests_added (Low), unable_to_add_guests (Low), emails_must_be_unique_valid (Low), add_emails (Low), MultiEmail (Low)",match,'out' matches HC entity 'bookingsrouter'
cal_dot_com,10,Add guest management functionality to existing bookings,Starting with an array containing an empty string may cause validation issues. Consider starting with an empty array [] and handling the empty state in the MultiEmail component instead.,Low,27,11,9,"variable::bookingsRouter (packages/trpc/server/routers/viewer/bookings/_router.tsx) [Critical, score=0.72] | function::BookingListItem (apps/web/components/booking/BookingListItem.tsx) [Critical, score=0.71] | interface::IAddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.65] | variable::ZAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.63] | variable::addGuestsHandler (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.59] | variable::AddGuestsDialog (apps/web/components/dialog/AddGuestsDialog.tsx) [High, score=0.53] | variable::sendAddGuestsEmails (packages/emails/email-manager.ts) [High, score=0.53] | variable::AttendeeAddGuestsEmail (packages/emails/src/templates/AttendeeAddGuestsEmail.tsx) [High, score=0.53] | variable::OrganizerAddGuestsEmail (packages/emails/src/templates/OrganizerAddGuestsEmail.tsx) [High, score=0.53] | type::AddGuestsOptions (packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts) [High, score=0.53] | type::TAddGuestsInputSchema (packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts) [High, score=0.53]","[Critical] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings/_router.tsx:
const bookingsRouter = router({
  get: authedProcedure.input(ZGetInputSchema).query(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.get) {
      UNSTABLE_HANDLER_CACHE.get = await import(""./get.handler"").then((mod) => mod.getHandler);
    }

    // Unreachable code but required for type safety
    if (!UNSTABLE_HANDLER_CACHE.get) {
      throw new Error(""Failed to load handler"");
    }

    return UNSTABLE_HANDLER_CACHE.get({
      ctx,
      input,
    });
  }),

  requestReschedule: authedProcedure.input(ZRequestRescheduleInputSchema).mutation(async ({ input, ctx }) => {
    if (!UNSTABLE_HANDLER_CACHE.requestReschedule) {
      UNSTABLE_HANDLER_CACHE.requestReschedule = await import(""./requestReschedule.handler"").then(
        (mod) => mod.requestRescheduleHandler
      );
 
---
[Critical] function BookingListItem in apps/web/components/booking/BookingListItem.tsx:
function BookingListItem(booking: BookingItemProps) {
  const bookerUrl = useBookerUrl();
  const { userId, userTimeZone, userTimeFormat, userEmail } = booking.loggedInUser;

  const {
    t,
    i18n: { language },
  } = useLocale();
  const utils = trpc.useUtils();
  const [chargeCardDialogIsOpen, setChargeCardDialogIsOpen] = useState(false);
  const [viewRecordingsDialogIsOpen, setViewRecordingsDialogIsOpen] = useState<boolean>(false);
  const cardCharged = booking?.payment[0]?.success;
  const mutation = trpc.viewer.bookings.confirm.useMutation({
    onSuccess: () => {
      showToast(t(""booking_confirmation_success""), ""success"");
      utils.viewer.bookings.invalidate();
    },
    onError: () => {
      showToast(t(""booking_confirmation_failed""), ""error"");
      utils.viewer.bookings
---
[High] interface IAddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
interface IAddGuestsDialog {
  isOpenDialog: boolean;
  setIsOpenDialog: Dispatch<SetStateAction<boolean>>;
  bookingId: number;
}
---
[High] variable ZAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
const ZAddGuestsInputSchema = z.object({
  bookingId: z.number(),
  guests: z.array(z.string().email()),
});
---
[High] variable addGuestsHandler in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
const addGuestsHandler = async ({ ctx, input }: AddGuestsOptions) => {
  const { user } = ctx;
  const { bookingId, guests } = input;

  const booking = await prisma.booking.findFirst({
    where: {
      id: bookingId,
    },
    include: {
      attendees: true,
      eventType: true,
      destinationCalendar: true,
      references: true,
      user: {
        include: {
          destinationCalendar: true,
          credentials: true,
        },
      },
    },
  });

  if (!booking) throw new TRPCError({ code: ""NOT_FOUND"", message: ""booking_not_found"" });

  const isTeamAdminOrOwner =
    (await isTeamAdmin(user.id, booking.eventType?.teamId ?? 0)) &&
    (await isTeamOwner(user.id, booking.eventType?.teamId ?? 0));

  const isOrganizer = booking.userId === user.id;

  const isAttend
---
[High] variable AddGuestsDialog in apps/web/components/dialog/AddGuestsDialog.tsx:
const AddGuestsDialog = (props: IAddGuestsDialog) => {
  const { t } = useLocale();
  const ZAddGuestsInputSchema = z.array(z.string().email()).refine((emails) => {
    const uniqueEmails = new Set(emails);
    return uniqueEmails.size === emails.length;
  });
  const { isOpenDialog, setIsOpenDialog, bookingId } = props;
  const utils = trpc.useUtils();
  const [multiEmailValue, setMultiEmailValue] = useState<string[]>([""""]);
  const [isInvalidEmail, setIsInvalidEmail] = useState(false);

  const addGuestsMutation = trpc.viewer.bookings.addGuests.useMutation({
    onSuccess: async () => {
      showToast(t(""guests_added""), ""success"");
      setIsOpenDialog(false);
      setMultiEmailValue([""""]);
      utils.viewer.bookings.invalidate();
    },
    onError: (err) => {
      const message = 
---
[High] variable sendAddGuestsEmails in packages/emails/email-manager.ts:
const sendAddGuestsEmails = async (calEvent: CalendarEvent, newGuests: string[]) => {
  const calendarEvent = formatCalEvent(calEvent);

  const emailsToSend: Promise<unknown>[] = [];
  emailsToSend.push(sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent })));

  if (calendarEvent.team?.members) {
    for (const teamMember of calendarEvent.team.members) {
      emailsToSend.push(
        sendEmail(() => new OrganizerAddGuestsEmail({ calEvent: calendarEvent, teamMember }))
      );
    }
  }

  emailsToSend.push(
    ...calendarEvent.attendees.map((attendee) => {
      if (newGuests.includes(attendee.email)) {
        return sendEmail(() => new AttendeeScheduledEmail(calendarEvent, attendee));
      } else {
        return sendEmail(() => new AttendeeAddGuestsEmail(calend
---
[High] variable AttendeeAddGuestsEmail in packages/emails/src/templates/AttendeeAddGuestsEmail.tsx:
const AttendeeAddGuestsEmail = (props: React.ComponentProps<typeof AttendeeScheduledEmail>) => (
  <AttendeeScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    {...props}
  />
);
---
[High] variable OrganizerAddGuestsEmail in packages/emails/src/templates/OrganizerAddGuestsEmail.tsx:
const OrganizerAddGuestsEmail = (props: React.ComponentProps<typeof OrganizerScheduledEmail>) => (
  <OrganizerScheduledEmail
    title=""new_guests_added""
    headerType=""calendarCircle""
    subject=""guests_added_event_type_subject""
    callToAction={null}
    {...props}
  />
);
---
[High] type AddGuestsOptions in packages/trpc/server/routers/viewer/bookings/addGuests.handler.ts:
type AddGuestsOptions = {
  ctx: {
    user: NonNullable<TrpcSessionUser>;
  };
  input: TAddGuestsInputSchema;
};
---
[High] type TAddGuestsInputSchema in packages/trpc/server/routers/viewer/bookings/addGuests.schema.ts:
type TAddGuestsInputSchema = z.infer<typeof ZAddGuestsInputSchema>;","[Medium] interface MultiEmailProps in packages/ui/form/MultiEmail.tsx:
interface MultiEmailProps {
  value: string[];
  readOnly: boolean;
  label: string;
  setValue: (value: string[]) => void;
  placeholder?: string;
}
---
[Medium] function MultiEmail in packages/ui/form/MultiEmail.tsx:
function MultiEmail({ value, readOnly, label, setValue, placeholder }: MultiEmailProps) {
  const { t } = useLocale();
  value = value || [];
  const inputClassName =
    ""dark:placeholder:text-muted focus:border-emphasis border-subtle block w-full rounded-md border-default text-sm focus:ring-black disabled:bg-emphasis disabled:hover:cursor-not-allowed dark:selection:bg-green-500 disabled:dark:text-subtle bg-default"";
  return (
    <>
      {value.length ? (
        <div>
          <label htmlF
---
[Medium] export MultiEmail in packages/ui/form/MultiEmail.tsx:
export default MultiEmail;
---
[Medium] export MultiEmail in packages/ui/form/MultiEmailLazy.tsx:
export default MultiEmail;
---
[Medium] class AttendeeAddGuestsEmail in packages/emails/templates/attendee-add-guests-email.ts:
class AttendeeAddGuestsEmail extends AttendeeScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: 
---
[Medium] method getNodeMailerPayload in packages/emails/templates/attendee-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""attendee"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST"",
      },
      to: `${this.attendee.name} <${this.attendee.email}>`,
      from: `$
---
[Medium] class OrganizerAddGuestsEmail in packages/emails/templates/organizer-add-guests-email.ts:
class OrganizerAddGuestsEmail extends OrganizerScheduledEmail {
  protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
  
---
[Medium] method getNodeMailerPayload in packages/emails/templates/organizer-add-guests-email.ts:
protected async getNodeMailerPayload(): Promise<Record<string, unknown>> {
    const toAddresses = [this.teamMember?.email || this.calEvent.organizer.email];

    return {
      icalEvent: {
        filename: ""event.ics"",
        content: generateIcsString({
          event: this.calEvent,
          title: this.t(""new_guests_added""),
          subtitle: this.t(""emailed_you_and_any_other_attendees""),
          role: ""organizer"",
          status: ""CONFIRMED"",
        }),
        method: ""REQUEST""
---
[Medium] type BookingsRouterHandlerCache in packages/trpc/server/routers/viewer/bookings/_router.tsx:
type BookingsRouterHandlerCache = {
  get?: typeof import(""./get.handler"").getHandler;
  requestReschedule?: typeof import(""./requestReschedule.handler"").requestRescheduleHandler;
  editLocation?: typeof import(""./editLocation.handler"").editLocationHandler;
  addGuests?: typeof import(""./addGuests.handler"").addGuestsHandler;
  confirm?: typeof import(""./confirm.handler"").confirmHandler;
  getBookingAttendees?: typeof import(""./getBookingAttendees.handler"").getBookingAttendeesHandler;
  find?: ty","bookingsRouter (Critical), BookingListItem (Critical), IAddGuestsDialog (High), ZAddGuestsInputSchema (High), addGuestsHandler (High), AddGuestsDialog (High), sendAddGuestsEmails (High), AttendeeAddGuestsEmail (High), OrganizerAddGuestsEmail (High), AddGuestsOptions (High), TAddGuestsInputSchema (High), MultiEmailProps (Medium), MultiEmail (Medium), MultiEmail (Medium), MultiEmail (Medium), AttendeeAddGuestsEmail (Medium), getNodeMailerPayload (Medium), OrganizerAddGuestsEmail (Medium), getNodeMailerPayload (Medium), BookingsRouterHandlerCache (Medium), new_guests_added (Low), guests_added_event_type_subject (Low), guests_added (Low), unable_to_add_guests (Low), emails_must_be_unique_valid (Low), add_emails (Low), MultiEmail (Low)",match,'MultiEmail' matches entity 'multiemailprops'
cal_dot_com,9,SMS workflow reminder retry count tracking,Using retryCount: reminder.retryCount + 1 reads a possibly stale value and can lose increments under concurrency; consider an atomic increment via Prisma (increment: 1) to avoid race conditions (also applies to the similar update in the catch block).,High,23,0,20,,,"[Medium] function handler in packages/features/ee/workflows/api/scheduleSMSReminders.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }

  //delete all scheduled sms reminders where scheduled date is past current date
  await prisma.workflowReminder.deleteMany({
    where: {
      OR: [
        {
          method: WorkflowMethods.SMS,
          scheduledDate: {
            lte: da
---
[Medium] chunk lines 981-1000 in packages/prisma/schema.prisma:
enum TimeUnit {
  DAY    @map(""day"")
  HOUR   @map(""hour"")
  MINUTE @map(""minute"")
}

model WorkflowReminder {
  id                  Int             @id @default(autoincrement())
  bookingUid          String?
  booking             Booking?        @relation(fields: [bookingUid], references: [uid])
  method              WorkflowMethods
  scheduledDate       DateTime
  referenceId         String?         @unique
  scheduled           Boolean
  workflowStepId      Int?
  workflowStep        Workflow
---
[Medium] chunk lines 1001-1020 in packages/prisma/schema.prisma:

  @@index([bookingUid])
  @@index([workflowStepId])
  @@index([seatReferenceId])
  @@index([method, scheduled, scheduledDate])
  @@index([cancelled, scheduledDate])
}

model WebhookScheduledTriggers {
  id            Int       @id @default(autoincrement())
  jobName       String? // jobName is deprecated, not needed when webhook and booking is set
  subscriberUrl String
  payload       String
  startAfter    DateTime
  retryCount    Int       @default(0)
  createdAt     DateTime? @default(now()
---
[Medium] chunk lines 1121-1140 in packages/prisma/schema.prisma:
  scopes    AccessScope[]
  userId    Int?
  user      User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  teamId    Int?
  team      Team?         @relation(fields: [teamId], references: [id], onDelete: Cascade)
}

enum AccessScope {
  READ_BOOKING
  READ_PROFILE
}

view BookingTimeStatus {
  id             Int            @unique
  uid            String?
  eventTypeId    Int?
  title          String?
  description    String?
  startTime      DateTime?
  endTime     
---
[Medium] chunk lines 1081-1100 in packages/prisma/schema.prisma:
  @@index([enabled])
  @@index([stale])
}

enum FeatureType {
  RELEASE
  EXPERIMENT
  OPERATIONAL
  KILL_SWITCH
  PERMISSION
}

model SelectedSlots {
  id               Int      @id @default(autoincrement())
  eventTypeId      Int
  userId           Int
  slotUtcStartDate DateTime
  slotUtcEndDate   DateTime
  uid              String
  releaseAt        DateTime
---
[Medium] chunk lines 1141-1160 in packages/prisma/schema.prisma:
  createdAt      DateTime?
  location       String?
  paid           Boolean?
  status         BookingStatus?
  rescheduled    Boolean?
  userId         Int?
  teamId         Int?
  eventLength    Int?
  timeStatus     String?
  eventParentId  Int?
  userEmail      String?
  username       String?
  ratingFeedback String?
  rating         Int?
  noShowHost     Boolean?
}

model CalendarCache {
  // The key would be the unique URL that is requested by the user
  key          String
---
[Medium] chunk lines 1201-1220 in packages/prisma/schema.prisma:
  objectKey String @unique

  isBanner Boolean @default(false)

  @@unique([teamId, userId, isBanner])
  @@map(name: ""avatars"")
}

model OutOfOfficeEntry {
  id       Int                @id @default(autoincrement())
  uuid     String             @unique
  start    DateTime
  end      DateTime
  notes    String?
  userId   Int
  user     User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  toUserId Int?
  toUser   User?              @relation(name: ""toUser"", field
---
[Medium] chunk lines 1301-1320 in packages/prisma/schema.prisma:
  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int
}

model DSyncData {
  id               Int                     @id @default(autoincrement())
  directoryId      String                  @unique
  tenant           String
  organizationId   Int?                    @unique
  org          
---
[Medium] chunk lines 1341-1360 in packages/prisma/schema.prisma:
}

// Needed to store tasks that need to be processed by a background worker or Tasker
model Task {
  id          String    @id @unique @default(uuid())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  // The time at which the task should be executed
  scheduledAt DateTime  @default(now())
  // The time at which the task was successfully executed
  succeededAt DateTime?
  // The task type to be executed. Left it as a freeform string to avoid more migrations for now. W
---
[Medium] chunk lines 1161-1180 in packages/prisma/schema.prisma:
  value        Json
  expiresAt    DateTime
  credentialId Int
  credential   Credential? @relation(fields: [credentialId], references: [id], onDelete: Cascade)

  @@id([credentialId, key])
  @@unique([credentialId, key])
}

enum RedirectType {
  UserEventType @map(""user-event-type"")
  TeamEventType @map(""team-event-type"")
  User          @map(""user"")
  Team          @map(""team"")
}

model TempOrgRedirect {
  id        Int          @id @default(autoincrement())
  // Better would be to have fromOr
---
[Medium] chunk lines 1041-1060 in packages/prisma/schema.prisma:
  referenceUid String   @unique
  bookingId    Int
  booking      Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  attendeeId   Int      @unique
  attendee     Attendee @relation(fields: [attendeeId], references: [id], onDelete: Cascade)
  /// @zod.custom(imports.bookingSeatDataSchema)
  data         Json?

  @@index([bookingId])
  @@index([attendeeId])
}

model VerifiedNumber {
  id          Int    @id @default(autoincrement())
  userId      Int?
  user        User
---
[Medium] chunk lines 1241-1260 in packages/prisma/schema.prisma:

// Platform
model PlatformOAuthClient {
  id             String   @id @default(cuid())
  name           String
  secret         String
  permissions    Int
  users          User[]
  logo           String?
  redirectUris   String[]
  organizationId Int
  organization   Team     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  accessTokens        AccessToken[]
  refreshToken        RefreshToken[]
  authorizationTokens PlatformAuthorizationToken[]

  bookingRedirectUri  
---
[Medium] chunk lines 1021-1040 in packages/prisma/schema.prisma:
  booking       Booking?  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
}

enum WorkflowTemplates {
  REMINDER
  CUSTOM
  CANCELLED
  RESCHEDULED
  COMPLETED
  RATING
}

enum WorkflowMethods {
  EMAIL
  SMS
  WHATSAPP
}

model BookingSeat {
  id           Int      @id @default(autoincrement())
---
[Medium] chunk lines 1181-1200 in packages/prisma/schema.prisma:
  // 0 would mean it is non org
  fromOrgId Int
  type      RedirectType
  // It doesn't have any query params
  toUrl     String
  enabled   Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@unique([from, type, fromOrgId])
}

model Avatar {
  // e.g. NULL(0), organization ID or team logo
  teamId    Int    @default(0)
  // Avatar, NULL(0) if team logo
  userId    Int    @default(0)
  // base64 string
  data      String
  // different e
---
[Medium] chunk lines 1261-1280 in packages/prisma/schema.prisma:
  areEmailsEnabled             Boolean @default(false)

  createdAt DateTime @default(now())
}

model PlatformAuthorizationToken {
  id String @id @default(cuid())

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int

  createdAt DateTime @default(now())

  @@unique([userId, platformOAuth
---
[Medium] chunk lines 1321-1340 in packages/prisma/schema.prisma:
  team           Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  directoryId    String
  directory      DSyncData @relation(fields: [directoryId], references: [directoryId], onDelete: Cascade)
  groupName      String

  @@unique([teamId, groupName])
}

model SecondaryEmail {
  id                 Int                 @id @default(autoincrement())
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          
---
[Medium] chunk lines 1061-1080 in packages/prisma/schema.prisma:
  @@index([userId])
  @@index([teamId])
}

model Feature {
  // The feature slug, ex: 'v2-workflows'
  slug        String       @id @unique
  // If the feature is currently enabled
  enabled     Boolean      @default(false)
  // A short description of the feature
  description String?
  // The type of feature flag
  type        FeatureType? @default(RELEASE)
  // If the flag is considered stale
  stale       Boolean?     @default(false)
  lastUsedAt  DateTime?
  createdAt   DateTime?    @default
---
[Medium] chunk lines 1361-1380 in packages/prisma/schema.prisma:
}

enum SMSLockState {
  LOCKED
  UNLOCKED
  REVIEW_NEEDED
}

model PlatformBilling {
  id Int @id @unique // team id

  customerId     String  @unique
  subscriptionId String?
  plan           String  @default(""none"")

  billingCycleStart Int?
  billingCycleEnd   Int?
  overdue           Boolean? @default(false)

  team Team @relation(fields: [id], references: [id], onDelete: Cascade)
---
[Medium] chunk lines 1101-1120 in packages/prisma/schema.prisma:
  isSeat           Boolean  @default(false)

  @@unique(fields: [userId, slotUtcStartDate, slotUtcEndDate, uid], name: ""selectedSlotUnique"")
}

model OAuthClient {
  clientId     String       @id @unique
  redirectUri  String
  clientSecret String
  name         String
  logo         String?
  accessCodes  AccessCode[]
}

model AccessCode {
  id        Int           @id @default(autoincrement())
  code      String
  clientId  String?
  client    OAuthClient?  @relation(fields: [clientId], refere
---
[Medium] chunk lines 1281-1300 in packages/prisma/schema.prisma:
  id Int @id @default(autoincrement())

  secret    String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int
}

model RefreshToken {
  id Int @id @default(autoincrement())

  secret    String   @unique
  createdAt Date","handler (Medium), lines 981-1000 (Medium), lines 1001-1020 (Medium), lines 1121-1140 (Medium), lines 1081-1100 (Medium), lines 1141-1160 (Medium), lines 1201-1220 (Medium), lines 1301-1320 (Medium), lines 1341-1360 (Medium), lines 1161-1180 (Medium), lines 1041-1060 (Medium), lines 1241-1260 (Medium), lines 1021-1040 (Medium), lines 1181-1200 (Medium), lines 1261-1280 (Medium), lines 1321-1340 (Medium), lines 1061-1080 (Medium), lines 1361-1380 (Medium), lines 1101-1120 (Medium), lines 1281-1300 (Medium), lines 1-2 (Low), lines 1381-1381 (Low), lines 1221-1240 (Low)",miss,"no HC entities, only Medium line-range chunks"
cal_dot_com,9,SMS workflow reminder retry count tracking,"The deletion logic in scheduleSMSReminders.ts incorrectly deletes non-SMS workflow reminders (e.g., Email, WhatsApp) that have retryCount > 1. This occurs because the retryCount condition within the OR clause for deletion lacks a method: WorkflowMethods.SMS filter, causing it to apply to all reminder types instead of only SMS reminders, which is the intended scope of this function.",High,23,0,20,,,"[Medium] function handler in packages/features/ee/workflows/api/scheduleSMSReminders.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }

  //delete all scheduled sms reminders where scheduled date is past current date
  await prisma.workflowReminder.deleteMany({
    where: {
      OR: [
        {
          method: WorkflowMethods.SMS,
          scheduledDate: {
            lte: da
---
[Medium] chunk lines 981-1000 in packages/prisma/schema.prisma:
enum TimeUnit {
  DAY    @map(""day"")
  HOUR   @map(""hour"")
  MINUTE @map(""minute"")
}

model WorkflowReminder {
  id                  Int             @id @default(autoincrement())
  bookingUid          String?
  booking             Booking?        @relation(fields: [bookingUid], references: [uid])
  method              WorkflowMethods
  scheduledDate       DateTime
  referenceId         String?         @unique
  scheduled           Boolean
  workflowStepId      Int?
  workflowStep        Workflow
---
[Medium] chunk lines 1001-1020 in packages/prisma/schema.prisma:

  @@index([bookingUid])
  @@index([workflowStepId])
  @@index([seatReferenceId])
  @@index([method, scheduled, scheduledDate])
  @@index([cancelled, scheduledDate])
}

model WebhookScheduledTriggers {
  id            Int       @id @default(autoincrement())
  jobName       String? // jobName is deprecated, not needed when webhook and booking is set
  subscriberUrl String
  payload       String
  startAfter    DateTime
  retryCount    Int       @default(0)
  createdAt     DateTime? @default(now()
---
[Medium] chunk lines 1121-1140 in packages/prisma/schema.prisma:
  scopes    AccessScope[]
  userId    Int?
  user      User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  teamId    Int?
  team      Team?         @relation(fields: [teamId], references: [id], onDelete: Cascade)
}

enum AccessScope {
  READ_BOOKING
  READ_PROFILE
}

view BookingTimeStatus {
  id             Int            @unique
  uid            String?
  eventTypeId    Int?
  title          String?
  description    String?
  startTime      DateTime?
  endTime     
---
[Medium] chunk lines 1081-1100 in packages/prisma/schema.prisma:
  @@index([enabled])
  @@index([stale])
}

enum FeatureType {
  RELEASE
  EXPERIMENT
  OPERATIONAL
  KILL_SWITCH
  PERMISSION
}

model SelectedSlots {
  id               Int      @id @default(autoincrement())
  eventTypeId      Int
  userId           Int
  slotUtcStartDate DateTime
  slotUtcEndDate   DateTime
  uid              String
  releaseAt        DateTime
---
[Medium] chunk lines 1141-1160 in packages/prisma/schema.prisma:
  createdAt      DateTime?
  location       String?
  paid           Boolean?
  status         BookingStatus?
  rescheduled    Boolean?
  userId         Int?
  teamId         Int?
  eventLength    Int?
  timeStatus     String?
  eventParentId  Int?
  userEmail      String?
  username       String?
  ratingFeedback String?
  rating         Int?
  noShowHost     Boolean?
}

model CalendarCache {
  // The key would be the unique URL that is requested by the user
  key          String
---
[Medium] chunk lines 1201-1220 in packages/prisma/schema.prisma:
  objectKey String @unique

  isBanner Boolean @default(false)

  @@unique([teamId, userId, isBanner])
  @@map(name: ""avatars"")
}

model OutOfOfficeEntry {
  id       Int                @id @default(autoincrement())
  uuid     String             @unique
  start    DateTime
  end      DateTime
  notes    String?
  userId   Int
  user     User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  toUserId Int?
  toUser   User?              @relation(name: ""toUser"", field
---
[Medium] chunk lines 1301-1320 in packages/prisma/schema.prisma:
  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int
}

model DSyncData {
  id               Int                     @id @default(autoincrement())
  directoryId      String                  @unique
  tenant           String
  organizationId   Int?                    @unique
  org          
---
[Medium] chunk lines 1341-1360 in packages/prisma/schema.prisma:
}

// Needed to store tasks that need to be processed by a background worker or Tasker
model Task {
  id          String    @id @unique @default(uuid())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  // The time at which the task should be executed
  scheduledAt DateTime  @default(now())
  // The time at which the task was successfully executed
  succeededAt DateTime?
  // The task type to be executed. Left it as a freeform string to avoid more migrations for now. W
---
[Medium] chunk lines 1161-1180 in packages/prisma/schema.prisma:
  value        Json
  expiresAt    DateTime
  credentialId Int
  credential   Credential? @relation(fields: [credentialId], references: [id], onDelete: Cascade)

  @@id([credentialId, key])
  @@unique([credentialId, key])
}

enum RedirectType {
  UserEventType @map(""user-event-type"")
  TeamEventType @map(""team-event-type"")
  User          @map(""user"")
  Team          @map(""team"")
}

model TempOrgRedirect {
  id        Int          @id @default(autoincrement())
  // Better would be to have fromOr
---
[Medium] chunk lines 1041-1060 in packages/prisma/schema.prisma:
  referenceUid String   @unique
  bookingId    Int
  booking      Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  attendeeId   Int      @unique
  attendee     Attendee @relation(fields: [attendeeId], references: [id], onDelete: Cascade)
  /// @zod.custom(imports.bookingSeatDataSchema)
  data         Json?

  @@index([bookingId])
  @@index([attendeeId])
}

model VerifiedNumber {
  id          Int    @id @default(autoincrement())
  userId      Int?
  user        User
---
[Medium] chunk lines 1241-1260 in packages/prisma/schema.prisma:

// Platform
model PlatformOAuthClient {
  id             String   @id @default(cuid())
  name           String
  secret         String
  permissions    Int
  users          User[]
  logo           String?
  redirectUris   String[]
  organizationId Int
  organization   Team     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  accessTokens        AccessToken[]
  refreshToken        RefreshToken[]
  authorizationTokens PlatformAuthorizationToken[]

  bookingRedirectUri  
---
[Medium] chunk lines 1021-1040 in packages/prisma/schema.prisma:
  booking       Booking?  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
}

enum WorkflowTemplates {
  REMINDER
  CUSTOM
  CANCELLED
  RESCHEDULED
  COMPLETED
  RATING
}

enum WorkflowMethods {
  EMAIL
  SMS
  WHATSAPP
}

model BookingSeat {
  id           Int      @id @default(autoincrement())
---
[Medium] chunk lines 1181-1200 in packages/prisma/schema.prisma:
  // 0 would mean it is non org
  fromOrgId Int
  type      RedirectType
  // It doesn't have any query params
  toUrl     String
  enabled   Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@unique([from, type, fromOrgId])
}

model Avatar {
  // e.g. NULL(0), organization ID or team logo
  teamId    Int    @default(0)
  // Avatar, NULL(0) if team logo
  userId    Int    @default(0)
  // base64 string
  data      String
  // different e
---
[Medium] chunk lines 1261-1280 in packages/prisma/schema.prisma:
  areEmailsEnabled             Boolean @default(false)

  createdAt DateTime @default(now())
}

model PlatformAuthorizationToken {
  id String @id @default(cuid())

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int

  createdAt DateTime @default(now())

  @@unique([userId, platformOAuth
---
[Medium] chunk lines 1321-1340 in packages/prisma/schema.prisma:
  team           Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  directoryId    String
  directory      DSyncData @relation(fields: [directoryId], references: [directoryId], onDelete: Cascade)
  groupName      String

  @@unique([teamId, groupName])
}

model SecondaryEmail {
  id                 Int                 @id @default(autoincrement())
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          
---
[Medium] chunk lines 1061-1080 in packages/prisma/schema.prisma:
  @@index([userId])
  @@index([teamId])
}

model Feature {
  // The feature slug, ex: 'v2-workflows'
  slug        String       @id @unique
  // If the feature is currently enabled
  enabled     Boolean      @default(false)
  // A short description of the feature
  description String?
  // The type of feature flag
  type        FeatureType? @default(RELEASE)
  // If the flag is considered stale
  stale       Boolean?     @default(false)
  lastUsedAt  DateTime?
  createdAt   DateTime?    @default
---
[Medium] chunk lines 1361-1380 in packages/prisma/schema.prisma:
}

enum SMSLockState {
  LOCKED
  UNLOCKED
  REVIEW_NEEDED
}

model PlatformBilling {
  id Int @id @unique // team id

  customerId     String  @unique
  subscriptionId String?
  plan           String  @default(""none"")

  billingCycleStart Int?
  billingCycleEnd   Int?
  overdue           Boolean? @default(false)

  team Team @relation(fields: [id], references: [id], onDelete: Cascade)
---
[Medium] chunk lines 1101-1120 in packages/prisma/schema.prisma:
  isSeat           Boolean  @default(false)

  @@unique(fields: [userId, slotUtcStartDate, slotUtcEndDate, uid], name: ""selectedSlotUnique"")
}

model OAuthClient {
  clientId     String       @id @unique
  redirectUri  String
  clientSecret String
  name         String
  logo         String?
  accessCodes  AccessCode[]
}

model AccessCode {
  id        Int           @id @default(autoincrement())
  code      String
  clientId  String?
  client    OAuthClient?  @relation(fields: [clientId], refere
---
[Medium] chunk lines 1281-1300 in packages/prisma/schema.prisma:
  id Int @id @default(autoincrement())

  secret    String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime

  owner  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  client PlatformOAuthClient @relation(fields: [platformOAuthClientId], references: [id], onDelete: Cascade)

  platformOAuthClientId String
  userId                Int
}

model RefreshToken {
  id Int @id @default(autoincrement())

  secret    String   @unique
  createdAt Date","handler (Medium), lines 981-1000 (Medium), lines 1001-1020 (Medium), lines 1121-1140 (Medium), lines 1081-1100 (Medium), lines 1141-1160 (Medium), lines 1201-1220 (Medium), lines 1301-1320 (Medium), lines 1341-1360 (Medium), lines 1161-1180 (Medium), lines 1041-1060 (Medium), lines 1241-1260 (Medium), lines 1021-1040 (Medium), lines 1181-1200 (Medium), lines 1261-1280 (Medium), lines 1321-1340 (Medium), lines 1061-1080 (Medium), lines 1361-1380 (Medium), lines 1101-1120 (Medium), lines 1281-1300 (Medium), lines 1-2 (Low), lines 1381-1381 (Low), lines 1221-1240 (Low)",miss,"no HC entities, only Medium chunks"
cal_dot_com,8,OAuth credential sync and app integration enhancements,"The parseRefreshTokenResponse function incorrectly sets refresh_token to the hardcoded string 'refresh_token' when it's missing from the OAuth refresh token response. This invalidates the token, breaking subsequent token refreshes and causing authentication failures.",High,39,6,28,"variable::APP_CREDENTIAL_SHARING_ENABLED (packages/lib/constants.ts) [Critical, score=0.83] | function::decodeOAuthState (packages/app-store/_utils/oauth/decodeOAuthState.ts) [Critical, score=0.73] | function::encodeOAuthState (packages/app-store/_utils/oauth/encodeOAuthState.ts) [High, score=0.67] | variable::createOAuthAppCredential (packages/app-store/_utils/oauth/createOAuthAppCredential.ts) [High, score=0.64] | variable::minimumTokenResponseSchema (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59] | variable::parseRefreshTokenResponse (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59]","[Critical] variable APP_CREDENTIAL_SHARING_ENABLED in packages/lib/constants.ts:
const APP_CREDENTIAL_SHARING_ENABLED =
  process.env.CALCOM_WEBHOOK_SECRET && process.env.CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY;
---
[Critical] function decodeOAuthState in packages/app-store/_utils/oauth/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[High] function encodeOAuthState in packages/app-store/_utils/oauth/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[High] variable createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFirst({
      where: {
        id: state.teamId,
        members: {
          some: {
            userId: req.session?.user.id,
            accepted: true,
          },
        },
      },
      select: { id: true, members: { select: { userId: true } } },
    });

    if (!team) throw new Error(""User d
---
[High] variable minimumTokenResponseSchema in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const minimumTokenResponseSchema = z.object({
  access_token: z.string(),
  //   Assume that any property with a number is the expiry
  [z.string().toString()]: z.number(),
  //   Allow other properties in the token response
  [z.string().optional().toString()]: z.unknown().optional(),
});
---
[High] variable parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const parseRefreshTokenResponse = (response: any, schema: z.ZodTypeAny) => {
  let refreshTokenResponse;
  if (APP_CREDENTIAL_SHARING_ENABLED && process.env.CALCOM_CREDENTIAL_SYNC_ENDPOINT) {
    refreshTokenResponse = minimumTokenResponseSchema.safeParse(response);
  } else {
    refreshTokenResponse = schema.safeParse(response);
  }

  if (!refreshTokenResponse.success) {
    throw new Error(""Invalid refreshed tokens were returned"");
  }

  if (!refreshTokenResponse.data.refresh_token) {
    refreshTokenResponse.data.refresh_token = ""refresh_token"";
  }

  return refreshTokenResponse;
};","[Medium] field refreshAccessToken in packages/app-store/larkcalendar/lib/CalendarService.ts:
private refreshAccessToken = async (credential: CredentialPayload) => {
    const larkAuthCredentials = credential.key as LarkAuthCredentials;
    const refreshExpireDate = larkAuthCredentials.refresh_expires_date;
    const refreshToken = larkAuthCredentials.refresh_token;
    if (isExpired(refreshExpireDate) || !refreshToken) {
      await prisma.credential.delete({ where: { id: credential.id } });
      throw new Error(""Lark Calendar refresh token expired"");
    }
    try {
      const appAcc
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credential;
---
[Medium] variable webexAuth in packages/app-store/webex/lib/VideoApiAdapter.ts:
const webexAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getWebexAppKeys();

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://webexapis.com/v1/access_token"", {
          method: ""POST"",
          headers: {
            ""Content-type"": ""application/x-www-form-urlencoded"",
          },
          body: new URLSearchParams({
            grant_type: 
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] export parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
export default parseRefreshTokenResponse;
---
[Medium] export refreshOAuthTokens in packages/app-store/_utils/oauth/refreshOAuthTokens.ts:
export default refreshOAuthTokens;
---
[Medium] chunk lines 241-246 in .env.example:
E2E_TEST_OIDC_PROVIDER_DOMAIN=

E2E_TEST_OIDC_USER_EMAIL=
E2E_TEST_OIDC_USER_PASSWORD=

# ***********************************************************************************************************
---
[Medium] variable createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFir
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] function decodeOAuthState in packages/app-store/_utils/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[Medium] function encodeOAuthState in packages/app-store/_utils/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.credential = credential;
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credent
---
[Medium] field googleAuth in packages/app-store/googlecalendar/lib/CalendarService.ts:
private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCredentialSchema.parse(credential.key);

    async function getGoogleAuth() {
      const { client_id, client_secret, redirect_uris } = await getGoogleAppKeys();
      const myGoogleAuth = new MyGoogleAuth(client_id, client_secret, redirect_uris[0]);
      myGoogleAuth.setCredentials(googleCredentials);
      return myGoogleAuth;
    }

    const refreshAccessToken = async (myGoogleAuth: Awaited<ReturnT
---
[Medium] chunk lines 221-240 in .env.example:
# Get it from https://vercel.com/<TEAM_OR_USER_NAME>/<PROJECT_SLUG>/settings
PROJECT_ID_VERCEL=
# Get it from: https://vercel.com/teams/<TEAM_SLUG>/settings
TEAM_ID_VERCEL=
# Get it from: https://vercel.com/account/tokens
AUTH_BEARER_TOKEN_VERCEL=

#   - APPLE CALENDAR
# Used for E2E tests on Apple Calendar
E2E_TEST_APPLE_CALENDAR_EMAIL=""""
E2E_TEST_APPLE_CALENDAR_PASSWORD=""""

# - APP CREDENTIAL SYNC ***********************************************************************************
# Used for se
---
[Medium] field hubspotAuth in packages/app-store/hubspot/lib/CalendarService.ts:
private hubspotAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""hubspot"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Hubspot client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Hubspot cl
---
[Medium] class HubspotCalendarService in packages/app-store/hubspot/lib/CalendarService.ts:
class HubspotCalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<HubspotToken | void | never[]> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""hubspot_other_calendar"";

    this.auth = this.hubspotAuth(credential).then((r) => r);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);
    this.credential = credential;

---
[Medium] field o365Auth in packages/app-store/office365calendar/lib/CalendarService.ts:
private o365Auth = (credential: CredentialPayload) => {
    const isExpired = (expiryDate: number) => {
      if (!expiryDate) {
        return true;
      } else {
        return expiryDate < Math.round(+new Date() / 1000);
      }
    };
    const o365AuthCredentials = credential.key as O365AuthCredentials;

    const refreshAccessToken = async (o365AuthCredentials: O365AuthCredentials) => {
      const { client_id, client_secret } = await getOfficeAppKeys();
      const response = await refre
---
[Medium] variable o365Auth in packages/app-store/office365video/lib/VideoApiAdapter.ts:
const o365Auth = async (credential: CredentialPayload) => {
  const appKeys = await getAppKeysFromSlug(""msteams"");
  if (typeof appKeys.client_id === ""string"") client_id = appKeys.client_id;
  if (typeof appKeys.client_secret === ""string"") client_secret = appKeys.client_secret;
  if (!client_id) throw new HttpError({ statusCode: 400, message: ""MS teams client_id missing."" });
  if (!client_secret) throw new HttpError({ statusCode: 400, message: ""MS teams client_secret missing."" });

  const isEx
---
[Medium] field getClient in packages/app-store/salesforce/lib/CalendarService.ts:
private getClient = async (credential: CredentialPayload) => {
    let consumer_key = """";
    let consumer_secret = """";

    const appKeys = await getAppKeysFromSlug(""salesforce"");
    if (typeof appKeys.consumer_key === ""string"") consumer_key = appKeys.consumer_key;
    if (typeof appKeys.consumer_secret === ""string"") consumer_secret = appKeys.consumer_secret;
    if (!consumer_key)
      throw new HttpError({ statusCode: 400, message: ""Salesforce consumer key is missing."" });
    if (!consumer
---
[Medium] class SalesforceCalendarService in packages/app-store/salesforce/lib/CalendarService.ts:
class SalesforceCalendarService implements Calendar {
  private integrationName = """";
  private conn: Promise<jsforce.Connection>;
  private log: typeof logger;
  private calWarnings: string[] = [];

  constructor(credential: CredentialPayload) {
    this.integrationName = ""salesforce_other_calendar"";
    this.conn = this.getClient(credential).then((c) => c);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private getClient = async (credential: Creden
---
[Medium] function handler in packages/app-store/zoho-bigin/api/add.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === ""GET"") {
    const appKeys = await getAppKeysFromSlug(appConfig.slug);

    const clientId = typeof appKeys.client_id === ""string"" ? appKeys.client_id : """";
    if (!clientId) return res.status(400).json({ message: ""Zoho Bigin client_id missing."" });

    const redirectUri = WEBAPP_URL + `/api/integrations/zoho-bigin/callback`;

    const authUrl = axios.getUri({
      url: ""https://accounts.zoho.com/oauth/v
---
[Medium] method refreshAccessToken in packages/app-store/zoho-bigin/lib/CalendarService.ts:
private async refreshAccessToken(credentialId: number, credentialKey: BiginToken) {
    this.log.debug(""Refreshing token as it's invalid"");
    const grantType = ""refresh_token"";
    const accountsUrl = `${credentialKey.accountServer}/oauth/v2/token`;

    const appKeys = await getAppKeysFromSlug(this.integrationName);

    const { client_id: clientId, client_secret: clientSecret } = appKeysSchema.parse(appKeys);

    const formData = {
      grant_type: grantType,
      client_id: clientId,
   
---
[Medium] class BiginCalendarService in packages/app-store/zoho-bigin/lib/CalendarService.ts:
class BiginCalendarService implements Calendar {
  private readonly integrationName = ""zoho-bigin"";
  private readonly auth: { getToken: () => Promise<BiginToken> };
  private log: typeof logger;
  private eventsSlug = ""/bigin/v1/Events"";
  private contactsSlug = ""/bigin/v1/Contacts"";

  constructor(credential: CredentialPayload) {
    this.auth = this.biginAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  /***
   * Authenticate calend
---
[Medium] field zohoCrmAuth in packages/app-store/zohocrm/lib/CalendarService.ts:
private zohoCrmAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""zohocrm"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Zoho CRM client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Zoho CRM 
---
[Medium] class ZohoCrmCalendarService in packages/app-store/zohocrm/lib/CalendarService.ts:
class ZohoCrmCalendarService implements Calendar {
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<void> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";
  private accessToken = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""zohocrm_other_calendar"";
    this.auth = this.zohoCrmAuth(credential).then((r) => r);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`]
---
[Medium] variable zoomAuth in packages/app-store/zoomvideo/lib/VideoApiAdapter.ts:
const zoomAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getZoomAppKeys();
    const authHeader = ""Basic "" + Buffer.from(client_id + "":"" + client_secret).toString(""base64"");

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://zoom.us/oauth/token"", {
          method: ""POST"",
          headers: {
            Authorization: authHeader,
            ""C
---
[Medium] object globalEnv in turbo.json:
  ""globalEnv"": [
    ""ALLOWED_HOSTNAMES"",
    ""ANALYZE"",
    ""API_KEY_PREFIX"",
    ""APP_USER_NAME"",
    ""BASECAMP3_CLIENT_ID"",
    ""BASECAMP3_CLIENT_SECRET"",
    ""BASECAMP3_USER_AGENT"",
    ""AUTH_BEARER_TOKEN_VERCEL"",
    ""BUILD_ID"",
    ""CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY"",
    ""CALCOM_CREDENTIAL_SYNC_ENDPOINT"",
    ""CALCOM_ENV"",
    ""CALCOM_LICENSE_KEY"",
    ""CALCOM_TELEMETRY_DISABLED"",
    ""CALCOM_WEBHOOK_HEADER_NAME"",
    ""CALENDSO_ENCRYPTION_KEY"",
    ""CALCOM_WEBHOOK_SECRET"",
    ""CI"",
  ","APP_CREDENTIAL_SHARING_ENABLED (Critical), decodeOAuthState (Critical), encodeOAuthState (High), createOAuthAppCredential (High), minimumTokenResponseSchema (High), parseRefreshTokenResponse (High), refreshAccessToken (Medium), LarkCalendarService (Medium), webexAuth (Medium), createOAuthAppCredential (Medium), parseRefreshTokenResponse (Medium), refreshOAuthTokens (Medium), lines 241-246 (Medium), createOAuthAppCredential (Medium), createOAuthAppCredential (Medium), decodeOAuthState (Medium), encodeOAuthState (Medium), GoogleCalendarService (Medium), googleAuth (Medium), lines 221-240 (Medium), hubspotAuth (Medium), HubspotCalendarService (Medium), Office365CalendarService (Medium), o365Auth (Medium), o365Auth (Medium), getClient (Medium), SalesforceCalendarService (Medium), handler (Medium), refreshAccessToken (Medium), BiginCalendarService (Medium), zohoCrmAuth (Medium), ZohoCrmCalendarService (Medium), zoomAuth (Medium), globalEnv (Medium), lines 241-259 (Low), appCredentialWebhookRequestBodySchema (Low), handler (Low), refreshOAuthTokens (Low), salesforceTokenSchema (Low)",match,'OAuth' matches HC entity 'encodeoauthstate'
cal_dot_com,8,OAuth credential sync and app integration enhancements,Invalid Zod schema syntax. Computed property keys like [z.string().toString()] are not valid in Zod object schemas and will cause runtime errors. ,High,39,6,28,"variable::APP_CREDENTIAL_SHARING_ENABLED (packages/lib/constants.ts) [Critical, score=0.83] | function::decodeOAuthState (packages/app-store/_utils/oauth/decodeOAuthState.ts) [Critical, score=0.73] | function::encodeOAuthState (packages/app-store/_utils/oauth/encodeOAuthState.ts) [High, score=0.67] | variable::createOAuthAppCredential (packages/app-store/_utils/oauth/createOAuthAppCredential.ts) [High, score=0.64] | variable::minimumTokenResponseSchema (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59] | variable::parseRefreshTokenResponse (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59]","[Critical] variable APP_CREDENTIAL_SHARING_ENABLED in packages/lib/constants.ts:
const APP_CREDENTIAL_SHARING_ENABLED =
  process.env.CALCOM_WEBHOOK_SECRET && process.env.CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY;
---
[Critical] function decodeOAuthState in packages/app-store/_utils/oauth/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[High] function encodeOAuthState in packages/app-store/_utils/oauth/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[High] variable createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFirst({
      where: {
        id: state.teamId,
        members: {
          some: {
            userId: req.session?.user.id,
            accepted: true,
          },
        },
      },
      select: { id: true, members: { select: { userId: true } } },
    });

    if (!team) throw new Error(""User d
---
[High] variable minimumTokenResponseSchema in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const minimumTokenResponseSchema = z.object({
  access_token: z.string(),
  //   Assume that any property with a number is the expiry
  [z.string().toString()]: z.number(),
  //   Allow other properties in the token response
  [z.string().optional().toString()]: z.unknown().optional(),
});
---
[High] variable parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const parseRefreshTokenResponse = (response: any, schema: z.ZodTypeAny) => {
  let refreshTokenResponse;
  if (APP_CREDENTIAL_SHARING_ENABLED && process.env.CALCOM_CREDENTIAL_SYNC_ENDPOINT) {
    refreshTokenResponse = minimumTokenResponseSchema.safeParse(response);
  } else {
    refreshTokenResponse = schema.safeParse(response);
  }

  if (!refreshTokenResponse.success) {
    throw new Error(""Invalid refreshed tokens were returned"");
  }

  if (!refreshTokenResponse.data.refresh_token) {
    refreshTokenResponse.data.refresh_token = ""refresh_token"";
  }

  return refreshTokenResponse;
};","[Medium] field refreshAccessToken in packages/app-store/larkcalendar/lib/CalendarService.ts:
private refreshAccessToken = async (credential: CredentialPayload) => {
    const larkAuthCredentials = credential.key as LarkAuthCredentials;
    const refreshExpireDate = larkAuthCredentials.refresh_expires_date;
    const refreshToken = larkAuthCredentials.refresh_token;
    if (isExpired(refreshExpireDate) || !refreshToken) {
      await prisma.credential.delete({ where: { id: credential.id } });
      throw new Error(""Lark Calendar refresh token expired"");
    }
    try {
      const appAcc
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credential;
---
[Medium] variable webexAuth in packages/app-store/webex/lib/VideoApiAdapter.ts:
const webexAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getWebexAppKeys();

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://webexapis.com/v1/access_token"", {
          method: ""POST"",
          headers: {
            ""Content-type"": ""application/x-www-form-urlencoded"",
          },
          body: new URLSearchParams({
            grant_type: 
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] export parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
export default parseRefreshTokenResponse;
---
[Medium] export refreshOAuthTokens in packages/app-store/_utils/oauth/refreshOAuthTokens.ts:
export default refreshOAuthTokens;
---
[Medium] chunk lines 241-246 in .env.example:
E2E_TEST_OIDC_PROVIDER_DOMAIN=

E2E_TEST_OIDC_USER_EMAIL=
E2E_TEST_OIDC_USER_PASSWORD=

# ***********************************************************************************************************
---
[Medium] variable createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFir
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] function decodeOAuthState in packages/app-store/_utils/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[Medium] function encodeOAuthState in packages/app-store/_utils/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.credential = credential;
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credent
---
[Medium] field googleAuth in packages/app-store/googlecalendar/lib/CalendarService.ts:
private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCredentialSchema.parse(credential.key);

    async function getGoogleAuth() {
      const { client_id, client_secret, redirect_uris } = await getGoogleAppKeys();
      const myGoogleAuth = new MyGoogleAuth(client_id, client_secret, redirect_uris[0]);
      myGoogleAuth.setCredentials(googleCredentials);
      return myGoogleAuth;
    }

    const refreshAccessToken = async (myGoogleAuth: Awaited<ReturnT
---
[Medium] chunk lines 221-240 in .env.example:
# Get it from https://vercel.com/<TEAM_OR_USER_NAME>/<PROJECT_SLUG>/settings
PROJECT_ID_VERCEL=
# Get it from: https://vercel.com/teams/<TEAM_SLUG>/settings
TEAM_ID_VERCEL=
# Get it from: https://vercel.com/account/tokens
AUTH_BEARER_TOKEN_VERCEL=

#   - APPLE CALENDAR
# Used for E2E tests on Apple Calendar
E2E_TEST_APPLE_CALENDAR_EMAIL=""""
E2E_TEST_APPLE_CALENDAR_PASSWORD=""""

# - APP CREDENTIAL SYNC ***********************************************************************************
# Used for se
---
[Medium] field hubspotAuth in packages/app-store/hubspot/lib/CalendarService.ts:
private hubspotAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""hubspot"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Hubspot client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Hubspot cl
---
[Medium] class HubspotCalendarService in packages/app-store/hubspot/lib/CalendarService.ts:
class HubspotCalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<HubspotToken | void | never[]> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""hubspot_other_calendar"";

    this.auth = this.hubspotAuth(credential).then((r) => r);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);
    this.credential = credential;

---
[Medium] field o365Auth in packages/app-store/office365calendar/lib/CalendarService.ts:
private o365Auth = (credential: CredentialPayload) => {
    const isExpired = (expiryDate: number) => {
      if (!expiryDate) {
        return true;
      } else {
        return expiryDate < Math.round(+new Date() / 1000);
      }
    };
    const o365AuthCredentials = credential.key as O365AuthCredentials;

    const refreshAccessToken = async (o365AuthCredentials: O365AuthCredentials) => {
      const { client_id, client_secret } = await getOfficeAppKeys();
      const response = await refre
---
[Medium] variable o365Auth in packages/app-store/office365video/lib/VideoApiAdapter.ts:
const o365Auth = async (credential: CredentialPayload) => {
  const appKeys = await getAppKeysFromSlug(""msteams"");
  if (typeof appKeys.client_id === ""string"") client_id = appKeys.client_id;
  if (typeof appKeys.client_secret === ""string"") client_secret = appKeys.client_secret;
  if (!client_id) throw new HttpError({ statusCode: 400, message: ""MS teams client_id missing."" });
  if (!client_secret) throw new HttpError({ statusCode: 400, message: ""MS teams client_secret missing."" });

  const isEx
---
[Medium] field getClient in packages/app-store/salesforce/lib/CalendarService.ts:
private getClient = async (credential: CredentialPayload) => {
    let consumer_key = """";
    let consumer_secret = """";

    const appKeys = await getAppKeysFromSlug(""salesforce"");
    if (typeof appKeys.consumer_key === ""string"") consumer_key = appKeys.consumer_key;
    if (typeof appKeys.consumer_secret === ""string"") consumer_secret = appKeys.consumer_secret;
    if (!consumer_key)
      throw new HttpError({ statusCode: 400, message: ""Salesforce consumer key is missing."" });
    if (!consumer
---
[Medium] class SalesforceCalendarService in packages/app-store/salesforce/lib/CalendarService.ts:
class SalesforceCalendarService implements Calendar {
  private integrationName = """";
  private conn: Promise<jsforce.Connection>;
  private log: typeof logger;
  private calWarnings: string[] = [];

  constructor(credential: CredentialPayload) {
    this.integrationName = ""salesforce_other_calendar"";
    this.conn = this.getClient(credential).then((c) => c);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private getClient = async (credential: Creden
---
[Medium] function handler in packages/app-store/zoho-bigin/api/add.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === ""GET"") {
    const appKeys = await getAppKeysFromSlug(appConfig.slug);

    const clientId = typeof appKeys.client_id === ""string"" ? appKeys.client_id : """";
    if (!clientId) return res.status(400).json({ message: ""Zoho Bigin client_id missing."" });

    const redirectUri = WEBAPP_URL + `/api/integrations/zoho-bigin/callback`;

    const authUrl = axios.getUri({
      url: ""https://accounts.zoho.com/oauth/v
---
[Medium] method refreshAccessToken in packages/app-store/zoho-bigin/lib/CalendarService.ts:
private async refreshAccessToken(credentialId: number, credentialKey: BiginToken) {
    this.log.debug(""Refreshing token as it's invalid"");
    const grantType = ""refresh_token"";
    const accountsUrl = `${credentialKey.accountServer}/oauth/v2/token`;

    const appKeys = await getAppKeysFromSlug(this.integrationName);

    const { client_id: clientId, client_secret: clientSecret } = appKeysSchema.parse(appKeys);

    const formData = {
      grant_type: grantType,
      client_id: clientId,
   
---
[Medium] class BiginCalendarService in packages/app-store/zoho-bigin/lib/CalendarService.ts:
class BiginCalendarService implements Calendar {
  private readonly integrationName = ""zoho-bigin"";
  private readonly auth: { getToken: () => Promise<BiginToken> };
  private log: typeof logger;
  private eventsSlug = ""/bigin/v1/Events"";
  private contactsSlug = ""/bigin/v1/Contacts"";

  constructor(credential: CredentialPayload) {
    this.auth = this.biginAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  /***
   * Authenticate calend
---
[Medium] field zohoCrmAuth in packages/app-store/zohocrm/lib/CalendarService.ts:
private zohoCrmAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""zohocrm"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Zoho CRM client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Zoho CRM 
---
[Medium] class ZohoCrmCalendarService in packages/app-store/zohocrm/lib/CalendarService.ts:
class ZohoCrmCalendarService implements Calendar {
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<void> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";
  private accessToken = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""zohocrm_other_calendar"";
    this.auth = this.zohoCrmAuth(credential).then((r) => r);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`]
---
[Medium] variable zoomAuth in packages/app-store/zoomvideo/lib/VideoApiAdapter.ts:
const zoomAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getZoomAppKeys();
    const authHeader = ""Basic "" + Buffer.from(client_id + "":"" + client_secret).toString(""base64"");

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://zoom.us/oauth/token"", {
          method: ""POST"",
          headers: {
            Authorization: authHeader,
            ""C
---
[Medium] object globalEnv in turbo.json:
  ""globalEnv"": [
    ""ALLOWED_HOSTNAMES"",
    ""ANALYZE"",
    ""API_KEY_PREFIX"",
    ""APP_USER_NAME"",
    ""BASECAMP3_CLIENT_ID"",
    ""BASECAMP3_CLIENT_SECRET"",
    ""BASECAMP3_USER_AGENT"",
    ""AUTH_BEARER_TOKEN_VERCEL"",
    ""BUILD_ID"",
    ""CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY"",
    ""CALCOM_CREDENTIAL_SYNC_ENDPOINT"",
    ""CALCOM_ENV"",
    ""CALCOM_LICENSE_KEY"",
    ""CALCOM_TELEMETRY_DISABLED"",
    ""CALCOM_WEBHOOK_HEADER_NAME"",
    ""CALENDSO_ENCRYPTION_KEY"",
    ""CALCOM_WEBHOOK_SECRET"",
    ""CI"",
  ","APP_CREDENTIAL_SHARING_ENABLED (Critical), decodeOAuthState (Critical), encodeOAuthState (High), createOAuthAppCredential (High), minimumTokenResponseSchema (High), parseRefreshTokenResponse (High), refreshAccessToken (Medium), LarkCalendarService (Medium), webexAuth (Medium), createOAuthAppCredential (Medium), parseRefreshTokenResponse (Medium), refreshOAuthTokens (Medium), lines 241-246 (Medium), createOAuthAppCredential (Medium), createOAuthAppCredential (Medium), decodeOAuthState (Medium), encodeOAuthState (Medium), GoogleCalendarService (Medium), googleAuth (Medium), lines 221-240 (Medium), hubspotAuth (Medium), HubspotCalendarService (Medium), Office365CalendarService (Medium), o365Auth (Medium), o365Auth (Medium), getClient (Medium), SalesforceCalendarService (Medium), handler (Medium), refreshAccessToken (Medium), BiginCalendarService (Medium), zohoCrmAuth (Medium), ZohoCrmCalendarService (Medium), zoomAuth (Medium), globalEnv (Medium), lines 241-259 (Low), appCredentialWebhookRequestBodySchema (Low), handler (Low), refreshOAuthTokens (Low), salesforceTokenSchema (Low)",match,'schema' matches HC entity 'minimumtokenresponseschema'
cal_dot_com,8,OAuth credential sync and app integration enhancements,"parseRefreshTokenResponse returns a Zod safeParse result ({ success, data, error }), not the credential key object. Persisting that as key stores the wrapper instead of the token payload; we should store the parsed data or use schema parse.",High,39,6,28,"variable::APP_CREDENTIAL_SHARING_ENABLED (packages/lib/constants.ts) [Critical, score=0.83] | function::decodeOAuthState (packages/app-store/_utils/oauth/decodeOAuthState.ts) [Critical, score=0.73] | function::encodeOAuthState (packages/app-store/_utils/oauth/encodeOAuthState.ts) [High, score=0.67] | variable::createOAuthAppCredential (packages/app-store/_utils/oauth/createOAuthAppCredential.ts) [High, score=0.64] | variable::minimumTokenResponseSchema (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59] | variable::parseRefreshTokenResponse (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59]","[Critical] variable APP_CREDENTIAL_SHARING_ENABLED in packages/lib/constants.ts:
const APP_CREDENTIAL_SHARING_ENABLED =
  process.env.CALCOM_WEBHOOK_SECRET && process.env.CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY;
---
[Critical] function decodeOAuthState in packages/app-store/_utils/oauth/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[High] function encodeOAuthState in packages/app-store/_utils/oauth/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[High] variable createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFirst({
      where: {
        id: state.teamId,
        members: {
          some: {
            userId: req.session?.user.id,
            accepted: true,
          },
        },
      },
      select: { id: true, members: { select: { userId: true } } },
    });

    if (!team) throw new Error(""User d
---
[High] variable minimumTokenResponseSchema in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const minimumTokenResponseSchema = z.object({
  access_token: z.string(),
  //   Assume that any property with a number is the expiry
  [z.string().toString()]: z.number(),
  //   Allow other properties in the token response
  [z.string().optional().toString()]: z.unknown().optional(),
});
---
[High] variable parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const parseRefreshTokenResponse = (response: any, schema: z.ZodTypeAny) => {
  let refreshTokenResponse;
  if (APP_CREDENTIAL_SHARING_ENABLED && process.env.CALCOM_CREDENTIAL_SYNC_ENDPOINT) {
    refreshTokenResponse = minimumTokenResponseSchema.safeParse(response);
  } else {
    refreshTokenResponse = schema.safeParse(response);
  }

  if (!refreshTokenResponse.success) {
    throw new Error(""Invalid refreshed tokens were returned"");
  }

  if (!refreshTokenResponse.data.refresh_token) {
    refreshTokenResponse.data.refresh_token = ""refresh_token"";
  }

  return refreshTokenResponse;
};","[Medium] field refreshAccessToken in packages/app-store/larkcalendar/lib/CalendarService.ts:
private refreshAccessToken = async (credential: CredentialPayload) => {
    const larkAuthCredentials = credential.key as LarkAuthCredentials;
    const refreshExpireDate = larkAuthCredentials.refresh_expires_date;
    const refreshToken = larkAuthCredentials.refresh_token;
    if (isExpired(refreshExpireDate) || !refreshToken) {
      await prisma.credential.delete({ where: { id: credential.id } });
      throw new Error(""Lark Calendar refresh token expired"");
    }
    try {
      const appAcc
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credential;
---
[Medium] variable webexAuth in packages/app-store/webex/lib/VideoApiAdapter.ts:
const webexAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getWebexAppKeys();

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://webexapis.com/v1/access_token"", {
          method: ""POST"",
          headers: {
            ""Content-type"": ""application/x-www-form-urlencoded"",
          },
          body: new URLSearchParams({
            grant_type: 
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] export parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
export default parseRefreshTokenResponse;
---
[Medium] export refreshOAuthTokens in packages/app-store/_utils/oauth/refreshOAuthTokens.ts:
export default refreshOAuthTokens;
---
[Medium] chunk lines 241-246 in .env.example:
E2E_TEST_OIDC_PROVIDER_DOMAIN=

E2E_TEST_OIDC_USER_EMAIL=
E2E_TEST_OIDC_USER_PASSWORD=

# ***********************************************************************************************************
---
[Medium] variable createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFir
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] function decodeOAuthState in packages/app-store/_utils/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[Medium] function encodeOAuthState in packages/app-store/_utils/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.credential = credential;
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credent
---
[Medium] field googleAuth in packages/app-store/googlecalendar/lib/CalendarService.ts:
private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCredentialSchema.parse(credential.key);

    async function getGoogleAuth() {
      const { client_id, client_secret, redirect_uris } = await getGoogleAppKeys();
      const myGoogleAuth = new MyGoogleAuth(client_id, client_secret, redirect_uris[0]);
      myGoogleAuth.setCredentials(googleCredentials);
      return myGoogleAuth;
    }

    const refreshAccessToken = async (myGoogleAuth: Awaited<ReturnT
---
[Medium] chunk lines 221-240 in .env.example:
# Get it from https://vercel.com/<TEAM_OR_USER_NAME>/<PROJECT_SLUG>/settings
PROJECT_ID_VERCEL=
# Get it from: https://vercel.com/teams/<TEAM_SLUG>/settings
TEAM_ID_VERCEL=
# Get it from: https://vercel.com/account/tokens
AUTH_BEARER_TOKEN_VERCEL=

#   - APPLE CALENDAR
# Used for E2E tests on Apple Calendar
E2E_TEST_APPLE_CALENDAR_EMAIL=""""
E2E_TEST_APPLE_CALENDAR_PASSWORD=""""

# - APP CREDENTIAL SYNC ***********************************************************************************
# Used for se
---
[Medium] field hubspotAuth in packages/app-store/hubspot/lib/CalendarService.ts:
private hubspotAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""hubspot"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Hubspot client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Hubspot cl
---
[Medium] class HubspotCalendarService in packages/app-store/hubspot/lib/CalendarService.ts:
class HubspotCalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<HubspotToken | void | never[]> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""hubspot_other_calendar"";

    this.auth = this.hubspotAuth(credential).then((r) => r);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);
    this.credential = credential;

---
[Medium] field o365Auth in packages/app-store/office365calendar/lib/CalendarService.ts:
private o365Auth = (credential: CredentialPayload) => {
    const isExpired = (expiryDate: number) => {
      if (!expiryDate) {
        return true;
      } else {
        return expiryDate < Math.round(+new Date() / 1000);
      }
    };
    const o365AuthCredentials = credential.key as O365AuthCredentials;

    const refreshAccessToken = async (o365AuthCredentials: O365AuthCredentials) => {
      const { client_id, client_secret } = await getOfficeAppKeys();
      const response = await refre
---
[Medium] variable o365Auth in packages/app-store/office365video/lib/VideoApiAdapter.ts:
const o365Auth = async (credential: CredentialPayload) => {
  const appKeys = await getAppKeysFromSlug(""msteams"");
  if (typeof appKeys.client_id === ""string"") client_id = appKeys.client_id;
  if (typeof appKeys.client_secret === ""string"") client_secret = appKeys.client_secret;
  if (!client_id) throw new HttpError({ statusCode: 400, message: ""MS teams client_id missing."" });
  if (!client_secret) throw new HttpError({ statusCode: 400, message: ""MS teams client_secret missing."" });

  const isEx
---
[Medium] field getClient in packages/app-store/salesforce/lib/CalendarService.ts:
private getClient = async (credential: CredentialPayload) => {
    let consumer_key = """";
    let consumer_secret = """";

    const appKeys = await getAppKeysFromSlug(""salesforce"");
    if (typeof appKeys.consumer_key === ""string"") consumer_key = appKeys.consumer_key;
    if (typeof appKeys.consumer_secret === ""string"") consumer_secret = appKeys.consumer_secret;
    if (!consumer_key)
      throw new HttpError({ statusCode: 400, message: ""Salesforce consumer key is missing."" });
    if (!consumer
---
[Medium] class SalesforceCalendarService in packages/app-store/salesforce/lib/CalendarService.ts:
class SalesforceCalendarService implements Calendar {
  private integrationName = """";
  private conn: Promise<jsforce.Connection>;
  private log: typeof logger;
  private calWarnings: string[] = [];

  constructor(credential: CredentialPayload) {
    this.integrationName = ""salesforce_other_calendar"";
    this.conn = this.getClient(credential).then((c) => c);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private getClient = async (credential: Creden
---
[Medium] function handler in packages/app-store/zoho-bigin/api/add.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === ""GET"") {
    const appKeys = await getAppKeysFromSlug(appConfig.slug);

    const clientId = typeof appKeys.client_id === ""string"" ? appKeys.client_id : """";
    if (!clientId) return res.status(400).json({ message: ""Zoho Bigin client_id missing."" });

    const redirectUri = WEBAPP_URL + `/api/integrations/zoho-bigin/callback`;

    const authUrl = axios.getUri({
      url: ""https://accounts.zoho.com/oauth/v
---
[Medium] method refreshAccessToken in packages/app-store/zoho-bigin/lib/CalendarService.ts:
private async refreshAccessToken(credentialId: number, credentialKey: BiginToken) {
    this.log.debug(""Refreshing token as it's invalid"");
    const grantType = ""refresh_token"";
    const accountsUrl = `${credentialKey.accountServer}/oauth/v2/token`;

    const appKeys = await getAppKeysFromSlug(this.integrationName);

    const { client_id: clientId, client_secret: clientSecret } = appKeysSchema.parse(appKeys);

    const formData = {
      grant_type: grantType,
      client_id: clientId,
   
---
[Medium] class BiginCalendarService in packages/app-store/zoho-bigin/lib/CalendarService.ts:
class BiginCalendarService implements Calendar {
  private readonly integrationName = ""zoho-bigin"";
  private readonly auth: { getToken: () => Promise<BiginToken> };
  private log: typeof logger;
  private eventsSlug = ""/bigin/v1/Events"";
  private contactsSlug = ""/bigin/v1/Contacts"";

  constructor(credential: CredentialPayload) {
    this.auth = this.biginAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  /***
   * Authenticate calend
---
[Medium] field zohoCrmAuth in packages/app-store/zohocrm/lib/CalendarService.ts:
private zohoCrmAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""zohocrm"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Zoho CRM client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Zoho CRM 
---
[Medium] class ZohoCrmCalendarService in packages/app-store/zohocrm/lib/CalendarService.ts:
class ZohoCrmCalendarService implements Calendar {
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<void> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";
  private accessToken = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""zohocrm_other_calendar"";
    this.auth = this.zohoCrmAuth(credential).then((r) => r);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`]
---
[Medium] variable zoomAuth in packages/app-store/zoomvideo/lib/VideoApiAdapter.ts:
const zoomAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getZoomAppKeys();
    const authHeader = ""Basic "" + Buffer.from(client_id + "":"" + client_secret).toString(""base64"");

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://zoom.us/oauth/token"", {
          method: ""POST"",
          headers: {
            Authorization: authHeader,
            ""C
---
[Medium] object globalEnv in turbo.json:
  ""globalEnv"": [
    ""ALLOWED_HOSTNAMES"",
    ""ANALYZE"",
    ""API_KEY_PREFIX"",
    ""APP_USER_NAME"",
    ""BASECAMP3_CLIENT_ID"",
    ""BASECAMP3_CLIENT_SECRET"",
    ""BASECAMP3_USER_AGENT"",
    ""AUTH_BEARER_TOKEN_VERCEL"",
    ""BUILD_ID"",
    ""CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY"",
    ""CALCOM_CREDENTIAL_SYNC_ENDPOINT"",
    ""CALCOM_ENV"",
    ""CALCOM_LICENSE_KEY"",
    ""CALCOM_TELEMETRY_DISABLED"",
    ""CALCOM_WEBHOOK_HEADER_NAME"",
    ""CALENDSO_ENCRYPTION_KEY"",
    ""CALCOM_WEBHOOK_SECRET"",
    ""CI"",
  ","APP_CREDENTIAL_SHARING_ENABLED (Critical), decodeOAuthState (Critical), encodeOAuthState (High), createOAuthAppCredential (High), minimumTokenResponseSchema (High), parseRefreshTokenResponse (High), refreshAccessToken (Medium), LarkCalendarService (Medium), webexAuth (Medium), createOAuthAppCredential (Medium), parseRefreshTokenResponse (Medium), refreshOAuthTokens (Medium), lines 241-246 (Medium), createOAuthAppCredential (Medium), createOAuthAppCredential (Medium), decodeOAuthState (Medium), encodeOAuthState (Medium), GoogleCalendarService (Medium), googleAuth (Medium), lines 221-240 (Medium), hubspotAuth (Medium), HubspotCalendarService (Medium), Office365CalendarService (Medium), o365Auth (Medium), o365Auth (Medium), getClient (Medium), SalesforceCalendarService (Medium), handler (Medium), refreshAccessToken (Medium), BiginCalendarService (Medium), zohoCrmAuth (Medium), ZohoCrmCalendarService (Medium), zoomAuth (Medium), globalEnv (Medium), lines 241-259 (Low), appCredentialWebhookRequestBodySchema (Low), handler (Low), refreshOAuthTokens (Low), salesforceTokenSchema (Low)",match,'parseRefreshTokenResponse' matches HC entity 'parserefreshtokenresponse'
cal_dot_com,8,OAuth credential sync and app integration enhancements,"When APP_CREDENTIAL_SHARING_ENABLED and CALCOM_CREDENTIAL_SYNC_ENDPOINT are set, the refreshFunction helper returns the fetch Response, but several callers (for example GoogleCalendarService.refreshAccessToken expecting res.data, and HubspotCalendarService.refreshAccessToken expecting a HubspotToken) assume it returns the integration-specific token object. That mismatch will cause runtime errors in the sync-enabled path unless the return type or those call sites are adjusted.",High,39,6,28,"variable::APP_CREDENTIAL_SHARING_ENABLED (packages/lib/constants.ts) [Critical, score=0.83] | function::decodeOAuthState (packages/app-store/_utils/oauth/decodeOAuthState.ts) [Critical, score=0.73] | function::encodeOAuthState (packages/app-store/_utils/oauth/encodeOAuthState.ts) [High, score=0.67] | variable::createOAuthAppCredential (packages/app-store/_utils/oauth/createOAuthAppCredential.ts) [High, score=0.64] | variable::minimumTokenResponseSchema (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59] | variable::parseRefreshTokenResponse (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59]","[Critical] variable APP_CREDENTIAL_SHARING_ENABLED in packages/lib/constants.ts:
const APP_CREDENTIAL_SHARING_ENABLED =
  process.env.CALCOM_WEBHOOK_SECRET && process.env.CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY;
---
[Critical] function decodeOAuthState in packages/app-store/_utils/oauth/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[High] function encodeOAuthState in packages/app-store/_utils/oauth/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[High] variable createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFirst({
      where: {
        id: state.teamId,
        members: {
          some: {
            userId: req.session?.user.id,
            accepted: true,
          },
        },
      },
      select: { id: true, members: { select: { userId: true } } },
    });

    if (!team) throw new Error(""User d
---
[High] variable minimumTokenResponseSchema in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const minimumTokenResponseSchema = z.object({
  access_token: z.string(),
  //   Assume that any property with a number is the expiry
  [z.string().toString()]: z.number(),
  //   Allow other properties in the token response
  [z.string().optional().toString()]: z.unknown().optional(),
});
---
[High] variable parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const parseRefreshTokenResponse = (response: any, schema: z.ZodTypeAny) => {
  let refreshTokenResponse;
  if (APP_CREDENTIAL_SHARING_ENABLED && process.env.CALCOM_CREDENTIAL_SYNC_ENDPOINT) {
    refreshTokenResponse = minimumTokenResponseSchema.safeParse(response);
  } else {
    refreshTokenResponse = schema.safeParse(response);
  }

  if (!refreshTokenResponse.success) {
    throw new Error(""Invalid refreshed tokens were returned"");
  }

  if (!refreshTokenResponse.data.refresh_token) {
    refreshTokenResponse.data.refresh_token = ""refresh_token"";
  }

  return refreshTokenResponse;
};","[Medium] field refreshAccessToken in packages/app-store/larkcalendar/lib/CalendarService.ts:
private refreshAccessToken = async (credential: CredentialPayload) => {
    const larkAuthCredentials = credential.key as LarkAuthCredentials;
    const refreshExpireDate = larkAuthCredentials.refresh_expires_date;
    const refreshToken = larkAuthCredentials.refresh_token;
    if (isExpired(refreshExpireDate) || !refreshToken) {
      await prisma.credential.delete({ where: { id: credential.id } });
      throw new Error(""Lark Calendar refresh token expired"");
    }
    try {
      const appAcc
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credential;
---
[Medium] variable webexAuth in packages/app-store/webex/lib/VideoApiAdapter.ts:
const webexAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getWebexAppKeys();

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://webexapis.com/v1/access_token"", {
          method: ""POST"",
          headers: {
            ""Content-type"": ""application/x-www-form-urlencoded"",
          },
          body: new URLSearchParams({
            grant_type: 
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] export parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
export default parseRefreshTokenResponse;
---
[Medium] export refreshOAuthTokens in packages/app-store/_utils/oauth/refreshOAuthTokens.ts:
export default refreshOAuthTokens;
---
[Medium] chunk lines 241-246 in .env.example:
E2E_TEST_OIDC_PROVIDER_DOMAIN=

E2E_TEST_OIDC_USER_EMAIL=
E2E_TEST_OIDC_USER_PASSWORD=

# ***********************************************************************************************************
---
[Medium] variable createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFir
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] function decodeOAuthState in packages/app-store/_utils/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[Medium] function encodeOAuthState in packages/app-store/_utils/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.credential = credential;
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credent
---
[Medium] field googleAuth in packages/app-store/googlecalendar/lib/CalendarService.ts:
private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCredentialSchema.parse(credential.key);

    async function getGoogleAuth() {
      const { client_id, client_secret, redirect_uris } = await getGoogleAppKeys();
      const myGoogleAuth = new MyGoogleAuth(client_id, client_secret, redirect_uris[0]);
      myGoogleAuth.setCredentials(googleCredentials);
      return myGoogleAuth;
    }

    const refreshAccessToken = async (myGoogleAuth: Awaited<ReturnT
---
[Medium] chunk lines 221-240 in .env.example:
# Get it from https://vercel.com/<TEAM_OR_USER_NAME>/<PROJECT_SLUG>/settings
PROJECT_ID_VERCEL=
# Get it from: https://vercel.com/teams/<TEAM_SLUG>/settings
TEAM_ID_VERCEL=
# Get it from: https://vercel.com/account/tokens
AUTH_BEARER_TOKEN_VERCEL=

#   - APPLE CALENDAR
# Used for E2E tests on Apple Calendar
E2E_TEST_APPLE_CALENDAR_EMAIL=""""
E2E_TEST_APPLE_CALENDAR_PASSWORD=""""

# - APP CREDENTIAL SYNC ***********************************************************************************
# Used for se
---
[Medium] field hubspotAuth in packages/app-store/hubspot/lib/CalendarService.ts:
private hubspotAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""hubspot"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Hubspot client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Hubspot cl
---
[Medium] class HubspotCalendarService in packages/app-store/hubspot/lib/CalendarService.ts:
class HubspotCalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<HubspotToken | void | never[]> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""hubspot_other_calendar"";

    this.auth = this.hubspotAuth(credential).then((r) => r);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);
    this.credential = credential;

---
[Medium] field o365Auth in packages/app-store/office365calendar/lib/CalendarService.ts:
private o365Auth = (credential: CredentialPayload) => {
    const isExpired = (expiryDate: number) => {
      if (!expiryDate) {
        return true;
      } else {
        return expiryDate < Math.round(+new Date() / 1000);
      }
    };
    const o365AuthCredentials = credential.key as O365AuthCredentials;

    const refreshAccessToken = async (o365AuthCredentials: O365AuthCredentials) => {
      const { client_id, client_secret } = await getOfficeAppKeys();
      const response = await refre
---
[Medium] variable o365Auth in packages/app-store/office365video/lib/VideoApiAdapter.ts:
const o365Auth = async (credential: CredentialPayload) => {
  const appKeys = await getAppKeysFromSlug(""msteams"");
  if (typeof appKeys.client_id === ""string"") client_id = appKeys.client_id;
  if (typeof appKeys.client_secret === ""string"") client_secret = appKeys.client_secret;
  if (!client_id) throw new HttpError({ statusCode: 400, message: ""MS teams client_id missing."" });
  if (!client_secret) throw new HttpError({ statusCode: 400, message: ""MS teams client_secret missing."" });

  const isEx
---
[Medium] field getClient in packages/app-store/salesforce/lib/CalendarService.ts:
private getClient = async (credential: CredentialPayload) => {
    let consumer_key = """";
    let consumer_secret = """";

    const appKeys = await getAppKeysFromSlug(""salesforce"");
    if (typeof appKeys.consumer_key === ""string"") consumer_key = appKeys.consumer_key;
    if (typeof appKeys.consumer_secret === ""string"") consumer_secret = appKeys.consumer_secret;
    if (!consumer_key)
      throw new HttpError({ statusCode: 400, message: ""Salesforce consumer key is missing."" });
    if (!consumer
---
[Medium] class SalesforceCalendarService in packages/app-store/salesforce/lib/CalendarService.ts:
class SalesforceCalendarService implements Calendar {
  private integrationName = """";
  private conn: Promise<jsforce.Connection>;
  private log: typeof logger;
  private calWarnings: string[] = [];

  constructor(credential: CredentialPayload) {
    this.integrationName = ""salesforce_other_calendar"";
    this.conn = this.getClient(credential).then((c) => c);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private getClient = async (credential: Creden
---
[Medium] function handler in packages/app-store/zoho-bigin/api/add.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === ""GET"") {
    const appKeys = await getAppKeysFromSlug(appConfig.slug);

    const clientId = typeof appKeys.client_id === ""string"" ? appKeys.client_id : """";
    if (!clientId) return res.status(400).json({ message: ""Zoho Bigin client_id missing."" });

    const redirectUri = WEBAPP_URL + `/api/integrations/zoho-bigin/callback`;

    const authUrl = axios.getUri({
      url: ""https://accounts.zoho.com/oauth/v
---
[Medium] method refreshAccessToken in packages/app-store/zoho-bigin/lib/CalendarService.ts:
private async refreshAccessToken(credentialId: number, credentialKey: BiginToken) {
    this.log.debug(""Refreshing token as it's invalid"");
    const grantType = ""refresh_token"";
    const accountsUrl = `${credentialKey.accountServer}/oauth/v2/token`;

    const appKeys = await getAppKeysFromSlug(this.integrationName);

    const { client_id: clientId, client_secret: clientSecret } = appKeysSchema.parse(appKeys);

    const formData = {
      grant_type: grantType,
      client_id: clientId,
   
---
[Medium] class BiginCalendarService in packages/app-store/zoho-bigin/lib/CalendarService.ts:
class BiginCalendarService implements Calendar {
  private readonly integrationName = ""zoho-bigin"";
  private readonly auth: { getToken: () => Promise<BiginToken> };
  private log: typeof logger;
  private eventsSlug = ""/bigin/v1/Events"";
  private contactsSlug = ""/bigin/v1/Contacts"";

  constructor(credential: CredentialPayload) {
    this.auth = this.biginAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  /***
   * Authenticate calend
---
[Medium] field zohoCrmAuth in packages/app-store/zohocrm/lib/CalendarService.ts:
private zohoCrmAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""zohocrm"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Zoho CRM client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Zoho CRM 
---
[Medium] class ZohoCrmCalendarService in packages/app-store/zohocrm/lib/CalendarService.ts:
class ZohoCrmCalendarService implements Calendar {
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<void> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";
  private accessToken = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""zohocrm_other_calendar"";
    this.auth = this.zohoCrmAuth(credential).then((r) => r);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`]
---
[Medium] variable zoomAuth in packages/app-store/zoomvideo/lib/VideoApiAdapter.ts:
const zoomAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getZoomAppKeys();
    const authHeader = ""Basic "" + Buffer.from(client_id + "":"" + client_secret).toString(""base64"");

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://zoom.us/oauth/token"", {
          method: ""POST"",
          headers: {
            Authorization: authHeader,
            ""C
---
[Medium] object globalEnv in turbo.json:
  ""globalEnv"": [
    ""ALLOWED_HOSTNAMES"",
    ""ANALYZE"",
    ""API_KEY_PREFIX"",
    ""APP_USER_NAME"",
    ""BASECAMP3_CLIENT_ID"",
    ""BASECAMP3_CLIENT_SECRET"",
    ""BASECAMP3_USER_AGENT"",
    ""AUTH_BEARER_TOKEN_VERCEL"",
    ""BUILD_ID"",
    ""CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY"",
    ""CALCOM_CREDENTIAL_SYNC_ENDPOINT"",
    ""CALCOM_ENV"",
    ""CALCOM_LICENSE_KEY"",
    ""CALCOM_TELEMETRY_DISABLED"",
    ""CALCOM_WEBHOOK_HEADER_NAME"",
    ""CALENDSO_ENCRYPTION_KEY"",
    ""CALCOM_WEBHOOK_SECRET"",
    ""CI"",
  ","APP_CREDENTIAL_SHARING_ENABLED (Critical), decodeOAuthState (Critical), encodeOAuthState (High), createOAuthAppCredential (High), minimumTokenResponseSchema (High), parseRefreshTokenResponse (High), refreshAccessToken (Medium), LarkCalendarService (Medium), webexAuth (Medium), createOAuthAppCredential (Medium), parseRefreshTokenResponse (Medium), refreshOAuthTokens (Medium), lines 241-246 (Medium), createOAuthAppCredential (Medium), createOAuthAppCredential (Medium), decodeOAuthState (Medium), encodeOAuthState (Medium), GoogleCalendarService (Medium), googleAuth (Medium), lines 221-240 (Medium), hubspotAuth (Medium), HubspotCalendarService (Medium), Office365CalendarService (Medium), o365Auth (Medium), o365Auth (Medium), getClient (Medium), SalesforceCalendarService (Medium), handler (Medium), refreshAccessToken (Medium), BiginCalendarService (Medium), zohoCrmAuth (Medium), ZohoCrmCalendarService (Medium), zoomAuth (Medium), globalEnv (Medium), lines 241-259 (Low), appCredentialWebhookRequestBodySchema (Low), handler (Low), refreshOAuthTokens (Low), salesforceTokenSchema (Low)",match,'res' matches HC entity 'minimumtokenresponseschema'
cal_dot_com,8,OAuth credential sync and app integration enhancements,"When the sync endpoint path is used, res is a fetch Response and has no .data; res?.data will be undefined and token.access_token will throw at runtime. This relies on a consistent return shape from refreshOAuthTokens, which isnâ€™t guaranteed currently.",High,39,6,28,"variable::APP_CREDENTIAL_SHARING_ENABLED (packages/lib/constants.ts) [Critical, score=0.83] | function::decodeOAuthState (packages/app-store/_utils/oauth/decodeOAuthState.ts) [Critical, score=0.73] | function::encodeOAuthState (packages/app-store/_utils/oauth/encodeOAuthState.ts) [High, score=0.67] | variable::createOAuthAppCredential (packages/app-store/_utils/oauth/createOAuthAppCredential.ts) [High, score=0.64] | variable::minimumTokenResponseSchema (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59] | variable::parseRefreshTokenResponse (packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts) [High, score=0.59]","[Critical] variable APP_CREDENTIAL_SHARING_ENABLED in packages/lib/constants.ts:
const APP_CREDENTIAL_SHARING_ENABLED =
  process.env.CALCOM_WEBHOOK_SECRET && process.env.CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY;
---
[Critical] function decodeOAuthState in packages/app-store/_utils/oauth/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[High] function encodeOAuthState in packages/app-store/_utils/oauth/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[High] variable createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFirst({
      where: {
        id: state.teamId,
        members: {
          some: {
            userId: req.session?.user.id,
            accepted: true,
          },
        },
      },
      select: { id: true, members: { select: { userId: true } } },
    });

    if (!team) throw new Error(""User d
---
[High] variable minimumTokenResponseSchema in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const minimumTokenResponseSchema = z.object({
  access_token: z.string(),
  //   Assume that any property with a number is the expiry
  [z.string().toString()]: z.number(),
  //   Allow other properties in the token response
  [z.string().optional().toString()]: z.unknown().optional(),
});
---
[High] variable parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
const parseRefreshTokenResponse = (response: any, schema: z.ZodTypeAny) => {
  let refreshTokenResponse;
  if (APP_CREDENTIAL_SHARING_ENABLED && process.env.CALCOM_CREDENTIAL_SYNC_ENDPOINT) {
    refreshTokenResponse = minimumTokenResponseSchema.safeParse(response);
  } else {
    refreshTokenResponse = schema.safeParse(response);
  }

  if (!refreshTokenResponse.success) {
    throw new Error(""Invalid refreshed tokens were returned"");
  }

  if (!refreshTokenResponse.data.refresh_token) {
    refreshTokenResponse.data.refresh_token = ""refresh_token"";
  }

  return refreshTokenResponse;
};","[Medium] field refreshAccessToken in packages/app-store/larkcalendar/lib/CalendarService.ts:
private refreshAccessToken = async (credential: CredentialPayload) => {
    const larkAuthCredentials = credential.key as LarkAuthCredentials;
    const refreshExpireDate = larkAuthCredentials.refresh_expires_date;
    const refreshToken = larkAuthCredentials.refresh_token;
    if (isExpired(refreshExpireDate) || !refreshToken) {
      await prisma.credential.delete({ where: { id: credential.id } });
      throw new Error(""Lark Calendar refresh token expired"");
    }
    try {
      const appAcc
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credential;
---
[Medium] variable webexAuth in packages/app-store/webex/lib/VideoApiAdapter.ts:
const webexAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getWebexAppKeys();

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://webexapis.com/v1/access_token"", {
          method: ""POST"",
          headers: {
            ""Content-type"": ""application/x-www-form-urlencoded"",
          },
          body: new URLSearchParams({
            grant_type: 
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/oauth/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] export parseRefreshTokenResponse in packages/app-store/_utils/oauth/parseRefreshTokenResponse.ts:
export default parseRefreshTokenResponse;
---
[Medium] export refreshOAuthTokens in packages/app-store/_utils/oauth/refreshOAuthTokens.ts:
export default refreshOAuthTokens;
---
[Medium] chunk lines 241-246 in .env.example:
E2E_TEST_OIDC_PROVIDER_DOMAIN=

E2E_TEST_OIDC_USER_EMAIL=
E2E_TEST_OIDC_USER_PASSWORD=

# ***********************************************************************************************************
---
[Medium] variable createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
const createOAuthAppCredential = async (
  appData: { type: string; appId: string },
  key: unknown,
  req: NextApiRequest
) => {
  const userId = req.session?.user.id;
  if (!userId) {
    throw new HttpError({ statusCode: 401, message: ""You must be logged in to do this"" });
  }
  // For OAuth flows, see if a teamId was passed through the state
  const state = decodeOAuthState(req);

  if (state?.teamId) {
    // Check that the user belongs to the team
    const team = await prisma.team.findFir
---
[Medium] export createOAuthAppCredential in packages/app-store/_utils/createOAuthAppCredential.ts:
export default createOAuthAppCredential;
---
[Medium] function decodeOAuthState in packages/app-store/_utils/decodeOAuthState.ts:
function decodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return state;
}
---
[Medium] function encodeOAuthState in packages/app-store/_utils/encodeOAuthState.ts:
function encodeOAuthState(req: NextApiRequest) {
  if (typeof req.query.state !== ""string"") {
    return undefined;
  }
  const state: IntegrationOAuthCallbackState = JSON.parse(req.query.state);

  return JSON.stringify(state);
}
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.credential = credential;
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
    this.credential = credent
---
[Medium] field googleAuth in packages/app-store/googlecalendar/lib/CalendarService.ts:
private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCredentialSchema.parse(credential.key);

    async function getGoogleAuth() {
      const { client_id, client_secret, redirect_uris } = await getGoogleAppKeys();
      const myGoogleAuth = new MyGoogleAuth(client_id, client_secret, redirect_uris[0]);
      myGoogleAuth.setCredentials(googleCredentials);
      return myGoogleAuth;
    }

    const refreshAccessToken = async (myGoogleAuth: Awaited<ReturnT
---
[Medium] chunk lines 221-240 in .env.example:
# Get it from https://vercel.com/<TEAM_OR_USER_NAME>/<PROJECT_SLUG>/settings
PROJECT_ID_VERCEL=
# Get it from: https://vercel.com/teams/<TEAM_SLUG>/settings
TEAM_ID_VERCEL=
# Get it from: https://vercel.com/account/tokens
AUTH_BEARER_TOKEN_VERCEL=

#   - APPLE CALENDAR
# Used for E2E tests on Apple Calendar
E2E_TEST_APPLE_CALENDAR_EMAIL=""""
E2E_TEST_APPLE_CALENDAR_PASSWORD=""""

# - APP CREDENTIAL SYNC ***********************************************************************************
# Used for se
---
[Medium] field hubspotAuth in packages/app-store/hubspot/lib/CalendarService.ts:
private hubspotAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""hubspot"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Hubspot client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Hubspot cl
---
[Medium] class HubspotCalendarService in packages/app-store/hubspot/lib/CalendarService.ts:
class HubspotCalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<HubspotToken | void | never[]> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""hubspot_other_calendar"";

    this.auth = this.hubspotAuth(credential).then((r) => r);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";
  private credential: CredentialPayload;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);
    this.credential = credential;

---
[Medium] field o365Auth in packages/app-store/office365calendar/lib/CalendarService.ts:
private o365Auth = (credential: CredentialPayload) => {
    const isExpired = (expiryDate: number) => {
      if (!expiryDate) {
        return true;
      } else {
        return expiryDate < Math.round(+new Date() / 1000);
      }
    };
    const o365AuthCredentials = credential.key as O365AuthCredentials;

    const refreshAccessToken = async (o365AuthCredentials: O365AuthCredentials) => {
      const { client_id, client_secret } = await getOfficeAppKeys();
      const response = await refre
---
[Medium] variable o365Auth in packages/app-store/office365video/lib/VideoApiAdapter.ts:
const o365Auth = async (credential: CredentialPayload) => {
  const appKeys = await getAppKeysFromSlug(""msteams"");
  if (typeof appKeys.client_id === ""string"") client_id = appKeys.client_id;
  if (typeof appKeys.client_secret === ""string"") client_secret = appKeys.client_secret;
  if (!client_id) throw new HttpError({ statusCode: 400, message: ""MS teams client_id missing."" });
  if (!client_secret) throw new HttpError({ statusCode: 400, message: ""MS teams client_secret missing."" });

  const isEx
---
[Medium] field getClient in packages/app-store/salesforce/lib/CalendarService.ts:
private getClient = async (credential: CredentialPayload) => {
    let consumer_key = """";
    let consumer_secret = """";

    const appKeys = await getAppKeysFromSlug(""salesforce"");
    if (typeof appKeys.consumer_key === ""string"") consumer_key = appKeys.consumer_key;
    if (typeof appKeys.consumer_secret === ""string"") consumer_secret = appKeys.consumer_secret;
    if (!consumer_key)
      throw new HttpError({ statusCode: 400, message: ""Salesforce consumer key is missing."" });
    if (!consumer
---
[Medium] class SalesforceCalendarService in packages/app-store/salesforce/lib/CalendarService.ts:
class SalesforceCalendarService implements Calendar {
  private integrationName = """";
  private conn: Promise<jsforce.Connection>;
  private log: typeof logger;
  private calWarnings: string[] = [];

  constructor(credential: CredentialPayload) {
    this.integrationName = ""salesforce_other_calendar"";
    this.conn = this.getClient(credential).then((c) => c);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private getClient = async (credential: Creden
---
[Medium] function handler in packages/app-store/zoho-bigin/api/add.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === ""GET"") {
    const appKeys = await getAppKeysFromSlug(appConfig.slug);

    const clientId = typeof appKeys.client_id === ""string"" ? appKeys.client_id : """";
    if (!clientId) return res.status(400).json({ message: ""Zoho Bigin client_id missing."" });

    const redirectUri = WEBAPP_URL + `/api/integrations/zoho-bigin/callback`;

    const authUrl = axios.getUri({
      url: ""https://accounts.zoho.com/oauth/v
---
[Medium] method refreshAccessToken in packages/app-store/zoho-bigin/lib/CalendarService.ts:
private async refreshAccessToken(credentialId: number, credentialKey: BiginToken) {
    this.log.debug(""Refreshing token as it's invalid"");
    const grantType = ""refresh_token"";
    const accountsUrl = `${credentialKey.accountServer}/oauth/v2/token`;

    const appKeys = await getAppKeysFromSlug(this.integrationName);

    const { client_id: clientId, client_secret: clientSecret } = appKeysSchema.parse(appKeys);

    const formData = {
      grant_type: grantType,
      client_id: clientId,
   
---
[Medium] class BiginCalendarService in packages/app-store/zoho-bigin/lib/CalendarService.ts:
class BiginCalendarService implements Calendar {
  private readonly integrationName = ""zoho-bigin"";
  private readonly auth: { getToken: () => Promise<BiginToken> };
  private log: typeof logger;
  private eventsSlug = ""/bigin/v1/Events"";
  private contactsSlug = ""/bigin/v1/Contacts"";

  constructor(credential: CredentialPayload) {
    this.auth = this.biginAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  /***
   * Authenticate calend
---
[Medium] field zohoCrmAuth in packages/app-store/zohocrm/lib/CalendarService.ts:
private zohoCrmAuth = async (credential: CredentialPayload) => {
    const appKeys = await getAppKeysFromSlug(""zohocrm"");
    if (typeof appKeys.client_id === ""string"") this.client_id = appKeys.client_id;
    if (typeof appKeys.client_secret === ""string"") this.client_secret = appKeys.client_secret;
    if (!this.client_id) throw new HttpError({ statusCode: 400, message: ""Zoho CRM client_id missing."" });
    if (!this.client_secret)
      throw new HttpError({ statusCode: 400, message: ""Zoho CRM 
---
[Medium] class ZohoCrmCalendarService in packages/app-store/zohocrm/lib/CalendarService.ts:
class ZohoCrmCalendarService implements Calendar {
  private integrationName = """";
  private auth: Promise<{ getToken: () => Promise<void> }>;
  private log: typeof logger;
  private client_id = """";
  private client_secret = """";
  private accessToken = """";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""zohocrm_other_calendar"";
    this.auth = this.zohoCrmAuth(credential).then((r) => r);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`]
---
[Medium] variable zoomAuth in packages/app-store/zoomvideo/lib/VideoApiAdapter.ts:
const zoomAuth = (credential: CredentialPayload) => {
  const refreshAccessToken = async (refreshToken: string) => {
    const { client_id, client_secret } = await getZoomAppKeys();
    const authHeader = ""Basic "" + Buffer.from(client_id + "":"" + client_secret).toString(""base64"");

    const response = await refreshOAuthTokens(
      async () =>
        await fetch(""https://zoom.us/oauth/token"", {
          method: ""POST"",
          headers: {
            Authorization: authHeader,
            ""C
---
[Medium] object globalEnv in turbo.json:
  ""globalEnv"": [
    ""ALLOWED_HOSTNAMES"",
    ""ANALYZE"",
    ""API_KEY_PREFIX"",
    ""APP_USER_NAME"",
    ""BASECAMP3_CLIENT_ID"",
    ""BASECAMP3_CLIENT_SECRET"",
    ""BASECAMP3_USER_AGENT"",
    ""AUTH_BEARER_TOKEN_VERCEL"",
    ""BUILD_ID"",
    ""CALCOM_APP_CREDENTIAL_ENCRYPTION_KEY"",
    ""CALCOM_CREDENTIAL_SYNC_ENDPOINT"",
    ""CALCOM_ENV"",
    ""CALCOM_LICENSE_KEY"",
    ""CALCOM_TELEMETRY_DISABLED"",
    ""CALCOM_WEBHOOK_HEADER_NAME"",
    ""CALENDSO_ENCRYPTION_KEY"",
    ""CALCOM_WEBHOOK_SECRET"",
    ""CI"",
  ","APP_CREDENTIAL_SHARING_ENABLED (Critical), decodeOAuthState (Critical), encodeOAuthState (High), createOAuthAppCredential (High), minimumTokenResponseSchema (High), parseRefreshTokenResponse (High), refreshAccessToken (Medium), LarkCalendarService (Medium), webexAuth (Medium), createOAuthAppCredential (Medium), parseRefreshTokenResponse (Medium), refreshOAuthTokens (Medium), lines 241-246 (Medium), createOAuthAppCredential (Medium), createOAuthAppCredential (Medium), decodeOAuthState (Medium), encodeOAuthState (Medium), GoogleCalendarService (Medium), googleAuth (Medium), lines 221-240 (Medium), hubspotAuth (Medium), HubspotCalendarService (Medium), Office365CalendarService (Medium), o365Auth (Medium), o365Auth (Medium), getClient (Medium), SalesforceCalendarService (Medium), handler (Medium), refreshAccessToken (Medium), BiginCalendarService (Medium), zohoCrmAuth (Medium), ZohoCrmCalendarService (Medium), zoomAuth (Medium), globalEnv (Medium), lines 241-259 (Low), appCredentialWebhookRequestBodySchema (Low), handler (Low), refreshOAuthTokens (Low), salesforceTokenSchema (Low)",match,'res' matches HC entity 'minimumtokenresponseschema'
cal_dot_com,7,Advanced date override handling and timezone compatibility improvements,Incorrect end time calculation using slotStartTime instead of slotEndTime,Medium,5,1,3,"variable::getSlots (packages/lib/slots.ts) [Critical, score=0.94]","[Critical] variable getSlots in packages/lib/slots.ts:
const getSlots = ({
  inviteeDate,
  frequency,
  minimumBookingNotice,
  workingHours,
  dateOverrides = [],
  eventLength,
  organizerTimeZone,
}: GetSlots) => {
  // current date in invitee tz
  const startDate = dayjs().utcOffset(inviteeDate.utcOffset()).add(minimumBookingNotice, ""minute"");
  // This code is ran client side, startOf() does some conversions based on the
  // local tz of the client. Sometimes this shifts the day incorrectly.
  const startOfDayUTC = dayjs.utc().set(""hour"", 0).set(""minute"", 0).set(""second"", 0);
  const startOfInviteeDay = inviteeDate.startOf(""day"");
  // checks if the start date is in the past

  /**
   * TODO: change ""day"" for ""hour"" to stop displaying 1 day before today
   * This is displaying a day as available as sometimes difference between two dates ","[Medium] type TimeRange in packages/types/schedule.d.ts:
type TimeRange = {
  userId?: number | null;
  start: Date;
  end: Date;
  timeZone?: string;
};
---
[Medium] variable checkIfIsAvailable in packages/trpc/server/routers/viewer/slots.ts:
const checkIfIsAvailable = ({
  time,
  busy,
  eventLength,
  dateOverrides = [],
  workingHours = [],
  currentSeats,
  organizerTimeZone,
}: {
  time: Dayjs;
  busy: EventBusyDate[];
  eventLength: number;
  dateOverrides?: {
    start: Date;
    end: Date;
  }[];
  workingHours?: WorkingHours[];
  currentSeats?: CurrentSeats;
  organizerTimeZone?: string;
}): boolean => {
  if (currentSeats?.some((booking) => booking.startTime.toISOString() === time.toISOString())) {
    return true;
  }

  
---
[Medium] function getSchedule in packages/trpc/server/routers/viewer/slots.ts:
async function getSchedule(input: z.infer<typeof getScheduleSchema>, ctx: { prisma: typeof prisma }) {
  if (input.debug === true) {
    logger.setSettings({ minLevel: ""debug"" });
  }
  if (process.env.INTEGRATION_TEST_MODE === ""true"") {
    logger.setSettings({ minLevel: ""silly"" });
  }
  const startPrismaEventTypeGet = performance.now();
  const eventType = await getRegularOrDynamicEventType(ctx, input);
  const endPrismaEventTypeGet = performance.now();
  logger.debug(
    `Prisma eventType g","getSlots (Critical), TimeRange (Medium), checkIfIsAvailable (Medium), getSchedule (Medium), scheduleForEventOnADayWithDateOverrideDifferentTimezone (Low)",match,'time' matches entity 'timerange'
cal_dot_com,7,Advanced date override handling and timezone compatibility improvements,"Using === for dayjs object comparison will always return false as it compares object references, not values. Use .isSame() method instead: dayjs(date.start).add(utcOffset, 'minutes').isSame(dayjs(date.end).add(utcOffset, minutes))",Medium,5,1,3,"variable::getSlots (packages/lib/slots.ts) [Critical, score=0.94]","[Critical] variable getSlots in packages/lib/slots.ts:
const getSlots = ({
  inviteeDate,
  frequency,
  minimumBookingNotice,
  workingHours,
  dateOverrides = [],
  eventLength,
  organizerTimeZone,
}: GetSlots) => {
  // current date in invitee tz
  const startDate = dayjs().utcOffset(inviteeDate.utcOffset()).add(minimumBookingNotice, ""minute"");
  // This code is ran client side, startOf() does some conversions based on the
  // local tz of the client. Sometimes this shifts the day incorrectly.
  const startOfDayUTC = dayjs.utc().set(""hour"", 0).set(""minute"", 0).set(""second"", 0);
  const startOfInviteeDay = inviteeDate.startOf(""day"");
  // checks if the start date is in the past

  /**
   * TODO: change ""day"" for ""hour"" to stop displaying 1 day before today
   * This is displaying a day as available as sometimes difference between two dates ","[Medium] type TimeRange in packages/types/schedule.d.ts:
type TimeRange = {
  userId?: number | null;
  start: Date;
  end: Date;
  timeZone?: string;
};
---
[Medium] variable checkIfIsAvailable in packages/trpc/server/routers/viewer/slots.ts:
const checkIfIsAvailable = ({
  time,
  busy,
  eventLength,
  dateOverrides = [],
  workingHours = [],
  currentSeats,
  organizerTimeZone,
}: {
  time: Dayjs;
  busy: EventBusyDate[];
  eventLength: number;
  dateOverrides?: {
    start: Date;
    end: Date;
  }[];
  workingHours?: WorkingHours[];
  currentSeats?: CurrentSeats;
  organizerTimeZone?: string;
}): boolean => {
  if (currentSeats?.some((booking) => booking.startTime.toISOString() === time.toISOString())) {
    return true;
  }

  
---
[Medium] function getSchedule in packages/trpc/server/routers/viewer/slots.ts:
async function getSchedule(input: z.infer<typeof getScheduleSchema>, ctx: { prisma: typeof prisma }) {
  if (input.debug === true) {
    logger.setSettings({ minLevel: ""debug"" });
  }
  if (process.env.INTEGRATION_TEST_MODE === ""true"") {
    logger.setSettings({ minLevel: ""silly"" });
  }
  const startPrismaEventTypeGet = performance.now();
  const eventType = await getRegularOrDynamicEventType(ctx, input);
  const endPrismaEventTypeGet = performance.now();
  logger.debug(
    `Prisma eventType g","getSlots (Critical), TimeRange (Medium), checkIfIsAvailable (Medium), getSchedule (Medium), scheduleForEventOnADayWithDateOverrideDifferentTimezone (Low)",match,'date' matches entity 'scheduleforeventonadaywithdateoverridedifferenttimezone'
cal_dot_com,6,Comprehensive workflow reminder management for booking lifecycle events,"Asynchronous functions deleteScheduledEmailReminder and deleteScheduledSMSReminder are called without await inside forEach loops. This occurs during booking rescheduling/cancellation, and workflow/workflow step deletion/updates. Consequently, scheduled workflow reminders may not be reliably cancelled, potentially leaving them active.",Medium,12,3,7,"variable::deleteScheduledEmailReminder (packages/features/ee/workflows/lib/reminders/emailReminderManager.ts) [Critical, score=0.72] | variable::deleteScheduledSMSReminder (packages/features/ee/workflows/lib/reminders/smsReminderManager.ts) [Critical, score=0.72] | function::WorkflowStepContainer (packages/features/ee/workflows/components/WorkflowStepContainer.tsx) [High, score=0.56]","[Critical] variable deleteScheduledEmailReminder in packages/features/ee/workflows/lib/reminders/emailReminderManager.ts:
const deleteScheduledEmailReminder = async (
  reminderId: number,
  referenceId: string | null,
  immediateDelete?: boolean
) => {
  try {
    if (!referenceId) {
      await prisma.workflowReminder.delete({
        where: {
          id: reminderId,
        },
      });

      return;
    }

    if (immediateDelete) {
      await client.request({
        url: ""/v3/user/scheduled_sends"",
        method: ""POST"",
        body: {
          batch_id: referenceId,
          status: ""cancel"",
        },
      });
      return;
    }

    await prisma.workflowReminder.update({
      where: {
        id: reminderId,
      },
      data: {
        cancelled: true,
      },
    });
  } catch (error) {
    console.log(`Error canceling reminder with error ${error}`);
  }
};
---
[Critical] variable deleteScheduledSMSReminder in packages/features/ee/workflows/lib/reminders/smsReminderManager.ts:
const deleteScheduledSMSReminder = async (reminderId: number, referenceId: string | null) => {
  try {
    if (referenceId) {
      await twilio.cancelSMS(referenceId);
    }
    await prisma.workflowReminder.delete({
      where: {
        id: reminderId,
      },
    });
  } catch (error) {
    console.log(`Error canceling reminder with error ${error}`);
  }
};
---
[High] function WorkflowStepContainer in packages/features/ee/workflows/components/WorkflowStepContainer.tsx:
function WorkflowStepContainer(props: WorkflowStepProps) {
  const { t, i18n } = useLocale();
  const utils = trpc.useContext();

  const { step, form, reload, setReload } = props;
  const { data: _verifiedNumbers } = trpc.viewer.workflows.getVerifiedNumbers.useQuery();
  const verifiedNumbers = _verifiedNumbers?.map((number) => number.phoneNumber);
  const [isAdditionalInputsDialogOpen, setIsAdditionalInputsDialogOpen] = useState(false);
  const [confirmationDialogOpen, setConfirmationDialogOpen] = useState(false);

  const [verificationCode, setVerificationCode] = useState("""");

  const [isPhoneNumberNeeded, setIsPhoneNumberNeeded] = useState(
    step?.action === WorkflowActions.SMS_NUMBER ? true : false
  );

  const [isSenderIdNeeded, setIsSenderIdNeeded] = useState(
    step?.action ","[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(req: NextApiRequest & { userId?: number | undefined }) {
  const { userId } = req;

  const {
    recurringCount,
    allRecurringDates,
    currentRecurringIndex,
    noEmail,
    eventTypeSlug,
    eventTypeId,
    hasHashedBookingLink,
    language,
    appsStatus: reqAppsStatus,
    ...reqBody
  } = extendedBookingCreateBody.parse(req.body);

  // handle dynamic user
  const dynamicUserList = Array.isArray(reqBody.user)
    ? getGroupName(reqBody.user)
    : getUsernam
---
[Medium] chunk lines 661-661 in packages/prisma/schema.prisma:
}
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: NextApiRequest & { userId?: number }) {
  const { userId } = req;

  const { id, uid, allRemainingBookings, cancellationReason } = schemaBookingCancelParams.parse(req.body);

  const bookingToDelete = await prisma.booking.findUnique({
    where: {
      id,
      uid,
    },
    select: {
      ...bookingMinimalSelect,
      recurringEventId: true,
      userId: true,
      user: {
        select: {
          id: true,
          credentials: true,
          email: tru
---
[Medium] function handler in packages/features/ee/workflows/api/scheduleEmailReminders.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }

  if (!process.env.SENDGRID_API_KEY || !process.env.SENDGRID_EMAIL) {
    res.status(405).json({ message: ""No SendGrid API key or email"" });
    return;
  }

  //delete all scheduled email reminders where scheduled is past current date
  await pr
---
[Medium] chunk lines 641-660 in packages/prisma/schema.prisma:
  scheduled      Boolean
  workflowStepId Int
  workflowStep   WorkflowStep    @relation(fields: [workflowStepId], references: [id], onDelete: Cascade)
  cancelled      Boolean?
}

enum WorkflowTemplates {
  REMINDER
  CUSTOM
}

enum WorkflowMethods {
  EMAIL
  SMS
}

model VerifiedNumber {
  id          Int    @id @default(autoincrement())
  userId      Int
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
---
[Medium] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings.tsx:
const bookingsRouter = router({
  get: authedProcedure
    .input(
      z.object({
        filters: z.object({
          teamIds: z.number().array().optional(),
          userIds: z.number().array().optional(),
          status: z.enum([""upcoming"", ""recurring"", ""past"", ""cancelled"", ""unconfirmed""]),
          eventTypeIds: z.number().array().optional(),
        }),
        limit: z.number().min(1).max(100).nullish(),
        cursor: z.number().nullish(), // <-- ""cursor"" needs to exist when using
---
[Medium] variable workflowsRouter in packages/trpc/server/routers/viewer/workflows.tsx:
const workflowsRouter = router({
  list: authedProcedure.query(async ({ ctx }) => {
    const workflows = await ctx.prisma.workflow.findMany({
      where: {
        userId: ctx.user.id,
      },
      include: {
        activeOn: {
          select: {
            eventType: {
              select: {
                id: true,
                title: true,
              },
            },
          },
        },
        steps: true,
      },
      orderBy: {
        id: ""asc"",
      },
    });

   ","deleteScheduledEmailReminder (Critical), deleteScheduledSMSReminder (Critical), WorkflowStepContainer (High), handler (Medium), lines 661-661 (Medium), handler (Medium), handler (Medium), lines 641-660 (Medium), bookingsRouter (Medium), workflowsRouter (Medium), lines 1-2 (Low), lines 661-662 (Low)",match,'step' matches HC entity 'workflowstepcontainer'
cal_dot_com,6,Comprehensive workflow reminder management for booking lifecycle events,"When immediateDelete is true, the deleteScheduledEmailReminder function cancels the SendGrid email but fails to delete the corresponding WorkflowReminder record from the database. This creates orphaned database entries and is inconsistent with the immediateDelete: false path, which marks the record as cancelled. The SendGrid DELETE API call is also omitted in this path.",High,12,3,7,"variable::deleteScheduledEmailReminder (packages/features/ee/workflows/lib/reminders/emailReminderManager.ts) [Critical, score=0.72] | variable::deleteScheduledSMSReminder (packages/features/ee/workflows/lib/reminders/smsReminderManager.ts) [Critical, score=0.72] | function::WorkflowStepContainer (packages/features/ee/workflows/components/WorkflowStepContainer.tsx) [High, score=0.56]","[Critical] variable deleteScheduledEmailReminder in packages/features/ee/workflows/lib/reminders/emailReminderManager.ts:
const deleteScheduledEmailReminder = async (
  reminderId: number,
  referenceId: string | null,
  immediateDelete?: boolean
) => {
  try {
    if (!referenceId) {
      await prisma.workflowReminder.delete({
        where: {
          id: reminderId,
        },
      });

      return;
    }

    if (immediateDelete) {
      await client.request({
        url: ""/v3/user/scheduled_sends"",
        method: ""POST"",
        body: {
          batch_id: referenceId,
          status: ""cancel"",
        },
      });
      return;
    }

    await prisma.workflowReminder.update({
      where: {
        id: reminderId,
      },
      data: {
        cancelled: true,
      },
    });
  } catch (error) {
    console.log(`Error canceling reminder with error ${error}`);
  }
};
---
[Critical] variable deleteScheduledSMSReminder in packages/features/ee/workflows/lib/reminders/smsReminderManager.ts:
const deleteScheduledSMSReminder = async (reminderId: number, referenceId: string | null) => {
  try {
    if (referenceId) {
      await twilio.cancelSMS(referenceId);
    }
    await prisma.workflowReminder.delete({
      where: {
        id: reminderId,
      },
    });
  } catch (error) {
    console.log(`Error canceling reminder with error ${error}`);
  }
};
---
[High] function WorkflowStepContainer in packages/features/ee/workflows/components/WorkflowStepContainer.tsx:
function WorkflowStepContainer(props: WorkflowStepProps) {
  const { t, i18n } = useLocale();
  const utils = trpc.useContext();

  const { step, form, reload, setReload } = props;
  const { data: _verifiedNumbers } = trpc.viewer.workflows.getVerifiedNumbers.useQuery();
  const verifiedNumbers = _verifiedNumbers?.map((number) => number.phoneNumber);
  const [isAdditionalInputsDialogOpen, setIsAdditionalInputsDialogOpen] = useState(false);
  const [confirmationDialogOpen, setConfirmationDialogOpen] = useState(false);

  const [verificationCode, setVerificationCode] = useState("""");

  const [isPhoneNumberNeeded, setIsPhoneNumberNeeded] = useState(
    step?.action === WorkflowActions.SMS_NUMBER ? true : false
  );

  const [isSenderIdNeeded, setIsSenderIdNeeded] = useState(
    step?.action ","[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(req: NextApiRequest & { userId?: number | undefined }) {
  const { userId } = req;

  const {
    recurringCount,
    allRecurringDates,
    currentRecurringIndex,
    noEmail,
    eventTypeSlug,
    eventTypeId,
    hasHashedBookingLink,
    language,
    appsStatus: reqAppsStatus,
    ...reqBody
  } = extendedBookingCreateBody.parse(req.body);

  // handle dynamic user
  const dynamicUserList = Array.isArray(reqBody.user)
    ? getGroupName(reqBody.user)
    : getUsernam
---
[Medium] chunk lines 661-661 in packages/prisma/schema.prisma:
}
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: NextApiRequest & { userId?: number }) {
  const { userId } = req;

  const { id, uid, allRemainingBookings, cancellationReason } = schemaBookingCancelParams.parse(req.body);

  const bookingToDelete = await prisma.booking.findUnique({
    where: {
      id,
      uid,
    },
    select: {
      ...bookingMinimalSelect,
      recurringEventId: true,
      userId: true,
      user: {
        select: {
          id: true,
          credentials: true,
          email: tru
---
[Medium] function handler in packages/features/ee/workflows/api/scheduleEmailReminders.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }

  if (!process.env.SENDGRID_API_KEY || !process.env.SENDGRID_EMAIL) {
    res.status(405).json({ message: ""No SendGrid API key or email"" });
    return;
  }

  //delete all scheduled email reminders where scheduled is past current date
  await pr
---
[Medium] chunk lines 641-660 in packages/prisma/schema.prisma:
  scheduled      Boolean
  workflowStepId Int
  workflowStep   WorkflowStep    @relation(fields: [workflowStepId], references: [id], onDelete: Cascade)
  cancelled      Boolean?
}

enum WorkflowTemplates {
  REMINDER
  CUSTOM
}

enum WorkflowMethods {
  EMAIL
  SMS
}

model VerifiedNumber {
  id          Int    @id @default(autoincrement())
  userId      Int
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
---
[Medium] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings.tsx:
const bookingsRouter = router({
  get: authedProcedure
    .input(
      z.object({
        filters: z.object({
          teamIds: z.number().array().optional(),
          userIds: z.number().array().optional(),
          status: z.enum([""upcoming"", ""recurring"", ""past"", ""cancelled"", ""unconfirmed""]),
          eventTypeIds: z.number().array().optional(),
        }),
        limit: z.number().min(1).max(100).nullish(),
        cursor: z.number().nullish(), // <-- ""cursor"" needs to exist when using
---
[Medium] variable workflowsRouter in packages/trpc/server/routers/viewer/workflows.tsx:
const workflowsRouter = router({
  list: authedProcedure.query(async ({ ctx }) => {
    const workflows = await ctx.prisma.workflow.findMany({
      where: {
        userId: ctx.user.id,
      },
      include: {
        activeOn: {
          select: {
            eventType: {
              select: {
                id: true,
                title: true,
              },
            },
          },
        },
        steps: true,
      },
      orderBy: {
        id: ""asc"",
      },
    });

   ","deleteScheduledEmailReminder (Critical), deleteScheduledSMSReminder (Critical), WorkflowStepContainer (High), handler (Medium), lines 661-661 (Medium), handler (Medium), handler (Medium), lines 641-660 (Medium), bookingsRouter (Medium), workflowsRouter (Medium), lines 1-2 (Low), lines 661-662 (Low)",match,'deleteScheduledEmailReminder' matches HC entity 'deletescheduledemailreminder'
cal_dot_com,5,feat: convert InsightsBookingService to use Prisma.sql raw queries,"In getBaseConditions(), the else if (filterConditions) and final else branches are unreachable. This is because getAuthorizationConditions() always returns a non-null Prisma.Sql object, making authConditions always truthy, which means only the first two if/else if conditions are ever evaluated.",Low,23,15,7,"method::getFilterConditions (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.96] | class::InsightsBookingService (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.92] | method::getAuthorizationConditions (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.90] | method::getBaseConditions (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.74] | method::buildFilterConditions (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.71] | variable::baseConditions (packages/lib/server/service/__tests__/insightsBooking.integration-test.ts) [High, score=0.69] | method::buildOrgAuthorizationCondition (packages/lib/server/service/insightsBooking.ts) [High, score=0.68] | method::buildTeamAuthorizationCondition (packages/lib/server/service/insightsBooking.ts) [High, score=0.68] | variable::NOTHING_CONDITION (packages/lib/server/service/insightsBooking.ts) [High, score=0.67] | method::buildAuthorizationConditions (packages/lib/server/service/insightsBooking.ts) [High, score=0.65] | method::isOrgOwnerOrAdmin (packages/lib/server/service/insightsBooking.ts) [High, score=0.65] | field::cachedAuthConditions (packages/lib/server/service/insightsBooking.ts) [High, score=0.65] | field::cachedFilterConditions (packages/lib/server/service/insightsBooking.ts) [High, score=0.65] | type::InsightsBookingServicePublicOptions (packages/lib/server/service/insightsBooking.ts) [High, score=0.59] | method::constructor (packages/lib/server/service/insightsBooking.ts) [High, score=0.59]","[Critical] method getFilterConditions in packages/lib/server/service/insightsBooking.ts:
async getFilterConditions(): Promise<Prisma.Sql | null> {
    if (this.cachedFilterConditions === undefined) {
      this.cachedFilterConditions = await this.buildFilterConditions();
    }
    return this.cachedFilterConditions;
  }
---
[Critical] class InsightsBookingService in packages/lib/server/service/insightsBooking.ts:
class InsightsBookingService {
  private prisma: typeof readonlyPrisma;
  private options: InsightsBookingServiceOptions | null;
  private filters?: InsightsBookingServiceFilterOptions;
  private cachedAuthConditions?: Prisma.Sql;
  private cachedFilterConditions?: Prisma.Sql | null;

  constructor({
    prisma,
    options,
    filters,
  }: {
    prisma: typeof readonlyPrisma;
    options: InsightsBookingServicePublicOptions;
    filters?: InsightsBookingServiceFilterOptions;
  }) {
    this.prisma = prisma;
    const validation = insightsBookingServiceOptionsSchema.safeParse(options);
    this.options = validation.success ? validation.data : null;

    this.filters = filters;
  }

  async getBaseConditions(): Promise<Prisma.Sql> {
    const authConditions = await this.getAuthorizationCo
---
[Critical] method getAuthorizationConditions in packages/lib/server/service/insightsBooking.ts:
async getAuthorizationConditions(): Promise<Prisma.Sql> {
    if (this.cachedAuthConditions === undefined) {
      this.cachedAuthConditions = await this.buildAuthorizationConditions();
    }
    return this.cachedAuthConditions;
  }
---
[Critical] method getBaseConditions in packages/lib/server/service/insightsBooking.ts:
async getBaseConditions(): Promise<Prisma.Sql> {
    const authConditions = await this.getAuthorizationConditions();
    const filterConditions = await this.getFilterConditions();

    if (authConditions && filterConditions) {
      return Prisma.sql`(${authConditions}) AND (${filterConditions})`;
    } else if (authConditions) {
      return authConditions;
    } else if (filterConditions) {
      return filterConditions;
    } else {
      return NOTHING_CONDITION;
    }
  }
---
[Critical] method buildFilterConditions in packages/lib/server/service/insightsBooking.ts:
async buildFilterConditions(): Promise<Prisma.Sql | null> {
    const conditions: Prisma.Sql[] = [];

    if (!this.filters) {
      return null;
    }

    if (this.filters.eventTypeId) {
      conditions.push(
        Prisma.sql`(""eventTypeId"" = ${this.filters.eventTypeId}) OR (""eventParentId"" = ${this.filters.eventTypeId})`
      );
    }

    if (this.filters.memberUserId) {
      conditions.push(Prisma.sql`""userId"" = ${this.filters.memberUserId}`);
    }

    if (conditions.length === 0) {
      return null;
    }

    // Join all conditions with AND
    return conditions.reduce((acc, condition, index) => {
      if (index === 0) return condition;
      return Prisma.sql`(${acc}) AND (${condition})`;
    });
  }
---
[High] variable baseConditions in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const baseConditions = await service.getBaseConditions();
---
[High] method buildOrgAuthorizationCondition in packages/lib/server/service/insightsBooking.ts:
private async buildOrgAuthorizationCondition(
    options: Extract<InsightsBookingServiceOptions, { scope: ""org"" }>
  ): Promise<Prisma.Sql> {
    // Get all teams from the organization
    const teamRepo = new TeamRepository(this.prisma);
    const teamsFromOrg = await teamRepo.findAllByParentId({
      parentId: options.orgId,
      select: { id: true },
    });
    const teamIds = [options.orgId, ...teamsFromOrg.map((t) => t.id)];

    // Get all users from the organization
    const userIdsFromOrg =
      teamsFromOrg.length > 0
        ? (await MembershipRepository.findAllByTeamIds({ teamIds, select: { userId: true } })).map(
            (m) => m.userId
          )
        : [];

    const conditions: Prisma.Sql[] = [Prisma.sql`(""teamId"" = ANY(${teamIds})) AND (""isTeamBooking"" = true)
---
[High] method buildTeamAuthorizationCondition in packages/lib/server/service/insightsBooking.ts:
private async buildTeamAuthorizationCondition(
    options: Extract<InsightsBookingServiceOptions, { scope: ""team"" }>
  ): Promise<Prisma.Sql> {
    const teamRepo = new TeamRepository(this.prisma);
    const childTeamOfOrg = await teamRepo.findByIdAndParentId({
      id: options.teamId,
      parentId: options.orgId,
      select: { id: true },
    });
    if (!childTeamOfOrg) {
      return NOTHING_CONDITION;
    }

    const usersFromTeam = await MembershipRepository.findAllByTeamIds({
      teamIds: [options.teamId],
      select: { userId: true },
    });
    const userIdsFromTeam = usersFromTeam.map((u) => u.userId);

    const conditions: Prisma.Sql[] = [
      Prisma.sql`(""teamId"" = ${options.teamId}) AND (""isTeamBooking"" = true)`,
    ];

    if (userIdsFromTeam.length > 0) {
    
---
[High] variable NOTHING_CONDITION in packages/lib/server/service/insightsBooking.ts:
const NOTHING_CONDITION = Prisma.sql`1=0`;
---
[High] method buildAuthorizationConditions in packages/lib/server/service/insightsBooking.ts:
async buildAuthorizationConditions(): Promise<Prisma.Sql> {
    if (!this.options) {
      return NOTHING_CONDITION;
    }
    const isOwnerOrAdmin = await this.isOrgOwnerOrAdmin(this.options.userId, this.options.orgId);
    if (!isOwnerOrAdmin) {
      return NOTHING_CONDITION;
    }

    if (this.options.scope === ""user"") {
      return Prisma.sql`(""userId"" = ${this.options.userId}) AND (""teamId"" IS NULL)`;
    } else if (this.options.scope === ""org"") {
      return await this.buildOrgAuthorizationCondition(this.options);
    } else if (this.options.scope === ""team"") {
      return await this.buildTeamAuthorizationCondition(this.options);
    } else {
      return NOTHING_CONDITION;
    }
  }
---
[High] method isOrgOwnerOrAdmin in packages/lib/server/service/insightsBooking.ts:
private async isOrgOwnerOrAdmin(userId: number, orgId: number): Promise<boolean> {
    // Check if the user is an owner or admin of the organization
    const membership = await MembershipRepository.findUniqueByUserIdAndTeamId({ userId, teamId: orgId });
    return Boolean(
      membership &&
        membership.accepted &&
        membership.role &&
        (membership.role === MembershipRole.OWNER || membership.role === MembershipRole.ADMIN)
    );
  }
---
[High] field cachedAuthConditions in packages/lib/server/service/insightsBooking.ts:
private cachedAuthConditions?: Prisma.Sql
---
[High] field cachedFilterConditions in packages/lib/server/service/insightsBooking.ts:
private cachedFilterConditions?: Prisma.Sql | null
---
[High] type InsightsBookingServicePublicOptions in packages/lib/server/service/insightsBooking.ts:
type InsightsBookingServicePublicOptions = {
  scope: ""user"" | ""org"" | ""team"";
  userId: number;
  orgId: number;
  teamId?: number;
};
---
[High] method constructor in packages/lib/server/service/insightsBooking.ts:
constructor({
    prisma,
    options,
    filters,
  }: {
    prisma: typeof readonlyPrisma;
    options: InsightsBookingServicePublicOptions;
    filters?: InsightsBookingServiceFilterOptions;
  }) {
    this.prisma = prisma;
    const validation = insightsBookingServiceOptionsSchema.safeParse(options);
    this.options = validation.success ? validation.data : null;

    this.filters = filters;
  }","[Medium] variable conditions1 in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const conditions1 = await service.getAuthorizationConditions();
---
[Medium] variable conditions2 in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const conditions2 = await service.getAuthorizationConditions();
---
[Medium] variable conditions1 in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const conditions1 = await service.getFilterConditions();
---
[Medium] variable conditions2 in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const conditions2 = await service.getFilterConditions();
---
[Medium] variable NOTHING in packages/lib/server/service/insightsBooking.ts:
const NOTHING = {
  id: -1,
} as const;
---
[Medium] method findMany in packages/lib/server/service/insightsBooking.ts:
async findMany(findManyArgs: Prisma.BookingTimeStatusDenormalizedFindManyArgs) {
    const authConditions = await this.getAuthorizationConditions();
    const filterConditions = await this.getFilterConditions();

    return this.prisma.bookingTimeStatusDenormalized.findMany({
      ...findManyArgs,
      where: {
        ...findManyArgs.where,
        AND: [authConditions, filterConditions].filter(
          (c): c is Prisma.BookingTimeStatusDenormalizedWhereInput => c !== null
        ),
      
---
[Medium] variable results in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const results = await prisma.$queryRaw<{ id: number }[]>`
        SELECT id FROM ""BookingTimeStatusDenormalized""
        WHERE ${baseConditions}
      `;","getFilterConditions (Critical), InsightsBookingService (Critical), getAuthorizationConditions (Critical), getBaseConditions (Critical), buildFilterConditions (Critical), baseConditions (High), buildOrgAuthorizationCondition (High), buildTeamAuthorizationCondition (High), NOTHING_CONDITION (High), buildAuthorizationConditions (High), isOrgOwnerOrAdmin (High), cachedAuthConditions (High), cachedFilterConditions (High), InsightsBookingServicePublicOptions (High), constructor (High), conditions1 (Medium), conditions2 (Medium), conditions1 (Medium), conditions2 (Medium), NOTHING (Medium), findMany (Medium), results (Medium), NOTHING_CONDITION (Low)",match,'conditions' matches HC entity 'cachedfilterconditions'
cal_dot_com,5,feat: convert InsightsBookingService to use Prisma.sql raw queries,Fetching userIdsFromOrg only when teamsFromOrg.length > 0 can exclude org-level members for orgs without child teams; consider deriving from teamIds (which includes orgId) or removing the guard so org-only orgs still include member user bookings.,Medium,23,15,7,"method::getFilterConditions (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.96] | class::InsightsBookingService (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.92] | method::getAuthorizationConditions (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.90] | method::getBaseConditions (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.74] | method::buildFilterConditions (packages/lib/server/service/insightsBooking.ts) [Critical, score=0.71] | variable::baseConditions (packages/lib/server/service/__tests__/insightsBooking.integration-test.ts) [High, score=0.69] | method::buildOrgAuthorizationCondition (packages/lib/server/service/insightsBooking.ts) [High, score=0.68] | method::buildTeamAuthorizationCondition (packages/lib/server/service/insightsBooking.ts) [High, score=0.68] | variable::NOTHING_CONDITION (packages/lib/server/service/insightsBooking.ts) [High, score=0.67] | method::buildAuthorizationConditions (packages/lib/server/service/insightsBooking.ts) [High, score=0.65] | method::isOrgOwnerOrAdmin (packages/lib/server/service/insightsBooking.ts) [High, score=0.65] | field::cachedAuthConditions (packages/lib/server/service/insightsBooking.ts) [High, score=0.65] | field::cachedFilterConditions (packages/lib/server/service/insightsBooking.ts) [High, score=0.65] | type::InsightsBookingServicePublicOptions (packages/lib/server/service/insightsBooking.ts) [High, score=0.59] | method::constructor (packages/lib/server/service/insightsBooking.ts) [High, score=0.59]","[Critical] method getFilterConditions in packages/lib/server/service/insightsBooking.ts:
async getFilterConditions(): Promise<Prisma.Sql | null> {
    if (this.cachedFilterConditions === undefined) {
      this.cachedFilterConditions = await this.buildFilterConditions();
    }
    return this.cachedFilterConditions;
  }
---
[Critical] class InsightsBookingService in packages/lib/server/service/insightsBooking.ts:
class InsightsBookingService {
  private prisma: typeof readonlyPrisma;
  private options: InsightsBookingServiceOptions | null;
  private filters?: InsightsBookingServiceFilterOptions;
  private cachedAuthConditions?: Prisma.Sql;
  private cachedFilterConditions?: Prisma.Sql | null;

  constructor({
    prisma,
    options,
    filters,
  }: {
    prisma: typeof readonlyPrisma;
    options: InsightsBookingServicePublicOptions;
    filters?: InsightsBookingServiceFilterOptions;
  }) {
    this.prisma = prisma;
    const validation = insightsBookingServiceOptionsSchema.safeParse(options);
    this.options = validation.success ? validation.data : null;

    this.filters = filters;
  }

  async getBaseConditions(): Promise<Prisma.Sql> {
    const authConditions = await this.getAuthorizationCo
---
[Critical] method getAuthorizationConditions in packages/lib/server/service/insightsBooking.ts:
async getAuthorizationConditions(): Promise<Prisma.Sql> {
    if (this.cachedAuthConditions === undefined) {
      this.cachedAuthConditions = await this.buildAuthorizationConditions();
    }
    return this.cachedAuthConditions;
  }
---
[Critical] method getBaseConditions in packages/lib/server/service/insightsBooking.ts:
async getBaseConditions(): Promise<Prisma.Sql> {
    const authConditions = await this.getAuthorizationConditions();
    const filterConditions = await this.getFilterConditions();

    if (authConditions && filterConditions) {
      return Prisma.sql`(${authConditions}) AND (${filterConditions})`;
    } else if (authConditions) {
      return authConditions;
    } else if (filterConditions) {
      return filterConditions;
    } else {
      return NOTHING_CONDITION;
    }
  }
---
[Critical] method buildFilterConditions in packages/lib/server/service/insightsBooking.ts:
async buildFilterConditions(): Promise<Prisma.Sql | null> {
    const conditions: Prisma.Sql[] = [];

    if (!this.filters) {
      return null;
    }

    if (this.filters.eventTypeId) {
      conditions.push(
        Prisma.sql`(""eventTypeId"" = ${this.filters.eventTypeId}) OR (""eventParentId"" = ${this.filters.eventTypeId})`
      );
    }

    if (this.filters.memberUserId) {
      conditions.push(Prisma.sql`""userId"" = ${this.filters.memberUserId}`);
    }

    if (conditions.length === 0) {
      return null;
    }

    // Join all conditions with AND
    return conditions.reduce((acc, condition, index) => {
      if (index === 0) return condition;
      return Prisma.sql`(${acc}) AND (${condition})`;
    });
  }
---
[High] variable baseConditions in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const baseConditions = await service.getBaseConditions();
---
[High] method buildOrgAuthorizationCondition in packages/lib/server/service/insightsBooking.ts:
private async buildOrgAuthorizationCondition(
    options: Extract<InsightsBookingServiceOptions, { scope: ""org"" }>
  ): Promise<Prisma.Sql> {
    // Get all teams from the organization
    const teamRepo = new TeamRepository(this.prisma);
    const teamsFromOrg = await teamRepo.findAllByParentId({
      parentId: options.orgId,
      select: { id: true },
    });
    const teamIds = [options.orgId, ...teamsFromOrg.map((t) => t.id)];

    // Get all users from the organization
    const userIdsFromOrg =
      teamsFromOrg.length > 0
        ? (await MembershipRepository.findAllByTeamIds({ teamIds, select: { userId: true } })).map(
            (m) => m.userId
          )
        : [];

    const conditions: Prisma.Sql[] = [Prisma.sql`(""teamId"" = ANY(${teamIds})) AND (""isTeamBooking"" = true)
---
[High] method buildTeamAuthorizationCondition in packages/lib/server/service/insightsBooking.ts:
private async buildTeamAuthorizationCondition(
    options: Extract<InsightsBookingServiceOptions, { scope: ""team"" }>
  ): Promise<Prisma.Sql> {
    const teamRepo = new TeamRepository(this.prisma);
    const childTeamOfOrg = await teamRepo.findByIdAndParentId({
      id: options.teamId,
      parentId: options.orgId,
      select: { id: true },
    });
    if (!childTeamOfOrg) {
      return NOTHING_CONDITION;
    }

    const usersFromTeam = await MembershipRepository.findAllByTeamIds({
      teamIds: [options.teamId],
      select: { userId: true },
    });
    const userIdsFromTeam = usersFromTeam.map((u) => u.userId);

    const conditions: Prisma.Sql[] = [
      Prisma.sql`(""teamId"" = ${options.teamId}) AND (""isTeamBooking"" = true)`,
    ];

    if (userIdsFromTeam.length > 0) {
    
---
[High] variable NOTHING_CONDITION in packages/lib/server/service/insightsBooking.ts:
const NOTHING_CONDITION = Prisma.sql`1=0`;
---
[High] method buildAuthorizationConditions in packages/lib/server/service/insightsBooking.ts:
async buildAuthorizationConditions(): Promise<Prisma.Sql> {
    if (!this.options) {
      return NOTHING_CONDITION;
    }
    const isOwnerOrAdmin = await this.isOrgOwnerOrAdmin(this.options.userId, this.options.orgId);
    if (!isOwnerOrAdmin) {
      return NOTHING_CONDITION;
    }

    if (this.options.scope === ""user"") {
      return Prisma.sql`(""userId"" = ${this.options.userId}) AND (""teamId"" IS NULL)`;
    } else if (this.options.scope === ""org"") {
      return await this.buildOrgAuthorizationCondition(this.options);
    } else if (this.options.scope === ""team"") {
      return await this.buildTeamAuthorizationCondition(this.options);
    } else {
      return NOTHING_CONDITION;
    }
  }
---
[High] method isOrgOwnerOrAdmin in packages/lib/server/service/insightsBooking.ts:
private async isOrgOwnerOrAdmin(userId: number, orgId: number): Promise<boolean> {
    // Check if the user is an owner or admin of the organization
    const membership = await MembershipRepository.findUniqueByUserIdAndTeamId({ userId, teamId: orgId });
    return Boolean(
      membership &&
        membership.accepted &&
        membership.role &&
        (membership.role === MembershipRole.OWNER || membership.role === MembershipRole.ADMIN)
    );
  }
---
[High] field cachedAuthConditions in packages/lib/server/service/insightsBooking.ts:
private cachedAuthConditions?: Prisma.Sql
---
[High] field cachedFilterConditions in packages/lib/server/service/insightsBooking.ts:
private cachedFilterConditions?: Prisma.Sql | null
---
[High] type InsightsBookingServicePublicOptions in packages/lib/server/service/insightsBooking.ts:
type InsightsBookingServicePublicOptions = {
  scope: ""user"" | ""org"" | ""team"";
  userId: number;
  orgId: number;
  teamId?: number;
};
---
[High] method constructor in packages/lib/server/service/insightsBooking.ts:
constructor({
    prisma,
    options,
    filters,
  }: {
    prisma: typeof readonlyPrisma;
    options: InsightsBookingServicePublicOptions;
    filters?: InsightsBookingServiceFilterOptions;
  }) {
    this.prisma = prisma;
    const validation = insightsBookingServiceOptionsSchema.safeParse(options);
    this.options = validation.success ? validation.data : null;

    this.filters = filters;
  }","[Medium] variable conditions1 in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const conditions1 = await service.getAuthorizationConditions();
---
[Medium] variable conditions2 in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const conditions2 = await service.getAuthorizationConditions();
---
[Medium] variable conditions1 in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const conditions1 = await service.getFilterConditions();
---
[Medium] variable conditions2 in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const conditions2 = await service.getFilterConditions();
---
[Medium] variable NOTHING in packages/lib/server/service/insightsBooking.ts:
const NOTHING = {
  id: -1,
} as const;
---
[Medium] method findMany in packages/lib/server/service/insightsBooking.ts:
async findMany(findManyArgs: Prisma.BookingTimeStatusDenormalizedFindManyArgs) {
    const authConditions = await this.getAuthorizationConditions();
    const filterConditions = await this.getFilterConditions();

    return this.prisma.bookingTimeStatusDenormalized.findMany({
      ...findManyArgs,
      where: {
        ...findManyArgs.where,
        AND: [authConditions, filterConditions].filter(
          (c): c is Prisma.BookingTimeStatusDenormalizedWhereInput => c !== null
        ),
      
---
[Medium] variable results in packages/lib/server/service/__tests__/insightsBooking.integration-test.ts:
const results = await prisma.$queryRaw<{ id: number }[]>`
        SELECT id FROM ""BookingTimeStatusDenormalized""
        WHERE ${baseConditions}
      `;","getFilterConditions (Critical), InsightsBookingService (Critical), getAuthorizationConditions (Critical), getBaseConditions (Critical), buildFilterConditions (Critical), baseConditions (High), buildOrgAuthorizationCondition (High), buildTeamAuthorizationCondition (High), NOTHING_CONDITION (High), buildAuthorizationConditions (High), isOrgOwnerOrAdmin (High), cachedAuthConditions (High), cachedFilterConditions (High), InsightsBookingServicePublicOptions (High), constructor (High), conditions1 (Medium), conditions2 (Medium), conditions1 (Medium), conditions2 (Medium), NOTHING (Medium), findMany (Medium), results (Medium), NOTHING_CONDITION (Low)",match,'org' matches HC entity 'buildorgauthorizationcondition'
cal_dot_com,4,fix: handle collective multiple host on destinationCalendar,Potential null reference if mainHostDestinationCalendar is undefined if evt.destinationCalendar is null or an empty array ,High,37,7,30,"interface::EventResult (packages/types/EventManager.d.ts) [Critical, score=1.00] | interface::Calendar (packages/types/Calendar.d.ts) [Critical, score=0.77] | interface::CalendarEvent (packages/types/Calendar.d.ts) [Critical, score=0.77] | variable::requestRescheduleHandler (packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts) [Critical, score=0.75] | variable::confirmHandler (packages/trpc/server/routers/viewer/bookings/confirm.handler.ts) [High, score=0.69] | variable::BrokenIntegrationEmail (packages/emails/src/templates/BrokenIntegrationEmail.tsx) [High, score=0.59] | method::deleteEvent (packages/app-store/larkcalendar/lib/CalendarService.ts) [High, score=0.51]","[Critical] interface EventResult in packages/types/EventManager.d.ts:
interface EventResult<T> {
  type: string;
  appName: string;
  success: boolean;
  uid: string;
  iCalUID?: string | null;
  createdEvent?: T;
  updatedEvent?: T | T[];
  originalEvent: CalendarEvent;
  calError?: string;
  calWarnings?: string[];
  credentialId?: number;
  externalId?: string | null;
}
---
[Critical] interface Calendar in packages/types/Calendar.d.ts:
interface Calendar {
  createEvent(event: CalendarEvent, credentialId: number): Promise<NewCalendarEventType>;

  updateEvent(
    uid: string,
    event: CalendarEvent,
    externalCalendarId?: string | null
  ): Promise<NewCalendarEventType | NewCalendarEventType[]>;

  deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<unknown>;

  getAvailability(
    dateFrom: string,
    dateTo: string,
    selectedCalendars: IntegrationCalendar[]
  ): Promise<EventBusyDate[]>;

  listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]>;
}
---
[Critical] interface CalendarEvent in packages/types/Calendar.d.ts:
interface CalendarEvent {
  // Instead of sending this per event.
  // TODO: Links sent in email should be validated and automatically redirected to org domain or regular app. It would be a much cleaner way. Maybe use existing /api/link endpoint
  bookerUrl?: string;
  type: string;
  title: string;
  startTime: string;
  endTime: string;
  organizer: Person;
  attendees: Person[];
  additionalNotes?: string | null;
  customInputs?: Prisma.JsonObject | null;
  description?: string | null;
  team?: {
    name: string;
    members: TeamMember[];
  };
  location?: string | null;
  conferenceCredentialId?: number;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: PaymentInfo | null;
  requ
---
[Critical] variable requestRescheduleHandler in packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts:
const requestRescheduleHandler = async ({ ctx, input }: RequestRescheduleOptions) => {
  const { user } = ctx;
  const { bookingId, rescheduleReason: cancellationReason } = input;

  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      userId: true,
      title: true,
      description: true,
      startTime: true,
      endTime: true,
      eventTypeId: true,
      eventType: true,
      location: true,
      attendees: true,
      references: true,
      customInputs: true,
      dynamicEventSlugRef: true,
      dynamicGroupSlugRef: true,
      destinationCalendar: true,
      smsReminderNumber: true,
      scheduledJobs: true,
      workflowReminders: true,
      responses: true,
    },
    where: {
      uid: bookingId
---
[High] variable confirmHandler in packages/trpc/server/routers/viewer/bookings/confirm.handler.ts:
const confirmHandler = async ({ ctx, input }: ConfirmOptions) => {
  const { user } = ctx;
  const { bookingId, recurringEventId, reason: rejectionReason, confirmed } = input;

  const tOrganizer = await getTranslation(user.locale ?? ""en"", ""common"");

  const booking = await prisma.booking.findUniqueOrThrow({
    where: {
      id: bookingId,
    },
    select: {
      title: true,
      description: true,
      customInputs: true,
      startTime: true,
      endTime: true,
      attendees: true,
      eventTypeId: true,
      responses: true,
      eventType: {
        select: {
          id: true,
          owner: true,
          teamId: true,
          recurringEvent: true,
          title: true,
          requiresConfirmation: true,
          currency: true,
          length: true,
  
---
[High] variable BrokenIntegrationEmail in packages/emails/src/templates/BrokenIntegrationEmail.tsx:
const BrokenIntegrationEmail = (
  props: {
    calEvent: CalendarEvent;
    attendee: Person;
    type: ""video"" | ""calendar"";
  } & Partial<React.ComponentProps<typeof BaseScheduledEmail>>
) => {
  const { calEvent, type } = props;
  const t = calEvent.organizer.language.translate;
  const locale = calEvent.organizer.language.locale;
  const timeFormat = calEvent.organizer?.timeFormat;

  if (type === ""video"") {
    let location = calEvent.location ? getEnumKeyByEnumValue(AppStoreLocationType, calEvent.location) : "" "";
    if (location === ""Daily"") {
      location = ""Cal Video"";
    }
    if (location === ""GoogleMeet"") {
      location = location.slice(0, 5) + "" "" + location.slice(5);
    }

    return (
      <BaseScheduledEmail
        timeZone={calEvent.organizer.timeZone}
        t={
---
[High] method deleteEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in deleteEvent"");
      throw new Error(""no calendar id provided in deleteEvent"");
    }
    try {
      const response = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/${uid}`, {
        method: ""DELETE"",
      });
      await handleLarkError(response, this.log);
    } catch (error) {
      this.log.error(error);
      throw error;
    }
  }","[Medium] field createAttendees in packages/app-store/larkcalendar/lib/CalendarService.ts:
private createAttendees = async (event: CalendarEvent, eventId: string) => {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in createAttendees"");
      throw new Error(""no calendar id provided in createAttendees"");
    }
    const attendeeResponse = await this.fetcher(
      `/calendar/v4/calendars/${calendarId}/events/${eventId}/attende
---
[Medium] method listCalendars in packages/lib/CalendarService.ts:
async listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]> {
    try {
      const account = await this.getAccount();

      const calendars = (await fetchCalendars({
        account,
        headers: this.headers,
      })) /** @url https://github.com/natelindev/tsdav/pull/139 */ as (Omit<DAVCalendar, ""displayName""> & {
        displayName?: string | Record<string, unknown>;
      })[];

      return calendars.reduce<IntegrationCalendar[]>((newCalendars, calendar) => {
        i
---
[Medium] method createEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async createEvent(calEventRaw: CalendarEvent, credentialId: number): Promise<NewCalendarEventType> {
    const eventAttendees = calEventRaw.attendees.map(({ id: _id, ...rest }) => ({
      ...rest,
      responseStatus: ""accepted"",
    }));
    // TODO: Check every other CalendarService for team members
    const teamMembers =
      calEventRaw.team?.members.map((m) => ({
        email: m.email,
        displayName: m.name,
        responseStatus: ""accepted"",
      })) || [];
    return new Prom
---
[Medium] method deleteEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<void> {
    return new Promise(async (resolve, reject) => {
      const myGoogleAuth = await this.auth.getToken();
      const calendar = google.calendar({
        version: ""v3"",
        auth: myGoogleAuth,
      });

      const defaultCalendarId = ""primary"";
      const calendarId = externalCalendarId
        ? externalCalendarId
        : event.destinationCalendar?.find((cal) => cal.externalId ==
---
[Medium] method updateEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId: string): Promise<any> {
    return new Promise(async (resolve, reject) => {
      const [mainHostDestinationCalendar] =
        event?.destinationCalendar && event?.destinationCalendar.length > 0 ? event.destinationCalendar : [];
      const myGoogleAuth = await this.auth.getToken();
      const eventAttendees = event.attendees.map(({ ...rest }) => ({
        ...rest,
        responseStatus: ""accepted"",
      }));
      con
---
[Medium] method updateEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const eventId = uid;
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in updateEvent"");
      throw new Error(""no calendar id provided in updateEvent"");
    }
    try {
      const eventResponse = await this.
---
[Medium] method createEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    let eventId = """";
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      throw new Error(""no calendar id"");
    }
    try {
      const eventResponse = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/create_event`, {
        method: ""POST"",
        body: JSON.stringify(t
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private larkAuth = (credential: CredentialPayload) => {
    const l
---
[Medium] method createEvent in packages/app-store/office365calendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    try {
      const eventsUrl = mainHostDestinationCalendar?.externalId
        ? `/me/calendars/${mainHostDestinationCalendar?.externalId}/events`
        : ""/me/calendar/events"";

      const response = await this.fetcher(eventsUrl, {
        method: ""POST"",
        body: JSON.stringify(this.translateEvent(event)),
      });

      const response
---
[Medium] method createEvent in packages/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    try {
      const calendars = await this.listCalendars(event);

      const uid = uuidv4();

      // We create local ICS files
      const { error, value: iCalString } = createEvent({
        uid,
        startInputType: ""utc"",
        start: convertDate(event.startTime),
        duration: getDuration(event.startTime, event.endTime),
        title: event.title,
        description: getRichDescription(event),
        lo
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCre
---
[Medium] method createAllCalendarEvents in packages/core/EventManager.ts:
private async createAllCalendarEvents(event: CalendarEvent) {
    let createdEvents: EventResult<NewCalendarEventType>[] = [];
    if (event.destinationCalendar && event.destinationCalendar.length > 0) {
      for (const destination of event.destinationCalendar) {
        if (destination.credentialId) {
          let credential = this.calendarCredentials.find((c) => c.id === destination.credentialId);
          if (!credential) {
            // Fetch credential from DB
            const credenti
---
[Medium] class EventManager in packages/core/EventManager.ts:
class EventManager {
  calendarCredentials: CredentialWithAppName[];
  videoCredentials: CredentialWithAppName[];

  /**
   * Takes an array of credentials and initializes a new instance of the EventManager.
   *
   * @param user
   */
  constructor(user: EventManagerUser) {
    const appCredentials = getApps(user.credentials, true).flatMap((app) =>
      app.credentials.map((creds) => ({ ...creds, appName: app.name }))
    );
    // This includes all calendar-related apps, traditional calendars
---
[Medium] method updateAllCalendarEvents in packages/core/EventManager.ts:
private async updateAllCalendarEvents(
    event: CalendarEvent,
    booking: PartialBooking,
    newBookingId?: number
  ): Promise<Array<EventResult<NewCalendarEventType>>> {
    let calendarReference: PartialReference[] | undefined = undefined,
      credential;
    try {
      // If a newBookingId is given, update that calendar event
      let newBooking;
      if (newBookingId) {
        newBooking = await prisma.booking.findUnique({
          where: {
            id: newBookingId,
        
---
[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(
  req: NextApiRequest & { userId?: number | undefined },
  {
    isNotAnApiCall = false,
  }: {
    isNotAnApiCall?: boolean;
  } = {
    isNotAnApiCall: false,
  }
) {
  const { userId } = req;

  const userIp = getIP(req);

  await checkRateLimitAndThrowError({
    rateLimitingType: ""core"",
    identifier: userIp,
  });

  // handle dynamic user
  let eventType =
    !req.body.eventTypeId && !!req.body.eventTypeSlug
      ? getDefaultEvent(req.body.eventTypeSlug)
      
---
[Medium] variable createEvent in packages/core/CalendarManager.ts:
const createEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  externalId?: string
): Promise<EventResult<NewCalendarEventType>> => {
  const uid: string = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = true;
  let calError: string | undefined = undefined;

  // Check if the disabledNotes flag is set to true
  if (calEvent.hideCalendarNotes) {
    calEvent.additionalNotes = ""Notes have been hidden by the organizer""; // TODO: i18
---
[Medium] function handler in apps/web/pages/api/cron/bookingReminder.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }
  if (req.method !== ""POST"") {
    res.status(405).json({ message: ""Invalid method"" });
    return;
  }

  const reminderIntervalMinutes = [48 * 60, 24 * 60, 3 * 60];
  let notificationsSent = 0;
  for (const interval of reminderIntervalMinutes) {
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integration
---
[Medium] method updateLocation in packages/core/EventManager.ts:
public async updateLocation(event: CalendarEvent, booking: PartialBooking): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    const isDedicated = evt.location ? isDedicatedIntegration(evt.location) : null;

    const results: Array<EventResult<Exclude<Event, AdditionalInformation>>> = [];
    // If and only if event type is a dedicated meeting, create a dedicated video meeting.
    if (isDedicated) {
      const result = await this.createVideoEvent(evt);
      if (result.
---
[Medium] method create in packages/core/EventManager.ts:
public async create(event: CalendarEvent): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    // Fallback to cal video if no location is set
    if (!evt.location) {
      // See if cal video is enabled & has keys
      const calVideo = await prisma.app.findFirst({
        where: {
          slug: ""daily-video"",
        },
        select: {
          keys: true,
          enabled: true,
        },
      });

      const calVideoKeys = calVideoKeysSchema.safeParse(calVideo?
---
[Medium] class CalendarEventClass in packages/core/builders/CalendarEvent/class.ts:
class CalendarEventClass implements CalendarEvent {
  type!: string;
  title!: string;
  startTime!: string;
  endTime!: string;
  organizer!: Person;
  attendees!: Person[];
  description?: string | null;
  team?: { name: string; members: Person[] };
  location?: string | null;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: any;
  destinationCalendar?: DestinationCalendar[] | null;
  can
---
[Medium] field destinationCalendar in packages/core/builders/CalendarEvent/class.ts:
destinationCalendar?: DestinationCalendar[] | null
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: CustomRequest) {
  const { id, uid, allRemainingBookings, cancellationReason, seatReferenceUid } =
    schemaBookingCancelParams.parse(req.body);
  req.bookingToDelete = await getBookingToDelete(id, uid);
  const { bookingToDelete, userId } = req;

  if (!bookingToDelete || !bookingToDelete.user) {
    throw new HttpError({ statusCode: 400, message: ""Booking not found"" });
  }

  if (userId !== bookingToDelete.user?.id && bookingToDelete.startTime < new Date()) {
    
---
[Medium] function ensureAvailableUsers in packages/features/bookings/lib/handleNewBooking.ts:
async function ensureAvailableUsers(
  eventType: Awaited<ReturnType<typeof getEventTypesFromDB>> & {
    users: IsFixedAwareUser[];
  },
  input: { dateFrom: string; dateTo: string; timeZone: string; originalRescheduledBooking?: BookingType },
  recurringDatesInfo?: {
    allRecurringDates: string[] | undefined;
    currentRecurringIndex: number | undefined;
  }
) {
  const availableUsers: IsFixedAwareUser[] = [];

  const originalBookingDuration = input.originalRescheduledBooking
    ? dayjs(i
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/paypal-webhook.ts:
async function handlePaymentSuccess(
  payload: z.infer<typeof eventSchema>,
  rawPayload: string,
  webhookHeaders: WebHookHeadersType
) {
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: payload?.resource?.id,
    },
    select: {
      id: true,
      bookingId: true,
      success: true,
    },
  });

  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" });

  const booking = await prisma.booking.findUnique({
    where
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/webhook.ts:
async function handlePaymentSuccess(event: Stripe.Event) {
  const paymentIntent = event.data.object as Stripe.PaymentIntent;
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: paymentIntent.id,
    },
    select: {
      id: true,
      bookingId: true,
    },
  });
  if (!payment?.bookingId) {
    console.log(JSON.stringify(paymentIntent), JSON.stringify(payment));
  }
  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" }
---
[Medium] function getBooking in packages/features/ee/payments/api/webhook.ts:
async function getBooking(bookingId: number) {
  const booking = await prisma.booking.findUnique({
    where: {
      id: bookingId,
    },
    select: {
      ...bookingMinimalSelect,
      eventType: true,
      smsReminderNumber: true,
      location: true,
      eventTypeId: true,
      userId: true,
      uid: true,
      paid: true,
      destinationCalendar: true,
      status: true,
      user: {
        select: {
          id: true,
          username: true,
          timeZone: true,
  
---
[Medium] variable deleteCredentialHandler in packages/trpc/server/routers/loggedInViewer/deleteCredential.handler.ts:
const deleteCredentialHandler = async ({ ctx, input }: DeleteCredentialOptions) => {
  const { user } = ctx;
  const { id, teamId } = input;

  const credential = await prisma.credential.findFirst({
    where: {
      id: id,
      ...(teamId ? { teamId } : { userId: ctx.user.id }),
    },
    select: {
      key: true,
      appId: true,
      app: {
        select: {
          slug: true,
          categories: true,
          dirName: true,
        },
      },
      id: true,
      type: true,
---
[Medium] variable editLocationHandler in packages/trpc/server/routers/viewer/bookings/editLocation.handler.ts:
const editLocationHandler = async ({ ctx, input }: EditLocationOptions) => {
  const { bookingId, newLocation: location, details } = input;
  const { booking } = ctx;

  try {
    const organizer = await prisma.user.findFirstOrThrow({
      where: {
        id: booking.userId || 0,
      },
      select: {
        name: true,
        email: true,
        timeZone: true,
        locale: true,
      },
    });

    let conferenceCredential: CredentialPayload | null = null;

    if (details?.creden
---
[Medium] variable createHandler in packages/trpc/server/routers/viewer/organizations/create.handler.ts:
const createHandler = async ({ input, ctx }: CreateOptions) => {
  const { slug, name, adminEmail, adminUsername, check } = input;

  const userCollisions = await prisma.user.findUnique({
    where: {
      email: adminEmail,
    },
  });

  const slugCollisions = await prisma.team.findFirst({
    where: {
      slug: slug,
      metadata: {
        path: [""isOrganization""],
        equals: true,
      },
    },
  });

  if (slugCollisions || RESERVED_SUBDOMAINS.includes(slug))
    throw new TRP","EventResult (Critical), Calendar (Critical), CalendarEvent (Critical), requestRescheduleHandler (Critical), confirmHandler (High), BrokenIntegrationEmail (High), deleteEvent (High), createAttendees (Medium), listCalendars (Medium), createEvent (Medium), deleteEvent (Medium), updateEvent (Medium), updateEvent (Medium), createEvent (Medium), LarkCalendarService (Medium), createEvent (Medium), createEvent (Medium), GoogleCalendarService (Medium), createAllCalendarEvents (Medium), EventManager (Medium), updateAllCalendarEvents (Medium), handler (Medium), createEvent (Medium), handler (Medium), Office365CalendarService (Medium), updateLocation (Medium), create (Medium), CalendarEventClass (Medium), destinationCalendar (Medium), handler (Medium), ensureAvailableUsers (Medium), handlePaymentSuccess (Medium), handlePaymentSuccess (Medium), getBooking (Medium), deleteCredentialHandler (Medium), editLocationHandler (Medium), createHandler (Medium)",match,'destinationCalendar' matches HC entity 'calendar'
cal_dot_com,4,fix: handle collective multiple host on destinationCalendar,The optional chaining on mainHostDestinationCalendar?.integration is redundant since you already check mainHostDestinationCalendar in the ternary condition.,Low,37,7,30,"interface::EventResult (packages/types/EventManager.d.ts) [Critical, score=1.00] | interface::Calendar (packages/types/Calendar.d.ts) [Critical, score=0.77] | interface::CalendarEvent (packages/types/Calendar.d.ts) [Critical, score=0.77] | variable::requestRescheduleHandler (packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts) [Critical, score=0.75] | variable::confirmHandler (packages/trpc/server/routers/viewer/bookings/confirm.handler.ts) [High, score=0.69] | variable::BrokenIntegrationEmail (packages/emails/src/templates/BrokenIntegrationEmail.tsx) [High, score=0.59] | method::deleteEvent (packages/app-store/larkcalendar/lib/CalendarService.ts) [High, score=0.51]","[Critical] interface EventResult in packages/types/EventManager.d.ts:
interface EventResult<T> {
  type: string;
  appName: string;
  success: boolean;
  uid: string;
  iCalUID?: string | null;
  createdEvent?: T;
  updatedEvent?: T | T[];
  originalEvent: CalendarEvent;
  calError?: string;
  calWarnings?: string[];
  credentialId?: number;
  externalId?: string | null;
}
---
[Critical] interface Calendar in packages/types/Calendar.d.ts:
interface Calendar {
  createEvent(event: CalendarEvent, credentialId: number): Promise<NewCalendarEventType>;

  updateEvent(
    uid: string,
    event: CalendarEvent,
    externalCalendarId?: string | null
  ): Promise<NewCalendarEventType | NewCalendarEventType[]>;

  deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<unknown>;

  getAvailability(
    dateFrom: string,
    dateTo: string,
    selectedCalendars: IntegrationCalendar[]
  ): Promise<EventBusyDate[]>;

  listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]>;
}
---
[Critical] interface CalendarEvent in packages/types/Calendar.d.ts:
interface CalendarEvent {
  // Instead of sending this per event.
  // TODO: Links sent in email should be validated and automatically redirected to org domain or regular app. It would be a much cleaner way. Maybe use existing /api/link endpoint
  bookerUrl?: string;
  type: string;
  title: string;
  startTime: string;
  endTime: string;
  organizer: Person;
  attendees: Person[];
  additionalNotes?: string | null;
  customInputs?: Prisma.JsonObject | null;
  description?: string | null;
  team?: {
    name: string;
    members: TeamMember[];
  };
  location?: string | null;
  conferenceCredentialId?: number;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: PaymentInfo | null;
  requ
---
[Critical] variable requestRescheduleHandler in packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts:
const requestRescheduleHandler = async ({ ctx, input }: RequestRescheduleOptions) => {
  const { user } = ctx;
  const { bookingId, rescheduleReason: cancellationReason } = input;

  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      userId: true,
      title: true,
      description: true,
      startTime: true,
      endTime: true,
      eventTypeId: true,
      eventType: true,
      location: true,
      attendees: true,
      references: true,
      customInputs: true,
      dynamicEventSlugRef: true,
      dynamicGroupSlugRef: true,
      destinationCalendar: true,
      smsReminderNumber: true,
      scheduledJobs: true,
      workflowReminders: true,
      responses: true,
    },
    where: {
      uid: bookingId
---
[High] variable confirmHandler in packages/trpc/server/routers/viewer/bookings/confirm.handler.ts:
const confirmHandler = async ({ ctx, input }: ConfirmOptions) => {
  const { user } = ctx;
  const { bookingId, recurringEventId, reason: rejectionReason, confirmed } = input;

  const tOrganizer = await getTranslation(user.locale ?? ""en"", ""common"");

  const booking = await prisma.booking.findUniqueOrThrow({
    where: {
      id: bookingId,
    },
    select: {
      title: true,
      description: true,
      customInputs: true,
      startTime: true,
      endTime: true,
      attendees: true,
      eventTypeId: true,
      responses: true,
      eventType: {
        select: {
          id: true,
          owner: true,
          teamId: true,
          recurringEvent: true,
          title: true,
          requiresConfirmation: true,
          currency: true,
          length: true,
  
---
[High] variable BrokenIntegrationEmail in packages/emails/src/templates/BrokenIntegrationEmail.tsx:
const BrokenIntegrationEmail = (
  props: {
    calEvent: CalendarEvent;
    attendee: Person;
    type: ""video"" | ""calendar"";
  } & Partial<React.ComponentProps<typeof BaseScheduledEmail>>
) => {
  const { calEvent, type } = props;
  const t = calEvent.organizer.language.translate;
  const locale = calEvent.organizer.language.locale;
  const timeFormat = calEvent.organizer?.timeFormat;

  if (type === ""video"") {
    let location = calEvent.location ? getEnumKeyByEnumValue(AppStoreLocationType, calEvent.location) : "" "";
    if (location === ""Daily"") {
      location = ""Cal Video"";
    }
    if (location === ""GoogleMeet"") {
      location = location.slice(0, 5) + "" "" + location.slice(5);
    }

    return (
      <BaseScheduledEmail
        timeZone={calEvent.organizer.timeZone}
        t={
---
[High] method deleteEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in deleteEvent"");
      throw new Error(""no calendar id provided in deleteEvent"");
    }
    try {
      const response = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/${uid}`, {
        method: ""DELETE"",
      });
      await handleLarkError(response, this.log);
    } catch (error) {
      this.log.error(error);
      throw error;
    }
  }","[Medium] field createAttendees in packages/app-store/larkcalendar/lib/CalendarService.ts:
private createAttendees = async (event: CalendarEvent, eventId: string) => {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in createAttendees"");
      throw new Error(""no calendar id provided in createAttendees"");
    }
    const attendeeResponse = await this.fetcher(
      `/calendar/v4/calendars/${calendarId}/events/${eventId}/attende
---
[Medium] method listCalendars in packages/lib/CalendarService.ts:
async listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]> {
    try {
      const account = await this.getAccount();

      const calendars = (await fetchCalendars({
        account,
        headers: this.headers,
      })) /** @url https://github.com/natelindev/tsdav/pull/139 */ as (Omit<DAVCalendar, ""displayName""> & {
        displayName?: string | Record<string, unknown>;
      })[];

      return calendars.reduce<IntegrationCalendar[]>((newCalendars, calendar) => {
        i
---
[Medium] method createEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async createEvent(calEventRaw: CalendarEvent, credentialId: number): Promise<NewCalendarEventType> {
    const eventAttendees = calEventRaw.attendees.map(({ id: _id, ...rest }) => ({
      ...rest,
      responseStatus: ""accepted"",
    }));
    // TODO: Check every other CalendarService for team members
    const teamMembers =
      calEventRaw.team?.members.map((m) => ({
        email: m.email,
        displayName: m.name,
        responseStatus: ""accepted"",
      })) || [];
    return new Prom
---
[Medium] method deleteEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<void> {
    return new Promise(async (resolve, reject) => {
      const myGoogleAuth = await this.auth.getToken();
      const calendar = google.calendar({
        version: ""v3"",
        auth: myGoogleAuth,
      });

      const defaultCalendarId = ""primary"";
      const calendarId = externalCalendarId
        ? externalCalendarId
        : event.destinationCalendar?.find((cal) => cal.externalId ==
---
[Medium] method updateEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId: string): Promise<any> {
    return new Promise(async (resolve, reject) => {
      const [mainHostDestinationCalendar] =
        event?.destinationCalendar && event?.destinationCalendar.length > 0 ? event.destinationCalendar : [];
      const myGoogleAuth = await this.auth.getToken();
      const eventAttendees = event.attendees.map(({ ...rest }) => ({
        ...rest,
        responseStatus: ""accepted"",
      }));
      con
---
[Medium] method updateEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const eventId = uid;
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in updateEvent"");
      throw new Error(""no calendar id provided in updateEvent"");
    }
    try {
      const eventResponse = await this.
---
[Medium] method createEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    let eventId = """";
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      throw new Error(""no calendar id"");
    }
    try {
      const eventResponse = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/create_event`, {
        method: ""POST"",
        body: JSON.stringify(t
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private larkAuth = (credential: CredentialPayload) => {
    const l
---
[Medium] method createEvent in packages/app-store/office365calendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    try {
      const eventsUrl = mainHostDestinationCalendar?.externalId
        ? `/me/calendars/${mainHostDestinationCalendar?.externalId}/events`
        : ""/me/calendar/events"";

      const response = await this.fetcher(eventsUrl, {
        method: ""POST"",
        body: JSON.stringify(this.translateEvent(event)),
      });

      const response
---
[Medium] method createEvent in packages/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    try {
      const calendars = await this.listCalendars(event);

      const uid = uuidv4();

      // We create local ICS files
      const { error, value: iCalString } = createEvent({
        uid,
        startInputType: ""utc"",
        start: convertDate(event.startTime),
        duration: getDuration(event.startTime, event.endTime),
        title: event.title,
        description: getRichDescription(event),
        lo
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCre
---
[Medium] method createAllCalendarEvents in packages/core/EventManager.ts:
private async createAllCalendarEvents(event: CalendarEvent) {
    let createdEvents: EventResult<NewCalendarEventType>[] = [];
    if (event.destinationCalendar && event.destinationCalendar.length > 0) {
      for (const destination of event.destinationCalendar) {
        if (destination.credentialId) {
          let credential = this.calendarCredentials.find((c) => c.id === destination.credentialId);
          if (!credential) {
            // Fetch credential from DB
            const credenti
---
[Medium] class EventManager in packages/core/EventManager.ts:
class EventManager {
  calendarCredentials: CredentialWithAppName[];
  videoCredentials: CredentialWithAppName[];

  /**
   * Takes an array of credentials and initializes a new instance of the EventManager.
   *
   * @param user
   */
  constructor(user: EventManagerUser) {
    const appCredentials = getApps(user.credentials, true).flatMap((app) =>
      app.credentials.map((creds) => ({ ...creds, appName: app.name }))
    );
    // This includes all calendar-related apps, traditional calendars
---
[Medium] method updateAllCalendarEvents in packages/core/EventManager.ts:
private async updateAllCalendarEvents(
    event: CalendarEvent,
    booking: PartialBooking,
    newBookingId?: number
  ): Promise<Array<EventResult<NewCalendarEventType>>> {
    let calendarReference: PartialReference[] | undefined = undefined,
      credential;
    try {
      // If a newBookingId is given, update that calendar event
      let newBooking;
      if (newBookingId) {
        newBooking = await prisma.booking.findUnique({
          where: {
            id: newBookingId,
        
---
[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(
  req: NextApiRequest & { userId?: number | undefined },
  {
    isNotAnApiCall = false,
  }: {
    isNotAnApiCall?: boolean;
  } = {
    isNotAnApiCall: false,
  }
) {
  const { userId } = req;

  const userIp = getIP(req);

  await checkRateLimitAndThrowError({
    rateLimitingType: ""core"",
    identifier: userIp,
  });

  // handle dynamic user
  let eventType =
    !req.body.eventTypeId && !!req.body.eventTypeSlug
      ? getDefaultEvent(req.body.eventTypeSlug)
      
---
[Medium] variable createEvent in packages/core/CalendarManager.ts:
const createEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  externalId?: string
): Promise<EventResult<NewCalendarEventType>> => {
  const uid: string = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = true;
  let calError: string | undefined = undefined;

  // Check if the disabledNotes flag is set to true
  if (calEvent.hideCalendarNotes) {
    calEvent.additionalNotes = ""Notes have been hidden by the organizer""; // TODO: i18
---
[Medium] function handler in apps/web/pages/api/cron/bookingReminder.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }
  if (req.method !== ""POST"") {
    res.status(405).json({ message: ""Invalid method"" });
    return;
  }

  const reminderIntervalMinutes = [48 * 60, 24 * 60, 3 * 60];
  let notificationsSent = 0;
  for (const interval of reminderIntervalMinutes) {
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integration
---
[Medium] method updateLocation in packages/core/EventManager.ts:
public async updateLocation(event: CalendarEvent, booking: PartialBooking): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    const isDedicated = evt.location ? isDedicatedIntegration(evt.location) : null;

    const results: Array<EventResult<Exclude<Event, AdditionalInformation>>> = [];
    // If and only if event type is a dedicated meeting, create a dedicated video meeting.
    if (isDedicated) {
      const result = await this.createVideoEvent(evt);
      if (result.
---
[Medium] method create in packages/core/EventManager.ts:
public async create(event: CalendarEvent): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    // Fallback to cal video if no location is set
    if (!evt.location) {
      // See if cal video is enabled & has keys
      const calVideo = await prisma.app.findFirst({
        where: {
          slug: ""daily-video"",
        },
        select: {
          keys: true,
          enabled: true,
        },
      });

      const calVideoKeys = calVideoKeysSchema.safeParse(calVideo?
---
[Medium] class CalendarEventClass in packages/core/builders/CalendarEvent/class.ts:
class CalendarEventClass implements CalendarEvent {
  type!: string;
  title!: string;
  startTime!: string;
  endTime!: string;
  organizer!: Person;
  attendees!: Person[];
  description?: string | null;
  team?: { name: string; members: Person[] };
  location?: string | null;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: any;
  destinationCalendar?: DestinationCalendar[] | null;
  can
---
[Medium] field destinationCalendar in packages/core/builders/CalendarEvent/class.ts:
destinationCalendar?: DestinationCalendar[] | null
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: CustomRequest) {
  const { id, uid, allRemainingBookings, cancellationReason, seatReferenceUid } =
    schemaBookingCancelParams.parse(req.body);
  req.bookingToDelete = await getBookingToDelete(id, uid);
  const { bookingToDelete, userId } = req;

  if (!bookingToDelete || !bookingToDelete.user) {
    throw new HttpError({ statusCode: 400, message: ""Booking not found"" });
  }

  if (userId !== bookingToDelete.user?.id && bookingToDelete.startTime < new Date()) {
    
---
[Medium] function ensureAvailableUsers in packages/features/bookings/lib/handleNewBooking.ts:
async function ensureAvailableUsers(
  eventType: Awaited<ReturnType<typeof getEventTypesFromDB>> & {
    users: IsFixedAwareUser[];
  },
  input: { dateFrom: string; dateTo: string; timeZone: string; originalRescheduledBooking?: BookingType },
  recurringDatesInfo?: {
    allRecurringDates: string[] | undefined;
    currentRecurringIndex: number | undefined;
  }
) {
  const availableUsers: IsFixedAwareUser[] = [];

  const originalBookingDuration = input.originalRescheduledBooking
    ? dayjs(i
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/paypal-webhook.ts:
async function handlePaymentSuccess(
  payload: z.infer<typeof eventSchema>,
  rawPayload: string,
  webhookHeaders: WebHookHeadersType
) {
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: payload?.resource?.id,
    },
    select: {
      id: true,
      bookingId: true,
      success: true,
    },
  });

  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" });

  const booking = await prisma.booking.findUnique({
    where
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/webhook.ts:
async function handlePaymentSuccess(event: Stripe.Event) {
  const paymentIntent = event.data.object as Stripe.PaymentIntent;
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: paymentIntent.id,
    },
    select: {
      id: true,
      bookingId: true,
    },
  });
  if (!payment?.bookingId) {
    console.log(JSON.stringify(paymentIntent), JSON.stringify(payment));
  }
  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" }
---
[Medium] function getBooking in packages/features/ee/payments/api/webhook.ts:
async function getBooking(bookingId: number) {
  const booking = await prisma.booking.findUnique({
    where: {
      id: bookingId,
    },
    select: {
      ...bookingMinimalSelect,
      eventType: true,
      smsReminderNumber: true,
      location: true,
      eventTypeId: true,
      userId: true,
      uid: true,
      paid: true,
      destinationCalendar: true,
      status: true,
      user: {
        select: {
          id: true,
          username: true,
          timeZone: true,
  
---
[Medium] variable deleteCredentialHandler in packages/trpc/server/routers/loggedInViewer/deleteCredential.handler.ts:
const deleteCredentialHandler = async ({ ctx, input }: DeleteCredentialOptions) => {
  const { user } = ctx;
  const { id, teamId } = input;

  const credential = await prisma.credential.findFirst({
    where: {
      id: id,
      ...(teamId ? { teamId } : { userId: ctx.user.id }),
    },
    select: {
      key: true,
      appId: true,
      app: {
        select: {
          slug: true,
          categories: true,
          dirName: true,
        },
      },
      id: true,
      type: true,
---
[Medium] variable editLocationHandler in packages/trpc/server/routers/viewer/bookings/editLocation.handler.ts:
const editLocationHandler = async ({ ctx, input }: EditLocationOptions) => {
  const { bookingId, newLocation: location, details } = input;
  const { booking } = ctx;

  try {
    const organizer = await prisma.user.findFirstOrThrow({
      where: {
        id: booking.userId || 0,
      },
      select: {
        name: true,
        email: true,
        timeZone: true,
        locale: true,
      },
    });

    let conferenceCredential: CredentialPayload | null = null;

    if (details?.creden
---
[Medium] variable createHandler in packages/trpc/server/routers/viewer/organizations/create.handler.ts:
const createHandler = async ({ input, ctx }: CreateOptions) => {
  const { slug, name, adminEmail, adminUsername, check } = input;

  const userCollisions = await prisma.user.findUnique({
    where: {
      email: adminEmail,
    },
  });

  const slugCollisions = await prisma.team.findFirst({
    where: {
      slug: slug,
      metadata: {
        path: [""isOrganization""],
        equals: true,
      },
    },
  });

  if (slugCollisions || RESERVED_SUBDOMAINS.includes(slug))
    throw new TRP","EventResult (Critical), Calendar (Critical), CalendarEvent (Critical), requestRescheduleHandler (Critical), confirmHandler (High), BrokenIntegrationEmail (High), deleteEvent (High), createAttendees (Medium), listCalendars (Medium), createEvent (Medium), deleteEvent (Medium), updateEvent (Medium), updateEvent (Medium), createEvent (Medium), LarkCalendarService (Medium), createEvent (Medium), createEvent (Medium), GoogleCalendarService (Medium), createAllCalendarEvents (Medium), EventManager (Medium), updateAllCalendarEvents (Medium), handler (Medium), createEvent (Medium), handler (Medium), Office365CalendarService (Medium), updateLocation (Medium), create (Medium), CalendarEventClass (Medium), destinationCalendar (Medium), handler (Medium), ensureAvailableUsers (Medium), handlePaymentSuccess (Medium), handlePaymentSuccess (Medium), getBooking (Medium), deleteCredentialHandler (Medium), editLocationHandler (Medium), createHandler (Medium)",match,'integration' matches HC entity 'brokenintegrationemail'
cal_dot_com,4,fix: handle collective multiple host on destinationCalendar,"Logic error: when externalCalendarId is provided, you're searching for a calendar where externalId === externalCalendarId, but this will always fail since you're looking for a calendar that matches itself. Should likely find by credentialId or use different logic.",High,37,7,30,"interface::EventResult (packages/types/EventManager.d.ts) [Critical, score=1.00] | interface::Calendar (packages/types/Calendar.d.ts) [Critical, score=0.77] | interface::CalendarEvent (packages/types/Calendar.d.ts) [Critical, score=0.77] | variable::requestRescheduleHandler (packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts) [Critical, score=0.75] | variable::confirmHandler (packages/trpc/server/routers/viewer/bookings/confirm.handler.ts) [High, score=0.69] | variable::BrokenIntegrationEmail (packages/emails/src/templates/BrokenIntegrationEmail.tsx) [High, score=0.59] | method::deleteEvent (packages/app-store/larkcalendar/lib/CalendarService.ts) [High, score=0.51]","[Critical] interface EventResult in packages/types/EventManager.d.ts:
interface EventResult<T> {
  type: string;
  appName: string;
  success: boolean;
  uid: string;
  iCalUID?: string | null;
  createdEvent?: T;
  updatedEvent?: T | T[];
  originalEvent: CalendarEvent;
  calError?: string;
  calWarnings?: string[];
  credentialId?: number;
  externalId?: string | null;
}
---
[Critical] interface Calendar in packages/types/Calendar.d.ts:
interface Calendar {
  createEvent(event: CalendarEvent, credentialId: number): Promise<NewCalendarEventType>;

  updateEvent(
    uid: string,
    event: CalendarEvent,
    externalCalendarId?: string | null
  ): Promise<NewCalendarEventType | NewCalendarEventType[]>;

  deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<unknown>;

  getAvailability(
    dateFrom: string,
    dateTo: string,
    selectedCalendars: IntegrationCalendar[]
  ): Promise<EventBusyDate[]>;

  listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]>;
}
---
[Critical] interface CalendarEvent in packages/types/Calendar.d.ts:
interface CalendarEvent {
  // Instead of sending this per event.
  // TODO: Links sent in email should be validated and automatically redirected to org domain or regular app. It would be a much cleaner way. Maybe use existing /api/link endpoint
  bookerUrl?: string;
  type: string;
  title: string;
  startTime: string;
  endTime: string;
  organizer: Person;
  attendees: Person[];
  additionalNotes?: string | null;
  customInputs?: Prisma.JsonObject | null;
  description?: string | null;
  team?: {
    name: string;
    members: TeamMember[];
  };
  location?: string | null;
  conferenceCredentialId?: number;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: PaymentInfo | null;
  requ
---
[Critical] variable requestRescheduleHandler in packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts:
const requestRescheduleHandler = async ({ ctx, input }: RequestRescheduleOptions) => {
  const { user } = ctx;
  const { bookingId, rescheduleReason: cancellationReason } = input;

  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      userId: true,
      title: true,
      description: true,
      startTime: true,
      endTime: true,
      eventTypeId: true,
      eventType: true,
      location: true,
      attendees: true,
      references: true,
      customInputs: true,
      dynamicEventSlugRef: true,
      dynamicGroupSlugRef: true,
      destinationCalendar: true,
      smsReminderNumber: true,
      scheduledJobs: true,
      workflowReminders: true,
      responses: true,
    },
    where: {
      uid: bookingId
---
[High] variable confirmHandler in packages/trpc/server/routers/viewer/bookings/confirm.handler.ts:
const confirmHandler = async ({ ctx, input }: ConfirmOptions) => {
  const { user } = ctx;
  const { bookingId, recurringEventId, reason: rejectionReason, confirmed } = input;

  const tOrganizer = await getTranslation(user.locale ?? ""en"", ""common"");

  const booking = await prisma.booking.findUniqueOrThrow({
    where: {
      id: bookingId,
    },
    select: {
      title: true,
      description: true,
      customInputs: true,
      startTime: true,
      endTime: true,
      attendees: true,
      eventTypeId: true,
      responses: true,
      eventType: {
        select: {
          id: true,
          owner: true,
          teamId: true,
          recurringEvent: true,
          title: true,
          requiresConfirmation: true,
          currency: true,
          length: true,
  
---
[High] variable BrokenIntegrationEmail in packages/emails/src/templates/BrokenIntegrationEmail.tsx:
const BrokenIntegrationEmail = (
  props: {
    calEvent: CalendarEvent;
    attendee: Person;
    type: ""video"" | ""calendar"";
  } & Partial<React.ComponentProps<typeof BaseScheduledEmail>>
) => {
  const { calEvent, type } = props;
  const t = calEvent.organizer.language.translate;
  const locale = calEvent.organizer.language.locale;
  const timeFormat = calEvent.organizer?.timeFormat;

  if (type === ""video"") {
    let location = calEvent.location ? getEnumKeyByEnumValue(AppStoreLocationType, calEvent.location) : "" "";
    if (location === ""Daily"") {
      location = ""Cal Video"";
    }
    if (location === ""GoogleMeet"") {
      location = location.slice(0, 5) + "" "" + location.slice(5);
    }

    return (
      <BaseScheduledEmail
        timeZone={calEvent.organizer.timeZone}
        t={
---
[High] method deleteEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in deleteEvent"");
      throw new Error(""no calendar id provided in deleteEvent"");
    }
    try {
      const response = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/${uid}`, {
        method: ""DELETE"",
      });
      await handleLarkError(response, this.log);
    } catch (error) {
      this.log.error(error);
      throw error;
    }
  }","[Medium] field createAttendees in packages/app-store/larkcalendar/lib/CalendarService.ts:
private createAttendees = async (event: CalendarEvent, eventId: string) => {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in createAttendees"");
      throw new Error(""no calendar id provided in createAttendees"");
    }
    const attendeeResponse = await this.fetcher(
      `/calendar/v4/calendars/${calendarId}/events/${eventId}/attende
---
[Medium] method listCalendars in packages/lib/CalendarService.ts:
async listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]> {
    try {
      const account = await this.getAccount();

      const calendars = (await fetchCalendars({
        account,
        headers: this.headers,
      })) /** @url https://github.com/natelindev/tsdav/pull/139 */ as (Omit<DAVCalendar, ""displayName""> & {
        displayName?: string | Record<string, unknown>;
      })[];

      return calendars.reduce<IntegrationCalendar[]>((newCalendars, calendar) => {
        i
---
[Medium] method createEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async createEvent(calEventRaw: CalendarEvent, credentialId: number): Promise<NewCalendarEventType> {
    const eventAttendees = calEventRaw.attendees.map(({ id: _id, ...rest }) => ({
      ...rest,
      responseStatus: ""accepted"",
    }));
    // TODO: Check every other CalendarService for team members
    const teamMembers =
      calEventRaw.team?.members.map((m) => ({
        email: m.email,
        displayName: m.name,
        responseStatus: ""accepted"",
      })) || [];
    return new Prom
---
[Medium] method deleteEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<void> {
    return new Promise(async (resolve, reject) => {
      const myGoogleAuth = await this.auth.getToken();
      const calendar = google.calendar({
        version: ""v3"",
        auth: myGoogleAuth,
      });

      const defaultCalendarId = ""primary"";
      const calendarId = externalCalendarId
        ? externalCalendarId
        : event.destinationCalendar?.find((cal) => cal.externalId ==
---
[Medium] method updateEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId: string): Promise<any> {
    return new Promise(async (resolve, reject) => {
      const [mainHostDestinationCalendar] =
        event?.destinationCalendar && event?.destinationCalendar.length > 0 ? event.destinationCalendar : [];
      const myGoogleAuth = await this.auth.getToken();
      const eventAttendees = event.attendees.map(({ ...rest }) => ({
        ...rest,
        responseStatus: ""accepted"",
      }));
      con
---
[Medium] method updateEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const eventId = uid;
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in updateEvent"");
      throw new Error(""no calendar id provided in updateEvent"");
    }
    try {
      const eventResponse = await this.
---
[Medium] method createEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    let eventId = """";
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      throw new Error(""no calendar id"");
    }
    try {
      const eventResponse = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/create_event`, {
        method: ""POST"",
        body: JSON.stringify(t
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private larkAuth = (credential: CredentialPayload) => {
    const l
---
[Medium] method createEvent in packages/app-store/office365calendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    try {
      const eventsUrl = mainHostDestinationCalendar?.externalId
        ? `/me/calendars/${mainHostDestinationCalendar?.externalId}/events`
        : ""/me/calendar/events"";

      const response = await this.fetcher(eventsUrl, {
        method: ""POST"",
        body: JSON.stringify(this.translateEvent(event)),
      });

      const response
---
[Medium] method createEvent in packages/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    try {
      const calendars = await this.listCalendars(event);

      const uid = uuidv4();

      // We create local ICS files
      const { error, value: iCalString } = createEvent({
        uid,
        startInputType: ""utc"",
        start: convertDate(event.startTime),
        duration: getDuration(event.startTime, event.endTime),
        title: event.title,
        description: getRichDescription(event),
        lo
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCre
---
[Medium] method createAllCalendarEvents in packages/core/EventManager.ts:
private async createAllCalendarEvents(event: CalendarEvent) {
    let createdEvents: EventResult<NewCalendarEventType>[] = [];
    if (event.destinationCalendar && event.destinationCalendar.length > 0) {
      for (const destination of event.destinationCalendar) {
        if (destination.credentialId) {
          let credential = this.calendarCredentials.find((c) => c.id === destination.credentialId);
          if (!credential) {
            // Fetch credential from DB
            const credenti
---
[Medium] class EventManager in packages/core/EventManager.ts:
class EventManager {
  calendarCredentials: CredentialWithAppName[];
  videoCredentials: CredentialWithAppName[];

  /**
   * Takes an array of credentials and initializes a new instance of the EventManager.
   *
   * @param user
   */
  constructor(user: EventManagerUser) {
    const appCredentials = getApps(user.credentials, true).flatMap((app) =>
      app.credentials.map((creds) => ({ ...creds, appName: app.name }))
    );
    // This includes all calendar-related apps, traditional calendars
---
[Medium] method updateAllCalendarEvents in packages/core/EventManager.ts:
private async updateAllCalendarEvents(
    event: CalendarEvent,
    booking: PartialBooking,
    newBookingId?: number
  ): Promise<Array<EventResult<NewCalendarEventType>>> {
    let calendarReference: PartialReference[] | undefined = undefined,
      credential;
    try {
      // If a newBookingId is given, update that calendar event
      let newBooking;
      if (newBookingId) {
        newBooking = await prisma.booking.findUnique({
          where: {
            id: newBookingId,
        
---
[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(
  req: NextApiRequest & { userId?: number | undefined },
  {
    isNotAnApiCall = false,
  }: {
    isNotAnApiCall?: boolean;
  } = {
    isNotAnApiCall: false,
  }
) {
  const { userId } = req;

  const userIp = getIP(req);

  await checkRateLimitAndThrowError({
    rateLimitingType: ""core"",
    identifier: userIp,
  });

  // handle dynamic user
  let eventType =
    !req.body.eventTypeId && !!req.body.eventTypeSlug
      ? getDefaultEvent(req.body.eventTypeSlug)
      
---
[Medium] variable createEvent in packages/core/CalendarManager.ts:
const createEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  externalId?: string
): Promise<EventResult<NewCalendarEventType>> => {
  const uid: string = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = true;
  let calError: string | undefined = undefined;

  // Check if the disabledNotes flag is set to true
  if (calEvent.hideCalendarNotes) {
    calEvent.additionalNotes = ""Notes have been hidden by the organizer""; // TODO: i18
---
[Medium] function handler in apps/web/pages/api/cron/bookingReminder.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }
  if (req.method !== ""POST"") {
    res.status(405).json({ message: ""Invalid method"" });
    return;
  }

  const reminderIntervalMinutes = [48 * 60, 24 * 60, 3 * 60];
  let notificationsSent = 0;
  for (const interval of reminderIntervalMinutes) {
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integration
---
[Medium] method updateLocation in packages/core/EventManager.ts:
public async updateLocation(event: CalendarEvent, booking: PartialBooking): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    const isDedicated = evt.location ? isDedicatedIntegration(evt.location) : null;

    const results: Array<EventResult<Exclude<Event, AdditionalInformation>>> = [];
    // If and only if event type is a dedicated meeting, create a dedicated video meeting.
    if (isDedicated) {
      const result = await this.createVideoEvent(evt);
      if (result.
---
[Medium] method create in packages/core/EventManager.ts:
public async create(event: CalendarEvent): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    // Fallback to cal video if no location is set
    if (!evt.location) {
      // See if cal video is enabled & has keys
      const calVideo = await prisma.app.findFirst({
        where: {
          slug: ""daily-video"",
        },
        select: {
          keys: true,
          enabled: true,
        },
      });

      const calVideoKeys = calVideoKeysSchema.safeParse(calVideo?
---
[Medium] class CalendarEventClass in packages/core/builders/CalendarEvent/class.ts:
class CalendarEventClass implements CalendarEvent {
  type!: string;
  title!: string;
  startTime!: string;
  endTime!: string;
  organizer!: Person;
  attendees!: Person[];
  description?: string | null;
  team?: { name: string; members: Person[] };
  location?: string | null;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: any;
  destinationCalendar?: DestinationCalendar[] | null;
  can
---
[Medium] field destinationCalendar in packages/core/builders/CalendarEvent/class.ts:
destinationCalendar?: DestinationCalendar[] | null
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: CustomRequest) {
  const { id, uid, allRemainingBookings, cancellationReason, seatReferenceUid } =
    schemaBookingCancelParams.parse(req.body);
  req.bookingToDelete = await getBookingToDelete(id, uid);
  const { bookingToDelete, userId } = req;

  if (!bookingToDelete || !bookingToDelete.user) {
    throw new HttpError({ statusCode: 400, message: ""Booking not found"" });
  }

  if (userId !== bookingToDelete.user?.id && bookingToDelete.startTime < new Date()) {
    
---
[Medium] function ensureAvailableUsers in packages/features/bookings/lib/handleNewBooking.ts:
async function ensureAvailableUsers(
  eventType: Awaited<ReturnType<typeof getEventTypesFromDB>> & {
    users: IsFixedAwareUser[];
  },
  input: { dateFrom: string; dateTo: string; timeZone: string; originalRescheduledBooking?: BookingType },
  recurringDatesInfo?: {
    allRecurringDates: string[] | undefined;
    currentRecurringIndex: number | undefined;
  }
) {
  const availableUsers: IsFixedAwareUser[] = [];

  const originalBookingDuration = input.originalRescheduledBooking
    ? dayjs(i
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/paypal-webhook.ts:
async function handlePaymentSuccess(
  payload: z.infer<typeof eventSchema>,
  rawPayload: string,
  webhookHeaders: WebHookHeadersType
) {
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: payload?.resource?.id,
    },
    select: {
      id: true,
      bookingId: true,
      success: true,
    },
  });

  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" });

  const booking = await prisma.booking.findUnique({
    where
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/webhook.ts:
async function handlePaymentSuccess(event: Stripe.Event) {
  const paymentIntent = event.data.object as Stripe.PaymentIntent;
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: paymentIntent.id,
    },
    select: {
      id: true,
      bookingId: true,
    },
  });
  if (!payment?.bookingId) {
    console.log(JSON.stringify(paymentIntent), JSON.stringify(payment));
  }
  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" }
---
[Medium] function getBooking in packages/features/ee/payments/api/webhook.ts:
async function getBooking(bookingId: number) {
  const booking = await prisma.booking.findUnique({
    where: {
      id: bookingId,
    },
    select: {
      ...bookingMinimalSelect,
      eventType: true,
      smsReminderNumber: true,
      location: true,
      eventTypeId: true,
      userId: true,
      uid: true,
      paid: true,
      destinationCalendar: true,
      status: true,
      user: {
        select: {
          id: true,
          username: true,
          timeZone: true,
  
---
[Medium] variable deleteCredentialHandler in packages/trpc/server/routers/loggedInViewer/deleteCredential.handler.ts:
const deleteCredentialHandler = async ({ ctx, input }: DeleteCredentialOptions) => {
  const { user } = ctx;
  const { id, teamId } = input;

  const credential = await prisma.credential.findFirst({
    where: {
      id: id,
      ...(teamId ? { teamId } : { userId: ctx.user.id }),
    },
    select: {
      key: true,
      appId: true,
      app: {
        select: {
          slug: true,
          categories: true,
          dirName: true,
        },
      },
      id: true,
      type: true,
---
[Medium] variable editLocationHandler in packages/trpc/server/routers/viewer/bookings/editLocation.handler.ts:
const editLocationHandler = async ({ ctx, input }: EditLocationOptions) => {
  const { bookingId, newLocation: location, details } = input;
  const { booking } = ctx;

  try {
    const organizer = await prisma.user.findFirstOrThrow({
      where: {
        id: booking.userId || 0,
      },
      select: {
        name: true,
        email: true,
        timeZone: true,
        locale: true,
      },
    });

    let conferenceCredential: CredentialPayload | null = null;

    if (details?.creden
---
[Medium] variable createHandler in packages/trpc/server/routers/viewer/organizations/create.handler.ts:
const createHandler = async ({ input, ctx }: CreateOptions) => {
  const { slug, name, adminEmail, adminUsername, check } = input;

  const userCollisions = await prisma.user.findUnique({
    where: {
      email: adminEmail,
    },
  });

  const slugCollisions = await prisma.team.findFirst({
    where: {
      slug: slug,
      metadata: {
        path: [""isOrganization""],
        equals: true,
      },
    },
  });

  if (slugCollisions || RESERVED_SUBDOMAINS.includes(slug))
    throw new TRP","EventResult (Critical), Calendar (Critical), CalendarEvent (Critical), requestRescheduleHandler (Critical), confirmHandler (High), BrokenIntegrationEmail (High), deleteEvent (High), createAttendees (Medium), listCalendars (Medium), createEvent (Medium), deleteEvent (Medium), updateEvent (Medium), updateEvent (Medium), createEvent (Medium), LarkCalendarService (Medium), createEvent (Medium), createEvent (Medium), GoogleCalendarService (Medium), createAllCalendarEvents (Medium), EventManager (Medium), updateAllCalendarEvents (Medium), handler (Medium), createEvent (Medium), handler (Medium), Office365CalendarService (Medium), updateLocation (Medium), create (Medium), CalendarEventClass (Medium), destinationCalendar (Medium), handler (Medium), ensureAvailableUsers (Medium), handlePaymentSuccess (Medium), handlePaymentSuccess (Medium), getBooking (Medium), deleteCredentialHandler (Medium), editLocationHandler (Medium), createHandler (Medium)",match,'externalCalendarId' matches HC entity 'calendar'
cal_dot_com,4,fix: handle collective multiple host on destinationCalendar,"Logic inversion in organization creation: The slug property is now conditionally set when IS_TEAM_BILLING_ENABLED is true, instead of when it's false as originally intended. This change, combined with requestedSlug still being set when IS_TEAM_BILLING_ENABLED is true, results in both properties being set when billing is enabled, and neither when disabled",Medium,37,7,30,"interface::EventResult (packages/types/EventManager.d.ts) [Critical, score=1.00] | interface::Calendar (packages/types/Calendar.d.ts) [Critical, score=0.77] | interface::CalendarEvent (packages/types/Calendar.d.ts) [Critical, score=0.77] | variable::requestRescheduleHandler (packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts) [Critical, score=0.75] | variable::confirmHandler (packages/trpc/server/routers/viewer/bookings/confirm.handler.ts) [High, score=0.69] | variable::BrokenIntegrationEmail (packages/emails/src/templates/BrokenIntegrationEmail.tsx) [High, score=0.59] | method::deleteEvent (packages/app-store/larkcalendar/lib/CalendarService.ts) [High, score=0.51]","[Critical] interface EventResult in packages/types/EventManager.d.ts:
interface EventResult<T> {
  type: string;
  appName: string;
  success: boolean;
  uid: string;
  iCalUID?: string | null;
  createdEvent?: T;
  updatedEvent?: T | T[];
  originalEvent: CalendarEvent;
  calError?: string;
  calWarnings?: string[];
  credentialId?: number;
  externalId?: string | null;
}
---
[Critical] interface Calendar in packages/types/Calendar.d.ts:
interface Calendar {
  createEvent(event: CalendarEvent, credentialId: number): Promise<NewCalendarEventType>;

  updateEvent(
    uid: string,
    event: CalendarEvent,
    externalCalendarId?: string | null
  ): Promise<NewCalendarEventType | NewCalendarEventType[]>;

  deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<unknown>;

  getAvailability(
    dateFrom: string,
    dateTo: string,
    selectedCalendars: IntegrationCalendar[]
  ): Promise<EventBusyDate[]>;

  listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]>;
}
---
[Critical] interface CalendarEvent in packages/types/Calendar.d.ts:
interface CalendarEvent {
  // Instead of sending this per event.
  // TODO: Links sent in email should be validated and automatically redirected to org domain or regular app. It would be a much cleaner way. Maybe use existing /api/link endpoint
  bookerUrl?: string;
  type: string;
  title: string;
  startTime: string;
  endTime: string;
  organizer: Person;
  attendees: Person[];
  additionalNotes?: string | null;
  customInputs?: Prisma.JsonObject | null;
  description?: string | null;
  team?: {
    name: string;
    members: TeamMember[];
  };
  location?: string | null;
  conferenceCredentialId?: number;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: PaymentInfo | null;
  requ
---
[Critical] variable requestRescheduleHandler in packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts:
const requestRescheduleHandler = async ({ ctx, input }: RequestRescheduleOptions) => {
  const { user } = ctx;
  const { bookingId, rescheduleReason: cancellationReason } = input;

  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      userId: true,
      title: true,
      description: true,
      startTime: true,
      endTime: true,
      eventTypeId: true,
      eventType: true,
      location: true,
      attendees: true,
      references: true,
      customInputs: true,
      dynamicEventSlugRef: true,
      dynamicGroupSlugRef: true,
      destinationCalendar: true,
      smsReminderNumber: true,
      scheduledJobs: true,
      workflowReminders: true,
      responses: true,
    },
    where: {
      uid: bookingId
---
[High] variable confirmHandler in packages/trpc/server/routers/viewer/bookings/confirm.handler.ts:
const confirmHandler = async ({ ctx, input }: ConfirmOptions) => {
  const { user } = ctx;
  const { bookingId, recurringEventId, reason: rejectionReason, confirmed } = input;

  const tOrganizer = await getTranslation(user.locale ?? ""en"", ""common"");

  const booking = await prisma.booking.findUniqueOrThrow({
    where: {
      id: bookingId,
    },
    select: {
      title: true,
      description: true,
      customInputs: true,
      startTime: true,
      endTime: true,
      attendees: true,
      eventTypeId: true,
      responses: true,
      eventType: {
        select: {
          id: true,
          owner: true,
          teamId: true,
          recurringEvent: true,
          title: true,
          requiresConfirmation: true,
          currency: true,
          length: true,
  
---
[High] variable BrokenIntegrationEmail in packages/emails/src/templates/BrokenIntegrationEmail.tsx:
const BrokenIntegrationEmail = (
  props: {
    calEvent: CalendarEvent;
    attendee: Person;
    type: ""video"" | ""calendar"";
  } & Partial<React.ComponentProps<typeof BaseScheduledEmail>>
) => {
  const { calEvent, type } = props;
  const t = calEvent.organizer.language.translate;
  const locale = calEvent.organizer.language.locale;
  const timeFormat = calEvent.organizer?.timeFormat;

  if (type === ""video"") {
    let location = calEvent.location ? getEnumKeyByEnumValue(AppStoreLocationType, calEvent.location) : "" "";
    if (location === ""Daily"") {
      location = ""Cal Video"";
    }
    if (location === ""GoogleMeet"") {
      location = location.slice(0, 5) + "" "" + location.slice(5);
    }

    return (
      <BaseScheduledEmail
        timeZone={calEvent.organizer.timeZone}
        t={
---
[High] method deleteEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in deleteEvent"");
      throw new Error(""no calendar id provided in deleteEvent"");
    }
    try {
      const response = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/${uid}`, {
        method: ""DELETE"",
      });
      await handleLarkError(response, this.log);
    } catch (error) {
      this.log.error(error);
      throw error;
    }
  }","[Medium] field createAttendees in packages/app-store/larkcalendar/lib/CalendarService.ts:
private createAttendees = async (event: CalendarEvent, eventId: string) => {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in createAttendees"");
      throw new Error(""no calendar id provided in createAttendees"");
    }
    const attendeeResponse = await this.fetcher(
      `/calendar/v4/calendars/${calendarId}/events/${eventId}/attende
---
[Medium] method listCalendars in packages/lib/CalendarService.ts:
async listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]> {
    try {
      const account = await this.getAccount();

      const calendars = (await fetchCalendars({
        account,
        headers: this.headers,
      })) /** @url https://github.com/natelindev/tsdav/pull/139 */ as (Omit<DAVCalendar, ""displayName""> & {
        displayName?: string | Record<string, unknown>;
      })[];

      return calendars.reduce<IntegrationCalendar[]>((newCalendars, calendar) => {
        i
---
[Medium] method createEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async createEvent(calEventRaw: CalendarEvent, credentialId: number): Promise<NewCalendarEventType> {
    const eventAttendees = calEventRaw.attendees.map(({ id: _id, ...rest }) => ({
      ...rest,
      responseStatus: ""accepted"",
    }));
    // TODO: Check every other CalendarService for team members
    const teamMembers =
      calEventRaw.team?.members.map((m) => ({
        email: m.email,
        displayName: m.name,
        responseStatus: ""accepted"",
      })) || [];
    return new Prom
---
[Medium] method deleteEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<void> {
    return new Promise(async (resolve, reject) => {
      const myGoogleAuth = await this.auth.getToken();
      const calendar = google.calendar({
        version: ""v3"",
        auth: myGoogleAuth,
      });

      const defaultCalendarId = ""primary"";
      const calendarId = externalCalendarId
        ? externalCalendarId
        : event.destinationCalendar?.find((cal) => cal.externalId ==
---
[Medium] method updateEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId: string): Promise<any> {
    return new Promise(async (resolve, reject) => {
      const [mainHostDestinationCalendar] =
        event?.destinationCalendar && event?.destinationCalendar.length > 0 ? event.destinationCalendar : [];
      const myGoogleAuth = await this.auth.getToken();
      const eventAttendees = event.attendees.map(({ ...rest }) => ({
        ...rest,
        responseStatus: ""accepted"",
      }));
      con
---
[Medium] method updateEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const eventId = uid;
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in updateEvent"");
      throw new Error(""no calendar id provided in updateEvent"");
    }
    try {
      const eventResponse = await this.
---
[Medium] method createEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    let eventId = """";
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      throw new Error(""no calendar id"");
    }
    try {
      const eventResponse = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/create_event`, {
        method: ""POST"",
        body: JSON.stringify(t
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private larkAuth = (credential: CredentialPayload) => {
    const l
---
[Medium] method createEvent in packages/app-store/office365calendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    try {
      const eventsUrl = mainHostDestinationCalendar?.externalId
        ? `/me/calendars/${mainHostDestinationCalendar?.externalId}/events`
        : ""/me/calendar/events"";

      const response = await this.fetcher(eventsUrl, {
        method: ""POST"",
        body: JSON.stringify(this.translateEvent(event)),
      });

      const response
---
[Medium] method createEvent in packages/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    try {
      const calendars = await this.listCalendars(event);

      const uid = uuidv4();

      // We create local ICS files
      const { error, value: iCalString } = createEvent({
        uid,
        startInputType: ""utc"",
        start: convertDate(event.startTime),
        duration: getDuration(event.startTime, event.endTime),
        title: event.title,
        description: getRichDescription(event),
        lo
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCre
---
[Medium] method createAllCalendarEvents in packages/core/EventManager.ts:
private async createAllCalendarEvents(event: CalendarEvent) {
    let createdEvents: EventResult<NewCalendarEventType>[] = [];
    if (event.destinationCalendar && event.destinationCalendar.length > 0) {
      for (const destination of event.destinationCalendar) {
        if (destination.credentialId) {
          let credential = this.calendarCredentials.find((c) => c.id === destination.credentialId);
          if (!credential) {
            // Fetch credential from DB
            const credenti
---
[Medium] class EventManager in packages/core/EventManager.ts:
class EventManager {
  calendarCredentials: CredentialWithAppName[];
  videoCredentials: CredentialWithAppName[];

  /**
   * Takes an array of credentials and initializes a new instance of the EventManager.
   *
   * @param user
   */
  constructor(user: EventManagerUser) {
    const appCredentials = getApps(user.credentials, true).flatMap((app) =>
      app.credentials.map((creds) => ({ ...creds, appName: app.name }))
    );
    // This includes all calendar-related apps, traditional calendars
---
[Medium] method updateAllCalendarEvents in packages/core/EventManager.ts:
private async updateAllCalendarEvents(
    event: CalendarEvent,
    booking: PartialBooking,
    newBookingId?: number
  ): Promise<Array<EventResult<NewCalendarEventType>>> {
    let calendarReference: PartialReference[] | undefined = undefined,
      credential;
    try {
      // If a newBookingId is given, update that calendar event
      let newBooking;
      if (newBookingId) {
        newBooking = await prisma.booking.findUnique({
          where: {
            id: newBookingId,
        
---
[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(
  req: NextApiRequest & { userId?: number | undefined },
  {
    isNotAnApiCall = false,
  }: {
    isNotAnApiCall?: boolean;
  } = {
    isNotAnApiCall: false,
  }
) {
  const { userId } = req;

  const userIp = getIP(req);

  await checkRateLimitAndThrowError({
    rateLimitingType: ""core"",
    identifier: userIp,
  });

  // handle dynamic user
  let eventType =
    !req.body.eventTypeId && !!req.body.eventTypeSlug
      ? getDefaultEvent(req.body.eventTypeSlug)
      
---
[Medium] variable createEvent in packages/core/CalendarManager.ts:
const createEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  externalId?: string
): Promise<EventResult<NewCalendarEventType>> => {
  const uid: string = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = true;
  let calError: string | undefined = undefined;

  // Check if the disabledNotes flag is set to true
  if (calEvent.hideCalendarNotes) {
    calEvent.additionalNotes = ""Notes have been hidden by the organizer""; // TODO: i18
---
[Medium] function handler in apps/web/pages/api/cron/bookingReminder.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }
  if (req.method !== ""POST"") {
    res.status(405).json({ message: ""Invalid method"" });
    return;
  }

  const reminderIntervalMinutes = [48 * 60, 24 * 60, 3 * 60];
  let notificationsSent = 0;
  for (const interval of reminderIntervalMinutes) {
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integration
---
[Medium] method updateLocation in packages/core/EventManager.ts:
public async updateLocation(event: CalendarEvent, booking: PartialBooking): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    const isDedicated = evt.location ? isDedicatedIntegration(evt.location) : null;

    const results: Array<EventResult<Exclude<Event, AdditionalInformation>>> = [];
    // If and only if event type is a dedicated meeting, create a dedicated video meeting.
    if (isDedicated) {
      const result = await this.createVideoEvent(evt);
      if (result.
---
[Medium] method create in packages/core/EventManager.ts:
public async create(event: CalendarEvent): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    // Fallback to cal video if no location is set
    if (!evt.location) {
      // See if cal video is enabled & has keys
      const calVideo = await prisma.app.findFirst({
        where: {
          slug: ""daily-video"",
        },
        select: {
          keys: true,
          enabled: true,
        },
      });

      const calVideoKeys = calVideoKeysSchema.safeParse(calVideo?
---
[Medium] class CalendarEventClass in packages/core/builders/CalendarEvent/class.ts:
class CalendarEventClass implements CalendarEvent {
  type!: string;
  title!: string;
  startTime!: string;
  endTime!: string;
  organizer!: Person;
  attendees!: Person[];
  description?: string | null;
  team?: { name: string; members: Person[] };
  location?: string | null;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: any;
  destinationCalendar?: DestinationCalendar[] | null;
  can
---
[Medium] field destinationCalendar in packages/core/builders/CalendarEvent/class.ts:
destinationCalendar?: DestinationCalendar[] | null
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: CustomRequest) {
  const { id, uid, allRemainingBookings, cancellationReason, seatReferenceUid } =
    schemaBookingCancelParams.parse(req.body);
  req.bookingToDelete = await getBookingToDelete(id, uid);
  const { bookingToDelete, userId } = req;

  if (!bookingToDelete || !bookingToDelete.user) {
    throw new HttpError({ statusCode: 400, message: ""Booking not found"" });
  }

  if (userId !== bookingToDelete.user?.id && bookingToDelete.startTime < new Date()) {
    
---
[Medium] function ensureAvailableUsers in packages/features/bookings/lib/handleNewBooking.ts:
async function ensureAvailableUsers(
  eventType: Awaited<ReturnType<typeof getEventTypesFromDB>> & {
    users: IsFixedAwareUser[];
  },
  input: { dateFrom: string; dateTo: string; timeZone: string; originalRescheduledBooking?: BookingType },
  recurringDatesInfo?: {
    allRecurringDates: string[] | undefined;
    currentRecurringIndex: number | undefined;
  }
) {
  const availableUsers: IsFixedAwareUser[] = [];

  const originalBookingDuration = input.originalRescheduledBooking
    ? dayjs(i
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/paypal-webhook.ts:
async function handlePaymentSuccess(
  payload: z.infer<typeof eventSchema>,
  rawPayload: string,
  webhookHeaders: WebHookHeadersType
) {
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: payload?.resource?.id,
    },
    select: {
      id: true,
      bookingId: true,
      success: true,
    },
  });

  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" });

  const booking = await prisma.booking.findUnique({
    where
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/webhook.ts:
async function handlePaymentSuccess(event: Stripe.Event) {
  const paymentIntent = event.data.object as Stripe.PaymentIntent;
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: paymentIntent.id,
    },
    select: {
      id: true,
      bookingId: true,
    },
  });
  if (!payment?.bookingId) {
    console.log(JSON.stringify(paymentIntent), JSON.stringify(payment));
  }
  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" }
---
[Medium] function getBooking in packages/features/ee/payments/api/webhook.ts:
async function getBooking(bookingId: number) {
  const booking = await prisma.booking.findUnique({
    where: {
      id: bookingId,
    },
    select: {
      ...bookingMinimalSelect,
      eventType: true,
      smsReminderNumber: true,
      location: true,
      eventTypeId: true,
      userId: true,
      uid: true,
      paid: true,
      destinationCalendar: true,
      status: true,
      user: {
        select: {
          id: true,
          username: true,
          timeZone: true,
  
---
[Medium] variable deleteCredentialHandler in packages/trpc/server/routers/loggedInViewer/deleteCredential.handler.ts:
const deleteCredentialHandler = async ({ ctx, input }: DeleteCredentialOptions) => {
  const { user } = ctx;
  const { id, teamId } = input;

  const credential = await prisma.credential.findFirst({
    where: {
      id: id,
      ...(teamId ? { teamId } : { userId: ctx.user.id }),
    },
    select: {
      key: true,
      appId: true,
      app: {
        select: {
          slug: true,
          categories: true,
          dirName: true,
        },
      },
      id: true,
      type: true,
---
[Medium] variable editLocationHandler in packages/trpc/server/routers/viewer/bookings/editLocation.handler.ts:
const editLocationHandler = async ({ ctx, input }: EditLocationOptions) => {
  const { bookingId, newLocation: location, details } = input;
  const { booking } = ctx;

  try {
    const organizer = await prisma.user.findFirstOrThrow({
      where: {
        id: booking.userId || 0,
      },
      select: {
        name: true,
        email: true,
        timeZone: true,
        locale: true,
      },
    });

    let conferenceCredential: CredentialPayload | null = null;

    if (details?.creden
---
[Medium] variable createHandler in packages/trpc/server/routers/viewer/organizations/create.handler.ts:
const createHandler = async ({ input, ctx }: CreateOptions) => {
  const { slug, name, adminEmail, adminUsername, check } = input;

  const userCollisions = await prisma.user.findUnique({
    where: {
      email: adminEmail,
    },
  });

  const slugCollisions = await prisma.team.findFirst({
    where: {
      slug: slug,
      metadata: {
        path: [""isOrganization""],
        equals: true,
      },
    },
  });

  if (slugCollisions || RESERVED_SUBDOMAINS.includes(slug))
    throw new TRP","EventResult (Critical), Calendar (Critical), CalendarEvent (Critical), requestRescheduleHandler (Critical), confirmHandler (High), BrokenIntegrationEmail (High), deleteEvent (High), createAttendees (Medium), listCalendars (Medium), createEvent (Medium), deleteEvent (Medium), updateEvent (Medium), updateEvent (Medium), createEvent (Medium), LarkCalendarService (Medium), createEvent (Medium), createEvent (Medium), GoogleCalendarService (Medium), createAllCalendarEvents (Medium), EventManager (Medium), updateAllCalendarEvents (Medium), handler (Medium), createEvent (Medium), handler (Medium), Office365CalendarService (Medium), updateLocation (Medium), create (Medium), CalendarEventClass (Medium), destinationCalendar (Medium), handler (Medium), ensureAvailableUsers (Medium), handlePaymentSuccess (Medium), handlePaymentSuccess (Medium), getBooking (Medium), deleteCredentialHandler (Medium), editLocationHandler (Medium), createHandler (Medium)",partial,"HC entities exist (7) but no name match; golden idents: {'results', 'slug', 'now', 'properties', 'billing', 'property', 'disabled', 'enabled', 'requestedSlug', 'organization', 'combined', 'conditionally', 'intended', 'inversion', 'originally', 'change', 'neither', 'creation'}"
cal_dot_com,4,fix: handle collective multiple host on destinationCalendar,"The Calendar interface now requires createEvent(event, credentialId), but some implementations (e.g., Lark/Office365) still declare createEvent(event) onlyâ€”this breaks the interface contract (also applies to other locations in the PR).",Low,37,7,30,"interface::EventResult (packages/types/EventManager.d.ts) [Critical, score=1.00] | interface::Calendar (packages/types/Calendar.d.ts) [Critical, score=0.77] | interface::CalendarEvent (packages/types/Calendar.d.ts) [Critical, score=0.77] | variable::requestRescheduleHandler (packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts) [Critical, score=0.75] | variable::confirmHandler (packages/trpc/server/routers/viewer/bookings/confirm.handler.ts) [High, score=0.69] | variable::BrokenIntegrationEmail (packages/emails/src/templates/BrokenIntegrationEmail.tsx) [High, score=0.59] | method::deleteEvent (packages/app-store/larkcalendar/lib/CalendarService.ts) [High, score=0.51]","[Critical] interface EventResult in packages/types/EventManager.d.ts:
interface EventResult<T> {
  type: string;
  appName: string;
  success: boolean;
  uid: string;
  iCalUID?: string | null;
  createdEvent?: T;
  updatedEvent?: T | T[];
  originalEvent: CalendarEvent;
  calError?: string;
  calWarnings?: string[];
  credentialId?: number;
  externalId?: string | null;
}
---
[Critical] interface Calendar in packages/types/Calendar.d.ts:
interface Calendar {
  createEvent(event: CalendarEvent, credentialId: number): Promise<NewCalendarEventType>;

  updateEvent(
    uid: string,
    event: CalendarEvent,
    externalCalendarId?: string | null
  ): Promise<NewCalendarEventType | NewCalendarEventType[]>;

  deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<unknown>;

  getAvailability(
    dateFrom: string,
    dateTo: string,
    selectedCalendars: IntegrationCalendar[]
  ): Promise<EventBusyDate[]>;

  listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]>;
}
---
[Critical] interface CalendarEvent in packages/types/Calendar.d.ts:
interface CalendarEvent {
  // Instead of sending this per event.
  // TODO: Links sent in email should be validated and automatically redirected to org domain or regular app. It would be a much cleaner way. Maybe use existing /api/link endpoint
  bookerUrl?: string;
  type: string;
  title: string;
  startTime: string;
  endTime: string;
  organizer: Person;
  attendees: Person[];
  additionalNotes?: string | null;
  customInputs?: Prisma.JsonObject | null;
  description?: string | null;
  team?: {
    name: string;
    members: TeamMember[];
  };
  location?: string | null;
  conferenceCredentialId?: number;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: PaymentInfo | null;
  requ
---
[Critical] variable requestRescheduleHandler in packages/trpc/server/routers/viewer/bookings/requestReschedule.handler.ts:
const requestRescheduleHandler = async ({ ctx, input }: RequestRescheduleOptions) => {
  const { user } = ctx;
  const { bookingId, rescheduleReason: cancellationReason } = input;

  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      userId: true,
      title: true,
      description: true,
      startTime: true,
      endTime: true,
      eventTypeId: true,
      eventType: true,
      location: true,
      attendees: true,
      references: true,
      customInputs: true,
      dynamicEventSlugRef: true,
      dynamicGroupSlugRef: true,
      destinationCalendar: true,
      smsReminderNumber: true,
      scheduledJobs: true,
      workflowReminders: true,
      responses: true,
    },
    where: {
      uid: bookingId
---
[High] variable confirmHandler in packages/trpc/server/routers/viewer/bookings/confirm.handler.ts:
const confirmHandler = async ({ ctx, input }: ConfirmOptions) => {
  const { user } = ctx;
  const { bookingId, recurringEventId, reason: rejectionReason, confirmed } = input;

  const tOrganizer = await getTranslation(user.locale ?? ""en"", ""common"");

  const booking = await prisma.booking.findUniqueOrThrow({
    where: {
      id: bookingId,
    },
    select: {
      title: true,
      description: true,
      customInputs: true,
      startTime: true,
      endTime: true,
      attendees: true,
      eventTypeId: true,
      responses: true,
      eventType: {
        select: {
          id: true,
          owner: true,
          teamId: true,
          recurringEvent: true,
          title: true,
          requiresConfirmation: true,
          currency: true,
          length: true,
  
---
[High] variable BrokenIntegrationEmail in packages/emails/src/templates/BrokenIntegrationEmail.tsx:
const BrokenIntegrationEmail = (
  props: {
    calEvent: CalendarEvent;
    attendee: Person;
    type: ""video"" | ""calendar"";
  } & Partial<React.ComponentProps<typeof BaseScheduledEmail>>
) => {
  const { calEvent, type } = props;
  const t = calEvent.organizer.language.translate;
  const locale = calEvent.organizer.language.locale;
  const timeFormat = calEvent.organizer?.timeFormat;

  if (type === ""video"") {
    let location = calEvent.location ? getEnumKeyByEnumValue(AppStoreLocationType, calEvent.location) : "" "";
    if (location === ""Daily"") {
      location = ""Cal Video"";
    }
    if (location === ""GoogleMeet"") {
      location = location.slice(0, 5) + "" "" + location.slice(5);
    }

    return (
      <BaseScheduledEmail
        timeZone={calEvent.organizer.timeZone}
        t={
---
[High] method deleteEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in deleteEvent"");
      throw new Error(""no calendar id provided in deleteEvent"");
    }
    try {
      const response = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/${uid}`, {
        method: ""DELETE"",
      });
      await handleLarkError(response, this.log);
    } catch (error) {
      this.log.error(error);
      throw error;
    }
  }","[Medium] field createAttendees in packages/app-store/larkcalendar/lib/CalendarService.ts:
private createAttendees = async (event: CalendarEvent, eventId: string) => {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in createAttendees"");
      throw new Error(""no calendar id provided in createAttendees"");
    }
    const attendeeResponse = await this.fetcher(
      `/calendar/v4/calendars/${calendarId}/events/${eventId}/attende
---
[Medium] method listCalendars in packages/lib/CalendarService.ts:
async listCalendars(event?: CalendarEvent): Promise<IntegrationCalendar[]> {
    try {
      const account = await this.getAccount();

      const calendars = (await fetchCalendars({
        account,
        headers: this.headers,
      })) /** @url https://github.com/natelindev/tsdav/pull/139 */ as (Omit<DAVCalendar, ""displayName""> & {
        displayName?: string | Record<string, unknown>;
      })[];

      return calendars.reduce<IntegrationCalendar[]>((newCalendars, calendar) => {
        i
---
[Medium] method createEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async createEvent(calEventRaw: CalendarEvent, credentialId: number): Promise<NewCalendarEventType> {
    const eventAttendees = calEventRaw.attendees.map(({ id: _id, ...rest }) => ({
      ...rest,
      responseStatus: ""accepted"",
    }));
    // TODO: Check every other CalendarService for team members
    const teamMembers =
      calEventRaw.team?.members.map((m) => ({
        email: m.email,
        displayName: m.name,
        responseStatus: ""accepted"",
      })) || [];
    return new Prom
---
[Medium] method deleteEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async deleteEvent(uid: string, event: CalendarEvent, externalCalendarId?: string | null): Promise<void> {
    return new Promise(async (resolve, reject) => {
      const myGoogleAuth = await this.auth.getToken();
      const calendar = google.calendar({
        version: ""v3"",
        auth: myGoogleAuth,
      });

      const defaultCalendarId = ""primary"";
      const calendarId = externalCalendarId
        ? externalCalendarId
        : event.destinationCalendar?.find((cal) => cal.externalId ==
---
[Medium] method updateEvent in packages/app-store/googlecalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId: string): Promise<any> {
    return new Promise(async (resolve, reject) => {
      const [mainHostDestinationCalendar] =
        event?.destinationCalendar && event?.destinationCalendar.length > 0 ? event.destinationCalendar : [];
      const myGoogleAuth = await this.auth.getToken();
      const eventAttendees = event.attendees.map(({ ...rest }) => ({
        ...rest,
        responseStatus: ""accepted"",
      }));
      con
---
[Medium] method updateEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async updateEvent(uid: string, event: CalendarEvent, externalCalendarId?: string) {
    const eventId = uid;
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = externalCalendarId || mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      this.log.error(""no calendar id provided in updateEvent"");
      throw new Error(""no calendar id provided in updateEvent"");
    }
    try {
      const eventResponse = await this.
---
[Medium] method createEvent in packages/app-store/larkcalendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    let eventId = """";
    let eventRespData;
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    const calendarId = mainHostDestinationCalendar?.externalId;
    if (!calendarId) {
      throw new Error(""no calendar id"");
    }
    try {
      const eventResponse = await this.fetcher(`/calendar/v4/calendars/${calendarId}/events/create_event`, {
        method: ""POST"",
        body: JSON.stringify(t
---
[Medium] class LarkCalendarService in packages/app-store/larkcalendar/lib/CalendarService.ts:
class LarkCalendarService implements Calendar {
  private url = `https://${LARK_HOST}/open-apis`;
  private integrationName = """";
  private log: typeof logger;
  auth: { getToken: () => Promise<string> };

  constructor(credential: CredentialPayload) {
    this.integrationName = ""lark_calendar"";
    this.auth = this.larkAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private larkAuth = (credential: CredentialPayload) => {
    const l
---
[Medium] method createEvent in packages/app-store/office365calendar/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    const [mainHostDestinationCalendar] = event.destinationCalendar ?? [];
    try {
      const eventsUrl = mainHostDestinationCalendar?.externalId
        ? `/me/calendars/${mainHostDestinationCalendar?.externalId}/events`
        : ""/me/calendar/events"";

      const response = await this.fetcher(eventsUrl, {
        method: ""POST"",
        body: JSON.stringify(this.translateEvent(event)),
      });

      const response
---
[Medium] method createEvent in packages/lib/CalendarService.ts:
async createEvent(event: CalendarEvent): Promise<NewCalendarEventType> {
    try {
      const calendars = await this.listCalendars(event);

      const uid = uuidv4();

      // We create local ICS files
      const { error, value: iCalString } = createEvent({
        uid,
        startInputType: ""utc"",
        start: convertDate(event.startTime),
        duration: getDuration(event.startTime, event.endTime),
        title: event.title,
        description: getRichDescription(event),
        lo
---
[Medium] class GoogleCalendarService in packages/app-store/googlecalendar/lib/CalendarService.ts:
class GoogleCalendarService implements Calendar {
  private integrationName = """";
  private auth: { getToken: () => Promise<MyGoogleAuth> };
  private log: typeof logger;

  constructor(credential: CredentialPayload) {
    this.integrationName = ""google_calendar"";
    this.auth = this.googleAuth(credential);
    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integrationName}`] });
  }

  private googleAuth = (credential: CredentialPayload) => {
    const googleCredentials = googleCre
---
[Medium] method createAllCalendarEvents in packages/core/EventManager.ts:
private async createAllCalendarEvents(event: CalendarEvent) {
    let createdEvents: EventResult<NewCalendarEventType>[] = [];
    if (event.destinationCalendar && event.destinationCalendar.length > 0) {
      for (const destination of event.destinationCalendar) {
        if (destination.credentialId) {
          let credential = this.calendarCredentials.find((c) => c.id === destination.credentialId);
          if (!credential) {
            // Fetch credential from DB
            const credenti
---
[Medium] class EventManager in packages/core/EventManager.ts:
class EventManager {
  calendarCredentials: CredentialWithAppName[];
  videoCredentials: CredentialWithAppName[];

  /**
   * Takes an array of credentials and initializes a new instance of the EventManager.
   *
   * @param user
   */
  constructor(user: EventManagerUser) {
    const appCredentials = getApps(user.credentials, true).flatMap((app) =>
      app.credentials.map((creds) => ({ ...creds, appName: app.name }))
    );
    // This includes all calendar-related apps, traditional calendars
---
[Medium] method updateAllCalendarEvents in packages/core/EventManager.ts:
private async updateAllCalendarEvents(
    event: CalendarEvent,
    booking: PartialBooking,
    newBookingId?: number
  ): Promise<Array<EventResult<NewCalendarEventType>>> {
    let calendarReference: PartialReference[] | undefined = undefined,
      credential;
    try {
      // If a newBookingId is given, update that calendar event
      let newBooking;
      if (newBookingId) {
        newBooking = await prisma.booking.findUnique({
          where: {
            id: newBookingId,
        
---
[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(
  req: NextApiRequest & { userId?: number | undefined },
  {
    isNotAnApiCall = false,
  }: {
    isNotAnApiCall?: boolean;
  } = {
    isNotAnApiCall: false,
  }
) {
  const { userId } = req;

  const userIp = getIP(req);

  await checkRateLimitAndThrowError({
    rateLimitingType: ""core"",
    identifier: userIp,
  });

  // handle dynamic user
  let eventType =
    !req.body.eventTypeId && !!req.body.eventTypeSlug
      ? getDefaultEvent(req.body.eventTypeSlug)
      
---
[Medium] variable createEvent in packages/core/CalendarManager.ts:
const createEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  externalId?: string
): Promise<EventResult<NewCalendarEventType>> => {
  const uid: string = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = true;
  let calError: string | undefined = undefined;

  // Check if the disabledNotes flag is set to true
  if (calEvent.hideCalendarNotes) {
    calEvent.additionalNotes = ""Notes have been hidden by the organizer""; // TODO: i18
---
[Medium] function handler in apps/web/pages/api/cron/bookingReminder.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = req.headers.authorization || req.query.apiKey;
  if (process.env.CRON_API_KEY !== apiKey) {
    res.status(401).json({ message: ""Not authenticated"" });
    return;
  }
  if (req.method !== ""POST"") {
    res.status(405).json({ message: ""Invalid method"" });
    return;
  }

  const reminderIntervalMinutes = [48 * 60, 24 * 60, 3 * 60];
  let notificationsSent = 0;
  for (const interval of reminderIntervalMinutes) {
---
[Medium] class Office365CalendarService in packages/app-store/office365calendar/lib/CalendarService.ts:
class Office365CalendarService implements Calendar {
  private url = """";
  private integrationName = """";
  private log: typeof logger;
  private accessToken: string | null = null;
  auth: { getToken: () => Promise<string> };
  private apiGraphUrl = ""https://graph.microsoft.com/v1.0"";

  constructor(credential: CredentialPayload) {
    this.integrationName = ""office365_calendar"";
    this.auth = this.o365Auth(credential);

    this.log = logger.getChildLogger({ prefix: [`[[lib] ${this.integration
---
[Medium] method updateLocation in packages/core/EventManager.ts:
public async updateLocation(event: CalendarEvent, booking: PartialBooking): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    const isDedicated = evt.location ? isDedicatedIntegration(evt.location) : null;

    const results: Array<EventResult<Exclude<Event, AdditionalInformation>>> = [];
    // If and only if event type is a dedicated meeting, create a dedicated video meeting.
    if (isDedicated) {
      const result = await this.createVideoEvent(evt);
      if (result.
---
[Medium] method create in packages/core/EventManager.ts:
public async create(event: CalendarEvent): Promise<CreateUpdateResult> {
    const evt = processLocation(event);
    // Fallback to cal video if no location is set
    if (!evt.location) {
      // See if cal video is enabled & has keys
      const calVideo = await prisma.app.findFirst({
        where: {
          slug: ""daily-video"",
        },
        select: {
          keys: true,
          enabled: true,
        },
      });

      const calVideoKeys = calVideoKeysSchema.safeParse(calVideo?
---
[Medium] class CalendarEventClass in packages/core/builders/CalendarEvent/class.ts:
class CalendarEventClass implements CalendarEvent {
  type!: string;
  title!: string;
  startTime!: string;
  endTime!: string;
  organizer!: Person;
  attendees!: Person[];
  description?: string | null;
  team?: { name: string; members: Person[] };
  location?: string | null;
  conferenceData?: ConferenceData;
  additionalInformation?: AdditionalInformation;
  uid?: string | null;
  videoCallData?: VideoCallData;
  paymentInfo?: any;
  destinationCalendar?: DestinationCalendar[] | null;
  can
---
[Medium] field destinationCalendar in packages/core/builders/CalendarEvent/class.ts:
destinationCalendar?: DestinationCalendar[] | null
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: CustomRequest) {
  const { id, uid, allRemainingBookings, cancellationReason, seatReferenceUid } =
    schemaBookingCancelParams.parse(req.body);
  req.bookingToDelete = await getBookingToDelete(id, uid);
  const { bookingToDelete, userId } = req;

  if (!bookingToDelete || !bookingToDelete.user) {
    throw new HttpError({ statusCode: 400, message: ""Booking not found"" });
  }

  if (userId !== bookingToDelete.user?.id && bookingToDelete.startTime < new Date()) {
    
---
[Medium] function ensureAvailableUsers in packages/features/bookings/lib/handleNewBooking.ts:
async function ensureAvailableUsers(
  eventType: Awaited<ReturnType<typeof getEventTypesFromDB>> & {
    users: IsFixedAwareUser[];
  },
  input: { dateFrom: string; dateTo: string; timeZone: string; originalRescheduledBooking?: BookingType },
  recurringDatesInfo?: {
    allRecurringDates: string[] | undefined;
    currentRecurringIndex: number | undefined;
  }
) {
  const availableUsers: IsFixedAwareUser[] = [];

  const originalBookingDuration = input.originalRescheduledBooking
    ? dayjs(i
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/paypal-webhook.ts:
async function handlePaymentSuccess(
  payload: z.infer<typeof eventSchema>,
  rawPayload: string,
  webhookHeaders: WebHookHeadersType
) {
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: payload?.resource?.id,
    },
    select: {
      id: true,
      bookingId: true,
      success: true,
    },
  });

  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" });

  const booking = await prisma.booking.findUnique({
    where
---
[Medium] function handlePaymentSuccess in packages/features/ee/payments/api/webhook.ts:
async function handlePaymentSuccess(event: Stripe.Event) {
  const paymentIntent = event.data.object as Stripe.PaymentIntent;
  const payment = await prisma.payment.findFirst({
    where: {
      externalId: paymentIntent.id,
    },
    select: {
      id: true,
      bookingId: true,
    },
  });
  if (!payment?.bookingId) {
    console.log(JSON.stringify(paymentIntent), JSON.stringify(payment));
  }
  if (!payment?.bookingId) throw new HttpCode({ statusCode: 204, message: ""Payment not found"" }
---
[Medium] function getBooking in packages/features/ee/payments/api/webhook.ts:
async function getBooking(bookingId: number) {
  const booking = await prisma.booking.findUnique({
    where: {
      id: bookingId,
    },
    select: {
      ...bookingMinimalSelect,
      eventType: true,
      smsReminderNumber: true,
      location: true,
      eventTypeId: true,
      userId: true,
      uid: true,
      paid: true,
      destinationCalendar: true,
      status: true,
      user: {
        select: {
          id: true,
          username: true,
          timeZone: true,
  
---
[Medium] variable deleteCredentialHandler in packages/trpc/server/routers/loggedInViewer/deleteCredential.handler.ts:
const deleteCredentialHandler = async ({ ctx, input }: DeleteCredentialOptions) => {
  const { user } = ctx;
  const { id, teamId } = input;

  const credential = await prisma.credential.findFirst({
    where: {
      id: id,
      ...(teamId ? { teamId } : { userId: ctx.user.id }),
    },
    select: {
      key: true,
      appId: true,
      app: {
        select: {
          slug: true,
          categories: true,
          dirName: true,
        },
      },
      id: true,
      type: true,
---
[Medium] variable editLocationHandler in packages/trpc/server/routers/viewer/bookings/editLocation.handler.ts:
const editLocationHandler = async ({ ctx, input }: EditLocationOptions) => {
  const { bookingId, newLocation: location, details } = input;
  const { booking } = ctx;

  try {
    const organizer = await prisma.user.findFirstOrThrow({
      where: {
        id: booking.userId || 0,
      },
      select: {
        name: true,
        email: true,
        timeZone: true,
        locale: true,
      },
    });

    let conferenceCredential: CredentialPayload | null = null;

    if (details?.creden
---
[Medium] variable createHandler in packages/trpc/server/routers/viewer/organizations/create.handler.ts:
const createHandler = async ({ input, ctx }: CreateOptions) => {
  const { slug, name, adminEmail, adminUsername, check } = input;

  const userCollisions = await prisma.user.findUnique({
    where: {
      email: adminEmail,
    },
  });

  const slugCollisions = await prisma.team.findFirst({
    where: {
      slug: slug,
      metadata: {
        path: [""isOrganization""],
        equals: true,
      },
    },
  });

  if (slugCollisions || RESERVED_SUBDOMAINS.includes(slug))
    throw new TRP","EventResult (Critical), Calendar (Critical), CalendarEvent (Critical), requestRescheduleHandler (Critical), confirmHandler (High), BrokenIntegrationEmail (High), deleteEvent (High), createAttendees (Medium), listCalendars (Medium), createEvent (Medium), deleteEvent (Medium), updateEvent (Medium), updateEvent (Medium), createEvent (Medium), LarkCalendarService (Medium), createEvent (Medium), createEvent (Medium), GoogleCalendarService (Medium), createAllCalendarEvents (Medium), EventManager (Medium), updateAllCalendarEvents (Medium), handler (Medium), createEvent (Medium), handler (Medium), Office365CalendarService (Medium), updateLocation (Medium), create (Medium), CalendarEventClass (Medium), destinationCalendar (Medium), handler (Medium), ensureAvailableUsers (Medium), handlePaymentSuccess (Medium), handlePaymentSuccess (Medium), getBooking (Medium), deleteCredentialHandler (Medium), editLocationHandler (Medium), createHandler (Medium)",match,'Calendar' matches HC entity 'calendarevent'
cal_dot_com,3,feat: 2fa backup codes,The exported function TwoFactor handles backup codes and is in BackupCode.tsx. Inconsistent naming.,Low,60,6,42,"enum::ErrorCode (packages/features/auth/lib/ErrorCode.ts) [Critical, score=1.00] | variable::providers (packages/features/auth/lib/next-auth-options.ts) [Critical, score=1.00] | variable::buildUser (packages/lib/test/builder.ts) [Critical, score=0.73] | variable::user (apps/web/playwright/login.2fa.e2e.ts) [Critical, score=0.73] | function::TwoFactor (apps/web/components/auth/BackupCode.tsx) [High, score=0.67] | interface::DisableTwoFactorValues (apps/web/components/settings/DisableTwoFactorModal.tsx) [High, score=0.53]","[Critical] enum ErrorCode in packages/features/auth/lib/ErrorCode.ts:
enum ErrorCode {
  IncorrectEmailPassword = ""incorrect-email-password"",
  UserNotFound = ""user-not-found"",
  IncorrectPassword = ""incorrect-password"",
  UserMissingPassword = ""missing-password"",
  TwoFactorDisabled = ""two-factor-disabled"",
  TwoFactorAlreadyEnabled = ""two-factor-already-enabled"",
  TwoFactorSetupRequired = ""two-factor-setup-required"",
  SecondFactorRequired = ""second-factor-required"",
  IncorrectTwoFactorCode = ""incorrect-two-factor-code"",
  IncorrectBackupCode = ""incorrect-backup-code"",
  MissingBackupCodes = ""missing-backup-codes"",
  IncorrectEmailVerificationCode = ""incorrect_email_verification_code"",
  InternalServerError = ""internal-server-error"",
  NewPasswordMatchesOld = ""new-password-matches-old"",
  ThirdPartyIdentityProviderEnabled = ""third-party-identity-provider
---
[Critical] variable providers in packages/features/auth/lib/next-auth-options.ts:
const providers: Provider[] = [
  CredentialsProvider({
    id: ""credentials"",
    name: ""Cal.com"",
    type: ""credentials"",
    credentials: {
      email: { label: ""Email Address"", type: ""email"", placeholder: ""john.doe@example.com"" },
      password: { label: ""Password"", type: ""password"", placeholder: ""Your super secure password"" },
      totpCode: { label: ""Two-factor Code"", type: ""input"", placeholder: ""Code from authenticator app"" },
      backupCode: { label: ""Backup Code"", type: ""input"", placeholder: ""Two-factor backup code"" },
    },
    async authorize(credentials) {
      if (!credentials) {
        console.error(`For some reason credentials are missing`);
        throw new Error(ErrorCode.InternalServerError);
      }

      const user = await prisma.user.findUnique({
        whe
---
[Critical] variable buildUser in packages/lib/test/builder.ts:
const buildUser = <T extends Partial<UserPayload>>(user?: T): UserPayload => {
  return {
    name: faker.name.firstName(),
    email: faker.internet.email(),
    timeZone: faker.address.timeZone(),
    username: faker.internet.userName(),
    id: 0,
    allowDynamicBooking: true,
    availability: [],
    avatar: """",
    away: false,
    backupCodes: null,
    bio: null,
    brandColor: ""#292929"",
    bufferTime: 0,
    completedOnboarding: false,
    createdDate: new Date(),
    credentials: [],
    darkBrandColor: ""#fafafa"",
    defaultScheduleId: null,
    destinationCalendar: null,
    disableImpersonation: false,
    emailVerified: null,
    endTime: 0,
    hideBranding: true,
    identityProvider: ""CAL"",
    identityProviderId: null,
    invitedTo: null,
    locale: ""en"",
    metada
---
[Critical] variable user in apps/web/playwright/login.2fa.e2e.ts:
const user = await test.step(""Enable 2FA"", async () => {
      const user = await users.create();
      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
      const userPassword = user.username!;
      await user.login();

      // expects the home page for an authorized user
      await page.goto(""/settings/security/two-factor-auth"");
      await page.click(`[data-testid=two-factor-switch][data-state=""unchecked""]`);
      await page.fill('input[name=""password""]', userPassword);
      await page.press('input[name=""password""]', ""Enter"");
      const secret = await page.locator(`[data-testid=two-factor-secret]`).textContent();
      expect(secret).toHaveLength(32);
      await page.click('[data-testid=""goto-otp-screen""]');

      // eslint-disable-next-line @typescript-es
---
[High] function TwoFactor in apps/web/components/auth/BackupCode.tsx:
function TwoFactor({ center = true }) {
  const { t } = useLocale();
  const methods = useFormContext();

  return (
    <div className={center ? ""mx-auto !mt-0 max-w-sm"" : ""!mt-0 max-w-sm""}>
      <Label className=""mt-4"">{t(""backup_code"")}</Label>

      <p className=""text-subtle mb-4 text-sm"">{t(""backup_code_instructions"")}</p>

      <TextField
        id=""backup-code""
        label=""""
        defaultValue=""""
        placeholder=""XXXXX-XXXXX""
        minLength={10} // without dash
        maxLength={11} // with dash
        required
        {...methods.register(""backupCode"")}
      />
    </div>
  );
}
---
[High] interface DisableTwoFactorValues in apps/web/components/settings/DisableTwoFactorModal.tsx:
interface DisableTwoFactorValues {
  backupCode: string;
  totpCode: string;
  password: string;
}","[Medium] enum SetupStep in apps/web/components/settings/EnableTwoFactorModal.tsx:
enum SetupStep {
  ConfirmPassword,
  DisplayBackupCodes,
  DisplayQrCode,
  EnterTotpCode,
}
---
[Medium] function TwoFactor in apps/web/components/auth/TwoFactor.tsx:
function TwoFactor({ center = true, autoFocus = true }) {
  const [value, onChange] = useState("""");
  const { t } = useLocale();
  const methods = useFormContext();

  const digits = useDigitInput({
    acceptedCharacters: /^[0-9]$/,
    length: 6,
    value,
    onChange,
  });

  useEffect(() => {
    if (value) methods.setValue(""totpCode"", value);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [value]);

  const className = ""h-12 w-12 !text-xl text-center"";

  return (
    <
---
[Medium] variable PasswordField in packages/ui/components/form/inputs/Input.tsx:
const PasswordField = forwardRef<HTMLInputElement, InputFieldProps>(function PasswordField(
  props,
  ref
) {
  const { t } = useLocale();
  const [isPasswordVisible, setIsPasswordVisible] = useState(false);
  const toggleIsPasswordVisible = useCallback(
    () => setIsPasswordVisible(!isPasswordVisible),
    [isPasswordVisible, setIsPasswordVisible]
  );
  const textLabel = isPasswordVisible ? t(""hide_password"") : t(""show_password"");

  return (
    <div className=""[&_.group:hover_.addon-wrapp
---
[Medium] interface LoginValues in apps/web/pages/auth/login.tsx:
interface LoginValues {
  email: string;
  password: string;
  totpCode: string;
  backupCode: string;
  csrfToken: string;
}
---
[Medium] function Login in apps/web/pages/auth/login.tsx:
function Login({
  csrfToken,
  isGoogleLoginEnabled,
  isSAMLLoginEnabled,
  samlTenantID,
  samlProductID,
  totpEmail,
}: inferSSRProps<typeof _getServerSideProps> & WithNonceProps) {
  const searchParams = useSearchParams();
  const { t } = useLocale();
  const router = useRouter();
  const formSchema = z
    .object({
      email: z
        .string()
        .min(1, `${t(""error_required_field"")}`)
        .email(`${t(""enter_valid_email"")}`),
      password: !!totpEmail ? z.literal("""") : z.s
---
[Medium] variable EnableTwoFactorModal in apps/web/components/settings/EnableTwoFactorModal.tsx:
const EnableTwoFactorModal = ({ onEnable, onCancel, open, onOpenChange }: EnableTwoFactorModalProps) => {
  const { t } = useLocale();
  const form = useForm<EnableTwoFactorValues>();

  const setupDescriptions = {
    [SetupStep.ConfirmPassword]: t(""2fa_confirm_current_password""),
    [SetupStep.DisplayBackupCodes]: t(""backup_code_instructions""),
    [SetupStep.DisplayQrCode]: t(""2fa_scan_image_or_use_code""),
    [SetupStep.EnterTotpCode]: t(""2fa_enter_six_digit_code""),
  };
  const [step, setS
---
[Medium] function handler in apps/web/pages/api/auth/two-factor/totp/setup.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== ""POST"") {
    return res.status(405).json({ message: ""Method not allowed"" });
  }

  const session = await getServerSession({ req, res });
  if (!session) {
    return res.status(401).json({ message: ""Not authenticated"" });
  }

  if (!session.user?.id) {
    console.error(""Session is missing a user id."");
    return res.status(500).json({ error: ErrorCode.InternalServerError });
  }

  const user = await pr
---
[Medium] variable DisableTwoFactorAuthModal in apps/web/components/settings/DisableTwoFactorModal.tsx:
const DisableTwoFactorAuthModal = ({
  onDisable,
  onCancel,
  disablePassword,
  open,
  onOpenChange,
}: DisableTwoFactorAuthModalProps) => {
  const [isDisabling, setIsDisabling] = useState(false);
  const [errorMessage, setErrorMessage] = useState<string | null>(null);
  const [twoFactorLostAccess, setTwoFactorLostAccess] = useState(false);
  const { t } = useLocale();

  const form = useForm<DisableTwoFactorValues>();

  const resetForm = (clearPassword = true) => {
    if (clearPassword) 
---
[Medium] variable TwoFactorAuthAPI in apps/web/components/settings/TwoFactorAuthAPI.ts:
const TwoFactorAuthAPI = {
  async setup(password: string) {
    return fetch(""/api/auth/two-factor/totp/setup"", {
      method: ""POST"",
      body: JSON.stringify({ password }),
      headers: {
        ""Content-Type"": ""application/json"",
      },
    });
  },

  async enable(code: string) {
    return fetch(""/api/auth/two-factor/totp/enable"", {
      method: ""POST"",
      body: JSON.stringify({ code }),
      headers: {
        ""Content-Type"": ""application/json"",
      },
    });
  },

  async
---
[Medium] function handler in apps/web/pages/api/auth/two-factor/totp/disable.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== ""POST"") {
    return res.status(405).json({ message: ""Method not allowed"" });
  }

  const session = await getServerSession({ req, res });
  if (!session) {
    return res.status(401).json({ message: ""Not authenticated"" });
  }

  if (!session.user?.id) {
    console.error(""Session is missing a user id."");
    return res.status(500).json({ error: ErrorCode.InternalServerError });
  }

  const user = await pr
---
[Medium] chunk lines 361-380 in packages/prisma/schema.prisma:
  @@index([bookingId])
}

enum BookingStatus {
  CANCELLED @map(""cancelled"")
  ACCEPTED  @map(""accepted"")
  REJECTED  @map(""rejected"")
  PENDING   @map(""pending"")
}

model Booking {
  id                    Int                  @id @default(autoincrement())
  uid                   String               @unique
  user                  User?                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                Int?
  references            BookingReference[]
  eventT
---
[Medium] chunk lines 321-340 in packages/prisma/schema.prisma:
  updatedAt     DateTime @updatedAt
  teamId        Int?
  team          Team?    @relation(fields: [teamId], references: [id])

  @@unique([identifier, token])
  @@index([token])
}

model BookingReference {
  id                 Int      @id @default(autoincrement())
  /// @zod.min(1)
  type               String
  /// @zod.min(1)
  uid                String
  meetingId          String?
  meetingPassword    String?
  meetingUrl         String?
  booking            Booking? @relation(fields: [book
---
[Medium] chunk lines 821-840 in packages/prisma/schema.prisma:
  WHATSAPP
}

model BookingSeat {
  id           Int      @id @default(autoincrement())
  referenceUid String   @unique
  bookingId    Int
  booking      Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  attendeeId   Int      @unique
  attendee     Attendee @relation(fields: [attendeeId], references: [id], onDelete: Cascade)
  data         Json?

  @@index([bookingId])
  @@index([attendeeId])
}

model VerifiedNumber {
  id          Int    @id @default(autoincrement()
---
[Medium] chunk lines 681-700 in packages/prisma/schema.prisma:
  @@index([userId])
  @@index([disabled])
}

model App_RoutingForms_FormResponse {
  id           Int                   @id @default(autoincrement())
  formFillerId String                @default(cuid())
  form         App_RoutingForms_Form @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId       String
  response     Json
  createdAt    DateTime              @default(now())

  @@unique([formFillerId, formId])
  @@index([formFillerId])
  @@index([formId])
}

model Feedback
---
[Medium] chunk lines 741-760 in packages/prisma/schema.prisma:
  numberVerificationPending Boolean            @default(true)
  includeCalendarEvent      Boolean            @default(false)

  @@index([workflowId])
}

model Workflow {
  id       Int                     @id @default(autoincrement())
  name     String
  userId   Int?
  user     User?                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  team     Team?                   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId   Int?
  activeOn Work
---
[Medium] chunk lines 701-720 in packages/prisma/schema.prisma:
  userId  Int
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  rating  String
  comment String?

  @@index([userId])
  @@index([rating])
}

enum WorkflowTriggerEvents {
  BEFORE_EVENT
  EVENT_CANCELLED
  NEW_EVENT
  AFTER_EVENT
  RESCHEDULE_EVENT
}

enum WorkflowActions {
  EMAIL_HOST
  EMAIL_ATTENDEE
---
[Medium] chunk lines 561-580 in packages/prisma/schema.prisma:
  @@unique([userId, subscriberUrl], name: ""courseIdentifier"")
}

model Impersonations {
  id                 Int      @id @default(autoincrement())
  createdAt          DateTime @default(now())
  impersonatedUser   User     @relation(""impersonated_user"", fields: [impersonatedUserId], references: [id], onDelete: Cascade)
  impersonatedBy     User     @relation(""impersonated_by_user"", fields: [impersonatedById], references: [id], onDelete: Cascade)
  impersonatedUserId Int
  impersonatedById   Int
---
[Medium] chunk lines 241-260 in packages/prisma/schema.prisma:
  //linkedByUserId       Int?
  //linkedBy             User?                   @relation(""linked_account"", fields: [linkedByUserId], references: [id], onDelete: Cascade)
  //linkedUsers          User[]                  @relation(""linked_account"")*/

  @@unique([email])
  @@unique([email, username])
  @@unique([username, organizationId])
  @@index([emailVerified])
  @@index([identityProvider])
  @@index([identityProviderId])
  @@map(name: ""users"")
}

model Team {
  id                  Int        
---
[Medium] chunk lines 661-680 in packages/prisma/schema.prisma:

model App_RoutingForms_Form {
  id          String                          @id @default(cuid())
  description String?
  routes      Json?
  createdAt   DateTime                        @default(now())
  updatedAt   DateTime                        @updatedAt
  name        String
  fields      Json?
  user        User                            @relation(""routing-form"", fields: [userId], references: [id], onDelete: Cascade)
  // This is the user who created the form and also the user who has read
---
[Medium] chunk lines 401-420 in packages/prisma/schema.prisma:
  recurringEventId      String?
  smsReminderNumber     String?
  workflowReminders     WorkflowReminder[]
  scheduledJobs         String[]
  seatsReferences       BookingSeat[]
  /// @zod.custom(imports.bookingMetadataSchema)
  metadata              Json?
  isRecorded            Boolean              @default(false)

  @@index([eventTypeId])
  @@index([userId])
  @@index([destinationCalendarId])
  @@index([recurringEventId])
  @@index([uid])
  @@index([status])
}

model Schedule {
  id          
---
[Medium] chunk lines 421-440 in packages/prisma/schema.prisma:
  userId       Int
  eventType    EventType[]
  name         String
  timeZone     String?
  availability Availability[]

  @@index([userId])
}

model Availability {
  id          Int        @id @default(autoincrement())
  user        User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int?
  eventType   EventType? @relation(fields: [eventTypeId], references: [id])
  eventTypeId Int?
  days        Int[]
  startTime   DateTime   @db.Time
  endTime     DateTim
---
[Medium] chunk lines 441-460 in packages/prisma/schema.prisma:
  scheduleId  Int?

  @@index([userId])
  @@index([eventTypeId])
  @@index([scheduleId])
}

model SelectedCalendar {
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  integration String
  externalId  String

  @@id([userId, integration, externalId])
  @@index([userId])
  @@index([integration])
  @@index([externalId])
}

enum EventTypeCustomInputType {
---
[Medium] chunk lines 461-480 in packages/prisma/schema.prisma:
  TEXT     @map(""text"")
  TEXTLONG @map(""textLong"")
  NUMBER   @map(""number"")
  BOOL     @map(""bool"")
  RADIO    @map(""radio"")
  PHONE    @map(""phone"")
}

model EventTypeCustomInput {
  id          Int                      @id @default(autoincrement())
  eventTypeId Int
  eventType   EventType                @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  label       String
  type        EventTypeCustomInputType
  /// @zod.custom(imports.customInputOptionSchema)
  options
---
[Medium] chunk lines 521-540 in packages/prisma/schema.prisma:

  @@index([bookingId])
  @@index([externalId])
}

enum PaymentOption {
  ON_BOOKING
  HOLD
}

enum WebhookTriggerEvents {
  BOOKING_CREATED
  BOOKING_PAID
  BOOKING_RESCHEDULED
  BOOKING_REQUESTED
  BOOKING_CANCELLED
  BOOKING_REJECTED
  FORM_SUBMITTED
  MEETING_ENDED
  RECORDING_READY
---
[Medium] chunk lines 621-640 in packages/prisma/schema.prisma:
  userId       Int
  expires      DateTime
  user         User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum AppCategories {
  calendar
  messaging
  other
  payment
  video // deprecated, please use 'conferencing' instead
  web3 // deprecated, we should no longer have any web3 apps
  automation
  analytics
  // Wherever video is in use, conferencing should also be used for legacy apps can have it.
  conferencing
  crm
}
---
[Medium] chunk lines 261-280 in packages/prisma/schema.prisma:
  appLogo             String?
  appIconLogo         String?
  bio                 String?
  hideBranding        Boolean                 @default(false)
  isPrivate           Boolean                 @default(false)
  hideBookATeamMember Boolean                 @default(false)
  members             Membership[]
  eventTypes          EventType[]
  workflows           Workflow[]
  createdAt           DateTime                @default(now())
  /// @zod.custom(imports.teamMetadataSchema)
  metadata    
---
[Medium] chunk lines 861-880 in packages/prisma/schema.prisma:
  createdAt   DateTime?    @default(now())
  updatedAt   DateTime?    @default(now()) @updatedAt
  updatedBy   Int?

  @@index([enabled])
  @@index([stale])
}

enum FeatureType {
  RELEASE
  EXPERIMENT
  OPERATIONAL
  KILL_SWITCH
  PERMISSION
}

model SelectedSlots {
  id               Int      @id @default(autoincrement())
  eventTypeId      Int
  userId           Int
---
[Medium] chunk lines 541-560 in packages/prisma/schema.prisma:
}

model Webhook {
  id              String                 @id @unique
  userId          Int?
  teamId          Int?
  eventTypeId     Int?
  /// @zod.url()
  subscriberUrl   String
  payloadTemplate String?
  createdAt       DateTime               @default(now())
  active          Boolean                @default(true)
  eventTriggers   WebhookTriggerEvents[]
  user            User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  team            Team?        
---
[Medium] chunk lines 201-220 in packages/prisma/schema.prisma:
  locale              String?
  timeFormat          Int?                 @default(12)
  twoFactorSecret     String?
  twoFactorEnabled    Boolean              @default(false)
  backupCodes         String?
  identityProvider    IdentityProvider     @default(CAL)
  identityProviderId  String?
  availability        Availability[]
  invitedTo           Int?
  webhooks            Webhook[]
  brandColor          String               @default(""#292929"")
  darkBrandColor      String               @defau
---
[Medium] chunk lines 481-500 in packages/prisma/schema.prisma:
}

model ResetPasswordRequest {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String
  expires   DateTime
}

enum ReminderType {
  PENDING_BOOKING_CONFIRMATION
}

model ReminderMail {
  id             Int          @id @default(autoincrement())
  referenceId    Int
  reminderType   ReminderType
  elapsedMinutes Int
  createdAt      DateTime     @default(now())
---
[Medium] chunk lines 341-360 in packages/prisma/schema.prisma:
  deleted            Boolean?
  credentialId       Int?

  @@index([bookingId])
  @@index([credentialId])
  @@index([type])
  @@index([uid])
}

model Attendee {
  id          Int          @id @default(autoincrement())
  email       String
  name        String
  timeZone    String
  locale      String?      @default(""en"")
  booking     Booking?     @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId   Int?
  bookingSeat BookingSeat?

  @@index([email])
---
[Medium] chunk lines 601-620 in packages/prisma/schema.prisma:
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@index([type])
}

model Session {
  id           String   @id @default(cuid())
  
---
[Medium] chunk lines 581-600 in packages/prisma/schema.prisma:
  hashedKey  String    @unique()
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  team       Team?     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  app        App?      @relation(fields: [appId], references: [slug], onDelete: Cascade)
  appId      String?

  @@index([userId])
}

model HashedLink {
  id          Int       @id @default(autoincrement())
  link        String    @unique()
  eventType   EventType @relation(fields: [eventTy
---
[Medium] chunk lines 721-740 in packages/prisma/schema.prisma:
  SMS_ATTENDEE
  SMS_NUMBER
  EMAIL_ADDRESS
  WHATSAPP_ATTENDEE
  WHATSAPP_NUMBER
}

model WorkflowStep {
  id                        Int                @id @default(autoincrement())
  stepNumber                Int
  action                    WorkflowActions
  workflowId                Int
  workflow                  Workflow           @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  sendTo                    String?
  reminderBody              String?
  emailSubject       
---
[Medium] chunk lines 761-780 in packages/prisma/schema.prisma:
  @@index([teamId])
}

model WorkflowsOnEventTypes {
  id          Int       @id @default(autoincrement())
  workflow    Workflow  @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  workflowId  Int
  eventType   EventType @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  eventTypeId Int

  @@unique([workflowId, eventTypeId])
  @@index([workflowId])
  @@index([eventTypeId])
}

model Deployment {
  /// This is a single row table, so we use a fixed id
  id 
---
[Medium] chunk lines 801-820 in packages/prisma/schema.prisma:
  workflowStep    WorkflowStep?   @relation(fields: [workflowStepId], references: [id])
  cancelled       Boolean?
  seatReferenceId String?

  @@index([bookingUid])
  @@index([workflowStepId])
  @@index([seatReferenceId])
}

enum WorkflowTemplates {
  REMINDER
  CUSTOM
  CANCELLED
  RESCHEDULED
  COMPLETED
}

enum WorkflowMethods {
  EMAIL
  SMS
---
[Medium] chunk lines 881-900 in packages/prisma/schema.prisma:
  slotUtcStartDate DateTime
  slotUtcEndDate   DateTime
  uid              String
  releaseAt        DateTime
  isSeat           Boolean  @default(false)

  @@unique(fields: [userId, slotUtcStartDate, slotUtcEndDate, uid], name: ""selectedSlotUnique"")
}

view BookingTimeStatus {
  id            Int            @unique
  uid           String?
  eventTypeId   Int?
  title         String?
  description   String?
  startTime     DateTime?
  endTime       DateTime?
  createdAt     DateTime?
  location 
---
[Medium] chunk lines 781-800 in packages/prisma/schema.prisma:
  theme           Json?
  licenseKey      String?
  agreedLicenseAt DateTime?
}

enum TimeUnit {
  DAY    @map(""day"")
  HOUR   @map(""hour"")
  MINUTE @map(""minute"")
}

model WorkflowReminder {
  id              Int             @id @default(autoincrement())
  bookingUid      String?
  booking         Booking?        @relation(fields: [bookingUid], references: [uid])
  method          WorkflowMethods
  scheduledDate   DateTime
  referenceId     String?         @unique
  scheduled       Boolean
  wo
---
[Medium] chunk lines 841-860 in packages/prisma/schema.prisma:
  teamId      Int?
  team        Team?  @relation(fields: [teamId], references: [id], onDelete: Cascade)
  phoneNumber String

  @@index([userId])
  @@index([teamId])
}

model Feature {
  // The feature slug, ex: 'v2-workflows'
  slug        String       @id @unique
  // If the feature is currently enabled
  enabled     Boolean      @default(false)
  // A short description of the feature
  description String?
  // The type of feature flag
  type        FeatureType? @default(RELEASE)
  // If the 
---
[Medium] chunk lines 281-300 in packages/prisma/schema.prisma:
  inviteTokens        VerificationToken[]
  webhooks            Webhook[]
  timeFormat          Int?
  timeZone            String                  @default(""Europe/London"")
  weekStart           String                  @default(""Sunday"")
  routingForms        App_RoutingForms_Form[]
  apiKeys             ApiKey[]
  credentials         Credential[]

  @@unique([slug, parentId])
}

enum MembershipRole {
  MEMBER
  ADMIN
  OWNER
}

model Membership {
  id                   Int            @id @defau
---
[Medium] chunk lines 301-320 in packages/prisma/schema.prisma:
  teamId               Int
  userId               Int
  accepted             Boolean        @default(false)
  role                 MembershipRole
  team                 Team           @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user                 User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  disableImpersonation Boolean        @default(false)

  @@unique([userId, teamId])
  @@index([teamId])
  @@index([userId])
}

model VerificationTok
---
[Medium] chunk lines 381-400 in packages/prisma/schema.prisma:
  customInputs          Json?
  /// @zod.custom(imports.bookingResponses)
  responses             Json?
  startTime             DateTime
  endTime               DateTime
  attendees             Attendee[]
  location              String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime?
  status                BookingStatus        @default(ACCEPTED)
  paid                  Boolean              @default(false)
  payment               Payment[]
  destina","ErrorCode (Critical), providers (Critical), buildUser (Critical), user (Critical), TwoFactor (High), DisableTwoFactorValues (High), SetupStep (Medium), TwoFactor (Medium), PasswordField (Medium), LoginValues (Medium), Login (Medium), EnableTwoFactorModal (Medium), handler (Medium), DisableTwoFactorAuthModal (Medium), TwoFactorAuthAPI (Medium), handler (Medium), lines 361-380 (Medium), lines 321-340 (Medium), lines 821-840 (Medium), lines 681-700 (Medium), lines 741-760 (Medium), lines 701-720 (Medium), lines 561-580 (Medium), lines 241-260 (Medium), lines 661-680 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 521-540 (Medium), lines 621-640 (Medium), lines 261-280 (Medium), lines 861-880 (Medium), lines 541-560 (Medium), lines 201-220 (Medium), lines 481-500 (Medium), lines 341-360 (Medium), lines 601-620 (Medium), lines 581-600 (Medium), lines 721-740 (Medium), lines 761-780 (Medium), lines 801-820 (Medium), lines 881-900 (Medium), lines 781-800 (Medium), lines 841-860 (Medium), lines 281-300 (Medium), lines 301-320 (Medium), lines 381-400 (Medium), lines 901-908 (Low), backup_code (Low), backup_codes (Low), backup_code_instructions (Low), backup_codes_copied (Low), incorrect_backup_code (Low), lost_access (Low), missing_backup_codes (Low), lines 1-2 (Low), lines 501-520 (Low), lines 221-240 (Low), lines 641-660 (Low)",match,'TwoFactor' matches HC entity 'disabletwofactorvalues'
cal_dot_com,3,feat: 2fa backup codes,"Error message mentions 'backup code login' but this is a disable endpoint, not login",Low,60,6,42,"enum::ErrorCode (packages/features/auth/lib/ErrorCode.ts) [Critical, score=1.00] | variable::providers (packages/features/auth/lib/next-auth-options.ts) [Critical, score=1.00] | variable::buildUser (packages/lib/test/builder.ts) [Critical, score=0.73] | variable::user (apps/web/playwright/login.2fa.e2e.ts) [Critical, score=0.73] | function::TwoFactor (apps/web/components/auth/BackupCode.tsx) [High, score=0.67] | interface::DisableTwoFactorValues (apps/web/components/settings/DisableTwoFactorModal.tsx) [High, score=0.53]","[Critical] enum ErrorCode in packages/features/auth/lib/ErrorCode.ts:
enum ErrorCode {
  IncorrectEmailPassword = ""incorrect-email-password"",
  UserNotFound = ""user-not-found"",
  IncorrectPassword = ""incorrect-password"",
  UserMissingPassword = ""missing-password"",
  TwoFactorDisabled = ""two-factor-disabled"",
  TwoFactorAlreadyEnabled = ""two-factor-already-enabled"",
  TwoFactorSetupRequired = ""two-factor-setup-required"",
  SecondFactorRequired = ""second-factor-required"",
  IncorrectTwoFactorCode = ""incorrect-two-factor-code"",
  IncorrectBackupCode = ""incorrect-backup-code"",
  MissingBackupCodes = ""missing-backup-codes"",
  IncorrectEmailVerificationCode = ""incorrect_email_verification_code"",
  InternalServerError = ""internal-server-error"",
  NewPasswordMatchesOld = ""new-password-matches-old"",
  ThirdPartyIdentityProviderEnabled = ""third-party-identity-provider
---
[Critical] variable providers in packages/features/auth/lib/next-auth-options.ts:
const providers: Provider[] = [
  CredentialsProvider({
    id: ""credentials"",
    name: ""Cal.com"",
    type: ""credentials"",
    credentials: {
      email: { label: ""Email Address"", type: ""email"", placeholder: ""john.doe@example.com"" },
      password: { label: ""Password"", type: ""password"", placeholder: ""Your super secure password"" },
      totpCode: { label: ""Two-factor Code"", type: ""input"", placeholder: ""Code from authenticator app"" },
      backupCode: { label: ""Backup Code"", type: ""input"", placeholder: ""Two-factor backup code"" },
    },
    async authorize(credentials) {
      if (!credentials) {
        console.error(`For some reason credentials are missing`);
        throw new Error(ErrorCode.InternalServerError);
      }

      const user = await prisma.user.findUnique({
        whe
---
[Critical] variable buildUser in packages/lib/test/builder.ts:
const buildUser = <T extends Partial<UserPayload>>(user?: T): UserPayload => {
  return {
    name: faker.name.firstName(),
    email: faker.internet.email(),
    timeZone: faker.address.timeZone(),
    username: faker.internet.userName(),
    id: 0,
    allowDynamicBooking: true,
    availability: [],
    avatar: """",
    away: false,
    backupCodes: null,
    bio: null,
    brandColor: ""#292929"",
    bufferTime: 0,
    completedOnboarding: false,
    createdDate: new Date(),
    credentials: [],
    darkBrandColor: ""#fafafa"",
    defaultScheduleId: null,
    destinationCalendar: null,
    disableImpersonation: false,
    emailVerified: null,
    endTime: 0,
    hideBranding: true,
    identityProvider: ""CAL"",
    identityProviderId: null,
    invitedTo: null,
    locale: ""en"",
    metada
---
[Critical] variable user in apps/web/playwright/login.2fa.e2e.ts:
const user = await test.step(""Enable 2FA"", async () => {
      const user = await users.create();
      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
      const userPassword = user.username!;
      await user.login();

      // expects the home page for an authorized user
      await page.goto(""/settings/security/two-factor-auth"");
      await page.click(`[data-testid=two-factor-switch][data-state=""unchecked""]`);
      await page.fill('input[name=""password""]', userPassword);
      await page.press('input[name=""password""]', ""Enter"");
      const secret = await page.locator(`[data-testid=two-factor-secret]`).textContent();
      expect(secret).toHaveLength(32);
      await page.click('[data-testid=""goto-otp-screen""]');

      // eslint-disable-next-line @typescript-es
---
[High] function TwoFactor in apps/web/components/auth/BackupCode.tsx:
function TwoFactor({ center = true }) {
  const { t } = useLocale();
  const methods = useFormContext();

  return (
    <div className={center ? ""mx-auto !mt-0 max-w-sm"" : ""!mt-0 max-w-sm""}>
      <Label className=""mt-4"">{t(""backup_code"")}</Label>

      <p className=""text-subtle mb-4 text-sm"">{t(""backup_code_instructions"")}</p>

      <TextField
        id=""backup-code""
        label=""""
        defaultValue=""""
        placeholder=""XXXXX-XXXXX""
        minLength={10} // without dash
        maxLength={11} // with dash
        required
        {...methods.register(""backupCode"")}
      />
    </div>
  );
}
---
[High] interface DisableTwoFactorValues in apps/web/components/settings/DisableTwoFactorModal.tsx:
interface DisableTwoFactorValues {
  backupCode: string;
  totpCode: string;
  password: string;
}","[Medium] enum SetupStep in apps/web/components/settings/EnableTwoFactorModal.tsx:
enum SetupStep {
  ConfirmPassword,
  DisplayBackupCodes,
  DisplayQrCode,
  EnterTotpCode,
}
---
[Medium] function TwoFactor in apps/web/components/auth/TwoFactor.tsx:
function TwoFactor({ center = true, autoFocus = true }) {
  const [value, onChange] = useState("""");
  const { t } = useLocale();
  const methods = useFormContext();

  const digits = useDigitInput({
    acceptedCharacters: /^[0-9]$/,
    length: 6,
    value,
    onChange,
  });

  useEffect(() => {
    if (value) methods.setValue(""totpCode"", value);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [value]);

  const className = ""h-12 w-12 !text-xl text-center"";

  return (
    <
---
[Medium] variable PasswordField in packages/ui/components/form/inputs/Input.tsx:
const PasswordField = forwardRef<HTMLInputElement, InputFieldProps>(function PasswordField(
  props,
  ref
) {
  const { t } = useLocale();
  const [isPasswordVisible, setIsPasswordVisible] = useState(false);
  const toggleIsPasswordVisible = useCallback(
    () => setIsPasswordVisible(!isPasswordVisible),
    [isPasswordVisible, setIsPasswordVisible]
  );
  const textLabel = isPasswordVisible ? t(""hide_password"") : t(""show_password"");

  return (
    <div className=""[&_.group:hover_.addon-wrapp
---
[Medium] interface LoginValues in apps/web/pages/auth/login.tsx:
interface LoginValues {
  email: string;
  password: string;
  totpCode: string;
  backupCode: string;
  csrfToken: string;
}
---
[Medium] function Login in apps/web/pages/auth/login.tsx:
function Login({
  csrfToken,
  isGoogleLoginEnabled,
  isSAMLLoginEnabled,
  samlTenantID,
  samlProductID,
  totpEmail,
}: inferSSRProps<typeof _getServerSideProps> & WithNonceProps) {
  const searchParams = useSearchParams();
  const { t } = useLocale();
  const router = useRouter();
  const formSchema = z
    .object({
      email: z
        .string()
        .min(1, `${t(""error_required_field"")}`)
        .email(`${t(""enter_valid_email"")}`),
      password: !!totpEmail ? z.literal("""") : z.s
---
[Medium] variable EnableTwoFactorModal in apps/web/components/settings/EnableTwoFactorModal.tsx:
const EnableTwoFactorModal = ({ onEnable, onCancel, open, onOpenChange }: EnableTwoFactorModalProps) => {
  const { t } = useLocale();
  const form = useForm<EnableTwoFactorValues>();

  const setupDescriptions = {
    [SetupStep.ConfirmPassword]: t(""2fa_confirm_current_password""),
    [SetupStep.DisplayBackupCodes]: t(""backup_code_instructions""),
    [SetupStep.DisplayQrCode]: t(""2fa_scan_image_or_use_code""),
    [SetupStep.EnterTotpCode]: t(""2fa_enter_six_digit_code""),
  };
  const [step, setS
---
[Medium] function handler in apps/web/pages/api/auth/two-factor/totp/setup.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== ""POST"") {
    return res.status(405).json({ message: ""Method not allowed"" });
  }

  const session = await getServerSession({ req, res });
  if (!session) {
    return res.status(401).json({ message: ""Not authenticated"" });
  }

  if (!session.user?.id) {
    console.error(""Session is missing a user id."");
    return res.status(500).json({ error: ErrorCode.InternalServerError });
  }

  const user = await pr
---
[Medium] variable DisableTwoFactorAuthModal in apps/web/components/settings/DisableTwoFactorModal.tsx:
const DisableTwoFactorAuthModal = ({
  onDisable,
  onCancel,
  disablePassword,
  open,
  onOpenChange,
}: DisableTwoFactorAuthModalProps) => {
  const [isDisabling, setIsDisabling] = useState(false);
  const [errorMessage, setErrorMessage] = useState<string | null>(null);
  const [twoFactorLostAccess, setTwoFactorLostAccess] = useState(false);
  const { t } = useLocale();

  const form = useForm<DisableTwoFactorValues>();

  const resetForm = (clearPassword = true) => {
    if (clearPassword) 
---
[Medium] variable TwoFactorAuthAPI in apps/web/components/settings/TwoFactorAuthAPI.ts:
const TwoFactorAuthAPI = {
  async setup(password: string) {
    return fetch(""/api/auth/two-factor/totp/setup"", {
      method: ""POST"",
      body: JSON.stringify({ password }),
      headers: {
        ""Content-Type"": ""application/json"",
      },
    });
  },

  async enable(code: string) {
    return fetch(""/api/auth/two-factor/totp/enable"", {
      method: ""POST"",
      body: JSON.stringify({ code }),
      headers: {
        ""Content-Type"": ""application/json"",
      },
    });
  },

  async
---
[Medium] function handler in apps/web/pages/api/auth/two-factor/totp/disable.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== ""POST"") {
    return res.status(405).json({ message: ""Method not allowed"" });
  }

  const session = await getServerSession({ req, res });
  if (!session) {
    return res.status(401).json({ message: ""Not authenticated"" });
  }

  if (!session.user?.id) {
    console.error(""Session is missing a user id."");
    return res.status(500).json({ error: ErrorCode.InternalServerError });
  }

  const user = await pr
---
[Medium] chunk lines 361-380 in packages/prisma/schema.prisma:
  @@index([bookingId])
}

enum BookingStatus {
  CANCELLED @map(""cancelled"")
  ACCEPTED  @map(""accepted"")
  REJECTED  @map(""rejected"")
  PENDING   @map(""pending"")
}

model Booking {
  id                    Int                  @id @default(autoincrement())
  uid                   String               @unique
  user                  User?                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                Int?
  references            BookingReference[]
  eventT
---
[Medium] chunk lines 321-340 in packages/prisma/schema.prisma:
  updatedAt     DateTime @updatedAt
  teamId        Int?
  team          Team?    @relation(fields: [teamId], references: [id])

  @@unique([identifier, token])
  @@index([token])
}

model BookingReference {
  id                 Int      @id @default(autoincrement())
  /// @zod.min(1)
  type               String
  /// @zod.min(1)
  uid                String
  meetingId          String?
  meetingPassword    String?
  meetingUrl         String?
  booking            Booking? @relation(fields: [book
---
[Medium] chunk lines 821-840 in packages/prisma/schema.prisma:
  WHATSAPP
}

model BookingSeat {
  id           Int      @id @default(autoincrement())
  referenceUid String   @unique
  bookingId    Int
  booking      Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  attendeeId   Int      @unique
  attendee     Attendee @relation(fields: [attendeeId], references: [id], onDelete: Cascade)
  data         Json?

  @@index([bookingId])
  @@index([attendeeId])
}

model VerifiedNumber {
  id          Int    @id @default(autoincrement()
---
[Medium] chunk lines 681-700 in packages/prisma/schema.prisma:
  @@index([userId])
  @@index([disabled])
}

model App_RoutingForms_FormResponse {
  id           Int                   @id @default(autoincrement())
  formFillerId String                @default(cuid())
  form         App_RoutingForms_Form @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId       String
  response     Json
  createdAt    DateTime              @default(now())

  @@unique([formFillerId, formId])
  @@index([formFillerId])
  @@index([formId])
}

model Feedback
---
[Medium] chunk lines 741-760 in packages/prisma/schema.prisma:
  numberVerificationPending Boolean            @default(true)
  includeCalendarEvent      Boolean            @default(false)

  @@index([workflowId])
}

model Workflow {
  id       Int                     @id @default(autoincrement())
  name     String
  userId   Int?
  user     User?                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  team     Team?                   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId   Int?
  activeOn Work
---
[Medium] chunk lines 701-720 in packages/prisma/schema.prisma:
  userId  Int
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  rating  String
  comment String?

  @@index([userId])
  @@index([rating])
}

enum WorkflowTriggerEvents {
  BEFORE_EVENT
  EVENT_CANCELLED
  NEW_EVENT
  AFTER_EVENT
  RESCHEDULE_EVENT
}

enum WorkflowActions {
  EMAIL_HOST
  EMAIL_ATTENDEE
---
[Medium] chunk lines 561-580 in packages/prisma/schema.prisma:
  @@unique([userId, subscriberUrl], name: ""courseIdentifier"")
}

model Impersonations {
  id                 Int      @id @default(autoincrement())
  createdAt          DateTime @default(now())
  impersonatedUser   User     @relation(""impersonated_user"", fields: [impersonatedUserId], references: [id], onDelete: Cascade)
  impersonatedBy     User     @relation(""impersonated_by_user"", fields: [impersonatedById], references: [id], onDelete: Cascade)
  impersonatedUserId Int
  impersonatedById   Int
---
[Medium] chunk lines 241-260 in packages/prisma/schema.prisma:
  //linkedByUserId       Int?
  //linkedBy             User?                   @relation(""linked_account"", fields: [linkedByUserId], references: [id], onDelete: Cascade)
  //linkedUsers          User[]                  @relation(""linked_account"")*/

  @@unique([email])
  @@unique([email, username])
  @@unique([username, organizationId])
  @@index([emailVerified])
  @@index([identityProvider])
  @@index([identityProviderId])
  @@map(name: ""users"")
}

model Team {
  id                  Int        
---
[Medium] chunk lines 661-680 in packages/prisma/schema.prisma:

model App_RoutingForms_Form {
  id          String                          @id @default(cuid())
  description String?
  routes      Json?
  createdAt   DateTime                        @default(now())
  updatedAt   DateTime                        @updatedAt
  name        String
  fields      Json?
  user        User                            @relation(""routing-form"", fields: [userId], references: [id], onDelete: Cascade)
  // This is the user who created the form and also the user who has read
---
[Medium] chunk lines 401-420 in packages/prisma/schema.prisma:
  recurringEventId      String?
  smsReminderNumber     String?
  workflowReminders     WorkflowReminder[]
  scheduledJobs         String[]
  seatsReferences       BookingSeat[]
  /// @zod.custom(imports.bookingMetadataSchema)
  metadata              Json?
  isRecorded            Boolean              @default(false)

  @@index([eventTypeId])
  @@index([userId])
  @@index([destinationCalendarId])
  @@index([recurringEventId])
  @@index([uid])
  @@index([status])
}

model Schedule {
  id          
---
[Medium] chunk lines 421-440 in packages/prisma/schema.prisma:
  userId       Int
  eventType    EventType[]
  name         String
  timeZone     String?
  availability Availability[]

  @@index([userId])
}

model Availability {
  id          Int        @id @default(autoincrement())
  user        User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int?
  eventType   EventType? @relation(fields: [eventTypeId], references: [id])
  eventTypeId Int?
  days        Int[]
  startTime   DateTime   @db.Time
  endTime     DateTim
---
[Medium] chunk lines 441-460 in packages/prisma/schema.prisma:
  scheduleId  Int?

  @@index([userId])
  @@index([eventTypeId])
  @@index([scheduleId])
}

model SelectedCalendar {
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  integration String
  externalId  String

  @@id([userId, integration, externalId])
  @@index([userId])
  @@index([integration])
  @@index([externalId])
}

enum EventTypeCustomInputType {
---
[Medium] chunk lines 461-480 in packages/prisma/schema.prisma:
  TEXT     @map(""text"")
  TEXTLONG @map(""textLong"")
  NUMBER   @map(""number"")
  BOOL     @map(""bool"")
  RADIO    @map(""radio"")
  PHONE    @map(""phone"")
}

model EventTypeCustomInput {
  id          Int                      @id @default(autoincrement())
  eventTypeId Int
  eventType   EventType                @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  label       String
  type        EventTypeCustomInputType
  /// @zod.custom(imports.customInputOptionSchema)
  options
---
[Medium] chunk lines 521-540 in packages/prisma/schema.prisma:

  @@index([bookingId])
  @@index([externalId])
}

enum PaymentOption {
  ON_BOOKING
  HOLD
}

enum WebhookTriggerEvents {
  BOOKING_CREATED
  BOOKING_PAID
  BOOKING_RESCHEDULED
  BOOKING_REQUESTED
  BOOKING_CANCELLED
  BOOKING_REJECTED
  FORM_SUBMITTED
  MEETING_ENDED
  RECORDING_READY
---
[Medium] chunk lines 621-640 in packages/prisma/schema.prisma:
  userId       Int
  expires      DateTime
  user         User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum AppCategories {
  calendar
  messaging
  other
  payment
  video // deprecated, please use 'conferencing' instead
  web3 // deprecated, we should no longer have any web3 apps
  automation
  analytics
  // Wherever video is in use, conferencing should also be used for legacy apps can have it.
  conferencing
  crm
}
---
[Medium] chunk lines 261-280 in packages/prisma/schema.prisma:
  appLogo             String?
  appIconLogo         String?
  bio                 String?
  hideBranding        Boolean                 @default(false)
  isPrivate           Boolean                 @default(false)
  hideBookATeamMember Boolean                 @default(false)
  members             Membership[]
  eventTypes          EventType[]
  workflows           Workflow[]
  createdAt           DateTime                @default(now())
  /// @zod.custom(imports.teamMetadataSchema)
  metadata    
---
[Medium] chunk lines 861-880 in packages/prisma/schema.prisma:
  createdAt   DateTime?    @default(now())
  updatedAt   DateTime?    @default(now()) @updatedAt
  updatedBy   Int?

  @@index([enabled])
  @@index([stale])
}

enum FeatureType {
  RELEASE
  EXPERIMENT
  OPERATIONAL
  KILL_SWITCH
  PERMISSION
}

model SelectedSlots {
  id               Int      @id @default(autoincrement())
  eventTypeId      Int
  userId           Int
---
[Medium] chunk lines 541-560 in packages/prisma/schema.prisma:
}

model Webhook {
  id              String                 @id @unique
  userId          Int?
  teamId          Int?
  eventTypeId     Int?
  /// @zod.url()
  subscriberUrl   String
  payloadTemplate String?
  createdAt       DateTime               @default(now())
  active          Boolean                @default(true)
  eventTriggers   WebhookTriggerEvents[]
  user            User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  team            Team?        
---
[Medium] chunk lines 201-220 in packages/prisma/schema.prisma:
  locale              String?
  timeFormat          Int?                 @default(12)
  twoFactorSecret     String?
  twoFactorEnabled    Boolean              @default(false)
  backupCodes         String?
  identityProvider    IdentityProvider     @default(CAL)
  identityProviderId  String?
  availability        Availability[]
  invitedTo           Int?
  webhooks            Webhook[]
  brandColor          String               @default(""#292929"")
  darkBrandColor      String               @defau
---
[Medium] chunk lines 481-500 in packages/prisma/schema.prisma:
}

model ResetPasswordRequest {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String
  expires   DateTime
}

enum ReminderType {
  PENDING_BOOKING_CONFIRMATION
}

model ReminderMail {
  id             Int          @id @default(autoincrement())
  referenceId    Int
  reminderType   ReminderType
  elapsedMinutes Int
  createdAt      DateTime     @default(now())
---
[Medium] chunk lines 341-360 in packages/prisma/schema.prisma:
  deleted            Boolean?
  credentialId       Int?

  @@index([bookingId])
  @@index([credentialId])
  @@index([type])
  @@index([uid])
}

model Attendee {
  id          Int          @id @default(autoincrement())
  email       String
  name        String
  timeZone    String
  locale      String?      @default(""en"")
  booking     Booking?     @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId   Int?
  bookingSeat BookingSeat?

  @@index([email])
---
[Medium] chunk lines 601-620 in packages/prisma/schema.prisma:
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@index([type])
}

model Session {
  id           String   @id @default(cuid())
  
---
[Medium] chunk lines 581-600 in packages/prisma/schema.prisma:
  hashedKey  String    @unique()
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  team       Team?     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  app        App?      @relation(fields: [appId], references: [slug], onDelete: Cascade)
  appId      String?

  @@index([userId])
}

model HashedLink {
  id          Int       @id @default(autoincrement())
  link        String    @unique()
  eventType   EventType @relation(fields: [eventTy
---
[Medium] chunk lines 721-740 in packages/prisma/schema.prisma:
  SMS_ATTENDEE
  SMS_NUMBER
  EMAIL_ADDRESS
  WHATSAPP_ATTENDEE
  WHATSAPP_NUMBER
}

model WorkflowStep {
  id                        Int                @id @default(autoincrement())
  stepNumber                Int
  action                    WorkflowActions
  workflowId                Int
  workflow                  Workflow           @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  sendTo                    String?
  reminderBody              String?
  emailSubject       
---
[Medium] chunk lines 761-780 in packages/prisma/schema.prisma:
  @@index([teamId])
}

model WorkflowsOnEventTypes {
  id          Int       @id @default(autoincrement())
  workflow    Workflow  @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  workflowId  Int
  eventType   EventType @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  eventTypeId Int

  @@unique([workflowId, eventTypeId])
  @@index([workflowId])
  @@index([eventTypeId])
}

model Deployment {
  /// This is a single row table, so we use a fixed id
  id 
---
[Medium] chunk lines 801-820 in packages/prisma/schema.prisma:
  workflowStep    WorkflowStep?   @relation(fields: [workflowStepId], references: [id])
  cancelled       Boolean?
  seatReferenceId String?

  @@index([bookingUid])
  @@index([workflowStepId])
  @@index([seatReferenceId])
}

enum WorkflowTemplates {
  REMINDER
  CUSTOM
  CANCELLED
  RESCHEDULED
  COMPLETED
}

enum WorkflowMethods {
  EMAIL
  SMS
---
[Medium] chunk lines 881-900 in packages/prisma/schema.prisma:
  slotUtcStartDate DateTime
  slotUtcEndDate   DateTime
  uid              String
  releaseAt        DateTime
  isSeat           Boolean  @default(false)

  @@unique(fields: [userId, slotUtcStartDate, slotUtcEndDate, uid], name: ""selectedSlotUnique"")
}

view BookingTimeStatus {
  id            Int            @unique
  uid           String?
  eventTypeId   Int?
  title         String?
  description   String?
  startTime     DateTime?
  endTime       DateTime?
  createdAt     DateTime?
  location 
---
[Medium] chunk lines 781-800 in packages/prisma/schema.prisma:
  theme           Json?
  licenseKey      String?
  agreedLicenseAt DateTime?
}

enum TimeUnit {
  DAY    @map(""day"")
  HOUR   @map(""hour"")
  MINUTE @map(""minute"")
}

model WorkflowReminder {
  id              Int             @id @default(autoincrement())
  bookingUid      String?
  booking         Booking?        @relation(fields: [bookingUid], references: [uid])
  method          WorkflowMethods
  scheduledDate   DateTime
  referenceId     String?         @unique
  scheduled       Boolean
  wo
---
[Medium] chunk lines 841-860 in packages/prisma/schema.prisma:
  teamId      Int?
  team        Team?  @relation(fields: [teamId], references: [id], onDelete: Cascade)
  phoneNumber String

  @@index([userId])
  @@index([teamId])
}

model Feature {
  // The feature slug, ex: 'v2-workflows'
  slug        String       @id @unique
  // If the feature is currently enabled
  enabled     Boolean      @default(false)
  // A short description of the feature
  description String?
  // The type of feature flag
  type        FeatureType? @default(RELEASE)
  // If the 
---
[Medium] chunk lines 281-300 in packages/prisma/schema.prisma:
  inviteTokens        VerificationToken[]
  webhooks            Webhook[]
  timeFormat          Int?
  timeZone            String                  @default(""Europe/London"")
  weekStart           String                  @default(""Sunday"")
  routingForms        App_RoutingForms_Form[]
  apiKeys             ApiKey[]
  credentials         Credential[]

  @@unique([slug, parentId])
}

enum MembershipRole {
  MEMBER
  ADMIN
  OWNER
}

model Membership {
  id                   Int            @id @defau
---
[Medium] chunk lines 301-320 in packages/prisma/schema.prisma:
  teamId               Int
  userId               Int
  accepted             Boolean        @default(false)
  role                 MembershipRole
  team                 Team           @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user                 User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  disableImpersonation Boolean        @default(false)

  @@unique([userId, teamId])
  @@index([teamId])
  @@index([userId])
}

model VerificationTok
---
[Medium] chunk lines 381-400 in packages/prisma/schema.prisma:
  customInputs          Json?
  /// @zod.custom(imports.bookingResponses)
  responses             Json?
  startTime             DateTime
  endTime               DateTime
  attendees             Attendee[]
  location              String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime?
  status                BookingStatus        @default(ACCEPTED)
  paid                  Boolean              @default(false)
  payment               Payment[]
  destina","ErrorCode (Critical), providers (Critical), buildUser (Critical), user (Critical), TwoFactor (High), DisableTwoFactorValues (High), SetupStep (Medium), TwoFactor (Medium), PasswordField (Medium), LoginValues (Medium), Login (Medium), EnableTwoFactorModal (Medium), handler (Medium), DisableTwoFactorAuthModal (Medium), TwoFactorAuthAPI (Medium), handler (Medium), lines 361-380 (Medium), lines 321-340 (Medium), lines 821-840 (Medium), lines 681-700 (Medium), lines 741-760 (Medium), lines 701-720 (Medium), lines 561-580 (Medium), lines 241-260 (Medium), lines 661-680 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 521-540 (Medium), lines 621-640 (Medium), lines 261-280 (Medium), lines 861-880 (Medium), lines 541-560 (Medium), lines 201-220 (Medium), lines 481-500 (Medium), lines 341-360 (Medium), lines 601-620 (Medium), lines 581-600 (Medium), lines 721-740 (Medium), lines 761-780 (Medium), lines 801-820 (Medium), lines 881-900 (Medium), lines 781-800 (Medium), lines 841-860 (Medium), lines 281-300 (Medium), lines 301-320 (Medium), lines 381-400 (Medium), lines 901-908 (Low), backup_code (Low), backup_codes (Low), backup_code_instructions (Low), backup_codes_copied (Low), incorrect_backup_code (Low), lost_access (Low), missing_backup_codes (Low), lines 1-2 (Low), lines 501-520 (Low), lines 221-240 (Low), lines 641-660 (Low)",match,'disable' matches HC entity 'disabletwofactorvalues'
cal_dot_com,3,feat: 2fa backup codes,"Backup code validation is case-sensitive due to the use of indexOf(). This causes validation to fail if a user enters uppercase hex characters, as backup codes should be case-insensitive for a better user experience.",Medium,60,6,42,"enum::ErrorCode (packages/features/auth/lib/ErrorCode.ts) [Critical, score=1.00] | variable::providers (packages/features/auth/lib/next-auth-options.ts) [Critical, score=1.00] | variable::buildUser (packages/lib/test/builder.ts) [Critical, score=0.73] | variable::user (apps/web/playwright/login.2fa.e2e.ts) [Critical, score=0.73] | function::TwoFactor (apps/web/components/auth/BackupCode.tsx) [High, score=0.67] | interface::DisableTwoFactorValues (apps/web/components/settings/DisableTwoFactorModal.tsx) [High, score=0.53]","[Critical] enum ErrorCode in packages/features/auth/lib/ErrorCode.ts:
enum ErrorCode {
  IncorrectEmailPassword = ""incorrect-email-password"",
  UserNotFound = ""user-not-found"",
  IncorrectPassword = ""incorrect-password"",
  UserMissingPassword = ""missing-password"",
  TwoFactorDisabled = ""two-factor-disabled"",
  TwoFactorAlreadyEnabled = ""two-factor-already-enabled"",
  TwoFactorSetupRequired = ""two-factor-setup-required"",
  SecondFactorRequired = ""second-factor-required"",
  IncorrectTwoFactorCode = ""incorrect-two-factor-code"",
  IncorrectBackupCode = ""incorrect-backup-code"",
  MissingBackupCodes = ""missing-backup-codes"",
  IncorrectEmailVerificationCode = ""incorrect_email_verification_code"",
  InternalServerError = ""internal-server-error"",
  NewPasswordMatchesOld = ""new-password-matches-old"",
  ThirdPartyIdentityProviderEnabled = ""third-party-identity-provider
---
[Critical] variable providers in packages/features/auth/lib/next-auth-options.ts:
const providers: Provider[] = [
  CredentialsProvider({
    id: ""credentials"",
    name: ""Cal.com"",
    type: ""credentials"",
    credentials: {
      email: { label: ""Email Address"", type: ""email"", placeholder: ""john.doe@example.com"" },
      password: { label: ""Password"", type: ""password"", placeholder: ""Your super secure password"" },
      totpCode: { label: ""Two-factor Code"", type: ""input"", placeholder: ""Code from authenticator app"" },
      backupCode: { label: ""Backup Code"", type: ""input"", placeholder: ""Two-factor backup code"" },
    },
    async authorize(credentials) {
      if (!credentials) {
        console.error(`For some reason credentials are missing`);
        throw new Error(ErrorCode.InternalServerError);
      }

      const user = await prisma.user.findUnique({
        whe
---
[Critical] variable buildUser in packages/lib/test/builder.ts:
const buildUser = <T extends Partial<UserPayload>>(user?: T): UserPayload => {
  return {
    name: faker.name.firstName(),
    email: faker.internet.email(),
    timeZone: faker.address.timeZone(),
    username: faker.internet.userName(),
    id: 0,
    allowDynamicBooking: true,
    availability: [],
    avatar: """",
    away: false,
    backupCodes: null,
    bio: null,
    brandColor: ""#292929"",
    bufferTime: 0,
    completedOnboarding: false,
    createdDate: new Date(),
    credentials: [],
    darkBrandColor: ""#fafafa"",
    defaultScheduleId: null,
    destinationCalendar: null,
    disableImpersonation: false,
    emailVerified: null,
    endTime: 0,
    hideBranding: true,
    identityProvider: ""CAL"",
    identityProviderId: null,
    invitedTo: null,
    locale: ""en"",
    metada
---
[Critical] variable user in apps/web/playwright/login.2fa.e2e.ts:
const user = await test.step(""Enable 2FA"", async () => {
      const user = await users.create();
      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
      const userPassword = user.username!;
      await user.login();

      // expects the home page for an authorized user
      await page.goto(""/settings/security/two-factor-auth"");
      await page.click(`[data-testid=two-factor-switch][data-state=""unchecked""]`);
      await page.fill('input[name=""password""]', userPassword);
      await page.press('input[name=""password""]', ""Enter"");
      const secret = await page.locator(`[data-testid=two-factor-secret]`).textContent();
      expect(secret).toHaveLength(32);
      await page.click('[data-testid=""goto-otp-screen""]');

      // eslint-disable-next-line @typescript-es
---
[High] function TwoFactor in apps/web/components/auth/BackupCode.tsx:
function TwoFactor({ center = true }) {
  const { t } = useLocale();
  const methods = useFormContext();

  return (
    <div className={center ? ""mx-auto !mt-0 max-w-sm"" : ""!mt-0 max-w-sm""}>
      <Label className=""mt-4"">{t(""backup_code"")}</Label>

      <p className=""text-subtle mb-4 text-sm"">{t(""backup_code_instructions"")}</p>

      <TextField
        id=""backup-code""
        label=""""
        defaultValue=""""
        placeholder=""XXXXX-XXXXX""
        minLength={10} // without dash
        maxLength={11} // with dash
        required
        {...methods.register(""backupCode"")}
      />
    </div>
  );
}
---
[High] interface DisableTwoFactorValues in apps/web/components/settings/DisableTwoFactorModal.tsx:
interface DisableTwoFactorValues {
  backupCode: string;
  totpCode: string;
  password: string;
}","[Medium] enum SetupStep in apps/web/components/settings/EnableTwoFactorModal.tsx:
enum SetupStep {
  ConfirmPassword,
  DisplayBackupCodes,
  DisplayQrCode,
  EnterTotpCode,
}
---
[Medium] function TwoFactor in apps/web/components/auth/TwoFactor.tsx:
function TwoFactor({ center = true, autoFocus = true }) {
  const [value, onChange] = useState("""");
  const { t } = useLocale();
  const methods = useFormContext();

  const digits = useDigitInput({
    acceptedCharacters: /^[0-9]$/,
    length: 6,
    value,
    onChange,
  });

  useEffect(() => {
    if (value) methods.setValue(""totpCode"", value);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [value]);

  const className = ""h-12 w-12 !text-xl text-center"";

  return (
    <
---
[Medium] variable PasswordField in packages/ui/components/form/inputs/Input.tsx:
const PasswordField = forwardRef<HTMLInputElement, InputFieldProps>(function PasswordField(
  props,
  ref
) {
  const { t } = useLocale();
  const [isPasswordVisible, setIsPasswordVisible] = useState(false);
  const toggleIsPasswordVisible = useCallback(
    () => setIsPasswordVisible(!isPasswordVisible),
    [isPasswordVisible, setIsPasswordVisible]
  );
  const textLabel = isPasswordVisible ? t(""hide_password"") : t(""show_password"");

  return (
    <div className=""[&_.group:hover_.addon-wrapp
---
[Medium] interface LoginValues in apps/web/pages/auth/login.tsx:
interface LoginValues {
  email: string;
  password: string;
  totpCode: string;
  backupCode: string;
  csrfToken: string;
}
---
[Medium] function Login in apps/web/pages/auth/login.tsx:
function Login({
  csrfToken,
  isGoogleLoginEnabled,
  isSAMLLoginEnabled,
  samlTenantID,
  samlProductID,
  totpEmail,
}: inferSSRProps<typeof _getServerSideProps> & WithNonceProps) {
  const searchParams = useSearchParams();
  const { t } = useLocale();
  const router = useRouter();
  const formSchema = z
    .object({
      email: z
        .string()
        .min(1, `${t(""error_required_field"")}`)
        .email(`${t(""enter_valid_email"")}`),
      password: !!totpEmail ? z.literal("""") : z.s
---
[Medium] variable EnableTwoFactorModal in apps/web/components/settings/EnableTwoFactorModal.tsx:
const EnableTwoFactorModal = ({ onEnable, onCancel, open, onOpenChange }: EnableTwoFactorModalProps) => {
  const { t } = useLocale();
  const form = useForm<EnableTwoFactorValues>();

  const setupDescriptions = {
    [SetupStep.ConfirmPassword]: t(""2fa_confirm_current_password""),
    [SetupStep.DisplayBackupCodes]: t(""backup_code_instructions""),
    [SetupStep.DisplayQrCode]: t(""2fa_scan_image_or_use_code""),
    [SetupStep.EnterTotpCode]: t(""2fa_enter_six_digit_code""),
  };
  const [step, setS
---
[Medium] function handler in apps/web/pages/api/auth/two-factor/totp/setup.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== ""POST"") {
    return res.status(405).json({ message: ""Method not allowed"" });
  }

  const session = await getServerSession({ req, res });
  if (!session) {
    return res.status(401).json({ message: ""Not authenticated"" });
  }

  if (!session.user?.id) {
    console.error(""Session is missing a user id."");
    return res.status(500).json({ error: ErrorCode.InternalServerError });
  }

  const user = await pr
---
[Medium] variable DisableTwoFactorAuthModal in apps/web/components/settings/DisableTwoFactorModal.tsx:
const DisableTwoFactorAuthModal = ({
  onDisable,
  onCancel,
  disablePassword,
  open,
  onOpenChange,
}: DisableTwoFactorAuthModalProps) => {
  const [isDisabling, setIsDisabling] = useState(false);
  const [errorMessage, setErrorMessage] = useState<string | null>(null);
  const [twoFactorLostAccess, setTwoFactorLostAccess] = useState(false);
  const { t } = useLocale();

  const form = useForm<DisableTwoFactorValues>();

  const resetForm = (clearPassword = true) => {
    if (clearPassword) 
---
[Medium] variable TwoFactorAuthAPI in apps/web/components/settings/TwoFactorAuthAPI.ts:
const TwoFactorAuthAPI = {
  async setup(password: string) {
    return fetch(""/api/auth/two-factor/totp/setup"", {
      method: ""POST"",
      body: JSON.stringify({ password }),
      headers: {
        ""Content-Type"": ""application/json"",
      },
    });
  },

  async enable(code: string) {
    return fetch(""/api/auth/two-factor/totp/enable"", {
      method: ""POST"",
      body: JSON.stringify({ code }),
      headers: {
        ""Content-Type"": ""application/json"",
      },
    });
  },

  async
---
[Medium] function handler in apps/web/pages/api/auth/two-factor/totp/disable.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== ""POST"") {
    return res.status(405).json({ message: ""Method not allowed"" });
  }

  const session = await getServerSession({ req, res });
  if (!session) {
    return res.status(401).json({ message: ""Not authenticated"" });
  }

  if (!session.user?.id) {
    console.error(""Session is missing a user id."");
    return res.status(500).json({ error: ErrorCode.InternalServerError });
  }

  const user = await pr
---
[Medium] chunk lines 361-380 in packages/prisma/schema.prisma:
  @@index([bookingId])
}

enum BookingStatus {
  CANCELLED @map(""cancelled"")
  ACCEPTED  @map(""accepted"")
  REJECTED  @map(""rejected"")
  PENDING   @map(""pending"")
}

model Booking {
  id                    Int                  @id @default(autoincrement())
  uid                   String               @unique
  user                  User?                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                Int?
  references            BookingReference[]
  eventT
---
[Medium] chunk lines 321-340 in packages/prisma/schema.prisma:
  updatedAt     DateTime @updatedAt
  teamId        Int?
  team          Team?    @relation(fields: [teamId], references: [id])

  @@unique([identifier, token])
  @@index([token])
}

model BookingReference {
  id                 Int      @id @default(autoincrement())
  /// @zod.min(1)
  type               String
  /// @zod.min(1)
  uid                String
  meetingId          String?
  meetingPassword    String?
  meetingUrl         String?
  booking            Booking? @relation(fields: [book
---
[Medium] chunk lines 821-840 in packages/prisma/schema.prisma:
  WHATSAPP
}

model BookingSeat {
  id           Int      @id @default(autoincrement())
  referenceUid String   @unique
  bookingId    Int
  booking      Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  attendeeId   Int      @unique
  attendee     Attendee @relation(fields: [attendeeId], references: [id], onDelete: Cascade)
  data         Json?

  @@index([bookingId])
  @@index([attendeeId])
}

model VerifiedNumber {
  id          Int    @id @default(autoincrement()
---
[Medium] chunk lines 681-700 in packages/prisma/schema.prisma:
  @@index([userId])
  @@index([disabled])
}

model App_RoutingForms_FormResponse {
  id           Int                   @id @default(autoincrement())
  formFillerId String                @default(cuid())
  form         App_RoutingForms_Form @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId       String
  response     Json
  createdAt    DateTime              @default(now())

  @@unique([formFillerId, formId])
  @@index([formFillerId])
  @@index([formId])
}

model Feedback
---
[Medium] chunk lines 741-760 in packages/prisma/schema.prisma:
  numberVerificationPending Boolean            @default(true)
  includeCalendarEvent      Boolean            @default(false)

  @@index([workflowId])
}

model Workflow {
  id       Int                     @id @default(autoincrement())
  name     String
  userId   Int?
  user     User?                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  team     Team?                   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId   Int?
  activeOn Work
---
[Medium] chunk lines 701-720 in packages/prisma/schema.prisma:
  userId  Int
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  rating  String
  comment String?

  @@index([userId])
  @@index([rating])
}

enum WorkflowTriggerEvents {
  BEFORE_EVENT
  EVENT_CANCELLED
  NEW_EVENT
  AFTER_EVENT
  RESCHEDULE_EVENT
}

enum WorkflowActions {
  EMAIL_HOST
  EMAIL_ATTENDEE
---
[Medium] chunk lines 561-580 in packages/prisma/schema.prisma:
  @@unique([userId, subscriberUrl], name: ""courseIdentifier"")
}

model Impersonations {
  id                 Int      @id @default(autoincrement())
  createdAt          DateTime @default(now())
  impersonatedUser   User     @relation(""impersonated_user"", fields: [impersonatedUserId], references: [id], onDelete: Cascade)
  impersonatedBy     User     @relation(""impersonated_by_user"", fields: [impersonatedById], references: [id], onDelete: Cascade)
  impersonatedUserId Int
  impersonatedById   Int
---
[Medium] chunk lines 241-260 in packages/prisma/schema.prisma:
  //linkedByUserId       Int?
  //linkedBy             User?                   @relation(""linked_account"", fields: [linkedByUserId], references: [id], onDelete: Cascade)
  //linkedUsers          User[]                  @relation(""linked_account"")*/

  @@unique([email])
  @@unique([email, username])
  @@unique([username, organizationId])
  @@index([emailVerified])
  @@index([identityProvider])
  @@index([identityProviderId])
  @@map(name: ""users"")
}

model Team {
  id                  Int        
---
[Medium] chunk lines 661-680 in packages/prisma/schema.prisma:

model App_RoutingForms_Form {
  id          String                          @id @default(cuid())
  description String?
  routes      Json?
  createdAt   DateTime                        @default(now())
  updatedAt   DateTime                        @updatedAt
  name        String
  fields      Json?
  user        User                            @relation(""routing-form"", fields: [userId], references: [id], onDelete: Cascade)
  // This is the user who created the form and also the user who has read
---
[Medium] chunk lines 401-420 in packages/prisma/schema.prisma:
  recurringEventId      String?
  smsReminderNumber     String?
  workflowReminders     WorkflowReminder[]
  scheduledJobs         String[]
  seatsReferences       BookingSeat[]
  /// @zod.custom(imports.bookingMetadataSchema)
  metadata              Json?
  isRecorded            Boolean              @default(false)

  @@index([eventTypeId])
  @@index([userId])
  @@index([destinationCalendarId])
  @@index([recurringEventId])
  @@index([uid])
  @@index([status])
}

model Schedule {
  id          
---
[Medium] chunk lines 421-440 in packages/prisma/schema.prisma:
  userId       Int
  eventType    EventType[]
  name         String
  timeZone     String?
  availability Availability[]

  @@index([userId])
}

model Availability {
  id          Int        @id @default(autoincrement())
  user        User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int?
  eventType   EventType? @relation(fields: [eventTypeId], references: [id])
  eventTypeId Int?
  days        Int[]
  startTime   DateTime   @db.Time
  endTime     DateTim
---
[Medium] chunk lines 441-460 in packages/prisma/schema.prisma:
  scheduleId  Int?

  @@index([userId])
  @@index([eventTypeId])
  @@index([scheduleId])
}

model SelectedCalendar {
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  integration String
  externalId  String

  @@id([userId, integration, externalId])
  @@index([userId])
  @@index([integration])
  @@index([externalId])
}

enum EventTypeCustomInputType {
---
[Medium] chunk lines 461-480 in packages/prisma/schema.prisma:
  TEXT     @map(""text"")
  TEXTLONG @map(""textLong"")
  NUMBER   @map(""number"")
  BOOL     @map(""bool"")
  RADIO    @map(""radio"")
  PHONE    @map(""phone"")
}

model EventTypeCustomInput {
  id          Int                      @id @default(autoincrement())
  eventTypeId Int
  eventType   EventType                @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  label       String
  type        EventTypeCustomInputType
  /// @zod.custom(imports.customInputOptionSchema)
  options
---
[Medium] chunk lines 521-540 in packages/prisma/schema.prisma:

  @@index([bookingId])
  @@index([externalId])
}

enum PaymentOption {
  ON_BOOKING
  HOLD
}

enum WebhookTriggerEvents {
  BOOKING_CREATED
  BOOKING_PAID
  BOOKING_RESCHEDULED
  BOOKING_REQUESTED
  BOOKING_CANCELLED
  BOOKING_REJECTED
  FORM_SUBMITTED
  MEETING_ENDED
  RECORDING_READY
---
[Medium] chunk lines 621-640 in packages/prisma/schema.prisma:
  userId       Int
  expires      DateTime
  user         User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum AppCategories {
  calendar
  messaging
  other
  payment
  video // deprecated, please use 'conferencing' instead
  web3 // deprecated, we should no longer have any web3 apps
  automation
  analytics
  // Wherever video is in use, conferencing should also be used for legacy apps can have it.
  conferencing
  crm
}
---
[Medium] chunk lines 261-280 in packages/prisma/schema.prisma:
  appLogo             String?
  appIconLogo         String?
  bio                 String?
  hideBranding        Boolean                 @default(false)
  isPrivate           Boolean                 @default(false)
  hideBookATeamMember Boolean                 @default(false)
  members             Membership[]
  eventTypes          EventType[]
  workflows           Workflow[]
  createdAt           DateTime                @default(now())
  /// @zod.custom(imports.teamMetadataSchema)
  metadata    
---
[Medium] chunk lines 861-880 in packages/prisma/schema.prisma:
  createdAt   DateTime?    @default(now())
  updatedAt   DateTime?    @default(now()) @updatedAt
  updatedBy   Int?

  @@index([enabled])
  @@index([stale])
}

enum FeatureType {
  RELEASE
  EXPERIMENT
  OPERATIONAL
  KILL_SWITCH
  PERMISSION
}

model SelectedSlots {
  id               Int      @id @default(autoincrement())
  eventTypeId      Int
  userId           Int
---
[Medium] chunk lines 541-560 in packages/prisma/schema.prisma:
}

model Webhook {
  id              String                 @id @unique
  userId          Int?
  teamId          Int?
  eventTypeId     Int?
  /// @zod.url()
  subscriberUrl   String
  payloadTemplate String?
  createdAt       DateTime               @default(now())
  active          Boolean                @default(true)
  eventTriggers   WebhookTriggerEvents[]
  user            User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  team            Team?        
---
[Medium] chunk lines 201-220 in packages/prisma/schema.prisma:
  locale              String?
  timeFormat          Int?                 @default(12)
  twoFactorSecret     String?
  twoFactorEnabled    Boolean              @default(false)
  backupCodes         String?
  identityProvider    IdentityProvider     @default(CAL)
  identityProviderId  String?
  availability        Availability[]
  invitedTo           Int?
  webhooks            Webhook[]
  brandColor          String               @default(""#292929"")
  darkBrandColor      String               @defau
---
[Medium] chunk lines 481-500 in packages/prisma/schema.prisma:
}

model ResetPasswordRequest {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String
  expires   DateTime
}

enum ReminderType {
  PENDING_BOOKING_CONFIRMATION
}

model ReminderMail {
  id             Int          @id @default(autoincrement())
  referenceId    Int
  reminderType   ReminderType
  elapsedMinutes Int
  createdAt      DateTime     @default(now())
---
[Medium] chunk lines 341-360 in packages/prisma/schema.prisma:
  deleted            Boolean?
  credentialId       Int?

  @@index([bookingId])
  @@index([credentialId])
  @@index([type])
  @@index([uid])
}

model Attendee {
  id          Int          @id @default(autoincrement())
  email       String
  name        String
  timeZone    String
  locale      String?      @default(""en"")
  booking     Booking?     @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId   Int?
  bookingSeat BookingSeat?

  @@index([email])
---
[Medium] chunk lines 601-620 in packages/prisma/schema.prisma:
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@index([type])
}

model Session {
  id           String   @id @default(cuid())
  
---
[Medium] chunk lines 581-600 in packages/prisma/schema.prisma:
  hashedKey  String    @unique()
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  team       Team?     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  app        App?      @relation(fields: [appId], references: [slug], onDelete: Cascade)
  appId      String?

  @@index([userId])
}

model HashedLink {
  id          Int       @id @default(autoincrement())
  link        String    @unique()
  eventType   EventType @relation(fields: [eventTy
---
[Medium] chunk lines 721-740 in packages/prisma/schema.prisma:
  SMS_ATTENDEE
  SMS_NUMBER
  EMAIL_ADDRESS
  WHATSAPP_ATTENDEE
  WHATSAPP_NUMBER
}

model WorkflowStep {
  id                        Int                @id @default(autoincrement())
  stepNumber                Int
  action                    WorkflowActions
  workflowId                Int
  workflow                  Workflow           @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  sendTo                    String?
  reminderBody              String?
  emailSubject       
---
[Medium] chunk lines 761-780 in packages/prisma/schema.prisma:
  @@index([teamId])
}

model WorkflowsOnEventTypes {
  id          Int       @id @default(autoincrement())
  workflow    Workflow  @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  workflowId  Int
  eventType   EventType @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  eventTypeId Int

  @@unique([workflowId, eventTypeId])
  @@index([workflowId])
  @@index([eventTypeId])
}

model Deployment {
  /// This is a single row table, so we use a fixed id
  id 
---
[Medium] chunk lines 801-820 in packages/prisma/schema.prisma:
  workflowStep    WorkflowStep?   @relation(fields: [workflowStepId], references: [id])
  cancelled       Boolean?
  seatReferenceId String?

  @@index([bookingUid])
  @@index([workflowStepId])
  @@index([seatReferenceId])
}

enum WorkflowTemplates {
  REMINDER
  CUSTOM
  CANCELLED
  RESCHEDULED
  COMPLETED
}

enum WorkflowMethods {
  EMAIL
  SMS
---
[Medium] chunk lines 881-900 in packages/prisma/schema.prisma:
  slotUtcStartDate DateTime
  slotUtcEndDate   DateTime
  uid              String
  releaseAt        DateTime
  isSeat           Boolean  @default(false)

  @@unique(fields: [userId, slotUtcStartDate, slotUtcEndDate, uid], name: ""selectedSlotUnique"")
}

view BookingTimeStatus {
  id            Int            @unique
  uid           String?
  eventTypeId   Int?
  title         String?
  description   String?
  startTime     DateTime?
  endTime       DateTime?
  createdAt     DateTime?
  location 
---
[Medium] chunk lines 781-800 in packages/prisma/schema.prisma:
  theme           Json?
  licenseKey      String?
  agreedLicenseAt DateTime?
}

enum TimeUnit {
  DAY    @map(""day"")
  HOUR   @map(""hour"")
  MINUTE @map(""minute"")
}

model WorkflowReminder {
  id              Int             @id @default(autoincrement())
  bookingUid      String?
  booking         Booking?        @relation(fields: [bookingUid], references: [uid])
  method          WorkflowMethods
  scheduledDate   DateTime
  referenceId     String?         @unique
  scheduled       Boolean
  wo
---
[Medium] chunk lines 841-860 in packages/prisma/schema.prisma:
  teamId      Int?
  team        Team?  @relation(fields: [teamId], references: [id], onDelete: Cascade)
  phoneNumber String

  @@index([userId])
  @@index([teamId])
}

model Feature {
  // The feature slug, ex: 'v2-workflows'
  slug        String       @id @unique
  // If the feature is currently enabled
  enabled     Boolean      @default(false)
  // A short description of the feature
  description String?
  // The type of feature flag
  type        FeatureType? @default(RELEASE)
  // If the 
---
[Medium] chunk lines 281-300 in packages/prisma/schema.prisma:
  inviteTokens        VerificationToken[]
  webhooks            Webhook[]
  timeFormat          Int?
  timeZone            String                  @default(""Europe/London"")
  weekStart           String                  @default(""Sunday"")
  routingForms        App_RoutingForms_Form[]
  apiKeys             ApiKey[]
  credentials         Credential[]

  @@unique([slug, parentId])
}

enum MembershipRole {
  MEMBER
  ADMIN
  OWNER
}

model Membership {
  id                   Int            @id @defau
---
[Medium] chunk lines 301-320 in packages/prisma/schema.prisma:
  teamId               Int
  userId               Int
  accepted             Boolean        @default(false)
  role                 MembershipRole
  team                 Team           @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user                 User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  disableImpersonation Boolean        @default(false)

  @@unique([userId, teamId])
  @@index([teamId])
  @@index([userId])
}

model VerificationTok
---
[Medium] chunk lines 381-400 in packages/prisma/schema.prisma:
  customInputs          Json?
  /// @zod.custom(imports.bookingResponses)
  responses             Json?
  startTime             DateTime
  endTime               DateTime
  attendees             Attendee[]
  location              String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime?
  status                BookingStatus        @default(ACCEPTED)
  paid                  Boolean              @default(false)
  payment               Payment[]
  destina","ErrorCode (Critical), providers (Critical), buildUser (Critical), user (Critical), TwoFactor (High), DisableTwoFactorValues (High), SetupStep (Medium), TwoFactor (Medium), PasswordField (Medium), LoginValues (Medium), Login (Medium), EnableTwoFactorModal (Medium), handler (Medium), DisableTwoFactorAuthModal (Medium), TwoFactorAuthAPI (Medium), handler (Medium), lines 361-380 (Medium), lines 321-340 (Medium), lines 821-840 (Medium), lines 681-700 (Medium), lines 741-760 (Medium), lines 701-720 (Medium), lines 561-580 (Medium), lines 241-260 (Medium), lines 661-680 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 521-540 (Medium), lines 621-640 (Medium), lines 261-280 (Medium), lines 861-880 (Medium), lines 541-560 (Medium), lines 201-220 (Medium), lines 481-500 (Medium), lines 341-360 (Medium), lines 601-620 (Medium), lines 581-600 (Medium), lines 721-740 (Medium), lines 761-780 (Medium), lines 801-820 (Medium), lines 881-900 (Medium), lines 781-800 (Medium), lines 841-860 (Medium), lines 281-300 (Medium), lines 301-320 (Medium), lines 381-400 (Medium), lines 901-908 (Low), backup_code (Low), backup_codes (Low), backup_code_instructions (Low), backup_codes_copied (Low), incorrect_backup_code (Low), lost_access (Low), missing_backup_codes (Low), lines 1-2 (Low), lines 501-520 (Low), lines 221-240 (Low), lines 641-660 (Low)",match,'user' matches HC entity 'user'
cal_dot_com,3,feat: 2fa backup codes,"Because backupCodes are decrypted and mutated in memory before being written back, two concurrent login requests using the same backupCode could both pass this check and update, so a single backup code may effectively be accepted more than once if used concurrently, weakening the intended one-time-use semantics.",High,60,6,42,"enum::ErrorCode (packages/features/auth/lib/ErrorCode.ts) [Critical, score=1.00] | variable::providers (packages/features/auth/lib/next-auth-options.ts) [Critical, score=1.00] | variable::buildUser (packages/lib/test/builder.ts) [Critical, score=0.73] | variable::user (apps/web/playwright/login.2fa.e2e.ts) [Critical, score=0.73] | function::TwoFactor (apps/web/components/auth/BackupCode.tsx) [High, score=0.67] | interface::DisableTwoFactorValues (apps/web/components/settings/DisableTwoFactorModal.tsx) [High, score=0.53]","[Critical] enum ErrorCode in packages/features/auth/lib/ErrorCode.ts:
enum ErrorCode {
  IncorrectEmailPassword = ""incorrect-email-password"",
  UserNotFound = ""user-not-found"",
  IncorrectPassword = ""incorrect-password"",
  UserMissingPassword = ""missing-password"",
  TwoFactorDisabled = ""two-factor-disabled"",
  TwoFactorAlreadyEnabled = ""two-factor-already-enabled"",
  TwoFactorSetupRequired = ""two-factor-setup-required"",
  SecondFactorRequired = ""second-factor-required"",
  IncorrectTwoFactorCode = ""incorrect-two-factor-code"",
  IncorrectBackupCode = ""incorrect-backup-code"",
  MissingBackupCodes = ""missing-backup-codes"",
  IncorrectEmailVerificationCode = ""incorrect_email_verification_code"",
  InternalServerError = ""internal-server-error"",
  NewPasswordMatchesOld = ""new-password-matches-old"",
  ThirdPartyIdentityProviderEnabled = ""third-party-identity-provider
---
[Critical] variable providers in packages/features/auth/lib/next-auth-options.ts:
const providers: Provider[] = [
  CredentialsProvider({
    id: ""credentials"",
    name: ""Cal.com"",
    type: ""credentials"",
    credentials: {
      email: { label: ""Email Address"", type: ""email"", placeholder: ""john.doe@example.com"" },
      password: { label: ""Password"", type: ""password"", placeholder: ""Your super secure password"" },
      totpCode: { label: ""Two-factor Code"", type: ""input"", placeholder: ""Code from authenticator app"" },
      backupCode: { label: ""Backup Code"", type: ""input"", placeholder: ""Two-factor backup code"" },
    },
    async authorize(credentials) {
      if (!credentials) {
        console.error(`For some reason credentials are missing`);
        throw new Error(ErrorCode.InternalServerError);
      }

      const user = await prisma.user.findUnique({
        whe
---
[Critical] variable buildUser in packages/lib/test/builder.ts:
const buildUser = <T extends Partial<UserPayload>>(user?: T): UserPayload => {
  return {
    name: faker.name.firstName(),
    email: faker.internet.email(),
    timeZone: faker.address.timeZone(),
    username: faker.internet.userName(),
    id: 0,
    allowDynamicBooking: true,
    availability: [],
    avatar: """",
    away: false,
    backupCodes: null,
    bio: null,
    brandColor: ""#292929"",
    bufferTime: 0,
    completedOnboarding: false,
    createdDate: new Date(),
    credentials: [],
    darkBrandColor: ""#fafafa"",
    defaultScheduleId: null,
    destinationCalendar: null,
    disableImpersonation: false,
    emailVerified: null,
    endTime: 0,
    hideBranding: true,
    identityProvider: ""CAL"",
    identityProviderId: null,
    invitedTo: null,
    locale: ""en"",
    metada
---
[Critical] variable user in apps/web/playwright/login.2fa.e2e.ts:
const user = await test.step(""Enable 2FA"", async () => {
      const user = await users.create();
      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
      const userPassword = user.username!;
      await user.login();

      // expects the home page for an authorized user
      await page.goto(""/settings/security/two-factor-auth"");
      await page.click(`[data-testid=two-factor-switch][data-state=""unchecked""]`);
      await page.fill('input[name=""password""]', userPassword);
      await page.press('input[name=""password""]', ""Enter"");
      const secret = await page.locator(`[data-testid=two-factor-secret]`).textContent();
      expect(secret).toHaveLength(32);
      await page.click('[data-testid=""goto-otp-screen""]');

      // eslint-disable-next-line @typescript-es
---
[High] function TwoFactor in apps/web/components/auth/BackupCode.tsx:
function TwoFactor({ center = true }) {
  const { t } = useLocale();
  const methods = useFormContext();

  return (
    <div className={center ? ""mx-auto !mt-0 max-w-sm"" : ""!mt-0 max-w-sm""}>
      <Label className=""mt-4"">{t(""backup_code"")}</Label>

      <p className=""text-subtle mb-4 text-sm"">{t(""backup_code_instructions"")}</p>

      <TextField
        id=""backup-code""
        label=""""
        defaultValue=""""
        placeholder=""XXXXX-XXXXX""
        minLength={10} // without dash
        maxLength={11} // with dash
        required
        {...methods.register(""backupCode"")}
      />
    </div>
  );
}
---
[High] interface DisableTwoFactorValues in apps/web/components/settings/DisableTwoFactorModal.tsx:
interface DisableTwoFactorValues {
  backupCode: string;
  totpCode: string;
  password: string;
}","[Medium] enum SetupStep in apps/web/components/settings/EnableTwoFactorModal.tsx:
enum SetupStep {
  ConfirmPassword,
  DisplayBackupCodes,
  DisplayQrCode,
  EnterTotpCode,
}
---
[Medium] function TwoFactor in apps/web/components/auth/TwoFactor.tsx:
function TwoFactor({ center = true, autoFocus = true }) {
  const [value, onChange] = useState("""");
  const { t } = useLocale();
  const methods = useFormContext();

  const digits = useDigitInput({
    acceptedCharacters: /^[0-9]$/,
    length: 6,
    value,
    onChange,
  });

  useEffect(() => {
    if (value) methods.setValue(""totpCode"", value);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [value]);

  const className = ""h-12 w-12 !text-xl text-center"";

  return (
    <
---
[Medium] variable PasswordField in packages/ui/components/form/inputs/Input.tsx:
const PasswordField = forwardRef<HTMLInputElement, InputFieldProps>(function PasswordField(
  props,
  ref
) {
  const { t } = useLocale();
  const [isPasswordVisible, setIsPasswordVisible] = useState(false);
  const toggleIsPasswordVisible = useCallback(
    () => setIsPasswordVisible(!isPasswordVisible),
    [isPasswordVisible, setIsPasswordVisible]
  );
  const textLabel = isPasswordVisible ? t(""hide_password"") : t(""show_password"");

  return (
    <div className=""[&_.group:hover_.addon-wrapp
---
[Medium] interface LoginValues in apps/web/pages/auth/login.tsx:
interface LoginValues {
  email: string;
  password: string;
  totpCode: string;
  backupCode: string;
  csrfToken: string;
}
---
[Medium] function Login in apps/web/pages/auth/login.tsx:
function Login({
  csrfToken,
  isGoogleLoginEnabled,
  isSAMLLoginEnabled,
  samlTenantID,
  samlProductID,
  totpEmail,
}: inferSSRProps<typeof _getServerSideProps> & WithNonceProps) {
  const searchParams = useSearchParams();
  const { t } = useLocale();
  const router = useRouter();
  const formSchema = z
    .object({
      email: z
        .string()
        .min(1, `${t(""error_required_field"")}`)
        .email(`${t(""enter_valid_email"")}`),
      password: !!totpEmail ? z.literal("""") : z.s
---
[Medium] variable EnableTwoFactorModal in apps/web/components/settings/EnableTwoFactorModal.tsx:
const EnableTwoFactorModal = ({ onEnable, onCancel, open, onOpenChange }: EnableTwoFactorModalProps) => {
  const { t } = useLocale();
  const form = useForm<EnableTwoFactorValues>();

  const setupDescriptions = {
    [SetupStep.ConfirmPassword]: t(""2fa_confirm_current_password""),
    [SetupStep.DisplayBackupCodes]: t(""backup_code_instructions""),
    [SetupStep.DisplayQrCode]: t(""2fa_scan_image_or_use_code""),
    [SetupStep.EnterTotpCode]: t(""2fa_enter_six_digit_code""),
  };
  const [step, setS
---
[Medium] function handler in apps/web/pages/api/auth/two-factor/totp/setup.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== ""POST"") {
    return res.status(405).json({ message: ""Method not allowed"" });
  }

  const session = await getServerSession({ req, res });
  if (!session) {
    return res.status(401).json({ message: ""Not authenticated"" });
  }

  if (!session.user?.id) {
    console.error(""Session is missing a user id."");
    return res.status(500).json({ error: ErrorCode.InternalServerError });
  }

  const user = await pr
---
[Medium] variable DisableTwoFactorAuthModal in apps/web/components/settings/DisableTwoFactorModal.tsx:
const DisableTwoFactorAuthModal = ({
  onDisable,
  onCancel,
  disablePassword,
  open,
  onOpenChange,
}: DisableTwoFactorAuthModalProps) => {
  const [isDisabling, setIsDisabling] = useState(false);
  const [errorMessage, setErrorMessage] = useState<string | null>(null);
  const [twoFactorLostAccess, setTwoFactorLostAccess] = useState(false);
  const { t } = useLocale();

  const form = useForm<DisableTwoFactorValues>();

  const resetForm = (clearPassword = true) => {
    if (clearPassword) 
---
[Medium] variable TwoFactorAuthAPI in apps/web/components/settings/TwoFactorAuthAPI.ts:
const TwoFactorAuthAPI = {
  async setup(password: string) {
    return fetch(""/api/auth/two-factor/totp/setup"", {
      method: ""POST"",
      body: JSON.stringify({ password }),
      headers: {
        ""Content-Type"": ""application/json"",
      },
    });
  },

  async enable(code: string) {
    return fetch(""/api/auth/two-factor/totp/enable"", {
      method: ""POST"",
      body: JSON.stringify({ code }),
      headers: {
        ""Content-Type"": ""application/json"",
      },
    });
  },

  async
---
[Medium] function handler in apps/web/pages/api/auth/two-factor/totp/disable.ts:
async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== ""POST"") {
    return res.status(405).json({ message: ""Method not allowed"" });
  }

  const session = await getServerSession({ req, res });
  if (!session) {
    return res.status(401).json({ message: ""Not authenticated"" });
  }

  if (!session.user?.id) {
    console.error(""Session is missing a user id."");
    return res.status(500).json({ error: ErrorCode.InternalServerError });
  }

  const user = await pr
---
[Medium] chunk lines 361-380 in packages/prisma/schema.prisma:
  @@index([bookingId])
}

enum BookingStatus {
  CANCELLED @map(""cancelled"")
  ACCEPTED  @map(""accepted"")
  REJECTED  @map(""rejected"")
  PENDING   @map(""pending"")
}

model Booking {
  id                    Int                  @id @default(autoincrement())
  uid                   String               @unique
  user                  User?                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                Int?
  references            BookingReference[]
  eventT
---
[Medium] chunk lines 321-340 in packages/prisma/schema.prisma:
  updatedAt     DateTime @updatedAt
  teamId        Int?
  team          Team?    @relation(fields: [teamId], references: [id])

  @@unique([identifier, token])
  @@index([token])
}

model BookingReference {
  id                 Int      @id @default(autoincrement())
  /// @zod.min(1)
  type               String
  /// @zod.min(1)
  uid                String
  meetingId          String?
  meetingPassword    String?
  meetingUrl         String?
  booking            Booking? @relation(fields: [book
---
[Medium] chunk lines 821-840 in packages/prisma/schema.prisma:
  WHATSAPP
}

model BookingSeat {
  id           Int      @id @default(autoincrement())
  referenceUid String   @unique
  bookingId    Int
  booking      Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  attendeeId   Int      @unique
  attendee     Attendee @relation(fields: [attendeeId], references: [id], onDelete: Cascade)
  data         Json?

  @@index([bookingId])
  @@index([attendeeId])
}

model VerifiedNumber {
  id          Int    @id @default(autoincrement()
---
[Medium] chunk lines 681-700 in packages/prisma/schema.prisma:
  @@index([userId])
  @@index([disabled])
}

model App_RoutingForms_FormResponse {
  id           Int                   @id @default(autoincrement())
  formFillerId String                @default(cuid())
  form         App_RoutingForms_Form @relation(fields: [formId], references: [id], onDelete: Cascade)
  formId       String
  response     Json
  createdAt    DateTime              @default(now())

  @@unique([formFillerId, formId])
  @@index([formFillerId])
  @@index([formId])
}

model Feedback
---
[Medium] chunk lines 741-760 in packages/prisma/schema.prisma:
  numberVerificationPending Boolean            @default(true)
  includeCalendarEvent      Boolean            @default(false)

  @@index([workflowId])
}

model Workflow {
  id       Int                     @id @default(autoincrement())
  name     String
  userId   Int?
  user     User?                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  team     Team?                   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId   Int?
  activeOn Work
---
[Medium] chunk lines 701-720 in packages/prisma/schema.prisma:
  userId  Int
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  rating  String
  comment String?

  @@index([userId])
  @@index([rating])
}

enum WorkflowTriggerEvents {
  BEFORE_EVENT
  EVENT_CANCELLED
  NEW_EVENT
  AFTER_EVENT
  RESCHEDULE_EVENT
}

enum WorkflowActions {
  EMAIL_HOST
  EMAIL_ATTENDEE
---
[Medium] chunk lines 561-580 in packages/prisma/schema.prisma:
  @@unique([userId, subscriberUrl], name: ""courseIdentifier"")
}

model Impersonations {
  id                 Int      @id @default(autoincrement())
  createdAt          DateTime @default(now())
  impersonatedUser   User     @relation(""impersonated_user"", fields: [impersonatedUserId], references: [id], onDelete: Cascade)
  impersonatedBy     User     @relation(""impersonated_by_user"", fields: [impersonatedById], references: [id], onDelete: Cascade)
  impersonatedUserId Int
  impersonatedById   Int
---
[Medium] chunk lines 241-260 in packages/prisma/schema.prisma:
  //linkedByUserId       Int?
  //linkedBy             User?                   @relation(""linked_account"", fields: [linkedByUserId], references: [id], onDelete: Cascade)
  //linkedUsers          User[]                  @relation(""linked_account"")*/

  @@unique([email])
  @@unique([email, username])
  @@unique([username, organizationId])
  @@index([emailVerified])
  @@index([identityProvider])
  @@index([identityProviderId])
  @@map(name: ""users"")
}

model Team {
  id                  Int        
---
[Medium] chunk lines 661-680 in packages/prisma/schema.prisma:

model App_RoutingForms_Form {
  id          String                          @id @default(cuid())
  description String?
  routes      Json?
  createdAt   DateTime                        @default(now())
  updatedAt   DateTime                        @updatedAt
  name        String
  fields      Json?
  user        User                            @relation(""routing-form"", fields: [userId], references: [id], onDelete: Cascade)
  // This is the user who created the form and also the user who has read
---
[Medium] chunk lines 401-420 in packages/prisma/schema.prisma:
  recurringEventId      String?
  smsReminderNumber     String?
  workflowReminders     WorkflowReminder[]
  scheduledJobs         String[]
  seatsReferences       BookingSeat[]
  /// @zod.custom(imports.bookingMetadataSchema)
  metadata              Json?
  isRecorded            Boolean              @default(false)

  @@index([eventTypeId])
  @@index([userId])
  @@index([destinationCalendarId])
  @@index([recurringEventId])
  @@index([uid])
  @@index([status])
}

model Schedule {
  id          
---
[Medium] chunk lines 421-440 in packages/prisma/schema.prisma:
  userId       Int
  eventType    EventType[]
  name         String
  timeZone     String?
  availability Availability[]

  @@index([userId])
}

model Availability {
  id          Int        @id @default(autoincrement())
  user        User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int?
  eventType   EventType? @relation(fields: [eventTypeId], references: [id])
  eventTypeId Int?
  days        Int[]
  startTime   DateTime   @db.Time
  endTime     DateTim
---
[Medium] chunk lines 441-460 in packages/prisma/schema.prisma:
  scheduleId  Int?

  @@index([userId])
  @@index([eventTypeId])
  @@index([scheduleId])
}

model SelectedCalendar {
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int
  integration String
  externalId  String

  @@id([userId, integration, externalId])
  @@index([userId])
  @@index([integration])
  @@index([externalId])
}

enum EventTypeCustomInputType {
---
[Medium] chunk lines 461-480 in packages/prisma/schema.prisma:
  TEXT     @map(""text"")
  TEXTLONG @map(""textLong"")
  NUMBER   @map(""number"")
  BOOL     @map(""bool"")
  RADIO    @map(""radio"")
  PHONE    @map(""phone"")
}

model EventTypeCustomInput {
  id          Int                      @id @default(autoincrement())
  eventTypeId Int
  eventType   EventType                @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  label       String
  type        EventTypeCustomInputType
  /// @zod.custom(imports.customInputOptionSchema)
  options
---
[Medium] chunk lines 521-540 in packages/prisma/schema.prisma:

  @@index([bookingId])
  @@index([externalId])
}

enum PaymentOption {
  ON_BOOKING
  HOLD
}

enum WebhookTriggerEvents {
  BOOKING_CREATED
  BOOKING_PAID
  BOOKING_RESCHEDULED
  BOOKING_REQUESTED
  BOOKING_CANCELLED
  BOOKING_REJECTED
  FORM_SUBMITTED
  MEETING_ENDED
  RECORDING_READY
---
[Medium] chunk lines 621-640 in packages/prisma/schema.prisma:
  userId       Int
  expires      DateTime
  user         User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum AppCategories {
  calendar
  messaging
  other
  payment
  video // deprecated, please use 'conferencing' instead
  web3 // deprecated, we should no longer have any web3 apps
  automation
  analytics
  // Wherever video is in use, conferencing should also be used for legacy apps can have it.
  conferencing
  crm
}
---
[Medium] chunk lines 261-280 in packages/prisma/schema.prisma:
  appLogo             String?
  appIconLogo         String?
  bio                 String?
  hideBranding        Boolean                 @default(false)
  isPrivate           Boolean                 @default(false)
  hideBookATeamMember Boolean                 @default(false)
  members             Membership[]
  eventTypes          EventType[]
  workflows           Workflow[]
  createdAt           DateTime                @default(now())
  /// @zod.custom(imports.teamMetadataSchema)
  metadata    
---
[Medium] chunk lines 861-880 in packages/prisma/schema.prisma:
  createdAt   DateTime?    @default(now())
  updatedAt   DateTime?    @default(now()) @updatedAt
  updatedBy   Int?

  @@index([enabled])
  @@index([stale])
}

enum FeatureType {
  RELEASE
  EXPERIMENT
  OPERATIONAL
  KILL_SWITCH
  PERMISSION
}

model SelectedSlots {
  id               Int      @id @default(autoincrement())
  eventTypeId      Int
  userId           Int
---
[Medium] chunk lines 541-560 in packages/prisma/schema.prisma:
}

model Webhook {
  id              String                 @id @unique
  userId          Int?
  teamId          Int?
  eventTypeId     Int?
  /// @zod.url()
  subscriberUrl   String
  payloadTemplate String?
  createdAt       DateTime               @default(now())
  active          Boolean                @default(true)
  eventTriggers   WebhookTriggerEvents[]
  user            User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  team            Team?        
---
[Medium] chunk lines 201-220 in packages/prisma/schema.prisma:
  locale              String?
  timeFormat          Int?                 @default(12)
  twoFactorSecret     String?
  twoFactorEnabled    Boolean              @default(false)
  backupCodes         String?
  identityProvider    IdentityProvider     @default(CAL)
  identityProviderId  String?
  availability        Availability[]
  invitedTo           Int?
  webhooks            Webhook[]
  brandColor          String               @default(""#292929"")
  darkBrandColor      String               @defau
---
[Medium] chunk lines 481-500 in packages/prisma/schema.prisma:
}

model ResetPasswordRequest {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String
  expires   DateTime
}

enum ReminderType {
  PENDING_BOOKING_CONFIRMATION
}

model ReminderMail {
  id             Int          @id @default(autoincrement())
  referenceId    Int
  reminderType   ReminderType
  elapsedMinutes Int
  createdAt      DateTime     @default(now())
---
[Medium] chunk lines 341-360 in packages/prisma/schema.prisma:
  deleted            Boolean?
  credentialId       Int?

  @@index([bookingId])
  @@index([credentialId])
  @@index([type])
  @@index([uid])
}

model Attendee {
  id          Int          @id @default(autoincrement())
  email       String
  name        String
  timeZone    String
  locale      String?      @default(""en"")
  booking     Booking?     @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId   Int?
  bookingSeat BookingSeat?

  @@index([email])
---
[Medium] chunk lines 601-620 in packages/prisma/schema.prisma:
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@index([type])
}

model Session {
  id           String   @id @default(cuid())
  
---
[Medium] chunk lines 581-600 in packages/prisma/schema.prisma:
  hashedKey  String    @unique()
  user       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  team       Team?     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  app        App?      @relation(fields: [appId], references: [slug], onDelete: Cascade)
  appId      String?

  @@index([userId])
}

model HashedLink {
  id          Int       @id @default(autoincrement())
  link        String    @unique()
  eventType   EventType @relation(fields: [eventTy
---
[Medium] chunk lines 721-740 in packages/prisma/schema.prisma:
  SMS_ATTENDEE
  SMS_NUMBER
  EMAIL_ADDRESS
  WHATSAPP_ATTENDEE
  WHATSAPP_NUMBER
}

model WorkflowStep {
  id                        Int                @id @default(autoincrement())
  stepNumber                Int
  action                    WorkflowActions
  workflowId                Int
  workflow                  Workflow           @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  sendTo                    String?
  reminderBody              String?
  emailSubject       
---
[Medium] chunk lines 761-780 in packages/prisma/schema.prisma:
  @@index([teamId])
}

model WorkflowsOnEventTypes {
  id          Int       @id @default(autoincrement())
  workflow    Workflow  @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  workflowId  Int
  eventType   EventType @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  eventTypeId Int

  @@unique([workflowId, eventTypeId])
  @@index([workflowId])
  @@index([eventTypeId])
}

model Deployment {
  /// This is a single row table, so we use a fixed id
  id 
---
[Medium] chunk lines 801-820 in packages/prisma/schema.prisma:
  workflowStep    WorkflowStep?   @relation(fields: [workflowStepId], references: [id])
  cancelled       Boolean?
  seatReferenceId String?

  @@index([bookingUid])
  @@index([workflowStepId])
  @@index([seatReferenceId])
}

enum WorkflowTemplates {
  REMINDER
  CUSTOM
  CANCELLED
  RESCHEDULED
  COMPLETED
}

enum WorkflowMethods {
  EMAIL
  SMS
---
[Medium] chunk lines 881-900 in packages/prisma/schema.prisma:
  slotUtcStartDate DateTime
  slotUtcEndDate   DateTime
  uid              String
  releaseAt        DateTime
  isSeat           Boolean  @default(false)

  @@unique(fields: [userId, slotUtcStartDate, slotUtcEndDate, uid], name: ""selectedSlotUnique"")
}

view BookingTimeStatus {
  id            Int            @unique
  uid           String?
  eventTypeId   Int?
  title         String?
  description   String?
  startTime     DateTime?
  endTime       DateTime?
  createdAt     DateTime?
  location 
---
[Medium] chunk lines 781-800 in packages/prisma/schema.prisma:
  theme           Json?
  licenseKey      String?
  agreedLicenseAt DateTime?
}

enum TimeUnit {
  DAY    @map(""day"")
  HOUR   @map(""hour"")
  MINUTE @map(""minute"")
}

model WorkflowReminder {
  id              Int             @id @default(autoincrement())
  bookingUid      String?
  booking         Booking?        @relation(fields: [bookingUid], references: [uid])
  method          WorkflowMethods
  scheduledDate   DateTime
  referenceId     String?         @unique
  scheduled       Boolean
  wo
---
[Medium] chunk lines 841-860 in packages/prisma/schema.prisma:
  teamId      Int?
  team        Team?  @relation(fields: [teamId], references: [id], onDelete: Cascade)
  phoneNumber String

  @@index([userId])
  @@index([teamId])
}

model Feature {
  // The feature slug, ex: 'v2-workflows'
  slug        String       @id @unique
  // If the feature is currently enabled
  enabled     Boolean      @default(false)
  // A short description of the feature
  description String?
  // The type of feature flag
  type        FeatureType? @default(RELEASE)
  // If the 
---
[Medium] chunk lines 281-300 in packages/prisma/schema.prisma:
  inviteTokens        VerificationToken[]
  webhooks            Webhook[]
  timeFormat          Int?
  timeZone            String                  @default(""Europe/London"")
  weekStart           String                  @default(""Sunday"")
  routingForms        App_RoutingForms_Form[]
  apiKeys             ApiKey[]
  credentials         Credential[]

  @@unique([slug, parentId])
}

enum MembershipRole {
  MEMBER
  ADMIN
  OWNER
}

model Membership {
  id                   Int            @id @defau
---
[Medium] chunk lines 301-320 in packages/prisma/schema.prisma:
  teamId               Int
  userId               Int
  accepted             Boolean        @default(false)
  role                 MembershipRole
  team                 Team           @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user                 User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  disableImpersonation Boolean        @default(false)

  @@unique([userId, teamId])
  @@index([teamId])
  @@index([userId])
}

model VerificationTok
---
[Medium] chunk lines 381-400 in packages/prisma/schema.prisma:
  customInputs          Json?
  /// @zod.custom(imports.bookingResponses)
  responses             Json?
  startTime             DateTime
  endTime               DateTime
  attendees             Attendee[]
  location              String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime?
  status                BookingStatus        @default(ACCEPTED)
  paid                  Boolean              @default(false)
  payment               Payment[]
  destina","ErrorCode (Critical), providers (Critical), buildUser (Critical), user (Critical), TwoFactor (High), DisableTwoFactorValues (High), SetupStep (Medium), TwoFactor (Medium), PasswordField (Medium), LoginValues (Medium), Login (Medium), EnableTwoFactorModal (Medium), handler (Medium), DisableTwoFactorAuthModal (Medium), TwoFactorAuthAPI (Medium), handler (Medium), lines 361-380 (Medium), lines 321-340 (Medium), lines 821-840 (Medium), lines 681-700 (Medium), lines 741-760 (Medium), lines 701-720 (Medium), lines 561-580 (Medium), lines 241-260 (Medium), lines 661-680 (Medium), lines 401-420 (Medium), lines 421-440 (Medium), lines 441-460 (Medium), lines 461-480 (Medium), lines 521-540 (Medium), lines 621-640 (Medium), lines 261-280 (Medium), lines 861-880 (Medium), lines 541-560 (Medium), lines 201-220 (Medium), lines 481-500 (Medium), lines 341-360 (Medium), lines 601-620 (Medium), lines 581-600 (Medium), lines 721-740 (Medium), lines 761-780 (Medium), lines 801-820 (Medium), lines 881-900 (Medium), lines 781-800 (Medium), lines 841-860 (Medium), lines 281-300 (Medium), lines 301-320 (Medium), lines 381-400 (Medium), lines 901-908 (Low), backup_code (Low), backup_codes (Low), backup_code_instructions (Low), backup_codes_copied (Low), incorrect_backup_code (Low), lost_access (Low), missing_backup_codes (Low), lines 1-2 (Low), lines 501-520 (Low), lines 221-240 (Low), lines 641-660 (Low)",match,'two' matches HC entity 'disabletwofactorvalues'
cal_dot_com,2,Async import of the appStore packages,Consider adding try-catch around the await to handle import failures gracefully,Low,25,3,20,"variable::getCalendar (packages/app-store/_utils/getCalendar.ts) [Critical, score=0.97] | variable::Reschedule (packages/app-store/vital/lib/reschedule.ts) [Critical, score=0.96] | variable::appStore (packages/app-store/index.ts) [Critical, score=0.91]","[Critical] variable getCalendar in packages/app-store/_utils/getCalendar.ts:
const getCalendar = async (credential: CredentialPayload | null): Promise<Calendar | null> => {
  if (!credential || !credential.key) return null;
  let { type: calendarType } = credential;
  if (calendarType?.endsWith(""_other_calendar"")) {
    calendarType = calendarType.split(""_other_calendar"")[0];
  }
  const calendarApp = await appStore[calendarType.split(""_"").join("""") as keyof typeof appStore];
  if (!(calendarApp && ""lib"" in calendarApp && ""CalendarService"" in calendarApp.lib)) {
    log.warn(`calendar of type ${calendarType} is not implemented`);
    return null;
  }
  log.info(""calendarApp"", calendarApp.lib.CalendarService);
  const CalendarService = calendarApp.lib.CalendarService;
  return new CalendarService(credential);
};
---
[Critical] variable Reschedule in packages/app-store/vital/lib/reschedule.ts:
const Reschedule = async (bookingUid: string, cancellationReason: string) => {
  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      title: true,
      startTime: true,
      endTime: true,
      userId: true,
      eventTypeId: true,
      location: true,
      attendees: true,
      references: true,
      user: {
        select: {
          id: true,
          email: true,
          name: true,
          timeZone: true,
          locale: true,
          username: true,
          credentials: true,
          destinationCalendar: true,
        },
      },
    },
    where: {
      uid: bookingUid,
      NOT: {
        status: {
          in: [BookingStatus.CANCELLED, BookingStatus.REJECTED],
        },
      },
    },
  
---
[Critical] variable appStore in packages/app-store/index.ts:
const appStore = {
  // example: import(""./example""),
  applecalendar: import(""./applecalendar""),
  caldavcalendar: import(""./caldavcalendar""),
  closecom: import(""./closecom""),
  dailyvideo: import(""./dailyvideo""),
  googlecalendar: import(""./googlecalendar""),
  googlevideo: import(""./googlevideo""),
  hubspot: import(""./hubspot""),
  huddle01video: import(""./huddle01video""),
  jitsivideo: import(""./jitsivideo""),
  larkcalendar: import(""./larkcalendar""),
  office365calendar: import(""./office365calendar""),
  office365video: import(""./office365video""),
  plausible: import(""./plausible""),
  salesforce: import(""./salesforce""),
  zohocrm: import(""./zohocrm""),
  sendgrid: import(""./sendgrid""),
  stripepayment: import(""./stripepayment""),
  tandemvideo: import(""./tandemvideo""),
  vital: import(""./v","[Medium] variable handlePayment in packages/lib/payment/handlePayment.ts:
const handlePayment = async (
  evt: CalendarEvent,
  selectedEventType: Pick<Zod.infer<typeof EventTypeModel>, ""metadata"">,
  paymentAppCredentials: {
    key: Prisma.JsonValue;
    appId: EventTypeAppsList;
    app: {
      dirName: string;
      categories: AppCategories[];
    } | null;
  },
  booking: {
    user: { email: string | null; name: string | null; timeZone: string } | null;
    id: number;
    startTime: { toISOString: () => string };
    uid: string;
  }
) => {
  const paymentApp
---
[Medium] variable Reschedule in packages/app-store/wipemycalother/lib/reschedule.ts:
const Reschedule = async (bookingUid: string, cancellationReason: string) => {
  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      title: true,
      startTime: true,
      endTime: true,
      userId: true,
      eventTypeId: true,
      location: true,
      attendees: true,
      references: true,
      user: {
        select: {
          id: true,
          email: true,
          name: true,
          timeZone: true,
    
---
[Medium] variable deleteMeeting in packages/core/videoClient.ts:
const deleteMeeting = async (credential: CredentialPayload, uid: string): Promise<unknown> => {
  if (credential) {
    const videoAdapter = (await getVideoAdapters([credential]))[0];
    // There are certain video apps with no video adapter defined. e.g. riverby,whereby
    if (videoAdapter) {
      return videoAdapter.deleteMeeting(uid);
    }
  }

  return Promise.resolve({});
};
---
[Medium] variable getVideoAdapters in packages/core/videoClient.ts:
const getVideoAdapters = async (withCredentials: CredentialPayload[]): Promise<VideoApiAdapter[]> => {
  const videoAdapters: VideoApiAdapter[] = [];

  for (const cred of withCredentials) {
    const appName = cred.type.split(""_"").join(""""); // Transform `zoom_video` to `zoomvideo`;
    const app = await appStore[appName as keyof typeof appStore];

    if (app && ""lib"" in app && ""VideoApiAdapter"" in app.lib) {
      const makeVideoApiAdapter = app.lib.VideoApiAdapter as VideoApiAdapterFactory;
 
---
[Medium] variable getBusyVideoTimes in packages/core/videoClient.ts:
const getBusyVideoTimes = async (withCredentials: CredentialPayload[]) =>
  Promise.all((await getVideoAdapters(withCredentials)).map((c) => c?.getAvailability())).then((results) =>
    results.reduce((acc, availability) => acc.concat(availability), [] as (EventBusyDate | undefined)[])
  );
---
[Medium] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings.tsx:
const bookingsRouter = router({
  get: authedProcedure
    .input(
      z.object({
        filters: z.object({
          teamIds: z.number().array().optional(),
          userIds: z.number().array().optional(),
          status: z.enum([""upcoming"", ""recurring"", ""past"", ""cancelled"", ""unconfirmed""]),
          eventTypeIds: z.number().array().optional(),
        }),
        limit: z.number().min(1).max(100).nullish(),
        cursor: z.number().nullish(), // <-- ""cursor"" needs to exist when using
---
[Medium] variable getConnectedCalendars in packages/core/CalendarManager.ts:
const getConnectedCalendars = async (
  calendarCredentials: ReturnType<typeof getCalendarCredentials>,
  selectedCalendars: { externalId: string }[],
  destinationCalendarExternalId?: string
) => {
  let destinationCalendar: IntegrationCalendar | undefined;
  const connectedCalendars = await Promise.all(
    calendarCredentials.map(async (item) => {
      try {
        const { integration, credential } = item;
        const calendar = await item.calendar;
        // Don't leak credentials to th
---
[Medium] variable updateEvent in packages/core/CalendarManager.ts:
const updateEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  bookingRefUid: string | null,
  externalCalendarId: string | null
): Promise<EventResult<NewCalendarEventType>> => {
  const uid = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = false;
  let calError: string | undefined = undefined;
  let calWarnings: string[] | undefined = [];

  if (bookingRefUid === """") {
    log.error(""updateEvent failed"", ""bookingRefUid is empty
---
[Medium] variable createEvent in packages/core/CalendarManager.ts:
const createEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent
): Promise<EventResult<NewCalendarEventType>> => {
  const uid: string = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = true;
  let calError: string | undefined = undefined;

  // Check if the disabledNotes flag is set to true
  if (calEvent.hideCalendarNotes) {
    calEvent.additionalNotes = ""Notes have been hidden by the organiser""; // TODO: i18n this string?
  }

  /
---
[Medium] variable deleteEvent in packages/core/CalendarManager.ts:
const deleteEvent = async (
  credential: CredentialPayload,
  uid: string,
  event: CalendarEvent
): Promise<unknown> => {
  const calendar = await getCalendar(credential);
  if (calendar) {
    return calendar.deleteEvent(uid, event);
  }

  return Promise.resolve({});
};
---
[Medium] class EventManager in packages/core/EventManager.ts:
class EventManager {
  calendarCredentials: CredentialWithAppName[];
  videoCredentials: CredentialWithAppName[];

  /**
   * Takes an array of credentials and initializes a new instance of the EventManager.
   *
   * @param user
   */
  constructor(user: EventManagerUser) {
    const appCredentials = getApps(user.credentials).flatMap((app) =>
      app.credentials.map((creds) => ({ ...creds, appName: app.name }))
    );
    // This includes all calendar-related apps, traditional calendars such 
---
[Medium] method updateAllCalendarEvents in packages/core/EventManager.ts:
private async updateAllCalendarEvents(
    event: CalendarEvent,
    booking: PartialBooking,
    newBookingId?: number
  ): Promise<Array<EventResult<NewCalendarEventType>>> {
    let calendarReference: PartialReference | undefined = undefined,
      credential;
    try {
      // If a newBookingId is given, update that calendar event
      let newBooking;
      if (newBookingId) {
        newBooking = await prisma.booking.findUnique({
          where: {
            id: newBookingId,
          
---
[Medium] variable createMeeting in packages/core/videoClient.ts:
const createMeeting = async (credential: CredentialWithAppName, calEvent: CalendarEvent) => {
  const uid: string = getUid(calEvent);

  if (!credential || !credential.appId) {
    throw new Error(
      ""Credentials must be set! Video platforms are optional, so this method shouldn't even be called when no video credentials are set.""
    );
  }

  const videoAdapters = await getVideoAdapters([credential]);
  const [firstVideoAdapter] = videoAdapters;
  let createdMeeting;
  let returnObject: {
 
---
[Medium] variable createMeetingWithCalVideo in packages/core/videoClient.ts:
const createMeetingWithCalVideo = async (calEvent: CalendarEvent) => {
  let dailyAppKeys: Awaited<ReturnType<typeof getDailyAppKeys>>;
  try {
    dailyAppKeys = await getDailyAppKeys();
  } catch (e) {
    return;
  }
  const [videoAdapter] = await getVideoAdapters([
    {
      id: 0,
      appId: ""daily-video"",
      type: ""daily_video"",
      userId: null,
      key: dailyAppKeys,
      invalid: false,
    },
  ]);
  return videoAdapter?.createMeeting(calEvent);
};
---
[Medium] variable getRecordingsOfCalVideoByRoomName in packages/core/videoClient.ts:
const getRecordingsOfCalVideoByRoomName = async (
  roomName: string
): Promise<GetRecordingsResponseSchema | undefined> => {
  let dailyAppKeys: Awaited<ReturnType<typeof getDailyAppKeys>>;
  try {
    dailyAppKeys = await getDailyAppKeys();
  } catch (e) {
    console.error(""Error: Cal video provider is not installed."");
    return;
  }
  const [videoAdapter] = await getVideoAdapters([
    {
      id: 0,
      appId: ""daily-video"",
      type: ""daily_video"",
      userId: null,
      key: dail
---
[Medium] variable updateMeeting in packages/core/videoClient.ts:
const updateMeeting = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  bookingRef: PartialReference | null
): Promise<EventResult<VideoCallData>> => {
  const uid = translator.fromUUID(uuidv5(JSON.stringify(calEvent), uuidv5.URL));

  let success = true;

  const [firstVideoAdapter] = await getVideoAdapters([credential]);
  const updatedMeeting =
    credential && bookingRef
      ? await firstVideoAdapter?.updateMeeting(bookingRef, calEvent).catch(async (e) => {
       
---
[Medium] variable getDownloadLinkOfCalVideoByRecordingId in packages/core/videoClient.ts:
const getDownloadLinkOfCalVideoByRecordingId = async (recordingId: string) => {
  let dailyAppKeys: Awaited<ReturnType<typeof getDailyAppKeys>>;
  try {
    dailyAppKeys = await getDailyAppKeys();
  } catch (e) {
    console.error(""Error: Cal video provider is not installed."");
    return;
  }
  const [videoAdapter] = await getVideoAdapters([
    {
      id: 0,
      appId: ""daily-video"",
      type: ""daily_video"",
      userId: null,
      key: dailyAppKeys,
      invalid: false,
    },
  ]);
 
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: CustomRequest) {
  const { id, uid, allRemainingBookings, cancellationReason, seatReferenceUid } =
    schemaBookingCancelParams.parse(req.body);
  req.bookingToDelete = await getBookingToDelete(id, uid);
  const { bookingToDelete, userId } = req;

  if (!bookingToDelete || !bookingToDelete.user) {
    throw new HttpError({ statusCode: 400, message: ""Booking not found"" });
  }

  if (userId !== bookingToDelete.user?.id && bookingToDelete.startTime < new Date()) {
    
---
[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(
  req: NextApiRequest & { userId?: number | undefined },
  {
    isNotAnApiCall = false,
  }: {
    isNotAnApiCall?: boolean;
  } = {
    isNotAnApiCall: false,
  }
) {
  const { userId } = req;

  // handle dynamic user
  let eventType =
    !req.body.eventTypeId && !!req.body.eventTypeSlug
      ? getDefaultEvent(req.body.eventTypeSlug)
      : await getEventTypesFromDB(req.body.eventTypeId);

  eventType = {
    ...eventType,
    bookingFields: getBookingFieldsWithSyst
---
[Medium] variable deletePayment in packages/lib/payment/deletePayment.ts:
const deletePayment = async (
  paymentId: Payment[""id""],
  paymentAppCredentials: {
    key: Prisma.JsonValue;
    appId: string | null;
    app: {
      dirName: string;
      categories: AppCategories[];
    } | null;
  }
): Promise<boolean> => {
  const paymentApp = await appStore[paymentAppCredentials?.app?.dirName as keyof typeof appStore];
  if (!(paymentApp && ""lib"" in paymentApp && ""PaymentService"" in paymentApp.lib)) {
    console.warn(`payment App service of type ${paymentApp} is not ","getCalendar (Critical), Reschedule (Critical), appStore (Critical), handlePayment (Medium), Reschedule (Medium), deleteMeeting (Medium), getVideoAdapters (Medium), getBusyVideoTimes (Medium), bookingsRouter (Medium), getConnectedCalendars (Medium), updateEvent (Medium), createEvent (Medium), deleteEvent (Medium), EventManager (Medium), updateAllCalendarEvents (Medium), createMeeting (Medium), createMeetingWithCalVideo (Medium), getRecordingsOfCalVideoByRoomName (Medium), updateMeeting (Medium), getDownloadLinkOfCalVideoByRecordingId (Medium), handler (Medium), handler (Medium), deletePayment (Medium), getCachedResults (Low), getCalendarCredentials (Low)",match,'handle' matches entity 'handlepayment'
cal_dot_com,2,Async import of the appStore packages,"The code uses forEach with async callbacks, which causes asynchronous operations (e.g., calendar/video event deletions, payment refunds) to run concurrently without being awaited. This 'fire-and-forget' behavior leads to unhandled promise rejections, race conditions, and incomplete cleanup, as surrounding try-catch blocks cannot properly handle errors from these unawaited promises. Replace forEach with for...of loops or Promise.all() with map() to ensure proper sequential execution and error handling.",Critical,25,3,20,"variable::getCalendar (packages/app-store/_utils/getCalendar.ts) [Critical, score=0.97] | variable::Reschedule (packages/app-store/vital/lib/reschedule.ts) [Critical, score=0.96] | variable::appStore (packages/app-store/index.ts) [Critical, score=0.91]","[Critical] variable getCalendar in packages/app-store/_utils/getCalendar.ts:
const getCalendar = async (credential: CredentialPayload | null): Promise<Calendar | null> => {
  if (!credential || !credential.key) return null;
  let { type: calendarType } = credential;
  if (calendarType?.endsWith(""_other_calendar"")) {
    calendarType = calendarType.split(""_other_calendar"")[0];
  }
  const calendarApp = await appStore[calendarType.split(""_"").join("""") as keyof typeof appStore];
  if (!(calendarApp && ""lib"" in calendarApp && ""CalendarService"" in calendarApp.lib)) {
    log.warn(`calendar of type ${calendarType} is not implemented`);
    return null;
  }
  log.info(""calendarApp"", calendarApp.lib.CalendarService);
  const CalendarService = calendarApp.lib.CalendarService;
  return new CalendarService(credential);
};
---
[Critical] variable Reschedule in packages/app-store/vital/lib/reschedule.ts:
const Reschedule = async (bookingUid: string, cancellationReason: string) => {
  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      title: true,
      startTime: true,
      endTime: true,
      userId: true,
      eventTypeId: true,
      location: true,
      attendees: true,
      references: true,
      user: {
        select: {
          id: true,
          email: true,
          name: true,
          timeZone: true,
          locale: true,
          username: true,
          credentials: true,
          destinationCalendar: true,
        },
      },
    },
    where: {
      uid: bookingUid,
      NOT: {
        status: {
          in: [BookingStatus.CANCELLED, BookingStatus.REJECTED],
        },
      },
    },
  
---
[Critical] variable appStore in packages/app-store/index.ts:
const appStore = {
  // example: import(""./example""),
  applecalendar: import(""./applecalendar""),
  caldavcalendar: import(""./caldavcalendar""),
  closecom: import(""./closecom""),
  dailyvideo: import(""./dailyvideo""),
  googlecalendar: import(""./googlecalendar""),
  googlevideo: import(""./googlevideo""),
  hubspot: import(""./hubspot""),
  huddle01video: import(""./huddle01video""),
  jitsivideo: import(""./jitsivideo""),
  larkcalendar: import(""./larkcalendar""),
  office365calendar: import(""./office365calendar""),
  office365video: import(""./office365video""),
  plausible: import(""./plausible""),
  salesforce: import(""./salesforce""),
  zohocrm: import(""./zohocrm""),
  sendgrid: import(""./sendgrid""),
  stripepayment: import(""./stripepayment""),
  tandemvideo: import(""./tandemvideo""),
  vital: import(""./v","[Medium] variable handlePayment in packages/lib/payment/handlePayment.ts:
const handlePayment = async (
  evt: CalendarEvent,
  selectedEventType: Pick<Zod.infer<typeof EventTypeModel>, ""metadata"">,
  paymentAppCredentials: {
    key: Prisma.JsonValue;
    appId: EventTypeAppsList;
    app: {
      dirName: string;
      categories: AppCategories[];
    } | null;
  },
  booking: {
    user: { email: string | null; name: string | null; timeZone: string } | null;
    id: number;
    startTime: { toISOString: () => string };
    uid: string;
  }
) => {
  const paymentApp
---
[Medium] variable Reschedule in packages/app-store/wipemycalother/lib/reschedule.ts:
const Reschedule = async (bookingUid: string, cancellationReason: string) => {
  const bookingToReschedule = await prisma.booking.findFirstOrThrow({
    select: {
      id: true,
      uid: true,
      title: true,
      startTime: true,
      endTime: true,
      userId: true,
      eventTypeId: true,
      location: true,
      attendees: true,
      references: true,
      user: {
        select: {
          id: true,
          email: true,
          name: true,
          timeZone: true,
    
---
[Medium] variable deleteMeeting in packages/core/videoClient.ts:
const deleteMeeting = async (credential: CredentialPayload, uid: string): Promise<unknown> => {
  if (credential) {
    const videoAdapter = (await getVideoAdapters([credential]))[0];
    // There are certain video apps with no video adapter defined. e.g. riverby,whereby
    if (videoAdapter) {
      return videoAdapter.deleteMeeting(uid);
    }
  }

  return Promise.resolve({});
};
---
[Medium] variable getVideoAdapters in packages/core/videoClient.ts:
const getVideoAdapters = async (withCredentials: CredentialPayload[]): Promise<VideoApiAdapter[]> => {
  const videoAdapters: VideoApiAdapter[] = [];

  for (const cred of withCredentials) {
    const appName = cred.type.split(""_"").join(""""); // Transform `zoom_video` to `zoomvideo`;
    const app = await appStore[appName as keyof typeof appStore];

    if (app && ""lib"" in app && ""VideoApiAdapter"" in app.lib) {
      const makeVideoApiAdapter = app.lib.VideoApiAdapter as VideoApiAdapterFactory;
 
---
[Medium] variable getBusyVideoTimes in packages/core/videoClient.ts:
const getBusyVideoTimes = async (withCredentials: CredentialPayload[]) =>
  Promise.all((await getVideoAdapters(withCredentials)).map((c) => c?.getAvailability())).then((results) =>
    results.reduce((acc, availability) => acc.concat(availability), [] as (EventBusyDate | undefined)[])
  );
---
[Medium] variable bookingsRouter in packages/trpc/server/routers/viewer/bookings.tsx:
const bookingsRouter = router({
  get: authedProcedure
    .input(
      z.object({
        filters: z.object({
          teamIds: z.number().array().optional(),
          userIds: z.number().array().optional(),
          status: z.enum([""upcoming"", ""recurring"", ""past"", ""cancelled"", ""unconfirmed""]),
          eventTypeIds: z.number().array().optional(),
        }),
        limit: z.number().min(1).max(100).nullish(),
        cursor: z.number().nullish(), // <-- ""cursor"" needs to exist when using
---
[Medium] variable getConnectedCalendars in packages/core/CalendarManager.ts:
const getConnectedCalendars = async (
  calendarCredentials: ReturnType<typeof getCalendarCredentials>,
  selectedCalendars: { externalId: string }[],
  destinationCalendarExternalId?: string
) => {
  let destinationCalendar: IntegrationCalendar | undefined;
  const connectedCalendars = await Promise.all(
    calendarCredentials.map(async (item) => {
      try {
        const { integration, credential } = item;
        const calendar = await item.calendar;
        // Don't leak credentials to th
---
[Medium] variable updateEvent in packages/core/CalendarManager.ts:
const updateEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  bookingRefUid: string | null,
  externalCalendarId: string | null
): Promise<EventResult<NewCalendarEventType>> => {
  const uid = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = false;
  let calError: string | undefined = undefined;
  let calWarnings: string[] | undefined = [];

  if (bookingRefUid === """") {
    log.error(""updateEvent failed"", ""bookingRefUid is empty
---
[Medium] variable createEvent in packages/core/CalendarManager.ts:
const createEvent = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent
): Promise<EventResult<NewCalendarEventType>> => {
  const uid: string = getUid(calEvent);
  const calendar = await getCalendar(credential);
  let success = true;
  let calError: string | undefined = undefined;

  // Check if the disabledNotes flag is set to true
  if (calEvent.hideCalendarNotes) {
    calEvent.additionalNotes = ""Notes have been hidden by the organiser""; // TODO: i18n this string?
  }

  /
---
[Medium] variable deleteEvent in packages/core/CalendarManager.ts:
const deleteEvent = async (
  credential: CredentialPayload,
  uid: string,
  event: CalendarEvent
): Promise<unknown> => {
  const calendar = await getCalendar(credential);
  if (calendar) {
    return calendar.deleteEvent(uid, event);
  }

  return Promise.resolve({});
};
---
[Medium] class EventManager in packages/core/EventManager.ts:
class EventManager {
  calendarCredentials: CredentialWithAppName[];
  videoCredentials: CredentialWithAppName[];

  /**
   * Takes an array of credentials and initializes a new instance of the EventManager.
   *
   * @param user
   */
  constructor(user: EventManagerUser) {
    const appCredentials = getApps(user.credentials).flatMap((app) =>
      app.credentials.map((creds) => ({ ...creds, appName: app.name }))
    );
    // This includes all calendar-related apps, traditional calendars such 
---
[Medium] method updateAllCalendarEvents in packages/core/EventManager.ts:
private async updateAllCalendarEvents(
    event: CalendarEvent,
    booking: PartialBooking,
    newBookingId?: number
  ): Promise<Array<EventResult<NewCalendarEventType>>> {
    let calendarReference: PartialReference | undefined = undefined,
      credential;
    try {
      // If a newBookingId is given, update that calendar event
      let newBooking;
      if (newBookingId) {
        newBooking = await prisma.booking.findUnique({
          where: {
            id: newBookingId,
          
---
[Medium] variable createMeeting in packages/core/videoClient.ts:
const createMeeting = async (credential: CredentialWithAppName, calEvent: CalendarEvent) => {
  const uid: string = getUid(calEvent);

  if (!credential || !credential.appId) {
    throw new Error(
      ""Credentials must be set! Video platforms are optional, so this method shouldn't even be called when no video credentials are set.""
    );
  }

  const videoAdapters = await getVideoAdapters([credential]);
  const [firstVideoAdapter] = videoAdapters;
  let createdMeeting;
  let returnObject: {
 
---
[Medium] variable createMeetingWithCalVideo in packages/core/videoClient.ts:
const createMeetingWithCalVideo = async (calEvent: CalendarEvent) => {
  let dailyAppKeys: Awaited<ReturnType<typeof getDailyAppKeys>>;
  try {
    dailyAppKeys = await getDailyAppKeys();
  } catch (e) {
    return;
  }
  const [videoAdapter] = await getVideoAdapters([
    {
      id: 0,
      appId: ""daily-video"",
      type: ""daily_video"",
      userId: null,
      key: dailyAppKeys,
      invalid: false,
    },
  ]);
  return videoAdapter?.createMeeting(calEvent);
};
---
[Medium] variable getRecordingsOfCalVideoByRoomName in packages/core/videoClient.ts:
const getRecordingsOfCalVideoByRoomName = async (
  roomName: string
): Promise<GetRecordingsResponseSchema | undefined> => {
  let dailyAppKeys: Awaited<ReturnType<typeof getDailyAppKeys>>;
  try {
    dailyAppKeys = await getDailyAppKeys();
  } catch (e) {
    console.error(""Error: Cal video provider is not installed."");
    return;
  }
  const [videoAdapter] = await getVideoAdapters([
    {
      id: 0,
      appId: ""daily-video"",
      type: ""daily_video"",
      userId: null,
      key: dail
---
[Medium] variable updateMeeting in packages/core/videoClient.ts:
const updateMeeting = async (
  credential: CredentialWithAppName,
  calEvent: CalendarEvent,
  bookingRef: PartialReference | null
): Promise<EventResult<VideoCallData>> => {
  const uid = translator.fromUUID(uuidv5(JSON.stringify(calEvent), uuidv5.URL));

  let success = true;

  const [firstVideoAdapter] = await getVideoAdapters([credential]);
  const updatedMeeting =
    credential && bookingRef
      ? await firstVideoAdapter?.updateMeeting(bookingRef, calEvent).catch(async (e) => {
       
---
[Medium] variable getDownloadLinkOfCalVideoByRecordingId in packages/core/videoClient.ts:
const getDownloadLinkOfCalVideoByRecordingId = async (recordingId: string) => {
  let dailyAppKeys: Awaited<ReturnType<typeof getDailyAppKeys>>;
  try {
    dailyAppKeys = await getDailyAppKeys();
  } catch (e) {
    console.error(""Error: Cal video provider is not installed."");
    return;
  }
  const [videoAdapter] = await getVideoAdapters([
    {
      id: 0,
      appId: ""daily-video"",
      type: ""daily_video"",
      userId: null,
      key: dailyAppKeys,
      invalid: false,
    },
  ]);
 
---
[Medium] function handler in packages/features/bookings/lib/handleCancelBooking.ts:
async function handler(req: CustomRequest) {
  const { id, uid, allRemainingBookings, cancellationReason, seatReferenceUid } =
    schemaBookingCancelParams.parse(req.body);
  req.bookingToDelete = await getBookingToDelete(id, uid);
  const { bookingToDelete, userId } = req;

  if (!bookingToDelete || !bookingToDelete.user) {
    throw new HttpError({ statusCode: 400, message: ""Booking not found"" });
  }

  if (userId !== bookingToDelete.user?.id && bookingToDelete.startTime < new Date()) {
    
---
[Medium] function handler in packages/features/bookings/lib/handleNewBooking.ts:
async function handler(
  req: NextApiRequest & { userId?: number | undefined },
  {
    isNotAnApiCall = false,
  }: {
    isNotAnApiCall?: boolean;
  } = {
    isNotAnApiCall: false,
  }
) {
  const { userId } = req;

  // handle dynamic user
  let eventType =
    !req.body.eventTypeId && !!req.body.eventTypeSlug
      ? getDefaultEvent(req.body.eventTypeSlug)
      : await getEventTypesFromDB(req.body.eventTypeId);

  eventType = {
    ...eventType,
    bookingFields: getBookingFieldsWithSyst
---
[Medium] variable deletePayment in packages/lib/payment/deletePayment.ts:
const deletePayment = async (
  paymentId: Payment[""id""],
  paymentAppCredentials: {
    key: Prisma.JsonValue;
    appId: string | null;
    app: {
      dirName: string;
      categories: AppCategories[];
    } | null;
  }
): Promise<boolean> => {
  const paymentApp = await appStore[paymentAppCredentials?.app?.dirName as keyof typeof appStore];
  if (!(paymentApp && ""lib"" in paymentApp && ""PaymentService"" in paymentApp.lib)) {
    console.warn(`payment App service of type ${paymentApp} is not ","getCalendar (Critical), Reschedule (Critical), appStore (Critical), handlePayment (Medium), Reschedule (Medium), deleteMeeting (Medium), getVideoAdapters (Medium), getBusyVideoTimes (Medium), bookingsRouter (Medium), getConnectedCalendars (Medium), updateEvent (Medium), createEvent (Medium), deleteEvent (Medium), EventManager (Medium), updateAllCalendarEvents (Medium), createMeeting (Medium), createMeetingWithCalVideo (Medium), getRecordingsOfCalVideoByRoomName (Medium), updateMeeting (Medium), getDownloadLinkOfCalVideoByRecordingId (Medium), handler (Medium), handler (Medium), deletePayment (Medium), getCachedResults (Low), getCalendarCredentials (Low)",match,'calendar' matches HC entity 'getcalendar'
